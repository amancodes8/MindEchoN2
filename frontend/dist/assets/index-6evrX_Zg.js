function tde(n,i){for(var s=0;s<i.length;s++){const c=i[s];if(typeof c!="string"&&!Array.isArray(c)){for(const f in c)if(f!=="default"&&!(f in n)){const p=Object.getOwnPropertyDescriptor(c,f);p&&Object.defineProperty(n,f,p.get?p:{enumerable:!0,get:()=>c[f]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))c(f);new MutationObserver(f=>{for(const p of f)if(p.type==="childList")for(const v of p.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&c(v)}).observe(document,{childList:!0,subtree:!0});function s(f){const p={};return f.integrity&&(p.integrity=f.integrity),f.referrerPolicy&&(p.referrerPolicy=f.referrerPolicy),f.crossOrigin==="use-credentials"?p.credentials="include":f.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function c(f){if(f.ep)return;f.ep=!0;const p=s(f);fetch(f.href,p)}})();var ck=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function fd(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var lk={exports:{}},PS={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $W;function nde(){if($W)return PS;$W=1;var n=Symbol.for("react.transitional.element"),i=Symbol.for("react.fragment");function s(c,f,p){var v=null;if(p!==void 0&&(v=""+p),f.key!==void 0&&(v=""+f.key),"key"in f){p={};for(var b in f)b!=="key"&&(p[b]=f[b])}else p=f;return f=p.ref,{$$typeof:n,type:c,key:v,ref:f!==void 0?f:null,props:p}}return PS.Fragment=i,PS.jsx=s,PS.jsxs=s,PS}var ZW;function rde(){return ZW||(ZW=1,lk.exports=nde()),lk.exports}var R=rde(),uk={exports:{}},nn={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var QW;function ide(){if(QW)return nn;QW=1;var n=Symbol.for("react.transitional.element"),i=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),c=Symbol.for("react.strict_mode"),f=Symbol.for("react.profiler"),p=Symbol.for("react.consumer"),v=Symbol.for("react.context"),b=Symbol.for("react.forward_ref"),T=Symbol.for("react.suspense"),w=Symbol.for("react.memo"),C=Symbol.for("react.lazy"),I=Symbol.for("react.activity"),D=Symbol.iterator;function L(me){return me===null||typeof me!="object"?null:(me=D&&me[D]||me["@@iterator"],typeof me=="function"?me:null)}var F={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},W=Object.assign,G={};function $(me,Ve,it){this.props=me,this.context=Ve,this.refs=G,this.updater=it||F}$.prototype.isReactComponent={},$.prototype.setState=function(me,Ve){if(typeof me!="object"&&typeof me!="function"&&me!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,me,Ve,"setState")},$.prototype.forceUpdate=function(me){this.updater.enqueueForceUpdate(this,me,"forceUpdate")};function te(){}te.prototype=$.prototype;function Z(me,Ve,it){this.props=me,this.context=Ve,this.refs=G,this.updater=it||F}var ce=Z.prototype=new te;ce.constructor=Z,W(ce,$.prototype),ce.isPureReactComponent=!0;var se=Array.isArray;function de(){}var oe={H:null,A:null,T:null,S:null},ge=Object.prototype.hasOwnProperty;function Ae(me,Ve,it){var dt=it.ref;return{$$typeof:n,type:me,key:Ve,ref:dt!==void 0?dt:null,props:it}}function ke(me,Ve){return Ae(me.type,Ve,me.props)}function Ee(me){return typeof me=="object"&&me!==null&&me.$$typeof===n}function be(me){var Ve={"=":"=0",":":"=2"};return"$"+me.replace(/[=:]/g,function(it){return Ve[it]})}var Le=/\/+/g;function et(me,Ve){return typeof me=="object"&&me!==null&&me.key!=null?be(""+me.key):Ve.toString(36)}function rt(me){switch(me.status){case"fulfilled":return me.value;case"rejected":throw me.reason;default:switch(typeof me.status=="string"?me.then(de,de):(me.status="pending",me.then(function(Ve){me.status==="pending"&&(me.status="fulfilled",me.value=Ve)},function(Ve){me.status==="pending"&&(me.status="rejected",me.reason=Ve)})),me.status){case"fulfilled":return me.value;case"rejected":throw me.reason}}throw me}function he(me,Ve,it,dt,Ct){var rn=typeof me;(rn==="undefined"||rn==="boolean")&&(me=null);var En=!1;if(me===null)En=!0;else switch(rn){case"bigint":case"string":case"number":En=!0;break;case"object":switch(me.$$typeof){case n:case i:En=!0;break;case C:return En=me._init,he(En(me._payload),Ve,it,dt,Ct)}}if(En)return Ct=Ct(me),En=dt===""?"."+et(me,0):dt,se(Ct)?(it="",En!=null&&(it=En.replace(Le,"$&/")+"/"),he(Ct,Ve,it,"",function(qt){return qt})):Ct!=null&&(Ee(Ct)&&(Ct=ke(Ct,it+(Ct.key==null||me&&me.key===Ct.key?"":(""+Ct.key).replace(Le,"$&/")+"/")+En)),Ve.push(Ct)),1;En=0;var ai=dt===""?".":dt+":";if(se(me))for(var qe=0;qe<me.length;qe++)dt=me[qe],rn=ai+et(dt,qe),En+=he(dt,Ve,it,rn,Ct);else if(qe=L(me),typeof qe=="function")for(me=qe.call(me),qe=0;!(dt=me.next()).done;)dt=dt.value,rn=ai+et(dt,qe++),En+=he(dt,Ve,it,rn,Ct);else if(rn==="object"){if(typeof me.then=="function")return he(rt(me),Ve,it,dt,Ct);throw Ve=String(me),Error("Objects are not valid as a React child (found: "+(Ve==="[object Object]"?"object with keys {"+Object.keys(me).join(", ")+"}":Ve)+"). If you meant to render a collection of children, use an array instead.")}return En}function _e(me,Ve,it){if(me==null)return me;var dt=[],Ct=0;return he(me,dt,"","",function(rn){return Ve.call(it,rn,Ct++)}),dt}function ze(me){if(me._status===-1){var Ve=me._result;Ve=Ve(),Ve.then(function(it){(me._status===0||me._status===-1)&&(me._status=1,me._result=it)},function(it){(me._status===0||me._status===-1)&&(me._status=2,me._result=it)}),me._status===-1&&(me._status=0,me._result=Ve)}if(me._status===1)return me._result.default;throw me._result}var tt=typeof reportError=="function"?reportError:function(me){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Ve=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof me=="object"&&me!==null&&typeof me.message=="string"?String(me.message):String(me),error:me});if(!window.dispatchEvent(Ve))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",me);return}console.error(me)},ut={map:_e,forEach:function(me,Ve,it){_e(me,function(){Ve.apply(this,arguments)},it)},count:function(me){var Ve=0;return _e(me,function(){Ve++}),Ve},toArray:function(me){return _e(me,function(Ve){return Ve})||[]},only:function(me){if(!Ee(me))throw Error("React.Children.only expected to receive a single React element child.");return me}};return nn.Activity=I,nn.Children=ut,nn.Component=$,nn.Fragment=s,nn.Profiler=f,nn.PureComponent=Z,nn.StrictMode=c,nn.Suspense=T,nn.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=oe,nn.__COMPILER_RUNTIME={__proto__:null,c:function(me){return oe.H.useMemoCache(me)}},nn.cache=function(me){return function(){return me.apply(null,arguments)}},nn.cacheSignal=function(){return null},nn.cloneElement=function(me,Ve,it){if(me==null)throw Error("The argument must be a React element, but you passed "+me+".");var dt=W({},me.props),Ct=me.key;if(Ve!=null)for(rn in Ve.key!==void 0&&(Ct=""+Ve.key),Ve)!ge.call(Ve,rn)||rn==="key"||rn==="__self"||rn==="__source"||rn==="ref"&&Ve.ref===void 0||(dt[rn]=Ve[rn]);var rn=arguments.length-2;if(rn===1)dt.children=it;else if(1<rn){for(var En=Array(rn),ai=0;ai<rn;ai++)En[ai]=arguments[ai+2];dt.children=En}return Ae(me.type,Ct,dt)},nn.createContext=function(me){return me={$$typeof:v,_currentValue:me,_currentValue2:me,_threadCount:0,Provider:null,Consumer:null},me.Provider=me,me.Consumer={$$typeof:p,_context:me},me},nn.createElement=function(me,Ve,it){var dt,Ct={},rn=null;if(Ve!=null)for(dt in Ve.key!==void 0&&(rn=""+Ve.key),Ve)ge.call(Ve,dt)&&dt!=="key"&&dt!=="__self"&&dt!=="__source"&&(Ct[dt]=Ve[dt]);var En=arguments.length-2;if(En===1)Ct.children=it;else if(1<En){for(var ai=Array(En),qe=0;qe<En;qe++)ai[qe]=arguments[qe+2];Ct.children=ai}if(me&&me.defaultProps)for(dt in En=me.defaultProps,En)Ct[dt]===void 0&&(Ct[dt]=En[dt]);return Ae(me,rn,Ct)},nn.createRef=function(){return{current:null}},nn.forwardRef=function(me){return{$$typeof:b,render:me}},nn.isValidElement=Ee,nn.lazy=function(me){return{$$typeof:C,_payload:{_status:-1,_result:me},_init:ze}},nn.memo=function(me,Ve){return{$$typeof:w,type:me,compare:Ve===void 0?null:Ve}},nn.startTransition=function(me){var Ve=oe.T,it={};oe.T=it;try{var dt=me(),Ct=oe.S;Ct!==null&&Ct(it,dt),typeof dt=="object"&&dt!==null&&typeof dt.then=="function"&&dt.then(de,tt)}catch(rn){tt(rn)}finally{Ve!==null&&it.types!==null&&(Ve.types=it.types),oe.T=Ve}},nn.unstable_useCacheRefresh=function(){return oe.H.useCacheRefresh()},nn.use=function(me){return oe.H.use(me)},nn.useActionState=function(me,Ve,it){return oe.H.useActionState(me,Ve,it)},nn.useCallback=function(me,Ve){return oe.H.useCallback(me,Ve)},nn.useContext=function(me){return oe.H.useContext(me)},nn.useDebugValue=function(){},nn.useDeferredValue=function(me,Ve){return oe.H.useDeferredValue(me,Ve)},nn.useEffect=function(me,Ve){return oe.H.useEffect(me,Ve)},nn.useEffectEvent=function(me){return oe.H.useEffectEvent(me)},nn.useId=function(){return oe.H.useId()},nn.useImperativeHandle=function(me,Ve,it){return oe.H.useImperativeHandle(me,Ve,it)},nn.useInsertionEffect=function(me,Ve){return oe.H.useInsertionEffect(me,Ve)},nn.useLayoutEffect=function(me,Ve){return oe.H.useLayoutEffect(me,Ve)},nn.useMemo=function(me,Ve){return oe.H.useMemo(me,Ve)},nn.useOptimistic=function(me,Ve){return oe.H.useOptimistic(me,Ve)},nn.useReducer=function(me,Ve,it){return oe.H.useReducer(me,Ve,it)},nn.useRef=function(me){return oe.H.useRef(me)},nn.useState=function(me){return oe.H.useState(me)},nn.useSyncExternalStore=function(me,Ve,it){return oe.H.useSyncExternalStore(me,Ve,it)},nn.useTransition=function(){return oe.H.useTransition()},nn.version="19.2.0",nn}var ez;function Vv(){return ez||(ez=1,uk.exports=ide()),uk.exports}var j=Vv();const w2=fd(j),ade=tde({__proto__:null,default:w2},[j]);var dk={exports:{}},kS={},hk={exports:{}},fk={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tz;function sde(){return tz||(tz=1,(function(n){function i(he,_e){var ze=he.length;he.push(_e);e:for(;0<ze;){var tt=ze-1>>>1,ut=he[tt];if(0<f(ut,_e))he[tt]=_e,he[ze]=ut,ze=tt;else break e}}function s(he){return he.length===0?null:he[0]}function c(he){if(he.length===0)return null;var _e=he[0],ze=he.pop();if(ze!==_e){he[0]=ze;e:for(var tt=0,ut=he.length,me=ut>>>1;tt<me;){var Ve=2*(tt+1)-1,it=he[Ve],dt=Ve+1,Ct=he[dt];if(0>f(it,ze))dt<ut&&0>f(Ct,it)?(he[tt]=Ct,he[dt]=ze,tt=dt):(he[tt]=it,he[Ve]=ze,tt=Ve);else if(dt<ut&&0>f(Ct,ze))he[tt]=Ct,he[dt]=ze,tt=dt;else break e}}return _e}function f(he,_e){var ze=he.sortIndex-_e.sortIndex;return ze!==0?ze:he.id-_e.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var p=performance;n.unstable_now=function(){return p.now()}}else{var v=Date,b=v.now();n.unstable_now=function(){return v.now()-b}}var T=[],w=[],C=1,I=null,D=3,L=!1,F=!1,W=!1,G=!1,$=typeof setTimeout=="function"?setTimeout:null,te=typeof clearTimeout=="function"?clearTimeout:null,Z=typeof setImmediate<"u"?setImmediate:null;function ce(he){for(var _e=s(w);_e!==null;){if(_e.callback===null)c(w);else if(_e.startTime<=he)c(w),_e.sortIndex=_e.expirationTime,i(T,_e);else break;_e=s(w)}}function se(he){if(W=!1,ce(he),!F)if(s(T)!==null)F=!0,de||(de=!0,be());else{var _e=s(w);_e!==null&&rt(se,_e.startTime-he)}}var de=!1,oe=-1,ge=5,Ae=-1;function ke(){return G?!0:!(n.unstable_now()-Ae<ge)}function Ee(){if(G=!1,de){var he=n.unstable_now();Ae=he;var _e=!0;try{e:{F=!1,W&&(W=!1,te(oe),oe=-1),L=!0;var ze=D;try{t:{for(ce(he),I=s(T);I!==null&&!(I.expirationTime>he&&ke());){var tt=I.callback;if(typeof tt=="function"){I.callback=null,D=I.priorityLevel;var ut=tt(I.expirationTime<=he);if(he=n.unstable_now(),typeof ut=="function"){I.callback=ut,ce(he),_e=!0;break t}I===s(T)&&c(T),ce(he)}else c(T);I=s(T)}if(I!==null)_e=!0;else{var me=s(w);me!==null&&rt(se,me.startTime-he),_e=!1}}break e}finally{I=null,D=ze,L=!1}_e=void 0}}finally{_e?be():de=!1}}}var be;if(typeof Z=="function")be=function(){Z(Ee)};else if(typeof MessageChannel<"u"){var Le=new MessageChannel,et=Le.port2;Le.port1.onmessage=Ee,be=function(){et.postMessage(null)}}else be=function(){$(Ee,0)};function rt(he,_e){oe=$(function(){he(n.unstable_now())},_e)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(he){he.callback=null},n.unstable_forceFrameRate=function(he){0>he||125<he?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ge=0<he?Math.floor(1e3/he):5},n.unstable_getCurrentPriorityLevel=function(){return D},n.unstable_next=function(he){switch(D){case 1:case 2:case 3:var _e=3;break;default:_e=D}var ze=D;D=_e;try{return he()}finally{D=ze}},n.unstable_requestPaint=function(){G=!0},n.unstable_runWithPriority=function(he,_e){switch(he){case 1:case 2:case 3:case 4:case 5:break;default:he=3}var ze=D;D=he;try{return _e()}finally{D=ze}},n.unstable_scheduleCallback=function(he,_e,ze){var tt=n.unstable_now();switch(typeof ze=="object"&&ze!==null?(ze=ze.delay,ze=typeof ze=="number"&&0<ze?tt+ze:tt):ze=tt,he){case 1:var ut=-1;break;case 2:ut=250;break;case 5:ut=1073741823;break;case 4:ut=1e4;break;default:ut=5e3}return ut=ze+ut,he={id:C++,callback:_e,priorityLevel:he,startTime:ze,expirationTime:ut,sortIndex:-1},ze>tt?(he.sortIndex=ze,i(w,he),s(T)===null&&he===s(w)&&(W?(te(oe),oe=-1):W=!0,rt(se,ze-tt))):(he.sortIndex=ut,i(T,he),F||L||(F=!0,de||(de=!0,be()))),he},n.unstable_shouldYield=ke,n.unstable_wrapCallback=function(he){var _e=D;return function(){var ze=D;D=_e;try{return he.apply(this,arguments)}finally{D=ze}}}})(fk)),fk}var nz;function ode(){return nz||(nz=1,hk.exports=sde()),hk.exports}var pk={exports:{}},Da={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rz;function cde(){if(rz)return Da;rz=1;var n=Vv();function i(T){var w="https://react.dev/errors/"+T;if(1<arguments.length){w+="?args[]="+encodeURIComponent(arguments[1]);for(var C=2;C<arguments.length;C++)w+="&args[]="+encodeURIComponent(arguments[C])}return"Minified React error #"+T+"; visit "+w+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(){}var c={d:{f:s,r:function(){throw Error(i(522))},D:s,C:s,L:s,m:s,X:s,S:s,M:s},p:0,findDOMNode:null},f=Symbol.for("react.portal");function p(T,w,C){var I=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:f,key:I==null?null:""+I,children:T,containerInfo:w,implementation:C}}var v=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function b(T,w){if(T==="font")return"";if(typeof w=="string")return w==="use-credentials"?w:""}return Da.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=c,Da.createPortal=function(T,w){var C=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!w||w.nodeType!==1&&w.nodeType!==9&&w.nodeType!==11)throw Error(i(299));return p(T,w,null,C)},Da.flushSync=function(T){var w=v.T,C=c.p;try{if(v.T=null,c.p=2,T)return T()}finally{v.T=w,c.p=C,c.d.f()}},Da.preconnect=function(T,w){typeof T=="string"&&(w?(w=w.crossOrigin,w=typeof w=="string"?w==="use-credentials"?w:"":void 0):w=null,c.d.C(T,w))},Da.prefetchDNS=function(T){typeof T=="string"&&c.d.D(T)},Da.preinit=function(T,w){if(typeof T=="string"&&w&&typeof w.as=="string"){var C=w.as,I=b(C,w.crossOrigin),D=typeof w.integrity=="string"?w.integrity:void 0,L=typeof w.fetchPriority=="string"?w.fetchPriority:void 0;C==="style"?c.d.S(T,typeof w.precedence=="string"?w.precedence:void 0,{crossOrigin:I,integrity:D,fetchPriority:L}):C==="script"&&c.d.X(T,{crossOrigin:I,integrity:D,fetchPriority:L,nonce:typeof w.nonce=="string"?w.nonce:void 0})}},Da.preinitModule=function(T,w){if(typeof T=="string")if(typeof w=="object"&&w!==null){if(w.as==null||w.as==="script"){var C=b(w.as,w.crossOrigin);c.d.M(T,{crossOrigin:C,integrity:typeof w.integrity=="string"?w.integrity:void 0,nonce:typeof w.nonce=="string"?w.nonce:void 0})}}else w==null&&c.d.M(T)},Da.preload=function(T,w){if(typeof T=="string"&&typeof w=="object"&&w!==null&&typeof w.as=="string"){var C=w.as,I=b(C,w.crossOrigin);c.d.L(T,C,{crossOrigin:I,integrity:typeof w.integrity=="string"?w.integrity:void 0,nonce:typeof w.nonce=="string"?w.nonce:void 0,type:typeof w.type=="string"?w.type:void 0,fetchPriority:typeof w.fetchPriority=="string"?w.fetchPriority:void 0,referrerPolicy:typeof w.referrerPolicy=="string"?w.referrerPolicy:void 0,imageSrcSet:typeof w.imageSrcSet=="string"?w.imageSrcSet:void 0,imageSizes:typeof w.imageSizes=="string"?w.imageSizes:void 0,media:typeof w.media=="string"?w.media:void 0})}},Da.preloadModule=function(T,w){if(typeof T=="string")if(w){var C=b(w.as,w.crossOrigin);c.d.m(T,{as:typeof w.as=="string"&&w.as!=="script"?w.as:void 0,crossOrigin:C,integrity:typeof w.integrity=="string"?w.integrity:void 0})}else c.d.m(T)},Da.requestFormReset=function(T){c.d.r(T)},Da.unstable_batchedUpdates=function(T,w){return T(w)},Da.useFormState=function(T,w,C){return v.H.useFormState(T,w,C)},Da.useFormStatus=function(){return v.H.useHostTransitionStatus()},Da.version="19.2.0",Da}var iz;function Cq(){if(iz)return pk.exports;iz=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(i){console.error(i)}}return n(),pk.exports=cde(),pk.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var az;function lde(){if(az)return kS;az=1;var n=ode(),i=Vv(),s=Cq();function c(l){var d="https://react.dev/errors/"+l;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var _=2;_<arguments.length;_++)d+="&args[]="+encodeURIComponent(arguments[_])}return"Minified React error #"+l+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function f(l){return!(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11)}function p(l){var d=l,_=l;if(l.alternate)for(;d.return;)d=d.return;else{l=d;do d=l,(d.flags&4098)!==0&&(_=d.return),l=d.return;while(l)}return d.tag===3?_:null}function v(l){if(l.tag===13){var d=l.memoizedState;if(d===null&&(l=l.alternate,l!==null&&(d=l.memoizedState)),d!==null)return d.dehydrated}return null}function b(l){if(l.tag===31){var d=l.memoizedState;if(d===null&&(l=l.alternate,l!==null&&(d=l.memoizedState)),d!==null)return d.dehydrated}return null}function T(l){if(p(l)!==l)throw Error(c(188))}function w(l){var d=l.alternate;if(!d){if(d=p(l),d===null)throw Error(c(188));return d!==l?null:l}for(var _=l,S=d;;){var x=_.return;if(x===null)break;var P=x.alternate;if(P===null){if(S=x.return,S!==null){_=S;continue}break}if(x.child===P.child){for(P=x.child;P;){if(P===_)return T(x),l;if(P===S)return T(x),d;P=P.sibling}throw Error(c(188))}if(_.return!==S.return)_=x,S=P;else{for(var Y=!1,ne=x.child;ne;){if(ne===_){Y=!0,_=x,S=P;break}if(ne===S){Y=!0,S=x,_=P;break}ne=ne.sibling}if(!Y){for(ne=P.child;ne;){if(ne===_){Y=!0,_=P,S=x;break}if(ne===S){Y=!0,S=P,_=x;break}ne=ne.sibling}if(!Y)throw Error(c(189))}}if(_.alternate!==S)throw Error(c(190))}if(_.tag!==3)throw Error(c(188));return _.stateNode.current===_?l:d}function C(l){var d=l.tag;if(d===5||d===26||d===27||d===6)return l;for(l=l.child;l!==null;){if(d=C(l),d!==null)return d;l=l.sibling}return null}var I=Object.assign,D=Symbol.for("react.element"),L=Symbol.for("react.transitional.element"),F=Symbol.for("react.portal"),W=Symbol.for("react.fragment"),G=Symbol.for("react.strict_mode"),$=Symbol.for("react.profiler"),te=Symbol.for("react.consumer"),Z=Symbol.for("react.context"),ce=Symbol.for("react.forward_ref"),se=Symbol.for("react.suspense"),de=Symbol.for("react.suspense_list"),oe=Symbol.for("react.memo"),ge=Symbol.for("react.lazy"),Ae=Symbol.for("react.activity"),ke=Symbol.for("react.memo_cache_sentinel"),Ee=Symbol.iterator;function be(l){return l===null||typeof l!="object"?null:(l=Ee&&l[Ee]||l["@@iterator"],typeof l=="function"?l:null)}var Le=Symbol.for("react.client.reference");function et(l){if(l==null)return null;if(typeof l=="function")return l.$$typeof===Le?null:l.displayName||l.name||null;if(typeof l=="string")return l;switch(l){case W:return"Fragment";case $:return"Profiler";case G:return"StrictMode";case se:return"Suspense";case de:return"SuspenseList";case Ae:return"Activity"}if(typeof l=="object")switch(l.$$typeof){case F:return"Portal";case Z:return l.displayName||"Context";case te:return(l._context.displayName||"Context")+".Consumer";case ce:var d=l.render;return l=l.displayName,l||(l=d.displayName||d.name||"",l=l!==""?"ForwardRef("+l+")":"ForwardRef"),l;case oe:return d=l.displayName||null,d!==null?d:et(l.type)||"Memo";case ge:d=l._payload,l=l._init;try{return et(l(d))}catch{}}return null}var rt=Array.isArray,he=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,_e=s.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ze={pending:!1,data:null,method:null,action:null},tt=[],ut=-1;function me(l){return{current:l}}function Ve(l){0>ut||(l.current=tt[ut],tt[ut]=null,ut--)}function it(l,d){ut++,tt[ut]=l.current,l.current=d}var dt=me(null),Ct=me(null),rn=me(null),En=me(null);function ai(l,d){switch(it(rn,d),it(Ct,l),it(dt,null),d.nodeType){case 9:case 11:l=(l=d.documentElement)&&(l=l.namespaceURI)?aR(l):0;break;default:if(l=d.tagName,d=d.namespaceURI)d=aR(d),l=t0(d,l);else switch(l){case"svg":l=1;break;case"math":l=2;break;default:l=0}}Ve(dt),it(dt,l)}function qe(){Ve(dt),Ve(Ct),Ve(rn)}function qt(l){l.memoizedState!==null&&it(En,l);var d=dt.current,_=t0(d,l.type);d!==_&&(it(Ct,l),it(dt,_))}function gn(l){Ct.current===l&&(Ve(dt),Ve(Ct)),En.current===l&&(Ve(En),mp._currentValue=ze)}var st,br;function An(l){if(st===void 0)try{throw Error()}catch(_){var d=_.stack.trim().match(/\n( *(at )?)/);st=d&&d[1]||"",br=-1<_.stack.indexOf(`
    at`)?" (<anonymous>)":-1<_.stack.indexOf("@")?"@unknown:0:0":""}return`
`+st+l+br}var Ai=!1;function gr(l,d){if(!l||Ai)return"";Ai=!0;var _=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var S={DetermineComponentFrameRoot:function(){try{if(d){var Ze=function(){throw Error()};if(Object.defineProperty(Ze.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ze,[])}catch(Be){var Me=Be}Reflect.construct(l,[],Ze)}else{try{Ze.call()}catch(Be){Me=Be}l.call(Ze.prototype)}}else{try{throw Error()}catch(Be){Me=Be}(Ze=l())&&typeof Ze.catch=="function"&&Ze.catch(function(){})}}catch(Be){if(Be&&Me&&typeof Be.stack=="string")return[Be.stack,Me.stack]}return[null,null]}};S.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var x=Object.getOwnPropertyDescriptor(S.DetermineComponentFrameRoot,"name");x&&x.configurable&&Object.defineProperty(S.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var P=S.DetermineComponentFrameRoot(),Y=P[0],ne=P[1];if(Y&&ne){var pe=Y.split(`
`),Pe=ne.split(`
`);for(x=S=0;S<pe.length&&!pe[S].includes("DetermineComponentFrameRoot");)S++;for(;x<Pe.length&&!Pe[x].includes("DetermineComponentFrameRoot");)x++;if(S===pe.length||x===Pe.length)for(S=pe.length-1,x=Pe.length-1;1<=S&&0<=x&&pe[S]!==Pe[x];)x--;for(;1<=S&&0<=x;S--,x--)if(pe[S]!==Pe[x]){if(S!==1||x!==1)do if(S--,x--,0>x||pe[S]!==Pe[x]){var We=`
`+pe[S].replace(" at new "," at ");return l.displayName&&We.includes("<anonymous>")&&(We=We.replace("<anonymous>",l.displayName)),We}while(1<=S&&0<=x);break}}}finally{Ai=!1,Error.prepareStackTrace=_}return(_=l?l.displayName||l.name:"")?An(_):""}function Qo(l,d){switch(l.tag){case 26:case 27:case 5:return An(l.type);case 16:return An("Lazy");case 13:return l.child!==d&&d!==null?An("Suspense Fallback"):An("Suspense");case 19:return An("SuspenseList");case 0:case 15:return gr(l.type,!1);case 11:return gr(l.type.render,!1);case 1:return gr(l.type,!0);case 31:return An("Activity");default:return""}}function Ur(l){try{var d="",_=null;do d+=Qo(l,_),_=l,l=l.return;while(l);return d}catch(S){return`
Error generating stack: `+S.message+`
`+S.stack}}var ra=Object.prototype.hasOwnProperty,mf=n.unstable_scheduleCallback,gf=n.unstable_cancelCallback,uN=n.unstable_shouldYield,Wb=n.unstable_requestPaint,Yn=n.unstable_now,zb=n.unstable_getCurrentPriorityLevel,ry=n.unstable_ImmediatePriority,co=n.unstable_UserBlockingPriority,_f=n.unstable_NormalPriority,iy=n.unstable_LowPriority,ay=n.unstable_IdlePriority,Kb=n.log,Yb=n.unstable_setDisableYieldValue,Ed=null,si=null;function ec(l){if(typeof Kb=="function"&&Yb(l),si&&typeof si.setStrictMode=="function")try{si.setStrictMode(Ed,l)}catch{}}var Ma=Math.clz32?Math.clz32:qb,dN=Math.log,Sd=Math.LN2;function qb(l){return l>>>=0,l===0?32:31-(dN(l)/Sd|0)|0}var Om=256,Im=262144,Nm=4194304;function tu(l){var d=l&42;if(d!==0)return d;switch(l&-l){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return l&261888;case 262144:case 524288:case 1048576:case 2097152:return l&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return l&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return l}}function rl(l,d,_){var S=l.pendingLanes;if(S===0)return 0;var x=0,P=l.suspendedLanes,Y=l.pingedLanes;l=l.warmLanes;var ne=S&134217727;return ne!==0?(S=ne&~P,S!==0?x=tu(S):(Y&=ne,Y!==0?x=tu(Y):_||(_=ne&~l,_!==0&&(x=tu(_))))):(ne=S&~P,ne!==0?x=tu(ne):Y!==0?x=tu(Y):_||(_=S&~l,_!==0&&(x=tu(_)))),x===0?0:d!==0&&d!==x&&(d&P)===0&&(P=x&-x,_=d&-d,P>=_||P===32&&(_&4194048)!==0)?d:x}function vf(l,d){return(l.pendingLanes&~(l.suspendedLanes&~l.pingedLanes)&d)===0}function bd(l,d){switch(l){case 1:case 2:case 4:case 8:case 64:return d+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Xb(){var l=Nm;return Nm<<=1,(Nm&62914560)===0&&(Nm=4194304),l}function sy(l){for(var d=[],_=0;31>_;_++)d.push(l);return d}function yf(l,d){l.pendingLanes|=d,d!==268435456&&(l.suspendedLanes=0,l.pingedLanes=0,l.warmLanes=0)}function _a(l,d,_,S,x,P){var Y=l.pendingLanes;l.pendingLanes=_,l.suspendedLanes=0,l.pingedLanes=0,l.warmLanes=0,l.expiredLanes&=_,l.entangledLanes&=_,l.errorRecoveryDisabledLanes&=_,l.shellSuspendCounter=0;var ne=l.entanglements,pe=l.expirationTimes,Pe=l.hiddenUpdates;for(_=Y&~_;0<_;){var We=31-Ma(_),Ze=1<<We;ne[We]=0,pe[We]=-1;var Me=Pe[We];if(Me!==null)for(Pe[We]=null,We=0;We<Me.length;We++){var Be=Me[We];Be!==null&&(Be.lane&=-536870913)}_&=~Ze}S!==0&&Jb(l,S,0),P!==0&&x===0&&l.tag!==0&&(l.suspendedLanes|=P&~(Y&~d))}function Jb(l,d,_){l.pendingLanes|=d,l.suspendedLanes&=~d;var S=31-Ma(d);l.entangledLanes|=d,l.entanglements[S]=l.entanglements[S]|1073741824|_&261930}function $b(l,d){var _=l.entangledLanes|=d;for(l=l.entanglements;_;){var S=31-Ma(_),x=1<<S;x&d|l[S]&d&&(l[S]|=d),_&=~x}}function Ef(l,d){var _=d&-d;return _=(_&42)!==0?1:xm(_),(_&(l.suspendedLanes|d))!==0?0:_}function xm(l){switch(l){case 2:l=1;break;case 8:l=4;break;case 32:l=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:l=128;break;case 268435456:l=134217728;break;default:l=0}return l}function Dm(l){return l&=-l,2<l?8<l?(l&134217727)!==0?32:268435456:8:2}function oy(){var l=_e.p;return l!==0?l:(l=window.event,l===void 0?32:v0(l.type))}function Zb(l,d){var _=_e.p;try{return _e.p=l,d()}finally{_e.p=_}}var tc=Math.random().toString(36).slice(2),mi="__reactFiber$"+tc,va="__reactProps$"+tc,Td="__reactContainer$"+tc,cy="__reactEvents$"+tc,Qb="__reactListeners$"+tc,eT="__reactHandles$"+tc,Pm="__reactResources$"+tc,wd="__reactMarker$"+tc;function il(l){delete l[mi],delete l[va],delete l[cy],delete l[Qb],delete l[eT]}function Rd(l){var d=l[mi];if(d)return d;for(var _=l.parentNode;_;){if(d=_[Td]||_[mi]){if(_=d.alternate,d.child!==null||_!==null&&_.child!==null)for(l=fR(l);l!==null;){if(_=l[mi])return _;l=fR(l)}return d}l=_,_=l.parentNode}return null}function Cd(l){if(l=l[mi]||l[Td]){var d=l.tag;if(d===5||d===6||d===13||d===31||d===26||d===27||d===3)return l}return null}function ya(l){var d=l.tag;if(d===5||d===26||d===27||d===6)return l.stateNode;throw Error(c(33))}function Ad(l){var d=l[Pm];return d||(d=l[Pm]={hoistableStyles:new Map,hoistableScripts:new Map}),d}function gi(l){l[wd]=!0}var jr=new Set,tT={};function nu(l,d){Od(l,d),Od(l+"Capture",d)}function Od(l,d){for(tT[l]=d,l=0;l<d.length;l++)jr.add(d[l])}var hN=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),km={},nT={};function rT(l){return ra.call(nT,l)?!0:ra.call(km,l)?!1:hN.test(l)?nT[l]=!0:(km[l]=!0,!1)}function Lm(l,d,_){if(rT(d))if(_===null)l.removeAttribute(d);else{switch(typeof _){case"undefined":case"function":case"symbol":l.removeAttribute(d);return;case"boolean":var S=d.toLowerCase().slice(0,5);if(S!=="data-"&&S!=="aria-"){l.removeAttribute(d);return}}l.setAttribute(d,""+_)}}function Mm(l,d,_){if(_===null)l.removeAttribute(d);else{switch(typeof _){case"undefined":case"function":case"symbol":case"boolean":l.removeAttribute(d);return}l.setAttribute(d,""+_)}}function nc(l,d,_,S){if(S===null)l.removeAttribute(_);else{switch(typeof S){case"undefined":case"function":case"symbol":case"boolean":l.removeAttribute(_);return}l.setAttributeNS(d,_,""+S)}}function Oi(l){switch(typeof l){case"bigint":case"boolean":case"number":case"string":case"undefined":return l;case"object":return l;default:return""}}function Um(l){var d=l.type;return(l=l.nodeName)&&l.toLowerCase()==="input"&&(d==="checkbox"||d==="radio")}function fN(l,d,_){var S=Object.getOwnPropertyDescriptor(l.constructor.prototype,d);if(!l.hasOwnProperty(d)&&typeof S<"u"&&typeof S.get=="function"&&typeof S.set=="function"){var x=S.get,P=S.set;return Object.defineProperty(l,d,{configurable:!0,get:function(){return x.call(this)},set:function(Y){_=""+Y,P.call(this,Y)}}),Object.defineProperty(l,d,{enumerable:S.enumerable}),{getValue:function(){return _},setValue:function(Y){_=""+Y},stopTracking:function(){l._valueTracker=null,delete l[d]}}}}function qn(l){if(!l._valueTracker){var d=Um(l)?"checked":"value";l._valueTracker=fN(l,d,""+l[d])}}function iT(l){if(!l)return!1;var d=l._valueTracker;if(!d)return!0;var _=d.getValue(),S="";return l&&(S=Um(l)?l.checked?"true":"false":l.value),l=S,l!==_?(d.setValue(l),!0):!1}function Sf(l){if(l=l||(typeof document<"u"?document:void 0),typeof l>"u")return null;try{return l.activeElement||l.body}catch{return l.body}}var aT=/[\n"\\]/g;function rs(l){return l.replace(aT,function(d){return"\\"+d.charCodeAt(0).toString(16)+" "})}function ly(l,d,_,S,x,P,Y,ne){l.name="",Y!=null&&typeof Y!="function"&&typeof Y!="symbol"&&typeof Y!="boolean"?l.type=Y:l.removeAttribute("type"),d!=null?Y==="number"?(d===0&&l.value===""||l.value!=d)&&(l.value=""+Oi(d)):l.value!==""+Oi(d)&&(l.value=""+Oi(d)):Y!=="submit"&&Y!=="reset"||l.removeAttribute("value"),d!=null?uy(l,Y,Oi(d)):_!=null?uy(l,Y,Oi(_)):S!=null&&l.removeAttribute("value"),x==null&&P!=null&&(l.defaultChecked=!!P),x!=null&&(l.checked=x&&typeof x!="function"&&typeof x!="symbol"),ne!=null&&typeof ne!="function"&&typeof ne!="symbol"&&typeof ne!="boolean"?l.name=""+Oi(ne):l.removeAttribute("name")}function sT(l,d,_,S,x,P,Y,ne){if(P!=null&&typeof P!="function"&&typeof P!="symbol"&&typeof P!="boolean"&&(l.type=P),d!=null||_!=null){if(!(P!=="submit"&&P!=="reset"||d!=null)){qn(l);return}_=_!=null?""+Oi(_):"",d=d!=null?""+Oi(d):_,ne||d===l.value||(l.value=d),l.defaultValue=d}S=S??x,S=typeof S!="function"&&typeof S!="symbol"&&!!S,l.checked=ne?l.checked:!!S,l.defaultChecked=!!S,Y!=null&&typeof Y!="function"&&typeof Y!="symbol"&&typeof Y!="boolean"&&(l.name=Y),qn(l)}function uy(l,d,_){d==="number"&&Sf(l.ownerDocument)===l||l.defaultValue===""+_||(l.defaultValue=""+_)}function Id(l,d,_,S){if(l=l.options,d){d={};for(var x=0;x<_.length;x++)d["$"+_[x]]=!0;for(_=0;_<l.length;_++)x=d.hasOwnProperty("$"+l[_].value),l[_].selected!==x&&(l[_].selected=x),x&&S&&(l[_].defaultSelected=!0)}else{for(_=""+Oi(_),d=null,x=0;x<l.length;x++){if(l[x].value===_){l[x].selected=!0,S&&(l[x].defaultSelected=!0);return}d!==null||l[x].disabled||(d=l[x])}d!==null&&(d.selected=!0)}}function oT(l,d,_){if(d!=null&&(d=""+Oi(d),d!==l.value&&(l.value=d),_==null)){l.defaultValue!==d&&(l.defaultValue=d);return}l.defaultValue=_!=null?""+Oi(_):""}function jm(l,d,_,S){if(d==null){if(S!=null){if(_!=null)throw Error(c(92));if(rt(S)){if(1<S.length)throw Error(c(93));S=S[0]}_=S}_==null&&(_=""),d=_}_=Oi(d),l.defaultValue=_,S=l.textContent,S===_&&S!==""&&S!==null&&(l.value=S),qn(l)}function ru(l,d){if(d){var _=l.firstChild;if(_&&_===l.lastChild&&_.nodeType===3){_.nodeValue=d;return}}l.textContent=d}var dy=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function cT(l,d,_){var S=d.indexOf("--")===0;_==null||typeof _=="boolean"||_===""?S?l.setProperty(d,""):d==="float"?l.cssFloat="":l[d]="":S?l.setProperty(d,_):typeof _!="number"||_===0||dy.has(d)?d==="float"?l.cssFloat=_:l[d]=(""+_).trim():l[d]=_+"px"}function Vm(l,d,_){if(d!=null&&typeof d!="object")throw Error(c(62));if(l=l.style,_!=null){for(var S in _)!_.hasOwnProperty(S)||d!=null&&d.hasOwnProperty(S)||(S.indexOf("--")===0?l.setProperty(S,""):S==="float"?l.cssFloat="":l[S]="");for(var x in d)S=d[x],d.hasOwnProperty(x)&&_[x]!==S&&cT(l,x,S)}else for(var P in d)d.hasOwnProperty(P)&&cT(l,P,d[P])}function hy(l){if(l.indexOf("-")===-1)return!1;switch(l){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var lT=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),pN=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Bm(l){return pN.test(""+l)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":l}function rc(){}var fy=null;function py(l){return l=l.target||l.srcElement||window,l.correspondingUseElement&&(l=l.correspondingUseElement),l.nodeType===3?l.parentNode:l}var Nd=null,xd=null;function uT(l){var d=Cd(l);if(d&&(l=d.stateNode)){var _=l[va]||null;e:switch(l=d.stateNode,d.type){case"input":if(ly(l,_.value,_.defaultValue,_.defaultValue,_.checked,_.defaultChecked,_.type,_.name),d=_.name,_.type==="radio"&&d!=null){for(_=l;_.parentNode;)_=_.parentNode;for(_=_.querySelectorAll('input[name="'+rs(""+d)+'"][type="radio"]'),d=0;d<_.length;d++){var S=_[d];if(S!==l&&S.form===l.form){var x=S[va]||null;if(!x)throw Error(c(90));ly(S,x.value,x.defaultValue,x.defaultValue,x.checked,x.defaultChecked,x.type,x.name)}}for(d=0;d<_.length;d++)S=_[d],S.form===l.form&&iT(S)}break e;case"textarea":oT(l,_.value,_.defaultValue);break e;case"select":d=_.value,d!=null&&Id(l,!!_.multiple,d,!1)}}}var Fm=!1;function dT(l,d,_){if(Fm)return l(d,_);Fm=!0;try{var S=l(d);return S}finally{if(Fm=!1,(Nd!==null||xd!==null)&&(_h(),Nd&&(d=Nd,l=xd,xd=Nd=null,uT(d),l)))for(d=0;d<l.length;d++)uT(l[d])}}function bf(l,d){var _=l.stateNode;if(_===null)return null;var S=_[va]||null;if(S===null)return null;_=S[d];e:switch(d){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(S=!S.disabled)||(l=l.type,S=!(l==="button"||l==="input"||l==="select"||l==="textarea")),l=!S;break e;default:l=!1}if(l)return null;if(_&&typeof _!="function")throw Error(c(231,d,typeof _));return _}var ic=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),iu=!1;if(ic)try{var Tf={};Object.defineProperty(Tf,"passive",{get:function(){iu=!0}}),window.addEventListener("test",Tf,Tf),window.removeEventListener("test",Tf,Tf)}catch{iu=!1}var al=null,my=null,Gm=null;function gy(){if(Gm)return Gm;var l,d=my,_=d.length,S,x="value"in al?al.value:al.textContent,P=x.length;for(l=0;l<_&&d[l]===x[l];l++);var Y=_-l;for(S=1;S<=Y&&d[_-S]===x[P-S];S++);return Gm=x.slice(l,1<S?1-S:void 0)}function Hm(l){var d=l.keyCode;return"charCode"in l?(l=l.charCode,l===0&&d===13&&(l=13)):l=d,l===10&&(l=13),32<=l||l===13?l:0}function Wm(){return!0}function hT(){return!1}function Vr(l){function d(_,S,x,P,Y){this._reactName=_,this._targetInst=x,this.type=S,this.nativeEvent=P,this.target=Y,this.currentTarget=null;for(var ne in l)l.hasOwnProperty(ne)&&(_=l[ne],this[ne]=_?_(P):P[ne]);return this.isDefaultPrevented=(P.defaultPrevented!=null?P.defaultPrevented:P.returnValue===!1)?Wm:hT,this.isPropagationStopped=hT,this}return I(d.prototype,{preventDefault:function(){this.defaultPrevented=!0;var _=this.nativeEvent;_&&(_.preventDefault?_.preventDefault():typeof _.returnValue!="unknown"&&(_.returnValue=!1),this.isDefaultPrevented=Wm)},stopPropagation:function(){var _=this.nativeEvent;_&&(_.stopPropagation?_.stopPropagation():typeof _.cancelBubble!="unknown"&&(_.cancelBubble=!0),this.isPropagationStopped=Wm)},persist:function(){},isPersistent:Wm}),d}var _i={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(l){return l.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},wf=Vr(_i),Rf=I({},_i,{view:0,detail:0}),mN=Vr(Rf),_y,Ii,Cf,zm=I({},Rf,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Sy,button:0,buttons:0,relatedTarget:function(l){return l.relatedTarget===void 0?l.fromElement===l.srcElement?l.toElement:l.fromElement:l.relatedTarget},movementX:function(l){return"movementX"in l?l.movementX:(l!==Cf&&(Cf&&l.type==="mousemove"?(_y=l.screenX-Cf.screenX,Ii=l.screenY-Cf.screenY):Ii=_y=0,Cf=l),_y)},movementY:function(l){return"movementY"in l?l.movementY:Ii}}),fT=Vr(zm),Km=I({},zm,{dataTransfer:0}),pT=Vr(Km),gN=I({},Rf,{relatedTarget:0}),Af=Vr(gN),_N=I({},_i,{animationName:0,elapsedTime:0,pseudoElement:0}),vy=Vr(_N),yy=I({},_i,{clipboardData:function(l){return"clipboardData"in l?l.clipboardData:window.clipboardData}}),Ey=Vr(yy),vN=I({},_i,{data:0}),mT=Vr(vN),au={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Of={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},yN={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function EN(l){var d=this.nativeEvent;return d.getModifierState?d.getModifierState(l):(l=yN[l])?!!d[l]:!1}function Sy(){return EN}var SN=I({},Rf,{key:function(l){if(l.key){var d=au[l.key]||l.key;if(d!=="Unidentified")return d}return l.type==="keypress"?(l=Hm(l),l===13?"Enter":String.fromCharCode(l)):l.type==="keydown"||l.type==="keyup"?Of[l.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Sy,charCode:function(l){return l.type==="keypress"?Hm(l):0},keyCode:function(l){return l.type==="keydown"||l.type==="keyup"?l.keyCode:0},which:function(l){return l.type==="keypress"?Hm(l):l.type==="keydown"||l.type==="keyup"?l.keyCode:0}}),bN=Vr(SN),Dd=I({},zm,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),gT=Vr(Dd),Pd=I({},Rf,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Sy}),_T=Vr(Pd),TN=I({},_i,{propertyName:0,elapsedTime:0,pseudoElement:0}),Jt=Vr(TN),wN=I({},zm,{deltaX:function(l){return"deltaX"in l?l.deltaX:"wheelDeltaX"in l?-l.wheelDeltaX:0},deltaY:function(l){return"deltaY"in l?l.deltaY:"wheelDeltaY"in l?-l.wheelDeltaY:"wheelDelta"in l?-l.wheelDelta:0},deltaZ:0,deltaMode:0}),RN=Vr(wN),CN=I({},_i,{newState:0,oldState:0}),AN=Vr(CN),by=[9,13,27,32],Ty=ic&&"CompositionEvent"in window,If=null;ic&&"documentMode"in document&&(If=document.documentMode);var ON=ic&&"TextEvent"in window&&!If,Ym=ic&&(!Ty||If&&8<If&&11>=If),vT=" ",yT=!1;function wy(l,d){switch(l){case"keyup":return by.indexOf(d.keyCode)!==-1;case"keydown":return d.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ET(l){return l=l.detail,typeof l=="object"&&"data"in l?l.data:null}var Ua=!1;function IN(l,d){switch(l){case"compositionend":return ET(d);case"keypress":return d.which!==32?null:(yT=!0,vT);case"textInput":return l=d.data,l===vT&&yT?null:l;default:return null}}function NN(l,d){if(Ua)return l==="compositionend"||!Ty&&wy(l,d)?(l=gy(),Gm=my=al=null,Ua=!1,l):null;switch(l){case"paste":return null;case"keypress":if(!(d.ctrlKey||d.altKey||d.metaKey)||d.ctrlKey&&d.altKey){if(d.char&&1<d.char.length)return d.char;if(d.which)return String.fromCharCode(d.which)}return null;case"compositionend":return Ym&&d.locale!=="ko"?null:d.data;default:return null}}var xN={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ry(l){var d=l&&l.nodeName&&l.nodeName.toLowerCase();return d==="input"?!!xN[l.type]:d==="textarea"}function qm(l,d,_,S){Nd?xd?xd.push(S):xd=[S]:Nd=S,d=Du(d,"onChange"),0<d.length&&(_=new wf("onChange","change",null,_,S),l.push({event:_,listeners:d}))}var Nf=null,xf=null;function DN(l){xu(l,0)}function ia(l){var d=ya(l);if(iT(d))return l}function ST(l,d){if(l==="change")return d}var bT=!1;if(ic){var Cy;if(ic){var Ay="oninput"in document;if(!Ay){var Oy=document.createElement("div");Oy.setAttribute("oninput","return;"),Ay=typeof Oy.oninput=="function"}Cy=Ay}else Cy=!1;bT=Cy&&(!document.documentMode||9<document.documentMode)}function TT(){Nf&&(Nf.detachEvent("onpropertychange",wT),xf=Nf=null)}function wT(l){if(l.propertyName==="value"&&ia(xf)){var d=[];qm(d,xf,l,py(l)),dT(DN,d)}}function RT(l,d,_){l==="focusin"?(TT(),Nf=d,xf=_,Nf.attachEvent("onpropertychange",wT)):l==="focusout"&&TT()}function Iy(l){if(l==="selectionchange"||l==="keyup"||l==="keydown")return ia(xf)}function PN(l,d){if(l==="click")return ia(d)}function kN(l,d){if(l==="input"||l==="change")return ia(d)}function Xm(l,d){return l===d&&(l!==0||1/l===1/d)||l!==l&&d!==d}var ja=typeof Object.is=="function"?Object.is:Xm;function Df(l,d){if(ja(l,d))return!0;if(typeof l!="object"||l===null||typeof d!="object"||d===null)return!1;var _=Object.keys(l),S=Object.keys(d);if(_.length!==S.length)return!1;for(S=0;S<_.length;S++){var x=_[S];if(!ra.call(d,x)||!ja(l[x],d[x]))return!1}return!0}function CT(l){for(;l&&l.firstChild;)l=l.firstChild;return l}function ac(l,d){var _=CT(l);l=0;for(var S;_;){if(_.nodeType===3){if(S=l+_.textContent.length,l<=d&&S>=d)return{node:_,offset:d-l};l=S}e:{for(;_;){if(_.nextSibling){_=_.nextSibling;break e}_=_.parentNode}_=void 0}_=CT(_)}}function AT(l,d){return l&&d?l===d?!0:l&&l.nodeType===3?!1:d&&d.nodeType===3?AT(l,d.parentNode):"contains"in l?l.contains(d):l.compareDocumentPosition?!!(l.compareDocumentPosition(d)&16):!1:!1}function OT(l){l=l!=null&&l.ownerDocument!=null&&l.ownerDocument.defaultView!=null?l.ownerDocument.defaultView:window;for(var d=Sf(l.document);d instanceof l.HTMLIFrameElement;){try{var _=typeof d.contentWindow.location.href=="string"}catch{_=!1}if(_)l=d.contentWindow;else break;d=Sf(l.document)}return d}function Hi(l){var d=l&&l.nodeName&&l.nodeName.toLowerCase();return d&&(d==="input"&&(l.type==="text"||l.type==="search"||l.type==="tel"||l.type==="url"||l.type==="password")||d==="textarea"||l.contentEditable==="true")}var LN=ic&&"documentMode"in document&&11>=document.documentMode,kd=null,Ny=null,Pf=null,Jm=!1;function IT(l,d,_){var S=_.window===_?_.document:_.nodeType===9?_:_.ownerDocument;Jm||kd==null||kd!==Sf(S)||(S=kd,"selectionStart"in S&&Hi(S)?S={start:S.selectionStart,end:S.selectionEnd}:(S=(S.ownerDocument&&S.ownerDocument.defaultView||window).getSelection(),S={anchorNode:S.anchorNode,anchorOffset:S.anchorOffset,focusNode:S.focusNode,focusOffset:S.focusOffset}),Pf&&Df(Pf,S)||(Pf=S,S=Du(Ny,"onSelect"),0<S.length&&(d=new wf("onSelect","select",null,d,_),l.push({event:d,listeners:S}),d.target=kd)))}function su(l,d){var _={};return _[l.toLowerCase()]=d.toLowerCase(),_["Webkit"+l]="webkit"+d,_["Moz"+l]="moz"+d,_}var Ld={animationend:su("Animation","AnimationEnd"),animationiteration:su("Animation","AnimationIteration"),animationstart:su("Animation","AnimationStart"),transitionrun:su("Transition","TransitionRun"),transitionstart:su("Transition","TransitionStart"),transitioncancel:su("Transition","TransitionCancel"),transitionend:su("Transition","TransitionEnd")},$m={},NT={};ic&&(NT=document.createElement("div").style,"AnimationEvent"in window||(delete Ld.animationend.animation,delete Ld.animationiteration.animation,delete Ld.animationstart.animation),"TransitionEvent"in window||delete Ld.transitionend.transition);function ou(l){if($m[l])return $m[l];if(!Ld[l])return l;var d=Ld[l],_;for(_ in d)if(d.hasOwnProperty(_)&&_ in NT)return $m[l]=d[_];return l}var Zm=ou("animationend"),Qm=ou("animationiteration"),xT=ou("animationstart"),je=ou("transitionrun"),MN=ou("transitionstart"),UN=ou("transitioncancel"),DT=ou("transitionend"),PT=new Map,eg="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");eg.push("scrollEnd");function is(l,d){PT.set(l,d),nu(d,[l])}var tg=typeof reportError=="function"?reportError:function(l){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var d=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof l=="object"&&l!==null&&typeof l.message=="string"?String(l.message):String(l),error:l});if(!window.dispatchEvent(d))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",l);return}console.error(l)},as=[],Md=0,Ud=0;function sl(){for(var l=Md,d=Ud=Md=0;d<l;){var _=as[d];as[d++]=null;var S=as[d];as[d++]=null;var x=as[d];as[d++]=null;var P=as[d];if(as[d++]=null,S!==null&&x!==null){var Y=S.pending;Y===null?x.next=x:(x.next=Y.next,Y.next=x),S.pending=x}P!==0&&rg(_,x,P)}}function ng(l,d,_,S){as[Md++]=l,as[Md++]=d,as[Md++]=_,as[Md++]=S,Ud|=S,l.lanes|=S,l=l.alternate,l!==null&&(l.lanes|=S)}function xy(l,d,_,S){return ng(l,d,_,S),cu(l)}function lo(l,d){return ng(l,null,null,d),cu(l)}function rg(l,d,_){l.lanes|=_;var S=l.alternate;S!==null&&(S.lanes|=_);for(var x=!1,P=l.return;P!==null;)P.childLanes|=_,S=P.alternate,S!==null&&(S.childLanes|=_),P.tag===22&&(l=P.stateNode,l===null||l._visibility&1||(x=!0)),l=P,P=P.return;return l.tag===3?(P=l.stateNode,x&&d!==null&&(x=31-Ma(_),l=P.hiddenUpdates,S=l[x],S===null?l[x]=[d]:S.push(d),d.lane=_|536870912),P):null}function cu(l){if(50<mo)throw mo=0,Rc=null,Error(c(185));for(var d=l.return;d!==null;)l=d,d=l.return;return l.tag===3?l.stateNode:null}var jd={};function jN(l,d,_,S){this.tag=l,this.key=_,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=d,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=S,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Va(l,d,_,S){return new jN(l,d,_,S)}function Dy(l){return l=l.prototype,!(!l||!l.isReactComponent)}function Ds(l,d){var _=l.alternate;return _===null?(_=Va(l.tag,d,l.key,l.mode),_.elementType=l.elementType,_.type=l.type,_.stateNode=l.stateNode,_.alternate=l,l.alternate=_):(_.pendingProps=d,_.type=l.type,_.flags=0,_.subtreeFlags=0,_.deletions=null),_.flags=l.flags&65011712,_.childLanes=l.childLanes,_.lanes=l.lanes,_.child=l.child,_.memoizedProps=l.memoizedProps,_.memoizedState=l.memoizedState,_.updateQueue=l.updateQueue,d=l.dependencies,_.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext},_.sibling=l.sibling,_.index=l.index,_.ref=l.ref,_.refCleanup=l.refCleanup,_}function kT(l,d){l.flags&=65011714;var _=l.alternate;return _===null?(l.childLanes=0,l.lanes=d,l.child=null,l.subtreeFlags=0,l.memoizedProps=null,l.memoizedState=null,l.updateQueue=null,l.dependencies=null,l.stateNode=null):(l.childLanes=_.childLanes,l.lanes=_.lanes,l.child=_.child,l.subtreeFlags=0,l.deletions=null,l.memoizedProps=_.memoizedProps,l.memoizedState=_.memoizedState,l.updateQueue=_.updateQueue,l.type=_.type,d=_.dependencies,l.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext}),l}function kf(l,d,_,S,x,P){var Y=0;if(S=l,typeof l=="function")Dy(l)&&(Y=1);else if(typeof l=="string")Y=Ex(l,_,dt.current)?26:l==="html"||l==="head"||l==="body"?27:5;else e:switch(l){case Ae:return l=Va(31,_,d,x),l.elementType=Ae,l.lanes=P,l;case W:return vi(_.children,x,P,d);case G:Y=8,x|=24;break;case $:return l=Va(12,_,d,x|2),l.elementType=$,l.lanes=P,l;case se:return l=Va(13,_,d,x),l.elementType=se,l.lanes=P,l;case de:return l=Va(19,_,d,x),l.elementType=de,l.lanes=P,l;default:if(typeof l=="object"&&l!==null)switch(l.$$typeof){case Z:Y=10;break e;case te:Y=9;break e;case ce:Y=11;break e;case oe:Y=14;break e;case ge:Y=16,S=null;break e}Y=29,_=Error(c(130,l===null?"null":typeof l,"")),S=null}return d=Va(Y,_,d,x),d.elementType=l,d.type=S,d.lanes=P,d}function vi(l,d,_,S){return l=Va(7,l,S,d),l.lanes=_,l}function Py(l,d,_){return l=Va(6,l,null,d),l.lanes=_,l}function Vd(l){var d=Va(18,null,null,0);return d.stateNode=l,d}function ky(l,d,_){return d=Va(4,l.children!==null?l.children:[],l.key,d),d.lanes=_,d.stateNode={containerInfo:l.containerInfo,pendingChildren:null,implementation:l.implementation},d}var LT=new WeakMap;function ss(l,d){if(typeof l=="object"&&l!==null){var _=LT.get(l);return _!==void 0?_:(d={value:l,source:d,stack:Ur(d)},LT.set(l,d),d)}return{value:l,source:d,stack:Ur(d)}}var lu=[],Bd=0,ig=null,Lf=0,Ea=[],os=0,sc=null,Ps=1,uo="";function ho(l,d){lu[Bd++]=Lf,lu[Bd++]=ig,ig=l,Lf=d}function Mf(l,d,_){Ea[os++]=Ps,Ea[os++]=uo,Ea[os++]=sc,sc=l;var S=Ps;l=uo;var x=32-Ma(S)-1;S&=~(1<<x),_+=1;var P=32-Ma(d)+x;if(30<P){var Y=x-x%5;P=(S&(1<<Y)-1).toString(32),S>>=Y,x-=Y,Ps=1<<32-Ma(d)+x|_<<x|S,uo=P+l}else Ps=1<<P|_<<x|S,uo=l}function Ly(l){l.return!==null&&(ho(l,1),Mf(l,1,0))}function My(l){for(;l===ig;)ig=lu[--Bd],lu[Bd]=null,Lf=lu[--Bd],lu[Bd]=null;for(;l===sc;)sc=Ea[--os],Ea[os]=null,uo=Ea[--os],Ea[os]=null,Ps=Ea[--os],Ea[os]=null}function MT(l,d){Ea[os++]=Ps,Ea[os++]=uo,Ea[os++]=sc,Ps=d.id,uo=d.overflow,sc=l}var Ni=null,lr=null,Sn=!1,fo=null,cs=!1,Uf=Error(c(519));function ol(l){var d=Error(c(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw jf(ss(d,l)),Uf}function UT(l){var d=l.stateNode,_=l.type,S=l.memoizedProps;switch(d[mi]=l,d[va]=S,_){case"dialog":dn("cancel",d),dn("close",d);break;case"iframe":case"object":case"embed":dn("load",d);break;case"video":case"audio":for(_=0;_<lp.length;_++)dn(lp[_],d);break;case"source":dn("error",d);break;case"img":case"image":case"link":dn("error",d),dn("load",d);break;case"details":dn("toggle",d);break;case"input":dn("invalid",d),sT(d,S.value,S.defaultValue,S.checked,S.defaultChecked,S.type,S.name,!0);break;case"select":dn("invalid",d);break;case"textarea":dn("invalid",d),jm(d,S.value,S.defaultValue,S.children)}_=S.children,typeof _!="string"&&typeof _!="number"&&typeof _!="bigint"||d.textContent===""+_||S.suppressHydrationWarning===!0||rR(d.textContent,_)?(S.popover!=null&&(dn("beforetoggle",d),dn("toggle",d)),S.onScroll!=null&&dn("scroll",d),S.onScrollEnd!=null&&dn("scrollend",d),S.onClick!=null&&(d.onclick=rc),d=!0):d=!1,d||ol(l,!0)}function jT(l){for(Ni=l.return;Ni;)switch(Ni.tag){case 5:case 31:case 13:cs=!1;return;case 27:case 3:cs=!0;return;default:Ni=Ni.return}}function Fd(l){if(l!==Ni)return!1;if(!Sn)return jT(l),Sn=!0,!1;var d=l.tag,_;if((_=d!==3&&d!==27)&&((_=d===5)&&(_=l.type,_=!(_!=="form"&&_!=="button")||n0(l.type,l.memoizedProps)),_=!_),_&&lr&&ol(l),jT(l),d===13){if(l=l.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(c(317));lr=hR(l)}else if(d===31){if(l=l.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(c(317));lr=hR(l)}else d===27?(d=lr,Tl(l.type)?(l=o0,o0=null,lr=l):lr=d):lr=Ni?ps(l.stateNode.nextSibling):null;return!0}function uu(){lr=Ni=null,Sn=!1}function Uy(){var l=fo;return l!==null&&(Ki===null?Ki=l:Ki.push.apply(Ki,l),fo=null),l}function jf(l){fo===null?fo=[l]:fo.push(l)}var jy=me(null),du=null,oc=null;function cl(l,d,_){it(jy,d._currentValue),d._currentValue=_}function ls(l){l._currentValue=jy.current,Ve(jy)}function Gd(l,d,_){for(;l!==null;){var S=l.alternate;if((l.childLanes&d)!==d?(l.childLanes|=d,S!==null&&(S.childLanes|=d)):S!==null&&(S.childLanes&d)!==d&&(S.childLanes|=d),l===_)break;l=l.return}}function Vf(l,d,_,S){var x=l.child;for(x!==null&&(x.return=l);x!==null;){var P=x.dependencies;if(P!==null){var Y=x.child;P=P.firstContext;e:for(;P!==null;){var ne=P;P=x;for(var pe=0;pe<d.length;pe++)if(ne.context===d[pe]){P.lanes|=_,ne=P.alternate,ne!==null&&(ne.lanes|=_),Gd(P.return,_,l),S||(Y=null);break e}P=ne.next}}else if(x.tag===18){if(Y=x.return,Y===null)throw Error(c(341));Y.lanes|=_,P=Y.alternate,P!==null&&(P.lanes|=_),Gd(Y,_,l),Y=null}else Y=x.child;if(Y!==null)Y.return=x;else for(Y=x;Y!==null;){if(Y===l){Y=null;break}if(x=Y.sibling,x!==null){x.return=Y.return,Y=x;break}Y=Y.return}x=Y}}function Hd(l,d,_,S){l=null;for(var x=d,P=!1;x!==null;){if(!P){if((x.flags&524288)!==0)P=!0;else if((x.flags&262144)!==0)break}if(x.tag===10){var Y=x.alternate;if(Y===null)throw Error(c(387));if(Y=Y.memoizedProps,Y!==null){var ne=x.type;ja(x.pendingProps.value,Y.value)||(l!==null?l.push(ne):l=[ne])}}else if(x===En.current){if(Y=x.alternate,Y===null)throw Error(c(387));Y.memoizedState.memoizedState!==x.memoizedState.memoizedState&&(l!==null?l.push(mp):l=[mp])}x=x.return}l!==null&&Vf(d,l,_,S),d.flags|=262144}function ag(l){for(l=l.firstContext;l!==null;){if(!ja(l.context._currentValue,l.memoizedValue))return!0;l=l.next}return!1}function hu(l){du=l,oc=null,l=l.dependencies,l!==null&&(l.firstContext=null)}function yi(l){return sg(du,l)}function Bf(l,d){return du===null&&hu(l),sg(l,d)}function sg(l,d){var _=d._currentValue;if(d={context:d,memoizedValue:_,next:null},oc===null){if(l===null)throw Error(c(308));oc=d,l.dependencies={lanes:0,firstContext:d},l.flags|=524288}else oc=oc.next=d;return _}var VN=typeof AbortController<"u"?AbortController:function(){var l=[],d=this.signal={aborted:!1,addEventListener:function(_,S){l.push(S)}};this.abort=function(){d.aborted=!0,l.forEach(function(_){return _()})}},BN=n.unstable_scheduleCallback,Ff=n.unstable_NormalPriority,qr={$$typeof:Z,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Vy(){return{controller:new VN,data:new Map,refCount:0}}function Gf(l){l.refCount--,l.refCount===0&&BN(Ff,function(){l.controller.abort()})}var Hf=null,By=0,Wd=0,fu=null;function FN(l,d){if(Hf===null){var _=Hf=[];By=0,Wd=KE(),fu={status:"pending",value:void 0,then:function(S){_.push(S)}}}return By++,d.then(VT,VT),d}function VT(){if(--By===0&&Hf!==null){fu!==null&&(fu.status="fulfilled");var l=Hf;Hf=null,Wd=0,fu=null;for(var d=0;d<l.length;d++)(0,l[d])()}}function GN(l,d){var _=[],S={status:"pending",value:null,reason:null,then:function(x){_.push(x)}};return l.then(function(){S.status="fulfilled",S.value=d;for(var x=0;x<_.length;x++)(0,_[x])(d)},function(x){for(S.status="rejected",S.reason=x,x=0;x<_.length;x++)(0,_[x])(void 0)}),S}var og=he.S;he.S=function(l,d){jw=Yn(),typeof d=="object"&&d!==null&&typeof d.then=="function"&&FN(l,d),og!==null&&og(l,d)};var pu=me(null);function Fy(){var l=pu.current;return l!==null?l:Zn.pooledCache}function mu(l,d){d===null?it(pu,pu.current):it(pu,d.pool)}function BT(){var l=Fy();return l===null?null:{parent:qr._currentValue,pool:l}}var zd=Error(c(460)),Gy=Error(c(474)),cg=Error(c(542)),lg={then:function(){}};function FT(l){return l=l.status,l==="fulfilled"||l==="rejected"}function Wf(l,d,_){switch(_=l[_],_===void 0?l.push(d):_!==d&&(d.then(rc,rc),d=_),d.status){case"fulfilled":return d.value;case"rejected":throw l=d.reason,Hy(l),l;default:if(typeof d.status=="string")d.then(rc,rc);else{if(l=Zn,l!==null&&100<l.shellSuspendCounter)throw Error(c(482));l=d,l.status="pending",l.then(function(S){if(d.status==="pending"){var x=d;x.status="fulfilled",x.value=S}},function(S){if(d.status==="pending"){var x=d;x.status="rejected",x.reason=S}})}switch(d.status){case"fulfilled":return d.value;case"rejected":throw l=d.reason,Hy(l),l}throw gu=d,zd}}function ll(l){try{var d=l._init;return d(l._payload)}catch(_){throw _!==null&&typeof _=="object"&&typeof _.then=="function"?(gu=_,zd):_}}var gu=null;function GT(){if(gu===null)throw Error(c(459));var l=gu;return gu=null,l}function Hy(l){if(l===zd||l===cg)throw Error(c(483))}var Kd=null,zf=0;function ug(l){var d=zf;return zf+=1,Kd===null&&(Kd=[]),Wf(Kd,l,d)}function _u(l,d){d=d.props.ref,l.ref=d!==void 0?d:null}function Yd(l,d){throw d.$$typeof===D?Error(c(525)):(l=Object.prototype.toString.call(d),Error(c(31,l==="[object Object]"?"object with keys {"+Object.keys(d).join(", ")+"}":l)))}function Wy(l){function d(Ce,Se){if(l){var Oe=Ce.deletions;Oe===null?(Ce.deletions=[Se],Ce.flags|=16):Oe.push(Se)}}function _(Ce,Se){if(!l)return null;for(;Se!==null;)d(Ce,Se),Se=Se.sibling;return null}function S(Ce){for(var Se=new Map;Ce!==null;)Ce.key!==null?Se.set(Ce.key,Ce):Se.set(Ce.index,Ce),Ce=Ce.sibling;return Se}function x(Ce,Se){return Ce=Ds(Ce,Se),Ce.index=0,Ce.sibling=null,Ce}function P(Ce,Se,Oe){return Ce.index=Oe,l?(Oe=Ce.alternate,Oe!==null?(Oe=Oe.index,Oe<Se?(Ce.flags|=67108866,Se):Oe):(Ce.flags|=67108866,Se)):(Ce.flags|=1048576,Se)}function Y(Ce){return l&&Ce.alternate===null&&(Ce.flags|=67108866),Ce}function ne(Ce,Se,Oe,Ke){return Se===null||Se.tag!==6?(Se=Py(Oe,Ce.mode,Ke),Se.return=Ce,Se):(Se=x(Se,Oe),Se.return=Ce,Se)}function pe(Ce,Se,Oe,Ke){var Nt=Oe.type;return Nt===W?We(Ce,Se,Oe.props.children,Ke,Oe.key):Se!==null&&(Se.elementType===Nt||typeof Nt=="object"&&Nt!==null&&Nt.$$typeof===ge&&ll(Nt)===Se.type)?(Se=x(Se,Oe.props),_u(Se,Oe),Se.return=Ce,Se):(Se=kf(Oe.type,Oe.key,Oe.props,null,Ce.mode,Ke),_u(Se,Oe),Se.return=Ce,Se)}function Pe(Ce,Se,Oe,Ke){return Se===null||Se.tag!==4||Se.stateNode.containerInfo!==Oe.containerInfo||Se.stateNode.implementation!==Oe.implementation?(Se=ky(Oe,Ce.mode,Ke),Se.return=Ce,Se):(Se=x(Se,Oe.children||[]),Se.return=Ce,Se)}function We(Ce,Se,Oe,Ke,Nt){return Se===null||Se.tag!==7?(Se=vi(Oe,Ce.mode,Ke,Nt),Se.return=Ce,Se):(Se=x(Se,Oe),Se.return=Ce,Se)}function Ze(Ce,Se,Oe){if(typeof Se=="string"&&Se!==""||typeof Se=="number"||typeof Se=="bigint")return Se=Py(""+Se,Ce.mode,Oe),Se.return=Ce,Se;if(typeof Se=="object"&&Se!==null){switch(Se.$$typeof){case L:return Oe=kf(Se.type,Se.key,Se.props,null,Ce.mode,Oe),_u(Oe,Se),Oe.return=Ce,Oe;case F:return Se=ky(Se,Ce.mode,Oe),Se.return=Ce,Se;case ge:return Se=ll(Se),Ze(Ce,Se,Oe)}if(rt(Se)||be(Se))return Se=vi(Se,Ce.mode,Oe,null),Se.return=Ce,Se;if(typeof Se.then=="function")return Ze(Ce,ug(Se),Oe);if(Se.$$typeof===Z)return Ze(Ce,Bf(Ce,Se),Oe);Yd(Ce,Se)}return null}function Me(Ce,Se,Oe,Ke){var Nt=Se!==null?Se.key:null;if(typeof Oe=="string"&&Oe!==""||typeof Oe=="number"||typeof Oe=="bigint")return Nt!==null?null:ne(Ce,Se,""+Oe,Ke);if(typeof Oe=="object"&&Oe!==null){switch(Oe.$$typeof){case L:return Oe.key===Nt?pe(Ce,Se,Oe,Ke):null;case F:return Oe.key===Nt?Pe(Ce,Se,Oe,Ke):null;case ge:return Oe=ll(Oe),Me(Ce,Se,Oe,Ke)}if(rt(Oe)||be(Oe))return Nt!==null?null:We(Ce,Se,Oe,Ke,null);if(typeof Oe.then=="function")return Me(Ce,Se,ug(Oe),Ke);if(Oe.$$typeof===Z)return Me(Ce,Se,Bf(Ce,Oe),Ke);Yd(Ce,Oe)}return null}function Be(Ce,Se,Oe,Ke,Nt){if(typeof Ke=="string"&&Ke!==""||typeof Ke=="number"||typeof Ke=="bigint")return Ce=Ce.get(Oe)||null,ne(Se,Ce,""+Ke,Nt);if(typeof Ke=="object"&&Ke!==null){switch(Ke.$$typeof){case L:return Ce=Ce.get(Ke.key===null?Oe:Ke.key)||null,pe(Se,Ce,Ke,Nt);case F:return Ce=Ce.get(Ke.key===null?Oe:Ke.key)||null,Pe(Se,Ce,Ke,Nt);case ge:return Ke=ll(Ke),Be(Ce,Se,Oe,Ke,Nt)}if(rt(Ke)||be(Ke))return Ce=Ce.get(Oe)||null,We(Se,Ce,Ke,Nt,null);if(typeof Ke.then=="function")return Be(Ce,Se,Oe,ug(Ke),Nt);if(Ke.$$typeof===Z)return Be(Ce,Se,Oe,Bf(Se,Ke),Nt);Yd(Se,Ke)}return null}function Et(Ce,Se,Oe,Ke){for(var Nt=null,xn=null,wt=Se,an=Se=0,Tn=null;wt!==null&&an<Oe.length;an++){wt.index>an?(Tn=wt,wt=null):Tn=wt.sibling;var Ln=Me(Ce,wt,Oe[an],Ke);if(Ln===null){wt===null&&(wt=Tn);break}l&&wt&&Ln.alternate===null&&d(Ce,wt),Se=P(Ln,Se,an),xn===null?Nt=Ln:xn.sibling=Ln,xn=Ln,wt=Tn}if(an===Oe.length)return _(Ce,wt),Sn&&ho(Ce,an),Nt;if(wt===null){for(;an<Oe.length;an++)wt=Ze(Ce,Oe[an],Ke),wt!==null&&(Se=P(wt,Se,an),xn===null?Nt=wt:xn.sibling=wt,xn=wt);return Sn&&ho(Ce,an),Nt}for(wt=S(wt);an<Oe.length;an++)Tn=Be(wt,Ce,an,Oe[an],Ke),Tn!==null&&(l&&Tn.alternate!==null&&wt.delete(Tn.key===null?an:Tn.key),Se=P(Tn,Se,an),xn===null?Nt=Tn:xn.sibling=Tn,xn=Tn);return l&&wt.forEach(function(_o){return d(Ce,_o)}),Sn&&ho(Ce,an),Nt}function Pt(Ce,Se,Oe,Ke){if(Oe==null)throw Error(c(151));for(var Nt=null,xn=null,wt=Se,an=Se=0,Tn=null,Ln=Oe.next();wt!==null&&!Ln.done;an++,Ln=Oe.next()){wt.index>an?(Tn=wt,wt=null):Tn=wt.sibling;var _o=Me(Ce,wt,Ln.value,Ke);if(_o===null){wt===null&&(wt=Tn);break}l&&wt&&_o.alternate===null&&d(Ce,wt),Se=P(_o,Se,an),xn===null?Nt=_o:xn.sibling=_o,xn=_o,wt=Tn}if(Ln.done)return _(Ce,wt),Sn&&ho(Ce,an),Nt;if(wt===null){for(;!Ln.done;an++,Ln=Oe.next())Ln=Ze(Ce,Ln.value,Ke),Ln!==null&&(Se=P(Ln,Se,an),xn===null?Nt=Ln:xn.sibling=Ln,xn=Ln);return Sn&&ho(Ce,an),Nt}for(wt=S(wt);!Ln.done;an++,Ln=Oe.next())Ln=Be(wt,Ce,an,Ln.value,Ke),Ln!==null&&(l&&Ln.alternate!==null&&wt.delete(Ln.key===null?an:Ln.key),Se=P(Ln,Se,an),xn===null?Nt=Ln:xn.sibling=Ln,xn=Ln);return l&&wt.forEach(function(NR){return d(Ce,NR)}),Sn&&ho(Ce,an),Nt}function Hn(Ce,Se,Oe,Ke){if(typeof Oe=="object"&&Oe!==null&&Oe.type===W&&Oe.key===null&&(Oe=Oe.props.children),typeof Oe=="object"&&Oe!==null){switch(Oe.$$typeof){case L:e:{for(var Nt=Oe.key;Se!==null;){if(Se.key===Nt){if(Nt=Oe.type,Nt===W){if(Se.tag===7){_(Ce,Se.sibling),Ke=x(Se,Oe.props.children),Ke.return=Ce,Ce=Ke;break e}}else if(Se.elementType===Nt||typeof Nt=="object"&&Nt!==null&&Nt.$$typeof===ge&&ll(Nt)===Se.type){_(Ce,Se.sibling),Ke=x(Se,Oe.props),_u(Ke,Oe),Ke.return=Ce,Ce=Ke;break e}_(Ce,Se);break}else d(Ce,Se);Se=Se.sibling}Oe.type===W?(Ke=vi(Oe.props.children,Ce.mode,Ke,Oe.key),Ke.return=Ce,Ce=Ke):(Ke=kf(Oe.type,Oe.key,Oe.props,null,Ce.mode,Ke),_u(Ke,Oe),Ke.return=Ce,Ce=Ke)}return Y(Ce);case F:e:{for(Nt=Oe.key;Se!==null;){if(Se.key===Nt)if(Se.tag===4&&Se.stateNode.containerInfo===Oe.containerInfo&&Se.stateNode.implementation===Oe.implementation){_(Ce,Se.sibling),Ke=x(Se,Oe.children||[]),Ke.return=Ce,Ce=Ke;break e}else{_(Ce,Se);break}else d(Ce,Se);Se=Se.sibling}Ke=ky(Oe,Ce.mode,Ke),Ke.return=Ce,Ce=Ke}return Y(Ce);case ge:return Oe=ll(Oe),Hn(Ce,Se,Oe,Ke)}if(rt(Oe))return Et(Ce,Se,Oe,Ke);if(be(Oe)){if(Nt=be(Oe),typeof Nt!="function")throw Error(c(150));return Oe=Nt.call(Oe),Pt(Ce,Se,Oe,Ke)}if(typeof Oe.then=="function")return Hn(Ce,Se,ug(Oe),Ke);if(Oe.$$typeof===Z)return Hn(Ce,Se,Bf(Ce,Oe),Ke);Yd(Ce,Oe)}return typeof Oe=="string"&&Oe!==""||typeof Oe=="number"||typeof Oe=="bigint"?(Oe=""+Oe,Se!==null&&Se.tag===6?(_(Ce,Se.sibling),Ke=x(Se,Oe),Ke.return=Ce,Ce=Ke):(_(Ce,Se),Ke=Py(Oe,Ce.mode,Ke),Ke.return=Ce,Ce=Ke),Y(Ce)):_(Ce,Se)}return function(Ce,Se,Oe,Ke){try{zf=0;var Nt=Hn(Ce,Se,Oe,Ke);return Kd=null,Nt}catch(wt){if(wt===zd||wt===cg)throw wt;var xn=Va(29,wt,null,Ce.mode);return xn.lanes=Ke,xn.return=Ce,xn}finally{}}}var cc=Wy(!0),zy=Wy(!1),lc=!1;function qd(l){l.updateQueue={baseState:l.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function vu(l,d){l=l.updateQueue,d.updateQueue===l&&(d.updateQueue={baseState:l.baseState,firstBaseUpdate:l.firstBaseUpdate,lastBaseUpdate:l.lastBaseUpdate,shared:l.shared,callbacks:null})}function ul(l){return{lane:l,tag:0,payload:null,callback:null,next:null}}function dl(l,d,_){var S=l.updateQueue;if(S===null)return null;if(S=S.shared,(On&2)!==0){var x=S.pending;return x===null?d.next=d:(d.next=x.next,x.next=d),S.pending=d,d=cu(l),rg(l,null,_),d}return ng(l,S,d,_),cu(l)}function Xd(l,d,_){if(d=d.updateQueue,d!==null&&(d=d.shared,(_&4194048)!==0)){var S=d.lanes;S&=l.pendingLanes,_|=S,d.lanes=_,$b(l,_)}}function Ky(l,d){var _=l.updateQueue,S=l.alternate;if(S!==null&&(S=S.updateQueue,_===S)){var x=null,P=null;if(_=_.firstBaseUpdate,_!==null){do{var Y={lane:_.lane,tag:_.tag,payload:_.payload,callback:null,next:null};P===null?x=P=Y:P=P.next=Y,_=_.next}while(_!==null);P===null?x=P=d:P=P.next=d}else x=P=d;_={baseState:S.baseState,firstBaseUpdate:x,lastBaseUpdate:P,shared:S.shared,callbacks:S.callbacks},l.updateQueue=_;return}l=_.lastBaseUpdate,l===null?_.firstBaseUpdate=d:l.next=d,_.lastBaseUpdate=d}var Yy=!1;function Jd(){if(Yy){var l=fu;if(l!==null)throw l}}function Kf(l,d,_,S){Yy=!1;var x=l.updateQueue;lc=!1;var P=x.firstBaseUpdate,Y=x.lastBaseUpdate,ne=x.shared.pending;if(ne!==null){x.shared.pending=null;var pe=ne,Pe=pe.next;pe.next=null,Y===null?P=Pe:Y.next=Pe,Y=pe;var We=l.alternate;We!==null&&(We=We.updateQueue,ne=We.lastBaseUpdate,ne!==Y&&(ne===null?We.firstBaseUpdate=Pe:ne.next=Pe,We.lastBaseUpdate=pe))}if(P!==null){var Ze=x.baseState;Y=0,We=Pe=pe=null,ne=P;do{var Me=ne.lane&-536870913,Be=Me!==ne.lane;if(Be?(bn&Me)===Me:(S&Me)===Me){Me!==0&&Me===Wd&&(Yy=!0),We!==null&&(We=We.next={lane:0,tag:ne.tag,payload:ne.payload,callback:null,next:null});e:{var Et=l,Pt=ne;Me=d;var Hn=_;switch(Pt.tag){case 1:if(Et=Pt.payload,typeof Et=="function"){Ze=Et.call(Hn,Ze,Me);break e}Ze=Et;break e;case 3:Et.flags=Et.flags&-65537|128;case 0:if(Et=Pt.payload,Me=typeof Et=="function"?Et.call(Hn,Ze,Me):Et,Me==null)break e;Ze=I({},Ze,Me);break e;case 2:lc=!0}}Me=ne.callback,Me!==null&&(l.flags|=64,Be&&(l.flags|=8192),Be=x.callbacks,Be===null?x.callbacks=[Me]:Be.push(Me))}else Be={lane:Me,tag:ne.tag,payload:ne.payload,callback:ne.callback,next:null},We===null?(Pe=We=Be,pe=Ze):We=We.next=Be,Y|=Me;if(ne=ne.next,ne===null){if(ne=x.shared.pending,ne===null)break;Be=ne,ne=Be.next,Be.next=null,x.lastBaseUpdate=Be,x.shared.pending=null}}while(!0);We===null&&(pe=Ze),x.baseState=pe,x.firstBaseUpdate=Pe,x.lastBaseUpdate=We,P===null&&(x.shared.lanes=0),Sc|=Y,l.lanes=Y,l.memoizedState=Ze}}function HT(l,d){if(typeof l!="function")throw Error(c(191,l));l.call(d)}function WT(l,d){var _=l.callbacks;if(_!==null)for(l.callbacks=null,l=0;l<_.length;l++)HT(_[l],d)}var $d=me(null),dg=me(0);function zT(l,d){l=Ms,it(dg,l),it($d,d),Ms=l|d.baseLanes}function hg(){it(dg,Ms),it($d,$d.current)}function hl(){Ms=dg.current,Ve($d),Ve(dg)}var Ba=me(null),us=null;function fl(l){var d=l.alternate;it(Br,Br.current&1),it(Ba,l),us===null&&(d===null||$d.current!==null||d.memoizedState!==null)&&(us=l)}function fg(l){it(Br,Br.current),it(Ba,l),us===null&&(us=l)}function KT(l){l.tag===22?(it(Br,Br.current),it(Ba,l),us===null&&(us=l)):uc()}function uc(){it(Br,Br.current),it(Ba,Ba.current)}function Fa(l){Ve(Ba),us===l&&(us=null),Ve(Br)}var Br=me(0);function pg(l){for(var d=l;d!==null;){if(d.tag===13){var _=d.memoizedState;if(_!==null&&(_=_.dehydrated,_===null||a0(_)||s0(_)))return d}else if(d.tag===19&&(d.memoizedProps.revealOrder==="forwards"||d.memoizedProps.revealOrder==="backwards"||d.memoizedProps.revealOrder==="unstable_legacy-backwards"||d.memoizedProps.revealOrder==="together")){if((d.flags&128)!==0)return d}else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===l)break;for(;d.sibling===null;){if(d.return===null||d.return===l)return null;d=d.return}d.sibling.return=d.return,d=d.sibling}return null}var ds=0,en=null,$n=null,Xr=null,mg=!1,Zd=!1,yu=!1,Qd=0,Yf=0,Eu=null,HN=0;function Tr(){throw Error(c(321))}function qy(l,d){if(d===null)return!1;for(var _=0;_<d.length&&_<l.length;_++)if(!ja(l[_],d[_]))return!1;return!0}function Xy(l,d,_,S,x,P){return ds=P,en=d,d.memoizedState=null,d.updateQueue=null,d.lanes=0,he.H=l===null||l.memoizedState===null?uw:hE,yu=!1,P=_(S,x),yu=!1,Zd&&(P=qT(d,_,S,x)),YT(l),P}function YT(l){he.H=ih;var d=$n!==null&&$n.next!==null;if(ds=0,Xr=$n=en=null,mg=!1,Yf=0,Eu=null,d)throw Error(c(300));l===null||Jr||(l=l.dependencies,l!==null&&ag(l)&&(Jr=!0))}function qT(l,d,_,S){en=l;var x=0;do{if(Zd&&(Eu=null),Yf=0,Zd=!1,25<=x)throw Error(c(301));if(x+=1,Xr=$n=null,l.updateQueue!=null){var P=l.updateQueue;P.lastEffect=null,P.events=null,P.stores=null,P.memoCache!=null&&(P.memoCache.index=0)}he.H=dw,P=d(_,S)}while(Zd);return P}function WN(){var l=he.H,d=l.useState()[0];return d=typeof d.then=="function"?pl(d):d,l=l.useState()[0],($n!==null?$n.memoizedState:null)!==l&&(en.flags|=1024),d}function Jy(){var l=Qd!==0;return Qd=0,l}function gg(l,d,_){d.updateQueue=l.updateQueue,d.flags&=-2053,l.lanes&=~_}function $y(l){if(mg){for(l=l.memoizedState;l!==null;){var d=l.queue;d!==null&&(d.pending=null),l=l.next}mg=!1}ds=0,Xr=$n=en=null,Zd=!1,Yf=Qd=0,Eu=null}function aa(){var l={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Xr===null?en.memoizedState=Xr=l:Xr=Xr.next=l,Xr}function xr(){if($n===null){var l=en.alternate;l=l!==null?l.memoizedState:null}else l=$n.next;var d=Xr===null?en.memoizedState:Xr.next;if(d!==null)Xr=d,$n=l;else{if(l===null)throw en.alternate===null?Error(c(467)):Error(c(310));$n=l,l={memoizedState:$n.memoizedState,baseState:$n.baseState,baseQueue:$n.baseQueue,queue:$n.queue,next:null},Xr===null?en.memoizedState=Xr=l:Xr=Xr.next=l}return Xr}function _g(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function pl(l){var d=Yf;return Yf+=1,Eu===null&&(Eu=[]),l=Wf(Eu,l,d),d=en,(Xr===null?d.memoizedState:Xr.next)===null&&(d=d.alternate,he.H=d===null||d.memoizedState===null?uw:hE),l}function qf(l){if(l!==null&&typeof l=="object"){if(typeof l.then=="function")return pl(l);if(l.$$typeof===Z)return yi(l)}throw Error(c(438,String(l)))}function Su(l){var d=null,_=en.updateQueue;if(_!==null&&(d=_.memoCache),d==null){var S=en.alternate;S!==null&&(S=S.updateQueue,S!==null&&(S=S.memoCache,S!=null&&(d={data:S.data.map(function(x){return x.slice()}),index:0})))}if(d==null&&(d={data:[],index:0}),_===null&&(_=_g(),en.updateQueue=_),_.memoCache=d,_=d.data[d.index],_===void 0)for(_=d.data[d.index]=Array(l),S=0;S<l;S++)_[S]=ke;return d.index++,_}function dc(l,d){return typeof d=="function"?d(l):d}function vg(l){var d=xr();return Zy(d,$n,l)}function Zy(l,d,_){var S=l.queue;if(S===null)throw Error(c(311));S.lastRenderedReducer=_;var x=l.baseQueue,P=S.pending;if(P!==null){if(x!==null){var Y=x.next;x.next=P.next,P.next=Y}d.baseQueue=x=P,S.pending=null}if(P=l.baseState,x===null)l.memoizedState=P;else{d=x.next;var ne=Y=null,pe=null,Pe=d,We=!1;do{var Ze=Pe.lane&-536870913;if(Ze!==Pe.lane?(bn&Ze)===Ze:(ds&Ze)===Ze){var Me=Pe.revertLane;if(Me===0)pe!==null&&(pe=pe.next={lane:0,revertLane:0,gesture:null,action:Pe.action,hasEagerState:Pe.hasEagerState,eagerState:Pe.eagerState,next:null}),Ze===Wd&&(We=!0);else if((ds&Me)===Me){Pe=Pe.next,Me===Wd&&(We=!0);continue}else Ze={lane:0,revertLane:Pe.revertLane,gesture:null,action:Pe.action,hasEagerState:Pe.hasEagerState,eagerState:Pe.eagerState,next:null},pe===null?(ne=pe=Ze,Y=P):pe=pe.next=Ze,en.lanes|=Me,Sc|=Me;Ze=Pe.action,yu&&_(P,Ze),P=Pe.hasEagerState?Pe.eagerState:_(P,Ze)}else Me={lane:Ze,revertLane:Pe.revertLane,gesture:Pe.gesture,action:Pe.action,hasEagerState:Pe.hasEagerState,eagerState:Pe.eagerState,next:null},pe===null?(ne=pe=Me,Y=P):pe=pe.next=Me,en.lanes|=Ze,Sc|=Ze;Pe=Pe.next}while(Pe!==null&&Pe!==d);if(pe===null?Y=P:pe.next=ne,!ja(P,l.memoizedState)&&(Jr=!0,We&&(_=fu,_!==null)))throw _;l.memoizedState=P,l.baseState=Y,l.baseQueue=pe,S.lastRenderedState=P}return x===null&&(S.lanes=0),[l.memoizedState,S.dispatch]}function Qy(l){var d=xr(),_=d.queue;if(_===null)throw Error(c(311));_.lastRenderedReducer=l;var S=_.dispatch,x=_.pending,P=d.memoizedState;if(x!==null){_.pending=null;var Y=x=x.next;do P=l(P,Y.action),Y=Y.next;while(Y!==x);ja(P,d.memoizedState)||(Jr=!0),d.memoizedState=P,d.baseQueue===null&&(d.baseState=P),_.lastRenderedState=P}return[P,S]}function Xf(l,d,_){var S=en,x=xr(),P=Sn;if(P){if(_===void 0)throw Error(c(407));_=_()}else _=d();var Y=!ja(($n||x).memoizedState,_);if(Y&&(x.memoizedState=_,Jr=!0),x=x.queue,nE(yg.bind(null,S,x,l),[l]),x.getSnapshot!==d||Y||Xr!==null&&Xr.memoizedState.tag&1){if(S.flags|=2048,bu(9,{destroy:void 0},eE.bind(null,S,x,_,d),null),Zn===null)throw Error(c(349));P||(ds&127)!==0||XT(S,d,_)}return _}function XT(l,d,_){l.flags|=16384,l={getSnapshot:d,value:_},d=en.updateQueue,d===null?(d=_g(),en.updateQueue=d,d.stores=[l]):(_=d.stores,_===null?d.stores=[l]:_.push(l))}function eE(l,d,_,S){d.value=_,d.getSnapshot=S,Eg(d)&&JT(l)}function yg(l,d,_){return _(function(){Eg(d)&&JT(l)})}function Eg(l){var d=l.getSnapshot;l=l.value;try{var _=d();return!ja(l,_)}catch{return!0}}function JT(l){var d=lo(l,2);d!==null&&Ta(d,l,2)}function tE(l){var d=aa();if(typeof l=="function"){var _=l;if(l=_(),yu){ec(!0);try{_()}finally{ec(!1)}}}return d.memoizedState=d.baseState=l,d.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:dc,lastRenderedState:l},d}function $T(l,d,_,S){return l.baseState=_,Zy(l,$n,typeof S=="function"?S:dc)}function zN(l,d,_,S,x){if(rh(l))throw Error(c(485));if(l=d.action,l!==null){var P={payload:x,action:l,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(Y){P.listeners.push(Y)}};he.T!==null?_(!0):P.isTransition=!1,S(P),_=d.pending,_===null?(P.next=d.pending=P,ZT(d,P)):(P.next=_.next,d.pending=_.next=P)}}function ZT(l,d){var _=d.action,S=d.payload,x=l.state;if(d.isTransition){var P=he.T,Y={};he.T=Y;try{var ne=_(x,S),pe=he.S;pe!==null&&pe(Y,ne),Jf(l,d,ne)}catch(Pe){ml(l,d,Pe)}finally{P!==null&&Y.types!==null&&(P.types=Y.types),he.T=P}}else try{P=_(x,S),Jf(l,d,P)}catch(Pe){ml(l,d,Pe)}}function Jf(l,d,_){_!==null&&typeof _=="object"&&typeof _.then=="function"?_.then(function(S){QT(l,d,S)},function(S){return ml(l,d,S)}):QT(l,d,_)}function QT(l,d,_){d.status="fulfilled",d.value=_,Sg(d),l.state=_,d=l.pending,d!==null&&(_=d.next,_===d?l.pending=null:(_=_.next,d.next=_,ZT(l,_)))}function ml(l,d,_){var S=l.pending;if(l.pending=null,S!==null){S=S.next;do d.status="rejected",d.reason=_,Sg(d),d=d.next;while(d!==S)}l.action=null}function Sg(l){l=l.listeners;for(var d=0;d<l.length;d++)(0,l[d])()}function $f(l,d){return d}function eh(l,d){if(Sn){var _=Zn.formState;if(_!==null){e:{var S=en;if(Sn){if(lr){t:{for(var x=lr,P=cs;x.nodeType!==8;){if(!P){x=null;break t}if(x=ps(x.nextSibling),x===null){x=null;break t}}P=x.data,x=P==="F!"||P==="F"?x:null}if(x){lr=ps(x.nextSibling),S=x.data==="F!";break e}}ol(S)}S=!1}S&&(d=_[0])}}return _=aa(),_.memoizedState=_.baseState=d,S={pending:null,lanes:0,dispatch:null,lastRenderedReducer:$f,lastRenderedState:d},_.queue=S,_=cw.bind(null,en,S),S.dispatch=_,S=tE(!1),P=uE.bind(null,en,!1,S.queue),S=aa(),x={state:d,dispatch:null,action:l,pending:null},S.queue=x,_=zN.bind(null,en,x,P,_),x.dispatch=_,S.memoizedState=l,[d,_,!1]}function Zf(l){var d=xr();return ew(d,$n,l)}function ew(l,d,_){if(d=Zy(l,d,$f)[0],l=vg(dc)[0],typeof d=="object"&&d!==null&&typeof d.then=="function")try{var S=pl(d)}catch(Y){throw Y===zd?cg:Y}else S=d;d=xr();var x=d.queue,P=x.dispatch;return _!==d.memoizedState&&(en.flags|=2048,bu(9,{destroy:void 0},tw.bind(null,x,_),null)),[S,P,l]}function tw(l,d){l.action=d}function nw(l){var d=xr(),_=$n;if(_!==null)return ew(d,_,l);xr(),d=d.memoizedState,_=xr();var S=_.queue.dispatch;return _.memoizedState=l,[d,S,!1]}function bu(l,d,_,S){return l={tag:l,create:_,deps:S,inst:d,next:null},d=en.updateQueue,d===null&&(d=_g(),en.updateQueue=d),_=d.lastEffect,_===null?d.lastEffect=l.next=l:(S=_.next,_.next=l,l.next=S,d.lastEffect=l),l}function rw(){return xr().memoizedState}function bg(l,d,_,S){var x=aa();en.flags|=l,x.memoizedState=bu(1|d,{destroy:void 0},_,S===void 0?null:S)}function th(l,d,_,S){var x=xr();S=S===void 0?null:S;var P=x.memoizedState.inst;$n!==null&&S!==null&&qy(S,$n.memoizedState.deps)?x.memoizedState=bu(d,P,_,S):(en.flags|=l,x.memoizedState=bu(1|d,P,_,S))}function Tg(l,d){bg(8390656,8,l,d)}function nE(l,d){th(2048,8,l,d)}function KN(l){en.flags|=4;var d=en.updateQueue;if(d===null)d=_g(),en.updateQueue=d,d.events=[l];else{var _=d.events;_===null?d.events=[l]:_.push(l)}}function rE(l){var d=xr().memoizedState;return KN({ref:d,nextImpl:l}),function(){if((On&2)!==0)throw Error(c(440));return d.impl.apply(void 0,arguments)}}function wg(l,d){return th(4,2,l,d)}function iw(l,d){return th(4,4,l,d)}function ks(l,d){if(typeof d=="function"){l=l();var _=d(l);return function(){typeof _=="function"?_():d(null)}}if(d!=null)return l=l(),d.current=l,function(){d.current=null}}function Tu(l,d,_){_=_!=null?_.concat([l]):null,th(4,4,ks.bind(null,d,l),_)}function hc(){}function iE(l,d){var _=xr();d=d===void 0?null:d;var S=_.memoizedState;return d!==null&&qy(d,S[1])?S[0]:(_.memoizedState=[l,d],l)}function aE(l,d){var _=xr();d=d===void 0?null:d;var S=_.memoizedState;if(d!==null&&qy(d,S[1]))return S[0];if(S=l(),yu){ec(!0);try{l()}finally{ec(!1)}}return _.memoizedState=[S,d],S}function fc(l,d,_){return _===void 0||(ds&1073741824)!==0&&(bn&261930)===0?l.memoizedState=d:(l.memoizedState=_,l=gh(),en.lanes|=l,Sc|=l,_)}function Rg(l,d,_,S){return ja(_,d)?_:$d.current!==null?(l=fc(l,_,S),ja(l,d)||(Jr=!0),l):(ds&42)===0||(ds&1073741824)!==0&&(bn&261930)===0?(Jr=!0,l.memoizedState=_):(l=gh(),en.lanes|=l,Sc|=l,d)}function aw(l,d,_,S,x){var P=_e.p;_e.p=P!==0&&8>P?P:8;var Y=he.T,ne={};he.T=ne,uE(l,!1,d,_);try{var pe=x(),Pe=he.S;if(Pe!==null&&Pe(ne,pe),pe!==null&&typeof pe=="object"&&typeof pe.then=="function"){var We=GN(pe,S);nh(l,d,We,za(l))}else nh(l,d,S,za(l))}catch(Ze){nh(l,d,{then:function(){},status:"rejected",reason:Ze},za())}finally{_e.p=P,Y!==null&&ne.types!==null&&(Y.types=ne.types),he.T=Y}}function sw(){}function sE(l,d,_,S){if(l.tag!==5)throw Error(c(476));var x=oE(l).queue;aw(l,x,d,ze,_===null?sw:function(){return cE(l),_(S)})}function oE(l){var d=l.memoizedState;if(d!==null)return d;d={memoizedState:ze,baseState:ze,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:dc,lastRenderedState:ze},next:null};var _={};return d.next={memoizedState:_,baseState:_,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:dc,lastRenderedState:_},next:null},l.memoizedState=d,l=l.alternate,l!==null&&(l.memoizedState=d),d}function cE(l){var d=oE(l);d.next===null&&(d=l.alternate.memoizedState),nh(l,d.next.queue,{},za())}function lE(){return yi(mp)}function pc(){return xr().memoizedState}function ow(){return xr().memoizedState}function YN(l){for(var d=l.return;d!==null;){switch(d.tag){case 24:case 3:var _=za();l=ul(_);var S=dl(d,l,_);S!==null&&(Ta(S,d,_),Xd(S,d,_)),d={cache:Vy()},l.payload=d;return}d=d.return}}function qN(l,d,_){var S=za();_={lane:S,revertLane:0,gesture:null,action:_,hasEagerState:!1,eagerState:null,next:null},rh(l)?dE(d,_):(_=xy(l,d,_,S),_!==null&&(Ta(_,l,S),lw(_,d,S)))}function cw(l,d,_){var S=za();nh(l,d,_,S)}function nh(l,d,_,S){var x={lane:S,revertLane:0,gesture:null,action:_,hasEagerState:!1,eagerState:null,next:null};if(rh(l))dE(d,x);else{var P=l.alternate;if(l.lanes===0&&(P===null||P.lanes===0)&&(P=d.lastRenderedReducer,P!==null))try{var Y=d.lastRenderedState,ne=P(Y,_);if(x.hasEagerState=!0,x.eagerState=ne,ja(ne,Y))return ng(l,d,x,0),Zn===null&&sl(),!1}catch{}finally{}if(_=xy(l,d,x,S),_!==null)return Ta(_,l,S),lw(_,d,S),!0}return!1}function uE(l,d,_,S){if(S={lane:2,revertLane:KE(),gesture:null,action:S,hasEagerState:!1,eagerState:null,next:null},rh(l)){if(d)throw Error(c(479))}else d=xy(l,_,S,2),d!==null&&Ta(d,l,2)}function rh(l){var d=l.alternate;return l===en||d!==null&&d===en}function dE(l,d){Zd=mg=!0;var _=l.pending;_===null?d.next=d:(d.next=_.next,_.next=d),l.pending=d}function lw(l,d,_){if((_&4194048)!==0){var S=d.lanes;S&=l.pendingLanes,_|=S,d.lanes=_,$b(l,_)}}var ih={readContext:yi,use:qf,useCallback:Tr,useContext:Tr,useEffect:Tr,useImperativeHandle:Tr,useLayoutEffect:Tr,useInsertionEffect:Tr,useMemo:Tr,useReducer:Tr,useRef:Tr,useState:Tr,useDebugValue:Tr,useDeferredValue:Tr,useTransition:Tr,useSyncExternalStore:Tr,useId:Tr,useHostTransitionStatus:Tr,useFormState:Tr,useActionState:Tr,useOptimistic:Tr,useMemoCache:Tr,useCacheRefresh:Tr};ih.useEffectEvent=Tr;var uw={readContext:yi,use:qf,useCallback:function(l,d){return aa().memoizedState=[l,d===void 0?null:d],l},useContext:yi,useEffect:Tg,useImperativeHandle:function(l,d,_){_=_!=null?_.concat([l]):null,bg(4194308,4,ks.bind(null,d,l),_)},useLayoutEffect:function(l,d){return bg(4194308,4,l,d)},useInsertionEffect:function(l,d){bg(4,2,l,d)},useMemo:function(l,d){var _=aa();d=d===void 0?null:d;var S=l();if(yu){ec(!0);try{l()}finally{ec(!1)}}return _.memoizedState=[S,d],S},useReducer:function(l,d,_){var S=aa();if(_!==void 0){var x=_(d);if(yu){ec(!0);try{_(d)}finally{ec(!1)}}}else x=d;return S.memoizedState=S.baseState=x,l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:l,lastRenderedState:x},S.queue=l,l=l.dispatch=qN.bind(null,en,l),[S.memoizedState,l]},useRef:function(l){var d=aa();return l={current:l},d.memoizedState=l},useState:function(l){l=tE(l);var d=l.queue,_=cw.bind(null,en,d);return d.dispatch=_,[l.memoizedState,_]},useDebugValue:hc,useDeferredValue:function(l,d){var _=aa();return fc(_,l,d)},useTransition:function(){var l=tE(!1);return l=aw.bind(null,en,l.queue,!0,!1),aa().memoizedState=l,[!1,l]},useSyncExternalStore:function(l,d,_){var S=en,x=aa();if(Sn){if(_===void 0)throw Error(c(407));_=_()}else{if(_=d(),Zn===null)throw Error(c(349));(bn&127)!==0||XT(S,d,_)}x.memoizedState=_;var P={value:_,getSnapshot:d};return x.queue=P,Tg(yg.bind(null,S,P,l),[l]),S.flags|=2048,bu(9,{destroy:void 0},eE.bind(null,S,P,_,d),null),_},useId:function(){var l=aa(),d=Zn.identifierPrefix;if(Sn){var _=uo,S=Ps;_=(S&~(1<<32-Ma(S)-1)).toString(32)+_,d="_"+d+"R_"+_,_=Qd++,0<_&&(d+="H"+_.toString(32)),d+="_"}else _=HN++,d="_"+d+"r_"+_.toString(32)+"_";return l.memoizedState=d},useHostTransitionStatus:lE,useFormState:eh,useActionState:eh,useOptimistic:function(l){var d=aa();d.memoizedState=d.baseState=l;var _={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return d.queue=_,d=uE.bind(null,en,!0,_),_.dispatch=d,[l,d]},useMemoCache:Su,useCacheRefresh:function(){return aa().memoizedState=YN.bind(null,en)},useEffectEvent:function(l){var d=aa(),_={impl:l};return d.memoizedState=_,function(){if((On&2)!==0)throw Error(c(440));return _.impl.apply(void 0,arguments)}}},hE={readContext:yi,use:qf,useCallback:iE,useContext:yi,useEffect:nE,useImperativeHandle:Tu,useInsertionEffect:wg,useLayoutEffect:iw,useMemo:aE,useReducer:vg,useRef:rw,useState:function(){return vg(dc)},useDebugValue:hc,useDeferredValue:function(l,d){var _=xr();return Rg(_,$n.memoizedState,l,d)},useTransition:function(){var l=vg(dc)[0],d=xr().memoizedState;return[typeof l=="boolean"?l:pl(l),d]},useSyncExternalStore:Xf,useId:pc,useHostTransitionStatus:lE,useFormState:Zf,useActionState:Zf,useOptimistic:function(l,d){var _=xr();return $T(_,$n,l,d)},useMemoCache:Su,useCacheRefresh:ow};hE.useEffectEvent=rE;var dw={readContext:yi,use:qf,useCallback:iE,useContext:yi,useEffect:nE,useImperativeHandle:Tu,useInsertionEffect:wg,useLayoutEffect:iw,useMemo:aE,useReducer:Qy,useRef:rw,useState:function(){return Qy(dc)},useDebugValue:hc,useDeferredValue:function(l,d){var _=xr();return $n===null?fc(_,l,d):Rg(_,$n.memoizedState,l,d)},useTransition:function(){var l=Qy(dc)[0],d=xr().memoizedState;return[typeof l=="boolean"?l:pl(l),d]},useSyncExternalStore:Xf,useId:pc,useHostTransitionStatus:lE,useFormState:nw,useActionState:nw,useOptimistic:function(l,d){var _=xr();return $n!==null?$T(_,$n,l,d):(_.baseState=l,[l,_.queue.dispatch])},useMemoCache:Su,useCacheRefresh:ow};dw.useEffectEvent=rE;function fE(l,d,_,S){d=l.memoizedState,_=_(S,d),_=_==null?d:I({},d,_),l.memoizedState=_,l.lanes===0&&(l.updateQueue.baseState=_)}var pE={enqueueSetState:function(l,d,_){l=l._reactInternals;var S=za(),x=ul(S);x.payload=d,_!=null&&(x.callback=_),d=dl(l,x,S),d!==null&&(Ta(d,l,S),Xd(d,l,S))},enqueueReplaceState:function(l,d,_){l=l._reactInternals;var S=za(),x=ul(S);x.tag=1,x.payload=d,_!=null&&(x.callback=_),d=dl(l,x,S),d!==null&&(Ta(d,l,S),Xd(d,l,S))},enqueueForceUpdate:function(l,d){l=l._reactInternals;var _=za(),S=ul(_);S.tag=2,d!=null&&(S.callback=d),d=dl(l,S,_),d!==null&&(Ta(d,l,_),Xd(d,l,_))}};function hw(l,d,_,S,x,P,Y){return l=l.stateNode,typeof l.shouldComponentUpdate=="function"?l.shouldComponentUpdate(S,P,Y):d.prototype&&d.prototype.isPureReactComponent?!Df(_,S)||!Df(x,P):!0}function fw(l,d,_,S){l=d.state,typeof d.componentWillReceiveProps=="function"&&d.componentWillReceiveProps(_,S),typeof d.UNSAFE_componentWillReceiveProps=="function"&&d.UNSAFE_componentWillReceiveProps(_,S),d.state!==l&&pE.enqueueReplaceState(d,d.state,null)}function gl(l,d){var _=d;if("ref"in d){_={};for(var S in d)S!=="ref"&&(_[S]=d[S])}if(l=l.defaultProps){_===d&&(_=I({},_));for(var x in l)_[x]===void 0&&(_[x]=l[x])}return _}function po(l){tg(l)}function pw(l){console.error(l)}function mw(l){tg(l)}function Cg(l,d){try{var _=l.onUncaughtError;_(d.value,{componentStack:d.stack})}catch(S){setTimeout(function(){throw S})}}function gw(l,d,_){try{var S=l.onCaughtError;S(_.value,{componentStack:_.stack,errorBoundary:d.tag===1?d.stateNode:null})}catch(x){setTimeout(function(){throw x})}}function mE(l,d,_){return _=ul(_),_.tag=3,_.payload={element:null},_.callback=function(){Cg(l,d)},_}function _w(l){return l=ul(l),l.tag=3,l}function Ag(l,d,_,S){var x=_.type.getDerivedStateFromError;if(typeof x=="function"){var P=S.value;l.payload=function(){return x(P)},l.callback=function(){gw(d,_,S)}}var Y=_.stateNode;Y!==null&&typeof Y.componentDidCatch=="function"&&(l.callback=function(){gw(d,_,S),typeof x!="function"&&(bc===null?bc=new Set([this]):bc.add(this));var ne=S.stack;this.componentDidCatch(S.value,{componentStack:ne!==null?ne:""})})}function XN(l,d,_,S,x){if(_.flags|=32768,S!==null&&typeof S=="object"&&typeof S.then=="function"){if(d=_.alternate,d!==null&&Hd(d,_,x,!0),_=Ba.current,_!==null){switch(_.tag){case 31:case 13:return us===null?ap():_.alternate===null&&Rr===0&&(Rr=3),_.flags&=-257,_.flags|=65536,_.lanes=x,S===lg?_.flags|=16384:(d=_.updateQueue,d===null?_.updateQueue=new Set([S]):d.add(S),GE(l,S,x)),!1;case 22:return _.flags|=65536,S===lg?_.flags|=16384:(d=_.updateQueue,d===null?(d={transitions:null,markerInstances:null,retryQueue:new Set([S])},_.updateQueue=d):(_=d.retryQueue,_===null?d.retryQueue=new Set([S]):_.add(S)),GE(l,S,x)),!1}throw Error(c(435,_.tag))}return GE(l,S,x),ap(),!1}if(Sn)return d=Ba.current,d!==null?((d.flags&65536)===0&&(d.flags|=256),d.flags|=65536,d.lanes=x,S!==Uf&&(l=Error(c(422),{cause:S}),jf(ss(l,_)))):(S!==Uf&&(d=Error(c(423),{cause:S}),jf(ss(d,_))),l=l.current.alternate,l.flags|=65536,x&=-x,l.lanes|=x,S=ss(S,_),x=mE(l.stateNode,S,x),Ky(l,x),Rr!==4&&(Rr=2)),!1;var P=Error(c(520),{cause:S});if(P=ss(P,_),hh===null?hh=[P]:hh.push(P),Rr!==4&&(Rr=2),d===null)return!0;S=ss(S,_),_=d;do{switch(_.tag){case 3:return _.flags|=65536,l=x&-x,_.lanes|=l,l=mE(_.stateNode,S,l),Ky(_,l),!1;case 1:if(d=_.type,P=_.stateNode,(_.flags&128)===0&&(typeof d.getDerivedStateFromError=="function"||P!==null&&typeof P.componentDidCatch=="function"&&(bc===null||!bc.has(P))))return _.flags|=65536,x&=-x,_.lanes|=x,x=_w(x),Ag(x,l,_,S),Ky(_,x),!1}_=_.return}while(_!==null);return!1}var gE=Error(c(461)),Jr=!1;function xi(l,d,_,S){d.child=l===null?zy(d,null,_,S):cc(d,l.child,_,S)}function vw(l,d,_,S,x){_=_.render;var P=d.ref;if("ref"in S){var Y={};for(var ne in S)ne!=="ref"&&(Y[ne]=S[ne])}else Y=S;return hu(d),S=Xy(l,d,_,Y,P,x),ne=Jy(),l!==null&&!Jr?(gg(l,d,x),mc(l,d,x)):(Sn&&ne&&Ly(d),d.flags|=1,xi(l,d,S,x),d.child)}function yw(l,d,_,S,x){if(l===null){var P=_.type;return typeof P=="function"&&!Dy(P)&&P.defaultProps===void 0&&_.compare===null?(d.tag=15,d.type=P,_E(l,d,P,S,x)):(l=kf(_.type,null,S,d,d.mode,x),l.ref=d.ref,l.return=d,d.child=l)}if(P=l.child,!TE(l,x)){var Y=P.memoizedProps;if(_=_.compare,_=_!==null?_:Df,_(Y,S)&&l.ref===d.ref)return mc(l,d,x)}return d.flags|=1,l=Ds(P,S),l.ref=d.ref,l.return=d,d.child=l}function _E(l,d,_,S,x){if(l!==null){var P=l.memoizedProps;if(Df(P,S)&&l.ref===d.ref)if(Jr=!1,d.pendingProps=S=P,TE(l,x))(l.flags&131072)!==0&&(Jr=!0);else return d.lanes=l.lanes,mc(l,d,x)}return Ig(l,d,_,S,x)}function vE(l,d,_,S){var x=S.children,P=l!==null?l.memoizedState:null;if(l===null&&d.stateNode===null&&(d.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),S.mode==="hidden"){if((d.flags&128)!==0){if(P=P!==null?P.baseLanes|_:_,l!==null){for(S=d.child=l.child,x=0;S!==null;)x=x|S.lanes|S.childLanes,S=S.sibling;S=x&~P}else S=0,d.child=null;return Ew(l,d,P,_,S)}if((_&536870912)!==0)d.memoizedState={baseLanes:0,cachePool:null},l!==null&&mu(d,P!==null?P.cachePool:null),P!==null?zT(d,P):hg(),KT(d);else return S=d.lanes=536870912,Ew(l,d,P!==null?P.baseLanes|_:_,_,S)}else P!==null?(mu(d,P.cachePool),zT(d,P),uc(),d.memoizedState=null):(l!==null&&mu(d,null),hg(),uc());return xi(l,d,x,_),d.child}function Qf(l,d){return l!==null&&l.tag===22||d.stateNode!==null||(d.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),d.sibling}function Ew(l,d,_,S,x){var P=Fy();return P=P===null?null:{parent:qr._currentValue,pool:P},d.memoizedState={baseLanes:_,cachePool:P},l!==null&&mu(d,null),hg(),KT(d),l!==null&&Hd(l,d,S,!0),d.childLanes=x,null}function wu(l,d){return d=tp({mode:d.mode,children:d.children},l.mode),d.ref=l.ref,l.child=d,d.return=l,d}function Og(l,d,_){return cc(d,l.child,null,_),l=wu(d,d.pendingProps),l.flags|=2,Fa(d),d.memoizedState=null,l}function Sw(l,d,_){var S=d.pendingProps,x=(d.flags&128)!==0;if(d.flags&=-129,l===null){if(Sn){if(S.mode==="hidden")return l=wu(d,S),d.lanes=536870912,Qf(null,l);if(fg(d),(l=lr)?(l=uR(l,cs),l=l!==null&&l.data==="&"?l:null,l!==null&&(d.memoizedState={dehydrated:l,treeContext:sc!==null?{id:Ps,overflow:uo}:null,retryLane:536870912,hydrationErrors:null},_=Vd(l),_.return=d,d.child=_,Ni=d,lr=null)):l=null,l===null)throw ol(d);return d.lanes=536870912,null}return wu(d,S)}var P=l.memoizedState;if(P!==null){var Y=P.dehydrated;if(fg(d),x)if(d.flags&256)d.flags&=-257,d=Og(l,d,_);else if(d.memoizedState!==null)d.child=l.child,d.flags|=128,d=null;else throw Error(c(558));else if(Jr||Hd(l,d,_,!1),x=(_&l.childLanes)!==0,Jr||x){if(S=Zn,S!==null&&(Y=Ef(S,_),Y!==0&&Y!==P.retryLane))throw P.retryLane=Y,lo(l,Y),Ta(S,l,Y),gE;ap(),d=Og(l,d,_)}else l=P.treeContext,lr=ps(Y.nextSibling),Ni=d,Sn=!0,fo=null,cs=!1,l!==null&&MT(d,l),d=wu(d,S),d.flags|=4096;return d}return l=Ds(l.child,{mode:S.mode,children:S.children}),l.ref=d.ref,d.child=l,l.return=d,l}function Ru(l,d){var _=d.ref;if(_===null)l!==null&&l.ref!==null&&(d.flags|=4194816);else{if(typeof _!="function"&&typeof _!="object")throw Error(c(284));(l===null||l.ref!==_)&&(d.flags|=4194816)}}function Ig(l,d,_,S,x){return hu(d),_=Xy(l,d,_,S,void 0,x),S=Jy(),l!==null&&!Jr?(gg(l,d,x),mc(l,d,x)):(Sn&&S&&Ly(d),d.flags|=1,xi(l,d,_,x),d.child)}function bw(l,d,_,S,x,P){return hu(d),d.updateQueue=null,_=qT(d,S,_,x),YT(l),S=Jy(),l!==null&&!Jr?(gg(l,d,P),mc(l,d,P)):(Sn&&S&&Ly(d),d.flags|=1,xi(l,d,_,P),d.child)}function yE(l,d,_,S,x){if(hu(d),d.stateNode===null){var P=jd,Y=_.contextType;typeof Y=="object"&&Y!==null&&(P=yi(Y)),P=new _(S,P),d.memoizedState=P.state!==null&&P.state!==void 0?P.state:null,P.updater=pE,d.stateNode=P,P._reactInternals=d,P=d.stateNode,P.props=S,P.state=d.memoizedState,P.refs={},qd(d),Y=_.contextType,P.context=typeof Y=="object"&&Y!==null?yi(Y):jd,P.state=d.memoizedState,Y=_.getDerivedStateFromProps,typeof Y=="function"&&(fE(d,_,Y,S),P.state=d.memoizedState),typeof _.getDerivedStateFromProps=="function"||typeof P.getSnapshotBeforeUpdate=="function"||typeof P.UNSAFE_componentWillMount!="function"&&typeof P.componentWillMount!="function"||(Y=P.state,typeof P.componentWillMount=="function"&&P.componentWillMount(),typeof P.UNSAFE_componentWillMount=="function"&&P.UNSAFE_componentWillMount(),Y!==P.state&&pE.enqueueReplaceState(P,P.state,null),Kf(d,S,P,x),Jd(),P.state=d.memoizedState),typeof P.componentDidMount=="function"&&(d.flags|=4194308),S=!0}else if(l===null){P=d.stateNode;var ne=d.memoizedProps,pe=gl(_,ne);P.props=pe;var Pe=P.context,We=_.contextType;Y=jd,typeof We=="object"&&We!==null&&(Y=yi(We));var Ze=_.getDerivedStateFromProps;We=typeof Ze=="function"||typeof P.getSnapshotBeforeUpdate=="function",ne=d.pendingProps!==ne,We||typeof P.UNSAFE_componentWillReceiveProps!="function"&&typeof P.componentWillReceiveProps!="function"||(ne||Pe!==Y)&&fw(d,P,S,Y),lc=!1;var Me=d.memoizedState;P.state=Me,Kf(d,S,P,x),Jd(),Pe=d.memoizedState,ne||Me!==Pe||lc?(typeof Ze=="function"&&(fE(d,_,Ze,S),Pe=d.memoizedState),(pe=lc||hw(d,_,pe,S,Me,Pe,Y))?(We||typeof P.UNSAFE_componentWillMount!="function"&&typeof P.componentWillMount!="function"||(typeof P.componentWillMount=="function"&&P.componentWillMount(),typeof P.UNSAFE_componentWillMount=="function"&&P.UNSAFE_componentWillMount()),typeof P.componentDidMount=="function"&&(d.flags|=4194308)):(typeof P.componentDidMount=="function"&&(d.flags|=4194308),d.memoizedProps=S,d.memoizedState=Pe),P.props=S,P.state=Pe,P.context=Y,S=pe):(typeof P.componentDidMount=="function"&&(d.flags|=4194308),S=!1)}else{P=d.stateNode,vu(l,d),Y=d.memoizedProps,We=gl(_,Y),P.props=We,Ze=d.pendingProps,Me=P.context,Pe=_.contextType,pe=jd,typeof Pe=="object"&&Pe!==null&&(pe=yi(Pe)),ne=_.getDerivedStateFromProps,(Pe=typeof ne=="function"||typeof P.getSnapshotBeforeUpdate=="function")||typeof P.UNSAFE_componentWillReceiveProps!="function"&&typeof P.componentWillReceiveProps!="function"||(Y!==Ze||Me!==pe)&&fw(d,P,S,pe),lc=!1,Me=d.memoizedState,P.state=Me,Kf(d,S,P,x),Jd();var Be=d.memoizedState;Y!==Ze||Me!==Be||lc||l!==null&&l.dependencies!==null&&ag(l.dependencies)?(typeof ne=="function"&&(fE(d,_,ne,S),Be=d.memoizedState),(We=lc||hw(d,_,We,S,Me,Be,pe)||l!==null&&l.dependencies!==null&&ag(l.dependencies))?(Pe||typeof P.UNSAFE_componentWillUpdate!="function"&&typeof P.componentWillUpdate!="function"||(typeof P.componentWillUpdate=="function"&&P.componentWillUpdate(S,Be,pe),typeof P.UNSAFE_componentWillUpdate=="function"&&P.UNSAFE_componentWillUpdate(S,Be,pe)),typeof P.componentDidUpdate=="function"&&(d.flags|=4),typeof P.getSnapshotBeforeUpdate=="function"&&(d.flags|=1024)):(typeof P.componentDidUpdate!="function"||Y===l.memoizedProps&&Me===l.memoizedState||(d.flags|=4),typeof P.getSnapshotBeforeUpdate!="function"||Y===l.memoizedProps&&Me===l.memoizedState||(d.flags|=1024),d.memoizedProps=S,d.memoizedState=Be),P.props=S,P.state=Be,P.context=pe,S=We):(typeof P.componentDidUpdate!="function"||Y===l.memoizedProps&&Me===l.memoizedState||(d.flags|=4),typeof P.getSnapshotBeforeUpdate!="function"||Y===l.memoizedProps&&Me===l.memoizedState||(d.flags|=1024),S=!1)}return P=S,Ru(l,d),S=(d.flags&128)!==0,P||S?(P=d.stateNode,_=S&&typeof _.getDerivedStateFromError!="function"?null:P.render(),d.flags|=1,l!==null&&S?(d.child=cc(d,l.child,null,x),d.child=cc(d,null,_,x)):xi(l,d,_,x),d.memoizedState=P.state,l=d.child):l=mc(l,d,x),l}function ep(l,d,_,S){return uu(),d.flags|=256,xi(l,d,_,S),d.child}var EE={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Ng(l){return{baseLanes:l,cachePool:BT()}}function xg(l,d,_){return l=l!==null?l.childLanes&~_:0,d&&(l|=Si),l}function Tw(l,d,_){var S=d.pendingProps,x=!1,P=(d.flags&128)!==0,Y;if((Y=P)||(Y=l!==null&&l.memoizedState===null?!1:(Br.current&2)!==0),Y&&(x=!0,d.flags&=-129),Y=(d.flags&32)!==0,d.flags&=-33,l===null){if(Sn){if(x?fl(d):uc(),(l=lr)?(l=uR(l,cs),l=l!==null&&l.data!=="&"?l:null,l!==null&&(d.memoizedState={dehydrated:l,treeContext:sc!==null?{id:Ps,overflow:uo}:null,retryLane:536870912,hydrationErrors:null},_=Vd(l),_.return=d,d.child=_,Ni=d,lr=null)):l=null,l===null)throw ol(d);return s0(l)?d.lanes=32:d.lanes=536870912,null}var ne=S.children;return S=S.fallback,x?(uc(),x=d.mode,ne=tp({mode:"hidden",children:ne},x),S=vi(S,x,_,null),ne.return=d,S.return=d,ne.sibling=S,d.child=ne,S=d.child,S.memoizedState=Ng(_),S.childLanes=xg(l,Y,_),d.memoizedState=EE,Qf(null,S)):(fl(d),ah(d,ne))}var pe=l.memoizedState;if(pe!==null&&(ne=pe.dehydrated,ne!==null)){if(P)d.flags&256?(fl(d),d.flags&=-257,d=SE(l,d,_)):d.memoizedState!==null?(uc(),d.child=l.child,d.flags|=128,d=null):(uc(),ne=S.fallback,x=d.mode,S=tp({mode:"visible",children:S.children},x),ne=vi(ne,x,_,null),ne.flags|=2,S.return=d,ne.return=d,S.sibling=ne,d.child=S,cc(d,l.child,null,_),S=d.child,S.memoizedState=Ng(_),S.childLanes=xg(l,Y,_),d.memoizedState=EE,d=Qf(null,S));else if(fl(d),s0(ne)){if(Y=ne.nextSibling&&ne.nextSibling.dataset,Y)var Pe=Y.dgst;Y=Pe,S=Error(c(419)),S.stack="",S.digest=Y,jf({value:S,source:null,stack:null}),d=SE(l,d,_)}else if(Jr||Hd(l,d,_,!1),Y=(_&l.childLanes)!==0,Jr||Y){if(Y=Zn,Y!==null&&(S=Ef(Y,_),S!==0&&S!==pe.retryLane))throw pe.retryLane=S,lo(l,S),Ta(Y,l,S),gE;a0(ne)||ap(),d=SE(l,d,_)}else a0(ne)?(d.flags|=192,d.child=l.child,d=null):(l=pe.treeContext,lr=ps(ne.nextSibling),Ni=d,Sn=!0,fo=null,cs=!1,l!==null&&MT(d,l),d=ah(d,S.children),d.flags|=4096);return d}return x?(uc(),ne=S.fallback,x=d.mode,pe=l.child,Pe=pe.sibling,S=Ds(pe,{mode:"hidden",children:S.children}),S.subtreeFlags=pe.subtreeFlags&65011712,Pe!==null?ne=Ds(Pe,ne):(ne=vi(ne,x,_,null),ne.flags|=2),ne.return=d,S.return=d,S.sibling=ne,d.child=S,Qf(null,S),S=d.child,ne=l.child.memoizedState,ne===null?ne=Ng(_):(x=ne.cachePool,x!==null?(pe=qr._currentValue,x=x.parent!==pe?{parent:pe,pool:pe}:x):x=BT(),ne={baseLanes:ne.baseLanes|_,cachePool:x}),S.memoizedState=ne,S.childLanes=xg(l,Y,_),d.memoizedState=EE,Qf(l.child,S)):(fl(d),_=l.child,l=_.sibling,_=Ds(_,{mode:"visible",children:S.children}),_.return=d,_.sibling=null,l!==null&&(Y=d.deletions,Y===null?(d.deletions=[l],d.flags|=16):Y.push(l)),d.child=_,d.memoizedState=null,_)}function ah(l,d){return d=tp({mode:"visible",children:d},l.mode),d.return=l,l.child=d}function tp(l,d){return l=Va(22,l,null,d),l.lanes=0,l}function SE(l,d,_){return cc(d,l.child,null,_),l=ah(d,d.pendingProps.children),l.flags|=2,d.memoizedState=null,l}function ww(l,d,_){l.lanes|=d;var S=l.alternate;S!==null&&(S.lanes|=d),Gd(l.return,d,_)}function bE(l,d,_,S,x,P){var Y=l.memoizedState;Y===null?l.memoizedState={isBackwards:d,rendering:null,renderingStartTime:0,last:S,tail:_,tailMode:x,treeForkCount:P}:(Y.isBackwards=d,Y.rendering=null,Y.renderingStartTime=0,Y.last=S,Y.tail=_,Y.tailMode=x,Y.treeForkCount=P)}function np(l,d,_){var S=d.pendingProps,x=S.revealOrder,P=S.tail;S=S.children;var Y=Br.current,ne=(Y&2)!==0;if(ne?(Y=Y&1|2,d.flags|=128):Y&=1,it(Br,Y),xi(l,d,S,_),S=Sn?Lf:0,!ne&&l!==null&&(l.flags&128)!==0)e:for(l=d.child;l!==null;){if(l.tag===13)l.memoizedState!==null&&ww(l,_,d);else if(l.tag===19)ww(l,_,d);else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===d)break e;for(;l.sibling===null;){if(l.return===null||l.return===d)break e;l=l.return}l.sibling.return=l.return,l=l.sibling}switch(x){case"forwards":for(_=d.child,x=null;_!==null;)l=_.alternate,l!==null&&pg(l)===null&&(x=_),_=_.sibling;_=x,_===null?(x=d.child,d.child=null):(x=_.sibling,_.sibling=null),bE(d,!1,x,_,P,S);break;case"backwards":case"unstable_legacy-backwards":for(_=null,x=d.child,d.child=null;x!==null;){if(l=x.alternate,l!==null&&pg(l)===null){d.child=x;break}l=x.sibling,x.sibling=_,_=x,x=l}bE(d,!0,_,null,P,S);break;case"together":bE(d,!1,null,null,void 0,S);break;default:d.memoizedState=null}return d.child}function mc(l,d,_){if(l!==null&&(d.dependencies=l.dependencies),Sc|=d.lanes,(_&d.childLanes)===0)if(l!==null){if(Hd(l,d,_,!1),(_&d.childLanes)===0)return null}else return null;if(l!==null&&d.child!==l.child)throw Error(c(153));if(d.child!==null){for(l=d.child,_=Ds(l,l.pendingProps),d.child=_,_.return=d;l.sibling!==null;)l=l.sibling,_=_.sibling=Ds(l,l.pendingProps),_.return=d;_.sibling=null}return d.child}function TE(l,d){return(l.lanes&d)!==0?!0:(l=l.dependencies,!!(l!==null&&ag(l)))}function JN(l,d,_){switch(d.tag){case 3:ai(d,d.stateNode.containerInfo),cl(d,qr,l.memoizedState.cache),uu();break;case 27:case 5:qt(d);break;case 4:ai(d,d.stateNode.containerInfo);break;case 10:cl(d,d.type,d.memoizedProps.value);break;case 31:if(d.memoizedState!==null)return d.flags|=128,fg(d),null;break;case 13:var S=d.memoizedState;if(S!==null)return S.dehydrated!==null?(fl(d),d.flags|=128,null):(_&d.child.childLanes)!==0?Tw(l,d,_):(fl(d),l=mc(l,d,_),l!==null?l.sibling:null);fl(d);break;case 19:var x=(l.flags&128)!==0;if(S=(_&d.childLanes)!==0,S||(Hd(l,d,_,!1),S=(_&d.childLanes)!==0),x){if(S)return np(l,d,_);d.flags|=128}if(x=d.memoizedState,x!==null&&(x.rendering=null,x.tail=null,x.lastEffect=null),it(Br,Br.current),S)break;return null;case 22:return d.lanes=0,vE(l,d,_,d.pendingProps);case 24:cl(d,qr,l.memoizedState.cache)}return mc(l,d,_)}function wE(l,d,_){if(l!==null)if(l.memoizedProps!==d.pendingProps)Jr=!0;else{if(!TE(l,_)&&(d.flags&128)===0)return Jr=!1,JN(l,d,_);Jr=(l.flags&131072)!==0}else Jr=!1,Sn&&(d.flags&1048576)!==0&&Mf(d,Lf,d.index);switch(d.lanes=0,d.tag){case 16:e:{var S=d.pendingProps;if(l=ll(d.elementType),d.type=l,typeof l=="function")Dy(l)?(S=gl(l,S),d.tag=1,d=yE(null,d,l,S,_)):(d.tag=0,d=Ig(null,d,l,S,_));else{if(l!=null){var x=l.$$typeof;if(x===ce){d.tag=11,d=vw(null,d,l,S,_);break e}else if(x===oe){d.tag=14,d=yw(null,d,l,S,_);break e}}throw d=et(l)||l,Error(c(306,d,""))}}return d;case 0:return Ig(l,d,d.type,d.pendingProps,_);case 1:return S=d.type,x=gl(S,d.pendingProps),yE(l,d,S,x,_);case 3:e:{if(ai(d,d.stateNode.containerInfo),l===null)throw Error(c(387));S=d.pendingProps;var P=d.memoizedState;x=P.element,vu(l,d),Kf(d,S,null,_);var Y=d.memoizedState;if(S=Y.cache,cl(d,qr,S),S!==P.cache&&Vf(d,[qr],_,!0),Jd(),S=Y.element,P.isDehydrated)if(P={element:S,isDehydrated:!1,cache:Y.cache},d.updateQueue.baseState=P,d.memoizedState=P,d.flags&256){d=ep(l,d,S,_);break e}else if(S!==x){x=ss(Error(c(424)),d),jf(x),d=ep(l,d,S,_);break e}else{switch(l=d.stateNode.containerInfo,l.nodeType){case 9:l=l.body;break;default:l=l.nodeName==="HTML"?l.ownerDocument.body:l}for(lr=ps(l.firstChild),Ni=d,Sn=!0,fo=null,cs=!0,_=zy(d,null,S,_),d.child=_;_;)_.flags=_.flags&-3|4096,_=_.sibling}else{if(uu(),S===x){d=mc(l,d,_);break e}xi(l,d,S,_)}d=d.child}return d;case 26:return Ru(l,d),l===null?(_=_R(d.type,null,d.pendingProps,null))?d.memoizedState=_:Sn||(_=d.type,l=d.pendingProps,S=Zg(rn.current).createElement(_),S[mi]=d,S[va]=l,Di(S,_,l),gi(S),d.stateNode=S):d.memoizedState=_R(d.type,l.memoizedProps,d.pendingProps,l.memoizedState),null;case 27:return qt(d),l===null&&Sn&&(S=d.stateNode=pR(d.type,d.pendingProps,rn.current),Ni=d,cs=!0,x=lr,Tl(d.type)?(o0=x,lr=ps(S.firstChild)):lr=x),xi(l,d,d.pendingProps.children,_),Ru(l,d),l===null&&(d.flags|=4194304),d.child;case 5:return l===null&&Sn&&((x=S=lr)&&(S=hx(S,d.type,d.pendingProps,cs),S!==null?(d.stateNode=S,Ni=d,lr=ps(S.firstChild),cs=!1,x=!0):x=!1),x||ol(d)),qt(d),x=d.type,P=d.pendingProps,Y=l!==null?l.memoizedProps:null,S=P.children,n0(x,P)?S=null:Y!==null&&n0(x,Y)&&(d.flags|=32),d.memoizedState!==null&&(x=Xy(l,d,WN,null,null,_),mp._currentValue=x),Ru(l,d),xi(l,d,S,_),d.child;case 6:return l===null&&Sn&&((l=_=lr)&&(_=fx(_,d.pendingProps,cs),_!==null?(d.stateNode=_,Ni=d,lr=null,l=!0):l=!1),l||ol(d)),null;case 13:return Tw(l,d,_);case 4:return ai(d,d.stateNode.containerInfo),S=d.pendingProps,l===null?d.child=cc(d,null,S,_):xi(l,d,S,_),d.child;case 11:return vw(l,d,d.type,d.pendingProps,_);case 7:return xi(l,d,d.pendingProps,_),d.child;case 8:return xi(l,d,d.pendingProps.children,_),d.child;case 12:return xi(l,d,d.pendingProps.children,_),d.child;case 10:return S=d.pendingProps,cl(d,d.type,S.value),xi(l,d,S.children,_),d.child;case 9:return x=d.type._context,S=d.pendingProps.children,hu(d),x=yi(x),S=S(x),d.flags|=1,xi(l,d,S,_),d.child;case 14:return yw(l,d,d.type,d.pendingProps,_);case 15:return _E(l,d,d.type,d.pendingProps,_);case 19:return np(l,d,_);case 31:return Sw(l,d,_);case 22:return vE(l,d,_,d.pendingProps);case 24:return hu(d),S=yi(qr),l===null?(x=Fy(),x===null&&(x=Zn,P=Vy(),x.pooledCache=P,P.refCount++,P!==null&&(x.pooledCacheLanes|=_),x=P),d.memoizedState={parent:S,cache:x},qd(d),cl(d,qr,x)):((l.lanes&_)!==0&&(vu(l,d),Kf(d,null,null,_),Jd()),x=l.memoizedState,P=d.memoizedState,x.parent!==S?(x={parent:S,cache:S},d.memoizedState=x,d.lanes===0&&(d.memoizedState=d.updateQueue.baseState=x),cl(d,qr,S)):(S=P.cache,cl(d,qr,S),S!==x.cache&&Vf(d,[qr],_,!0))),xi(l,d,d.pendingProps.children,_),d.child;case 29:throw d.pendingProps}throw Error(c(156,d.tag))}function gc(l){l.flags|=4}function RE(l,d,_,S,x){if((d=(l.mode&32)!==0)&&(d=!1),d){if(l.flags|=16777216,(x&335544128)===x)if(l.stateNode.complete)l.flags|=8192;else if(Fw())l.flags|=8192;else throw gu=lg,Gy}else l.flags&=-16777217}function Dg(l,d){if(d.type!=="stylesheet"||(d.state.loading&4)!==0)l.flags&=-16777217;else if(l.flags|=16777216,!ER(d))if(Fw())l.flags|=8192;else throw gu=lg,Gy}function Pg(l,d){d!==null&&(l.flags|=4),l.flags&16384&&(d=l.tag!==22?Xb():536870912,l.lanes|=d,dh|=d)}function Cu(l,d){if(!Sn)switch(l.tailMode){case"hidden":d=l.tail;for(var _=null;d!==null;)d.alternate!==null&&(_=d),d=d.sibling;_===null?l.tail=null:_.sibling=null;break;case"collapsed":_=l.tail;for(var S=null;_!==null;)_.alternate!==null&&(S=_),_=_.sibling;S===null?d||l.tail===null?l.tail=null:l.tail.sibling=null:S.sibling=null}}function ur(l){var d=l.alternate!==null&&l.alternate.child===l.child,_=0,S=0;if(d)for(var x=l.child;x!==null;)_|=x.lanes|x.childLanes,S|=x.subtreeFlags&65011712,S|=x.flags&65011712,x.return=l,x=x.sibling;else for(x=l.child;x!==null;)_|=x.lanes|x.childLanes,S|=x.subtreeFlags,S|=x.flags,x.return=l,x=x.sibling;return l.subtreeFlags|=S,l.childLanes=_,d}function Rw(l,d,_){var S=d.pendingProps;switch(My(d),d.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ur(d),null;case 1:return ur(d),null;case 3:return _=d.stateNode,S=null,l!==null&&(S=l.memoizedState.cache),d.memoizedState.cache!==S&&(d.flags|=2048),ls(qr),qe(),_.pendingContext&&(_.context=_.pendingContext,_.pendingContext=null),(l===null||l.child===null)&&(Fd(d)?gc(d):l===null||l.memoizedState.isDehydrated&&(d.flags&256)===0||(d.flags|=1024,Uy())),ur(d),null;case 26:var x=d.type,P=d.memoizedState;return l===null?(gc(d),P!==null?(ur(d),Dg(d,P)):(ur(d),RE(d,x,null,S,_))):P?P!==l.memoizedState?(gc(d),ur(d),Dg(d,P)):(ur(d),d.flags&=-16777217):(l=l.memoizedProps,l!==S&&gc(d),ur(d),RE(d,x,l,S,_)),null;case 27:if(gn(d),_=rn.current,x=d.type,l!==null&&d.stateNode!=null)l.memoizedProps!==S&&gc(d);else{if(!S){if(d.stateNode===null)throw Error(c(166));return ur(d),null}l=dt.current,Fd(d)?UT(d):(l=pR(x,S,_),d.stateNode=l,gc(d))}return ur(d),null;case 5:if(gn(d),x=d.type,l!==null&&d.stateNode!=null)l.memoizedProps!==S&&gc(d);else{if(!S){if(d.stateNode===null)throw Error(c(166));return ur(d),null}if(P=dt.current,Fd(d))UT(d);else{var Y=Zg(rn.current);switch(P){case 1:P=Y.createElementNS("http://www.w3.org/2000/svg",x);break;case 2:P=Y.createElementNS("http://www.w3.org/1998/Math/MathML",x);break;default:switch(x){case"svg":P=Y.createElementNS("http://www.w3.org/2000/svg",x);break;case"math":P=Y.createElementNS("http://www.w3.org/1998/Math/MathML",x);break;case"script":P=Y.createElement("div"),P.innerHTML="<script><\/script>",P=P.removeChild(P.firstChild);break;case"select":P=typeof S.is=="string"?Y.createElement("select",{is:S.is}):Y.createElement("select"),S.multiple?P.multiple=!0:S.size&&(P.size=S.size);break;default:P=typeof S.is=="string"?Y.createElement(x,{is:S.is}):Y.createElement(x)}}P[mi]=d,P[va]=S;e:for(Y=d.child;Y!==null;){if(Y.tag===5||Y.tag===6)P.appendChild(Y.stateNode);else if(Y.tag!==4&&Y.tag!==27&&Y.child!==null){Y.child.return=Y,Y=Y.child;continue}if(Y===d)break e;for(;Y.sibling===null;){if(Y.return===null||Y.return===d)break e;Y=Y.return}Y.sibling.return=Y.return,Y=Y.sibling}d.stateNode=P;e:switch(Di(P,x,S),x){case"button":case"input":case"select":case"textarea":S=!!S.autoFocus;break e;case"img":S=!0;break e;default:S=!1}S&&gc(d)}}return ur(d),RE(d,d.type,l===null?null:l.memoizedProps,d.pendingProps,_),null;case 6:if(l&&d.stateNode!=null)l.memoizedProps!==S&&gc(d);else{if(typeof S!="string"&&d.stateNode===null)throw Error(c(166));if(l=rn.current,Fd(d)){if(l=d.stateNode,_=d.memoizedProps,S=null,x=Ni,x!==null)switch(x.tag){case 27:case 5:S=x.memoizedProps}l[mi]=d,l=!!(l.nodeValue===_||S!==null&&S.suppressHydrationWarning===!0||rR(l.nodeValue,_)),l||ol(d,!0)}else l=Zg(l).createTextNode(S),l[mi]=d,d.stateNode=l}return ur(d),null;case 31:if(_=d.memoizedState,l===null||l.memoizedState!==null){if(S=Fd(d),_!==null){if(l===null){if(!S)throw Error(c(318));if(l=d.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(c(557));l[mi]=d}else uu(),(d.flags&128)===0&&(d.memoizedState=null),d.flags|=4;ur(d),l=!1}else _=Uy(),l!==null&&l.memoizedState!==null&&(l.memoizedState.hydrationErrors=_),l=!0;if(!l)return d.flags&256?(Fa(d),d):(Fa(d),null);if((d.flags&128)!==0)throw Error(c(558))}return ur(d),null;case 13:if(S=d.memoizedState,l===null||l.memoizedState!==null&&l.memoizedState.dehydrated!==null){if(x=Fd(d),S!==null&&S.dehydrated!==null){if(l===null){if(!x)throw Error(c(318));if(x=d.memoizedState,x=x!==null?x.dehydrated:null,!x)throw Error(c(317));x[mi]=d}else uu(),(d.flags&128)===0&&(d.memoizedState=null),d.flags|=4;ur(d),x=!1}else x=Uy(),l!==null&&l.memoizedState!==null&&(l.memoizedState.hydrationErrors=x),x=!0;if(!x)return d.flags&256?(Fa(d),d):(Fa(d),null)}return Fa(d),(d.flags&128)!==0?(d.lanes=_,d):(_=S!==null,l=l!==null&&l.memoizedState!==null,_&&(S=d.child,x=null,S.alternate!==null&&S.alternate.memoizedState!==null&&S.alternate.memoizedState.cachePool!==null&&(x=S.alternate.memoizedState.cachePool.pool),P=null,S.memoizedState!==null&&S.memoizedState.cachePool!==null&&(P=S.memoizedState.cachePool.pool),P!==x&&(S.flags|=2048)),_!==l&&_&&(d.child.flags|=8192),Pg(d,d.updateQueue),ur(d),null);case 4:return qe(),l===null&&XE(d.stateNode.containerInfo),ur(d),null;case 10:return ls(d.type),ur(d),null;case 19:if(Ve(Br),S=d.memoizedState,S===null)return ur(d),null;if(x=(d.flags&128)!==0,P=S.rendering,P===null)if(x)Cu(S,!1);else{if(Rr!==0||l!==null&&(l.flags&128)!==0)for(l=d.child;l!==null;){if(P=pg(l),P!==null){for(d.flags|=128,Cu(S,!1),l=P.updateQueue,d.updateQueue=l,Pg(d,l),d.subtreeFlags=0,l=_,_=d.child;_!==null;)kT(_,l),_=_.sibling;return it(Br,Br.current&1|2),Sn&&ho(d,S.treeForkCount),d.child}l=l.sibling}S.tail!==null&&Yn()>Bg&&(d.flags|=128,x=!0,Cu(S,!1),d.lanes=4194304)}else{if(!x)if(l=pg(P),l!==null){if(d.flags|=128,x=!0,l=l.updateQueue,d.updateQueue=l,Pg(d,l),Cu(S,!0),S.tail===null&&S.tailMode==="hidden"&&!P.alternate&&!Sn)return ur(d),null}else 2*Yn()-S.renderingStartTime>Bg&&_!==536870912&&(d.flags|=128,x=!0,Cu(S,!1),d.lanes=4194304);S.isBackwards?(P.sibling=d.child,d.child=P):(l=S.last,l!==null?l.sibling=P:d.child=P,S.last=P)}return S.tail!==null?(l=S.tail,S.rendering=l,S.tail=l.sibling,S.renderingStartTime=Yn(),l.sibling=null,_=Br.current,it(Br,x?_&1|2:_&1),Sn&&ho(d,S.treeForkCount),l):(ur(d),null);case 22:case 23:return Fa(d),hl(),S=d.memoizedState!==null,l!==null?l.memoizedState!==null!==S&&(d.flags|=8192):S&&(d.flags|=8192),S?(_&536870912)!==0&&(d.flags&128)===0&&(ur(d),d.subtreeFlags&6&&(d.flags|=8192)):ur(d),_=d.updateQueue,_!==null&&Pg(d,_.retryQueue),_=null,l!==null&&l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(_=l.memoizedState.cachePool.pool),S=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(S=d.memoizedState.cachePool.pool),S!==_&&(d.flags|=2048),l!==null&&Ve(pu),null;case 24:return _=null,l!==null&&(_=l.memoizedState.cache),d.memoizedState.cache!==_&&(d.flags|=2048),ls(qr),ur(d),null;case 25:return null;case 30:return null}throw Error(c(156,d.tag))}function $N(l,d){switch(My(d),d.tag){case 1:return l=d.flags,l&65536?(d.flags=l&-65537|128,d):null;case 3:return ls(qr),qe(),l=d.flags,(l&65536)!==0&&(l&128)===0?(d.flags=l&-65537|128,d):null;case 26:case 27:case 5:return gn(d),null;case 31:if(d.memoizedState!==null){if(Fa(d),d.alternate===null)throw Error(c(340));uu()}return l=d.flags,l&65536?(d.flags=l&-65537|128,d):null;case 13:if(Fa(d),l=d.memoizedState,l!==null&&l.dehydrated!==null){if(d.alternate===null)throw Error(c(340));uu()}return l=d.flags,l&65536?(d.flags=l&-65537|128,d):null;case 19:return Ve(Br),null;case 4:return qe(),null;case 10:return ls(d.type),null;case 22:case 23:return Fa(d),hl(),l!==null&&Ve(pu),l=d.flags,l&65536?(d.flags=l&-65537|128,d):null;case 24:return ls(qr),null;case 25:return null;default:return null}}function Cw(l,d){switch(My(d),d.tag){case 3:ls(qr),qe();break;case 26:case 27:case 5:gn(d);break;case 4:qe();break;case 31:d.memoizedState!==null&&Fa(d);break;case 13:Fa(d);break;case 19:Ve(Br);break;case 10:ls(d.type);break;case 22:case 23:Fa(d),hl(),l!==null&&Ve(pu);break;case 24:ls(qr)}}function sh(l,d){try{var _=d.updateQueue,S=_!==null?_.lastEffect:null;if(S!==null){var x=S.next;_=x;do{if((_.tag&l)===l){S=void 0;var P=_.create,Y=_.inst;S=P(),Y.destroy=S}_=_.next}while(_!==x)}}catch(ne){jn(d,d.return,ne)}}function _l(l,d,_){try{var S=d.updateQueue,x=S!==null?S.lastEffect:null;if(x!==null){var P=x.next;S=P;do{if((S.tag&l)===l){var Y=S.inst,ne=Y.destroy;if(ne!==void 0){Y.destroy=void 0,x=d;var pe=_,Pe=ne;try{Pe()}catch(We){jn(x,pe,We)}}}S=S.next}while(S!==P)}}catch(We){jn(d,d.return,We)}}function Aw(l){var d=l.updateQueue;if(d!==null){var _=l.stateNode;try{WT(d,_)}catch(S){jn(l,l.return,S)}}}function CE(l,d,_){_.props=gl(l.type,l.memoizedProps),_.state=l.memoizedState;try{_.componentWillUnmount()}catch(S){jn(l,d,S)}}function oh(l,d){try{var _=l.ref;if(_!==null){switch(l.tag){case 26:case 27:case 5:var S=l.stateNode;break;case 30:S=l.stateNode;break;default:S=l.stateNode}typeof _=="function"?l.refCleanup=_(S):_.current=S}}catch(x){jn(l,d,x)}}function hs(l,d){var _=l.ref,S=l.refCleanup;if(_!==null)if(typeof S=="function")try{S()}catch(x){jn(l,d,x)}finally{l.refCleanup=null,l=l.alternate,l!=null&&(l.refCleanup=null)}else if(typeof _=="function")try{_(null)}catch(x){jn(l,d,x)}else _.current=null}function Ow(l){var d=l.type,_=l.memoizedProps,S=l.stateNode;try{e:switch(d){case"button":case"input":case"select":case"textarea":_.autoFocus&&S.focus();break e;case"img":_.src?S.src=_.src:_.srcSet&&(S.srcset=_.srcSet)}}catch(x){jn(l,l.return,x)}}function AE(l,d,_){try{var S=l.stateNode;sx(S,l.type,_,d),S[va]=d}catch(x){jn(l,l.return,x)}}function ch(l){return l.tag===5||l.tag===3||l.tag===26||l.tag===27&&Tl(l.type)||l.tag===4}function kg(l){e:for(;;){for(;l.sibling===null;){if(l.return===null||ch(l.return))return null;l=l.return}for(l.sibling.return=l.return,l=l.sibling;l.tag!==5&&l.tag!==6&&l.tag!==18;){if(l.tag===27&&Tl(l.type)||l.flags&2||l.child===null||l.tag===4)continue e;l.child.return=l,l=l.child}if(!(l.flags&2))return l.stateNode}}function Au(l,d,_){var S=l.tag;if(S===5||S===6)l=l.stateNode,d?(_.nodeType===9?_.body:_.nodeName==="HTML"?_.ownerDocument.body:_).insertBefore(l,d):(d=_.nodeType===9?_.body:_.nodeName==="HTML"?_.ownerDocument.body:_,d.appendChild(l),_=_._reactRootContainer,_!=null||d.onclick!==null||(d.onclick=rc));else if(S!==4&&(S===27&&Tl(l.type)&&(_=l.stateNode,d=null),l=l.child,l!==null))for(Au(l,d,_),l=l.sibling;l!==null;)Au(l,d,_),l=l.sibling}function _c(l,d,_){var S=l.tag;if(S===5||S===6)l=l.stateNode,d?_.insertBefore(l,d):_.appendChild(l);else if(S!==4&&(S===27&&Tl(l.type)&&(_=l.stateNode),l=l.child,l!==null))for(_c(l,d,_),l=l.sibling;l!==null;)_c(l,d,_),l=l.sibling}function OE(l){var d=l.stateNode,_=l.memoizedProps;try{for(var S=l.type,x=d.attributes;x.length;)d.removeAttributeNode(x[0]);Di(d,S,_),d[mi]=l,d[va]=_}catch(P){jn(l,l.return,P)}}var Ls=!1,wr=!1,IE=!1,Iw=typeof WeakSet=="function"?WeakSet:Set,Ei=null;function Nw(l,d){if(l=l.containerInfo,QE=gp,l=OT(l),Hi(l)){if("selectionStart"in l)var _={start:l.selectionStart,end:l.selectionEnd};else e:{_=(_=l.ownerDocument)&&_.defaultView||window;var S=_.getSelection&&_.getSelection();if(S&&S.rangeCount!==0){_=S.anchorNode;var x=S.anchorOffset,P=S.focusNode;S=S.focusOffset;try{_.nodeType,P.nodeType}catch{_=null;break e}var Y=0,ne=-1,pe=-1,Pe=0,We=0,Ze=l,Me=null;t:for(;;){for(var Be;Ze!==_||x!==0&&Ze.nodeType!==3||(ne=Y+x),Ze!==P||S!==0&&Ze.nodeType!==3||(pe=Y+S),Ze.nodeType===3&&(Y+=Ze.nodeValue.length),(Be=Ze.firstChild)!==null;)Me=Ze,Ze=Be;for(;;){if(Ze===l)break t;if(Me===_&&++Pe===x&&(ne=Y),Me===P&&++We===S&&(pe=Y),(Be=Ze.nextSibling)!==null)break;Ze=Me,Me=Ze.parentNode}Ze=Be}_=ne===-1||pe===-1?null:{start:ne,end:pe}}else _=null}_=_||{start:0,end:0}}else _=null;for(e0={focusedElem:l,selectionRange:_},gp=!1,Ei=d;Ei!==null;)if(d=Ei,l=d.child,(d.subtreeFlags&1028)!==0&&l!==null)l.return=d,Ei=l;else for(;Ei!==null;){switch(d=Ei,P=d.alternate,l=d.flags,d.tag){case 0:if((l&4)!==0&&(l=d.updateQueue,l=l!==null?l.events:null,l!==null))for(_=0;_<l.length;_++)x=l[_],x.ref.impl=x.nextImpl;break;case 11:case 15:break;case 1:if((l&1024)!==0&&P!==null){l=void 0,_=d,x=P.memoizedProps,P=P.memoizedState,S=_.stateNode;try{var Et=gl(_.type,x);l=S.getSnapshotBeforeUpdate(Et,P),S.__reactInternalSnapshotBeforeUpdate=l}catch(Pt){jn(_,_.return,Pt)}}break;case 3:if((l&1024)!==0){if(l=d.stateNode.containerInfo,_=l.nodeType,_===9)i0(l);else if(_===1)switch(l.nodeName){case"HEAD":case"HTML":case"BODY":i0(l);break;default:l.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((l&1024)!==0)throw Error(c(163))}if(l=d.sibling,l!==null){l.return=d.return,Ei=l;break}Ei=d.return}}function xw(l,d,_){var S=_.flags;switch(_.tag){case 0:case 11:case 15:vc(l,_),S&4&&sh(5,_);break;case 1:if(vc(l,_),S&4)if(l=_.stateNode,d===null)try{l.componentDidMount()}catch(Y){jn(_,_.return,Y)}else{var x=gl(_.type,d.memoizedProps);d=d.memoizedState;try{l.componentDidUpdate(x,d,l.__reactInternalSnapshotBeforeUpdate)}catch(Y){jn(_,_.return,Y)}}S&64&&Aw(_),S&512&&oh(_,_.return);break;case 3:if(vc(l,_),S&64&&(l=_.updateQueue,l!==null)){if(d=null,_.child!==null)switch(_.child.tag){case 27:case 5:d=_.child.stateNode;break;case 1:d=_.child.stateNode}try{WT(l,d)}catch(Y){jn(_,_.return,Y)}}break;case 27:d===null&&S&4&&OE(_);case 26:case 5:vc(l,_),d===null&&S&4&&Ow(_),S&512&&oh(_,_.return);break;case 12:vc(l,_);break;case 31:vc(l,_),S&4&&vl(l,_);break;case 13:vc(l,_),S&4&&NE(l,_),S&64&&(l=_.memoizedState,l!==null&&(l=l.dehydrated,l!==null&&(_=$w.bind(null,_),dR(l,_))));break;case 22:if(S=_.memoizedState!==null||Ls,!S){d=d!==null&&d.memoizedState!==null||wr,x=Ls;var P=wr;Ls=S,(wr=d)&&!P?yc(l,_,(_.subtreeFlags&8772)!==0):vc(l,_),Ls=x,wr=P}break;case 30:break;default:vc(l,_)}}function Dw(l){var d=l.alternate;d!==null&&(l.alternate=null,Dw(d)),l.child=null,l.deletions=null,l.sibling=null,l.tag===5&&(d=l.stateNode,d!==null&&il(d)),l.stateNode=null,l.return=null,l.dependencies=null,l.memoizedProps=null,l.memoizedState=null,l.pendingProps=null,l.stateNode=null,l.updateQueue=null}var _r=null,Wi=!1;function zi(l,d,_){for(_=_.child;_!==null;)Pw(l,d,_),_=_.sibling}function Pw(l,d,_){if(si&&typeof si.onCommitFiberUnmount=="function")try{si.onCommitFiberUnmount(Ed,_)}catch{}switch(_.tag){case 26:wr||hs(_,d),zi(l,d,_),_.memoizedState?_.memoizedState.count--:_.stateNode&&(_=_.stateNode,_.parentNode.removeChild(_));break;case 27:wr||hs(_,d);var S=_r,x=Wi;Tl(_.type)&&(_r=_.stateNode,Wi=!1),zi(l,d,_),Sh(_.stateNode),_r=S,Wi=x;break;case 5:wr||hs(_,d);case 6:if(S=_r,x=Wi,_r=null,zi(l,d,_),_r=S,Wi=x,_r!==null)if(Wi)try{(_r.nodeType===9?_r.body:_r.nodeName==="HTML"?_r.ownerDocument.body:_r).removeChild(_.stateNode)}catch(P){jn(_,d,P)}else try{_r.removeChild(_.stateNode)}catch(P){jn(_,d,P)}break;case 18:_r!==null&&(Wi?(l=_r,cR(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,_.stateNode),Rh(l)):cR(_r,_.stateNode));break;case 4:S=_r,x=Wi,_r=_.stateNode.containerInfo,Wi=!0,zi(l,d,_),_r=S,Wi=x;break;case 0:case 11:case 14:case 15:_l(2,_,d),wr||_l(4,_,d),zi(l,d,_);break;case 1:wr||(hs(_,d),S=_.stateNode,typeof S.componentWillUnmount=="function"&&CE(_,d,S)),zi(l,d,_);break;case 21:zi(l,d,_);break;case 22:wr=(S=wr)||_.memoizedState!==null,zi(l,d,_),wr=S;break;default:zi(l,d,_)}}function vl(l,d){if(d.memoizedState===null&&(l=d.alternate,l!==null&&(l=l.memoizedState,l!==null))){l=l.dehydrated;try{Rh(l)}catch(_){jn(d,d.return,_)}}}function NE(l,d){if(d.memoizedState===null&&(l=d.alternate,l!==null&&(l=l.memoizedState,l!==null&&(l=l.dehydrated,l!==null))))try{Rh(l)}catch(_){jn(d,d.return,_)}}function Ga(l){switch(l.tag){case 31:case 13:case 19:var d=l.stateNode;return d===null&&(d=l.stateNode=new Iw),d;case 22:return l=l.stateNode,d=l._retryCache,d===null&&(d=l._retryCache=new Iw),d;default:throw Error(c(435,l.tag))}}function Lg(l,d){var _=Ga(l);d.forEach(function(S){if(!_.has(S)){_.add(S);var x=HE.bind(null,l,S);S.then(x,x)}})}function Sa(l,d){var _=d.deletions;if(_!==null)for(var S=0;S<_.length;S++){var x=_[S],P=l,Y=d,ne=Y;e:for(;ne!==null;){switch(ne.tag){case 27:if(Tl(ne.type)){_r=ne.stateNode,Wi=!1;break e}break;case 5:_r=ne.stateNode,Wi=!1;break e;case 3:case 4:_r=ne.stateNode.containerInfo,Wi=!0;break e}ne=ne.return}if(_r===null)throw Error(c(160));Pw(P,Y,x),_r=null,Wi=!1,P=x.alternate,P!==null&&(P.return=null),x.return=null}if(d.subtreeFlags&13886)for(d=d.child;d!==null;)kw(d,l),d=d.sibling}var fs=null;function kw(l,d){var _=l.alternate,S=l.flags;switch(l.tag){case 0:case 11:case 14:case 15:Sa(d,l),sa(l),S&4&&(_l(3,l,l.return),sh(3,l),_l(5,l,l.return));break;case 1:Sa(d,l),sa(l),S&512&&(wr||_===null||hs(_,_.return)),S&64&&Ls&&(l=l.updateQueue,l!==null&&(S=l.callbacks,S!==null&&(_=l.shared.hiddenCallbacks,l.shared.hiddenCallbacks=_===null?S:_.concat(S))));break;case 26:var x=fs;if(Sa(d,l),sa(l),S&512&&(wr||_===null||hs(_,_.return)),S&4){var P=_!==null?_.memoizedState:null;if(S=l.memoizedState,_===null)if(S===null)if(l.stateNode===null){e:{S=l.type,_=l.memoizedProps,x=x.ownerDocument||x;t:switch(S){case"title":P=x.getElementsByTagName("title")[0],(!P||P[wd]||P[mi]||P.namespaceURI==="http://www.w3.org/2000/svg"||P.hasAttribute("itemprop"))&&(P=x.createElement(S),x.head.insertBefore(P,x.querySelector("head > title"))),Di(P,S,_),P[mi]=l,gi(P),S=P;break e;case"link":var Y=vR("link","href",x).get(S+(_.href||""));if(Y){for(var ne=0;ne<Y.length;ne++)if(P=Y[ne],P.getAttribute("href")===(_.href==null||_.href===""?null:_.href)&&P.getAttribute("rel")===(_.rel==null?null:_.rel)&&P.getAttribute("title")===(_.title==null?null:_.title)&&P.getAttribute("crossorigin")===(_.crossOrigin==null?null:_.crossOrigin)){Y.splice(ne,1);break t}}P=x.createElement(S),Di(P,S,_),x.head.appendChild(P);break;case"meta":if(Y=vR("meta","content",x).get(S+(_.content||""))){for(ne=0;ne<Y.length;ne++)if(P=Y[ne],P.getAttribute("content")===(_.content==null?null:""+_.content)&&P.getAttribute("name")===(_.name==null?null:_.name)&&P.getAttribute("property")===(_.property==null?null:_.property)&&P.getAttribute("http-equiv")===(_.httpEquiv==null?null:_.httpEquiv)&&P.getAttribute("charset")===(_.charSet==null?null:_.charSet)){Y.splice(ne,1);break t}}P=x.createElement(S),Di(P,S,_),x.head.appendChild(P);break;default:throw Error(c(468,S))}P[mi]=l,gi(P),S=P}l.stateNode=S}else yR(x,l.type,l.stateNode);else l.stateNode=f0(x,S,l.memoizedProps);else P!==S?(P===null?_.stateNode!==null&&(_=_.stateNode,_.parentNode.removeChild(_)):P.count--,S===null?yR(x,l.type,l.stateNode):f0(x,S,l.memoizedProps)):S===null&&l.stateNode!==null&&AE(l,l.memoizedProps,_.memoizedProps)}break;case 27:Sa(d,l),sa(l),S&512&&(wr||_===null||hs(_,_.return)),_!==null&&S&4&&AE(l,l.memoizedProps,_.memoizedProps);break;case 5:if(Sa(d,l),sa(l),S&512&&(wr||_===null||hs(_,_.return)),l.flags&32){x=l.stateNode;try{ru(x,"")}catch(Et){jn(l,l.return,Et)}}S&4&&l.stateNode!=null&&(x=l.memoizedProps,AE(l,x,_!==null?_.memoizedProps:x)),S&1024&&(IE=!0);break;case 6:if(Sa(d,l),sa(l),S&4){if(l.stateNode===null)throw Error(c(162));S=l.memoizedProps,_=l.stateNode;try{_.nodeValue=S}catch(Et){jn(l,l.return,Et)}}break;case 3:if(r_=null,x=fs,fs=Qg(d.containerInfo),Sa(d,l),fs=x,sa(l),S&4&&_!==null&&_.memoizedState.isDehydrated)try{Rh(d.containerInfo)}catch(Et){jn(l,l.return,Et)}IE&&(IE=!1,xE(l));break;case 4:S=fs,fs=Qg(l.stateNode.containerInfo),Sa(d,l),sa(l),fs=S;break;case 12:Sa(d,l),sa(l);break;case 31:Sa(d,l),sa(l),S&4&&(S=l.updateQueue,S!==null&&(l.updateQueue=null,Lg(l,S)));break;case 13:Sa(d,l),sa(l),l.child.flags&8192&&l.memoizedState!==null!=(_!==null&&_.memoizedState!==null)&&(Vg=Yn()),S&4&&(S=l.updateQueue,S!==null&&(l.updateQueue=null,Lg(l,S)));break;case 22:x=l.memoizedState!==null;var pe=_!==null&&_.memoizedState!==null,Pe=Ls,We=wr;if(Ls=Pe||x,wr=We||pe,Sa(d,l),wr=We,Ls=Pe,sa(l),S&8192)e:for(d=l.stateNode,d._visibility=x?d._visibility&-2:d._visibility|1,x&&(_===null||pe||Ls||wr||yl(l)),_=null,d=l;;){if(d.tag===5||d.tag===26){if(_===null){pe=_=d;try{if(P=pe.stateNode,x)Y=P.style,typeof Y.setProperty=="function"?Y.setProperty("display","none","important"):Y.display="none";else{ne=pe.stateNode;var Ze=pe.memoizedProps.style,Me=Ze!=null&&Ze.hasOwnProperty("display")?Ze.display:null;ne.style.display=Me==null||typeof Me=="boolean"?"":(""+Me).trim()}}catch(Et){jn(pe,pe.return,Et)}}}else if(d.tag===6){if(_===null){pe=d;try{pe.stateNode.nodeValue=x?"":pe.memoizedProps}catch(Et){jn(pe,pe.return,Et)}}}else if(d.tag===18){if(_===null){pe=d;try{var Be=pe.stateNode;x?lR(Be,!0):lR(pe.stateNode,!1)}catch(Et){jn(pe,pe.return,Et)}}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===l)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===l)break e;for(;d.sibling===null;){if(d.return===null||d.return===l)break e;_===d&&(_=null),d=d.return}_===d&&(_=null),d.sibling.return=d.return,d=d.sibling}S&4&&(S=l.updateQueue,S!==null&&(_=S.retryQueue,_!==null&&(S.retryQueue=null,Lg(l,_))));break;case 19:Sa(d,l),sa(l),S&4&&(S=l.updateQueue,S!==null&&(l.updateQueue=null,Lg(l,S)));break;case 30:break;case 21:break;default:Sa(d,l),sa(l)}}function sa(l){var d=l.flags;if(d&2){try{for(var _,S=l.return;S!==null;){if(ch(S)){_=S;break}S=S.return}if(_==null)throw Error(c(160));switch(_.tag){case 27:var x=_.stateNode,P=kg(l);_c(l,P,x);break;case 5:var Y=_.stateNode;_.flags&32&&(ru(Y,""),_.flags&=-33);var ne=kg(l);_c(l,ne,Y);break;case 3:case 4:var pe=_.stateNode.containerInfo,Pe=kg(l);Au(l,Pe,pe);break;default:throw Error(c(161))}}catch(We){jn(l,l.return,We)}l.flags&=-3}d&4096&&(l.flags&=-4097)}function xE(l){if(l.subtreeFlags&1024)for(l=l.child;l!==null;){var d=l;xE(d),d.tag===5&&d.flags&1024&&d.stateNode.reset(),l=l.sibling}}function vc(l,d){if(d.subtreeFlags&8772)for(d=d.child;d!==null;)xw(l,d.alternate,d),d=d.sibling}function yl(l){for(l=l.child;l!==null;){var d=l;switch(d.tag){case 0:case 11:case 14:case 15:_l(4,d,d.return),yl(d);break;case 1:hs(d,d.return);var _=d.stateNode;typeof _.componentWillUnmount=="function"&&CE(d,d.return,_),yl(d);break;case 27:Sh(d.stateNode);case 26:case 5:hs(d,d.return),yl(d);break;case 22:d.memoizedState===null&&yl(d);break;case 30:yl(d);break;default:yl(d)}l=l.sibling}}function yc(l,d,_){for(_=_&&(d.subtreeFlags&8772)!==0,d=d.child;d!==null;){var S=d.alternate,x=l,P=d,Y=P.flags;switch(P.tag){case 0:case 11:case 15:yc(x,P,_),sh(4,P);break;case 1:if(yc(x,P,_),S=P,x=S.stateNode,typeof x.componentDidMount=="function")try{x.componentDidMount()}catch(Pe){jn(S,S.return,Pe)}if(S=P,x=S.updateQueue,x!==null){var ne=S.stateNode;try{var pe=x.shared.hiddenCallbacks;if(pe!==null)for(x.shared.hiddenCallbacks=null,x=0;x<pe.length;x++)HT(pe[x],ne)}catch(Pe){jn(S,S.return,Pe)}}_&&Y&64&&Aw(P),oh(P,P.return);break;case 27:OE(P);case 26:case 5:yc(x,P,_),_&&S===null&&Y&4&&Ow(P),oh(P,P.return);break;case 12:yc(x,P,_);break;case 31:yc(x,P,_),_&&Y&4&&vl(x,P);break;case 13:yc(x,P,_),_&&Y&4&&NE(x,P);break;case 22:P.memoizedState===null&&yc(x,P,_),oh(P,P.return);break;case 30:break;default:yc(x,P,_)}d=d.sibling}}function DE(l,d){var _=null;l!==null&&l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(_=l.memoizedState.cachePool.pool),l=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(l=d.memoizedState.cachePool.pool),l!==_&&(l!=null&&l.refCount++,_!=null&&Gf(_))}function PE(l,d){l=null,d.alternate!==null&&(l=d.alternate.memoizedState.cache),d=d.memoizedState.cache,d!==l&&(d.refCount++,l!=null&&Gf(l))}function Ha(l,d,_,S){if(d.subtreeFlags&10256)for(d=d.child;d!==null;)Mg(l,d,_,S),d=d.sibling}function Mg(l,d,_,S){var x=d.flags;switch(d.tag){case 0:case 11:case 15:Ha(l,d,_,S),x&2048&&sh(9,d);break;case 1:Ha(l,d,_,S);break;case 3:Ha(l,d,_,S),x&2048&&(l=null,d.alternate!==null&&(l=d.alternate.memoizedState.cache),d=d.memoizedState.cache,d!==l&&(d.refCount++,l!=null&&Gf(l)));break;case 12:if(x&2048){Ha(l,d,_,S),l=d.stateNode;try{var P=d.memoizedProps,Y=P.id,ne=P.onPostCommit;typeof ne=="function"&&ne(Y,d.alternate===null?"mount":"update",l.passiveEffectDuration,-0)}catch(pe){jn(d,d.return,pe)}}else Ha(l,d,_,S);break;case 31:Ha(l,d,_,S);break;case 13:Ha(l,d,_,S);break;case 23:break;case 22:P=d.stateNode,Y=d.alternate,d.memoizedState!==null?P._visibility&2?Ha(l,d,_,S):Ou(l,d):P._visibility&2?Ha(l,d,_,S):(P._visibility|=2,lh(l,d,_,S,(d.subtreeFlags&10256)!==0||!1)),x&2048&&DE(Y,d);break;case 24:Ha(l,d,_,S),x&2048&&PE(d.alternate,d);break;default:Ha(l,d,_,S)}}function lh(l,d,_,S,x){for(x=x&&((d.subtreeFlags&10256)!==0||!1),d=d.child;d!==null;){var P=l,Y=d,ne=_,pe=S,Pe=Y.flags;switch(Y.tag){case 0:case 11:case 15:lh(P,Y,ne,pe,x),sh(8,Y);break;case 23:break;case 22:var We=Y.stateNode;Y.memoizedState!==null?We._visibility&2?lh(P,Y,ne,pe,x):Ou(P,Y):(We._visibility|=2,lh(P,Y,ne,pe,x)),x&&Pe&2048&&DE(Y.alternate,Y);break;case 24:lh(P,Y,ne,pe,x),x&&Pe&2048&&PE(Y.alternate,Y);break;default:lh(P,Y,ne,pe,x)}d=d.sibling}}function Ou(l,d){if(d.subtreeFlags&10256)for(d=d.child;d!==null;){var _=l,S=d,x=S.flags;switch(S.tag){case 22:Ou(_,S),x&2048&&DE(S.alternate,S);break;case 24:Ou(_,S),x&2048&&PE(S.alternate,S);break;default:Ou(_,S)}d=d.sibling}}var rp=8192;function Iu(l,d,_){if(l.subtreeFlags&rp)for(l=l.child;l!==null;)Lw(l,d,_),l=l.sibling}function Lw(l,d,_){switch(l.tag){case 26:Iu(l,d,_),l.flags&rp&&l.memoizedState!==null&&Sx(_,fs,l.memoizedState,l.memoizedProps);break;case 5:Iu(l,d,_);break;case 3:case 4:var S=fs;fs=Qg(l.stateNode.containerInfo),Iu(l,d,_),fs=S;break;case 22:l.memoizedState===null&&(S=l.alternate,S!==null&&S.memoizedState!==null?(S=rp,rp=16777216,Iu(l,d,_),rp=S):Iu(l,d,_));break;default:Iu(l,d,_)}}function Ug(l){var d=l.alternate;if(d!==null&&(l=d.child,l!==null)){d.child=null;do d=l.sibling,l.sibling=null,l=d;while(l!==null)}}function Ec(l){var d=l.deletions;if((l.flags&16)!==0){if(d!==null)for(var _=0;_<d.length;_++){var S=d[_];Ei=S,jg(S,l)}Ug(l)}if(l.subtreeFlags&10256)for(l=l.child;l!==null;)kE(l),l=l.sibling}function kE(l){switch(l.tag){case 0:case 11:case 15:Ec(l),l.flags&2048&&_l(9,l,l.return);break;case 3:Ec(l);break;case 12:Ec(l);break;case 22:var d=l.stateNode;l.memoizedState!==null&&d._visibility&2&&(l.return===null||l.return.tag!==13)?(d._visibility&=-3,uh(l)):Ec(l);break;default:Ec(l)}}function uh(l){var d=l.deletions;if((l.flags&16)!==0){if(d!==null)for(var _=0;_<d.length;_++){var S=d[_];Ei=S,jg(S,l)}Ug(l)}for(l=l.child;l!==null;){switch(d=l,d.tag){case 0:case 11:case 15:_l(8,d,d.return),uh(d);break;case 22:_=d.stateNode,_._visibility&2&&(_._visibility&=-3,uh(d));break;default:uh(d)}l=l.sibling}}function jg(l,d){for(;Ei!==null;){var _=Ei;switch(_.tag){case 0:case 11:case 15:_l(8,_,d);break;case 23:case 22:if(_.memoizedState!==null&&_.memoizedState.cachePool!==null){var S=_.memoizedState.cachePool.pool;S!=null&&S.refCount++}break;case 24:Gf(_.memoizedState.cache)}if(S=_.child,S!==null)S.return=_,Ei=S;else e:for(_=l;Ei!==null;){S=Ei;var x=S.sibling,P=S.return;if(Dw(S),S===_){Ei=null;break e}if(x!==null){x.return=P,Ei=x;break e}Ei=P}}}var Mw={getCacheForType:function(l){var d=yi(qr),_=d.data.get(l);return _===void 0&&(_=l(),d.data.set(l,_)),_},cacheSignal:function(){return yi(qr).controller.signal}},Uw=typeof WeakMap=="function"?WeakMap:Map,On=0,Zn=null,_n=null,bn=0,Gn=0,ba=null,Wa=!1,El=!1,ip=!1,Ms=0,Rr=0,Sc=0,Nu=0,LE=0,Si=0,dh=0,hh=null,Ki=null,ME=!1,Vg=0,jw=0,Bg=1/0,fh=null,bc=null,$r=0,Tc=null,wc=null,Us=0,ph=0,mh=null,UE=null,mo=0,Rc=null;function za(){return(On&2)!==0&&bn!==0?bn&-bn:he.T!==null?KE():oy()}function gh(){if(Si===0)if((bn&536870912)===0||Sn){var l=Im;Im<<=1,(Im&3932160)===0&&(Im=262144),Si=l}else Si=536870912;return l=Ba.current,l!==null&&(l.flags|=32),Si}function Ta(l,d,_){(l===Zn&&(Gn===2||Gn===9)||l.cancelPendingCommit!==null)&&(vh(l,0),Cc(l,bn,Si,!1)),yf(l,_),((On&2)===0||l!==Zn)&&(l===Zn&&((On&2)===0&&(Nu|=_),Rr===4&&Cc(l,bn,Si,!1)),go(l))}function Vw(l,d,_){if((On&6)!==0)throw Error(c(327));var S=!_&&(d&127)===0&&(d&l.expiredLanes)===0||vf(l,d),x=S?BE(l,d):VE(l,d,!0),P=S;do{if(x===0){El&&!S&&Cc(l,d,0,!1);break}else{if(_=l.current.alternate,P&&!ZN(_)){x=VE(l,d,!1),P=!1;continue}if(x===2){if(P=d,l.errorRecoveryDisabledLanes&P)var Y=0;else Y=l.pendingLanes&-536870913,Y=Y!==0?Y:Y&536870912?536870912:0;if(Y!==0){d=Y;e:{var ne=l;x=hh;var pe=ne.current.memoizedState.isDehydrated;if(pe&&(vh(ne,Y).flags|=256),Y=VE(ne,Y,!1),Y!==2){if(ip&&!pe){ne.errorRecoveryDisabledLanes|=P,Nu|=P,x=4;break e}P=Ki,Ki=x,P!==null&&(Ki===null?Ki=P:Ki.push.apply(Ki,P))}x=Y}if(P=!1,x!==2)continue}}if(x===1){vh(l,0),Cc(l,d,0,!0);break}e:{switch(S=l,P=x,P){case 0:case 1:throw Error(c(345));case 4:if((d&4194048)!==d)break;case 6:Cc(S,d,Si,!Wa);break e;case 2:Ki=null;break;case 3:case 5:break;default:throw Error(c(329))}if((d&62914560)===d&&(x=Vg+300-Yn(),10<x)){if(Cc(S,d,Si,!Wa),rl(S,0,!0)!==0)break e;Us=d,S.timeoutHandle=sR(Bw.bind(null,S,_,Ki,fh,ME,d,Si,Nu,dh,Wa,P,"Throttled",-0,0),x);break e}Bw(S,_,Ki,fh,ME,d,Si,Nu,dh,Wa,P,null,-0,0)}}break}while(!0);go(l)}function Bw(l,d,_,S,x,P,Y,ne,pe,Pe,We,Ze,Me,Be){if(l.timeoutHandle=-1,Ze=d.subtreeFlags,Ze&8192||(Ze&16785408)===16785408){Ze={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:rc},Lw(d,P,Ze);var Et=(P&62914560)===P?Vg-Yn():(P&4194048)===P?jw-Yn():0;if(Et=p0(Ze,Et),Et!==null){Us=P,l.cancelPendingCommit=Et(zw.bind(null,l,d,P,_,S,x,Y,ne,pe,We,Ze,null,Me,Be)),Cc(l,P,Y,!Pe);return}}zw(l,d,P,_,S,x,Y,ne,pe)}function ZN(l){for(var d=l;;){var _=d.tag;if((_===0||_===11||_===15)&&d.flags&16384&&(_=d.updateQueue,_!==null&&(_=_.stores,_!==null)))for(var S=0;S<_.length;S++){var x=_[S],P=x.getSnapshot;x=x.value;try{if(!ja(P(),x))return!1}catch{return!1}}if(_=d.child,d.subtreeFlags&16384&&_!==null)_.return=d,d=_;else{if(d===l)break;for(;d.sibling===null;){if(d.return===null||d.return===l)return!0;d=d.return}d.sibling.return=d.return,d=d.sibling}}return!0}function Cc(l,d,_,S){d&=~LE,d&=~Nu,l.suspendedLanes|=d,l.pingedLanes&=~d,S&&(l.warmLanes|=d),S=l.expirationTimes;for(var x=d;0<x;){var P=31-Ma(x),Y=1<<P;S[P]=-1,x&=~Y}_!==0&&Jb(l,_,d)}function _h(){return(On&6)===0?(Oc(0),!1):!0}function Fg(){if(_n!==null){if(Gn===0)var l=_n.return;else l=_n,oc=du=null,$y(l),Kd=null,zf=0,l=_n;for(;l!==null;)Cw(l.alternate,l),l=l.return;_n=null}}function vh(l,d){var _=l.timeoutHandle;_!==-1&&(l.timeoutHandle=-1,lx(_)),_=l.cancelPendingCommit,_!==null&&(l.cancelPendingCommit=null,_()),Us=0,Fg(),Zn=l,_n=_=Ds(l.current,null),bn=d,Gn=0,ba=null,Wa=!1,El=vf(l,d),ip=!1,dh=Si=LE=Nu=Sc=Rr=0,Ki=hh=null,ME=!1,(d&8)!==0&&(d|=d&32);var S=l.entangledLanes;if(S!==0)for(l=l.entanglements,S&=d;0<S;){var x=31-Ma(S),P=1<<x;d|=l[x],S&=~P}return Ms=d,sl(),_}function jE(l,d){en=null,he.H=ih,d===zd||d===cg?(d=GT(),Gn=3):d===Gy?(d=GT(),Gn=4):Gn=d===gE?8:d!==null&&typeof d=="object"&&typeof d.then=="function"?6:1,ba=d,_n===null&&(Rr=1,Cg(l,ss(d,l.current)))}function Fw(){var l=Ba.current;return l===null?!0:(bn&4194048)===bn?us===null:(bn&62914560)===bn||(bn&536870912)!==0?l===us:!1}function yh(){var l=he.H;return he.H=ih,l===null?ih:l}function js(){var l=he.A;return he.A=Mw,l}function ap(){Rr=4,Wa||(bn&4194048)!==bn&&Ba.current!==null||(El=!0),(Sc&134217727)===0&&(Nu&134217727)===0||Zn===null||Cc(Zn,bn,Si,!1)}function VE(l,d,_){var S=On;On|=2;var x=yh(),P=js();(Zn!==l||bn!==d)&&(fh=null,vh(l,d)),d=!1;var Y=Rr;e:do try{if(Gn!==0&&_n!==null){var ne=_n,pe=ba;switch(Gn){case 8:Fg(),Y=6;break e;case 3:case 2:case 9:case 6:Ba.current===null&&(d=!0);var Pe=Gn;if(Gn=0,ba=null,Ka(l,ne,pe,Pe),_&&El){Y=0;break e}break;default:Pe=Gn,Gn=0,ba=null,Ka(l,ne,pe,Pe)}}QN(),Y=Rr;break}catch(We){jE(l,We)}while(!0);return d&&l.shellSuspendCounter++,oc=du=null,On=S,he.H=x,he.A=P,_n===null&&(Zn=null,bn=0,sl()),Y}function QN(){for(;_n!==null;)Hw(_n)}function BE(l,d){var _=On;On|=2;var S=yh(),x=js();Zn!==l||bn!==d?(fh=null,Bg=Yn()+500,vh(l,d)):El=vf(l,d);e:do try{if(Gn!==0&&_n!==null){d=_n;var P=ba;t:switch(Gn){case 1:Gn=0,ba=null,Ka(l,d,P,1);break;case 2:case 9:if(FT(P)){Gn=0,ba=null,sp(d);break}d=function(){Gn!==2&&Gn!==9||Zn!==l||(Gn=7),go(l)},P.then(d,d);break e;case 3:Gn=7;break e;case 4:Gn=5;break e;case 7:FT(P)?(Gn=0,ba=null,sp(d)):(Gn=0,ba=null,Ka(l,d,P,7));break;case 5:var Y=null;switch(_n.tag){case 26:Y=_n.memoizedState;case 5:case 27:var ne=_n;if(Y?ER(Y):ne.stateNode.complete){Gn=0,ba=null;var pe=ne.sibling;if(pe!==null)_n=pe;else{var Pe=ne.return;Pe!==null?(_n=Pe,Sl(Pe)):_n=null}break t}}Gn=0,ba=null,Ka(l,d,P,5);break;case 6:Gn=0,ba=null,Ka(l,d,P,6);break;case 8:Fg(),Rr=6;break e;default:throw Error(c(462))}}Gw();break}catch(We){jE(l,We)}while(!0);return oc=du=null,he.H=S,he.A=x,On=_,_n!==null?0:(Zn=null,bn=0,sl(),Rr)}function Gw(){for(;_n!==null&&!uN();)Hw(_n)}function Hw(l){var d=wE(l.alternate,l,Ms);l.memoizedProps=l.pendingProps,d===null?Sl(l):_n=d}function sp(l){var d=l,_=d.alternate;switch(d.tag){case 15:case 0:d=bw(_,d,d.pendingProps,d.type,void 0,bn);break;case 11:d=bw(_,d,d.pendingProps,d.type.render,d.ref,bn);break;case 5:$y(d);default:Cw(_,d),d=_n=kT(d,Ms),d=wE(_,d,Ms)}l.memoizedProps=l.pendingProps,d===null?Sl(l):_n=d}function Ka(l,d,_,S){oc=du=null,$y(d),Kd=null,zf=0;var x=d.return;try{if(XN(l,x,d,_,bn)){Rr=1,Cg(l,ss(_,l.current)),_n=null;return}}catch(P){if(x!==null)throw _n=x,P;Rr=1,Cg(l,ss(_,l.current)),_n=null;return}d.flags&32768?(Sn||S===1?l=!0:El||(bn&536870912)!==0?l=!1:(Wa=l=!0,(S===2||S===9||S===3||S===6)&&(S=Ba.current,S!==null&&S.tag===13&&(S.flags|=16384))),Ww(d,l)):Sl(d)}function Sl(l){var d=l;do{if((d.flags&32768)!==0){Ww(d,Wa);return}l=d.return;var _=Rw(d.alternate,d,Ms);if(_!==null){_n=_;return}if(d=d.sibling,d!==null){_n=d;return}_n=d=l}while(d!==null);Rr===0&&(Rr=5)}function Ww(l,d){do{var _=$N(l.alternate,l);if(_!==null){_.flags&=32767,_n=_;return}if(_=l.return,_!==null&&(_.flags|=32768,_.subtreeFlags=0,_.deletions=null),!d&&(l=l.sibling,l!==null)){_n=l;return}_n=l=_}while(l!==null);Rr=6,_n=null}function zw(l,d,_,S,x,P,Y,ne,pe){l.cancelPendingCommit=null;do Hg();while($r!==0);if((On&6)!==0)throw Error(c(327));if(d!==null){if(d===l.current)throw Error(c(177));if(P=d.lanes|d.childLanes,P|=Ud,_a(l,_,P,Y,ne,pe),l===Zn&&(_n=Zn=null,bn=0),wc=d,Tc=l,Us=_,ph=P,mh=x,UE=S,(d.subtreeFlags&10256)!==0||(d.flags&10256)!==0?(l.callbackNode=null,l.callbackPriority=0,Zw(_f,function(){return Xw(),null})):(l.callbackNode=null,l.callbackPriority=0),S=(d.flags&13878)!==0,(d.subtreeFlags&13878)!==0||S){S=he.T,he.T=null,x=_e.p,_e.p=2,Y=On,On|=4;try{Nw(l,d,_)}finally{On=Y,_e.p=x,he.T=S}}$r=1,Kw(),Yw(),Gg()}}function Kw(){if($r===1){$r=0;var l=Tc,d=wc,_=(d.flags&13878)!==0;if((d.subtreeFlags&13878)!==0||_){_=he.T,he.T=null;var S=_e.p;_e.p=2;var x=On;On|=4;try{kw(d,l);var P=e0,Y=OT(l.containerInfo),ne=P.focusedElem,pe=P.selectionRange;if(Y!==ne&&ne&&ne.ownerDocument&&AT(ne.ownerDocument.documentElement,ne)){if(pe!==null&&Hi(ne)){var Pe=pe.start,We=pe.end;if(We===void 0&&(We=Pe),"selectionStart"in ne)ne.selectionStart=Pe,ne.selectionEnd=Math.min(We,ne.value.length);else{var Ze=ne.ownerDocument||document,Me=Ze&&Ze.defaultView||window;if(Me.getSelection){var Be=Me.getSelection(),Et=ne.textContent.length,Pt=Math.min(pe.start,Et),Hn=pe.end===void 0?Pt:Math.min(pe.end,Et);!Be.extend&&Pt>Hn&&(Y=Hn,Hn=Pt,Pt=Y);var Ce=ac(ne,Pt),Se=ac(ne,Hn);if(Ce&&Se&&(Be.rangeCount!==1||Be.anchorNode!==Ce.node||Be.anchorOffset!==Ce.offset||Be.focusNode!==Se.node||Be.focusOffset!==Se.offset)){var Oe=Ze.createRange();Oe.setStart(Ce.node,Ce.offset),Be.removeAllRanges(),Pt>Hn?(Be.addRange(Oe),Be.extend(Se.node,Se.offset)):(Oe.setEnd(Se.node,Se.offset),Be.addRange(Oe))}}}}for(Ze=[],Be=ne;Be=Be.parentNode;)Be.nodeType===1&&Ze.push({element:Be,left:Be.scrollLeft,top:Be.scrollTop});for(typeof ne.focus=="function"&&ne.focus(),ne=0;ne<Ze.length;ne++){var Ke=Ze[ne];Ke.element.scrollLeft=Ke.left,Ke.element.scrollTop=Ke.top}}gp=!!QE,e0=QE=null}finally{On=x,_e.p=S,he.T=_}}l.current=d,$r=2}}function Yw(){if($r===2){$r=0;var l=Tc,d=wc,_=(d.flags&8772)!==0;if((d.subtreeFlags&8772)!==0||_){_=he.T,he.T=null;var S=_e.p;_e.p=2;var x=On;On|=4;try{xw(l,d.alternate,d)}finally{On=x,_e.p=S,he.T=_}}$r=3}}function Gg(){if($r===4||$r===3){$r=0,Wb();var l=Tc,d=wc,_=Us,S=UE;(d.subtreeFlags&10256)!==0||(d.flags&10256)!==0?$r=5:($r=0,wc=Tc=null,qw(l,l.pendingLanes));var x=l.pendingLanes;if(x===0&&(bc=null),Dm(_),d=d.stateNode,si&&typeof si.onCommitFiberRoot=="function")try{si.onCommitFiberRoot(Ed,d,void 0,(d.current.flags&128)===128)}catch{}if(S!==null){d=he.T,x=_e.p,_e.p=2,he.T=null;try{for(var P=l.onRecoverableError,Y=0;Y<S.length;Y++){var ne=S[Y];P(ne.value,{componentStack:ne.stack})}}finally{he.T=d,_e.p=x}}(Us&3)!==0&&Hg(),go(l),x=l.pendingLanes,(_&261930)!==0&&(x&42)!==0?l===Rc?mo++:(mo=0,Rc=l):mo=0,Oc(0)}}function qw(l,d){(l.pooledCacheLanes&=d)===0&&(d=l.pooledCache,d!=null&&(l.pooledCache=null,Gf(d)))}function Hg(){return Kw(),Yw(),Gg(),Xw()}function Xw(){if($r!==5)return!1;var l=Tc,d=ph;ph=0;var _=Dm(Us),S=he.T,x=_e.p;try{_e.p=32>_?32:_,he.T=null,_=mh,mh=null;var P=Tc,Y=Us;if($r=0,wc=Tc=null,Us=0,(On&6)!==0)throw Error(c(331));var ne=On;if(On|=4,kE(P.current),Mg(P,P.current,Y,_),On=ne,Oc(0,!1),si&&typeof si.onPostCommitFiberRoot=="function")try{si.onPostCommitFiberRoot(Ed,P)}catch{}return!0}finally{_e.p=x,he.T=S,qw(l,d)}}function FE(l,d,_){d=ss(_,d),d=mE(l.stateNode,d,2),l=dl(l,d,2),l!==null&&(yf(l,2),go(l))}function jn(l,d,_){if(l.tag===3)FE(l,l,_);else for(;d!==null;){if(d.tag===3){FE(d,l,_);break}else if(d.tag===1){var S=d.stateNode;if(typeof d.type.getDerivedStateFromError=="function"||typeof S.componentDidCatch=="function"&&(bc===null||!bc.has(S))){l=ss(_,l),_=_w(2),S=dl(d,_,2),S!==null&&(Ag(_,S,d,l),yf(S,2),go(S));break}}d=d.return}}function GE(l,d,_){var S=l.pingCache;if(S===null){S=l.pingCache=new Uw;var x=new Set;S.set(d,x)}else x=S.get(d),x===void 0&&(x=new Set,S.set(d,x));x.has(_)||(ip=!0,x.add(_),l=ex.bind(null,l,d,_),d.then(l,l))}function ex(l,d,_){var S=l.pingCache;S!==null&&S.delete(d),l.pingedLanes|=l.suspendedLanes&_,l.warmLanes&=~_,Zn===l&&(bn&_)===_&&(Rr===4||Rr===3&&(bn&62914560)===bn&&300>Yn()-Vg?(On&2)===0&&vh(l,0):LE|=_,dh===bn&&(dh=0)),go(l)}function Jw(l,d){d===0&&(d=Xb()),l=lo(l,d),l!==null&&(yf(l,d),go(l))}function $w(l){var d=l.memoizedState,_=0;d!==null&&(_=d.retryLane),Jw(l,_)}function HE(l,d){var _=0;switch(l.tag){case 31:case 13:var S=l.stateNode,x=l.memoizedState;x!==null&&(_=x.retryLane);break;case 19:S=l.stateNode;break;case 22:S=l.stateNode._retryCache;break;default:throw Error(c(314))}S!==null&&S.delete(d),Jw(l,_)}function Zw(l,d){return mf(l,d)}var op=null,Ac=null,Wg=!1,zg=!1,cp=!1,bl=0;function go(l){l!==Ac&&l.next===null&&(Ac===null?op=Ac=l:Ac=Ac.next=l),zg=!0,Wg||(Wg=!0,tx())}function Oc(l,d){if(!cp&&zg){cp=!0;do for(var _=!1,S=op;S!==null;){if(l!==0){var x=S.pendingLanes;if(x===0)var P=0;else{var Y=S.suspendedLanes,ne=S.pingedLanes;P=(1<<31-Ma(42|l)+1)-1,P&=x&~(Y&~ne),P=P&201326741?P&201326741|1:P?P|2:0}P!==0&&(_=!0,qg(S,P))}else P=bn,P=rl(S,S===Zn?P:0,S.cancelPendingCommit!==null||S.timeoutHandle!==-1),(P&3)===0||vf(S,P)||(_=!0,qg(S,P));S=S.next}while(_);cp=!1}}function WE(){zE()}function zE(){zg=Wg=!1;var l=0;bl!==0&&cx()&&(l=bl);for(var d=Yn(),_=null,S=op;S!==null;){var x=S.next,P=Kg(S,d);P===0?(S.next=null,_===null?op=x:_.next=x,x===null&&(Ac=_)):(_=S,(l!==0||(P&3)!==0)&&(zg=!0)),S=x}$r!==0&&$r!==5||Oc(l),bl!==0&&(bl=0)}function Kg(l,d){for(var _=l.suspendedLanes,S=l.pingedLanes,x=l.expirationTimes,P=l.pendingLanes&-62914561;0<P;){var Y=31-Ma(P),ne=1<<Y,pe=x[Y];pe===-1?((ne&_)===0||(ne&S)!==0)&&(x[Y]=bd(ne,d)):pe<=d&&(l.expiredLanes|=ne),P&=~ne}if(d=Zn,_=bn,_=rl(l,l===d?_:0,l.cancelPendingCommit!==null||l.timeoutHandle!==-1),S=l.callbackNode,_===0||l===d&&(Gn===2||Gn===9)||l.cancelPendingCommit!==null)return S!==null&&S!==null&&gf(S),l.callbackNode=null,l.callbackPriority=0;if((_&3)===0||vf(l,_)){if(d=_&-_,d===l.callbackPriority)return d;switch(S!==null&&gf(S),Dm(_)){case 2:case 8:_=co;break;case 32:_=_f;break;case 268435456:_=ay;break;default:_=_f}return S=Yg.bind(null,l),_=mf(_,S),l.callbackPriority=d,l.callbackNode=_,d}return S!==null&&S!==null&&gf(S),l.callbackPriority=2,l.callbackNode=null,2}function Yg(l,d){if($r!==0&&$r!==5)return l.callbackNode=null,l.callbackPriority=0,null;var _=l.callbackNode;if(Hg()&&l.callbackNode!==_)return null;var S=bn;return S=rl(l,l===Zn?S:0,l.cancelPendingCommit!==null||l.timeoutHandle!==-1),S===0?null:(Vw(l,S,d),Kg(l,Yn()),l.callbackNode!=null&&l.callbackNode===_?Yg.bind(null,l):null)}function qg(l,d){if(Hg())return null;Vw(l,d,!0)}function tx(){ux(function(){(On&6)!==0?mf(ry,WE):zE()})}function KE(){if(bl===0){var l=Wd;l===0&&(l=Om,Om<<=1,(Om&261888)===0&&(Om=256)),bl=l}return bl}function YE(l){return l==null||typeof l=="symbol"||typeof l=="boolean"?null:typeof l=="function"?l:Bm(""+l)}function qE(l,d){var _=d.ownerDocument.createElement("input");return _.name=d.name,_.value=d.value,l.id&&_.setAttribute("form",l.id),d.parentNode.insertBefore(_,d),l=new FormData(l),_.parentNode.removeChild(_),l}function Qw(l,d,_,S,x){if(d==="submit"&&_&&_.stateNode===x){var P=YE((x[va]||null).action),Y=S.submitter;Y&&(d=(d=Y[va]||null)?YE(d.formAction):Y.getAttribute("formAction"),d!==null&&(P=d,Y=null));var ne=new wf("action","action",null,S,x);l.push({event:ne,listeners:[{instance:null,listener:function(){if(S.defaultPrevented){if(bl!==0){var pe=Y?qE(x,Y):new FormData(x);sE(_,{pending:!0,data:pe,method:x.method,action:P},null,pe)}}else typeof P=="function"&&(ne.preventDefault(),pe=Y?qE(x,Y):new FormData(x),sE(_,{pending:!0,data:pe,method:x.method,action:P},P,pe))},currentTarget:x}]})}}for(var Xg=0;Xg<eg.length;Xg++){var Jg=eg[Xg],nx=Jg.toLowerCase(),eR=Jg[0].toUpperCase()+Jg.slice(1);is(nx,"on"+eR)}is(Zm,"onAnimationEnd"),is(Qm,"onAnimationIteration"),is(xT,"onAnimationStart"),is("dblclick","onDoubleClick"),is("focusin","onFocus"),is("focusout","onBlur"),is(je,"onTransitionRun"),is(MN,"onTransitionStart"),is(UN,"onTransitionCancel"),is(DT,"onTransitionEnd"),Od("onMouseEnter",["mouseout","mouseover"]),Od("onMouseLeave",["mouseout","mouseover"]),Od("onPointerEnter",["pointerout","pointerover"]),Od("onPointerLeave",["pointerout","pointerover"]),nu("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),nu("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),nu("onBeforeInput",["compositionend","keypress","textInput","paste"]),nu("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),nu("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),nu("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lp="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Eh=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(lp));function xu(l,d){d=(d&4)!==0;for(var _=0;_<l.length;_++){var S=l[_],x=S.event;S=S.listeners;e:{var P=void 0;if(d)for(var Y=S.length-1;0<=Y;Y--){var ne=S[Y],pe=ne.instance,Pe=ne.currentTarget;if(ne=ne.listener,pe!==P&&x.isPropagationStopped())break e;P=ne,x.currentTarget=Pe;try{P(x)}catch(We){tg(We)}x.currentTarget=null,P=pe}else for(Y=0;Y<S.length;Y++){if(ne=S[Y],pe=ne.instance,Pe=ne.currentTarget,ne=ne.listener,pe!==P&&x.isPropagationStopped())break e;P=ne,x.currentTarget=Pe;try{P(x)}catch(We){tg(We)}x.currentTarget=null,P=pe}}}}function dn(l,d){var _=d[cy];_===void 0&&(_=d[cy]=new Set);var S=l+"__bubble";_.has(S)||(JE(d,l,2,!1),_.add(S))}function $g(l,d,_){var S=0;d&&(S|=4),JE(_,l,S,d)}var up="_reactListening"+Math.random().toString(36).slice(2);function XE(l){if(!l[up]){l[up]=!0,jr.forEach(function(_){_!=="selectionchange"&&(Eh.has(_)||$g(_,!1,l),$g(_,!0,l))});var d=l.nodeType===9?l:l.ownerDocument;d===null||d[up]||(d[up]=!0,$g("selectionchange",!1,d))}}function JE(l,d,_,S){switch(v0(d)){case 2:var x=wx;break;case 8:x=g0;break;default:x=o_}_=x.bind(null,d,_,l),x=void 0,!iu||d!=="touchstart"&&d!=="touchmove"&&d!=="wheel"||(x=!0),S?x!==void 0?l.addEventListener(d,_,{capture:!0,passive:x}):l.addEventListener(d,_,!0):x!==void 0?l.addEventListener(d,_,{passive:x}):l.addEventListener(d,_,!1)}function $E(l,d,_,S,x){var P=S;if((d&1)===0&&(d&2)===0&&S!==null)e:for(;;){if(S===null)return;var Y=S.tag;if(Y===3||Y===4){var ne=S.stateNode.containerInfo;if(ne===x)break;if(Y===4)for(Y=S.return;Y!==null;){var pe=Y.tag;if((pe===3||pe===4)&&Y.stateNode.containerInfo===x)return;Y=Y.return}for(;ne!==null;){if(Y=Rd(ne),Y===null)return;if(pe=Y.tag,pe===5||pe===6||pe===26||pe===27){S=P=Y;continue e}ne=ne.parentNode}}S=S.return}dT(function(){var Pe=P,We=py(_),Ze=[];e:{var Me=PT.get(l);if(Me!==void 0){var Be=wf,Et=l;switch(l){case"keypress":if(Hm(_)===0)break e;case"keydown":case"keyup":Be=bN;break;case"focusin":Et="focus",Be=Af;break;case"focusout":Et="blur",Be=Af;break;case"beforeblur":case"afterblur":Be=Af;break;case"click":if(_.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Be=fT;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Be=pT;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Be=_T;break;case Zm:case Qm:case xT:Be=vy;break;case DT:Be=Jt;break;case"scroll":case"scrollend":Be=mN;break;case"wheel":Be=RN;break;case"copy":case"cut":case"paste":Be=Ey;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Be=gT;break;case"toggle":case"beforetoggle":Be=AN}var Pt=(d&4)!==0,Hn=!Pt&&(l==="scroll"||l==="scrollend"),Ce=Pt?Me!==null?Me+"Capture":null:Me;Pt=[];for(var Se=Pe,Oe;Se!==null;){var Ke=Se;if(Oe=Ke.stateNode,Ke=Ke.tag,Ke!==5&&Ke!==26&&Ke!==27||Oe===null||Ce===null||(Ke=bf(Se,Ce),Ke!=null&&Pt.push(dp(Se,Ke,Oe))),Hn)break;Se=Se.return}0<Pt.length&&(Me=new Be(Me,Et,null,_,We),Ze.push({event:Me,listeners:Pt}))}}if((d&7)===0){e:{if(Me=l==="mouseover"||l==="pointerover",Be=l==="mouseout"||l==="pointerout",Me&&_!==fy&&(Et=_.relatedTarget||_.fromElement)&&(Rd(Et)||Et[Td]))break e;if((Be||Me)&&(Me=We.window===We?We:(Me=We.ownerDocument)?Me.defaultView||Me.parentWindow:window,Be?(Et=_.relatedTarget||_.toElement,Be=Pe,Et=Et?Rd(Et):null,Et!==null&&(Hn=p(Et),Pt=Et.tag,Et!==Hn||Pt!==5&&Pt!==27&&Pt!==6)&&(Et=null)):(Be=null,Et=Pe),Be!==Et)){if(Pt=fT,Ke="onMouseLeave",Ce="onMouseEnter",Se="mouse",(l==="pointerout"||l==="pointerover")&&(Pt=gT,Ke="onPointerLeave",Ce="onPointerEnter",Se="pointer"),Hn=Be==null?Me:ya(Be),Oe=Et==null?Me:ya(Et),Me=new Pt(Ke,Se+"leave",Be,_,We),Me.target=Hn,Me.relatedTarget=Oe,Ke=null,Rd(We)===Pe&&(Pt=new Pt(Ce,Se+"enter",Et,_,We),Pt.target=Oe,Pt.relatedTarget=Hn,Ke=Pt),Hn=Ke,Be&&Et)t:{for(Pt=rx,Ce=Be,Se=Et,Oe=0,Ke=Ce;Ke;Ke=Pt(Ke))Oe++;Ke=0;for(var Nt=Se;Nt;Nt=Pt(Nt))Ke++;for(;0<Oe-Ke;)Ce=Pt(Ce),Oe--;for(;0<Ke-Oe;)Se=Pt(Se),Ke--;for(;Oe--;){if(Ce===Se||Se!==null&&Ce===Se.alternate){Pt=Ce;break t}Ce=Pt(Ce),Se=Pt(Se)}Pt=null}else Pt=null;Be!==null&&tR(Ze,Me,Be,Pt,!1),Et!==null&&Hn!==null&&tR(Ze,Hn,Et,Pt,!0)}}e:{if(Me=Pe?ya(Pe):window,Be=Me.nodeName&&Me.nodeName.toLowerCase(),Be==="select"||Be==="input"&&Me.type==="file")var xn=ST;else if(Ry(Me))if(bT)xn=kN;else{xn=Iy;var wt=RT}else Be=Me.nodeName,!Be||Be.toLowerCase()!=="input"||Me.type!=="checkbox"&&Me.type!=="radio"?Pe&&hy(Pe.elementType)&&(xn=ST):xn=PN;if(xn&&(xn=xn(l,Pe))){qm(Ze,xn,_,We);break e}wt&&wt(l,Me,Pe),l==="focusout"&&Pe&&Me.type==="number"&&Pe.memoizedProps.value!=null&&uy(Me,"number",Me.value)}switch(wt=Pe?ya(Pe):window,l){case"focusin":(Ry(wt)||wt.contentEditable==="true")&&(kd=wt,Ny=Pe,Pf=null);break;case"focusout":Pf=Ny=kd=null;break;case"mousedown":Jm=!0;break;case"contextmenu":case"mouseup":case"dragend":Jm=!1,IT(Ze,_,We);break;case"selectionchange":if(LN)break;case"keydown":case"keyup":IT(Ze,_,We)}var an;if(Ty)e:{switch(l){case"compositionstart":var Tn="onCompositionStart";break e;case"compositionend":Tn="onCompositionEnd";break e;case"compositionupdate":Tn="onCompositionUpdate";break e}Tn=void 0}else Ua?wy(l,_)&&(Tn="onCompositionEnd"):l==="keydown"&&_.keyCode===229&&(Tn="onCompositionStart");Tn&&(Ym&&_.locale!=="ko"&&(Ua||Tn!=="onCompositionStart"?Tn==="onCompositionEnd"&&Ua&&(an=gy()):(al=We,my="value"in al?al.value:al.textContent,Ua=!0)),wt=Du(Pe,Tn),0<wt.length&&(Tn=new mT(Tn,l,null,_,We),Ze.push({event:Tn,listeners:wt}),an?Tn.data=an:(an=ET(_),an!==null&&(Tn.data=an)))),(an=ON?IN(l,_):NN(l,_))&&(Tn=Du(Pe,"onBeforeInput"),0<Tn.length&&(wt=new mT("onBeforeInput","beforeinput",null,_,We),Ze.push({event:wt,listeners:Tn}),wt.data=an)),Qw(Ze,l,Pe,_,We)}xu(Ze,d)})}function dp(l,d,_){return{instance:l,listener:d,currentTarget:_}}function Du(l,d){for(var _=d+"Capture",S=[];l!==null;){var x=l,P=x.stateNode;if(x=x.tag,x!==5&&x!==26&&x!==27||P===null||(x=bf(l,_),x!=null&&S.unshift(dp(l,x,P)),x=bf(l,d),x!=null&&S.push(dp(l,x,P))),l.tag===3)return S;l=l.return}return[]}function rx(l){if(l===null)return null;do l=l.return;while(l&&l.tag!==5&&l.tag!==27);return l||null}function tR(l,d,_,S,x){for(var P=d._reactName,Y=[];_!==null&&_!==S;){var ne=_,pe=ne.alternate,Pe=ne.stateNode;if(ne=ne.tag,pe!==null&&pe===S)break;ne!==5&&ne!==26&&ne!==27||Pe===null||(pe=Pe,x?(Pe=bf(_,P),Pe!=null&&Y.unshift(dp(_,Pe,pe))):x||(Pe=bf(_,P),Pe!=null&&Y.push(dp(_,Pe,pe)))),_=_.return}Y.length!==0&&l.push({event:d,listeners:Y})}var ix=/\r\n?/g,ax=/\u0000|\uFFFD/g;function nR(l){return(typeof l=="string"?l:""+l).replace(ix,`
`).replace(ax,"")}function rR(l,d){return d=nR(d),nR(l)===d}function Qn(l,d,_,S,x,P){switch(_){case"children":typeof S=="string"?d==="body"||d==="textarea"&&S===""||ru(l,S):(typeof S=="number"||typeof S=="bigint")&&d!=="body"&&ru(l,""+S);break;case"className":Mm(l,"class",S);break;case"tabIndex":Mm(l,"tabindex",S);break;case"dir":case"role":case"viewBox":case"width":case"height":Mm(l,_,S);break;case"style":Vm(l,S,P);break;case"data":if(d!=="object"){Mm(l,"data",S);break}case"src":case"href":if(S===""&&(d!=="a"||_!=="href")){l.removeAttribute(_);break}if(S==null||typeof S=="function"||typeof S=="symbol"||typeof S=="boolean"){l.removeAttribute(_);break}S=Bm(""+S),l.setAttribute(_,S);break;case"action":case"formAction":if(typeof S=="function"){l.setAttribute(_,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof P=="function"&&(_==="formAction"?(d!=="input"&&Qn(l,d,"name",x.name,x,null),Qn(l,d,"formEncType",x.formEncType,x,null),Qn(l,d,"formMethod",x.formMethod,x,null),Qn(l,d,"formTarget",x.formTarget,x,null)):(Qn(l,d,"encType",x.encType,x,null),Qn(l,d,"method",x.method,x,null),Qn(l,d,"target",x.target,x,null)));if(S==null||typeof S=="symbol"||typeof S=="boolean"){l.removeAttribute(_);break}S=Bm(""+S),l.setAttribute(_,S);break;case"onClick":S!=null&&(l.onclick=rc);break;case"onScroll":S!=null&&dn("scroll",l);break;case"onScrollEnd":S!=null&&dn("scrollend",l);break;case"dangerouslySetInnerHTML":if(S!=null){if(typeof S!="object"||!("__html"in S))throw Error(c(61));if(_=S.__html,_!=null){if(x.children!=null)throw Error(c(60));l.innerHTML=_}}break;case"multiple":l.multiple=S&&typeof S!="function"&&typeof S!="symbol";break;case"muted":l.muted=S&&typeof S!="function"&&typeof S!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(S==null||typeof S=="function"||typeof S=="boolean"||typeof S=="symbol"){l.removeAttribute("xlink:href");break}_=Bm(""+S),l.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",_);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":S!=null&&typeof S!="function"&&typeof S!="symbol"?l.setAttribute(_,""+S):l.removeAttribute(_);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":S&&typeof S!="function"&&typeof S!="symbol"?l.setAttribute(_,""):l.removeAttribute(_);break;case"capture":case"download":S===!0?l.setAttribute(_,""):S!==!1&&S!=null&&typeof S!="function"&&typeof S!="symbol"?l.setAttribute(_,S):l.removeAttribute(_);break;case"cols":case"rows":case"size":case"span":S!=null&&typeof S!="function"&&typeof S!="symbol"&&!isNaN(S)&&1<=S?l.setAttribute(_,S):l.removeAttribute(_);break;case"rowSpan":case"start":S==null||typeof S=="function"||typeof S=="symbol"||isNaN(S)?l.removeAttribute(_):l.setAttribute(_,S);break;case"popover":dn("beforetoggle",l),dn("toggle",l),Lm(l,"popover",S);break;case"xlinkActuate":nc(l,"http://www.w3.org/1999/xlink","xlink:actuate",S);break;case"xlinkArcrole":nc(l,"http://www.w3.org/1999/xlink","xlink:arcrole",S);break;case"xlinkRole":nc(l,"http://www.w3.org/1999/xlink","xlink:role",S);break;case"xlinkShow":nc(l,"http://www.w3.org/1999/xlink","xlink:show",S);break;case"xlinkTitle":nc(l,"http://www.w3.org/1999/xlink","xlink:title",S);break;case"xlinkType":nc(l,"http://www.w3.org/1999/xlink","xlink:type",S);break;case"xmlBase":nc(l,"http://www.w3.org/XML/1998/namespace","xml:base",S);break;case"xmlLang":nc(l,"http://www.w3.org/XML/1998/namespace","xml:lang",S);break;case"xmlSpace":nc(l,"http://www.w3.org/XML/1998/namespace","xml:space",S);break;case"is":Lm(l,"is",S);break;case"innerText":case"textContent":break;default:(!(2<_.length)||_[0]!=="o"&&_[0]!=="O"||_[1]!=="n"&&_[1]!=="N")&&(_=lT.get(_)||_,Lm(l,_,S))}}function ZE(l,d,_,S,x,P){switch(_){case"style":Vm(l,S,P);break;case"dangerouslySetInnerHTML":if(S!=null){if(typeof S!="object"||!("__html"in S))throw Error(c(61));if(_=S.__html,_!=null){if(x.children!=null)throw Error(c(60));l.innerHTML=_}}break;case"children":typeof S=="string"?ru(l,S):(typeof S=="number"||typeof S=="bigint")&&ru(l,""+S);break;case"onScroll":S!=null&&dn("scroll",l);break;case"onScrollEnd":S!=null&&dn("scrollend",l);break;case"onClick":S!=null&&(l.onclick=rc);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!tT.hasOwnProperty(_))e:{if(_[0]==="o"&&_[1]==="n"&&(x=_.endsWith("Capture"),d=_.slice(2,x?_.length-7:void 0),P=l[va]||null,P=P!=null?P[_]:null,typeof P=="function"&&l.removeEventListener(d,P,x),typeof S=="function")){typeof P!="function"&&P!==null&&(_ in l?l[_]=null:l.hasAttribute(_)&&l.removeAttribute(_)),l.addEventListener(d,S,x);break e}_ in l?l[_]=S:S===!0?l.setAttribute(_,""):Lm(l,_,S)}}}function Di(l,d,_){switch(d){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":dn("error",l),dn("load",l);var S=!1,x=!1,P;for(P in _)if(_.hasOwnProperty(P)){var Y=_[P];if(Y!=null)switch(P){case"src":S=!0;break;case"srcSet":x=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(c(137,d));default:Qn(l,d,P,Y,_,null)}}x&&Qn(l,d,"srcSet",_.srcSet,_,null),S&&Qn(l,d,"src",_.src,_,null);return;case"input":dn("invalid",l);var ne=P=Y=x=null,pe=null,Pe=null;for(S in _)if(_.hasOwnProperty(S)){var We=_[S];if(We!=null)switch(S){case"name":x=We;break;case"type":Y=We;break;case"checked":pe=We;break;case"defaultChecked":Pe=We;break;case"value":P=We;break;case"defaultValue":ne=We;break;case"children":case"dangerouslySetInnerHTML":if(We!=null)throw Error(c(137,d));break;default:Qn(l,d,S,We,_,null)}}sT(l,P,ne,pe,Pe,Y,x,!1);return;case"select":dn("invalid",l),S=Y=P=null;for(x in _)if(_.hasOwnProperty(x)&&(ne=_[x],ne!=null))switch(x){case"value":P=ne;break;case"defaultValue":Y=ne;break;case"multiple":S=ne;default:Qn(l,d,x,ne,_,null)}d=P,_=Y,l.multiple=!!S,d!=null?Id(l,!!S,d,!1):_!=null&&Id(l,!!S,_,!0);return;case"textarea":dn("invalid",l),P=x=S=null;for(Y in _)if(_.hasOwnProperty(Y)&&(ne=_[Y],ne!=null))switch(Y){case"value":S=ne;break;case"defaultValue":x=ne;break;case"children":P=ne;break;case"dangerouslySetInnerHTML":if(ne!=null)throw Error(c(91));break;default:Qn(l,d,Y,ne,_,null)}jm(l,S,x,P);return;case"option":for(pe in _)if(_.hasOwnProperty(pe)&&(S=_[pe],S!=null))switch(pe){case"selected":l.selected=S&&typeof S!="function"&&typeof S!="symbol";break;default:Qn(l,d,pe,S,_,null)}return;case"dialog":dn("beforetoggle",l),dn("toggle",l),dn("cancel",l),dn("close",l);break;case"iframe":case"object":dn("load",l);break;case"video":case"audio":for(S=0;S<lp.length;S++)dn(lp[S],l);break;case"image":dn("error",l),dn("load",l);break;case"details":dn("toggle",l);break;case"embed":case"source":case"link":dn("error",l),dn("load",l);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Pe in _)if(_.hasOwnProperty(Pe)&&(S=_[Pe],S!=null))switch(Pe){case"children":case"dangerouslySetInnerHTML":throw Error(c(137,d));default:Qn(l,d,Pe,S,_,null)}return;default:if(hy(d)){for(We in _)_.hasOwnProperty(We)&&(S=_[We],S!==void 0&&ZE(l,d,We,S,_,void 0));return}}for(ne in _)_.hasOwnProperty(ne)&&(S=_[ne],S!=null&&Qn(l,d,ne,S,_,null))}function sx(l,d,_,S){switch(d){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var x=null,P=null,Y=null,ne=null,pe=null,Pe=null,We=null;for(Be in _){var Ze=_[Be];if(_.hasOwnProperty(Be)&&Ze!=null)switch(Be){case"checked":break;case"value":break;case"defaultValue":pe=Ze;default:S.hasOwnProperty(Be)||Qn(l,d,Be,null,S,Ze)}}for(var Me in S){var Be=S[Me];if(Ze=_[Me],S.hasOwnProperty(Me)&&(Be!=null||Ze!=null))switch(Me){case"type":P=Be;break;case"name":x=Be;break;case"checked":Pe=Be;break;case"defaultChecked":We=Be;break;case"value":Y=Be;break;case"defaultValue":ne=Be;break;case"children":case"dangerouslySetInnerHTML":if(Be!=null)throw Error(c(137,d));break;default:Be!==Ze&&Qn(l,d,Me,Be,S,Ze)}}ly(l,Y,ne,pe,Pe,We,P,x);return;case"select":Be=Y=ne=Me=null;for(P in _)if(pe=_[P],_.hasOwnProperty(P)&&pe!=null)switch(P){case"value":break;case"multiple":Be=pe;default:S.hasOwnProperty(P)||Qn(l,d,P,null,S,pe)}for(x in S)if(P=S[x],pe=_[x],S.hasOwnProperty(x)&&(P!=null||pe!=null))switch(x){case"value":Me=P;break;case"defaultValue":ne=P;break;case"multiple":Y=P;default:P!==pe&&Qn(l,d,x,P,S,pe)}d=ne,_=Y,S=Be,Me!=null?Id(l,!!_,Me,!1):!!S!=!!_&&(d!=null?Id(l,!!_,d,!0):Id(l,!!_,_?[]:"",!1));return;case"textarea":Be=Me=null;for(ne in _)if(x=_[ne],_.hasOwnProperty(ne)&&x!=null&&!S.hasOwnProperty(ne))switch(ne){case"value":break;case"children":break;default:Qn(l,d,ne,null,S,x)}for(Y in S)if(x=S[Y],P=_[Y],S.hasOwnProperty(Y)&&(x!=null||P!=null))switch(Y){case"value":Me=x;break;case"defaultValue":Be=x;break;case"children":break;case"dangerouslySetInnerHTML":if(x!=null)throw Error(c(91));break;default:x!==P&&Qn(l,d,Y,x,S,P)}oT(l,Me,Be);return;case"option":for(var Et in _)if(Me=_[Et],_.hasOwnProperty(Et)&&Me!=null&&!S.hasOwnProperty(Et))switch(Et){case"selected":l.selected=!1;break;default:Qn(l,d,Et,null,S,Me)}for(pe in S)if(Me=S[pe],Be=_[pe],S.hasOwnProperty(pe)&&Me!==Be&&(Me!=null||Be!=null))switch(pe){case"selected":l.selected=Me&&typeof Me!="function"&&typeof Me!="symbol";break;default:Qn(l,d,pe,Me,S,Be)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Pt in _)Me=_[Pt],_.hasOwnProperty(Pt)&&Me!=null&&!S.hasOwnProperty(Pt)&&Qn(l,d,Pt,null,S,Me);for(Pe in S)if(Me=S[Pe],Be=_[Pe],S.hasOwnProperty(Pe)&&Me!==Be&&(Me!=null||Be!=null))switch(Pe){case"children":case"dangerouslySetInnerHTML":if(Me!=null)throw Error(c(137,d));break;default:Qn(l,d,Pe,Me,S,Be)}return;default:if(hy(d)){for(var Hn in _)Me=_[Hn],_.hasOwnProperty(Hn)&&Me!==void 0&&!S.hasOwnProperty(Hn)&&ZE(l,d,Hn,void 0,S,Me);for(We in S)Me=S[We],Be=_[We],!S.hasOwnProperty(We)||Me===Be||Me===void 0&&Be===void 0||ZE(l,d,We,Me,S,Be);return}}for(var Ce in _)Me=_[Ce],_.hasOwnProperty(Ce)&&Me!=null&&!S.hasOwnProperty(Ce)&&Qn(l,d,Ce,null,S,Me);for(Ze in S)Me=S[Ze],Be=_[Ze],!S.hasOwnProperty(Ze)||Me===Be||Me==null&&Be==null||Qn(l,d,Ze,Me,S,Be)}function iR(l){switch(l){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function ox(){if(typeof performance.getEntriesByType=="function"){for(var l=0,d=0,_=performance.getEntriesByType("resource"),S=0;S<_.length;S++){var x=_[S],P=x.transferSize,Y=x.initiatorType,ne=x.duration;if(P&&ne&&iR(Y)){for(Y=0,ne=x.responseEnd,S+=1;S<_.length;S++){var pe=_[S],Pe=pe.startTime;if(Pe>ne)break;var We=pe.transferSize,Ze=pe.initiatorType;We&&iR(Ze)&&(pe=pe.responseEnd,Y+=We*(pe<ne?1:(ne-Pe)/(pe-Pe)))}if(--S,d+=8*(P+Y)/(x.duration/1e3),l++,10<l)break}}if(0<l)return d/l/1e6}return navigator.connection&&(l=navigator.connection.downlink,typeof l=="number")?l:5}var QE=null,e0=null;function Zg(l){return l.nodeType===9?l:l.ownerDocument}function aR(l){switch(l){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function t0(l,d){if(l===0)switch(d){case"svg":return 1;case"math":return 2;default:return 0}return l===1&&d==="foreignObject"?0:l}function n0(l,d){return l==="textarea"||l==="noscript"||typeof d.children=="string"||typeof d.children=="number"||typeof d.children=="bigint"||typeof d.dangerouslySetInnerHTML=="object"&&d.dangerouslySetInnerHTML!==null&&d.dangerouslySetInnerHTML.__html!=null}var r0=null;function cx(){var l=window.event;return l&&l.type==="popstate"?l===r0?!1:(r0=l,!0):(r0=null,!1)}var sR=typeof setTimeout=="function"?setTimeout:void 0,lx=typeof clearTimeout=="function"?clearTimeout:void 0,oR=typeof Promise=="function"?Promise:void 0,ux=typeof queueMicrotask=="function"?queueMicrotask:typeof oR<"u"?function(l){return oR.resolve(null).then(l).catch(dx)}:sR;function dx(l){setTimeout(function(){throw l})}function Tl(l){return l==="head"}function cR(l,d){var _=d,S=0;do{var x=_.nextSibling;if(l.removeChild(_),x&&x.nodeType===8)if(_=x.data,_==="/$"||_==="/&"){if(S===0){l.removeChild(x),Rh(d);return}S--}else if(_==="$"||_==="$?"||_==="$~"||_==="$!"||_==="&")S++;else if(_==="html")Sh(l.ownerDocument.documentElement);else if(_==="head"){_=l.ownerDocument.head,Sh(_);for(var P=_.firstChild;P;){var Y=P.nextSibling,ne=P.nodeName;P[wd]||ne==="SCRIPT"||ne==="STYLE"||ne==="LINK"&&P.rel.toLowerCase()==="stylesheet"||_.removeChild(P),P=Y}}else _==="body"&&Sh(l.ownerDocument.body);_=x}while(_);Rh(d)}function lR(l,d){var _=l;l=0;do{var S=_.nextSibling;if(_.nodeType===1?d?(_._stashedDisplay=_.style.display,_.style.display="none"):(_.style.display=_._stashedDisplay||"",_.getAttribute("style")===""&&_.removeAttribute("style")):_.nodeType===3&&(d?(_._stashedText=_.nodeValue,_.nodeValue=""):_.nodeValue=_._stashedText||""),S&&S.nodeType===8)if(_=S.data,_==="/$"){if(l===0)break;l--}else _!=="$"&&_!=="$?"&&_!=="$~"&&_!=="$!"||l++;_=S}while(_)}function i0(l){var d=l.firstChild;for(d&&d.nodeType===10&&(d=d.nextSibling);d;){var _=d;switch(d=d.nextSibling,_.nodeName){case"HTML":case"HEAD":case"BODY":i0(_),il(_);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(_.rel.toLowerCase()==="stylesheet")continue}l.removeChild(_)}}function hx(l,d,_,S){for(;l.nodeType===1;){var x=_;if(l.nodeName.toLowerCase()!==d.toLowerCase()){if(!S&&(l.nodeName!=="INPUT"||l.type!=="hidden"))break}else if(S){if(!l[wd])switch(d){case"meta":if(!l.hasAttribute("itemprop"))break;return l;case"link":if(P=l.getAttribute("rel"),P==="stylesheet"&&l.hasAttribute("data-precedence"))break;if(P!==x.rel||l.getAttribute("href")!==(x.href==null||x.href===""?null:x.href)||l.getAttribute("crossorigin")!==(x.crossOrigin==null?null:x.crossOrigin)||l.getAttribute("title")!==(x.title==null?null:x.title))break;return l;case"style":if(l.hasAttribute("data-precedence"))break;return l;case"script":if(P=l.getAttribute("src"),(P!==(x.src==null?null:x.src)||l.getAttribute("type")!==(x.type==null?null:x.type)||l.getAttribute("crossorigin")!==(x.crossOrigin==null?null:x.crossOrigin))&&P&&l.hasAttribute("async")&&!l.hasAttribute("itemprop"))break;return l;default:return l}}else if(d==="input"&&l.type==="hidden"){var P=x.name==null?null:""+x.name;if(x.type==="hidden"&&l.getAttribute("name")===P)return l}else return l;if(l=ps(l.nextSibling),l===null)break}return null}function fx(l,d,_){if(d==="")return null;for(;l.nodeType!==3;)if((l.nodeType!==1||l.nodeName!=="INPUT"||l.type!=="hidden")&&!_||(l=ps(l.nextSibling),l===null))return null;return l}function uR(l,d){for(;l.nodeType!==8;)if((l.nodeType!==1||l.nodeName!=="INPUT"||l.type!=="hidden")&&!d||(l=ps(l.nextSibling),l===null))return null;return l}function a0(l){return l.data==="$?"||l.data==="$~"}function s0(l){return l.data==="$!"||l.data==="$?"&&l.ownerDocument.readyState!=="loading"}function dR(l,d){var _=l.ownerDocument;if(l.data==="$~")l._reactRetry=d;else if(l.data!=="$?"||_.readyState!=="loading")d();else{var S=function(){d(),_.removeEventListener("DOMContentLoaded",S)};_.addEventListener("DOMContentLoaded",S),l._reactRetry=S}}function ps(l){for(;l!=null;l=l.nextSibling){var d=l.nodeType;if(d===1||d===3)break;if(d===8){if(d=l.data,d==="$"||d==="$!"||d==="$?"||d==="$~"||d==="&"||d==="F!"||d==="F")break;if(d==="/$"||d==="/&")return null}}return l}var o0=null;function hR(l){l=l.nextSibling;for(var d=0;l;){if(l.nodeType===8){var _=l.data;if(_==="/$"||_==="/&"){if(d===0)return ps(l.nextSibling);d--}else _!=="$"&&_!=="$!"&&_!=="$?"&&_!=="$~"&&_!=="&"||d++}l=l.nextSibling}return null}function fR(l){l=l.previousSibling;for(var d=0;l;){if(l.nodeType===8){var _=l.data;if(_==="$"||_==="$!"||_==="$?"||_==="$~"||_==="&"){if(d===0)return l;d--}else _!=="/$"&&_!=="/&"||d++}l=l.previousSibling}return null}function pR(l,d,_){switch(d=Zg(_),l){case"html":if(l=d.documentElement,!l)throw Error(c(452));return l;case"head":if(l=d.head,!l)throw Error(c(453));return l;case"body":if(l=d.body,!l)throw Error(c(454));return l;default:throw Error(c(451))}}function Sh(l){for(var d=l.attributes;d.length;)l.removeAttributeNode(d[0]);il(l)}var wa=new Map,c0=new Set;function Qg(l){return typeof l.getRootNode=="function"?l.getRootNode():l.nodeType===9?l:l.ownerDocument}var Ic=_e.d;_e.d={f:l0,r:px,D:mx,C:gR,L:gx,m:u0,X:vx,S:_x,M:yx};function l0(){var l=Ic.f(),d=_h();return l||d}function px(l){var d=Cd(l);d!==null&&d.tag===5&&d.type==="form"?cE(d):Ic.r(l)}var bh=typeof document>"u"?null:document;function mR(l,d,_){var S=bh;if(S&&typeof d=="string"&&d){var x=rs(d);x='link[rel="'+l+'"][href="'+x+'"]',typeof _=="string"&&(x+='[crossorigin="'+_+'"]'),c0.has(x)||(c0.add(x),l={rel:l,crossOrigin:_,href:d},S.querySelector(x)===null&&(d=S.createElement("link"),Di(d,"link",l),gi(d),S.head.appendChild(d)))}}function mx(l){Ic.D(l),mR("dns-prefetch",l,null)}function gR(l,d){Ic.C(l,d),mR("preconnect",l,d)}function gx(l,d,_){Ic.L(l,d,_);var S=bh;if(S&&l&&d){var x='link[rel="preload"][as="'+rs(d)+'"]';d==="image"&&_&&_.imageSrcSet?(x+='[imagesrcset="'+rs(_.imageSrcSet)+'"]',typeof _.imageSizes=="string"&&(x+='[imagesizes="'+rs(_.imageSizes)+'"]')):x+='[href="'+rs(l)+'"]';var P=x;switch(d){case"style":P=Pu(l);break;case"script":P=Th(l)}wa.has(P)||(l=I({rel:"preload",href:d==="image"&&_&&_.imageSrcSet?void 0:l,as:d},_),wa.set(P,l),S.querySelector(x)!==null||d==="style"&&S.querySelector(hp(P))||d==="script"&&S.querySelector(fp(P))||(d=S.createElement("link"),Di(d,"link",l),gi(d),S.head.appendChild(d)))}}function u0(l,d){Ic.m(l,d);var _=bh;if(_&&l){var S=d&&typeof d.as=="string"?d.as:"script",x='link[rel="modulepreload"][as="'+rs(S)+'"][href="'+rs(l)+'"]',P=x;switch(S){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":P=Th(l)}if(!wa.has(P)&&(l=I({rel:"modulepreload",href:l},d),wa.set(P,l),_.querySelector(x)===null)){switch(S){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(_.querySelector(fp(P)))return}S=_.createElement("link"),Di(S,"link",l),gi(S),_.head.appendChild(S)}}}function _x(l,d,_){Ic.S(l,d,_);var S=bh;if(S&&l){var x=Ad(S).hoistableStyles,P=Pu(l);d=d||"default";var Y=x.get(P);if(!Y){var ne={loading:0,preload:null};if(Y=S.querySelector(hp(P)))ne.loading=5;else{l=I({rel:"stylesheet",href:l,"data-precedence":d},_),(_=wa.get(P))&&t_(l,_);var pe=Y=S.createElement("link");gi(pe),Di(pe,"link",l),pe._p=new Promise(function(Pe,We){pe.onload=Pe,pe.onerror=We}),pe.addEventListener("load",function(){ne.loading|=1}),pe.addEventListener("error",function(){ne.loading|=2}),ne.loading|=4,e_(Y,d,S)}Y={type:"stylesheet",instance:Y,count:1,state:ne},x.set(P,Y)}}}function vx(l,d){Ic.X(l,d);var _=bh;if(_&&l){var S=Ad(_).hoistableScripts,x=Th(l),P=S.get(x);P||(P=_.querySelector(fp(x)),P||(l=I({src:l,async:!0},d),(d=wa.get(x))&&n_(l,d),P=_.createElement("script"),gi(P),Di(P,"link",l),_.head.appendChild(P)),P={type:"script",instance:P,count:1,state:null},S.set(x,P))}}function yx(l,d){Ic.M(l,d);var _=bh;if(_&&l){var S=Ad(_).hoistableScripts,x=Th(l),P=S.get(x);P||(P=_.querySelector(fp(x)),P||(l=I({src:l,async:!0,type:"module"},d),(d=wa.get(x))&&n_(l,d),P=_.createElement("script"),gi(P),Di(P,"link",l),_.head.appendChild(P)),P={type:"script",instance:P,count:1,state:null},S.set(x,P))}}function _R(l,d,_,S){var x=(x=rn.current)?Qg(x):null;if(!x)throw Error(c(446));switch(l){case"meta":case"title":return null;case"style":return typeof _.precedence=="string"&&typeof _.href=="string"?(d=Pu(_.href),_=Ad(x).hoistableStyles,S=_.get(d),S||(S={type:"style",instance:null,count:0,state:null},_.set(d,S)),S):{type:"void",instance:null,count:0,state:null};case"link":if(_.rel==="stylesheet"&&typeof _.href=="string"&&typeof _.precedence=="string"){l=Pu(_.href);var P=Ad(x).hoistableStyles,Y=P.get(l);if(Y||(x=x.ownerDocument||x,Y={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},P.set(l,Y),(P=x.querySelector(hp(l)))&&!P._p&&(Y.instance=P,Y.state.loading=5),wa.has(l)||(_={rel:"preload",as:"style",href:_.href,crossOrigin:_.crossOrigin,integrity:_.integrity,media:_.media,hrefLang:_.hrefLang,referrerPolicy:_.referrerPolicy},wa.set(l,_),P||h0(x,l,_,Y.state))),d&&S===null)throw Error(c(528,""));return Y}if(d&&S!==null)throw Error(c(529,""));return null;case"script":return d=_.async,_=_.src,typeof _=="string"&&d&&typeof d!="function"&&typeof d!="symbol"?(d=Th(_),_=Ad(x).hoistableScripts,S=_.get(d),S||(S={type:"script",instance:null,count:0,state:null},_.set(d,S)),S):{type:"void",instance:null,count:0,state:null};default:throw Error(c(444,l))}}function Pu(l){return'href="'+rs(l)+'"'}function hp(l){return'link[rel="stylesheet"]['+l+"]"}function d0(l){return I({},l,{"data-precedence":l.precedence,precedence:null})}function h0(l,d,_,S){l.querySelector('link[rel="preload"][as="style"]['+d+"]")?S.loading=1:(d=l.createElement("link"),S.preload=d,d.addEventListener("load",function(){return S.loading|=1}),d.addEventListener("error",function(){return S.loading|=2}),Di(d,"link",_),gi(d),l.head.appendChild(d))}function Th(l){return'[src="'+rs(l)+'"]'}function fp(l){return"script[async]"+l}function f0(l,d,_){if(d.count++,d.instance===null)switch(d.type){case"style":var S=l.querySelector('style[data-href~="'+rs(_.href)+'"]');if(S)return d.instance=S,gi(S),S;var x=I({},_,{"data-href":_.href,"data-precedence":_.precedence,href:null,precedence:null});return S=(l.ownerDocument||l).createElement("style"),gi(S),Di(S,"style",x),e_(S,_.precedence,l),d.instance=S;case"stylesheet":x=Pu(_.href);var P=l.querySelector(hp(x));if(P)return d.state.loading|=4,d.instance=P,gi(P),P;S=d0(_),(x=wa.get(x))&&t_(S,x),P=(l.ownerDocument||l).createElement("link"),gi(P);var Y=P;return Y._p=new Promise(function(ne,pe){Y.onload=ne,Y.onerror=pe}),Di(P,"link",S),d.state.loading|=4,e_(P,_.precedence,l),d.instance=P;case"script":return P=Th(_.src),(x=l.querySelector(fp(P)))?(d.instance=x,gi(x),x):(S=_,(x=wa.get(P))&&(S=I({},_),n_(S,x)),l=l.ownerDocument||l,x=l.createElement("script"),gi(x),Di(x,"link",S),l.head.appendChild(x),d.instance=x);case"void":return null;default:throw Error(c(443,d.type))}else d.type==="stylesheet"&&(d.state.loading&4)===0&&(S=d.instance,d.state.loading|=4,e_(S,_.precedence,l));return d.instance}function e_(l,d,_){for(var S=_.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),x=S.length?S[S.length-1]:null,P=x,Y=0;Y<S.length;Y++){var ne=S[Y];if(ne.dataset.precedence===d)P=ne;else if(P!==x)break}P?P.parentNode.insertBefore(l,P.nextSibling):(d=_.nodeType===9?_.head:_,d.insertBefore(l,d.firstChild))}function t_(l,d){l.crossOrigin==null&&(l.crossOrigin=d.crossOrigin),l.referrerPolicy==null&&(l.referrerPolicy=d.referrerPolicy),l.title==null&&(l.title=d.title)}function n_(l,d){l.crossOrigin==null&&(l.crossOrigin=d.crossOrigin),l.referrerPolicy==null&&(l.referrerPolicy=d.referrerPolicy),l.integrity==null&&(l.integrity=d.integrity)}var r_=null;function vR(l,d,_){if(r_===null){var S=new Map,x=r_=new Map;x.set(_,S)}else x=r_,S=x.get(_),S||(S=new Map,x.set(_,S));if(S.has(l))return S;for(S.set(l,null),_=_.getElementsByTagName(l),x=0;x<_.length;x++){var P=_[x];if(!(P[wd]||P[mi]||l==="link"&&P.getAttribute("rel")==="stylesheet")&&P.namespaceURI!=="http://www.w3.org/2000/svg"){var Y=P.getAttribute(d)||"";Y=l+Y;var ne=S.get(Y);ne?ne.push(P):S.set(Y,[P])}}return S}function yR(l,d,_){l=l.ownerDocument||l,l.head.insertBefore(_,d==="title"?l.querySelector("head > title"):null)}function Ex(l,d,_){if(_===1||d.itemProp!=null)return!1;switch(l){case"meta":case"title":return!0;case"style":if(typeof d.precedence!="string"||typeof d.href!="string"||d.href==="")break;return!0;case"link":if(typeof d.rel!="string"||typeof d.href!="string"||d.href===""||d.onLoad||d.onError)break;switch(d.rel){case"stylesheet":return l=d.disabled,typeof d.precedence=="string"&&l==null;default:return!0}case"script":if(d.async&&typeof d.async!="function"&&typeof d.async!="symbol"&&!d.onLoad&&!d.onError&&d.src&&typeof d.src=="string")return!0}return!1}function ER(l){return!(l.type==="stylesheet"&&(l.state.loading&3)===0)}function Sx(l,d,_,S){if(_.type==="stylesheet"&&(typeof S.media!="string"||matchMedia(S.media).matches!==!1)&&(_.state.loading&4)===0){if(_.instance===null){var x=Pu(S.href),P=d.querySelector(hp(x));if(P){d=P._p,d!==null&&typeof d=="object"&&typeof d.then=="function"&&(l.count++,l=pp.bind(l),d.then(l,l)),_.state.loading|=4,_.instance=P,gi(P);return}P=d.ownerDocument||d,S=d0(S),(x=wa.get(x))&&t_(S,x),P=P.createElement("link"),gi(P);var Y=P;Y._p=new Promise(function(ne,pe){Y.onload=ne,Y.onerror=pe}),Di(P,"link",S),_.instance=P}l.stylesheets===null&&(l.stylesheets=new Map),l.stylesheets.set(_,d),(d=_.state.preload)&&(_.state.loading&3)===0&&(l.count++,_=pp.bind(l),d.addEventListener("load",_),d.addEventListener("error",_))}}var i_=0;function p0(l,d){return l.stylesheets&&l.count===0&&a_(l,l.stylesheets),0<l.count||0<l.imgCount?function(_){var S=setTimeout(function(){if(l.stylesheets&&a_(l,l.stylesheets),l.unsuspend){var P=l.unsuspend;l.unsuspend=null,P()}},6e4+d);0<l.imgBytes&&i_===0&&(i_=62500*ox());var x=setTimeout(function(){if(l.waitingForImages=!1,l.count===0&&(l.stylesheets&&a_(l,l.stylesheets),l.unsuspend)){var P=l.unsuspend;l.unsuspend=null,P()}},(l.imgBytes>i_?50:800)+d);return l.unsuspend=_,function(){l.unsuspend=null,clearTimeout(S),clearTimeout(x)}}:null}function pp(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)a_(this,this.stylesheets);else if(this.unsuspend){var l=this.unsuspend;this.unsuspend=null,l()}}}var Fe=null;function a_(l,d){l.stylesheets=null,l.unsuspend!==null&&(l.count++,Fe=new Map,d.forEach(bx,l),Fe=null,pp.call(l))}function bx(l,d){if(!(d.state.loading&4)){var _=Fe.get(l);if(_)var S=_.get(null);else{_=new Map,Fe.set(l,_);for(var x=l.querySelectorAll("link[data-precedence],style[data-precedence]"),P=0;P<x.length;P++){var Y=x[P];(Y.nodeName==="LINK"||Y.getAttribute("media")!=="not all")&&(_.set(Y.dataset.precedence,Y),S=Y)}S&&_.set(null,S)}x=d.instance,Y=x.getAttribute("data-precedence"),P=_.get(Y)||S,P===S&&_.set(null,x),_.set(Y,x),this.count++,S=pp.bind(this),x.addEventListener("load",S),x.addEventListener("error",S),P?P.parentNode.insertBefore(x,P.nextSibling):(l=l.nodeType===9?l.head:l,l.insertBefore(x,l.firstChild)),d.state.loading|=4}}var mp={$$typeof:Z,Provider:null,Consumer:null,_currentValue:ze,_currentValue2:ze,_threadCount:0};function Tx(l,d,_,S,x,P,Y,ne,pe){this.tag=1,this.containerInfo=l,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=sy(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=sy(0),this.hiddenUpdates=sy(null),this.identifierPrefix=S,this.onUncaughtError=x,this.onCaughtError=P,this.onRecoverableError=Y,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=pe,this.incompleteTransitions=new Map}function SR(l,d,_,S,x,P,Y,ne,pe,Pe,We,Ze){return l=new Tx(l,d,_,Y,pe,Pe,We,Ze,ne),d=1,P===!0&&(d|=24),P=Va(3,null,null,d),l.current=P,P.stateNode=l,d=Vy(),d.refCount++,l.pooledCache=d,d.refCount++,P.memoizedState={element:S,isDehydrated:_,cache:d},qd(P),l}function s_(l){return l?(l=jd,l):jd}function bR(l,d,_,S,x,P){x=s_(x),S.context===null?S.context=x:S.pendingContext=x,S=ul(d),S.payload={element:_},P=P===void 0?null:P,P!==null&&(S.callback=P),_=dl(l,S,d),_!==null&&(Ta(_,l,d),Xd(_,l,d))}function TR(l,d){if(l=l.memoizedState,l!==null&&l.dehydrated!==null){var _=l.retryLane;l.retryLane=_!==0&&_<d?_:d}}function Pi(l,d){TR(l,d),(l=l.alternate)&&TR(l,d)}function m0(l){if(l.tag===13||l.tag===31){var d=lo(l,67108864);d!==null&&Ta(d,l,67108864),Pi(l,67108864)}}function wR(l){if(l.tag===13||l.tag===31){var d=za();d=xm(d);var _=lo(l,d);_!==null&&Ta(_,l,d),Pi(l,d)}}var gp=!0;function wx(l,d,_,S){var x=he.T;he.T=null;var P=_e.p;try{_e.p=2,o_(l,d,_,S)}finally{_e.p=P,he.T=x}}function g0(l,d,_,S){var x=he.T;he.T=null;var P=_e.p;try{_e.p=8,o_(l,d,_,S)}finally{_e.p=P,he.T=x}}function o_(l,d,_,S){if(gp){var x=c_(S);if(x===null)$E(l,d,S,l_,_),u_(l,S);else if(Rx(x,l,d,_,S))S.stopPropagation();else if(u_(l,S),d&4&&-1<RR.indexOf(l)){for(;x!==null;){var P=Cd(x);if(P!==null)switch(P.tag){case 3:if(P=P.stateNode,P.current.memoizedState.isDehydrated){var Y=tu(P.pendingLanes);if(Y!==0){var ne=P;for(ne.pendingLanes|=2,ne.entangledLanes|=2;Y;){var pe=1<<31-Ma(Y);ne.entanglements[1]|=pe,Y&=~pe}go(P),(On&6)===0&&(Bg=Yn()+500,Oc(0))}}break;case 31:case 13:ne=lo(P,2),ne!==null&&Ta(ne,P,2),_h(),Pi(P,2)}if(P=c_(S),P===null&&$E(l,d,S,l_,_),P===x)break;x=P}x!==null&&S.stopPropagation()}else $E(l,d,S,null,_)}}function c_(l){return l=py(l),_0(l)}var l_=null;function _0(l){if(l_=null,l=Rd(l),l!==null){var d=p(l);if(d===null)l=null;else{var _=d.tag;if(_===13){if(l=v(d),l!==null)return l;l=null}else if(_===31){if(l=b(d),l!==null)return l;l=null}else if(_===3){if(d.stateNode.current.memoizedState.isDehydrated)return d.tag===3?d.stateNode.containerInfo:null;l=null}else d!==l&&(l=null)}}return l_=l,null}function v0(l){switch(l){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(zb()){case ry:return 2;case co:return 8;case _f:case iy:return 32;case ay:return 268435456;default:return 32}default:return 32}}var y0=!1,wl=null,Nc=null,Rl=null,_p=new Map,wh=new Map,Cl=[],RR="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function u_(l,d){switch(l){case"focusin":case"focusout":wl=null;break;case"dragenter":case"dragleave":Nc=null;break;case"mouseover":case"mouseout":Rl=null;break;case"pointerover":case"pointerout":_p.delete(d.pointerId);break;case"gotpointercapture":case"lostpointercapture":wh.delete(d.pointerId)}}function vp(l,d,_,S,x,P){return l===null||l.nativeEvent!==P?(l={blockedOn:d,domEventName:_,eventSystemFlags:S,nativeEvent:P,targetContainers:[x]},d!==null&&(d=Cd(d),d!==null&&m0(d)),l):(l.eventSystemFlags|=S,d=l.targetContainers,x!==null&&d.indexOf(x)===-1&&d.push(x),l)}function Rx(l,d,_,S,x){switch(d){case"focusin":return wl=vp(wl,l,d,_,S,x),!0;case"dragenter":return Nc=vp(Nc,l,d,_,S,x),!0;case"mouseover":return Rl=vp(Rl,l,d,_,S,x),!0;case"pointerover":var P=x.pointerId;return _p.set(P,vp(_p.get(P)||null,l,d,_,S,x)),!0;case"gotpointercapture":return P=x.pointerId,wh.set(P,vp(wh.get(P)||null,l,d,_,S,x)),!0}return!1}function E0(l){var d=Rd(l.target);if(d!==null){var _=p(d);if(_!==null){if(d=_.tag,d===13){if(d=v(_),d!==null){l.blockedOn=d,Zb(l.priority,function(){wR(_)});return}}else if(d===31){if(d=b(_),d!==null){l.blockedOn=d,Zb(l.priority,function(){wR(_)});return}}else if(d===3&&_.stateNode.current.memoizedState.isDehydrated){l.blockedOn=_.tag===3?_.stateNode.containerInfo:null;return}}}l.blockedOn=null}function d_(l){if(l.blockedOn!==null)return!1;for(var d=l.targetContainers;0<d.length;){var _=c_(l.nativeEvent);if(_===null){_=l.nativeEvent;var S=new _.constructor(_.type,_);fy=S,_.target.dispatchEvent(S),fy=null}else return d=Cd(_),d!==null&&m0(d),l.blockedOn=_,!1;d.shift()}return!0}function S0(l,d,_){d_(l)&&_.delete(d)}function CR(){y0=!1,wl!==null&&d_(wl)&&(wl=null),Nc!==null&&d_(Nc)&&(Nc=null),Rl!==null&&d_(Rl)&&(Rl=null),_p.forEach(S0),wh.forEach(S0)}function Vs(l,d){l.blockedOn===d&&(l.blockedOn=null,y0||(y0=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,CR)))}var yp=null;function AR(l){yp!==l&&(yp=l,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){yp===l&&(yp=null);for(var d=0;d<l.length;d+=3){var _=l[d],S=l[d+1],x=l[d+2];if(typeof S!="function"){if(_0(S||_)===null)continue;break}var P=Cd(_);P!==null&&(l.splice(d,3),d-=3,sE(P,{pending:!0,data:x,method:_.method,action:S},S,x))}}))}function Rh(l){function d(pe){return Vs(pe,l)}wl!==null&&Vs(wl,l),Nc!==null&&Vs(Nc,l),Rl!==null&&Vs(Rl,l),_p.forEach(d),wh.forEach(d);for(var _=0;_<Cl.length;_++){var S=Cl[_];S.blockedOn===l&&(S.blockedOn=null)}for(;0<Cl.length&&(_=Cl[0],_.blockedOn===null);)E0(_),_.blockedOn===null&&Cl.shift();if(_=(l.ownerDocument||l).$$reactFormReplay,_!=null)for(S=0;S<_.length;S+=3){var x=_[S],P=_[S+1],Y=x[va]||null;if(typeof P=="function")Y||AR(_);else if(Y){var ne=null;if(P&&P.hasAttribute("formAction")){if(x=P,Y=P[va]||null)ne=Y.formAction;else if(_0(x)!==null)continue}else ne=Y.action;typeof ne=="function"?_[S+1]=ne:(_.splice(S,3),S-=3),AR(_)}}}function OR(){function l(P){P.canIntercept&&P.info==="react-transition"&&P.intercept({handler:function(){return new Promise(function(Y){return x=Y})},focusReset:"manual",scroll:"manual"})}function d(){x!==null&&(x(),x=null),S||setTimeout(_,20)}function _(){if(!S&&!navigation.transition){var P=navigation.currentEntry;P&&P.url!=null&&navigation.navigate(P.url,{state:P.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var S=!1,x=null;return navigation.addEventListener("navigate",l),navigation.addEventListener("navigatesuccess",d),navigation.addEventListener("navigateerror",d),setTimeout(_,100),function(){S=!0,navigation.removeEventListener("navigate",l),navigation.removeEventListener("navigatesuccess",d),navigation.removeEventListener("navigateerror",d),x!==null&&(x(),x=null)}}}function b0(l){this._internalRoot=l}Ep.prototype.render=b0.prototype.render=function(l){var d=this._internalRoot;if(d===null)throw Error(c(409));var _=d.current,S=za();bR(_,S,l,d,null,null)},Ep.prototype.unmount=b0.prototype.unmount=function(){var l=this._internalRoot;if(l!==null){this._internalRoot=null;var d=l.containerInfo;bR(l.current,2,null,l,null,null),_h(),d[Td]=null}};function Ep(l){this._internalRoot=l}Ep.prototype.unstable_scheduleHydration=function(l){if(l){var d=oy();l={blockedOn:null,target:l,priority:d};for(var _=0;_<Cl.length&&d!==0&&d<Cl[_].priority;_++);Cl.splice(_,0,l),_===0&&E0(l)}};var IR=i.version;if(IR!=="19.2.0")throw Error(c(527,IR,"19.2.0"));_e.findDOMNode=function(l){var d=l._reactInternals;if(d===void 0)throw typeof l.render=="function"?Error(c(188)):(l=Object.keys(l).join(","),Error(c(268,l)));return l=w(d),l=l!==null?C(l):null,l=l===null?null:l.stateNode,l};var Cx={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:he,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var h_=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!h_.isDisabled&&h_.supportsFiber)try{Ed=h_.inject(Cx),si=h_}catch{}}return kS.createRoot=function(l,d){if(!f(l))throw Error(c(299));var _=!1,S="",x=po,P=pw,Y=mw;return d!=null&&(d.unstable_strictMode===!0&&(_=!0),d.identifierPrefix!==void 0&&(S=d.identifierPrefix),d.onUncaughtError!==void 0&&(x=d.onUncaughtError),d.onCaughtError!==void 0&&(P=d.onCaughtError),d.onRecoverableError!==void 0&&(Y=d.onRecoverableError)),d=SR(l,1,!1,null,null,_,S,null,x,P,Y,OR),l[Td]=d.current,XE(l),new b0(d)},kS.hydrateRoot=function(l,d,_){if(!f(l))throw Error(c(299));var S=!1,x="",P=po,Y=pw,ne=mw,pe=null;return _!=null&&(_.unstable_strictMode===!0&&(S=!0),_.identifierPrefix!==void 0&&(x=_.identifierPrefix),_.onUncaughtError!==void 0&&(P=_.onUncaughtError),_.onCaughtError!==void 0&&(Y=_.onCaughtError),_.onRecoverableError!==void 0&&(ne=_.onRecoverableError),_.formState!==void 0&&(pe=_.formState)),d=SR(l,1,!0,d,_??null,S,x,pe,P,Y,ne,OR),d.context=s_(null),_=d.current,S=za(),S=xm(S),x=ul(S),x.callback=null,dl(_,x,S),_=S,d.current.lanes=_,yf(d,_),go(d),l[Td]=d.current,XE(l),new Ep(d)},kS.version="19.2.0",kS}var sz;function ude(){if(sz)return dk.exports;sz=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(i){console.error(i)}}return n(),dk.exports=lde(),dk.exports}var dde=ude();/**
 * react-router v7.9.5
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var oz="popstate";function hde(n={}){function i(c,f){let{pathname:p,search:v,hash:b}=c.location;return lM("",{pathname:p,search:v,hash:b},f.state&&f.state.usr||null,f.state&&f.state.key||"default")}function s(c,f){return typeof f=="string"?f:nb(f)}return pde(i,s,null,n)}function Mr(n,i){if(n===!1||n===null||typeof n>"u")throw new Error(i)}function Qc(n,i){if(!n){typeof console<"u"&&console.warn(i);try{throw new Error(i)}catch{}}}function fde(){return Math.random().toString(36).substring(2,10)}function cz(n,i){return{usr:n.state,key:n.key,idx:i}}function lM(n,i,s=null,c){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof i=="string"?Bv(i):i,state:s,key:i&&i.key||c||fde()}}function nb({pathname:n="/",search:i="",hash:s=""}){return i&&i!=="?"&&(n+=i.charAt(0)==="?"?i:"?"+i),s&&s!=="#"&&(n+=s.charAt(0)==="#"?s:"#"+s),n}function Bv(n){let i={};if(n){let s=n.indexOf("#");s>=0&&(i.hash=n.substring(s),n=n.substring(0,s));let c=n.indexOf("?");c>=0&&(i.search=n.substring(c),n=n.substring(0,c)),n&&(i.pathname=n)}return i}function pde(n,i,s,c={}){let{window:f=document.defaultView,v5Compat:p=!1}=c,v=f.history,b="POP",T=null,w=C();w==null&&(w=0,v.replaceState({...v.state,idx:w},""));function C(){return(v.state||{idx:null}).idx}function I(){b="POP";let G=C(),$=G==null?null:G-w;w=G,T&&T({action:b,location:W.location,delta:$})}function D(G,$){b="PUSH";let te=lM(W.location,G,$);w=C()+1;let Z=cz(te,w),ce=W.createHref(te);try{v.pushState(Z,"",ce)}catch(se){if(se instanceof DOMException&&se.name==="DataCloneError")throw se;f.location.assign(ce)}p&&T&&T({action:b,location:W.location,delta:1})}function L(G,$){b="REPLACE";let te=lM(W.location,G,$);w=C();let Z=cz(te,w),ce=W.createHref(te);v.replaceState(Z,"",ce),p&&T&&T({action:b,location:W.location,delta:0})}function F(G){return mde(G)}let W={get action(){return b},get location(){return n(f,v)},listen(G){if(T)throw new Error("A history only accepts one active listener");return f.addEventListener(oz,I),T=G,()=>{f.removeEventListener(oz,I),T=null}},createHref(G){return i(f,G)},createURL:F,encodeLocation(G){let $=F(G);return{pathname:$.pathname,search:$.search,hash:$.hash}},push:D,replace:L,go(G){return v.go(G)}};return W}function mde(n,i=!1){let s="http://localhost";typeof window<"u"&&(s=window.location.origin!=="null"?window.location.origin:window.location.href),Mr(s,"No window.location.(origin|href) available to create URL");let c=typeof n=="string"?n:nb(n);return c=c.replace(/ $/,"%20"),!i&&c.startsWith("//")&&(c=s+c),new URL(c,s)}function Aq(n,i,s="/"){return gde(n,i,s,!1)}function gde(n,i,s,c){let f=typeof i=="string"?Bv(i):i,p=id(f.pathname||"/",s);if(p==null)return null;let v=Oq(n);_de(v);let b=null;for(let T=0;b==null&&T<v.length;++T){let w=Ode(p);b=Cde(v[T],w,c)}return b}function Oq(n,i=[],s=[],c="",f=!1){let p=(v,b,T=f,w)=>{let C={relativePath:w===void 0?v.path||"":w,caseSensitive:v.caseSensitive===!0,childrenIndex:b,route:v};if(C.relativePath.startsWith("/")){if(!C.relativePath.startsWith(c)&&T)return;Mr(C.relativePath.startsWith(c),`Absolute route path "${C.relativePath}" nested under path "${c}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),C.relativePath=C.relativePath.slice(c.length)}let I=td([c,C.relativePath]),D=s.concat(C);v.children&&v.children.length>0&&(Mr(v.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${I}".`),Oq(v.children,i,D,I,T)),!(v.path==null&&!v.index)&&i.push({path:I,score:wde(I,v.index),routesMeta:D})};return n.forEach((v,b)=>{if(v.path===""||!v.path?.includes("?"))p(v,b);else for(let T of Iq(v.path))p(v,b,!0,T)}),i}function Iq(n){let i=n.split("/");if(i.length===0)return[];let[s,...c]=i,f=s.endsWith("?"),p=s.replace(/\?$/,"");if(c.length===0)return f?[p,""]:[p];let v=Iq(c.join("/")),b=[];return b.push(...v.map(T=>T===""?p:[p,T].join("/"))),f&&b.push(...v),b.map(T=>n.startsWith("/")&&T===""?"/":T)}function _de(n){n.sort((i,s)=>i.score!==s.score?s.score-i.score:Rde(i.routesMeta.map(c=>c.childrenIndex),s.routesMeta.map(c=>c.childrenIndex)))}var vde=/^:[\w-]+$/,yde=3,Ede=2,Sde=1,bde=10,Tde=-2,lz=n=>n==="*";function wde(n,i){let s=n.split("/"),c=s.length;return s.some(lz)&&(c+=Tde),i&&(c+=Ede),s.filter(f=>!lz(f)).reduce((f,p)=>f+(vde.test(p)?yde:p===""?Sde:bde),c)}function Rde(n,i){return n.length===i.length&&n.slice(0,-1).every((c,f)=>c===i[f])?n[n.length-1]-i[i.length-1]:0}function Cde(n,i,s=!1){let{routesMeta:c}=n,f={},p="/",v=[];for(let b=0;b<c.length;++b){let T=c[b],w=b===c.length-1,C=p==="/"?i:i.slice(p.length)||"/",I=DO({path:T.relativePath,caseSensitive:T.caseSensitive,end:w},C),D=T.route;if(!I&&w&&s&&!c[c.length-1].route.index&&(I=DO({path:T.relativePath,caseSensitive:T.caseSensitive,end:!1},C)),!I)return null;Object.assign(f,I.params),v.push({params:f,pathname:td([p,I.pathname]),pathnameBase:Dde(td([p,I.pathnameBase])),route:D}),I.pathnameBase!=="/"&&(p=td([p,I.pathnameBase]))}return v}function DO(n,i){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[s,c]=Ade(n.path,n.caseSensitive,n.end),f=i.match(s);if(!f)return null;let p=f[0],v=p.replace(/(.)\/+$/,"$1"),b=f.slice(1);return{params:c.reduce((w,{paramName:C,isOptional:I},D)=>{if(C==="*"){let F=b[D]||"";v=p.slice(0,p.length-F.length).replace(/(.)\/+$/,"$1")}const L=b[D];return I&&!L?w[C]=void 0:w[C]=(L||"").replace(/%2F/g,"/"),w},{}),pathname:p,pathnameBase:v,pattern:n}}function Ade(n,i=!1,s=!0){Qc(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let c=[],f="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(v,b,T)=>(c.push({paramName:b,isOptional:T!=null}),T?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return n.endsWith("*")?(c.push({paramName:"*"}),f+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):s?f+="\\/*$":n!==""&&n!=="/"&&(f+="(?:(?=\\/|$))"),[new RegExp(f,i?void 0:"i"),c]}function Ode(n){try{return n.split("/").map(i=>decodeURIComponent(i).replace(/\//g,"%2F")).join("/")}catch(i){return Qc(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${i}).`),n}}function id(n,i){if(i==="/")return n;if(!n.toLowerCase().startsWith(i.toLowerCase()))return null;let s=i.endsWith("/")?i.length-1:i.length,c=n.charAt(s);return c&&c!=="/"?null:n.slice(s)||"/"}function Ide(n,i="/"){let{pathname:s,search:c="",hash:f=""}=typeof n=="string"?Bv(n):n;return{pathname:s?s.startsWith("/")?s:Nde(s,i):i,search:Pde(c),hash:kde(f)}}function Nde(n,i){let s=i.replace(/\/+$/,"").split("/");return n.split("/").forEach(f=>{f===".."?s.length>1&&s.pop():f!=="."&&s.push(f)}),s.length>1?s.join("/"):"/"}function mk(n,i,s,c){return`Cannot include a '${n}' character in a manually specified \`to.${i}\` field [${JSON.stringify(c)}].  Please separate it out to the \`to.${s}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function xde(n){return n.filter((i,s)=>s===0||i.route.path&&i.route.path.length>0)}function R2(n){let i=xde(n);return i.map((s,c)=>c===i.length-1?s.pathname:s.pathnameBase)}function C2(n,i,s,c=!1){let f;typeof n=="string"?f=Bv(n):(f={...n},Mr(!f.pathname||!f.pathname.includes("?"),mk("?","pathname","search",f)),Mr(!f.pathname||!f.pathname.includes("#"),mk("#","pathname","hash",f)),Mr(!f.search||!f.search.includes("#"),mk("#","search","hash",f)));let p=n===""||f.pathname==="",v=p?"/":f.pathname,b;if(v==null)b=s;else{let I=i.length-1;if(!c&&v.startsWith("..")){let D=v.split("/");for(;D[0]==="..";)D.shift(),I-=1;f.pathname=D.join("/")}b=I>=0?i[I]:"/"}let T=Ide(f,b),w=v&&v!=="/"&&v.endsWith("/"),C=(p||v===".")&&s.endsWith("/");return!T.pathname.endsWith("/")&&(w||C)&&(T.pathname+="/"),T}var td=n=>n.join("/").replace(/\/\/+/g,"/"),Dde=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),Pde=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,kde=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function Lde(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var Nq=["POST","PUT","PATCH","DELETE"];new Set(Nq);var Mde=["GET",...Nq];new Set(Mde);var Fv=j.createContext(null);Fv.displayName="DataRouter";var TI=j.createContext(null);TI.displayName="DataRouterState";j.createContext(!1);var xq=j.createContext({isTransitioning:!1});xq.displayName="ViewTransition";var Ude=j.createContext(new Map);Ude.displayName="Fetchers";var jde=j.createContext(null);jde.displayName="Await";var tl=j.createContext(null);tl.displayName="Navigation";var bb=j.createContext(null);bb.displayName="Location";var nl=j.createContext({outlet:null,matches:[],isDataRoute:!1});nl.displayName="Route";var A2=j.createContext(null);A2.displayName="RouteError";function Vde(n,{relative:i}={}){Mr(Gv(),"useHref() may be used only in the context of a <Router> component.");let{basename:s,navigator:c}=j.useContext(tl),{hash:f,pathname:p,search:v}=Tb(n,{relative:i}),b=p;return s!=="/"&&(b=p==="/"?s:td([s,p])),c.createHref({pathname:b,search:v,hash:f})}function Gv(){return j.useContext(bb)!=null}function Zl(){return Mr(Gv(),"useLocation() may be used only in the context of a <Router> component."),j.useContext(bb).location}var Dq="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Pq(n){j.useContext(tl).static||j.useLayoutEffect(n)}function lf(){let{isDataRoute:n}=j.useContext(nl);return n?Qde():Bde()}function Bde(){Mr(Gv(),"useNavigate() may be used only in the context of a <Router> component.");let n=j.useContext(Fv),{basename:i,navigator:s}=j.useContext(tl),{matches:c}=j.useContext(nl),{pathname:f}=Zl(),p=JSON.stringify(R2(c)),v=j.useRef(!1);return Pq(()=>{v.current=!0}),j.useCallback((T,w={})=>{if(Qc(v.current,Dq),!v.current)return;if(typeof T=="number"){s.go(T);return}let C=C2(T,JSON.parse(p),f,w.relative==="path");n==null&&i!=="/"&&(C.pathname=C.pathname==="/"?i:td([i,C.pathname])),(w.replace?s.replace:s.push)(C,w.state,w)},[i,s,p,f,n])}j.createContext(null);function Fde(){let{matches:n}=j.useContext(nl),i=n[n.length-1];return i?i.params:{}}function Tb(n,{relative:i}={}){let{matches:s}=j.useContext(nl),{pathname:c}=Zl(),f=JSON.stringify(R2(s));return j.useMemo(()=>C2(n,JSON.parse(f),c,i==="path"),[n,f,c,i])}function Gde(n,i){return kq(n,i)}function kq(n,i,s,c,f){Mr(Gv(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:p}=j.useContext(tl),{matches:v}=j.useContext(nl),b=v[v.length-1],T=b?b.params:{},w=b?b.pathname:"/",C=b?b.pathnameBase:"/",I=b&&b.route;{let te=I&&I.path||"";Lq(w,!I||te.endsWith("*")||te.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${w}" (under <Route path="${te}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${te}"> to <Route path="${te==="/"?"*":`${te}/*`}">.`)}let D=Zl(),L;if(i){let te=typeof i=="string"?Bv(i):i;Mr(C==="/"||te.pathname?.startsWith(C),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${C}" but pathname "${te.pathname}" was given in the \`location\` prop.`),L=te}else L=D;let F=L.pathname||"/",W=F;if(C!=="/"){let te=C.replace(/^\//,"").split("/");W="/"+F.replace(/^\//,"").split("/").slice(te.length).join("/")}let G=Aq(n,{pathname:W});Qc(I||G!=null,`No routes matched location "${L.pathname}${L.search}${L.hash}" `),Qc(G==null||G[G.length-1].route.element!==void 0||G[G.length-1].route.Component!==void 0||G[G.length-1].route.lazy!==void 0,`Matched leaf route at location "${L.pathname}${L.search}${L.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let $=Yde(G&&G.map(te=>Object.assign({},te,{params:Object.assign({},T,te.params),pathname:td([C,p.encodeLocation?p.encodeLocation(te.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:te.pathname]),pathnameBase:te.pathnameBase==="/"?C:td([C,p.encodeLocation?p.encodeLocation(te.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:te.pathnameBase])})),v,s,c,f);return i&&$?j.createElement(bb.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...L},navigationType:"POP"}},$):$}function Hde(){let n=Zde(),i=Lde(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),s=n instanceof Error?n.stack:null,c="rgba(200,200,200, 0.5)",f={padding:"0.5rem",backgroundColor:c},p={padding:"2px 4px",backgroundColor:c},v=null;return console.error("Error handled by React Router default ErrorBoundary:",n),v=j.createElement(j.Fragment,null,j.createElement("p",null," Hey developer "),j.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",j.createElement("code",{style:p},"ErrorBoundary")," or"," ",j.createElement("code",{style:p},"errorElement")," prop on your route.")),j.createElement(j.Fragment,null,j.createElement("h2",null,"Unexpected Application Error!"),j.createElement("h3",{style:{fontStyle:"italic"}},i),s?j.createElement("pre",{style:f},s):null,v)}var Wde=j.createElement(Hde,null),zde=class extends j.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,i){return i.location!==n.location||i.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:i.error,location:i.location,revalidation:n.revalidation||i.revalidation}}componentDidCatch(n,i){this.props.unstable_onError?this.props.unstable_onError(n,i):console.error("React Router caught the following error during render",n)}render(){return this.state.error!==void 0?j.createElement(nl.Provider,{value:this.props.routeContext},j.createElement(A2.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function Kde({routeContext:n,match:i,children:s}){let c=j.useContext(Fv);return c&&c.static&&c.staticContext&&(i.route.errorElement||i.route.ErrorBoundary)&&(c.staticContext._deepestRenderedBoundaryId=i.route.id),j.createElement(nl.Provider,{value:n},s)}function Yde(n,i=[],s=null,c=null,f=null){if(n==null){if(!s)return null;if(s.errors)n=s.matches;else if(i.length===0&&!s.initialized&&s.matches.length>0)n=s.matches;else return null}let p=n,v=s?.errors;if(v!=null){let w=p.findIndex(C=>C.route.id&&v?.[C.route.id]!==void 0);Mr(w>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(v).join(",")}`),p=p.slice(0,Math.min(p.length,w+1))}let b=!1,T=-1;if(s)for(let w=0;w<p.length;w++){let C=p[w];if((C.route.HydrateFallback||C.route.hydrateFallbackElement)&&(T=w),C.route.id){let{loaderData:I,errors:D}=s,L=C.route.loader&&!I.hasOwnProperty(C.route.id)&&(!D||D[C.route.id]===void 0);if(C.route.lazy||L){b=!0,T>=0?p=p.slice(0,T+1):p=[p[0]];break}}}return p.reduceRight((w,C,I)=>{let D,L=!1,F=null,W=null;s&&(D=v&&C.route.id?v[C.route.id]:void 0,F=C.route.errorElement||Wde,b&&(T<0&&I===0?(Lq("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),L=!0,W=null):T===I&&(L=!0,W=C.route.hydrateFallbackElement||null)));let G=i.concat(p.slice(0,I+1)),$=()=>{let te;return D?te=F:L?te=W:C.route.Component?te=j.createElement(C.route.Component,null):C.route.element?te=C.route.element:te=w,j.createElement(Kde,{match:C,routeContext:{outlet:w,matches:G,isDataRoute:s!=null},children:te})};return s&&(C.route.ErrorBoundary||C.route.errorElement||I===0)?j.createElement(zde,{location:s.location,revalidation:s.revalidation,component:F,error:D,children:$(),routeContext:{outlet:null,matches:G,isDataRoute:!0},unstable_onError:c}):$()},null)}function O2(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function qde(n){let i=j.useContext(Fv);return Mr(i,O2(n)),i}function Xde(n){let i=j.useContext(TI);return Mr(i,O2(n)),i}function Jde(n){let i=j.useContext(nl);return Mr(i,O2(n)),i}function I2(n){let i=Jde(n),s=i.matches[i.matches.length-1];return Mr(s.route.id,`${n} can only be used on routes that contain a unique "id"`),s.route.id}function $de(){return I2("useRouteId")}function Zde(){let n=j.useContext(A2),i=Xde("useRouteError"),s=I2("useRouteError");return n!==void 0?n:i.errors?.[s]}function Qde(){let{router:n}=qde("useNavigate"),i=I2("useNavigate"),s=j.useRef(!1);return Pq(()=>{s.current=!0}),j.useCallback(async(f,p={})=>{Qc(s.current,Dq),s.current&&(typeof f=="number"?n.navigate(f):await n.navigate(f,{fromRouteId:i,...p}))},[n,i])}var uz={};function Lq(n,i,s){!i&&!uz[n]&&(uz[n]=!0,Qc(!1,s))}j.memo(ehe);function ehe({routes:n,future:i,state:s,unstable_onError:c}){return kq(n,void 0,s,c,i)}function N2({to:n,replace:i,state:s,relative:c}){Mr(Gv(),"<Navigate> may be used only in the context of a <Router> component.");let{static:f}=j.useContext(tl);Qc(!f,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:p}=j.useContext(nl),{pathname:v}=Zl(),b=lf(),T=C2(n,R2(p),v,c==="path"),w=JSON.stringify(T);return j.useEffect(()=>{b(JSON.parse(w),{replace:i,state:s,relative:c})},[b,w,c,i,s]),null}function $a(n){Mr(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function the({basename:n="/",children:i=null,location:s,navigationType:c="POP",navigator:f,static:p=!1}){Mr(!Gv(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let v=n.replace(/^\/*/,"/"),b=j.useMemo(()=>({basename:v,navigator:f,static:p,future:{}}),[v,f,p]);typeof s=="string"&&(s=Bv(s));let{pathname:T="/",search:w="",hash:C="",state:I=null,key:D="default"}=s,L=j.useMemo(()=>{let F=id(T,v);return F==null?null:{location:{pathname:F,search:w,hash:C,state:I,key:D},navigationType:c}},[v,T,w,C,I,D,c]);return Qc(L!=null,`<Router basename="${v}"> is not able to match the URL "${T}${w}${C}" because it does not start with the basename, so the <Router> won't render anything.`),L==null?null:j.createElement(tl.Provider,{value:b},j.createElement(bb.Provider,{children:i,value:L}))}function nhe({children:n,location:i}){return Gde(uM(n),i)}function uM(n,i=[]){let s=[];return j.Children.forEach(n,(c,f)=>{if(!j.isValidElement(c))return;let p=[...i,f];if(c.type===j.Fragment){s.push.apply(s,uM(c.props.children,p));return}Mr(c.type===$a,`[${typeof c.type=="string"?c.type:c.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Mr(!c.props.index||!c.props.children,"An index route cannot have child routes.");let v={id:c.props.id||p.join("-"),caseSensitive:c.props.caseSensitive,element:c.props.element,Component:c.props.Component,index:c.props.index,path:c.props.path,middleware:c.props.middleware,loader:c.props.loader,action:c.props.action,hydrateFallbackElement:c.props.hydrateFallbackElement,HydrateFallback:c.props.HydrateFallback,errorElement:c.props.errorElement,ErrorBoundary:c.props.ErrorBoundary,hasErrorBoundary:c.props.hasErrorBoundary===!0||c.props.ErrorBoundary!=null||c.props.errorElement!=null,shouldRevalidate:c.props.shouldRevalidate,handle:c.props.handle,lazy:c.props.lazy};c.props.children&&(v.children=uM(c.props.children,p)),s.push(v)}),s}var SO="get",bO="application/x-www-form-urlencoded";function wI(n){return n!=null&&typeof n.tagName=="string"}function rhe(n){return wI(n)&&n.tagName.toLowerCase()==="button"}function ihe(n){return wI(n)&&n.tagName.toLowerCase()==="form"}function ahe(n){return wI(n)&&n.tagName.toLowerCase()==="input"}function she(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function ohe(n,i){return n.button===0&&(!i||i==="_self")&&!she(n)}var ZA=null;function che(){if(ZA===null)try{new FormData(document.createElement("form"),0),ZA=!1}catch{ZA=!0}return ZA}var lhe=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function gk(n){return n!=null&&!lhe.has(n)?(Qc(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${bO}"`),null):n}function uhe(n,i){let s,c,f,p,v;if(ihe(n)){let b=n.getAttribute("action");c=b?id(b,i):null,s=n.getAttribute("method")||SO,f=gk(n.getAttribute("enctype"))||bO,p=new FormData(n)}else if(rhe(n)||ahe(n)&&(n.type==="submit"||n.type==="image")){let b=n.form;if(b==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let T=n.getAttribute("formaction")||b.getAttribute("action");if(c=T?id(T,i):null,s=n.getAttribute("formmethod")||b.getAttribute("method")||SO,f=gk(n.getAttribute("formenctype"))||gk(b.getAttribute("enctype"))||bO,p=new FormData(b,n),!che()){let{name:w,type:C,value:I}=n;if(C==="image"){let D=w?`${w}.`:"";p.append(`${D}x`,"0"),p.append(`${D}y`,"0")}else w&&p.append(w,I)}}else{if(wI(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');s=SO,c=null,f=bO,v=n}return p&&f==="text/plain"&&(v=p,p=void 0),{action:c,method:s.toLowerCase(),encType:f,formData:p,body:v}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function x2(n,i){if(n===!1||n===null||typeof n>"u")throw new Error(i)}function dhe(n,i,s){let c=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return c.pathname==="/"?c.pathname=`_root.${s}`:i&&id(c.pathname,i)==="/"?c.pathname=`${i.replace(/\/$/,"")}/_root.${s}`:c.pathname=`${c.pathname.replace(/\/$/,"")}.${s}`,c}async function hhe(n,i){if(n.id in i)return i[n.id];try{let s=await import(n.module);return i[n.id]=s,s}catch(s){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(s),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function fhe(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function phe(n,i,s){let c=await Promise.all(n.map(async f=>{let p=i.routes[f.route.id];if(p){let v=await hhe(p,s);return v.links?v.links():[]}return[]}));return vhe(c.flat(1).filter(fhe).filter(f=>f.rel==="stylesheet"||f.rel==="preload").map(f=>f.rel==="stylesheet"?{...f,rel:"prefetch",as:"style"}:{...f,rel:"prefetch"}))}function dz(n,i,s,c,f,p){let v=(T,w)=>s[w]?T.route.id!==s[w].route.id:!0,b=(T,w)=>s[w].pathname!==T.pathname||s[w].route.path?.endsWith("*")&&s[w].params["*"]!==T.params["*"];return p==="assets"?i.filter((T,w)=>v(T,w)||b(T,w)):p==="data"?i.filter((T,w)=>{let C=c.routes[T.route.id];if(!C||!C.hasLoader)return!1;if(v(T,w)||b(T,w))return!0;if(T.route.shouldRevalidate){let I=T.route.shouldRevalidate({currentUrl:new URL(f.pathname+f.search+f.hash,window.origin),currentParams:s[0]?.params||{},nextUrl:new URL(n,window.origin),nextParams:T.params,defaultShouldRevalidate:!0});if(typeof I=="boolean")return I}return!0}):[]}function mhe(n,i,{includeHydrateFallback:s}={}){return ghe(n.map(c=>{let f=i.routes[c.route.id];if(!f)return[];let p=[f.module];return f.clientActionModule&&(p=p.concat(f.clientActionModule)),f.clientLoaderModule&&(p=p.concat(f.clientLoaderModule)),s&&f.hydrateFallbackModule&&(p=p.concat(f.hydrateFallbackModule)),f.imports&&(p=p.concat(f.imports)),p}).flat(1))}function ghe(n){return[...new Set(n)]}function _he(n){let i={},s=Object.keys(n).sort();for(let c of s)i[c]=n[c];return i}function vhe(n,i){let s=new Set;return new Set(i),n.reduce((c,f)=>{let p=JSON.stringify(_he(f));return s.has(p)||(s.add(p),c.push({key:p,link:f})),c},[])}function Mq(){let n=j.useContext(Fv);return x2(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function yhe(){let n=j.useContext(TI);return x2(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var D2=j.createContext(void 0);D2.displayName="FrameworkContext";function Uq(){let n=j.useContext(D2);return x2(n,"You must render this element inside a <HydratedRouter> element"),n}function Ehe(n,i){let s=j.useContext(D2),[c,f]=j.useState(!1),[p,v]=j.useState(!1),{onFocus:b,onBlur:T,onMouseEnter:w,onMouseLeave:C,onTouchStart:I}=i,D=j.useRef(null);j.useEffect(()=>{if(n==="render"&&v(!0),n==="viewport"){let W=$=>{$.forEach(te=>{v(te.isIntersecting)})},G=new IntersectionObserver(W,{threshold:.5});return D.current&&G.observe(D.current),()=>{G.disconnect()}}},[n]),j.useEffect(()=>{if(c){let W=setTimeout(()=>{v(!0)},100);return()=>{clearTimeout(W)}}},[c]);let L=()=>{f(!0)},F=()=>{f(!1),v(!1)};return s?n!=="intent"?[p,D,{}]:[p,D,{onFocus:LS(b,L),onBlur:LS(T,F),onMouseEnter:LS(w,L),onMouseLeave:LS(C,F),onTouchStart:LS(I,L)}]:[!1,D,{}]}function LS(n,i){return s=>{n&&n(s),s.defaultPrevented||i(s)}}function She({page:n,...i}){let{router:s}=Mq(),c=j.useMemo(()=>Aq(s.routes,n,s.basename),[s.routes,n,s.basename]);return c?j.createElement(The,{page:n,matches:c,...i}):null}function bhe(n){let{manifest:i,routeModules:s}=Uq(),[c,f]=j.useState([]);return j.useEffect(()=>{let p=!1;return phe(n,i,s).then(v=>{p||f(v)}),()=>{p=!0}},[n,i,s]),c}function The({page:n,matches:i,...s}){let c=Zl(),{manifest:f,routeModules:p}=Uq(),{basename:v}=Mq(),{loaderData:b,matches:T}=yhe(),w=j.useMemo(()=>dz(n,i,T,f,c,"data"),[n,i,T,f,c]),C=j.useMemo(()=>dz(n,i,T,f,c,"assets"),[n,i,T,f,c]),I=j.useMemo(()=>{if(n===c.pathname+c.search+c.hash)return[];let F=new Set,W=!1;if(i.forEach($=>{let te=f.routes[$.route.id];!te||!te.hasLoader||(!w.some(Z=>Z.route.id===$.route.id)&&$.route.id in b&&p[$.route.id]?.shouldRevalidate||te.hasClientLoader?W=!0:F.add($.route.id))}),F.size===0)return[];let G=dhe(n,v,"data");return W&&F.size>0&&G.searchParams.set("_routes",i.filter($=>F.has($.route.id)).map($=>$.route.id).join(",")),[G.pathname+G.search]},[v,b,c,f,w,i,n,p]),D=j.useMemo(()=>mhe(C,f),[C,f]),L=bhe(C);return j.createElement(j.Fragment,null,I.map(F=>j.createElement("link",{key:F,rel:"prefetch",as:"fetch",href:F,...s})),D.map(F=>j.createElement("link",{key:F,rel:"modulepreload",href:F,...s})),L.map(({key:F,link:W})=>j.createElement("link",{key:F,nonce:s.nonce,...W})))}function whe(...n){return i=>{n.forEach(s=>{typeof s=="function"?s(i):s!=null&&(s.current=i)})}}var jq=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{jq&&(window.__reactRouterVersion="7.9.5")}catch{}function Rhe({basename:n,children:i,window:s}){let c=j.useRef();c.current==null&&(c.current=hde({window:s,v5Compat:!0}));let f=c.current,[p,v]=j.useState({action:f.action,location:f.location}),b=j.useCallback(T=>{j.startTransition(()=>v(T))},[v]);return j.useLayoutEffect(()=>f.listen(b),[f,b]),j.createElement(the,{basename:n,children:i,location:p.location,navigationType:p.action,navigator:f})}var Vq=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,PO=j.forwardRef(function({onClick:i,discover:s="render",prefetch:c="none",relative:f,reloadDocument:p,replace:v,state:b,target:T,to:w,preventScrollReset:C,viewTransition:I,...D},L){let{basename:F}=j.useContext(tl),W=typeof w=="string"&&Vq.test(w),G,$=!1;if(typeof w=="string"&&W&&(G=w,jq))try{let Ae=new URL(window.location.href),ke=w.startsWith("//")?new URL(Ae.protocol+w):new URL(w),Ee=id(ke.pathname,F);ke.origin===Ae.origin&&Ee!=null?w=Ee+ke.search+ke.hash:$=!0}catch{Qc(!1,`<Link to="${w}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let te=Vde(w,{relative:f}),[Z,ce,se]=Ehe(c,D),de=Ihe(w,{replace:v,state:b,target:T,preventScrollReset:C,relative:f,viewTransition:I});function oe(Ae){i&&i(Ae),Ae.defaultPrevented||de(Ae)}let ge=j.createElement("a",{...D,...se,href:G||te,onClick:$||p?i:oe,ref:whe(L,ce),target:T,"data-discover":!W&&s==="render"?"true":void 0});return Z&&!W?j.createElement(j.Fragment,null,ge,j.createElement(She,{page:te})):ge});PO.displayName="Link";var Che=j.forwardRef(function({"aria-current":i="page",caseSensitive:s=!1,className:c="",end:f=!1,style:p,to:v,viewTransition:b,children:T,...w},C){let I=Tb(v,{relative:w.relative}),D=Zl(),L=j.useContext(TI),{navigator:F,basename:W}=j.useContext(tl),G=L!=null&&khe(I)&&b===!0,$=F.encodeLocation?F.encodeLocation(I).pathname:I.pathname,te=D.pathname,Z=L&&L.navigation&&L.navigation.location?L.navigation.location.pathname:null;s||(te=te.toLowerCase(),Z=Z?Z.toLowerCase():null,$=$.toLowerCase()),Z&&W&&(Z=id(Z,W)||Z);const ce=$!=="/"&&$.endsWith("/")?$.length-1:$.length;let se=te===$||!f&&te.startsWith($)&&te.charAt(ce)==="/",de=Z!=null&&(Z===$||!f&&Z.startsWith($)&&Z.charAt($.length)==="/"),oe={isActive:se,isPending:de,isTransitioning:G},ge=se?i:void 0,Ae;typeof c=="function"?Ae=c(oe):Ae=[c,se?"active":null,de?"pending":null,G?"transitioning":null].filter(Boolean).join(" ");let ke=typeof p=="function"?p(oe):p;return j.createElement(PO,{...w,"aria-current":ge,className:Ae,ref:C,style:ke,to:v,viewTransition:b},typeof T=="function"?T(oe):T)});Che.displayName="NavLink";var Ahe=j.forwardRef(({discover:n="render",fetcherKey:i,navigate:s,reloadDocument:c,replace:f,state:p,method:v=SO,action:b,onSubmit:T,relative:w,preventScrollReset:C,viewTransition:I,...D},L)=>{let F=Dhe(),W=Phe(b,{relative:w}),G=v.toLowerCase()==="get"?"get":"post",$=typeof b=="string"&&Vq.test(b),te=Z=>{if(T&&T(Z),Z.defaultPrevented)return;Z.preventDefault();let ce=Z.nativeEvent.submitter,se=ce?.getAttribute("formmethod")||v;F(ce||Z.currentTarget,{fetcherKey:i,method:se,navigate:s,replace:f,state:p,relative:w,preventScrollReset:C,viewTransition:I})};return j.createElement("form",{ref:L,method:G,action:W,onSubmit:c?T:te,...D,"data-discover":!$&&n==="render"?"true":void 0})});Ahe.displayName="Form";function Ohe(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Bq(n){let i=j.useContext(Fv);return Mr(i,Ohe(n)),i}function Ihe(n,{target:i,replace:s,state:c,preventScrollReset:f,relative:p,viewTransition:v}={}){let b=lf(),T=Zl(),w=Tb(n,{relative:p});return j.useCallback(C=>{if(ohe(C,i)){C.preventDefault();let I=s!==void 0?s:nb(T)===nb(w);b(n,{replace:I,state:c,preventScrollReset:f,relative:p,viewTransition:v})}},[T,b,w,s,c,i,n,f,p,v])}var Nhe=0,xhe=()=>`__${String(++Nhe)}__`;function Dhe(){let{router:n}=Bq("useSubmit"),{basename:i}=j.useContext(tl),s=$de();return j.useCallback(async(c,f={})=>{let{action:p,method:v,encType:b,formData:T,body:w}=uhe(c,i);if(f.navigate===!1){let C=f.fetcherKey||xhe();await n.fetch(C,s,f.action||p,{preventScrollReset:f.preventScrollReset,formData:T,body:w,formMethod:f.method||v,formEncType:f.encType||b,flushSync:f.flushSync})}else await n.navigate(f.action||p,{preventScrollReset:f.preventScrollReset,formData:T,body:w,formMethod:f.method||v,formEncType:f.encType||b,replace:f.replace,state:f.state,fromRouteId:s,flushSync:f.flushSync,viewTransition:f.viewTransition})},[n,i,s])}function Phe(n,{relative:i}={}){let{basename:s}=j.useContext(tl),c=j.useContext(nl);Mr(c,"useFormAction must be used inside a RouteContext");let[f]=c.matches.slice(-1),p={...Tb(n||".",{relative:i})},v=Zl();if(n==null){p.search=v.search;let b=new URLSearchParams(p.search),T=b.getAll("index");if(T.some(C=>C==="")){b.delete("index"),T.filter(I=>I).forEach(I=>b.append("index",I));let C=b.toString();p.search=C?`?${C}`:""}}return(!n||n===".")&&f.route.index&&(p.search=p.search?p.search.replace(/^\?/,"?index&"):"?index"),s!=="/"&&(p.pathname=p.pathname==="/"?s:td([s,p.pathname])),nb(p)}function khe(n,{relative:i}={}){let s=j.useContext(xq);Mr(s!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:c}=Bq("useViewTransitionState"),f=Tb(n,{relative:i});if(!s.isTransitioning)return!1;let p=id(s.currentLocation.pathname,c)||s.currentLocation.pathname,v=id(s.nextLocation.pathname,c)||s.nextLocation.pathname;return DO(f.pathname,v)!=null||DO(f.pathname,p)!=null}var Lhe=Cq();const Fq="http://localhost:4000/api";let xv=localStorage.getItem("token")||null;function nf(n){xv=n,n?localStorage.setItem("token",n):localStorage.removeItem("token")}function Mhe(){return xv}async function QA(n,i,s=null,c={}){const f=`${Fq}${i.startsWith("/")?i:`/${i}`}`,p={...c.headers||{}};c.noJson!==!0&&(p["Content-Type"]="application/json"),xv&&c.auth!==!1&&(p.Authorization=`Bearer ${xv}`);const v=await fetch(f,{method:n,headers:p,body:s&&c.noJson!==!0?JSON.stringify(s):s,credentials:"include"});(v.status===401||v.status===403)&&(nf(null),window.dispatchEvent(new Event("auth-logout")));const b=await v.text(),T=b?JSON.parse(b):null;if(!v.ok){const w=T&&(T.error||T.message)||v.statusText||"Request failed",C=new Error(w);throw C.status=v.status,C.body=T,C}return T}async function Uhe(n,i,s={}){const c=`${Fq}${n.startsWith("/")?n:`/${n}`}`,f={...s.headers||{}};xv&&s.auth!==!1&&(f.Authorization=`Bearer ${xv}`);const p=await fetch(c,{method:"POST",headers:f,body:i,credentials:"include"});(p.status===401||p.status===403)&&(nf(null),window.dispatchEvent(new Event("auth-logout")));const v=await p.text(),b=v?JSON.parse(v):null;if(!p.ok){const T=b&&(b.error||b.message)||p.statusText||"Request failed",w=new Error(T);throw w.status=p.status,w.body=b,w}return b}const sm={get:(n,i)=>QA("GET",n,null,i),post:(n,i,s)=>QA("POST",n,i,s),put:(n,i,s)=>QA("PUT",n,i,s),delete:(n,i,s)=>QA("DELETE",n,i,s),upload:Uhe},Gq=j.createContext(null);function jhe({children:n}){const[i,s]=j.useState(null),[c,f]=j.useState(!0),p=j.useCallback(async()=>{f(!0);try{if(!Mhe())return s(null),null;const I=await sm.get("/me");return s(I),I}catch(C){return console.warn("refreshUser failed:",C?.message||C),s(null),nf(null),null}finally{f(!1)}},[]);j.useEffect(()=>{p();const C=()=>{s(null),nf(null)};return window.addEventListener("auth-logout",C),()=>{window.removeEventListener("auth-logout",C)}},[p]);const w={user:i,loading:c,login:async(C,I,D={})=>{const L={email:C,password:I};D.remember&&(L.remember=!0);const F=await sm.post("/auth/login",L,{auth:!1});if(!F)throw new Error("Empty login response");return F.token&&nf(F.token),F.user?(s(F.user),f(!1),F.user):await p()},register:async(...C)=>{let I;if(C.length===1&&typeof C[0]=="object")I=C[0];else{const[F,W,G,$]=C;I={name:F,email:W,password:G,consent:$}}const D=await sm.post("/auth/register",I,{auth:!1});if(!D)throw new Error("Empty register response");return D.token&&nf(D.token),D.user?(s(D.user),f(!1),D.user):await p()},logout:async()=>{try{try{await sm.post("/auth/logout",null)}catch{}}finally{nf(null),s(null)}},refreshUser:p,setUser:s};return R.jsx(Gq.Provider,{value:w,children:n})}const ao=()=>j.useContext(Gq);function wb({size:n=12}){return R.jsx("div",{className:`w-${n} h-${n} border-4 border-purple-500 border-t-transparent rounded-full animate-spin mx-auto`})}let Vhe=(n=21)=>crypto.getRandomValues(new Uint8Array(n)).reduce((i,s)=>(s&=63,s<36?i+=s.toString(36):s<62?i+=(s-26).toString(36).toUpperCase():s>62?i+="-":i+="_",i),"");const Hq=j.createContext(null);function Bhe({children:n}){const[i,s]=j.useState([]),c=j.useCallback(p=>{const v=Vhe(),b={id:v,title:p.title||"Notification",description:p.description||"",tone:p.tone||"info",duration:typeof p.duration=="number"?p.duration:4500};return s(T=>[b,...T]),b.duration>0&&setTimeout(()=>{s(T=>T.filter(w=>w.id!==v))},b.duration),v},[]),f=j.useCallback(p=>{s(v=>v.filter(b=>b.id!==p))},[]);return R.jsx(Hq.Provider,{value:{toasts:i,addToast:c,removeToast:f},children:n})}function Wq(){const n=j.useContext(Hq);if(!n)throw new Error("useToasts must be used within ToastProvider");return n}var TO={exports:{}},Fhe=TO.exports,hz;function Ghe(){return hz||(hz=1,(function(n,i){(function(s,c){n.exports=c()})(Fhe,(function(){function s(e,t){return t.forEach((function(r){r&&typeof r!="string"&&!Array.isArray(r)&&Object.keys(r).forEach((function(a){if(a!=="default"&&!(a in e)){var o=Object.getOwnPropertyDescriptor(r,a);Object.defineProperty(e,a,o.get?o:{enumerable:!0,get:function(){return r[a]}})}}))})),Object.freeze(e)}var c=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof ck<"u"?ck:typeof self<"u"?self:{};function f(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var p=function(e){try{return!!e()}catch{return!0}},v=!p((function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")})),b=v,T=Function.prototype,w=T.call,C=b&&T.bind.bind(w,w),I=b?C:function(e){return function(){return w.apply(e,arguments)}},D=I({}.isPrototypeOf),L=function(e){return e&&e.Math===Math&&e},F=L(typeof globalThis=="object"&&globalThis)||L(typeof window=="object"&&window)||L(typeof self=="object"&&self)||L(typeof c=="object"&&c)||L(typeof c=="object"&&c)||(function(){return this})()||Function("return this")(),W=v,G=Function.prototype,$=G.apply,te=G.call,Z=typeof Reflect=="object"&&Reflect.apply||(W?te.bind($):function(){return te.apply($,arguments)}),ce=I,se=ce({}.toString),de=ce("".slice),oe=function(e){return de(se(e),8,-1)},ge=oe,Ae=I,ke=function(e){if(ge(e)==="Function")return Ae(e)},Ee=typeof document=="object"&&document.all,be=Ee===void 0&&Ee!==void 0?function(e){return typeof e=="function"||e===Ee}:function(e){return typeof e=="function"},Le={},et=!p((function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7})),rt=v,he=Function.prototype.call,_e=rt?he.bind(he):function(){return he.apply(he,arguments)},ze={},tt={}.propertyIsEnumerable,ut=Object.getOwnPropertyDescriptor,me=ut&&!tt.call({1:2},1);ze.f=me?function(e){var t=ut(this,e);return!!t&&t.enumerable}:tt;var Ve,it,dt=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},Ct=p,rn=oe,En=Object,ai=I("".split),qe=Ct((function(){return!En("z").propertyIsEnumerable(0)}))?function(e){return rn(e)==="String"?ai(e,""):En(e)}:En,qt=function(e){return e==null},gn=qt,st=TypeError,br=function(e){if(gn(e))throw new st("Can't call method on "+e);return e},An=qe,Ai=br,gr=function(e){return An(Ai(e))},Qo=be,Ur=function(e){return typeof e=="object"?e!==null:Qo(e)},ra={},mf=ra,gf=F,uN=be,Wb=function(e){return uN(e)?e:void 0},Yn=function(e,t){return arguments.length<2?Wb(mf[e])||Wb(gf[e]):mf[e]&&mf[e][t]||gf[e]&&gf[e][t]},zb=F.navigator,ry=zb&&zb.userAgent,co=ry?String(ry):"",_f=F,iy=co,ay=_f.process,Kb=_f.Deno,Yb=ay&&ay.versions||Kb&&Kb.version,Ed=Yb&&Yb.v8;Ed&&(it=(Ve=Ed.split("."))[0]>0&&Ve[0]<4?1:+(Ve[0]+Ve[1])),!it&&iy&&(!(Ve=iy.match(/Edge\/(\d+)/))||Ve[1]>=74)&&(Ve=iy.match(/Chrome\/(\d+)/))&&(it=+Ve[1]);var si=it,ec=si,Ma=p,dN=F.String,Sd=!!Object.getOwnPropertySymbols&&!Ma((function(){var e=Symbol("symbol detection");return!dN(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&ec&&ec<41})),qb=Sd&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Om=Yn,Im=be,Nm=D,tu=Object,rl=qb?function(e){return typeof e=="symbol"}:function(e){var t=Om("Symbol");return Im(t)&&Nm(t.prototype,tu(e))},vf=String,bd=function(e){try{return vf(e)}catch{return"Object"}},Xb=be,sy=bd,yf=TypeError,_a=function(e){if(Xb(e))return e;throw new yf(sy(e)+" is not a function")},Jb=_a,$b=qt,Ef=function(e,t){var r=e[t];return $b(r)?void 0:Jb(r)},xm=_e,Dm=be,oy=Ur,Zb=TypeError,tc={exports:{}},mi=F,va=Object.defineProperty,Td=F,cy=function(e,t){try{va(mi,e,{value:t,configurable:!0,writable:!0})}catch{mi[e]=t}return t},Qb="__core-js_shared__",eT=tc.exports=Td[Qb]||cy(Qb,{});(eT.versions||(eT.versions=[])).push({version:"3.42.0",mode:"pure",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"});var Pm=tc.exports,wd=Pm,il=function(e,t){return wd[e]||(wd[e]=t||{})},Rd=br,Cd=Object,ya=function(e){return Cd(Rd(e))},Ad=ya,gi=I({}.hasOwnProperty),jr=Object.hasOwn||function(e,t){return gi(Ad(e),t)},tT=I,nu=0,Od=Math.random(),hN=tT(1 .toString),km=function(e){return"Symbol("+(e===void 0?"":e)+")_"+hN(++nu+Od,36)},nT=il,rT=jr,Lm=km,Mm=Sd,nc=qb,Oi=F.Symbol,Um=nT("wks"),fN=nc?Oi.for||Oi:Oi&&Oi.withoutSetter||Lm,qn=function(e){return rT(Um,e)||(Um[e]=Mm&&rT(Oi,e)?Oi[e]:fN("Symbol."+e)),Um[e]},iT=_e,Sf=Ur,aT=rl,rs=Ef,ly=function(e,t){var r,a;if(Dm(r=e.toString)&&!oy(a=xm(r,e))||Dm(r=e.valueOf)&&!oy(a=xm(r,e)))return a;throw new Zb("Can't convert object to primitive value")},sT=TypeError,uy=qn("toPrimitive"),Id=function(e,t){if(!Sf(e)||aT(e))return e;var r,a=rs(e,uy);if(a){if(r=iT(a,e,t),!Sf(r)||aT(r))return r;throw new sT("Can't convert object to primitive value")}return ly(e)},oT=rl,jm=function(e){var t=Id(e,"string");return oT(t)?t:t+""},ru=Ur,dy=F.document,cT=ru(dy)&&ru(dy.createElement),Vm=function(e){return cT?dy.createElement(e):{}},hy=Vm,lT=!et&&!p((function(){return Object.defineProperty(hy("div"),"a",{get:function(){return 7}}).a!==7})),pN=et,Bm=_e,rc=ze,fy=dt,py=gr,Nd=jm,xd=jr,uT=lT,Fm=Object.getOwnPropertyDescriptor;Le.f=pN?Fm:function(e,t){if(e=py(e),t=Nd(t),uT)try{return Fm(e,t)}catch{}if(xd(e,t))return fy(!Bm(rc.f,e,t),e[t])};var dT=p,bf=be,ic=/#|\.prototype\./,iu=function(e,t){var r=al[Tf(e)];return r===Gm||r!==my&&(bf(t)?dT(t):!!t)},Tf=iu.normalize=function(e){return String(e).replace(ic,".").toLowerCase()},al=iu.data={},my=iu.NATIVE="N",Gm=iu.POLYFILL="P",gy=iu,Hm=_a,Wm=v,hT=ke(ke.bind),Vr=function(e,t){return Hm(e),t===void 0?e:Wm?hT(e,t):function(){return e.apply(t,arguments)}},_i={},wf=et&&p((function(){return Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype!==42})),Rf=Ur,mN=String,_y=TypeError,Ii=function(e){if(Rf(e))return e;throw new _y(mN(e)+" is not an object")},Cf=et,zm=lT,fT=wf,Km=Ii,pT=jm,gN=TypeError,Af=Object.defineProperty,_N=Object.getOwnPropertyDescriptor,vy="enumerable",yy="configurable",Ey="writable";_i.f=Cf?fT?function(e,t,r){if(Km(e),t=pT(t),Km(r),typeof e=="function"&&t==="prototype"&&"value"in r&&Ey in r&&!r[Ey]){var a=_N(e,t);a&&a[Ey]&&(e[t]=r.value,r={configurable:yy in r?r[yy]:a[yy],enumerable:vy in r?r[vy]:a[vy],writable:!1})}return Af(e,t,r)}:Af:function(e,t,r){if(Km(e),t=pT(t),Km(r),zm)try{return Af(e,t,r)}catch{}if("get"in r||"set"in r)throw new gN("Accessors not supported");return"value"in r&&(e[t]=r.value),e};var vN=_i,mT=dt,au=et?function(e,t,r){return vN.f(e,t,mT(1,r))}:function(e,t,r){return e[t]=r,e},Of=F,yN=Z,EN=ke,Sy=be,SN=Le.f,bN=gy,Dd=ra,gT=Vr,Pd=au,_T=jr,TN=function(e){var t=function(r,a,o){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(r);case 2:return new e(r,a)}return new e(r,a,o)}return yN(e,this,arguments)};return t.prototype=e.prototype,t},Jt=function(e,t){var r,a,o,u,h,m,g,y,E,A=e.target,O=e.global,N=e.stat,B=e.proto,U=O?Of:N?Of[A]:Of[A]&&Of[A].prototype,V=O?Dd:Dd[A]||Pd(Dd,A,{})[A],K=V.prototype;for(u in t)a=!(r=bN(O?u:A+(N?".":"#")+u,e.forced))&&U&&_T(U,u),m=V[u],a&&(g=e.dontCallGetSet?(E=SN(U,u))&&E.value:U[u]),h=a&&g?g:t[u],(r||B||typeof m!=typeof h)&&(y=e.bind&&a?gT(h,Of):e.wrap&&a?TN(h):B&&Sy(h)?EN(h):h,(e.sham||h&&h.sham||m&&m.sham)&&Pd(y,"sham",!0),Pd(V,u,y),B&&(_T(Dd,o=A+"Prototype")||Pd(Dd,o,{}),Pd(Dd[o],u,h),e.real&&K&&(r||!K[u])&&Pd(K,u,h)))},wN=Math.ceil,RN=Math.floor,CN=Math.trunc||function(e){var t=+e;return(t>0?RN:wN)(t)},AN=CN,by=function(e){var t=+e;return t!=t||t===0?0:AN(t)},Ty=by,If=Math.max,ON=Math.min,Ym=function(e,t){var r=Ty(e);return r<0?If(r+t,0):ON(r,t)},vT=by,yT=Math.min,wy=function(e){var t=vT(e);return t>0?yT(t,9007199254740991):0},ET=wy,Ua=function(e){return ET(e.length)},IN=gr,NN=Ym,xN=Ua,Ry=function(e){return function(t,r,a){var o=IN(t),u=xN(o);if(u===0)return!e&&-1;var h,m=NN(a,u);if(e&&r!=r){for(;u>m;)if((h=o[m++])!=h)return!0}else for(;u>m;m++)if((e||m in o)&&o[m]===r)return e||m||0;return!e&&-1}},qm={includes:Ry(!0),indexOf:Ry(!1)},Nf=qm.includes;Jt({target:"Array",proto:!0,forced:p((function(){return!Array(1).includes()}))},{includes:function(e){return Nf(this,e,arguments.length>1?arguments[1]:void 0)}});var xf=F,DN=ra,ia=function(e,t){var r=DN[e+"Prototype"],a=r&&r[t];if(a)return a;var o=xf[e],u=o&&o.prototype;return u&&u[t]},ST=ia("Array","includes"),bT=Ur,Cy=oe,Ay=qn("match"),Oy=function(e){var t;return bT(e)&&((t=e[Ay])!==void 0?!!t:Cy(e)==="RegExp")},TT=Oy,wT=TypeError,RT={};RT[qn("toStringTag")]="z";var Iy=String(RT)==="[object z]",PN=Iy,kN=be,Xm=oe,ja=qn("toStringTag"),Df=Object,CT=Xm((function(){return arguments})())==="Arguments",ac=PN?Xm:function(e){var t,r,a;return e===void 0?"Undefined":e===null?"Null":typeof(r=(function(o,u){try{return o[u]}catch{}})(t=Df(e),ja))=="string"?r:CT?Xm(t):(a=Xm(t))==="Object"&&kN(t.callee)?"Arguments":a},AT=ac,OT=String,Hi=function(e){if(AT(e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return OT(e)},LN=qn("match"),kd=Jt,Ny=function(e){if(TT(e))throw new wT("The method doesn't accept regular expressions");return e},Pf=br,Jm=Hi,IT=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[LN]=!1,"/./"[e](t)}catch{}}return!1},su=I("".indexOf);kd({target:"String",proto:!0,forced:!IT("includes")},{includes:function(e){return!!~su(Jm(Pf(this)),Jm(Ny(e)),arguments.length>1?arguments[1]:void 0)}});var Ld=ia("String","includes"),$m=D,NT=ST,ou=Ld,Zm=Array.prototype,Qm=String.prototype,xT=function(e){var t=e.includes;return e===Zm||$m(Zm,e)&&t===Zm.includes?NT:typeof e=="string"||e===Qm||$m(Qm,e)&&t===Qm.includes?ou:t},je=f(xT),MN=_a,UN=ya,DT=qe,PT=Ua,eg=TypeError,is="Reduce of empty array with no initial value",tg=function(e){return function(t,r,a,o){var u=UN(t),h=DT(u),m=PT(u);if(MN(r),m===0&&a<2)throw new eg(is);var g=e?m-1:0,y=e?-1:1;if(a<2)for(;;){if(g in h){o=h[g],g+=y;break}if(g+=y,e?g<0:m<=g)throw new eg(is)}for(;e?g>=0:m>g;g+=y)g in h&&(o=r(o,h[g],g,u));return o}},as={left:tg(!1)},Md=p,Ud=function(e,t){var r=[][e];return!!r&&Md((function(){r.call(null,t||function(){return 1},1)}))},sl=F,ng=co,xy=oe,lo=function(e){return ng.slice(0,e.length)===e},rg=lo("Bun/")?"BUN":lo("Cloudflare-Workers")?"CLOUDFLARE":lo("Deno/")?"DENO":lo("Node.js/")?"NODE":sl.Bun&&typeof Bun.version=="string"?"BUN":sl.Deno&&typeof Deno.version=="object"?"DENO":xy(sl.process)==="process"?"NODE":sl.window&&sl.document?"BROWSER":"REST",cu=rg==="NODE",jd=as.left;Jt({target:"Array",proto:!0,forced:!cu&&si>79&&si<83||!Ud("reduce")},{reduce:function(e){var t=arguments.length;return jd(this,e,t,t>1?arguments[1]:void 0)}});var jN=ia("Array","reduce"),Va=D,Dy=jN,Ds=Array.prototype,kT=function(e){var t=e.reduce;return e===Ds||Va(Ds,e)&&t===Ds.reduce?Dy:t},kf=kT,vi=f(kf),Py=oe,Vd=Array.isArray||function(e){return Py(e)==="Array"},ky=Jt,LT=Vd,ss=I([].reverse),lu=[1,2];ky({target:"Array",proto:!0,forced:String(lu)===String(lu.reverse())},{reverse:function(){return LT(this)&&(this.length=this.length),ss(this)}});var Bd=ia("Array","reverse"),ig=D,Lf=Bd,Ea=Array.prototype,os=function(e){var t=e.reverse;return e===Ea||ig(Ea,e)&&t===Ea.reverse?Lf:t},sc=os,Ps=f(sc),uo=km,ho=il("keys"),Mf=function(e){return ho[e]||(ho[e]=uo(e))},Ly=!p((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),My=jr,MT=be,Ni=ya,lr=Ly,Sn=Mf("IE_PROTO"),fo=Object,cs=fo.prototype,Uf=lr?fo.getPrototypeOf:function(e){var t=Ni(e);if(My(t,Sn))return t[Sn];var r=t.constructor;return MT(r)&&t instanceof r?r.prototype:t instanceof fo?cs:null},ol=I,UT=_a,jT=Ur,Fd=function(e){return jT(e)||e===null},uu=String,Uy=TypeError,jf=function(e,t,r){try{return ol(UT(Object.getOwnPropertyDescriptor(e,t)[r]))}catch{}},jy=Ur,du=br,oc=function(e){if(Fd(e))return e;throw new Uy("Can't set "+uu(e)+" as a prototype")},cl=Object.setPrototypeOf||("__proto__"in{}?(function(){var e,t=!1,r={};try{(e=jf(Object.prototype,"__proto__","set"))(r,[]),t=r instanceof Array}catch{}return function(a,o){return du(a),oc(o),jy(a)&&(t?e(a,o):a.__proto__=o),a}})():void 0),ls={},Gd={},Vf=jr,Hd=gr,ag=qm.indexOf,hu=Gd,yi=I([].push),Bf=function(e,t){var r,a=Hd(e),o=0,u=[];for(r in a)!Vf(hu,r)&&Vf(a,r)&&yi(u,r);for(;t.length>o;)Vf(a,r=t[o++])&&(~ag(u,r)||yi(u,r));return u},sg=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],VN=Bf,BN=sg.concat("length","prototype");ls.f=Object.getOwnPropertyNames||function(e){return VN(e,BN)};var Ff={};Ff.f=Object.getOwnPropertySymbols;var qr=Yn,Vy=ls,Gf=Ff,Hf=Ii,By=I([].concat),Wd=qr("Reflect","ownKeys")||function(e){var t=Vy.f(Hf(e)),r=Gf.f;return r?By(t,r(e)):t},fu=jr,FN=Wd,VT=Le,GN=_i,og={},pu=Bf,Fy=sg,mu=Object.keys||function(e){return pu(e,Fy)},BT=et,zd=wf,Gy=_i,cg=Ii,lg=gr,FT=mu;og.f=BT&&!zd?Object.defineProperties:function(e,t){cg(e);for(var r,a=lg(t),o=FT(t),u=o.length,h=0;u>h;)Gy.f(e,r=o[h++],a[r]);return e};var Wf,ll=Yn("document","documentElement"),gu=Ii,GT=og,Hy=sg,Kd=Gd,zf=ll,ug=Vm,_u="prototype",Yd="script",Wy=Mf("IE_PROTO"),cc=function(){},zy=function(e){return"<"+Yd+">"+e+"</"+Yd+">"},lc=function(e){e.write(zy("")),e.close();var t=e.parentWindow.Object;return e=null,t},qd=function(){try{Wf=new ActiveXObject("htmlfile")}catch{}var e,t,r;qd=typeof document<"u"?document.domain&&Wf?lc(Wf):(t=ug("iframe"),r="java"+Yd+":",t.style.display="none",zf.appendChild(t),t.src=String(r),(e=t.contentWindow.document).open(),e.write(zy("document.F=Object")),e.close(),e.F):lc(Wf);for(var a=Hy.length;a--;)delete qd[_u][Hy[a]];return qd()};Kd[Wy]=!0;var vu=Object.create||function(e,t){var r;return e!==null?(cc[_u]=gu(e),r=new cc,cc[_u]=null,r[Wy]=e):r=qd(),t===void 0?r:GT.f(r,t)},ul=Ur,dl=au,Xd=Error,Ky=I("".replace),Yy=String(new Xd("zxcasd").stack),Jd=/\n\s*at [^:]*:[^\n]*/,Kf=Jd.test(Yy),HT=dt,WT=!p((function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",HT(1,7)),e.stack!==7)})),$d=au,dg=function(e,t){if(Kf&&typeof e=="string"&&!Xd.prepareStackTrace)for(;t--;)e=Ky(e,Jd,"");return e},zT=WT,hg=Error.captureStackTrace,hl={},Ba=hl,us=qn("iterator"),fl=Array.prototype,fg=function(e){return e!==void 0&&(Ba.Array===e||fl[us]===e)},KT=ac,uc=Ef,Fa=qt,Br=hl,pg=qn("iterator"),ds=function(e){if(!Fa(e))return uc(e,pg)||uc(e,"@@iterator")||Br[KT(e)]},en=_e,$n=_a,Xr=Ii,mg=bd,Zd=ds,yu=TypeError,Qd=function(e,t){var r=arguments.length<2?Zd(e):t;if($n(r))return Xr(en(r,e));throw new yu(mg(e)+" is not iterable")},Yf=_e,Eu=Ii,HN=Ef,Tr=function(e,t,r){var a,o;Eu(e);try{if(!(a=HN(e,"return"))){if(t==="throw")throw r;return r}a=Yf(a,e)}catch(u){o=!0,a=u}if(t==="throw")throw r;if(o)throw a;return Eu(a),r},qy=Vr,Xy=_e,YT=Ii,qT=bd,WN=fg,Jy=Ua,gg=D,$y=Qd,aa=ds,xr=Tr,_g=TypeError,pl=function(e,t){this.stopped=e,this.result=t},qf=pl.prototype,Su=function(e,t,r){var a,o,u,h,m,g,y,E=r&&r.that,A=!(!r||!r.AS_ENTRIES),O=!(!r||!r.IS_RECORD),N=!(!r||!r.IS_ITERATOR),B=!(!r||!r.INTERRUPTED),U=qy(t,E),V=function(z){return a&&xr(a,"normal",z),new pl(!0,z)},K=function(z){return A?(YT(z),B?U(z[0],z[1],V):U(z[0],z[1])):B?U(z,V):U(z)};if(O)a=e.iterator;else if(N)a=e;else{if(!(o=aa(e)))throw new _g(qT(e)+" is not iterable");if(WN(o)){for(u=0,h=Jy(e);h>u;u++)if((m=K(e[u]))&&gg(qf,m))return m;return new pl(!1)}a=$y(e,o)}for(g=O?e.next:a.next;!(y=Xy(g,a)).done;){try{m=K(y.value)}catch(z){xr(a,"throw",z)}if(typeof m=="object"&&m&&gg(qf,m))return m}return new pl(!1)},dc=Hi,vg=Jt,Zy=D,Qy=Uf,Xf=cl,XT=function(e,t,r){for(var a=FN(t),o=GN.f,u=VT.f,h=0;h<a.length;h++){var m=a[h];fu(e,m)||r&&fu(r,m)||o(e,m,u(t,m))}},eE=vu,yg=au,Eg=dt,JT=function(e,t){ul(t)&&"cause"in t&&dl(e,"cause",t.cause)},tE=function(e,t,r,a){zT&&(hg?hg(e,t):$d(e,"stack",dg(r,a)))},$T=Su,zN=function(e,t){return e===void 0?arguments.length<2?"":t:dc(e)},ZT=qn("toStringTag"),Jf=Error,QT=[].push,ml=function(e,t){var r,a=Zy(Sg,this);Xf?r=Xf(new Jf,a?Qy(this):Sg):(r=a?this:eE(Sg),yg(r,ZT,"Error")),t!==void 0&&yg(r,"message",zN(t)),tE(r,ml,r.stack,1),arguments.length>2&&JT(r,arguments[2]);var o=[];return $T(e,QT,{that:o}),yg(r,"errors",o),r};Xf?Xf(ml,Jf):XT(ml,Jf,{name:!0});var Sg=ml.prototype=eE(Jf.prototype,{constructor:Eg(1,ml),message:Eg(1,""),name:Eg(1,"AggregateError")});vg({global:!0},{AggregateError:ml});var $f,eh,Zf,ew=be,tw=F.WeakMap,nw=ew(tw)&&/native code/.test(String(tw)),bu=F,rw=Ur,bg=au,th=jr,Tg=Pm,nE=Mf,KN=Gd,rE="Object already initialized",wg=bu.TypeError,iw=bu.WeakMap;if(nw||Tg.state){var ks=Tg.state||(Tg.state=new iw);ks.get=ks.get,ks.has=ks.has,ks.set=ks.set,$f=function(e,t){if(ks.has(e))throw new wg(rE);return t.facade=e,ks.set(e,t),t},eh=function(e){return ks.get(e)||{}},Zf=function(e){return ks.has(e)}}else{var Tu=nE("state");KN[Tu]=!0,$f=function(e,t){if(th(e,Tu))throw new wg(rE);return t.facade=e,bg(e,Tu,t),t},eh=function(e){return th(e,Tu)?e[Tu]:{}},Zf=function(e){return th(e,Tu)}}var hc,iE,aE,fc={set:$f,get:eh,has:Zf,enforce:function(e){return Zf(e)?eh(e):$f(e,{})},getterFor:function(e){return function(t){var r;if(!rw(t)||(r=eh(t)).type!==e)throw new wg("Incompatible receiver, "+e+" required");return r}}},Rg=et,aw=jr,sw=Function.prototype,sE=Rg&&Object.getOwnPropertyDescriptor,oE=aw(sw,"name"),cE={PROPER:oE&&(function(){}).name==="something",CONFIGURABLE:oE&&(!Rg||Rg&&sE(sw,"name").configurable)},lE=au,pc=function(e,t,r,a){return a&&a.enumerable?e[t]=r:lE(e,t,r),e},ow=p,YN=be,qN=Ur,cw=vu,nh=Uf,uE=pc,rh=qn("iterator"),dE=!1;[].keys&&("next"in(aE=[].keys())?(iE=nh(nh(aE)))!==Object.prototype&&(hc=iE):dE=!0);var lw=!qN(hc)||ow((function(){var e={};return hc[rh].call(e)!==e}));YN((hc=lw?{}:cw(hc))[rh])||uE(hc,rh,(function(){return this}));var ih={IteratorPrototype:hc,BUGGY_SAFARI_ITERATORS:dE},uw=ac,hE=Iy?{}.toString:function(){return"[object "+uw(this)+"]"},dw=Iy,fE=_i.f,pE=au,hw=jr,fw=hE,gl=qn("toStringTag"),po=function(e,t,r,a){var o=r?e:e&&e.prototype;o&&(hw(o,gl)||fE(o,gl,{configurable:!0,value:t}),a&&!dw&&pE(o,"toString",fw))},pw=ih.IteratorPrototype,mw=vu,Cg=dt,gw=po,mE=hl,_w=function(){return this},Ag=function(e,t,r,a){var o=t+" Iterator";return e.prototype=mw(pw,{next:Cg(+!a,r)}),gw(e,o,!1,!0),mE[o]=_w,e},XN=Jt,gE=_e,Jr=cE,xi=Ag,vw=Uf,yw=po,_E=pc,vE=hl,Qf=ih,Ew=Jr.PROPER,wu=Qf.BUGGY_SAFARI_ITERATORS,Og=qn("iterator"),Sw="keys",Ru="values",Ig="entries",bw=function(){return this},yE=function(e,t,r,a,o,u,h){xi(r,t,a);var m,g,y,E=function(K){if(K===o&&U)return U;if(!wu&&K&&K in N)return N[K];switch(K){case Sw:case Ru:case Ig:return function(){return new r(this,K)}}return function(){return new r(this)}},A=t+" Iterator",O=!1,N=e.prototype,B=N[Og]||N["@@iterator"]||o&&N[o],U=!wu&&B||E(o),V=t==="Array"&&N.entries||B;if(V&&(m=vw(V.call(new e)))!==Object.prototype&&m.next&&(yw(m,A,!0,!0),vE[A]=bw),Ew&&o===Ru&&B&&B.name!==Ru&&(O=!0,U=function(){return gE(B,this)}),o)if(g={values:E(Ru),keys:u?U:E(Sw),entries:E(Ig)},h)for(y in g)(wu||O||!(y in N))&&_E(N,y,g[y]);else XN({target:t,proto:!0,forced:wu||O},g);return h&&N[Og]!==U&&_E(N,Og,U,{}),vE[t]=U,g},ep=function(e,t){return{value:e,done:t}},EE=gr,Ng=hl,xg=fc;_i.f;var Tw=yE,ah=ep,tp="Array Iterator",SE=xg.set,ww=xg.getterFor(tp);Tw(Array,"Array",(function(e,t){SE(this,{type:tp,target:EE(e),index:0,kind:t})}),(function(){var e=ww(this),t=e.target,r=e.index++;if(!t||r>=t.length)return e.target=null,ah(void 0,!0);switch(e.kind){case"keys":return ah(r,!1);case"values":return ah(t[r],!1)}return ah([r,t[r]],!1)}),"values"),Ng.Arguments=Ng.Array;var bE=_i,np=function(e,t,r){return bE.f(e,t,r)},mc=Yn,TE=np,JN=et,wE=qn("species"),gc=D,RE=TypeError,Dg=function(e,t){if(gc(t,e))return e;throw new RE("Incorrect invocation")},Pg=be,Cu=Pm,ur=I(Function.toString);Pg(Cu.inspectSource)||(Cu.inspectSource=function(e){return ur(e)});var Rw=Cu.inspectSource,$N=I,Cw=p,sh=be,_l=ac,Aw=Rw,CE=function(){},oh=Yn("Reflect","construct"),hs=/^\s*(?:class|function)\b/,Ow=$N(hs.exec),AE=!hs.test(CE),ch=function(e){if(!sh(e))return!1;try{return oh(CE,[],e),!0}catch{return!1}},kg=function(e){if(!sh(e))return!1;switch(_l(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return AE||!!Ow(hs,Aw(e))}catch{return!0}};kg.sham=!0;var Au,_c,OE,Ls,wr=!oh||Cw((function(){var e;return ch(ch.call)||!ch(Object)||!ch((function(){e=!0}))||e}))?kg:ch,IE=wr,Iw=bd,Ei=TypeError,Nw=Ii,xw=function(e){if(IE(e))return e;throw new Ei(Iw(e)+" is not a constructor")},Dw=qt,_r=qn("species"),Wi=function(e,t){var r,a=Nw(e).constructor;return a===void 0||Dw(r=Nw(a)[_r])?t:xw(r)},zi=I([].slice),Pw=TypeError,vl=function(e,t){if(e<t)throw new Pw("Not enough arguments");return e},NE=/(?:ipad|iphone|ipod).*applewebkit/i.test(co),Ga=F,Lg=Z,Sa=Vr,fs=be,kw=jr,sa=p,xE=ll,vc=zi,yl=Vm,yc=vl,DE=NE,PE=cu,Ha=Ga.setImmediate,Mg=Ga.clearImmediate,lh=Ga.process,Ou=Ga.Dispatch,rp=Ga.Function,Iu=Ga.MessageChannel,Lw=Ga.String,Ug=0,Ec={},kE="onreadystatechange";sa((function(){Au=Ga.location}));var uh=function(e){if(kw(Ec,e)){var t=Ec[e];delete Ec[e],t()}},jg=function(e){return function(){uh(e)}},Mw=function(e){uh(e.data)},Uw=function(e){Ga.postMessage(Lw(e),Au.protocol+"//"+Au.host)};Ha&&Mg||(Ha=function(e){yc(arguments.length,1);var t=fs(e)?e:rp(e),r=vc(arguments,1);return Ec[++Ug]=function(){Lg(t,void 0,r)},_c(Ug),Ug},Mg=function(e){delete Ec[e]},PE?_c=function(e){lh.nextTick(jg(e))}:Ou&&Ou.now?_c=function(e){Ou.now(jg(e))}:Iu&&!DE?(Ls=(OE=new Iu).port2,OE.port1.onmessage=Mw,_c=Sa(Ls.postMessage,Ls)):Ga.addEventListener&&fs(Ga.postMessage)&&!Ga.importScripts&&Au&&Au.protocol!=="file:"&&!sa(Uw)?(_c=Uw,Ga.addEventListener("message",Mw,!1)):_c=kE in yl("script")?function(e){xE.appendChild(yl("script"))[kE]=function(){xE.removeChild(this),uh(e)}}:function(e){setTimeout(jg(e),0)});var On={set:Ha,clear:Mg},Zn=F,_n=et,bn=Object.getOwnPropertyDescriptor,Gn=function(e){if(!_n)return Zn[e];var t=bn(Zn,e);return t&&t.value},ba=function(){this.head=null,this.tail=null};ba.prototype={add:function(e){var t={item:e,next:null},r=this.tail;r?r.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var Wa,El,ip,Ms,Rr,Sc=ba,Nu=/ipad|iphone|ipod/i.test(co)&&typeof Pebble<"u",LE=/web0s(?!.*chrome)/i.test(co),Si=F,dh=Gn,hh=Vr,Ki=On.set,ME=Sc,Vg=NE,jw=Nu,Bg=LE,fh=cu,bc=Si.MutationObserver||Si.WebKitMutationObserver,$r=Si.document,Tc=Si.process,wc=Si.Promise,Us=dh("queueMicrotask");if(!Us){var ph=new ME,mh=function(){var e,t;for(fh&&(e=Tc.domain)&&e.exit();t=ph.get();)try{t()}catch(r){throw ph.head&&Wa(),r}e&&e.enter()};Vg||fh||Bg||!bc||!$r?!jw&&wc&&wc.resolve?((Ms=wc.resolve(void 0)).constructor=wc,Rr=hh(Ms.then,Ms),Wa=function(){Rr(mh)}):fh?Wa=function(){Tc.nextTick(mh)}:(Ki=hh(Ki,Si),Wa=function(){Ki(mh)}):(El=!0,ip=$r.createTextNode(""),new bc(mh).observe(ip,{characterData:!0}),Wa=function(){ip.data=El=!El}),Us=function(e){ph.head||Wa(),ph.add(e)}}var UE=Us,mo=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},Rc=F.Promise,za=F,gh=Rc,Ta=be,Vw=gy,Bw=Rw,ZN=qn,Cc=rg,_h=si,Fg=gh&&gh.prototype,vh=ZN("species"),jE=Ta(za.PromiseRejectionEvent),Fw=Vw("Promise",(function(){var e=Bw(gh),t=e!==String(gh);if(!t&&_h===66||!Fg.catch||!Fg.finally)return!0;if(!_h||_h<51||!/native code/.test(e)){var r=new gh((function(o){o(1)})),a=function(o){o((function(){}),(function(){}))};if((r.constructor={})[vh]=a,!(r.then((function(){}))instanceof a))return!0}return!(t||Cc!=="BROWSER"&&Cc!=="DENO"||jE)})),yh={CONSTRUCTOR:Fw,REJECTION_EVENT:jE},js={},ap=_a,VE=TypeError,QN=function(e){var t,r;this.promise=new e((function(a,o){if(t!==void 0||r!==void 0)throw new VE("Bad Promise constructor");t=a,r=o})),this.resolve=ap(t),this.reject=ap(r)};js.f=function(e){return new QN(e)};var BE,Gw,Hw=Jt,sp=cu,Ka=F,Sl=_e,Ww=pc,zw=po,Kw=function(e){var t=mc(e);JN&&t&&!t[wE]&&TE(t,wE,{configurable:!0,get:function(){return this}})},Yw=_a,Gg=be,qw=Ur,Hg=Dg,Xw=Wi,FE=On.set,jn=UE,GE=function(e,t){try{arguments.length===1?console.error(e):console.error(e,t)}catch{}},ex=mo,Jw=Sc,$w=fc,HE=Rc,Zw=yh,op=js,Ac="Promise",Wg=Zw.CONSTRUCTOR,zg=Zw.REJECTION_EVENT,cp=$w.getterFor(Ac),bl=$w.set,go=HE&&HE.prototype,Oc=HE,WE=go,zE=Ka.TypeError,Kg=Ka.document,Yg=Ka.process,qg=op.f,tx=qg,KE=!!(Kg&&Kg.createEvent&&Ka.dispatchEvent),YE="unhandledrejection",qE=function(e){var t;return!(!qw(e)||!Gg(t=e.then))&&t},Qw=function(e,t){var r,a,o,u=t.value,h=t.state===1,m=h?e.ok:e.fail,g=e.resolve,y=e.reject,E=e.domain;try{m?(h||(t.rejection===2&&lp(t),t.rejection=1),m===!0?r=u:(E&&E.enter(),r=m(u),E&&(E.exit(),o=!0)),r===e.promise?y(new zE("Promise-chain cycle")):(a=qE(r))?Sl(a,r,g,y):g(r)):y(u)}catch(A){E&&!o&&E.exit(),y(A)}},Xg=function(e,t){e.notified||(e.notified=!0,jn((function(){for(var r,a=e.reactions;r=a.get();)Qw(r,e);e.notified=!1,t&&!e.rejection&&nx(e)})))},Jg=function(e,t,r){var a,o;KE?((a=Kg.createEvent("Event")).promise=t,a.reason=r,a.initEvent(e,!1,!0),Ka.dispatchEvent(a)):a={promise:t,reason:r},!zg&&(o=Ka["on"+e])?o(a):e===YE&&GE("Unhandled promise rejection",r)},nx=function(e){Sl(FE,Ka,(function(){var t,r=e.facade,a=e.value;if(eR(e)&&(t=ex((function(){sp?Yg.emit("unhandledRejection",a,r):Jg(YE,r,a)})),e.rejection=sp||eR(e)?2:1,t.error))throw t.value}))},eR=function(e){return e.rejection!==1&&!e.parent},lp=function(e){Sl(FE,Ka,(function(){var t=e.facade;sp?Yg.emit("rejectionHandled",t):Jg("rejectionhandled",t,e.value)}))},Eh=function(e,t,r){return function(a){e(t,a,r)}},xu=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,Xg(e,!0))},dn=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw new zE("Promise can't be resolved itself");var a=qE(t);a?jn((function(){var o={done:!1};try{Sl(a,t,Eh(dn,o,e),Eh(xu,o,e))}catch(u){xu(o,u,e)}})):(e.value=t,e.state=1,Xg(e,!1))}catch(o){xu({done:!1},o,e)}}};Wg&&(WE=(Oc=function(e){Hg(this,WE),Yw(e),Sl(BE,this);var t=cp(this);try{e(Eh(dn,t),Eh(xu,t))}catch(r){xu(t,r)}}).prototype,(BE=function(e){bl(this,{type:Ac,done:!1,notified:!1,parent:!1,reactions:new Jw,rejection:!1,state:0,value:null})}).prototype=Ww(WE,"then",(function(e,t){var r=cp(this),a=qg(Xw(this,Oc));return r.parent=!0,a.ok=!Gg(e)||e,a.fail=Gg(t)&&t,a.domain=sp?Yg.domain:void 0,r.state===0?r.reactions.add(a):jn((function(){Qw(a,r)})),a.promise})),Gw=function(){var e=new BE,t=cp(e);this.promise=e,this.resolve=Eh(dn,t),this.reject=Eh(xu,t)},op.f=qg=function(e){return e===Oc||e===void 0?new Gw(e):tx(e)}),Hw({global:!0,wrap:!0,forced:Wg},{Promise:Oc}),zw(Oc,Ac,!1,!0),Kw(Ac);var $g=qn("iterator"),up=!1;try{var XE=0,JE={next:function(){return{done:!!XE++}},return:function(){up=!0}};JE[$g]=function(){return this},Array.from(JE,(function(){throw 2}))}catch{}var $E=Rc,dp=function(e,t){try{if(!t&&!up)return!1}catch{return!1}var r=!1;try{var a={};a[$g]=function(){return{next:function(){return{done:r=!0}}}},e(a)}catch{}return r},Du=yh.CONSTRUCTOR||!dp((function(e){$E.all(e).then(void 0,(function(){}))})),rx=_e,tR=_a,ix=js,ax=mo,nR=Su;Jt({target:"Promise",stat:!0,forced:Du},{all:function(e){var t=this,r=ix.f(t),a=r.resolve,o=r.reject,u=ax((function(){var h=tR(t.resolve),m=[],g=0,y=1;nR(e,(function(E){var A=g++,O=!1;y++,rx(h,t,E).then((function(N){O||(O=!0,m[A]=N,--y||a(m))}),o)})),--y||a(m)}));return u.error&&o(u.value),r.promise}});var rR=Jt,Qn=yh.CONSTRUCTOR;Rc&&Rc.prototype,rR({target:"Promise",proto:!0,forced:Qn,real:!0},{catch:function(e){return this.then(void 0,e)}});var ZE=_e,Di=_a,sx=js,iR=mo,ox=Su;Jt({target:"Promise",stat:!0,forced:Du},{race:function(e){var t=this,r=sx.f(t),a=r.reject,o=iR((function(){var u=Di(t.resolve);ox(e,(function(h){ZE(u,t,h).then(r.resolve,a)}))}));return o.error&&a(o.value),r.promise}});var QE=js;Jt({target:"Promise",stat:!0,forced:yh.CONSTRUCTOR},{reject:function(e){var t=QE.f(this);return(0,t.reject)(e),t.promise}});var e0=Ii,Zg=Ur,aR=js,t0=function(e,t){if(e0(e),Zg(t)&&t.constructor===e)return t;var r=aR.f(e);return(0,r.resolve)(t),r.promise},n0=Jt,r0=Rc,cx=yh.CONSTRUCTOR,sR=t0,lx=Yn("Promise"),oR=!cx;n0({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return sR(oR&&this===lx?r0:this,e)}});var ux=_e,dx=_a,Tl=js,cR=mo,lR=Su;Jt({target:"Promise",stat:!0,forced:Du},{allSettled:function(e){var t=this,r=Tl.f(t),a=r.resolve,o=r.reject,u=cR((function(){var h=dx(t.resolve),m=[],g=0,y=1;lR(e,(function(E){var A=g++,O=!1;y++,ux(h,t,E).then((function(N){O||(O=!0,m[A]={status:"fulfilled",value:N},--y||a(m))}),(function(N){O||(O=!0,m[A]={status:"rejected",reason:N},--y||a(m))}))})),--y||a(m)}));return u.error&&o(u.value),r.promise}});var i0=_e,hx=_a,fx=Yn,uR=js,a0=mo,s0=Su,dR="No one promise resolved";Jt({target:"Promise",stat:!0,forced:Du},{any:function(e){var t=this,r=fx("AggregateError"),a=uR.f(t),o=a.resolve,u=a.reject,h=a0((function(){var m=hx(t.resolve),g=[],y=0,E=1,A=!1;s0(e,(function(O){var N=y++,B=!1;E++,i0(m,t,O).then((function(U){B||A||(A=!0,o(U))}),(function(U){B||A||(B=!0,g[N]=U,--E||u(new r(g,dR)))}))})),--E||u(new r(g,dR))}));return h.error&&u(h.value),a.promise}});var ps=Jt,o0=Z,hR=zi,fR=js,pR=_a,Sh=mo,wa=F.Promise,c0=!1;ps({target:"Promise",stat:!0,forced:!wa||!wa.try||Sh((function(){wa.try((function(e){c0=e===8}),8)})).error||!c0},{try:function(e){var t=arguments.length>1?hR(arguments,1):[],r=fR.f(this),a=Sh((function(){return o0(pR(e),void 0,t)}));return(a.error?r.reject:r.resolve)(a.value),r.promise}});var Qg=js;Jt({target:"Promise",stat:!0},{withResolvers:function(){var e=Qg.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var Ic=Jt,l0=Rc,px=p,bh=Yn,mR=be,mx=Wi,gR=t0,gx=l0&&l0.prototype;Ic({target:"Promise",proto:!0,real:!0,forced:!!l0&&px((function(){gx.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=mx(this,bh("Promise")),r=mR(e);return this.then(r?function(a){return gR(t,e()).then((function(){return a}))}:e,r?function(a){return gR(t,e()).then((function(){throw a}))}:e)}});var u0=I,_x=by,vx=Hi,yx=br,_R=u0("".charAt),Pu=u0("".charCodeAt),hp=u0("".slice),d0=function(e){return function(t,r){var a,o,u=vx(yx(t)),h=_x(r),m=u.length;return h<0||h>=m?e?"":void 0:(a=Pu(u,h))<55296||a>56319||h+1===m||(o=Pu(u,h+1))<56320||o>57343?e?_R(u,h):a:e?hp(u,h,h+2):o-56320+(a-55296<<10)+65536}},h0={codeAt:d0(!1),charAt:d0(!0)},Th=h0.charAt,fp=Hi,f0=fc,e_=yE,t_=ep,n_="String Iterator",r_=f0.set,vR=f0.getterFor(n_);e_(String,"String",(function(e){r_(this,{type:n_,string:fp(e),index:0})}),(function(){var e,t=vR(this),r=t.string,a=t.index;return a>=r.length?t_(void 0,!0):(e=Th(r,a),t.index+=e.length,t_(e,!1))}));var yR=ra.Promise,Ex={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},ER=F,Sx=po,i_=hl;for(var p0 in Ex)Sx(ER[p0],p0),i_[p0]=i_.Array;var pp=yR,Fe=f(pp),a_=ia("Array","values"),bx=ac,mp=jr,Tx=D,SR=a_,s_=Array.prototype,bR={DOMTokenList:!0,NodeList:!0},TR=function(e){var t=e.values;return e===s_||Tx(s_,e)&&t===s_.values||mp(bR,bx(e))?SR:t},Pi=f(TR),m0=bd,wR=TypeError,gp=zi,wx=Math.floor,g0=function(e,t){var r=e.length;if(r<8)for(var a,o,u=1;u<r;){for(o=u,a=e[u];o&&t(e[o-1],a)>0;)e[o]=e[--o];o!==u++&&(e[o]=a)}else for(var h=wx(r/2),m=g0(gp(e,0,h),t),g=g0(gp(e,h),t),y=m.length,E=g.length,A=0,O=0;A<y||O<E;)e[A+O]=A<y&&O<E?t(m[A],g[O])<=0?m[A++]:g[O++]:A<y?m[A++]:g[O++];return e},o_=g0,c_=co.match(/firefox\/(\d+)/i),l_=!!c_&&+c_[1],_0=/MSIE|Trident/.test(co),v0=co.match(/AppleWebKit\/(\d+)\./),y0=!!v0&&+v0[1],wl=Jt,Nc=I,Rl=_a,_p=ya,wh=Ua,Cl=function(e,t){if(!delete e[t])throw new wR("Cannot delete property "+m0(t)+" of "+m0(e))},RR=Hi,u_=p,vp=o_,Rx=Ud,E0=l_,d_=_0,S0=si,CR=y0,Vs=[],yp=Nc(Vs.sort),AR=Nc(Vs.push),Rh=u_((function(){Vs.sort(void 0)})),OR=u_((function(){Vs.sort(null)})),b0=Rx("sort"),Ep=!u_((function(){if(S0)return S0<70;if(!(E0&&E0>3)){if(d_)return!0;if(CR)return CR<603;var e,t,r,a,o="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(a=0;a<47;a++)Vs.push({k:t+a,v:r})}for(Vs.sort((function(u,h){return h.v-u.v})),a=0;a<Vs.length;a++)t=Vs[a].k.charAt(0),o.charAt(o.length-1)!==t&&(o+=t);return o!=="DGBEFHACIJK"}}));wl({target:"Array",proto:!0,forced:Rh||!OR||!b0||!Ep},{sort:function(e){e!==void 0&&Rl(e);var t=_p(this);if(Ep)return e===void 0?yp(t):yp(t,e);var r,a,o=[],u=wh(t);for(a=0;a<u;a++)a in t&&AR(o,t[a]);for(vp(o,(function(h){return function(m,g){return g===void 0?-1:m===void 0?1:h!==void 0?+h(m,g)||0:RR(m)>RR(g)?1:-1}})(e)),r=wh(o),a=0;a<r;)t[a]=o[a++];for(;a<u;)Cl(t,a++);return t}});var IR=ia("Array","sort"),Cx=D,h_=IR,l=Array.prototype,d=function(e){var t=e.sort;return e===l||Cx(l,e)&&t===l.sort?h_:t},_=f(d),S=Jt,x=I,P=Ym,Y=RangeError,ne=String.fromCharCode,pe=String.fromCodePoint,Pe=x([].join);S({target:"String",stat:!0,forced:!!pe&&pe.length!==1},{fromCodePoint:function(e){for(var t,r=[],a=arguments.length,o=0;a>o;){if(t=+arguments[o++],P(t,1114111)!==t)throw new Y(t+" is not a valid code point");r[o]=t<65536?ne(t):ne(55296+((t-=65536)>>10),t%1024+56320)}return Pe(r,"")}});var We=p,Ze=qn("iterator"),Me=!We((function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,r=new URLSearchParams("a=1&a=2&b=3"),a="";return e.pathname="c%20d",t.forEach((function(o,u){t.delete("b"),a+=u+o})),r.delete("a",2),r.delete("b",void 0),!e.toJSON||!r.has("a",1)||r.has("a",2)||!r.has("a",void 0)||r.has("b")||!t.size&&!0||!t.sort||e.href!=="https://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[Ze]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://").host!=="xn--e1aybc"||new URL("https://a#").hash!=="#%D0%B1"||a!=="a1c3"||new URL("https://x",void 0).host!=="x"})),Be=pc,Et=Jt,Pt=F,Hn=Gn,Ce=Yn,Se=_e,Oe=I,Ke=et,Nt=Me,xn=pc,wt=np,an=function(e,t,r){for(var a in t)r&&r.unsafe&&e[a]?e[a]=t[a]:Be(e,a,t[a],r);return e},Tn=po,Ln=Ag,_o=fc,NR=Dg,Ax=be,Tte=jr,wte=Vr,Rte=ac,Cte=Ii,jj=Ur,Ya=Hi,Ate=vu,Vj=dt,Bj=Qd,Ote=ds,xR=ep,f_=vl,Ite=o_,Nte=qn("iterator"),p_="URLSearchParams",Fj=p_+"Iterator",Gj=_o.set,vo=_o.getterFor(p_),xte=_o.getterFor(Fj),Hj=Hn("fetch"),DR=Hn("Request"),T0=Hn("Headers"),Ox=DR&&DR.prototype,Wj=T0&&T0.prototype,Dte=Pt.TypeError,Pte=Pt.encodeURIComponent,kte=String.fromCharCode,Lte=Ce("String","fromCodePoint"),Mte=parseInt,PR=Oe("".charAt),zj=Oe([].join),Ch=Oe([].push),Kj=Oe("".replace),Ute=Oe([].shift),Yj=Oe([].splice),qj=Oe("".split),Xj=Oe("".slice),jte=Oe(/./.exec),Vte=/\+/g,Bte=/^[0-9a-f]+$/i,Jj=function(e,t){var r=Xj(e,t,t+2);return jte(Bte,r)?Mte(r,16):NaN},Fte=function(e){for(var t=0,r=128;r>0&&(e&r)!=0;r>>=1)t++;return t},Gte=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},$j=function(e){for(var t=(e=Kj(e,Vte," ")).length,r="",a=0;a<t;){var o=PR(e,a);if(o==="%"){if(PR(e,a+1)==="%"||a+3>t){r+="%",a++;continue}var u=Jj(e,a+1);if(u!=u){r+=o,a++;continue}a+=2;var h=Fte(u);if(h===0)o=kte(u);else{if(h===1||h>4){r+="",a++;continue}for(var m=[u],g=1;g<h&&!(++a+3>t||PR(e,a)!=="%");){var y=Jj(e,a+1);if(y!=y){a+=3;break}if(y>191||y<128)break;Ch(m,y),a+=2,g++}if(m.length!==h){r+="";continue}var E=Gte(m);E===null?r+="":o=Lte(E)}}r+=o,a++}return r},Hte=/[!'()~]|%20/g,Wte={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},zte=function(e){return Wte[e]},Zj=function(e){return Kj(Pte(e),Hte,zte)},Ix=Ln((function(e,t){Gj(this,{type:Fj,target:vo(e).entries,index:0,kind:t})}),p_,(function(){var e=xte(this),t=e.target,r=e.index++;if(!t||r>=t.length)return e.target=null,xR(void 0,!0);var a=t[r];switch(e.kind){case"keys":return xR(a.key,!1);case"values":return xR(a.value,!1)}return xR([a.key,a.value],!1)}),!0),Qj=function(e){this.entries=[],this.url=null,e!==void 0&&(jj(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?PR(e,0)==="?"?Xj(e,1):e:Ya(e)))};Qj.prototype={type:p_,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,r,a,o,u,h,m,g=this.entries,y=Ote(e);if(y)for(r=(t=Bj(e,y)).next;!(a=Se(r,t)).done;){if(u=(o=Bj(Cte(a.value))).next,(h=Se(u,o)).done||(m=Se(u,o)).done||!Se(u,o).done)throw new Dte("Expected sequence with length 2");Ch(g,{key:Ya(h.value),value:Ya(m.value)})}else for(var E in e)Tte(e,E)&&Ch(g,{key:E,value:Ya(e[E])})},parseQuery:function(e){if(e)for(var t,r,a=this.entries,o=qj(e,"&"),u=0;u<o.length;)(t=o[u++]).length&&(r=qj(t,"="),Ch(a,{key:$j(Ute(r)),value:$j(zj(r,"="))}))},serialize:function(){for(var e,t=this.entries,r=[],a=0;a<t.length;)e=t[a++],Ch(r,Zj(e.key)+"="+Zj(e.value));return zj(r,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var kR=function(){NR(this,m_);var e=Gj(this,new Qj(arguments.length>0?arguments[0]:void 0));Ke||(this.size=e.entries.length)},m_=kR.prototype;if(an(m_,{append:function(e,t){var r=vo(this);f_(arguments.length,2),Ch(r.entries,{key:Ya(e),value:Ya(t)}),Ke||this.length++,r.updateURL()},delete:function(e){for(var t=vo(this),r=f_(arguments.length,1),a=t.entries,o=Ya(e),u=r<2?void 0:arguments[1],h=u===void 0?u:Ya(u),m=0;m<a.length;){var g=a[m];if(g.key!==o||h!==void 0&&g.value!==h)m++;else if(Yj(a,m,1),h!==void 0)break}Ke||(this.size=a.length),t.updateURL()},get:function(e){var t=vo(this).entries;f_(arguments.length,1);for(var r=Ya(e),a=0;a<t.length;a++)if(t[a].key===r)return t[a].value;return null},getAll:function(e){var t=vo(this).entries;f_(arguments.length,1);for(var r=Ya(e),a=[],o=0;o<t.length;o++)t[o].key===r&&Ch(a,t[o].value);return a},has:function(e){for(var t=vo(this).entries,r=f_(arguments.length,1),a=Ya(e),o=r<2?void 0:arguments[1],u=o===void 0?o:Ya(o),h=0;h<t.length;){var m=t[h++];if(m.key===a&&(u===void 0||m.value===u))return!0}return!1},set:function(e,t){var r=vo(this);f_(arguments.length,1);for(var a,o=r.entries,u=!1,h=Ya(e),m=Ya(t),g=0;g<o.length;g++)(a=o[g]).key===h&&(u?Yj(o,g--,1):(u=!0,a.value=m));u||Ch(o,{key:h,value:m}),Ke||(this.size=o.length),r.updateURL()},sort:function(){var e=vo(this);Ite(e.entries,(function(t,r){return t.key>r.key?1:-1})),e.updateURL()},forEach:function(e){for(var t,r=vo(this).entries,a=wte(e,arguments.length>1?arguments[1]:void 0),o=0;o<r.length;)a((t=r[o++]).value,t.key,this)},keys:function(){return new Ix(this,"keys")},values:function(){return new Ix(this,"values")},entries:function(){return new Ix(this,"entries")}},{enumerable:!0}),xn(m_,Nte,m_.entries,{}),xn(m_,"toString",(function(){return vo(this).serialize()}),{enumerable:!0}),Ke&&wt(m_,"size",{get:function(){return vo(this).entries.length},configurable:!0,enumerable:!0}),Tn(kR,p_),Et({global:!0,forced:!Nt},{URLSearchParams:kR}),!Nt&&Ax(T0)){var Kte=Oe(Wj.has),Yte=Oe(Wj.set),eV=function(e){if(jj(e)){var t,r=e.body;if(Rte(r)===p_)return t=e.headers?new T0(e.headers):new T0,Kte(t,"content-type")||Yte(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),Ate(e,{body:Vj(0,Ya(r)),headers:Vj(0,t)})}return e};if(Ax(Hj)&&Et({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return Hj(e,arguments.length>1?eV(arguments[1]):{})}}),Ax(DR)){var Nx=function(e){return NR(this,Ox),new DR(e,arguments.length>1?eV(arguments[1]):{})};Ox.constructor=Nx,Nx.prototype=Ox,Et({global:!0,dontCallGetSet:!0,forced:!0},{Request:Nx})}}var yo,qte={URLSearchParams:kR,getState:vo},Xte=ra.URLSearchParams,tV=et,Jte=I,$te=_e,Zte=p,xx=mu,Qte=Ff,ene=ze,tne=ya,nne=qe,g_=Object.assign,nV=Object.defineProperty,rne=Jte([].concat),ine=!g_||Zte((function(){if(tV&&g_({b:1},g_(nV({},"a",{enumerable:!0,get:function(){nV(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},r=Symbol("assign detection"),a="abcdefghijklmnopqrst";return e[r]=7,a.split("").forEach((function(o){t[o]=o})),g_({},e)[r]!==7||xx(g_({},t)).join("")!==a}))?function(e,t){for(var r=tne(e),a=arguments.length,o=1,u=Qte.f,h=ene.f;a>o;)for(var m,g=nne(arguments[o++]),y=u?rne(xx(g),u(g)):xx(g),E=y.length,A=0;E>A;)m=y[A++],tV&&!$te(h,g,m)||(r[m]=g[m]);return r}:g_,ane=Ii,sne=Tr,one=et,cne=_i,lne=dt,Dx=function(e,t,r){one?cne.f(e,t,lne(0,r)):e[t]=r},une=Vr,dne=_e,hne=ya,fne=function(e,t,r,a){try{return a?t(ane(r)[0],r[1]):t(r)}catch(o){sne(e,"throw",o)}},pne=fg,mne=wr,gne=Ua,rV=Dx,_ne=Qd,vne=ds,iV=Array,Sp=I,Px=2147483647,yne=/[^\0-\u007E]/,aV=/[.\u3002\uFF0E\uFF61]/g,sV="Overflow: input needs wider integers to process",oV=RangeError,Ene=Sp(aV.exec),__=Math.floor,kx=String.fromCharCode,cV=Sp("".charCodeAt),lV=Sp([].join),Ah=Sp([].push),Sne=Sp("".replace),bne=Sp("".split),Tne=Sp("".toLowerCase),uV=function(e){return e+22+75*(e<26)},wne=function(e,t,r){var a=0;for(e=r?__(e/700):e>>1,e+=__(e/t);e>455;)e=__(e/35),a+=36;return __(a+36*e/(e+38))},Rne=function(e){var t=[];e=(function(K){for(var z=[],J=0,ae=K.length;J<ae;){var ie=cV(K,J++);if(ie>=55296&&ie<=56319&&J<ae){var ee=cV(K,J++);(64512&ee)==56320?Ah(z,((1023&ie)<<10)+(1023&ee)+65536):(Ah(z,ie),J--)}else Ah(z,ie)}return z})(e);var r,a,o=e.length,u=128,h=0,m=72;for(r=0;r<e.length;r++)(a=e[r])<128&&Ah(t,kx(a));var g=t.length,y=g;for(g&&Ah(t,"-");y<o;){var E=Px;for(r=0;r<e.length;r++)(a=e[r])>=u&&a<E&&(E=a);var A=y+1;if(E-u>__((Px-h)/A))throw new oV(sV);for(h+=(E-u)*A,u=E,r=0;r<e.length;r++){if((a=e[r])<u&&++h>Px)throw new oV(sV);if(a===u){for(var O=h,N=36;;){var B=N<=m?1:N>=m+26?26:N-m;if(O<B)break;var U=O-B,V=36-B;Ah(t,kx(uV(B+U%V))),O=__(U/V),N+=36}Ah(t,kx(uV(O))),m=wne(h,A,y===g),h=0,y++}}h++,u++}return lV(t,"")},Cne=Jt,Lx=et,Ane=Me,Mx=F,dV=Vr,Eo=I,LR=pc,So=np,One=Dg,Ux=jr,jx=ine,v_=function(e){var t=hne(e),r=mne(this),a=arguments.length,o=a>1?arguments[1]:void 0,u=o!==void 0;u&&(o=une(o,a>2?arguments[2]:void 0));var h,m,g,y,E,A,O=vne(t),N=0;if(!O||this===iV&&pne(O))for(h=gne(t),m=r?new this(h):iV(h);h>N;N++)A=u?o(t[N],N):t[N],rV(m,N,A);else for(m=r?new this:[],E=(y=_ne(t,O)).next;!(g=dne(E,y)).done;N++)A=u?fne(y,o,[g.value,N],!0):g.value,rV(m,N,A);return m.length=N,m},xc=zi,Ine=h0.codeAt,Nne=function(e){var t,r,a=[],o=bne(Sne(Tne(e),aV,"."),".");for(t=0;t<o.length;t++)r=o[t],Ah(a,Ene(yne,r)?"xn--"+Rne(r):r);return lV(a,".")},ku=Hi,xne=po,Dne=vl,hV=qte,fV=fc,Pne=fV.set,MR=fV.getterFor("URL"),kne=hV.URLSearchParams,Lne=hV.getState,w0=Mx.URL,Vx=Mx.TypeError,UR=Mx.parseInt,Mne=Math.floor,pV=Math.pow,bo=Eo("".charAt),Dc=Eo(/./.exec),R0=Eo([].join),Une=Eo(1 .toString),jne=Eo([].pop),y_=Eo([].push),Bx=Eo("".replace),Vne=Eo([].shift),Bne=Eo("".split),C0=Eo("".slice),jR=Eo("".toLowerCase),Fne=Eo([].unshift),Fx="Invalid scheme",bp="Invalid host",mV="Invalid port",gV=/[a-z]/i,Gne=/[\d+-.a-z]/i,Gx=/\d/,Hne=/^0x/i,Wne=/^[0-7]+$/,zne=/^\d+$/,_V=/^[\da-f]+$/i,Kne=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Yne=/[\0\t\n\r #/:<>?@[\\\]^|]/,qne=/^[\u0000-\u0020]+/,Xne=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Jne=/[\t\n\r]/g,A0=function(e){var t,r,a,o;if(typeof e=="number"){for(t=[],r=0;r<4;r++)Fne(t,e%256),e=Mne(e/256);return R0(t,".")}if(typeof e=="object"){for(t="",a=(function(u){for(var h=null,m=1,g=null,y=0,E=0;E<8;E++)u[E]!==0?(y>m&&(h=g,m=y),g=null,y=0):(g===null&&(g=E),++y);return y>m?g:h})(e),r=0;r<8;r++)o&&e[r]===0||(o&&(o=!1),a===r?(t+=r?":":"::",o=!0):(t+=Une(e[r],16),r<7&&(t+=":")));return"["+t+"]"}return e},VR={},vV=jx({},VR,{" ":1,'"':1,"<":1,">":1,"`":1}),yV=jx({},vV,{"#":1,"?":1,"{":1,"}":1}),Hx=jx({},yV,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Oh=function(e,t){var r=Ine(e,0);return r>32&&r<127&&!Ux(t,e)?e:encodeURIComponent(e)},BR={ftp:21,file:null,http:80,https:443,ws:80,wss:443},O0=function(e,t){var r;return e.length===2&&Dc(gV,bo(e,0))&&((r=bo(e,1))===":"||!t&&r==="|")},EV=function(e){var t;return e.length>1&&O0(C0(e,0,2))&&(e.length===2||(t=bo(e,2))==="/"||t==="\\"||t==="?"||t==="#")},$ne=function(e){return e==="."||jR(e)==="%2e"},Wx={},SV={},zx={},bV={},TV={},Kx={},wV={},RV={},FR={},GR={},Yx={},qx={},Xx={},Jx={},CV={},$x={},E_={},Al={},AV={},Tp={},Lu={},Zx=function(e,t,r){var a,o,u,h=ku(e);if(t){if(o=this.parse(h))throw new Vx(o);this.searchParams=null}else{if(r!==void 0&&(a=new Zx(r,!0)),o=this.parse(h,null,a))throw new Vx(o);(u=Lne(new kne)).bindURL(this),this.searchParams=u}};Zx.prototype={type:"URL",parse:function(e,t,r){var a,o,u,h,m,g=this,y=t||Wx,E=0,A="",O=!1,N=!1,B=!1;for(e=ku(e),t||(g.scheme="",g.username="",g.password="",g.host=null,g.port=null,g.path=[],g.query=null,g.fragment=null,g.cannotBeABaseURL=!1,e=Bx(e,qne,""),e=Bx(e,Xne,"$1")),e=Bx(e,Jne,""),a=v_(e);E<=a.length;){switch(o=a[E],y){case Wx:if(!o||!Dc(gV,o)){if(t)return Fx;y=zx;continue}A+=jR(o),y=SV;break;case SV:if(o&&(Dc(Gne,o)||o==="+"||o==="-"||o==="."))A+=jR(o);else{if(o!==":"){if(t)return Fx;A="",y=zx,E=0;continue}if(t&&(g.isSpecial()!==Ux(BR,A)||A==="file"&&(g.includesCredentials()||g.port!==null)||g.scheme==="file"&&!g.host))return;if(g.scheme=A,t)return void(g.isSpecial()&&BR[g.scheme]===g.port&&(g.port=null));A="",g.scheme==="file"?y=Jx:g.isSpecial()&&r&&r.scheme===g.scheme?y=bV:g.isSpecial()?y=RV:a[E+1]==="/"?(y=TV,E++):(g.cannotBeABaseURL=!0,y_(g.path,""),y=AV)}break;case zx:if(!r||r.cannotBeABaseURL&&o!=="#")return Fx;if(r.cannotBeABaseURL&&o==="#"){g.scheme=r.scheme,g.path=xc(r.path),g.query=r.query,g.fragment="",g.cannotBeABaseURL=!0,y=Lu;break}y=r.scheme==="file"?Jx:Kx;continue;case bV:if(o!=="/"||a[E+1]!=="/"){y=Kx;continue}y=FR,E++;break;case TV:if(o==="/"){y=GR;break}y=Al;continue;case Kx:if(g.scheme=r.scheme,o===yo)g.username=r.username,g.password=r.password,g.host=r.host,g.port=r.port,g.path=xc(r.path),g.query=r.query;else if(o==="/"||o==="\\"&&g.isSpecial())y=wV;else if(o==="?")g.username=r.username,g.password=r.password,g.host=r.host,g.port=r.port,g.path=xc(r.path),g.query="",y=Tp;else{if(o!=="#"){g.username=r.username,g.password=r.password,g.host=r.host,g.port=r.port,g.path=xc(r.path),g.path.length--,y=Al;continue}g.username=r.username,g.password=r.password,g.host=r.host,g.port=r.port,g.path=xc(r.path),g.query=r.query,g.fragment="",y=Lu}break;case wV:if(!g.isSpecial()||o!=="/"&&o!=="\\"){if(o!=="/"){g.username=r.username,g.password=r.password,g.host=r.host,g.port=r.port,y=Al;continue}y=GR}else y=FR;break;case RV:if(y=FR,o!=="/"||bo(A,E+1)!=="/")continue;E++;break;case FR:if(o!=="/"&&o!=="\\"){y=GR;continue}break;case GR:if(o==="@"){O&&(A="%40"+A),O=!0,u=v_(A);for(var U=0;U<u.length;U++){var V=u[U];if(V!==":"||B){var K=Oh(V,Hx);B?g.password+=K:g.username+=K}else B=!0}A=""}else if(o===yo||o==="/"||o==="?"||o==="#"||o==="\\"&&g.isSpecial()){if(O&&A==="")return"Invalid authority";E-=v_(A).length+1,A="",y=Yx}else A+=o;break;case Yx:case qx:if(t&&g.scheme==="file"){y=$x;continue}if(o!==":"||N){if(o===yo||o==="/"||o==="?"||o==="#"||o==="\\"&&g.isSpecial()){if(g.isSpecial()&&A==="")return bp;if(t&&A===""&&(g.includesCredentials()||g.port!==null))return;if(h=g.parseHost(A))return h;if(A="",y=E_,t)return;continue}o==="["?N=!0:o==="]"&&(N=!1),A+=o}else{if(A==="")return bp;if(h=g.parseHost(A))return h;if(A="",y=Xx,t===qx)return}break;case Xx:if(!Dc(Gx,o)){if(o===yo||o==="/"||o==="?"||o==="#"||o==="\\"&&g.isSpecial()||t){if(A!==""){var z=UR(A,10);if(z>65535)return mV;g.port=g.isSpecial()&&z===BR[g.scheme]?null:z,A=""}if(t)return;y=E_;continue}return mV}A+=o;break;case Jx:if(g.scheme="file",o==="/"||o==="\\")y=CV;else{if(!r||r.scheme!=="file"){y=Al;continue}switch(o){case yo:g.host=r.host,g.path=xc(r.path),g.query=r.query;break;case"?":g.host=r.host,g.path=xc(r.path),g.query="",y=Tp;break;case"#":g.host=r.host,g.path=xc(r.path),g.query=r.query,g.fragment="",y=Lu;break;default:EV(R0(xc(a,E),""))||(g.host=r.host,g.path=xc(r.path),g.shortenPath()),y=Al;continue}}break;case CV:if(o==="/"||o==="\\"){y=$x;break}r&&r.scheme==="file"&&!EV(R0(xc(a,E),""))&&(O0(r.path[0],!0)?y_(g.path,r.path[0]):g.host=r.host),y=Al;continue;case $x:if(o===yo||o==="/"||o==="\\"||o==="?"||o==="#"){if(!t&&O0(A))y=Al;else if(A===""){if(g.host="",t)return;y=E_}else{if(h=g.parseHost(A))return h;if(g.host==="localhost"&&(g.host=""),t)return;A="",y=E_}continue}A+=o;break;case E_:if(g.isSpecial()){if(y=Al,o!=="/"&&o!=="\\")continue}else if(t||o!=="?")if(t||o!=="#"){if(o!==yo&&(y=Al,o!=="/"))continue}else g.fragment="",y=Lu;else g.query="",y=Tp;break;case Al:if(o===yo||o==="/"||o==="\\"&&g.isSpecial()||!t&&(o==="?"||o==="#")){if((m=jR(m=A))===".."||m==="%2e."||m===".%2e"||m==="%2e%2e"?(g.shortenPath(),o==="/"||o==="\\"&&g.isSpecial()||y_(g.path,"")):$ne(A)?o==="/"||o==="\\"&&g.isSpecial()||y_(g.path,""):(g.scheme==="file"&&!g.path.length&&O0(A)&&(g.host&&(g.host=""),A=bo(A,0)+":"),y_(g.path,A)),A="",g.scheme==="file"&&(o===yo||o==="?"||o==="#"))for(;g.path.length>1&&g.path[0]==="";)Vne(g.path);o==="?"?(g.query="",y=Tp):o==="#"&&(g.fragment="",y=Lu)}else A+=Oh(o,yV);break;case AV:o==="?"?(g.query="",y=Tp):o==="#"?(g.fragment="",y=Lu):o!==yo&&(g.path[0]+=Oh(o,VR));break;case Tp:t||o!=="#"?o!==yo&&(o==="'"&&g.isSpecial()?g.query+="%27":g.query+=o==="#"?"%23":Oh(o,VR)):(g.fragment="",y=Lu);break;case Lu:o!==yo&&(g.fragment+=Oh(o,vV))}E++}},parseHost:function(e){var t,r,a;if(bo(e,0)==="["){if(bo(e,e.length-1)!=="]"||(t=(function(o){var u,h,m,g,y,E,A,O=[0,0,0,0,0,0,0,0],N=0,B=null,U=0,V=function(){return bo(o,U)};if(V()===":"){if(bo(o,1)!==":")return;U+=2,B=++N}for(;V();){if(N===8)return;if(V()!==":"){for(u=h=0;h<4&&Dc(_V,V());)u=16*u+UR(V(),16),U++,h++;if(V()==="."){if(h===0||(U-=h,N>6))return;for(m=0;V();){if(g=null,m>0){if(!(V()==="."&&m<4))return;U++}if(!Dc(Gx,V()))return;for(;Dc(Gx,V());){if(y=UR(V(),10),g===null)g=y;else{if(g===0)return;g=10*g+y}if(g>255)return;U++}O[N]=256*O[N]+g,++m!=2&&m!==4||N++}if(m!==4)return;break}if(V()===":"){if(U++,!V())return}else if(V())return;O[N++]=u}else{if(B!==null)return;U++,B=++N}}if(B!==null)for(E=N-B,N=7;N!==0&&E>0;)A=O[N],O[N--]=O[B+E-1],O[B+--E]=A;else if(N!==8)return;return O})(C0(e,1,-1)),!t))return bp;this.host=t}else if(this.isSpecial()){if(e=Nne(e),Dc(Kne,e)||(t=(function(o){var u,h,m,g,y,E,A,O=Bne(o,".");if(O.length&&O[O.length-1]===""&&O.length--,(u=O.length)>4)return o;for(h=[],m=0;m<u;m++){if((g=O[m])==="")return o;if(y=10,g.length>1&&bo(g,0)==="0"&&(y=Dc(Hne,g)?16:8,g=C0(g,y===8?1:2)),g==="")E=0;else{if(!Dc(y===10?zne:y===8?Wne:_V,g))return o;E=UR(g,y)}y_(h,E)}for(m=0;m<u;m++)if(E=h[m],m===u-1){if(E>=pV(256,5-u))return null}else if(E>255)return null;for(A=jne(h),m=0;m<h.length;m++)A+=h[m]*pV(256,3-m);return A})(e),t===null))return bp;this.host=t}else{if(Dc(Yne,e))return bp;for(t="",r=v_(e),a=0;a<r.length;a++)t+=Oh(r[a],VR);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return Ux(BR,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme==="file"&&t===1&&O0(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,r=e.username,a=e.password,o=e.host,u=e.port,h=e.path,m=e.query,g=e.fragment,y=t+":";return o!==null?(y+="//",e.includesCredentials()&&(y+=r+(a?":"+a:"")+"@"),y+=A0(o),u!==null&&(y+=":"+u)):t==="file"&&(y+="//"),y+=e.cannotBeABaseURL?h[0]:h.length?"/"+R0(h,"/"):"",m!==null&&(y+="?"+m),g!==null&&(y+="#"+g),y},setHref:function(e){var t=this.parse(e);if(t)throw new Vx(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e==="blob")try{return new S_(e.path[0]).origin}catch{return"null"}return e!=="file"&&this.isSpecial()?e+"://"+A0(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(ku(e)+":",Wx)},getUsername:function(){return this.username},setUsername:function(e){var t=v_(ku(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var r=0;r<t.length;r++)this.username+=Oh(t[r],Hx)}},getPassword:function(){return this.password},setPassword:function(e){var t=v_(ku(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var r=0;r<t.length;r++)this.password+=Oh(t[r],Hx)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?A0(e):A0(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,Yx)},getHostname:function(){var e=this.host;return e===null?"":A0(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,qx)},getPort:function(){var e=this.port;return e===null?"":ku(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=ku(e))===""?this.port=null:this.parse(e,Xx))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+R0(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,E_))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=ku(e))===""?this.query=null:(bo(e,0)==="?"&&(e=C0(e,1)),this.query="",this.parse(e,Tp)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=ku(e))!==""?(bo(e,0)==="#"&&(e=C0(e,1)),this.fragment="",this.parse(e,Lu)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var S_=function(e){var t=One(this,qa),r=Dne(arguments.length,1)>1?arguments[1]:void 0,a=Pne(t,new Zx(e,!1,r));Lx||(t.href=a.serialize(),t.origin=a.getOrigin(),t.protocol=a.getProtocol(),t.username=a.getUsername(),t.password=a.getPassword(),t.host=a.getHost(),t.hostname=a.getHostname(),t.port=a.getPort(),t.pathname=a.getPathname(),t.search=a.getSearch(),t.searchParams=a.getSearchParams(),t.hash=a.getHash())},qa=S_.prototype,To=function(e,t){return{get:function(){return MR(this)[e]()},set:t&&function(r){return MR(this)[t](r)},configurable:!0,enumerable:!0}};if(Lx&&(So(qa,"href",To("serialize","setHref")),So(qa,"origin",To("getOrigin")),So(qa,"protocol",To("getProtocol","setProtocol")),So(qa,"username",To("getUsername","setUsername")),So(qa,"password",To("getPassword","setPassword")),So(qa,"host",To("getHost","setHost")),So(qa,"hostname",To("getHostname","setHostname")),So(qa,"port",To("getPort","setPort")),So(qa,"pathname",To("getPathname","setPathname")),So(qa,"search",To("getSearch","setSearch")),So(qa,"searchParams",To("getSearchParams")),So(qa,"hash",To("getHash","setHash"))),LR(qa,"toJSON",(function(){return MR(this).serialize()}),{enumerable:!0}),LR(qa,"toString",(function(){return MR(this).serialize()}),{enumerable:!0}),w0){var OV=w0.createObjectURL,IV=w0.revokeObjectURL;OV&&LR(S_,"createObjectURL",dV(OV,w0)),IV&&LR(S_,"revokeObjectURL",dV(IV,w0))}xne(S_,"URL"),Cne({global:!0,forced:!Ane,sham:!Lx},{URL:S_});var Zne=Jt,NV=p,Qne=vl,xV=Hi,ere=Me,Qx=Yn("URL"),tre=ere&&NV((function(){Qx.canParse()})),nre=NV((function(){return Qx.canParse.length!==1}));Zne({target:"URL",stat:!0,forced:!tre||nre},{canParse:function(e){var t=Qne(arguments.length,1),r=xV(e),a=t<2||arguments[1]===void 0?void 0:xV(arguments[1]);try{return!!new Qx(r,a)}catch{return!1}}});var rre=Jt,ire=vl,DV=Hi,are=Me,sre=Yn("URL");rre({target:"URL",stat:!0,forced:!are},{parse:function(e){var t=ire(arguments.length,1),r=DV(e),a=t<2||arguments[1]===void 0?void 0:DV(arguments[1]);try{return new sre(r,a)}catch{return null}}});var HR=f(ra.URL);let PV=!0,kV=!0;function WR(e,t,r){const a=e.match(t);return a&&a.length>=r&&parseInt(a[r],10)}function wp(e,t,r){if(!e.RTCPeerConnection)return;const a=e.RTCPeerConnection.prototype,o=a.addEventListener;a.addEventListener=function(h,m){if(h!==t)return o.apply(this,arguments);const g=y=>{const E=r(y);E&&(m.handleEvent?m.handleEvent(E):m(E))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(m,g),o.apply(this,[h,g])};const u=a.removeEventListener;a.removeEventListener=function(h,m){if(h!==t||!this._eventMap||!this._eventMap[t])return u.apply(this,arguments);if(!this._eventMap[t].has(m))return u.apply(this,arguments);const g=this._eventMap[t].get(m);return this._eventMap[t].delete(m),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,u.apply(this,[h,g])},Object.defineProperty(a,"on"+t,{get(){return this["_on"+t]},set(h){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),h&&this.addEventListener(t,this["_on"+t]=h)},enumerable:!0,configurable:!0})}function ore(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(PV=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function cre(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(kV=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function LV(){if(typeof window=="object"){if(PV)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function e1(e,t){kV&&console.warn(e+" is deprecated, please use "+t+" instead.")}function MV(e){return Object.prototype.toString.call(e)==="[object Object]"}function UV(e){var t;return MV(e)?vi(t=Object.keys(e)).call(t,(function(r,a){const o=MV(e[a]),u=o?UV(e[a]):e[a],h=o&&!Object.keys(u).length;return u===void 0||h?r:Object.assign(r,{[a]:u})}),{}):e}function t1(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),Object.keys(t).forEach((a=>{a.endsWith("Id")?t1(e,e.get(t[a]),r):a.endsWith("Ids")&&t[a].forEach((o=>{t1(e,e.get(o),r)}))})))}function jV(e,t,r){const a=r?"outbound-rtp":"inbound-rtp",o=new Map;if(t===null)return o;const u=[];return e.forEach((h=>{h.type==="track"&&h.trackIdentifier===t.id&&u.push(h)})),u.forEach((h=>{e.forEach((m=>{m.type===a&&m.trackId===h.id&&t1(e,m,o)}))})),o}const VV=LV;function BV(e,t){const r=e&&e.navigator;if(!r.mediaDevices)return;const a=function(h){if(typeof h!="object"||h.mandatory||h.optional)return h;const m={};return Object.keys(h).forEach((g=>{if(g==="require"||g==="advanced"||g==="mediaSource")return;const y=typeof h[g]=="object"?h[g]:{ideal:h[g]};y.exact!==void 0&&typeof y.exact=="number"&&(y.min=y.max=y.exact);const E=function(A,O){return A?A+O.charAt(0).toUpperCase()+O.slice(1):O==="deviceId"?"sourceId":O};if(y.ideal!==void 0){m.optional=m.optional||[];let A={};typeof y.ideal=="number"?(A[E("min",g)]=y.ideal,m.optional.push(A),A={},A[E("max",g)]=y.ideal,m.optional.push(A)):(A[E("",g)]=y.ideal,m.optional.push(A))}y.exact!==void 0&&typeof y.exact!="number"?(m.mandatory=m.mandatory||{},m.mandatory[E("",g)]=y.exact):["min","max"].forEach((A=>{y[A]!==void 0&&(m.mandatory=m.mandatory||{},m.mandatory[E(A,g)]=y[A])}))})),h.advanced&&(m.optional=(m.optional||[]).concat(h.advanced)),m},o=function(h,m){if(t.version>=61)return m(h);if((h=JSON.parse(JSON.stringify(h)))&&typeof h.audio=="object"){const g=function(y,E,A){E in y&&!(A in y)&&(y[A]=y[E],delete y[E])};g((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),g(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=a(h.audio)}if(h&&typeof h.video=="object"){let g=h.video.facingMode;g=g&&(typeof g=="object"?g:{ideal:g});const y=t.version<66;if(g&&(g.exact==="user"||g.exact==="environment"||g.ideal==="user"||g.ideal==="environment")&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||y)){let E;if(delete h.video.facingMode,g.exact==="environment"||g.ideal==="environment"?E=["back","rear"]:g.exact!=="user"&&g.ideal!=="user"||(E=["front"]),E)return r.mediaDevices.enumerateDevices().then((A=>{A=A.filter((N=>N.kind==="videoinput"));let O=A.find((N=>E.some((B=>{var U;return je(U=N.label.toLowerCase()).call(U,B)}))));return!O&&A.length&&je(E).call(E,"back")&&(O=A[A.length-1]),O&&(h.video.deviceId=g.exact?{exact:O.deviceId}:{ideal:O.deviceId}),h.video=a(h.video),VV("chrome: "+JSON.stringify(h)),m(h)}))}h.video=a(h.video)}return VV("chrome: "+JSON.stringify(h)),m(h)},u=function(h){return t.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(r.getUserMedia=(function(h,m,g){o(h,(y=>{r.webkitGetUserMedia(y,m,(E=>{g&&g(u(E))}))}))}).bind(r),r.mediaDevices.getUserMedia){const h=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(m){return o(m,(g=>h(g).then((y=>{if(g.audio&&!y.getAudioTracks().length||g.video&&!y.getVideoTracks().length)throw y.getTracks().forEach((E=>{E.stop()})),new DOMException("","NotFoundError");return y}),(y=>Fe.reject(u(y))))))}}}function FV(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function GV(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(r){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=r)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",(a=>{let o;o=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((h=>h.track&&h.track.id===a.track.id)):{track:a.track};const u=new Event("track");u.track=a.track,u.receiver=o,u.transceiver={receiver:o},u.streams=[r.stream],this.dispatchEvent(u)})),r.stream.getTracks().forEach((a=>{let o;o=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((h=>h.track&&h.track.id===a.id)):{track:a};const u=new Event("track");u.track=a,u.receiver=o,u.transceiver={receiver:o},u.streams=[r.stream],this.dispatchEvent(u)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else wp(e,"track",(t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t)))}function HV(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(o,u){return{track:u,get dtmf(){return this._dtmf===void 0&&(u.kind==="audio"?this._dtmf=o.createDTMFSender(u):this._dtmf=null),this._dtmf},_pc:o}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const o=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(h,m){let g=o.apply(this,arguments);return g||(g=t(this,h),this._senders.push(g)),g};const u=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(h){u.apply(this,arguments);const m=this._senders.indexOf(h);m!==-1&&this._senders.splice(m,1)}}const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(o){this._senders=this._senders||[],r.apply(this,[o]),o.getTracks().forEach((u=>{this._senders.push(t(this,u))}))};const a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(o){this._senders=this._senders||[],a.apply(this,[o]),o.getTracks().forEach((u=>{const h=this._senders.find((m=>m.track===u));h&&this._senders.splice(this._senders.indexOf(h),1)}))}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach((a=>a._pc=this)),r},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function WV(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[r,a,o]=arguments;if(arguments.length>0&&typeof r=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof r!="function"))return t.apply(this,[]);const u=function(m){const g={};return m.result().forEach((y=>{const E={id:y.id,timestamp:y.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[y.type]||y.type};y.names().forEach((A=>{E[A]=y.stat(A)})),g[E.id]=E})),g},h=function(m){return new Map(Object.keys(m).map((g=>[g,m[g]])))};if(arguments.length>=2){const m=function(g){a(h(u(g)))};return t.apply(this,[m,r])}return new Fe(((m,g)=>{t.apply(this,[function(y){m(h(u(y)))},g])})).then(a,o)}}function zV(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const r=e.RTCPeerConnection.prototype.getSenders;r&&(e.RTCPeerConnection.prototype.getSenders=function(){const o=r.apply(this,[]);return o.forEach((u=>u._pc=this)),o});const a=e.RTCPeerConnection.prototype.addTrack;a&&(e.RTCPeerConnection.prototype.addTrack=function(){const o=a.apply(this,arguments);return o._pc=this,o}),e.RTCRtpSender.prototype.getStats=function(){const o=this;return this._pc.getStats().then((u=>jV(u,o.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){const a=r.apply(this,[]);return a.forEach((o=>o._pc=this)),a}),wp(e,"track",(a=>(a.receiver._pc=a.srcElement,a))),e.RTCRtpReceiver.prototype.getStats=function(){const a=this;return this._pc.getStats().then((o=>jV(o,a.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const r=arguments[0];let a,o,u;return this.getSenders().forEach((h=>{h.track===r&&(a?u=!0:a=h)})),this.getReceivers().forEach((h=>(h.track===r&&(o?u=!0:o=h),h.track===r))),u||a&&o?Fe.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):a?a.getStats():o?o.getStats():Fe.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function KV(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((u=>this._shimmedLocalStreams[u][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(u,h){if(!h)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const m=t.apply(this,arguments);return this._shimmedLocalStreams[h.id]?this._shimmedLocalStreams[h.id].indexOf(m)===-1&&this._shimmedLocalStreams[h.id].push(m):this._shimmedLocalStreams[h.id]=[h,m],m};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(u){this._shimmedLocalStreams=this._shimmedLocalStreams||{},u.getTracks().forEach((g=>{if(this.getSenders().find((E=>E.track===g)))throw new DOMException("Track already exists.","InvalidAccessError")}));const h=this.getSenders();r.apply(this,arguments);const m=this.getSenders().filter((g=>h.indexOf(g)===-1));this._shimmedLocalStreams[u.id]=[u].concat(m)};const a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[u.id],a.apply(this,arguments)};const o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},u&&Object.keys(this._shimmedLocalStreams).forEach((h=>{const m=this._shimmedLocalStreams[h].indexOf(u);m!==-1&&this._shimmedLocalStreams[h].splice(m,1),this._shimmedLocalStreams[h].length===1&&delete this._shimmedLocalStreams[h]})),o.apply(this,arguments)}}function YV(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return KV(e);const r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const g=r.apply(this);return this._reverseStreams=this._reverseStreams||{},g.map((y=>this._reverseStreams[y.id]))};const a=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(g){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},g.getTracks().forEach((y=>{if(this.getSenders().find((A=>A.track===y)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[g.id]){const y=new e.MediaStream(g.getTracks());this._streams[g.id]=y,this._reverseStreams[y.id]=g,g=y}a.apply(this,[g])};const o=e.RTCPeerConnection.prototype.removeStream;function u(g,y){let E=y.sdp;return Object.keys(g._reverseStreams||[]).forEach((A=>{const O=g._reverseStreams[A],N=g._streams[O.id];E=E.replace(new RegExp(N.id,"g"),O.id)})),new RTCSessionDescription({type:y.type,sdp:E})}e.RTCPeerConnection.prototype.removeStream=function(g){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[g.id]||g]),delete this._reverseStreams[this._streams[g.id]?this._streams[g.id].id:g.id],delete this._streams[g.id]},e.RTCPeerConnection.prototype.addTrack=function(g,y){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const E=[].slice.call(arguments,1);if(E.length!==1||!E[0].getTracks().find((N=>N===g)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((N=>N.track===g)))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const O=this._streams[y.id];if(O)O.addTrack(g),Fe.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const N=new e.MediaStream([g]);this._streams[y.id]=N,this._reverseStreams[N.id]=y,this.addStream(N)}return this.getSenders().find((N=>N.track===g))},["createOffer","createAnswer"].forEach((function(g){const y=e.RTCPeerConnection.prototype[g],E={[g](){const A=arguments;return arguments.length&&typeof arguments[0]=="function"?y.apply(this,[O=>{const N=u(this,O);A[0].apply(null,[N])},O=>{A[1]&&A[1].apply(null,O)},arguments[2]]):y.apply(this,arguments).then((O=>u(this,O)))}};e.RTCPeerConnection.prototype[g]=E[g]}));const h=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=(function(g,y){let E=y.sdp;return Object.keys(g._reverseStreams||[]).forEach((A=>{const O=g._reverseStreams[A],N=g._streams[O.id];E=E.replace(new RegExp(O.id,"g"),N.id)})),new RTCSessionDescription({type:y.type,sdp:E})})(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const m=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const g=m.get.apply(this);return g.type===""?g:u(this,g)}}),e.RTCPeerConnection.prototype.removeTrack=function(g){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!g._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(g._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let y;this._streams=this._streams||{},Object.keys(this._streams).forEach((E=>{this._streams[E].getTracks().find((A=>g.track===A))&&(y=this._streams[E])})),y&&(y.getTracks().length===1?this.removeStream(this._reverseStreams[y.id]):y.removeTrack(g.track),this.dispatchEvent(new Event("negotiationneeded")))}}function n1(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(r){const a=e.RTCPeerConnection.prototype[r],o={[r](){return arguments[0]=new(r==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};e.RTCPeerConnection.prototype[r]=o[r]}))}function qV(e,t){wp(e,"negotiationneeded",(r=>{const a=r.target;if(!(t.version<72||a.getConfiguration&&a.getConfiguration().sdpSemantics==="plan-b")||a.signalingState==="stable")return r}))}var XV=Object.freeze({__proto__:null,fixNegotiationNeeded:qV,shimAddTrackRemoveTrack:YV,shimAddTrackRemoveTrackWithNative:KV,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then((a=>{const o=r.video&&r.video.width,u=r.video&&r.video.height,h=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:a,maxFrameRate:h||3}},o&&(r.video.mandatory.maxWidth=o),u&&(r.video.mandatory.maxHeight=u),e.navigator.mediaDevices.getUserMedia(r)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:HV,shimGetStats:WV,shimGetUserMedia:BV,shimMediaStream:FV,shimOnTrack:GV,shimPeerConnection:n1,shimSenderReceiverGetStats:zV});function JV(e,t){const r=e&&e.navigator,a=e&&e.MediaStreamTrack;if(r.getUserMedia=function(o,u,h){e1("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(o).then(u,h)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){const o=function(h,m,g){m in h&&!(g in h)&&(h[g]=h[m],delete h[m])},u=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),o(h.audio,"autoGainControl","mozAutoGainControl"),o(h.audio,"noiseSuppression","mozNoiseSuppression")),u(h)},a&&a.prototype.getSettings){const h=a.prototype.getSettings;a.prototype.getSettings=function(){const m=h.apply(this,arguments);return o(m,"mozAutoGainControl","autoGainControl"),o(m,"mozNoiseSuppression","noiseSuppression"),m}}if(a&&a.prototype.applyConstraints){const h=a.prototype.applyConstraints;a.prototype.applyConstraints=function(m){return this.kind==="audio"&&typeof m=="object"&&(m=JSON.parse(JSON.stringify(m)),o(m,"autoGainControl","mozAutoGainControl"),o(m,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[m])}}}}function $V(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function r1(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(o){const u=e.RTCPeerConnection.prototype[o],h={[o](){return arguments[0]=new(o==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),u.apply(this,arguments)}};e.RTCPeerConnection.prototype[o]=h[o]}));const r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[o,u,h]=arguments;return a.apply(this,[o||null]).then((m=>{if(t.version<53&&!u)try{m.forEach((g=>{g.type=r[g.type]||g.type}))}catch(g){if(g.name!=="TypeError")throw g;m.forEach(((y,E)=>{m.set(E,Object.assign({},y,{type:r[y.type]||y.type}))}))}return m})).then(u,h)}}function ZV(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const a=t.apply(this,[]);return a.forEach((o=>o._pc=this)),a});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const a=r.apply(this,arguments);return a._pc=this,a}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Fe.resolve(new Map)}}function QV(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const r=t.apply(this,[]);return r.forEach((a=>a._pc=this)),r}),wp(e,"track",(r=>(r.receiver._pc=r.srcElement,r))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function e3(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){e1("removeStream","removeTrack"),this.getSenders().forEach((r=>{var a;r.track&&je(a=t.getTracks()).call(a,r.track)&&this.removeTrack(r)}))})}function t3(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function n3(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const a=r.length>0;a&&r.forEach((u=>{if("rid"in u&&!/^[a-z0-9]{0,16}$/i.test(u.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in u&&!(parseFloat(u.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in u&&!(parseFloat(u.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const o=t.apply(this,arguments);if(a){const{sender:u}=o,h=u.getParameters();(!("encodings"in h)||h.encodings.length===1&&Object.keys(h.encodings[0]).length===0)&&(h.encodings=r,u.sendEncodings=r,this.setParametersPromises.push(u.setParameters(h).then((()=>{delete u.sendEncodings})).catch((()=>{delete u.sendEncodings}))))}return o})}function r3(e){if(typeof e!="object"||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const r=t.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function i3(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Fe.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function a3(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Fe.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}var s3=Object.freeze({__proto__:null,shimAddTransceiver:n3,shimCreateAnswer:a3,shimCreateOffer:i3,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){const a=new DOMException("getDisplayMedia without video constraints is undefined");return a.name="NotFoundError",a.code=8,Fe.reject(a)}return r.video===!0?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})},shimGetParameters:r3,shimGetUserMedia:JV,shimOnTrack:$V,shimPeerConnection:r1,shimRTCDataChannel:t3,shimReceiverGetStats:QV,shimRemoveStream:e3,shimSenderGetStats:ZV});function o3(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(r){var a;this._localStreams||(this._localStreams=[]),je(a=this._localStreams).call(a,r)||this._localStreams.push(r),r.getAudioTracks().forEach((o=>t.call(this,o,r))),r.getVideoTracks().forEach((o=>t.call(this,o,r)))},e.RTCPeerConnection.prototype.addTrack=function(r){for(var a=arguments.length,o=new Array(a>1?a-1:0),u=1;u<a;u++)o[u-1]=arguments[u];return o&&o.forEach((h=>{var m;this._localStreams?je(m=this._localStreams).call(m,h)||this._localStreams.push(h):this._localStreams=[h]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(t);if(r===-1)return;this._localStreams.splice(r,1);const a=t.getTracks();this.getSenders().forEach((o=>{je(a).call(a,o.track)&&this.removeTrack(o)}))})}}function c3(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(r){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=r),this.addEventListener("track",this._onaddstreampoly=a=>{a.streams.forEach((o=>{var u;if(this._remoteStreams||(this._remoteStreams=[]),je(u=this._remoteStreams).call(u,o))return;this._remoteStreams.push(o);const h=new Event("addstream");h.stream=o,this.dispatchEvent(h)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach((o=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(o)>=0)return;r._remoteStreams.push(o);const u=new Event("addstream");u.stream=o,r.dispatchEvent(u)}))}),t.apply(r,arguments)}}}function l3(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,r=t.createOffer,a=t.createAnswer,o=t.setLocalDescription,u=t.setRemoteDescription,h=t.addIceCandidate;t.createOffer=function(g,y){const E=arguments.length>=2?arguments[2]:arguments[0],A=r.apply(this,[E]);return y?(A.then(g,y),Fe.resolve()):A},t.createAnswer=function(g,y){const E=arguments.length>=2?arguments[2]:arguments[0],A=a.apply(this,[E]);return y?(A.then(g,y),Fe.resolve()):A};let m=function(g,y,E){const A=o.apply(this,[g]);return E?(A.then(y,E),Fe.resolve()):A};t.setLocalDescription=m,m=function(g,y,E){const A=u.apply(this,[g]);return E?(A.then(y,E),Fe.resolve()):A},t.setRemoteDescription=m,m=function(g,y,E){const A=h.apply(this,[g]);return E?(A.then(y,E),Fe.resolve()):A},t.addIceCandidate=m}function u3(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const r=t.mediaDevices,a=r.getUserMedia.bind(r);t.mediaDevices.getUserMedia=o=>a(d3(o))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(r,a,o){t.mediaDevices.getUserMedia(r).then(a,o)}).bind(t))}function d3(e){return e&&e.video!==void 0?Object.assign({},e,{video:UV(e.video)}):e}function h3(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(r,a){if(r&&r.iceServers){const o=[];for(let u=0;u<r.iceServers.length;u++){let h=r.iceServers[u];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(e1("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,o.push(h)):o.push(r.iceServers[u])}r.iceServers=o}return new t(r,a)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function f3(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function p3(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(r){if(r){r.offerToReceiveAudio!==void 0&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const a=this.getTransceivers().find((u=>u.receiver.track.kind==="audio"));r.offerToReceiveAudio===!1&&a?a.direction==="sendrecv"?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":a.direction==="recvonly"&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):r.offerToReceiveAudio!==!0||a||this.addTransceiver("audio",{direction:"recvonly"}),r.offerToReceiveVideo!==void 0&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const o=this.getTransceivers().find((u=>u.receiver.track.kind==="video"));r.offerToReceiveVideo===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):r.offerToReceiveVideo!==!0||o||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function m3(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var g3=Object.freeze({__proto__:null,shimAudioContext:m3,shimCallbacksAPI:l3,shimConstraints:d3,shimCreateOfferLegacy:p3,shimGetUserMedia:u3,shimLocalStreamsAPI:o3,shimRTCIceServerUrls:h3,shimRemoteStreamsAPI:c3,shimTrackEventTransceiver:f3}),_3=`	
\v\f\r \u2028\u2029\uFEFF`,lre=br,ure=Hi,i1=_3,v3=I("".replace),dre=RegExp("^["+i1+"]+"),hre=RegExp("(^|[^"+i1+"])["+i1+"]+$"),fre=function(e){return function(t){var r=ure(lre(t));return 1&e&&(r=v3(r,dre,"")),2&e&&(r=v3(r,hre,"$1")),r}},pre={trim:fre(3)},mre=cE.PROPER,gre=p,y3=_3,_re=pre.trim;Jt({target:"String",proto:!0,forced:(function(e){return gre((function(){return!!y3[e]()||""[e]()!==""||mre&&y3[e].name!==e}))})("trim")},{trim:function(){return _re(this)}});var vre=ia("String","trim"),yre=D,Ere=vre,a1=String.prototype,Sre=function(e){var t=e.trim;return typeof e=="string"||e===a1||yre(a1,e)&&t===a1.trim?Ere:t},ki=f(Sre),E3={exports:{}};(function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(r){return r.trim().split(`
`).map((a=>a.trim()))},t.splitSections=function(r){return r.split(`
m=`).map(((a,o)=>(o>0?"m="+a:a).trim()+`\r
`))},t.getDescription=function(r){const a=t.splitSections(r);return a&&a[0]},t.getMediaSections=function(r){const a=t.splitSections(r);return a.shift(),a},t.matchPrefix=function(r,a){return t.splitLines(r).filter((o=>o.indexOf(a)===0))},t.parseCandidate=function(r){let a;a=r.indexOf("a=candidate:")===0?r.substring(12).split(" "):r.substring(10).split(" ");const o={foundation:a[0],component:{1:"rtp",2:"rtcp"}[a[1]]||a[1],protocol:a[2].toLowerCase(),priority:parseInt(a[3],10),ip:a[4],address:a[4],port:parseInt(a[5],10),type:a[7]};for(let u=8;u<a.length;u+=2)switch(a[u]){case"raddr":o.relatedAddress=a[u+1];break;case"rport":o.relatedPort=parseInt(a[u+1],10);break;case"tcptype":o.tcpType=a[u+1];break;case"ufrag":o.ufrag=a[u+1],o.usernameFragment=a[u+1];break;default:o[a[u]]===void 0&&(o[a[u]]=a[u+1])}return o},t.writeCandidate=function(r){const a=[];a.push(r.foundation);const o=r.component;o==="rtp"?a.push(1):o==="rtcp"?a.push(2):a.push(o),a.push(r.protocol.toUpperCase()),a.push(r.priority),a.push(r.address||r.ip),a.push(r.port);const u=r.type;return a.push("typ"),a.push(u),u!=="host"&&r.relatedAddress&&r.relatedPort&&(a.push("raddr"),a.push(r.relatedAddress),a.push("rport"),a.push(r.relatedPort)),r.tcpType&&r.protocol.toLowerCase()==="tcp"&&(a.push("tcptype"),a.push(r.tcpType)),(r.usernameFragment||r.ufrag)&&(a.push("ufrag"),a.push(r.usernameFragment||r.ufrag)),"candidate:"+a.join(" ")},t.parseIceOptions=function(r){return r.substring(14).split(" ")},t.parseRtpMap=function(r){let a=r.substring(9).split(" ");const o={payloadType:parseInt(a.shift(),10)};return a=a[0].split("/"),o.name=a[0],o.clockRate=parseInt(a[1],10),o.channels=a.length===3?parseInt(a[2],10):1,o.numChannels=o.channels,o},t.writeRtpMap=function(r){let a=r.payloadType;r.preferredPayloadType!==void 0&&(a=r.preferredPayloadType);const o=r.channels||r.numChannels||1;return"a=rtpmap:"+a+" "+r.name+"/"+r.clockRate+(o!==1?"/"+o:"")+`\r
`},t.parseExtmap=function(r){const a=r.substring(9).split(" ");return{id:parseInt(a[0],10),direction:a[0].indexOf("/")>0?a[0].split("/")[1]:"sendrecv",uri:a[1],attributes:a.slice(2).join(" ")}},t.writeExtmap=function(r){return"a=extmap:"+(r.id||r.preferredId)+(r.direction&&r.direction!=="sendrecv"?"/"+r.direction:"")+" "+r.uri+(r.attributes?" "+r.attributes:"")+`\r
`},t.parseFmtp=function(r){const a={};let o;const u=r.substring(r.indexOf(" ")+1).split(";");for(let h=0;h<u.length;h++)o=u[h].trim().split("="),a[o[0].trim()]=o[1];return a},t.writeFmtp=function(r){let a="",o=r.payloadType;if(r.preferredPayloadType!==void 0&&(o=r.preferredPayloadType),r.parameters&&Object.keys(r.parameters).length){const u=[];Object.keys(r.parameters).forEach((h=>{r.parameters[h]!==void 0?u.push(h+"="+r.parameters[h]):u.push(h)})),a+="a=fmtp:"+o+" "+u.join(";")+`\r
`}return a},t.parseRtcpFb=function(r){const a=r.substring(r.indexOf(" ")+1).split(" ");return{type:a.shift(),parameter:a.join(" ")}},t.writeRtcpFb=function(r){let a="",o=r.payloadType;return r.preferredPayloadType!==void 0&&(o=r.preferredPayloadType),r.rtcpFeedback&&r.rtcpFeedback.length&&r.rtcpFeedback.forEach((u=>{a+="a=rtcp-fb:"+o+" "+u.type+(u.parameter&&u.parameter.length?" "+u.parameter:"")+`\r
`})),a},t.parseSsrcMedia=function(r){const a=r.indexOf(" "),o={ssrc:parseInt(r.substring(7,a),10)},u=r.indexOf(":",a);return u>-1?(o.attribute=r.substring(a+1,u),o.value=r.substring(u+1)):o.attribute=r.substring(a+1),o},t.parseSsrcGroup=function(r){const a=r.substring(13).split(" ");return{semantics:a.shift(),ssrcs:a.map((o=>parseInt(o,10)))}},t.getMid=function(r){const a=t.matchPrefix(r,"a=mid:")[0];if(a)return a.substring(6)},t.parseFingerprint=function(r){const a=r.substring(14).split(" ");return{algorithm:a[0].toLowerCase(),value:a[1].toUpperCase()}},t.getDtlsParameters=function(r,a){return{role:"auto",fingerprints:t.matchPrefix(r+a,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(r,a){let o="a=setup:"+a+`\r
`;return r.fingerprints.forEach((u=>{o+="a=fingerprint:"+u.algorithm+" "+u.value+`\r
`})),o},t.parseCryptoLine=function(r){const a=r.substring(9).split(" ");return{tag:parseInt(a[0],10),cryptoSuite:a[1],keyParams:a[2],sessionParams:a.slice(3)}},t.writeCryptoLine=function(r){return"a=crypto:"+r.tag+" "+r.cryptoSuite+" "+(typeof r.keyParams=="object"?t.writeCryptoKeyParams(r.keyParams):r.keyParams)+(r.sessionParams?" "+r.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(r){if(r.indexOf("inline:")!==0)return null;const a=r.substring(7).split("|");return{keyMethod:"inline",keySalt:a[0],lifeTime:a[1],mkiValue:a[2]?a[2].split(":")[0]:void 0,mkiLength:a[2]?a[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(r){return r.keyMethod+":"+r.keySalt+(r.lifeTime?"|"+r.lifeTime:"")+(r.mkiValue&&r.mkiLength?"|"+r.mkiValue+":"+r.mkiLength:"")},t.getCryptoParameters=function(r,a){return t.matchPrefix(r+a,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(r,a){const o=t.matchPrefix(r+a,"a=ice-ufrag:")[0],u=t.matchPrefix(r+a,"a=ice-pwd:")[0];return o&&u?{usernameFragment:o.substring(12),password:u.substring(10)}:null},t.writeIceParameters=function(r){let a="a=ice-ufrag:"+r.usernameFragment+`\r
a=ice-pwd:`+r.password+`\r
`;return r.iceLite&&(a+=`a=ice-lite\r
`),a},t.parseRtpParameters=function(r){const a={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},o=t.splitLines(r)[0].split(" ");a.profile=o[2];for(let h=3;h<o.length;h++){const m=o[h],g=t.matchPrefix(r,"a=rtpmap:"+m+" ")[0];if(g){const y=t.parseRtpMap(g),E=t.matchPrefix(r,"a=fmtp:"+m+" ");switch(y.parameters=E.length?t.parseFmtp(E[0]):{},y.rtcpFeedback=t.matchPrefix(r,"a=rtcp-fb:"+m+" ").map(t.parseRtcpFb),a.codecs.push(y),y.name.toUpperCase()){case"RED":case"ULPFEC":a.fecMechanisms.push(y.name.toUpperCase())}}}t.matchPrefix(r,"a=extmap:").forEach((h=>{a.headerExtensions.push(t.parseExtmap(h))}));const u=t.matchPrefix(r,"a=rtcp-fb:* ").map(t.parseRtcpFb);return a.codecs.forEach((h=>{u.forEach((m=>{h.rtcpFeedback.find((g=>g.type===m.type&&g.parameter===m.parameter))||h.rtcpFeedback.push(m)}))})),a},t.writeRtpDescription=function(r,a){let o="";o+="m="+r+" ",o+=a.codecs.length>0?"9":"0",o+=" "+(a.profile||"UDP/TLS/RTP/SAVPF")+" ",o+=a.codecs.map((h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType)).join(" ")+`\r
`,o+=`c=IN IP4 0.0.0.0\r
`,o+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,a.codecs.forEach((h=>{o+=t.writeRtpMap(h),o+=t.writeFmtp(h),o+=t.writeRtcpFb(h)}));let u=0;return a.codecs.forEach((h=>{h.maxptime>u&&(u=h.maxptime)})),u>0&&(o+="a=maxptime:"+u+`\r
`),a.headerExtensions&&a.headerExtensions.forEach((h=>{o+=t.writeExtmap(h)})),o},t.parseRtpEncodingParameters=function(r){const a=[],o=t.parseRtpParameters(r),u=o.fecMechanisms.indexOf("RED")!==-1,h=o.fecMechanisms.indexOf("ULPFEC")!==-1,m=t.matchPrefix(r,"a=ssrc:").map((O=>t.parseSsrcMedia(O))).filter((O=>O.attribute==="cname")),g=m.length>0&&m[0].ssrc;let y;const E=t.matchPrefix(r,"a=ssrc-group:FID").map((O=>O.substring(17).split(" ").map((N=>parseInt(N,10)))));E.length>0&&E[0].length>1&&E[0][0]===g&&(y=E[0][1]),o.codecs.forEach((O=>{if(O.name.toUpperCase()==="RTX"&&O.parameters.apt){let N={ssrc:g,codecPayloadType:parseInt(O.parameters.apt,10)};g&&y&&(N.rtx={ssrc:y}),a.push(N),u&&(N=JSON.parse(JSON.stringify(N)),N.fec={ssrc:g,mechanism:h?"red+ulpfec":"red"},a.push(N))}})),a.length===0&&g&&a.push({ssrc:g});let A=t.matchPrefix(r,"b=");return A.length&&(A=A[0].indexOf("b=TIAS:")===0?parseInt(A[0].substring(7),10):A[0].indexOf("b=AS:")===0?1e3*parseInt(A[0].substring(5),10)*.95-16e3:void 0,a.forEach((O=>{O.maxBitrate=A}))),a},t.parseRtcpParameters=function(r){const a={},o=t.matchPrefix(r,"a=ssrc:").map((m=>t.parseSsrcMedia(m))).filter((m=>m.attribute==="cname"))[0];o&&(a.cname=o.value,a.ssrc=o.ssrc);const u=t.matchPrefix(r,"a=rtcp-rsize");a.reducedSize=u.length>0,a.compound=u.length===0;const h=t.matchPrefix(r,"a=rtcp-mux");return a.mux=h.length>0,a},t.writeRtcpParameters=function(r){let a="";return r.reducedSize&&(a+=`a=rtcp-rsize\r
`),r.mux&&(a+=`a=rtcp-mux\r
`),r.ssrc!==void 0&&r.cname&&(a+="a=ssrc:"+r.ssrc+" cname:"+r.cname+`\r
`),a},t.parseMsid=function(r){let a;const o=t.matchPrefix(r,"a=msid:");if(o.length===1)return a=o[0].substring(7).split(" "),{stream:a[0],track:a[1]};const u=t.matchPrefix(r,"a=ssrc:").map((h=>t.parseSsrcMedia(h))).filter((h=>h.attribute==="msid"));return u.length>0?(a=u[0].value.split(" "),{stream:a[0],track:a[1]}):void 0},t.parseSctpDescription=function(r){const a=t.parseMLine(r),o=t.matchPrefix(r,"a=max-message-size:");let u;o.length>0&&(u=parseInt(o[0].substring(19),10)),isNaN(u)&&(u=65536);const h=t.matchPrefix(r,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:a.fmt,maxMessageSize:u};const m=t.matchPrefix(r,"a=sctpmap:");if(m.length>0){const g=m[0].substring(10).split(" ");return{port:parseInt(g[0],10),protocol:g[1],maxMessageSize:u}}},t.writeSctpDescription=function(r,a){let o=[];return o=r.protocol!=="DTLS/SCTP"?["m="+r.kind+" 9 "+r.protocol+" "+a.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+a.port+`\r
`]:["m="+r.kind+" 9 "+r.protocol+" "+a.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+a.port+" "+a.protocol+` 65535\r
`],a.maxMessageSize!==void 0&&o.push("a=max-message-size:"+a.maxMessageSize+`\r
`),o.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(r,a,o){let u;const h=a!==void 0?a:2;return u=r||t.generateSessionId(),`v=0\r
o=`+(o||"thisisadapterortc")+" "+u+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(r,a){const o=t.splitLines(r);for(let u=0;u<o.length;u++)switch(o[u]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return o[u].substring(2)}return a?t.getDirection(a):"sendrecv"},t.getKind=function(r){return t.splitLines(r)[0].split(" ")[0].substring(2)},t.isRejected=function(r){return r.split(" ",2)[1]==="0"},t.parseMLine=function(r){const a=t.splitLines(r)[0].substring(2).split(" ");return{kind:a[0],port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}},t.parseOLine=function(r){const a=t.matchPrefix(r,"o=")[0].substring(2).split(" ");return{username:a[0],sessionId:a[1],sessionVersion:parseInt(a[2],10),netType:a[3],addressType:a[4],address:a[5]}},t.isValidSDP=function(r){if(typeof r!="string"||r.length===0)return!1;const a=t.splitLines(r);for(let o=0;o<a.length;o++)if(a[o].length<2||a[o].charAt(1)!=="=")return!1;return!0},e.exports=t})(E3);var S3=E3.exports,b_=f(S3),bre=s({__proto__:null,default:b_},[S3]);function zR(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&((r=JSON.parse(JSON.stringify(r))).candidate=r.candidate.substr(2)),r.candidate&&r.candidate.length){const a=new t(r),o=b_.parseCandidate(r.candidate),u=Object.assign(a,o);return u.toJSON=function(){return{candidate:u.candidate,sdpMid:u.sdpMid,sdpMLineIndex:u.sdpMLineIndex,usernameFragment:u.usernameFragment}},u}return new t(r)},e.RTCIceCandidate.prototype=t.prototype,wp(e,"icecandidate",(r=>(r.candidate&&Object.defineProperty(r,"candidate",{value:new e.RTCIceCandidate(r.candidate),writable:"false"}),r)))}function s1(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||wp(e,"icecandidate",(t=>{if(t.candidate){const r=b_.parseCandidate(t.candidate.candidate);r.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[r.priority>>24])}return t}))}function KR(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const r=function(m){if(!m||!m.sdp)return!1;const g=b_.splitSections(m.sdp);return g.shift(),g.some((y=>{const E=b_.parseMLine(y);return E&&E.kind==="application"&&E.protocol.indexOf("SCTP")!==-1}))},a=function(m){const g=m.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(g===null||g.length<2)return-1;const y=parseInt(g[1],10);return y!=y?-1:y},o=function(m){let g=65536;return t.browser==="firefox"&&(g=t.version<57?m===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),g},u=function(m,g){let y=65536;t.browser==="firefox"&&t.version===57&&(y=65535);const E=b_.matchPrefix(m.sdp,"a=max-message-size:");return E.length>0?y=parseInt(E[0].substr(19),10):t.browser==="firefox"&&g!==-1&&(y=2147483637),y},h=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:m}=this.getConfiguration();m==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){const m=a(arguments[0]),g=o(m),y=u(arguments[0],m);let E;E=g===0&&y===0?Number.POSITIVE_INFINITY:g===0||y===0?Math.max(g,y):Math.min(g,y);const A={};Object.defineProperty(A,"maxMessageSize",{get:()=>E}),this._sctp=A}return h.apply(this,arguments)}}function YR(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(a,o){const u=a.send;a.send=function(){const h=arguments[0],m=h.length||h.size||h.byteLength;if(a.readyState==="open"&&o.sctp&&m>o.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+o.sctp.maxMessageSize+" bytes)");return u.apply(a,arguments)}}const r=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const a=r.apply(this,arguments);return t(a,this),a},wp(e,"datachannel",(a=>(t(a.channel,a.target),a)))}function o1(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(r){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),r&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=r)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((r=>{const a=t[r];t[r]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=o=>{const u=o.target;if(u._lastConnectionState!==u.connectionState){u._lastConnectionState=u.connectionState;const h=new Event("connectionstatechange",o);u.dispatchEvent(h)}return o},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),a.apply(this,arguments)}}))}function c1(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(a){if(a&&a.sdp&&a.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const o=a.sdp.split(`
`).filter((u=>ki(u).call(u)!=="a=extmap-allow-mixed")).join(`
`);e.RTCSessionDescription&&a instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:a.type,sdp:o}):a.sdp=o}return r.apply(this,arguments)}}function qR(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype.addIceCandidate;r&&r.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Fe.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Fe.resolve())})}function XR(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype.setLocalDescription;r&&r.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let a=arguments[0]||{};if(typeof a!="object"||a.type&&a.sdp)return r.apply(this,arguments);if(a={type:a.type,sdp:a.sdp},!a.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":a.type="offer";break;default:a.type="answer"}return a.sdp||a.type!=="offer"&&a.type!=="answer"?r.apply(this,[a]):(a.type==="offer"?this.createOffer:this.createAnswer).apply(this).then((o=>r.apply(this,[o])))})}var Tre=Object.freeze({__proto__:null,removeExtmapAllowMixed:c1,shimAddIceCandidateNullOrEmpty:qR,shimConnectionState:o1,shimMaxMessageSize:KR,shimParameterlessSetLocalDescription:XR,shimRTCIceCandidate:zR,shimRTCIceCandidateRelayProtocol:s1,shimSendThrowTypeError:YR});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const r=LV,a=(function(u){const h={browser:null,version:null};if(u===void 0||!u.navigator)return h.browser="Not a browser.",h;const{navigator:m}=u;if(m.mozGetUserMedia)h.browser="firefox",h.version=WR(m.userAgent,/Firefox\/(\d+)\./,1);else if(m.webkitGetUserMedia||u.isSecureContext===!1&&u.webkitRTCPeerConnection)h.browser="chrome",h.version=WR(m.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!u.RTCPeerConnection||!m.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=WR(m.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=u.RTCRtpTransceiver&&"currentDirection"in u.RTCRtpTransceiver.prototype}return h})(e),o={browserDetails:a,commonShim:Tre,extractVersion:WR,disableLog:ore,disableWarnings:cre,sdp:bre};switch(a.browser){case"chrome":if(!XV||!n1||!t.shimChrome)return r("Chrome shim is not included in this adapter release."),o;if(a.version===null)return r("Chrome shim can not determine version, not shimming."),o;r("adapter.js shimming chrome."),o.browserShim=XV,qR(e,a),XR(e),BV(e,a),FV(e),n1(e,a),GV(e),YV(e,a),HV(e),WV(e),zV(e),qV(e,a),zR(e),s1(e),o1(e),KR(e,a),YR(e),c1(e,a);break;case"firefox":if(!s3||!r1||!t.shimFirefox)return r("Firefox shim is not included in this adapter release."),o;r("adapter.js shimming firefox."),o.browserShim=s3,qR(e,a),XR(e),JV(e,a),r1(e,a),$V(e),e3(e),ZV(e),QV(e),t3(e),n3(e),r3(e),i3(e),a3(e),zR(e),o1(e),KR(e,a),YR(e);break;case"safari":if(!g3||!t.shimSafari)return r("Safari shim is not included in this adapter release."),o;r("adapter.js shimming safari."),o.browserShim=g3,qR(e,a),XR(e),h3(e),p3(e),l3(e),o3(e),c3(e),f3(e),u3(e),m3(e),zR(e),s1(e),KR(e,a),YR(e),c1(e,a);break;default:r("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var l1=F;Jt({global:!0,forced:l1.globalThis!==l1},{globalThis:l1});var b3=f(F),u1={exports:{}};(function(e,t){(function(r,a){var o="function",u="undefined",h="object",m="string",g="major",y="model",E="name",A="type",O="vendor",N="version",B="architecture",U="console",V="mobile",K="tablet",z="smarttv",J="wearable",ae="embedded",ie="Amazon",ee="Apple",le="ASUS",ye="BlackBerry",we="Browser",Ne="Chrome",bt="Firefox",Rt="Google",ft="Huawei",Xt="LG",Wt="Microsoft",hi="Motorola",Te="Opera",Ue="Samsung",Je="Sharp",Re="Sony",M="Xiaomi",Q="Zebra",re="Facebook",De="Chromium OS",vt="Mac OS",mn=" Browser",fr=function(cr){for(var pr={},Cn=0;Cn<cr.length;Cn++)pr[cr[Cn].toUpperCase()]=cr[Cn];return pr},Js=function(cr,pr){return typeof cr===m&&Uo(pr).indexOf(Uo(cr))!==-1},Uo=function(cr){return cr.toLowerCase()},DS=function(cr,pr){if(typeof cr===m)return cr=cr.replace(/^\s\s*/,""),typeof pr===u?cr:cr.substring(0,500)},Zp=function(cr,pr){for(var Cn,xa,qc,tr,Xu,Ut,Xc=0;Xc<pr.length&&!Xu;){var Qp=pr[Xc],Wl=pr[Xc+1];for(Cn=xa=0;Cn<Qp.length&&!Xu&&Qp[Cn];)if(Xu=Qp[Cn++].exec(cr))for(qc=0;qc<Wl.length;qc++)Ut=Xu[++xa],typeof(tr=Wl[qc])===h&&tr.length>0?tr.length===2?typeof tr[1]==o?this[tr[0]]=tr[1].call(this,Ut):this[tr[0]]=tr[1]:tr.length===3?typeof tr[1]!==o||tr[1].exec&&tr[1].test?this[tr[0]]=Ut?Ut.replace(tr[1],tr[2]):a:this[tr[0]]=Ut?tr[1].call(this,Ut,tr[2]):a:tr.length===4&&(this[tr[0]]=Ut?tr[3].call(this,Ut.replace(tr[1],tr[2])):a):this[tr]=Ut||a;Xc+=2}},mv=function(cr,pr){for(var Cn in pr)if(typeof pr[Cn]===h&&pr[Cn].length>0){for(var xa=0;xa<pr[Cn].length;xa++)if(Js(pr[Cn][xa],cr))return Cn==="?"?a:Cn}else if(Js(pr[Cn],cr))return Cn==="?"?a:Cn;return pr.hasOwnProperty("*")?pr["*"]:cr},XA={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},JA={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[N,[E,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[N,[E,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[E,N],[/opios[\/ ]+([\w\.]+)/i],[N,[E,Te+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[N,[E,Te+" GX"]],[/\bopr\/([\w\.]+)/i],[N,[E,Te]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[N,[E,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[N,[E,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[E,N],[/quark(?:pc)?\/([-\w\.]+)/i],[N,[E,"Quark"]],[/\bddg\/([\w\.]+)/i],[N,[E,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[N,[E,"UC"+we]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[N,[E,"WeChat"]],[/konqueror\/([\w\.]+)/i],[N,[E,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[N,[E,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[N,[E,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[N,[E,"Smart Lenovo "+we]],[/(avast|avg)\/([\w\.]+)/i],[[E,/(.+)/,"$1 Secure "+we],N],[/\bfocus\/([\w\.]+)/i],[N,[E,bt+" Focus"]],[/\bopt\/([\w\.]+)/i],[N,[E,Te+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[N,[E,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[N,[E,"Dolphin"]],[/coast\/([\w\.]+)/i],[N,[E,Te+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[N,[E,"MIUI"+mn]],[/fxios\/([\w\.-]+)/i],[N,[E,bt]],[/\bqihoobrowser\/?([\w\.]*)/i],[N,[E,"360"]],[/\b(qq)\/([\w\.]+)/i],[[E,/(.+)/,"$1Browser"],N],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[E,/(.+)/,"$1"+mn],N],[/samsungbrowser\/([\w\.]+)/i],[N,[E,Ue+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[N,[E,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[E,"Sogou Mobile"],N],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[E,N],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[E],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[N,E],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[E,re],N],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[E,N],[/\bgsa\/([\w\.]+) .*safari\//i],[N,[E,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[N,[E,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[N,[E,Ne+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[E,Ne+" WebView"],N],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[N,[E,"Android "+we]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[E,N],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[N,[E,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[N,E],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[E,[N,mv,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[E,N],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[E,"Netscape"],N],[/(wolvic|librewolf)\/([\w\.]+)/i],[E,N],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[N,[E,bt+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[E,[N,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[E,[N,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[B,"amd64"]],[/(ia32(?=;))/i],[[B,Uo]],[/((?:i[346]|x)86)[;\)]/i],[[B,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[B,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[B,"armhf"]],[/windows (ce|mobile); ppc;/i],[[B,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[B,/ower/,"",Uo]],[/(sun4\w)[;\)]/i],[[B,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[B,Uo]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[y,[O,Ue],[A,K]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[y,[O,Ue],[A,V]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[y,[O,ee],[A,V]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[y,[O,ee],[A,K]],[/(macintosh);/i],[y,[O,ee]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[y,[O,Je],[A,V]],[/(?:honor)([-\w ]+)[;\)]/i],[y,[O,"Honor"],[A,V]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[y,[O,ft],[A,K]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[y,[O,ft],[A,V]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[y,/_/g," "],[O,M],[A,V]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[y,/_/g," "],[O,M],[A,K]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[y,[O,"OPPO"],[A,V]],[/\b(opd2\d{3}a?) bui/i],[y,[O,"OPPO"],[A,K]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[y,[O,"Vivo"],[A,V]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[y,[O,"Realme"],[A,V]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[y,[O,hi],[A,V]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[y,[O,hi],[A,K]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[y,[O,Xt],[A,K]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[y,[O,Xt],[A,V]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[y,[O,"Lenovo"],[A,K]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[y,/_/g," "],[O,"Nokia"],[A,V]],[/(pixel c)\b/i],[y,[O,Rt],[A,K]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[y,[O,Rt],[A,V]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[y,[O,Re],[A,V]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[y,"Xperia Tablet"],[O,Re],[A,K]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[y,[O,"OnePlus"],[A,V]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[y,[O,ie],[A,K]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[y,/(.+)/g,"Fire Phone $1"],[O,ie],[A,V]],[/(playbook);[-\w\),; ]+(rim)/i],[y,O,[A,K]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[y,[O,ye],[A,V]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[y,[O,le],[A,K]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[y,[O,le],[A,V]],[/(nexus 9)/i],[y,[O,"HTC"],[A,K]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[O,[y,/_/g," "],[A,V]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[y,[O,"TCL"],[A,K]],[/(itel) ((\w+))/i],[[O,Uo],y,[A,mv,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[y,[O,"Acer"],[A,K]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[y,[O,"Meizu"],[A,V]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[y,[O,"Ulefone"],[A,V]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[y,[O,"Energizer"],[A,V]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[y,[O,"Cat"],[A,V]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[y,[O,"Smartfren"],[A,V]],[/droid.+; (a(?:015|06[35]|142p?))/i],[y,[O,"Nothing"],[A,V]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[O,y,[A,V]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[O,y,[A,K]],[/(surface duo)/i],[y,[O,Wt],[A,K]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[y,[O,"Fairphone"],[A,V]],[/(u304aa)/i],[y,[O,"AT&T"],[A,V]],[/\bsie-(\w*)/i],[y,[O,"Siemens"],[A,V]],[/\b(rct\w+) b/i],[y,[O,"RCA"],[A,K]],[/\b(venue[\d ]{2,7}) b/i],[y,[O,"Dell"],[A,K]],[/\b(q(?:mv|ta)\w+) b/i],[y,[O,"Verizon"],[A,K]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[y,[O,"Barnes & Noble"],[A,K]],[/\b(tm\d{3}\w+) b/i],[y,[O,"NuVision"],[A,K]],[/\b(k88) b/i],[y,[O,"ZTE"],[A,K]],[/\b(nx\d{3}j) b/i],[y,[O,"ZTE"],[A,V]],[/\b(gen\d{3}) b.+49h/i],[y,[O,"Swiss"],[A,V]],[/\b(zur\d{3}) b/i],[y,[O,"Swiss"],[A,K]],[/\b((zeki)?tb.*\b) b/i],[y,[O,"Zeki"],[A,K]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[O,"Dragon Touch"],y,[A,K]],[/\b(ns-?\w{0,9}) b/i],[y,[O,"Insignia"],[A,K]],[/\b((nxa|next)-?\w{0,9}) b/i],[y,[O,"NextBook"],[A,K]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[O,"Voice"],y,[A,V]],[/\b(lvtel\-)?(v1[12]) b/i],[[O,"LvTel"],y,[A,V]],[/\b(ph-1) /i],[y,[O,"Essential"],[A,V]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[y,[O,"Envizen"],[A,K]],[/\b(trio[-\w\. ]+) b/i],[y,[O,"MachSpeed"],[A,K]],[/\btu_(1491) b/i],[y,[O,"Rotor"],[A,K]],[/(shield[\w ]+) b/i],[y,[O,"Nvidia"],[A,K]],[/(sprint) (\w+)/i],[O,y,[A,V]],[/(kin\.[onetw]{3})/i],[[y,/\./g," "],[O,Wt],[A,V]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[y,[O,Q],[A,K]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[y,[O,Q],[A,V]],[/smart-tv.+(samsung)/i],[O,[A,z]],[/hbbtv.+maple;(\d+)/i],[[y,/^/,"SmartTV"],[O,Ue],[A,z]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[O,Xt],[A,z]],[/(apple) ?tv/i],[O,[y,ee+" TV"],[A,z]],[/crkey/i],[[y,Ne+"cast"],[O,Rt],[A,z]],[/droid.+aft(\w+)( bui|\))/i],[y,[O,ie],[A,z]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[y,[O,Je],[A,z]],[/(bravia[\w ]+)( bui|\))/i],[y,[O,Re],[A,z]],[/(mitv-\w{5}) bui/i],[y,[O,M],[A,z]],[/Hbbtv.*(technisat) (.*);/i],[O,y,[A,z]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[O,DS],[y,DS],[A,z]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[A,z]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[O,y,[A,U]],[/droid.+; (shield) bui/i],[y,[O,"Nvidia"],[A,U]],[/(playstation [345portablevi]+)/i],[y,[O,Re],[A,U]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[y,[O,Wt],[A,U]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[y,[O,Ue],[A,J]],[/((pebble))app/i],[O,y,[A,J]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[y,[O,ee],[A,J]],[/droid.+; (glass) \d/i],[y,[O,Rt],[A,J]],[/droid.+; (wt63?0{2,3})\)/i],[y,[O,Q],[A,J]],[/droid.+; (glass) \d/i],[y,[O,Rt],[A,J]],[/(pico) (4|neo3(?: link|pro)?)/i],[O,y,[A,J]],[/; (quest( \d| pro)?)/i],[y,[O,re],[A,J]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[O,[A,ae]],[/(aeobc)\b/i],[y,[O,ie],[A,ae]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[y,[A,V]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[y,[A,K]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[A,K]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[A,V]],[/(android[-\w\. ]{0,9});.+buil/i],[y,[O,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[N,[E,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[E,N],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[N,[E,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[E,N],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[N,E]],os:[[/microsoft (windows) (vista|xp)/i],[E,N],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[E,[N,mv,XA]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[N,mv,XA],[E,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[N,/_/g,"."],[E,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[E,vt],[N,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[N,E],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[E,N],[/\(bb(10);/i],[N,[E,ye]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[N,[E,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[N,[E,bt+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[N,[E,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[N,[E,"watchOS"]],[/crkey\/([\d\.]+)/i],[N,[E,Ne+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[E,De],N],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[E,N],[/(sunos) ?([\w\.\d]*)/i],[[E,"Solaris"],N],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[E,N]]},$s=function(cr,pr){if(typeof cr===h&&(pr=cr,cr=a),!(this instanceof $s))return new $s(cr,pr).getResult();var Cn=typeof r!==u&&r.navigator?r.navigator:a,xa=cr||(Cn&&Cn.userAgent?Cn.userAgent:""),qc=Cn&&Cn.userAgentData?Cn.userAgentData:a,tr=pr?(function(Ut,Xc){var Qp={};for(var Wl in Ut)Xc[Wl]&&Xc[Wl].length%2==0?Qp[Wl]=Xc[Wl].concat(Ut[Wl]):Qp[Wl]=Ut[Wl];return Qp})(JA,pr):JA,Xu=Cn&&Cn.userAgent==xa;return this.getBrowser=function(){var Ut={};return Ut[E]=a,Ut[N]=a,Zp.call(Ut,xa,tr.browser),Ut[g]=(function(Xc){return typeof Xc===m?Xc.replace(/[^\d\.]/g,"").split(".")[0]:a})(Ut[N]),Xu&&Cn&&Cn.brave&&typeof Cn.brave.isBrave==o&&(Ut[E]="Brave"),Ut},this.getCPU=function(){var Ut={};return Ut[B]=a,Zp.call(Ut,xa,tr.cpu),Ut},this.getDevice=function(){var Ut={};return Ut[O]=a,Ut[y]=a,Ut[A]=a,Zp.call(Ut,xa,tr.device),Xu&&!Ut[A]&&qc&&qc.mobile&&(Ut[A]=V),Xu&&Ut[y]=="Macintosh"&&Cn&&typeof Cn.standalone!==u&&Cn.maxTouchPoints&&Cn.maxTouchPoints>2&&(Ut[y]="iPad",Ut[A]=K),Ut},this.getEngine=function(){var Ut={};return Ut[E]=a,Ut[N]=a,Zp.call(Ut,xa,tr.engine),Ut},this.getOS=function(){var Ut={};return Ut[E]=a,Ut[N]=a,Zp.call(Ut,xa,tr.os),Xu&&!Ut[E]&&qc&&qc.platform&&qc.platform!="Unknown"&&(Ut[E]=qc.platform.replace(/chrome os/i,De).replace(/macos/i,vt)),Ut},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return xa},this.setUA=function(Ut){return xa=typeof Ut===m&&Ut.length>500?DS(Ut,500):Ut,this},this.setUA(xa),this};$s.VERSION="0.7.40",$s.BROWSER=fr([E,N,g]),$s.CPU=fr([B]),$s.DEVICE=fr([y,O,A,U,V,z,K,J,ae]),$s.ENGINE=$s.OS=fr([E,N]),e.exports&&(t=e.exports=$s),t.UAParser=$s;var qu=typeof r!==u&&(r.jQuery||r.Zepto);if(qu&&!qu.ua){var $A=new $s;qu.ua=$A.getResult(),qu.ua.get=function(){return $A.getUA()},qu.ua.set=function(cr){$A.setUA(cr);var pr=$A.getResult();for(var Cn in pr)qu.ua[Cn]=pr[Cn]}}})(typeof window=="object"?window:c)})(u1,u1.exports);var wre=f(u1.exports),T3=On.clear;Jt({global:!0,bind:!0,forced:F.clearImmediate!==T3},{clearImmediate:T3});var w3=F,Rre=Z,Cre=be,Are=rg,Ore=co,Ire=zi,Nre=vl,xre=w3.Function,Dre=/MSIE .\./.test(Ore)||Are==="BUN"&&(function(){var e=w3.Bun.version.split(".");return e.length<3||e[0]==="0"&&(e[1]<3||e[1]==="3"&&e[2]==="0")})(),Pre=Jt,R3=F,C3=On.set,kre=function(e,t){var r=1;return Dre?function(a,o){var u=Nre(arguments.length,1)>r,h=Cre(a)?a:xre(a),m=u?Ire(arguments,r):[],g=u?function(){Rre(h,this,m)}:h;return e(g)}:e},A3=R3.setImmediate?kre(C3):C3;Pre({global:!0,bind:!0,forced:R3.setImmediate!==A3},{setImmediate:A3});var O3=f(ra.setImmediate),Lre=F,Mre=UE,Ure=_a,jre=vl,Vre=et;Jt({global:!0,dontCallGetSet:!0,forced:p((function(){return Vre&&Object.getOwnPropertyDescriptor(Lre,"queueMicrotask").value.length!==1}))},{queueMicrotask:function(e){jre(arguments.length,1),Mre(Ure(e))}});var I3=f(ra.queueMicrotask);function N3(e,t){return function(){return e.apply(t,arguments)}}const{toString:Bre}=Object.prototype,{getPrototypeOf:d1}=Object,{iterator:JR,toStringTag:x3}=Symbol,$R=(h1=Object.create(null),e=>{const t=Bre.call(e);return h1[t]||(h1[t]=t.slice(8,-1).toLowerCase())});var h1;const Pc=e=>(e=e.toLowerCase(),t=>$R(t)===e),ZR=e=>t=>typeof t===e,{isArray:T_}=Array,I0=ZR("undefined"),D3=Pc("ArrayBuffer"),Fre=ZR("string"),ms=ZR("function"),P3=ZR("number"),QR=e=>e!==null&&typeof e=="object",eC=e=>{if($R(e)!=="object")return!1;const t=d1(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||x3 in e||JR in e)},Gre=Pc("Date"),Hre=Pc("File"),Wre=Pc("Blob"),zre=Pc("FileList"),Kre=Pc("URLSearchParams"),[Yre,qre,Xre,Jre]=["ReadableStream","Request","Response","Headers"].map(Pc);function N0(e,t){let r,a,{allOwnKeys:o=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),T_(e))for(r=0,a=e.length;r<a;r++)t.call(null,e[r],r,e);else{const u=o?Object.getOwnPropertyNames(e):Object.keys(e),h=u.length;let m;for(r=0;r<h;r++)m=u[r],t.call(null,e[m],m,e)}}function k3(e,t){t=t.toLowerCase();const r=Object.keys(e);let a,o=r.length;for(;o-- >0;)if(a=r[o],t===a.toLowerCase())return a;return null}const Rp=b3!==void 0?b3:typeof self<"u"?self:typeof window<"u"?window:ck,L3=e=>!I0(e)&&e!==Rp,$re=(f1=typeof Uint8Array<"u"&&d1(Uint8Array),e=>f1&&e instanceof f1);var f1;const Zre=Pc("HTMLFormElement"),M3=(e=>{let{hasOwnProperty:t}=e;return(r,a)=>t.call(r,a)})(Object.prototype),Qre=Pc("RegExp"),U3=(e,t)=>{const r=Object.getOwnPropertyDescriptors(e),a={};N0(r,((o,u)=>{let h;(h=t(o,u,e))!==!1&&(a[u]=h||o)})),Object.defineProperties(e,a)},eie=Pc("AsyncFunction"),j3=(V3=typeof O3=="function",B3=ms(Rp.postMessage),V3?O3:B3?(p1="axios@".concat(Math.random()),tC=[],Rp.addEventListener("message",(e=>{let{source:t,data:r}=e;t===Rp&&r===p1&&tC.length&&tC.shift()()}),!1),e=>{tC.push(e),Rp.postMessage(p1,"*")}):e=>setTimeout(e));var V3,B3,p1,tC;const tie=I3!==void 0?I3.bind(Rp):typeof process<"u"&&process.nextTick||j3;var Ge={isArray:T_,isArrayBuffer:D3,isBuffer:function(e){return e!==null&&!I0(e)&&e.constructor!==null&&!I0(e.constructor)&&ms(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||ms(e.append)&&((t=$R(e))==="formdata"||t==="object"&&ms(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&D3(e.buffer),t},isString:Fre,isNumber:P3,isBoolean:e=>e===!0||e===!1,isObject:QR,isPlainObject:eC,isReadableStream:Yre,isRequest:qre,isResponse:Xre,isHeaders:Jre,isUndefined:I0,isDate:Gre,isFile:Hre,isBlob:Wre,isRegExp:Qre,isFunction:ms,isStream:e=>QR(e)&&ms(e.pipe),isURLSearchParams:Kre,isTypedArray:$re,isFileList:zre,forEach:N0,merge:function e(){const{caseless:t}=L3(this)&&this||{},r={},a=(o,u)=>{const h=t&&k3(r,u)||u;eC(r[h])&&eC(o)?r[h]=e(r[h],o):eC(o)?r[h]=e({},o):T_(o)?r[h]=o.slice():r[h]=o};for(let o=0,u=arguments.length;o<u;o++)arguments[o]&&N0(arguments[o],a);return r},extend:function(e,t,r){let{allOwnKeys:a}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return N0(t,((o,u)=>{r&&ms(o)?e[u]=N3(o,r):e[u]=o}),{allOwnKeys:a}),e},trim:e=>ki(e)?ki(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,r,a)=>{e.prototype=Object.create(t.prototype,a),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},toFlatObject:(e,t,r,a)=>{let o,u,h;const m={};if(t=t||{},e==null)return t;do{for(o=Object.getOwnPropertyNames(e),u=o.length;u-- >0;)h=o[u],a&&!a(h,e,t)||m[h]||(t[h]=e[h],m[h]=!0);e=r!==!1&&d1(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},kindOf:$R,kindOfTest:Pc,endsWith:(e,t,r)=>{e=String(e),(r===void 0||r>e.length)&&(r=e.length),r-=t.length;const a=e.indexOf(t,r);return a!==-1&&a===r},toArray:e=>{if(!e)return null;if(T_(e))return e;let t=e.length;if(!P3(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},forEachEntry:(e,t)=>{const r=(e&&e[JR]).call(e);let a;for(;(a=r.next())&&!a.done;){const o=a.value;t.call(e,o[0],o[1])}},matchAll:(e,t)=>{let r;const a=[];for(;(r=e.exec(t))!==null;)a.push(r);return a},isHTMLForm:Zre,hasOwnProperty:M3,hasOwnProp:M3,reduceDescriptors:U3,freezeMethods:e=>{U3(e,((t,r)=>{if(ms(e)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const a=e[r];ms(a)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")}))}))},toObjectSet:(e,t)=>{const r={},a=o=>{o.forEach((u=>{r[u]=!0}))};return T_(e)?a(e):a(String(e).split(t)),r},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(t,r,a){return r.toUpperCase()+a})),noop:()=>{},toFiniteNumber:(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,findKey:k3,global:Rp,isContextDefined:L3,isSpecCompliantForm:function(e){return!!(e&&ms(e.append)&&e[x3]==="FormData"&&e[JR])},toJSONObject:e=>{const t=new Array(10),r=(a,o)=>{if(QR(a)){if(t.indexOf(a)>=0)return;if(!("toJSON"in a)){t[o]=a;const u=T_(a)?[]:{};return N0(a,((h,m)=>{const g=r(h,o+1);!I0(g)&&(u[m]=g)})),t[o]=void 0,u}}return a};return r(e,0)},isAsyncFn:eie,isThenable:e=>e&&(QR(e)||ms(e))&&ms(e.then)&&ms(e.catch),setImmediate:j3,asap:tie,isIterable:e=>e!=null&&ms(e[JR])};function cn(e,t,r,a,o){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),a&&(this.request=a),o&&(this.response=o,this.status=o.status?o.status:null)}Ge.inherits(cn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ge.toJSONObject(this.config),code:this.code,status:this.status}}});const F3=cn.prototype,G3={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{G3[e]={value:e}})),Object.defineProperties(cn,G3),Object.defineProperty(F3,"isAxiosError",{value:!0}),cn.from=(e,t,r,a,o,u)=>{const h=Object.create(F3);return Ge.toFlatObject(e,h,(function(m){return m!==Error.prototype}),(m=>m!=="isAxiosError")),cn.call(h,e.message,t,r,a,o),h.cause=e,h.name=e.name,u&&Object.assign(h,u),h};function m1(e){return Ge.isPlainObject(e)||Ge.isArray(e)}function H3(e){return Ge.endsWith(e,"[]")?e.slice(0,-2):e}function W3(e,t,r){return e?e.concat(t).map((function(a,o){return a=H3(a),!r&&o?"["+a+"]":a})).join(r?".":""):t}const nie=Ge.toFlatObject(Ge,{},null,(function(e){return/^is[A-Z]/.test(e)}));function nC(e,t,r){if(!Ge.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const a=(r=Ge.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(O,N){return!Ge.isUndefined(N[O])}))).metaTokens,o=r.visitor||y,u=r.dots,h=r.indexes,m=(r.Blob||typeof Blob<"u"&&Blob)&&Ge.isSpecCompliantForm(t);if(!Ge.isFunction(o))throw new TypeError("visitor must be a function");function g(O){if(O===null)return"";if(Ge.isDate(O))return O.toISOString();if(!m&&Ge.isBlob(O))throw new cn("Blob is not supported. Use a Buffer instead.");return Ge.isArrayBuffer(O)||Ge.isTypedArray(O)?m&&typeof Blob=="function"?new Blob([O]):Buffer.from(O):O}function y(O,N,B){let U=O;if(O&&!B&&typeof O=="object"){if(Ge.endsWith(N,"{}"))N=a?N:N.slice(0,-2),O=JSON.stringify(O);else if(Ge.isArray(O)&&(function(V){return Ge.isArray(V)&&!V.some(m1)})(O)||(Ge.isFileList(O)||Ge.endsWith(N,"[]"))&&(U=Ge.toArray(O)))return N=H3(N),U.forEach((function(V,K){!Ge.isUndefined(V)&&V!==null&&t.append(h===!0?W3([N],K,u):h===null?N:N+"[]",g(V))})),!1}return!!m1(O)||(t.append(W3(B,N,u),g(O)),!1)}const E=[],A=Object.assign(nie,{defaultVisitor:y,convertValue:g,isVisitable:m1});if(!Ge.isObject(e))throw new TypeError("data must be an object");return(function O(N,B){if(!Ge.isUndefined(N)){if(E.indexOf(N)!==-1)throw Error("Circular reference detected in "+B.join("."));E.push(N),Ge.forEach(N,(function(U,V){(!(Ge.isUndefined(U)||U===null)&&o.call(t,U,Ge.isString(V)?ki(V).call(V):V,B,A))===!0&&O(U,B?B.concat(V):[V])})),E.pop()}})(e),t}function z3(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(r){return t[r]}))}function g1(e,t){this._pairs=[],e&&nC(e,this,t)}const K3=g1.prototype;function rie(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Y3(e,t,r){if(!t)return e;const a=r&&r.encode||rie;Ge.isFunction(r)&&(r={serialize:r});const o=r&&r.serialize;let u;if(u=o?o(t,r):Ge.isURLSearchParams(t)?t.toString():new g1(t,r).toString(a),u){const h=e.indexOf("#");h!==-1&&(e=e.slice(0,h)),e+=(e.indexOf("?")===-1?"?":"&")+u}return e}K3.append=function(e,t){this._pairs.push([e,t])},K3.toString=function(e){const t=e?function(r){return e.call(this,r,z3)}:z3;return this._pairs.map((function(r){return t(r[0])+"="+t(r[1])}),"").join("&")};var q3=class{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Ge.forEach(this.handlers,(function(t){t!==null&&e(t)}))}},X3={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},J3={exports:{}},iie=Jt,aie=et,$3=_i.f;iie({target:"Object",stat:!0,forced:Object.defineProperty!==$3,sham:!aie},{defineProperty:$3});var Z3=ra.Object,sie=J3.exports=function(e,t,r){return Z3.defineProperty(e,t,r)};Z3.defineProperty.sham&&(sie.sham=!0);var Q3=f(J3.exports),oie=TypeError,e4=Vd,cie=wr,lie=Ur,uie=qn("species"),t4=Array,die=function(e){var t;return e4(e)&&(t=e.constructor,(cie(t)&&(t===t4||e4(t.prototype))||lie(t)&&(t=t[uie])===null)&&(t=void 0)),t===void 0?t4:t},n4=function(e,t){return new(die(e))(t===0?0:t)},hie=p,fie=si,pie=qn("species"),r4=function(e){return fie>=51||!hie((function(){var t=[];return(t.constructor={})[pie]=function(){return{foo:1}},t[e](Boolean).foo!==1}))},mie=Jt,gie=p,_ie=Vd,vie=Ur,yie=ya,Eie=Ua,i4=function(e){if(e>9007199254740991)throw oie("Maximum allowed index exceeded");return e},a4=Dx,Sie=n4,bie=r4,Tie=si,s4=qn("isConcatSpreadable"),wie=Tie>=51||!gie((function(){var e=[];return e[s4]=!1,e.concat()[0]!==e})),Rie=function(e){if(!vie(e))return!1;var t=e[s4];return t!==void 0?!!t:_ie(e)};mie({target:"Array",proto:!0,forced:!wie||!bie("concat")},{concat:function(e){var t,r,a,o,u,h=yie(this),m=Sie(h,0),g=0;for(t=-1,a=arguments.length;t<a;t++)if(Rie(u=t===-1?h:arguments[t]))for(o=Eie(u),i4(g+o),r=0;r<o;r++,g++)r in u&&a4(m,g,u[r]);else i4(g+1),a4(m,g++,u);return m.length=g,m}});var o4={},Cie=oe,Aie=gr,c4=ls.f,Oie=zi,l4=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];o4.f=function(e){return l4&&Cie(e)==="Window"?(function(t){try{return c4(t)}catch{return Oie(l4)}})(e):c4(Aie(e))};var w_={},Iie=qn;w_.f=Iie;var u4=ra,Nie=jr,xie=w_,Die=_i.f,Fr=function(e){var t=u4.Symbol||(u4.Symbol={});Nie(t,e)||Die(t,e,{value:xie.f(e)})},Pie=_e,kie=Yn,Lie=qn,Mie=pc,d4=function(){var e=kie("Symbol"),t=e&&e.prototype,r=t&&t.valueOf,a=Lie("toPrimitive");t&&!t[a]&&Mie(t,a,(function(o){return Pie(r,this)}),{})},Uie=Vr,jie=qe,Vie=ya,Bie=Ua,Fie=n4,h4=I([].push),Gie=function(e){var t=e===1,r=e===2,a=e===3,o=e===4,u=e===6,h=e===7,m=e===5||u;return function(g,y,E,A){for(var O,N,B=Vie(g),U=jie(B),V=Bie(U),K=Uie(y,E),z=0,J=A||Fie,ae=t?J(g,V):r||h?J(g,0):void 0;V>z;z++)if((m||z in U)&&(N=K(O=U[z],z,B),e))if(t)ae[z]=N;else if(N)switch(e){case 3:return!0;case 5:return O;case 6:return z;case 2:h4(ae,O)}else switch(e){case 4:return!1;case 7:h4(ae,O)}return u?-1:a||o?o:ae}},f4={forEach:Gie(0)},rC=Jt,x0=F,_1=_e,Hie=I,R_=et,C_=Sd,Wie=p,Yi=jr,zie=D,v1=Ii,iC=gr,y1=jm,Kie=Hi,E1=dt,A_=vu,p4=mu,Yie=ls,m4=o4,qie=Ff,g4=Le,_4=_i,Xie=og,v4=ze,y4=pc,Jie=np,S1=il,E4=Gd,S4=km,$ie=qn,Zie=w_,Qie=Fr,eae=d4,tae=po,b4=fc,aC=f4.forEach,gs=Mf("hidden"),sC="Symbol",D0="prototype",nae=b4.set,T4=b4.getterFor(sC),kc=Object[D0],Cp=x0.Symbol,oC=Cp&&Cp[D0],rae=x0.RangeError,iae=x0.TypeError,b1=x0.QObject,w4=g4.f,Ap=_4.f,R4=m4.f,aae=v4.f,C4=Hie([].push),Mu=S1("symbols"),P0=S1("op-symbols"),sae=S1("wks"),T1=!b1||!b1[D0]||!b1[D0].findChild,A4=function(e,t,r){var a=w4(kc,t);a&&delete kc[t],Ap(e,t,r),a&&e!==kc&&Ap(kc,t,a)},w1=R_&&Wie((function(){return A_(Ap({},"a",{get:function(){return Ap(this,"a",{value:7}).a}})).a!==7}))?A4:Ap,R1=function(e,t){var r=Mu[e]=A_(oC);return nae(r,{type:sC,tag:e,description:t}),R_||(r.description=t),r},cC=function(e,t,r){e===kc&&cC(P0,t,r),v1(e);var a=y1(t);return v1(r),Yi(Mu,a)?(r.enumerable?(Yi(e,gs)&&e[gs][a]&&(e[gs][a]=!1),r=A_(r,{enumerable:E1(0,!1)})):(Yi(e,gs)||Ap(e,gs,E1(1,A_(null))),e[gs][a]=!0),w1(e,a,r)):Ap(e,a,r)},C1=function(e,t){v1(e);var r=iC(t),a=p4(r).concat(x4(r));return aC(a,(function(o){R_&&!_1(O4,r,o)||cC(e,o,r[o])})),e},O4=function(e){var t=y1(e),r=_1(aae,this,t);return!(this===kc&&Yi(Mu,t)&&!Yi(P0,t))&&(!(r||!Yi(this,t)||!Yi(Mu,t)||Yi(this,gs)&&this[gs][t])||r)},I4=function(e,t){var r=iC(e),a=y1(t);if(r!==kc||!Yi(Mu,a)||Yi(P0,a)){var o=w4(r,a);return!o||!Yi(Mu,a)||Yi(r,gs)&&r[gs][a]||(o.enumerable=!0),o}},N4=function(e){var t=R4(iC(e)),r=[];return aC(t,(function(a){Yi(Mu,a)||Yi(E4,a)||C4(r,a)})),r},x4=function(e){var t=e===kc,r=R4(t?P0:iC(e)),a=[];return aC(r,(function(o){!Yi(Mu,o)||t&&!Yi(kc,o)||C4(a,Mu[o])})),a};C_||(Cp=function(){if(zie(oC,this))throw new iae("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?Kie(arguments[0]):void 0,t=S4(e),r=function(a){var o=this===void 0?x0:this;o===kc&&_1(r,P0,a),Yi(o,gs)&&Yi(o[gs],t)&&(o[gs][t]=!1);var u=E1(1,a);try{w1(o,t,u)}catch(h){if(!(h instanceof rae))throw h;A4(o,t,u)}};return R_&&T1&&w1(kc,t,{configurable:!0,set:r}),R1(t,e)},y4(oC=Cp[D0],"toString",(function(){return T4(this).tag})),y4(Cp,"withoutSetter",(function(e){return R1(S4(e),e)})),v4.f=O4,_4.f=cC,Xie.f=C1,g4.f=I4,Yie.f=m4.f=N4,qie.f=x4,Zie.f=function(e){return R1($ie(e),e)},R_&&Jie(oC,"description",{configurable:!0,get:function(){return T4(this).description}})),rC({global:!0,wrap:!0,forced:!C_,sham:!C_},{Symbol:Cp}),aC(p4(sae),(function(e){Qie(e)})),rC({target:sC,stat:!0,forced:!C_},{useSetter:function(){T1=!0},useSimple:function(){T1=!1}}),rC({target:"Object",stat:!0,forced:!C_,sham:!R_},{create:function(e,t){return t===void 0?A_(e):C1(A_(e),t)},defineProperty:cC,defineProperties:C1,getOwnPropertyDescriptor:I4}),rC({target:"Object",stat:!0,forced:!C_},{getOwnPropertyNames:N4}),eae(),tae(Cp,sC),E4[gs]=!0;var D4=Sd&&!!Symbol.for&&!!Symbol.keyFor,oae=Jt,cae=Yn,lae=jr,uae=Hi,P4=il,dae=D4,A1=P4("string-to-symbol-registry"),hae=P4("symbol-to-string-registry");oae({target:"Symbol",stat:!0,forced:!dae},{for:function(e){var t=uae(e);if(lae(A1,t))return A1[t];var r=cae("Symbol")(t);return A1[t]=r,hae[r]=t,r}});var fae=Jt,pae=jr,mae=rl,gae=bd,_ae=D4,k4=il("symbol-to-string-registry");fae({target:"Symbol",stat:!0,forced:!_ae},{keyFor:function(e){if(!mae(e))throw new TypeError(gae(e)+" is not a symbol");if(pae(k4,e))return k4[e]}});var L4=Vd,vae=be,M4=oe,yae=Hi,U4=I([].push),Eae=Jt,j4=Yn,V4=Z,Sae=_e,k0=I,B4=p,F4=be,G4=rl,H4=zi,bae=function(e){if(vae(e))return e;if(L4(e)){for(var t=e.length,r=[],a=0;a<t;a++){var o=e[a];typeof o=="string"?U4(r,o):typeof o!="number"&&M4(o)!=="Number"&&M4(o)!=="String"||U4(r,yae(o))}var u=r.length,h=!0;return function(m,g){if(h)return h=!1,g;if(L4(this))return g;for(var y=0;y<u;y++)if(r[y]===m)return g}}},Tae=Sd,wae=String,Ih=j4("JSON","stringify"),lC=k0(/./.exec),W4=k0("".charAt),Rae=k0("".charCodeAt),Cae=k0("".replace),Aae=k0(1 .toString),Oae=/[\uD800-\uDFFF]/g,z4=/^[\uD800-\uDBFF]$/,K4=/^[\uDC00-\uDFFF]$/,Y4=!Tae||B4((function(){var e=j4("Symbol")("stringify detection");return Ih([e])!=="[null]"||Ih({a:e})!=="{}"||Ih(Object(e))!=="{}"})),q4=B4((function(){return Ih("\uDF06\uD834")!=='"\\udf06\\ud834"'||Ih("\uDEAD")!=='"\\udead"'})),Iae=function(e,t){var r=H4(arguments),a=bae(t);if(F4(a)||e!==void 0&&!G4(e))return r[1]=function(o,u){if(F4(a)&&(u=Sae(a,this,wae(o),u)),!G4(u))return u},V4(Ih,null,r)},Nae=function(e,t,r){var a=W4(r,t-1),o=W4(r,t+1);return lC(z4,e)&&!lC(K4,o)||lC(K4,e)&&!lC(z4,a)?"\\u"+Aae(Rae(e,0),16):e};Ih&&Eae({target:"JSON",stat:!0,forced:Y4||q4},{stringify:function(e,t,r){var a=H4(arguments),o=V4(Y4?Iae:Ih,null,a);return q4&&typeof o=="string"?Cae(o,Oae,Nae):o}});var X4=Ff,xae=ya;Jt({target:"Object",stat:!0,forced:!Sd||p((function(){X4.f(1)}))},{getOwnPropertySymbols:function(e){var t=X4.f;return t?t(xae(e)):[]}}),Fr("asyncIterator"),Fr("hasInstance"),Fr("isConcatSpreadable"),Fr("iterator"),Fr("match"),Fr("matchAll"),Fr("replace"),Fr("search"),Fr("species"),Fr("split");var Dae=d4;Fr("toPrimitive"),Dae();var Pae=Yn,kae=po;Fr("toStringTag"),kae(Pae("Symbol"),"Symbol"),Fr("unscopables"),po(F.JSON,"JSON",!0);var Lae=ra.Symbol,Mae=qn,Uae=_i.f,J4=Mae("metadata"),$4=Function.prototype;$4[J4]===void 0&&Uae($4,J4,{value:null}),Fr("asyncDispose"),Fr("dispose"),Fr("metadata");var jae=Lae,Vae=I,O1=Yn("Symbol"),Bae=O1.keyFor,Fae=Vae(O1.prototype.valueOf),Z4=O1.isRegisteredSymbol||function(e){try{return Bae(Fae(e))!==void 0}catch{return!1}};Jt({target:"Symbol",stat:!0},{isRegisteredSymbol:Z4});for(var Gae=il,Q4=Yn,Hae=I,Wae=rl,zae=qn,uC=Q4("Symbol"),eB=uC.isWellKnownSymbol,tB=Q4("Object","getOwnPropertyNames"),Kae=Hae(uC.prototype.valueOf),nB=Gae("wks"),I1=0,rB=tB(uC),Yae=rB.length;I1<Yae;I1++)try{var iB=rB[I1];Wae(uC[iB])&&zae(iB)}catch{}var aB=function(e){if(eB&&eB(e))return!0;try{for(var t=Kae(e),r=0,a=tB(nB),o=a.length;r<o;r++)if(nB[a[r]]==t)return!0}catch{}return!1};Jt({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:aB}),Fr("customMatcher"),Fr("observable"),Jt({target:"Symbol",stat:!0},{isRegistered:Z4}),Jt({target:"Symbol",stat:!0,forced:!0},{isWellKnown:aB}),Fr("matcher"),Fr("metadataKey"),Fr("patternMatch"),Fr("replaceAll");var O_=f(jae),sB=f(w_.f("iterator"));function L0(e){return L0=typeof O_=="function"&&typeof sB=="symbol"?function(t){return typeof t}:function(t){return t&&typeof O_=="function"&&t.constructor===O_&&t!==O_.prototype?"symbol":typeof t},L0(e)}var qae=f(w_.f("toPrimitive"));function Xae(e){var t=(function(r,a){if(L0(r)!="object"||!r)return r;var o=r[qae];if(o!==void 0){var u=o.call(r,a);if(L0(u)!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(r)})(e,"string");return L0(t)=="symbol"?t:t+""}function H(e,t,r){return(t=Xae(t))in e?Q3(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var oB=f(Xte),Jae={isBrowser:!0,classes:{URLSearchParams:oB!==void 0?oB:g1,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const N1=typeof window<"u"&&typeof document<"u",x1=typeof navigator=="object"&&navigator||void 0,$ae=N1&&(!x1||["ReactNative","NativeScript","NS"].indexOf(x1.product)<0),Zae=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Qae=N1&&window.location.href||"http://localhost";function cB(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),r.push.apply(r,a)}return r}function lB(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?cB(Object(r),!0).forEach((function(a){H(e,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):cB(Object(r)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))}))}return e}var Ra=lB(lB({},Object.freeze({__proto__:null,hasBrowserEnv:N1,hasStandardBrowserEnv:$ae,hasStandardBrowserWebWorkerEnv:Zae,navigator:x1,origin:Qae})),Jae),ese=Ii,tse=_e,nse=jr,rse=D,ise=function(){var e=ese(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},uB=RegExp.prototype,dB=function(e){var t=e.flags;return t!==void 0||"flags"in uB||nse(e,"flags")||!rse(uB,e)?t:tse(ise,e)},ase=h0.charAt,hB=_e,sse=Ii,ose=be,cse=oe,lse=/./.exec,use=TypeError,dse=Jt,fB=_e,pB=ke,hse=Ag,dC=ep,mB=br,gB=wy,M0=Hi,fse=Ii,pse=Ur,mse=oe,gse=Oy,_B=dB,_se=Ef,vse=p,yse=Wi,Ese=function(e,t,r){return t+(r?ase(e,t).length:1)},Sse=function(e,t){var r=e.exec;if(ose(r)){var a=hB(r,e,t);return a!==null&&sse(a),a}if(cse(e)==="RegExp")return hB(lse,e,t);throw new use("RegExp#exec called on incompatible receiver")},vB=fc,bse=qn("matchAll"),yB="RegExp String",EB=yB+" Iterator",Tse=vB.set,wse=vB.getterFor(EB),Rse=TypeError,D1=pB("".indexOf),hC=pB("".matchAll),P1=!!hC&&!vse((function(){hC("a",/./)})),Cse=hse((function(e,t,r,a){Tse(this,{type:EB,regexp:e,string:t,global:r,unicode:a,done:!1})}),yB,(function(){var e=wse(this);if(e.done)return dC(void 0,!0);var t=e.regexp,r=e.string,a=Sse(t,r);return a===null?(e.done=!0,dC(void 0,!0)):e.global?(M0(a[0])===""&&(t.lastIndex=Ese(r,gB(t.lastIndex),e.unicode)),dC(a,!1)):(e.done=!0,dC(a,!1))})),SB=function(e){var t,r,a,o=fse(this),u=M0(e),h=yse(o,RegExp),m=M0(_B(o));return t=new h(h===RegExp?o.source:o,m),r=!!~D1(m,"g"),a=!!~D1(m,"u"),t.lastIndex=gB(o.lastIndex),new Cse(t,u,r,a)};dse({target:"String",proto:!0,forced:P1},{matchAll:function(e){var t,r,a,o,u=mB(this);if(pse(e)){if(gse(e)&&(t=M0(mB(_B(e))),!~D1(t,"g")))throw new Rse("`.matchAll` does not allow non-global regexes");if(P1)return hC(u,e);if((a=_se(e,bse))===void 0&&mse(e)==="RegExp"&&(a=SB),a)return fB(a,e,u)}else if(P1)return hC(u,e);return r=M0(u),o=new RegExp(e,"g"),fB(SB,o,r)}});var Ase=ia("String","matchAll"),Ose=D,Ise=Ase,k1=String.prototype,Nse=function(e){var t=e.matchAll;return typeof e=="string"||e===k1||Ose(k1,e)&&t===k1.matchAll?Ise:t},xse=f(Nse);function bB(e){function t(r,a,o,u){let h=r[u++];if(h==="__proto__")return!0;const m=Number.isFinite(+h),g=u>=r.length;return h=!h&&Ge.isArray(o)?o.length:h,g?(Ge.hasOwnProp(o,h)?o[h]=[o[h],a]:o[h]=a,!m):(o[h]&&Ge.isObject(o[h])||(o[h]=[]),t(r,a,o[h],u)&&Ge.isArray(o[h])&&(o[h]=(function(y){const E={},A=Object.keys(y);let O;const N=A.length;let B;for(O=0;O<N;O++)B=A[O],E[B]=y[B];return E})(o[h])),!m)}if(Ge.isFormData(e)&&Ge.isFunction(e.entries)){const r={};return Ge.forEachEntry(e,((a,o)=>{t((function(u){return xse(Ge).call(Ge,/\w+|\[(\w*)]/g,u).map((h=>h[0]==="[]"?"":h[1]||h[0]))})(a),o,r,0)})),r}return null}const L1={transitional:X3,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const r=t.getContentType()||"",a=r.indexOf("application/json")>-1,o=Ge.isObject(e);if(o&&Ge.isHTMLForm(e)&&(e=new FormData(e)),Ge.isFormData(e))return a?JSON.stringify(bB(e)):e;if(Ge.isArrayBuffer(e)||Ge.isBuffer(e)||Ge.isStream(e)||Ge.isFile(e)||Ge.isBlob(e)||Ge.isReadableStream(e))return e;if(Ge.isArrayBufferView(e))return e.buffer;if(Ge.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let u;if(o){if(r.indexOf("application/x-www-form-urlencoded")>-1)return(function(h,m){return nC(h,new Ra.classes.URLSearchParams,Object.assign({visitor:function(g,y,E,A){return Ra.isNode&&Ge.isBuffer(g)?(this.append(y,g.toString("base64")),!1):A.defaultVisitor.apply(this,arguments)}},m))})(e,this.formSerializer).toString();if((u=Ge.isFileList(e))||r.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return nC(u?{"files[]":e}:e,h&&new h,this.formSerializer)}}return o||a?(t.setContentType("application/json",!1),(function(h,m,g){if(Ge.isString(h))try{return(m||JSON.parse)(h),ki(Ge).call(Ge,h)}catch(y){if(y.name!=="SyntaxError")throw y}return(g||JSON.stringify)(h)})(e)):e}],transformResponse:[function(e){const t=this.transitional||L1.transitional,r=t&&t.forcedJSONParsing,a=this.responseType==="json";if(Ge.isResponse(e)||Ge.isReadableStream(e))return e;if(e&&Ge.isString(e)&&(r&&!this.responseType||a)){const o=!(t&&t.silentJSONParsing)&&a;try{return JSON.parse(e)}catch(u){if(o)throw u.name==="SyntaxError"?cn.from(u,cn.ERR_BAD_RESPONSE,this,null,this.response):u}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ra.classes.FormData,Blob:Ra.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ge.forEach(["delete","get","head","post","put","patch"],(e=>{L1.headers[e]={}}));var M1=L1;const Dse=Ge.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),TB=Symbol("internals");function U0(e){var t;return e&&ki(t=String(e)).call(t).toLowerCase()}function fC(e){return e===!1||e==null?e:Ge.isArray(e)?e.map(fC):String(e)}function U1(e,t,r,a,o){return Ge.isFunction(a)?a.call(this,t,r):(o&&(t=r),Ge.isString(t)?Ge.isString(a)?t.indexOf(a)!==-1:Ge.isRegExp(a)?a.test(t):void 0:void 0)}class pC{constructor(t){t&&this.set(t)}set(t,r,a){const o=this;function u(g,y,E){const A=U0(y);if(!A)throw new Error("header name must be a non-empty string");const O=Ge.findKey(o,A);(!O||o[O]===void 0||E===!0||E===void 0&&o[O]!==!1)&&(o[O||y]=fC(g))}const h=(g,y)=>Ge.forEach(g,((E,A)=>u(E,A,y)));if(Ge.isPlainObject(t)||t instanceof this.constructor)h(t,r);else if(Ge.isString(t)&&(t=ki(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(ki(m=t).call(m)))h((g=>{const y={};let E,A,O;return g&&g.split(`
`).forEach((function(N){var B,U;O=N.indexOf(":"),E=ki(B=N.substring(0,O)).call(B).toLowerCase(),A=ki(U=N.substring(O+1)).call(U),!E||y[E]&&Dse[E]||(E==="set-cookie"?y[E]?y[E].push(A):y[E]=[A]:y[E]=y[E]?y[E]+", "+A:A)})),y})(t),r);else if(Ge.isObject(t)&&Ge.isIterable(t)){let g,y,E={};for(const A of t){if(!Ge.isArray(A))throw TypeError("Object iterator must return a key-value pair");E[y=A[0]]=(g=E[y])?Ge.isArray(g)?[...g,A[1]]:[g,A[1]]:A[1]}h(E,r)}else t!=null&&u(r,t,a);var m;return this}get(t,r){if(t=U0(t)){const a=Ge.findKey(this,t);if(a){const o=this[a];if(!r)return o;if(r===!0)return(function(u){const h=Object.create(null),m=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let g;for(;g=m.exec(u);)h[g[1]]=g[2];return h})(o);if(Ge.isFunction(r))return r.call(this,o,a);if(Ge.isRegExp(r))return r.exec(o);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,r){if(t=U0(t)){const a=Ge.findKey(this,t);return!(!a||this[a]===void 0||r&&!U1(0,this[a],a,r))}return!1}delete(t,r){const a=this;let o=!1;function u(h){if(h=U0(h)){const m=Ge.findKey(a,h);!m||r&&!U1(0,a[m],m,r)||(delete a[m],o=!0)}}return Ge.isArray(t)?t.forEach(u):u(t),o}clear(t){const r=Object.keys(this);let a=r.length,o=!1;for(;a--;){const u=r[a];t&&!U1(0,this[u],u,t,!0)||(delete this[u],o=!0)}return o}normalize(t){const r=this,a={};return Ge.forEach(this,((o,u)=>{var h;const m=Ge.findKey(a,u);if(m)return r[m]=fC(o),void delete r[u];const g=t?(function(y){return ki(y).call(y).toLowerCase().replace(/([a-z\d])(\w*)/g,((E,A,O)=>A.toUpperCase()+O))})(u):ki(h=String(u)).call(h);g!==u&&delete r[u],r[g]=fC(o),a[g]=!0})),this}concat(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return this.constructor.concat(this,...r)}toJSON(t){const r=Object.create(null);return Ge.forEach(this,((a,o)=>{a!=null&&a!==!1&&(r[o]=t&&Ge.isArray(a)?a.join(", "):a)})),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((t=>{let[r,a]=t;return r+": "+a})).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){const r=new this(t);for(var a=arguments.length,o=new Array(a>1?a-1:0),u=1;u<a;u++)o[u-1]=arguments[u];return o.forEach((h=>r.set(h))),r}static accessor(t){const r=(this[TB]=this[TB]={accessors:{}}).accessors,a=this.prototype;function o(u){const h=U0(u);r[h]||((function(m,g){const y=Ge.toCamelCase(" "+g);["get","set","has"].forEach((E=>{Object.defineProperty(m,E+y,{value:function(A,O,N){return this[E].call(this,g,A,O,N)},configurable:!0})}))})(a,u),r[h]=!0)}return Ge.isArray(t)?t.forEach(o):o(t),this}}pC.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Ge.reduceDescriptors(pC.prototype,((e,t)=>{let{value:r}=e,a=t[0].toUpperCase()+t.slice(1);return{get:()=>r,set(o){this[a]=o}}})),Ge.freezeMethods(pC);var Lc=pC;function j1(e,t){const r=this||M1,a=t||r,o=Lc.from(a.headers);let u=a.data;return Ge.forEach(e,(function(h){u=h.call(r,u,o.normalize(),t?t.status:void 0)})),o.normalize(),u}function wB(e){return!(!e||!e.__CANCEL__)}function I_(e,t,r){cn.call(this,e??"canceled",cn.ERR_CANCELED,t,r),this.name="CanceledError"}function RB(e,t,r){const a=r.config.validateStatus;r.status&&a&&!a(r.status)?t(new cn("Request failed with status code "+r.status,[cn.ERR_BAD_REQUEST,cn.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r)):e(r)}Ge.inherits(I_,cn,{__CANCEL__:!0});const mC=function(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,a=0;const o=(function(u,h){u=u||10;const m=new Array(u),g=new Array(u);let y,E=0,A=0;return h=h!==void 0?h:1e3,function(O){const N=Date.now(),B=g[A];y||(y=N),m[E]=O,g[E]=N;let U=A,V=0;for(;U!==E;)V+=m[U++],U%=u;if(E=(E+1)%u,E===A&&(A=(A+1)%u),N-y<h)return;const K=B&&N-B;return K?Math.round(1e3*V/K):void 0}})(50,250);return(function(u,h){let m,g,y=0,E=1e3/h;const A=function(O){y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),m=null,g&&(clearTimeout(g),g=null),u.apply(null,O)};return[function(){const O=Date.now(),N=O-y;for(var B=arguments.length,U=new Array(B),V=0;V<B;V++)U[V]=arguments[V];N>=E?A(U,O):(m=U,g||(g=setTimeout((()=>{g=null,A(m)}),E-N)))},()=>m&&A(m)]})((u=>{const h=u.loaded,m=u.lengthComputable?u.total:void 0,g=h-a,y=o(g);a=h,e({loaded:h,total:m,progress:m?h/m:void 0,bytes:g,rate:y||void 0,estimated:y&&m&&h<=m?(m-h)/y:void 0,event:u,lengthComputable:m!=null,[t?"download":"upload"]:!0})}),r)},CB=(e,t)=>{const r=e!=null;return[a=>t[0]({lengthComputable:r,total:e,loaded:a}),t[1]]},AB=e=>function(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return Ge.asap((()=>e(...r)))};var Pse=Ra.hasStandardBrowserEnv?((e,t)=>r=>(r=new HR(r,Ra.origin),e.protocol===r.protocol&&e.host===r.host&&(t||e.port===r.port)))(new HR(Ra.origin),Ra.navigator&&/(msie|trident)/i.test(Ra.navigator.userAgent)):()=>!0,kse=Ra.hasStandardBrowserEnv?{write(e,t,r,a,o,u){const h=[e+"="+encodeURIComponent(t)];Ge.isNumber(r)&&h.push("expires="+new Date(r).toGMTString()),Ge.isString(a)&&h.push("path="+a),Ge.isString(o)&&h.push("domain="+o),u===!0&&h.push("secure"),document.cookie=h.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function OB(e,t,r){let a=!(function(o){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(o)})(t);return e&&(a||r==0)?(function(o,u){return u?o.replace(/\/?\/$/,"")+"/"+u.replace(/^\/+/,""):o})(e,t):t}function IB(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),r.push.apply(r,a)}return r}const NB=e=>e instanceof Lc?(function(t){for(var r=1;r<arguments.length;r++){var a=arguments[r]!=null?arguments[r]:{};r%2?IB(Object(a),!0).forEach((function(o){H(t,o,a[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):IB(Object(a)).forEach((function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(a,o))}))}return t})({},e):e;function Op(e,t){t=t||{};const r={};function a(y,E,A,O){return Ge.isPlainObject(y)&&Ge.isPlainObject(E)?Ge.merge.call({caseless:O},y,E):Ge.isPlainObject(E)?Ge.merge({},E):Ge.isArray(E)?E.slice():E}function o(y,E,A,O){return Ge.isUndefined(E)?Ge.isUndefined(y)?void 0:a(void 0,y,0,O):a(y,E,0,O)}function u(y,E){if(!Ge.isUndefined(E))return a(void 0,E)}function h(y,E){return Ge.isUndefined(E)?Ge.isUndefined(y)?void 0:a(void 0,y):a(void 0,E)}function m(y,E,A){return A in t?a(y,E):A in e?a(void 0,y):void 0}const g={url:u,method:u,data:u,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:m,headers:(y,E,A)=>o(NB(y),NB(E),0,!0)};return Ge.forEach(Object.keys(Object.assign({},e,t)),(function(y){const E=g[y]||o,A=E(e[y],t[y],y);Ge.isUndefined(A)&&E!==m||(r[y]=A)})),r}var xB=e=>{const t=Op({},e);let r,{data:a,withXSRFToken:o,xsrfHeaderName:u,xsrfCookieName:h,headers:m,auth:g}=t;if(t.headers=m=Lc.from(m),t.url=Y3(OB(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),g&&m.set("Authorization","Basic "+btoa((g.username||"")+":"+(g.password?unescape(encodeURIComponent(g.password)):""))),Ge.isFormData(a)){if(Ra.hasStandardBrowserEnv||Ra.hasStandardBrowserWebWorkerEnv)m.setContentType(void 0);else if((r=m.getContentType())!==!1){const[y,...E]=r?r.split(";").map((A=>ki(A).call(A))).filter(Boolean):[];m.setContentType([y||"multipart/form-data",...E].join("; "))}}if(Ra.hasStandardBrowserEnv&&(o&&Ge.isFunction(o)&&(o=o(t)),o||o!==!1&&Pse(t.url))){const y=u&&h&&kse.read(h);y&&m.set(u,y)}return t},Lse=typeof XMLHttpRequest<"u"&&function(e){return new Fe((function(t,r){const a=xB(e);let o=a.data;const u=Lc.from(a.headers).normalize();let h,m,g,y,E,{responseType:A,onUploadProgress:O,onDownloadProgress:N}=a;function B(){y&&y(),E&&E(),a.cancelToken&&a.cancelToken.unsubscribe(h),a.signal&&a.signal.removeEventListener("abort",h)}let U=new XMLHttpRequest;function V(){if(!U)return;const z=Lc.from("getAllResponseHeaders"in U&&U.getAllResponseHeaders());RB((function(J){t(J),B()}),(function(J){r(J),B()}),{data:A&&A!=="text"&&A!=="json"?U.response:U.responseText,status:U.status,statusText:U.statusText,headers:z,config:e,request:U}),U=null}U.open(a.method.toUpperCase(),a.url,!0),U.timeout=a.timeout,"onloadend"in U?U.onloadend=V:U.onreadystatechange=function(){U&&U.readyState===4&&(U.status!==0||U.responseURL&&U.responseURL.indexOf("file:")===0)&&setTimeout(V)},U.onabort=function(){U&&(r(new cn("Request aborted",cn.ECONNABORTED,e,U)),U=null)},U.onerror=function(){r(new cn("Network Error",cn.ERR_NETWORK,e,U)),U=null},U.ontimeout=function(){let z=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const J=a.transitional||X3;a.timeoutErrorMessage&&(z=a.timeoutErrorMessage),r(new cn(z,J.clarifyTimeoutError?cn.ETIMEDOUT:cn.ECONNABORTED,e,U)),U=null},o===void 0&&u.setContentType(null),"setRequestHeader"in U&&Ge.forEach(u.toJSON(),(function(z,J){U.setRequestHeader(J,z)})),Ge.isUndefined(a.withCredentials)||(U.withCredentials=!!a.withCredentials),A&&A!=="json"&&(U.responseType=a.responseType),N&&([g,E]=mC(N,!0),U.addEventListener("progress",g)),O&&U.upload&&([m,y]=mC(O),U.upload.addEventListener("progress",m),U.upload.addEventListener("loadend",y)),(a.cancelToken||a.signal)&&(h=z=>{U&&(r(!z||z.type?new I_(null,e,U):z),U.abort(),U=null)},a.cancelToken&&a.cancelToken.subscribe(h),a.signal&&(a.signal.aborted?h():a.signal.addEventListener("abort",h)));const K=(function(z){const J=/^([-+\w]{1,25})(:?\/\/|:)/.exec(z);return J&&J[1]||""})(a.url);K&&Ra.protocols.indexOf(K)===-1?r(new cn("Unsupported protocol "+K+":",cn.ERR_BAD_REQUEST,e)):U.send(o||null)}))},Mse=(e,t)=>{const{length:r}=e=e?e.filter(Boolean):[];if(t||r){let a,o=new AbortController;const u=function(y){if(!a){a=!0,m();const E=y instanceof Error?y:this.reason;o.abort(E instanceof cn?E:new I_(E instanceof Error?E.message:E))}};let h=t&&setTimeout((()=>{h=null,u(new cn("timeout ".concat(t," of ms exceeded"),cn.ETIMEDOUT))}),t);const m=()=>{e&&(h&&clearTimeout(h),h=null,e.forEach((y=>{y.unsubscribe?y.unsubscribe(u):y.removeEventListener("abort",u)})),e=null)};e.forEach((y=>y.addEventListener("abort",u)));const{signal:g}=o;return g.unsubscribe=()=>Ge.asap(m),g}},V1=f(pp),DB=w_.f("asyncIterator"),Use=f(DB);function B1(e,t){this.v=e,this.k=t}function Bs(e){return function(){return new j0(e.apply(this,arguments))}}function j0(e){var t,r;function a(u,h){try{var m=e[u](h),g=m.value,y=g instanceof B1;V1.resolve(y?g.v:g).then((function(E){if(y){var A=u==="return"?"return":"next";if(!g.k||E.done)return a(A,E);E=e[A](E).value}o(m.done?"return":"normal",E)}),(function(E){a("throw",E)}))}catch(E){o("throw",E)}}function o(u,h){switch(u){case"return":t.resolve({value:h,done:!0});break;case"throw":t.reject(h);break;default:t.resolve({value:h,done:!1})}(t=t.next)?a(t.key,t.arg):r=null}this._invoke=function(u,h){return new V1((function(m,g){var y={key:u,arg:h,resolve:m,reject:g,next:null};r?r=r.next=y:(t=r=y,a(u,h))}))},typeof e.return!="function"&&(this.return=void 0)}function jt(e){return new B1(e,0)}function gC(e){var t={},r=!1;function a(o,u){return r=!0,u=new V1((function(h){h(e[o](u))})),{done:!1,value:new B1(u,1)}}return t[O_!==void 0&&sB||"@@iterator"]=function(){return this},t.next=function(o){return r?(r=!1,o):a("next",o)},typeof e.throw=="function"&&(t.throw=function(o){if(r)throw r=!1,o;return a("throw",o)}),typeof e.return=="function"&&(t.return=function(o){return r?(r=!1,o):a("return",o)}),t}j0.prototype[typeof O_=="function"&&Use||"@@asyncIterator"]=function(){return this},j0.prototype.next=function(e){return this._invoke("next",e)},j0.prototype.throw=function(e){return this._invoke("throw",e)},j0.prototype.return=function(e){return this._invoke("return",e)};var F1=f(DB);function G1(e){var t,r,a,o=2;for(typeof Symbol<"u"&&(r=F1,a=Symbol.iterator);o--;){if(r&&(t=e[r])!=null)return t.call(e);if(a&&(t=e[a])!=null)return new _C(t.call(e));r="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function _C(e){function t(r){if(Object(r)!==r)return Fe.reject(new TypeError(r+" is not an object."));var a=r.done;return Fe.resolve(r.value).then((function(o){return{value:o,done:a}}))}return _C=function(r){this.s=r,this.n=r.next},_C.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(r){var a=this.s.return;return a===void 0?Fe.resolve({value:r,done:!0}):t(a.apply(this.s,arguments))},throw:function(r){var a=this.s.return;return a===void 0?Fe.reject(r):t(a.apply(this.s,arguments))}},new _C(e)}const jse=function*(e,t){let r=e.byteLength;if(!t||r<t)return void(yield e);let a,o=0;for(;o<r;)a=o+t,yield e.slice(o,a),o=a},Vse=(function(){var e=Bs((function*(t,r){var a,o=!1,u=!1;try{for(var h,m=G1(Bse(t));o=!(h=yield jt(m.next())).done;o=!1){const g=h.value;yield*gC(G1(jse(g,r)))}}catch(g){u=!0,a=g}finally{try{o&&m.return!=null&&(yield jt(m.return()))}finally{if(u)throw a}}}));return function(t,r){return e.apply(this,arguments)}})(),Bse=(function(){var e=Bs((function*(t){if(t[F1])return void(yield*gC(G1(t)));const r=t.getReader();try{for(;;){const{done:a,value:o}=yield jt(r.read());if(a)break;yield o}}finally{yield jt(r.cancel())}}));return function(t){return e.apply(this,arguments)}})(),PB=(e,t,r,a)=>{const o=Vse(e,t);let u,h=0,m=g=>{u||(u=!0,a&&a(g))};return new ReadableStream({async pull(g){try{const{done:y,value:E}=await o.next();if(y)return m(),void g.close();let A=E.byteLength;if(r){let O=h+=A;r(O)}g.enqueue(new Uint8Array(E))}catch(y){throw m(y),y}},cancel:g=>(m(g),o.return())},{highWaterMark:2})};function kB(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),r.push.apply(r,a)}return r}function LB(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?kB(Object(r),!0).forEach((function(a){H(e,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):kB(Object(r)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))}))}return e}const vC=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",MB=vC&&typeof ReadableStream=="function",Fse=vC&&(typeof TextEncoder=="function"?(UB=new TextEncoder,e=>UB.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var UB;const jB=function(e){try{for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];return!!e(...r)}catch{return!1}},Gse=MB&&jB((()=>{let e=!1;const t=new Request(Ra.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t})),H1=MB&&jB((()=>Ge.isReadableStream(new Response("").body))),yC={stream:H1&&(e=>e.body)};var VB;vC&&(VB=new Response,["text","arrayBuffer","blob","formData","stream"].forEach((e=>{!yC[e]&&(yC[e]=Ge.isFunction(VB[e])?t=>t[e]():(t,r)=>{throw new cn("Response type '".concat(e,"' is not supported"),cn.ERR_NOT_SUPPORT,r)})})));const Hse=async(e,t)=>{const r=Ge.toFiniteNumber(e.getContentLength());return r??(async a=>a==null?0:Ge.isBlob(a)?a.size:Ge.isSpecCompliantForm(a)?(await new Request(Ra.origin,{method:"POST",body:a}).arrayBuffer()).byteLength:Ge.isArrayBufferView(a)||Ge.isArrayBuffer(a)?a.byteLength:(Ge.isURLSearchParams(a)&&(a+=""),Ge.isString(a)?(await Fse(a)).byteLength:void 0))(t)};var Wse=vC&&(async e=>{let{url:t,method:r,data:a,signal:o,cancelToken:u,timeout:h,onDownloadProgress:m,onUploadProgress:g,responseType:y,headers:E,withCredentials:A="same-origin",fetchOptions:O}=xB(e);y=y?(y+"").toLowerCase():"text";let N,B=Mse([o,u&&u.toAbortSignal()],h);const U=B&&B.unsubscribe&&(()=>{B.unsubscribe()});let V;try{if(g&&Gse&&r!=="get"&&r!=="head"&&(V=await Hse(E,a))!==0){let ie,ee=new Request(t,{method:"POST",body:a,duplex:"half"});if(Ge.isFormData(a)&&(ie=ee.headers.get("content-type"))&&E.setContentType(ie),ee.body){const[le,ye]=CB(V,mC(AB(g)));a=PB(ee.body,65536,le,ye)}}Ge.isString(A)||(A=A?"include":"omit");const K="credentials"in Request.prototype;N=new Request(t,LB(LB({},O),{},{signal:B,method:r.toUpperCase(),headers:E.normalize().toJSON(),body:a,duplex:"half",credentials:K?A:void 0}));let z=await fetch(N);const J=H1&&(y==="stream"||y==="response");if(H1&&(m||J&&U)){const ie={};["status","statusText","headers"].forEach((we=>{ie[we]=z[we]}));const ee=Ge.toFiniteNumber(z.headers.get("content-length")),[le,ye]=m&&CB(ee,mC(AB(m),!0))||[];z=new Response(PB(z.body,65536,le,(()=>{ye&&ye(),U&&U()})),ie)}y=y||"text";let ae=await yC[Ge.findKey(yC,y)||"text"](z,e);return!J&&U&&U(),await new Fe(((ie,ee)=>{RB(ie,ee,{data:ae,headers:Lc.from(z.headers),status:z.status,statusText:z.statusText,config:e,request:N})}))}catch(K){throw U&&U(),K&&K.name==="TypeError"&&/Load failed|fetch/i.test(K.message)?Object.assign(new cn("Network Error",cn.ERR_NETWORK,e,N),{cause:K.cause||K}):cn.from(K,K&&K.code,e,N)}});const W1={http:null,xhr:Lse,fetch:Wse};Ge.forEach(W1,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}}));const BB=e=>"- ".concat(e),zse=e=>Ge.isFunction(e)||e===null||e===!1;var FB={getAdapter:e=>{e=Ge.isArray(e)?e:[e];const{length:t}=e;let r,a;const o={};for(let u=0;u<t;u++){let h;if(r=e[u],a=r,!zse(r)&&(a=W1[(h=String(r)).toLowerCase()],a===void 0))throw new cn("Unknown adapter '".concat(h,"'"));if(a)break;o[h||"#"+u]=a}if(!a){const u=Object.entries(o).map((h=>{let[m,g]=h;return"adapter ".concat(m," ")+(g===!1?"is not supported by the environment":"is not available in the build")}));throw new cn("There is no suitable adapter to dispatch the request "+(t?u.length>1?`since :
`+u.map(BB).join(`
`):" "+BB(u[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return a},adapters:W1};function z1(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new I_(null,e)}function GB(e){return z1(e),e.headers=Lc.from(e.headers),e.data=j1.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),FB.getAdapter(e.adapter||M1.adapter)(e).then((function(t){return z1(e),t.data=j1.call(e,e.transformResponse,t),t.headers=Lc.from(t.headers),t}),(function(t){return wB(t)||(z1(e),t&&t.response&&(t.response.data=j1.call(e,e.transformResponse,t.response),t.response.headers=Lc.from(t.response.headers))),Fe.reject(t)}))}const HB="1.9.0",EC={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{EC[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}}));const WB={};EC.transitional=function(e,t,r){function a(o,u){return"[Axios v"+HB+"] Transitional option '"+o+"'"+u+(r?". "+r:"")}return(o,u,h)=>{if(e===!1)throw new cn(a(u," has been removed"+(t?" in "+t:"")),cn.ERR_DEPRECATED);return t&&!WB[u]&&(WB[u]=!0,console.warn(a(u," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(o,u,h)}},EC.spelling=function(e){return(t,r)=>(console.warn("".concat(r," is likely a misspelling of ").concat(e)),!0)};var SC={assertOptions:function(e,t,r){if(typeof e!="object")throw new cn("options must be an object",cn.ERR_BAD_OPTION_VALUE);const a=Object.keys(e);let o=a.length;for(;o-- >0;){const u=a[o],h=t[u];if(h){const m=e[u],g=m===void 0||h(m,u,e);if(g!==!0)throw new cn("option "+u+" must be "+g,cn.ERR_BAD_OPTION_VALUE)}else if(r!==!0)throw new cn("Unknown option "+u,cn.ERR_BAD_OPTION)}},validators:EC};const Ol=SC.validators;let bC=class{constructor(e){this.defaults=e||{},this.interceptors={request:new q3,response:new q3}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const o=a.stack?a.stack.replace(/^.+\n/,""):"";try{r.stack?o&&!String(r.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+o):r.stack=o}catch{}}throw r}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=Op(this.defaults,t);const{transitional:r,paramsSerializer:a,headers:o}=t;r!==void 0&&SC.assertOptions(r,{silentJSONParsing:Ol.transitional(Ol.boolean),forcedJSONParsing:Ol.transitional(Ol.boolean),clarifyTimeoutError:Ol.transitional(Ol.boolean)},!1),a!=null&&(Ge.isFunction(a)?t.paramsSerializer={serialize:a}:SC.assertOptions(a,{encode:Ol.function,serialize:Ol.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),SC.assertOptions(t,{baseUrl:Ol.spelling("baseURL"),withXsrfToken:Ol.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let u=o&&Ge.merge(o.common,o[t.method]);o&&Ge.forEach(["delete","get","head","post","put","patch","common"],(N=>{delete o[N]})),t.headers=Lc.concat(u,o);const h=[];let m=!0;this.interceptors.request.forEach((function(N){typeof N.runWhen=="function"&&N.runWhen(t)===!1||(m=m&&N.synchronous,h.unshift(N.fulfilled,N.rejected))}));const g=[];let y;this.interceptors.response.forEach((function(N){g.push(N.fulfilled,N.rejected)}));let E,A=0;if(!m){const N=[GB.bind(this),void 0];for(N.unshift.apply(N,h),N.push.apply(N,g),E=N.length,y=Fe.resolve(t);A<E;)y=y.then(N[A++],N[A++]);return y}E=h.length;let O=t;for(A=0;A<E;){const N=h[A++],B=h[A++];try{O=N(O)}catch(U){B.call(this,U);break}}try{y=GB.call(this,O)}catch(N){return Fe.reject(N)}for(A=0,E=g.length;A<E;)y=y.then(g[A++],g[A++]);return y}getUri(e){return Y3(OB((e=Op(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};Ge.forEach(["delete","get","head","options"],(function(e){bC.prototype[e]=function(t,r){return this.request(Op(r||{},{method:e,url:t,data:(r||{}).data}))}})),Ge.forEach(["post","put","patch"],(function(e){function t(r){return function(a,o,u){return this.request(Op(u||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:a,data:o}))}}bC.prototype[e]=t(),bC.prototype[e+"Form"]=t(!0)}));var TC=bC;class K1{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Fe((function(o){r=o}));const a=this;this.promise.then((o=>{if(!a._listeners)return;let u=a._listeners.length;for(;u-- >0;)a._listeners[u](o);a._listeners=null})),this.promise.then=o=>{let u;const h=new Fe((m=>{a.subscribe(m),u=m})).then(o);return h.cancel=function(){a.unsubscribe(u)},h},t((function(o,u,h){a.reason||(a.reason=new I_(o,u,h),r(a.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const r=this._listeners.indexOf(t);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const t=new AbortController,r=a=>{t.abort(a)};return this.subscribe(r),t.signal.unsubscribe=()=>this.unsubscribe(r),t.signal}static source(){let t;return{token:new K1((function(a){t=a})),cancel:t}}}var Kse=K1;const Y1={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Y1).forEach((e=>{let[t,r]=e;Y1[r]=t}));var Yse=Y1;const bi=(function e(t){const r=new TC(t),a=N3(TC.prototype.request,r);return Ge.extend(a,TC.prototype,r,{allOwnKeys:!0}),Ge.extend(a,r,null,{allOwnKeys:!0}),a.create=function(o){return e(Op(t,o))},a})(M1);bi.Axios=TC,bi.CanceledError=I_,bi.CancelToken=Kse,bi.isCancel=wB,bi.VERSION=HB,bi.toFormData=nC,bi.AxiosError=cn,bi.Cancel=bi.CanceledError,bi.all=function(e){return Fe.all(e)},bi.spread=function(e){return function(t){return e.apply(null,t)}},bi.isAxiosError=function(e){return Ge.isObject(e)&&e.isAxiosError===!0},bi.mergeConfig=Op,bi.AxiosHeaders=Lc,bi.formToJSON=e=>bB(Ge.isHTMLForm(e)?new FormData(e):e),bi.getAdapter=FB.getAdapter,bi.HttpStatusCode=Yse,bi.default=bi;var oa=bi;const qse=()=>{};function V0(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:qse};return e.promise=new Fe(((t,r)=>{e.resolve=a=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(a),e.value=a)},e.reject=a=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,r(a))}})),e}const wC=new Map,RC=new Map,Il=new Map;let Cr=(function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e})({}),Gt=(function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e})({});const zB=new wre;let Mc=zB.getResult(),q1=null;function Lt(e){if(!q1){Mc=zB.getResult();const t=(function(m){if(m.engine.name==="Blink"&&m.browser.name!=="WeChat")return Gt.CHROME;switch(m.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Gt.CHROME;case"Safari":case"Mobile Safari":return Gt.SAFARI;case"Edge":return Gt.EDGE;case"Firefox":return Gt.FIREFOX;case"QQ":case"QQBrowser":return Gt.QQ;case"Opera":return Gt.OPERA;case"WeChat":return Gt.WECHAT;default:return m.browser.name||""}})(Mc),r=KB(Mc),a=(function(m){return m.os.name==="Windows"?m.os.version?m.os.name+" "+m.os.version:m.os.name:m.os.name||""})(Mc),o=Mc.os.version,u=KB(Mc,!1),h=Mc.device.type;if(!(t&&r&&a&&o))return{name:t,version:r,os:a,osVersion:o,browserVersion:u,deviceType:h};q1={name:t,version:r,os:a,osVersion:o,browserVersion:u,deviceType:h}}return q1}function KB(e){let t,r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",r?t.split(".")[0]:t}function CC(){return Lt().os}function YB(){const e=Lt();return"".concat(e.os," ").concat(e.osVersion)}function AC(){const e=Lt();return!!(Mc.engine.name==="WebKit"&&e.os===Cr.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Gt.SAFARI||Ti()&&e.name!==Gt.SAFARI)}function Uu(){return Lt().name===Gt.CHROME}function Zr(){return Lt().name===Gt.SAFARI}function qB(){const e=Lt();if(e.name!==Gt.SAFARI||!e.browserVersion)return!1;const t=e.browserVersion.split(".");return Number(t[0])>15||Number(t[0])===15&&Number(t[1])>=4}function XB(){return Lt().name===Gt.EDGE}function Vn(){return Lt().name===Gt.FIREFOX}function Ti(){return Lt().os===Cr.IOS}function N_(e){const t=Lt();return!(t.name!==Gt.CHROME||!t.osVersion)&&Number(t.version)>=e}function JB(e){const t=Lt();return!(t.name!==Gt.CHROME||!t.osVersion)&&Number(t.version)<e}function X1(e,t,r){const a=Lt();return!(a.name!==e||!a.osVersion)&&(r?Number(a.version)>=t&&Number(a.version)<=r:Number(a.version)===t)}function J1(e){const t=Lt();return!(t.name!==Gt.EDGE||!t.osVersion)&&Number(t.version)>=e}function $1(e){const t=Lt();return!(t.name!==Gt.FIREFOX||!t.osVersion)&&Number(t.version)>=e}function $B(e){const t=Lt();return!(t.name!==Gt.SAFARI||!t.osVersion)&&Number(t.version)>=e}function ZB(e,t,r){const a=Lt();if(a.os!==Cr.IOS||!a.osVersion)return!1;const o=a.osVersion.split(".");return r?t&&Number(o[0])===e&&Number(o[1])>t||Number(o[0])>e:t?Number(o[0])===e&&Number(o[1])>=t||Number(o[0])>e:Number(o[0])>=e}function QB(e,t,r){const a=Lt();if(a.os!==Cr.IOS||!a.osVersion)return!1;const o=a.osVersion.split(".");return t&&Number(o[0])===e&&Number(o[1])<t||Number(o[0])<e}function Z1(e,t,r){const a=Lt();if(a.name!==Gt.SAFARI||!a.osVersion||!a.browserVersion)return!1;const o=a.browserVersion.split(".");return r?t&&Number(o[0])===e&&Number(o[1])<t||Number(o[0])<e:t?Number(o[0])===e&&Number(o[1])<=t||Number(o[0])<e:Number(o[0])<=e}function Q1(e){const t=Lt();return!(t.name!==Gt.OPERA||!t.osVersion)&&Number(t.version)>=e}function e5(){const e=Lt();if(e.os!==Cr.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function x_(){const e=Lt();if(e.os!==Cr.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15}function eD(){const e=Lt();if(e.os!==Cr.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===16}function t5(){const e=Lt();if(e.os!==Cr.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function wo(){return Zr()&&navigator.maxTouchPoints>0}function n5(){return Lt().name===Gt.WECHAT}function r5(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function tD(){const e=CC();return(function(){const{deviceType:t}=Lt();return t==="mobile"||t==="tablet"})()||e===Cr.ANDROID||e===Cr.IOS||e===Cr.HARMONY_OS}function ju(){const e=Lt();return e.name!==Gt.EDGE&&e.name!==Gt.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function OC(){return CC()===Cr.ANDROID}function B0(){const e=Lt();return OC()&&(e.name===Gt.CHROME||e.name===Gt.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function mt(e,t,r){return(t=(function(a){var o=(function(u,h){if(typeof u!="object"||!u)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var g=m.call(u,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)})(a);return typeof o=="symbol"?o:o+""})(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),r.push.apply(r,a)}return r}function xe(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?i5(Object(r),!0).forEach((function(a){mt(e,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i5(Object(r)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))}))}return e}let q=(function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e})({}),ve=class extends Error{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0;super(t),mt(this,"code",void 0),mt(this,"message",void 0),mt(this,"data",void 0),mt(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=r}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return e==="error"&&(t||console).error(this.toString()),e==="warning"&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function Uc(e,t){if(typeof e!="boolean")throw new ve(q.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function vr(e,t,r){if(!je(r).call(r,e))throw new ve(q.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(r)))}function ln(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<r||e>a||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!(function(o){return typeof o=="number"&&o%1==0})(e))throw new ve(q.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(r,", ").concat(a,"]. integer only"))}function nD(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new ve(q.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&ln(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&ln(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&ln(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&ln(e.ideal,"".concat(t,".ideal"),1,1/0)}else ln(e,t,1,1/0)}function Gr(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,o=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new ve(q.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!a5(e,r,a,o))throw new ve(q.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(r,",").concat(a,"].").concat(o?" ASCII characters only.":""))}function Vu(e,t){if(!Array.isArray(e))throw new ve(q.INVALID_PARAMS,"".concat(t," should be an array"))}function Bn(e){return e==null}function a5(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,a=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=r&&e.length>=t&&(!a||(function(o){if(typeof o!="string")return!1;for(let u=0;u<o.length;u+=1){const h=o.charCodeAt(u);if(h<0||h>255)return!1}return!0})(e))}var F0=(function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e})(F0||{}),rD=(function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e})(rD||{});const s5=new class{constructor(){mt(this,"_clientSize",null),mt(this,"getClientWidth",(()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth)),mt(this,"getClientHeight",(()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight)),mt(this,"getStyle",(e=>window.getComputedStyle(e,null))),mt(this,"checkCssVisibleProperty",(e=>{var t;let r=!0;const a=this.getStyle(e),{display:o,visibility:u,opacity:h,filter:m}=a;return(o==="none"||je(t=["hidden","collapse"]).call(t,u)||Number(h)<.1)&&(r=!1),!!r&&(m&&m.split(" ").filter((g=>{var y;const E=g.split("(")[0];return je(y=["brightness","blur","opacity"]).call(y,E)})).map((g=>{const[y,E]=g.split(/\(|\)/);return[y,Number(E.match(/^[0-9\.]+/))]})).forEach((g=>{const[y,E]=g;switch(y){case"brightness":(E<.1||E>3)&&(r=!1);break;case"blur":E>3&&(r=!1);break;case"opacity":E<.1&&(r=!1)}})),r)})),mt(this,"checkPropertyUpToAllParentNodes",((e,t)=>{let r=!0,a=!0;const o=h=>t(h);let u=e;for(;u&&a;)o(u)||(r=!1,a=!1),u=u.parentElement,u||(a=!1);return r})),mt(this,"checkActualCssVisibleIncludeInherit",(e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty))),mt(this,"getSizeAboutClient",(e=>{const{width:t,height:r,left:a,right:o,top:u,bottom:h}=e.getBoundingClientRect(),m=this.getClientWidth(),g=this.getClientHeight();return{width:t,height:r,left:a,right:o,top:u,bottom:h,clientWidth:m,clientHeight:g,clientMin:Math.min(m,g)}})),mt(this,"checkActualSize",(()=>{const{width:e,height:t,clientMin:r}=this._clientSize;return this.checkSizeIsVisible(e,t,r)})),mt(this,"elementFromPoint",((e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null)),mt(this,"checkCoverForAPoint",((e,t,r)=>{const a=this.elementFromPoint(e,t);return a!==null&&a!==r})),mt(this,"getPointPositionList",(()=>{const{width:e,height:t,left:r,top:a}=this._clientSize,o=e/6,u=t/6,h=[],m=10**6;for(let g=0;g<5;g++)for(let y=0;y<5;y++){const E=(r*m+(g===0?.1:g===4?(o*g*m-1e5)/m:o*g)*m)/m,A=(a*m+(y===0?.1:y===4?(u*y*m-1e5)/m:u*y)*m)/m;h.push({x:E,y:A})}return[...h]})),mt(this,"checkElementCover",(e=>this.getPointPositionList().map((t=>this.checkCoverForAPoint(t.x,t.y,e))).filter((t=>!!t)).length>6)),mt(this,"checkSizeIsVisible",((e,t,r)=>(e>50||r/e<=10)&&(t>50||r/t<=10))),mt(this,"checkSizeOfPartInClient",(()=>{const{left:e,right:t,top:r,bottom:a,clientHeight:o,clientWidth:u,clientMin:h}=this._clientSize;let m,g,y,E;if(e<0)m=0;else{if(!(e<u))return!1;m=e}if(t<0)return!1;if(g=t<u?t:u,r<0)y=0;else{if(!(r<o))return!1;y=r}if(a<0)return!1;E=a<o?a:o;const A=g-m,O=E-y;return this.checkSizeIsVisible(A,O,h)})),mt(this,"returnHiddenResult",(e=>(this._clientSize=null,{visible:!1,reason:e}))),mt(this,"checkOneElementVisible",(e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(F0.COVERED);{const t=this.checkActualSize(),r=this.checkSizeOfPartInClient();return t&&!r?this.returnHiddenResult(F0.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(F0.SIZE)}}return this.returnHiddenResult(F0.STYLE)}return this.returnHiddenResult(rD.UNMOUNTED)}return this.returnHiddenResult(rD.INVALID_HTML_ELEMENT)})),mt(this,"checkElementIsMountedOnDom",(e=>this.checkPropertyUpToAllParentNodes(e,(t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))))}};function iD(e){return new TextEncoder().encode(e)}const o5=function(e,t){const r=new Uint8Array(e.byteLength+t.byteLength);return r.set(new Uint8Array(e),0),r.set(new Uint8Array(t),e.byteLength),r},aD=async e=>(function(t,r){let a="";return new Uint8Array(t).forEach((o=>{a+=o.toString(r).padStart(2,"0")})),a})(await crypto.subtle.digest("SHA-256",iD(e)),16);class Mn{constructor(){mt(this,"_events",{}),mt(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map((r=>r.listener)):[]}on(t,r){this._events[t]||(this._events[t]=[]);const a=this._events[t];this._indexOfListener(a,r)===-1&&a.push({listener:r,once:!1})}once(t,r){this._events[t]||(this._events[t]=[]);const a=this._events[t];this._indexOfListener(a,r)===-1&&a.push({listener:r,once:!0})}off(t,r){if(!this._events[t])return;const a=this._events[t],o=this._indexOfListener(a,r);o!==-1&&a.splice(o,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const r=this._events[t].map((h=>h));for(var a=arguments.length,o=new Array(a>1?a-1:0),u=1;u<a;u++)o[u-1]=arguments[u];for(let h=0;h<r.length;h+=1){const m=r[h];m.once&&this.off(t,m.listener),m.listener.apply(this,o||[])}}safeEmit(t){for(var r=arguments.length,a=new Array(r>1?r-1:0),o=1;o<r;o++)a[o-1]=arguments[o];[...this._events[t]||[]].forEach((u=>{u.once&&this.off(t,u.listener);try{u.listener.apply(this,a)}catch(h){console.error("safeEmit event:".concat(t," error ").concat(h?.toString()))}}))}_indexOfListener(t,r){let a=t.length;for(;a--;)if(t[a].listener===r)return a;return-1}}let G0=null;function c5(){if(G0)return G0;if(window.electron)return G0=window.electron;if(!window.require)return null;try{return G0=window.require("electron"),G0}catch{return null}}let Xn=(function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e.PRELOAD_MEDIA_FAILED="preloadMediaFailed",e.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",e})({}),Dn=(function(e){return e.TRACER="tracer",e})({});function l5(e){return ln(e.timeout,"config.timeout",0,1e5),ln(e.timeoutFactor,"config.timeoutFactor",0,100,!1),ln(e.maxRetryCount,"config.maxRetryConfig",0,1/0),ln(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let Xse=(function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e})({}),$t=(function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e})({});function H0(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach((t=>{if(!t.urls)throw Error()}))}catch{return!1}return!0}function u5(e){return Gr(e.turnServerURL,"turnServerURL"),Gr(e.username,"username"),Gr(e.password,"password"),e.udpport&&ln(e.udpport,"udpport",1,99999,!0),e.forceturn&&Uc(e.forceturn,"forceturn"),e.security&&Uc(e.security,"security"),e.tcpport&&ln(e.tcpport,"tcpport",1,99999,!0),!0}function sD(e){return e.level!==void 0&&vr(e.level,"level",[1,2,3]),e.delay!==void 0&&ln(e.delay,"delay",0,3e3,!0),!0}let xt=(function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.AUDIO_PTS="audio-pts",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e})({}),Qr=(function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e})({}),Xa=(function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e})({}),D_=(function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e})({});function ei(e,t){for(var r=arguments.length,a=new Array(r>2?r-2:0),o=2;o<r;o++)a[o-2]=arguments[o];return e.getListeners(t).length===0?Fe.reject(new ve(q.UNEXPECTED_ERROR,"can not emit promise")):new Fe(((u,h)=>{e.emit(t,...a,u,h)}))}function hn(e,t){if(e.getListeners(t).length===0)return Fe.resolve();for(var r=arguments.length,a=new Array(r>2?r-2:0),o=2;o<r;o++)a[o-2]=arguments[o];return ei(e,t,...a)}function _s(e,t){if(e.getListeners(t).length===0)return null;for(var r=arguments.length,a=new Array(r>2?r-2:0),o=2;o<r;o++)a[o-2]=arguments[o];return W0(e,t,...a)}function W0(e,t){let r=null,a=null;for(var o=arguments.length,u=new Array(o>2?o-2:0),h=2;h<o;h++)u[h-2]=arguments[h];if(e.emit(t,...u,(m=>{r=m}),(m=>{a=m})),a!==null)throw a;if(r===null)throw new ve(q.UNEXPECTED_ERROR,"handler is not sync");return r}const nr=new class extends Mn{set networkState(e){this.emit(D_.NETWORK_STATE_CHANGE,e,this._networkState),e===Xa.ONLINE?this.emit(D_.ONLINE):e===Xa.OFFLINE&&(this.onlineWaiter=new Fe((t=>{this.once(D_.ONLINE,(()=>{this.onlineWaiter=void 0,t(Xa.ONLINE)}))})),this.emit(D_.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===Xa.ONLINE}constructor(){super(),mt(this,"_moduleName","network-indicator"),mt(this,"_networkState",Xa.ONLINE),mt(this,"onlineWaiter",void 0),window.addEventListener("online",(()=>{this.networkState=Xa.ONLINE})),window.addEventListener("offline",(()=>{this.networkState=Xa.OFFLINE}))}};function IC(e,t){const r=e.indexOf(t);r!==-1&&e.splice(r,1)}function P_(e){const t=[];return e.forEach((r=>{t.indexOf(r)===-1&&t.push(r)})),t}function NC(e){Fe!==void 0?Fe.resolve().then(e):setTimeout(e,0)}function Pn(e){return JSON.parse(JSON.stringify(e))}function Ip(e){try{return Pn(e)}catch{return e}}const d5={};function Nh(e,t){d5[t]||(d5[t]=!0,e())}function Np(e){const t=window.atob(e),r=new Uint8Array(new ArrayBuffer(t.length));for(let a=0;a<t.length;a+=1)r[a]=t.charCodeAt(a);return r}function xh(e){let t="";for(let r=0;r<e.length;r+=1)t+=String.fromCharCode(e[r]);return window.btoa(t)}function h5(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,r=new TextEncoder().encode(e);if(r.length>t)r=r.slice(0,t);else if(r.length<t){const a=new Uint8Array(t);a.set(r),r=a}return r}function f5(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const a=vi(t).call(t,((h,m)=>h+m.length),0),o=new Uint8Array(new ArrayBuffer(a));let u=0;return t.forEach((h=>{o.set(h,u),u+=h.length})),o}function Nl(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function p5(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach((r=>{t+=typeof r=="string"?Nl(r):r.size})),t+138}function Jse(e){const t=new ve(q.TIMEOUT,"timeout");return new Fe(((r,a)=>{window.setTimeout((()=>a(t)),e)}))}function Hr(e){return new Fe((t=>{window.setTimeout(t,e)}))}function fn(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const r=Math.random().toString(16).substr(2,e).toLowerCase();return r.length===e?"".concat(t).concat(r):"".concat(t).concat(r)+fn(e-r.length,"")}function xp(){return fn(32,"").toUpperCase()}const xC=()=>{},m5=new class{constructor(){mt(this,"fnMap",new Map)}throttleByKey(e,t,r,a){for(var o=arguments.length,u=new Array(o>4?o-4:0),h=4;h<o;h++)u[h-4]=arguments[h];if(this.fnMap.has(t)){const m=this.fnMap.get(t);if(m.threshold!==r){m.fn(...m.args),clearTimeout(m.timer);const g=window.setTimeout((()=>{const y=this.fnMap.get(t);y&&y.fn(...y.args),this.fnMap.delete(t)}),r);this.fnMap.set(t,{fn:e,threshold:r,timer:g,args:u,skipFn:a})}else m.skipFn&&m.skipFn(...m.args),this.fnMap.set(t,xe(xe({},m),{},{fn:e,args:u,skipFn:a}))}else{const m=window.setTimeout((()=>{const g=this.fnMap.get(t);g&&g.fn(...g.args),this.fnMap.delete(t)}),r);this.fnMap.set(t,{fn:e,threshold:r,timer:m,args:u,skipFn:a})}}},g5=m5.throttleByKey.bind(m5);function _5(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function oD(e,t){if(!_5(e)||!_5(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const r=[...e];for(let a=0;a<t.length;a++)r[a]=oD(e[a],t[a]);return r}{const r=xe({},e);for(const a in t)Object.prototype.hasOwnProperty.call(t,a)&&(Object.prototype.hasOwnProperty.call(e,a)?r[a]=oD(e[a],t[a]):r[a]=t[a]);return r}}function v5(e,t){let r=[0];if(r=new Array(t).fill(0),e===0)return r;let a=0;for(;e>0&&(r[a]=255&e,e>>=8,a++,a!==t););return r}function k_(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function cD(e){return vi(e).call(e,((t,r)=>t+r),0)}function y5(e){const t="0123456789abcdef";function r(J){let ae,ie="";for(ae=0;ae<=3;ae++)ie+=t.charAt(J>>8*ae+4&15)+t.charAt(J>>8*ae&15);return ie}function a(J,ae){const ie=(65535&J)+(65535&ae);return(J>>16)+(ae>>16)+(ie>>16)<<16|65535&ie}function o(J,ae,ie,ee,le,ye){return a((function(we,Ne){return we<<Ne|we>>>32-Ne})(a(a(ae,J),a(ee,ye)),le),ie)}function u(J,ae,ie,ee,le,ye,we){return o(ae&ie|~ae&ee,J,ae,le,ye,we)}function h(J,ae,ie,ee,le,ye,we){return o(ae&ee|ie&~ee,J,ae,le,ye,we)}function m(J,ae,ie,ee,le,ye,we){return o(ae^ie^ee,J,ae,le,ye,we)}function g(J,ae,ie,ee,le,ye,we){return o(ie^(ae|~ee),J,ae,le,ye,we)}const y=(function(J){let ae;const ie=1+(J.length+8>>6),ee=new Array(16*ie);for(ae=0;ae<16*ie;ae++)ee[ae]=0;for(ae=0;ae<J.length;ae++)ee[ae>>2]|=J.charCodeAt(ae)<<ae%4*8;return ee[ae>>2]|=128<<ae%4*8,ee[16*ie-2]=8*J.length,ee})(e);let E,A,O,N,B,U=1732584193,V=-271733879,K=-1732584194,z=271733878;for(E=0;E<y.length;E+=16)A=U,O=V,N=K,B=z,U=u(U,V,K,z,y[E+0],7,-680876936),z=u(z,U,V,K,y[E+1],12,-389564586),K=u(K,z,U,V,y[E+2],17,606105819),V=u(V,K,z,U,y[E+3],22,-1044525330),U=u(U,V,K,z,y[E+4],7,-176418897),z=u(z,U,V,K,y[E+5],12,1200080426),K=u(K,z,U,V,y[E+6],17,-1473231341),V=u(V,K,z,U,y[E+7],22,-45705983),U=u(U,V,K,z,y[E+8],7,1770035416),z=u(z,U,V,K,y[E+9],12,-1958414417),K=u(K,z,U,V,y[E+10],17,-42063),V=u(V,K,z,U,y[E+11],22,-1990404162),U=u(U,V,K,z,y[E+12],7,1804603682),z=u(z,U,V,K,y[E+13],12,-40341101),K=u(K,z,U,V,y[E+14],17,-1502002290),V=u(V,K,z,U,y[E+15],22,1236535329),U=h(U,V,K,z,y[E+1],5,-165796510),z=h(z,U,V,K,y[E+6],9,-1069501632),K=h(K,z,U,V,y[E+11],14,643717713),V=h(V,K,z,U,y[E+0],20,-373897302),U=h(U,V,K,z,y[E+5],5,-701558691),z=h(z,U,V,K,y[E+10],9,38016083),K=h(K,z,U,V,y[E+15],14,-660478335),V=h(V,K,z,U,y[E+4],20,-405537848),U=h(U,V,K,z,y[E+9],5,568446438),z=h(z,U,V,K,y[E+14],9,-1019803690),K=h(K,z,U,V,y[E+3],14,-187363961),V=h(V,K,z,U,y[E+8],20,1163531501),U=h(U,V,K,z,y[E+13],5,-1444681467),z=h(z,U,V,K,y[E+2],9,-51403784),K=h(K,z,U,V,y[E+7],14,1735328473),V=h(V,K,z,U,y[E+12],20,-1926607734),U=m(U,V,K,z,y[E+5],4,-378558),z=m(z,U,V,K,y[E+8],11,-2022574463),K=m(K,z,U,V,y[E+11],16,1839030562),V=m(V,K,z,U,y[E+14],23,-35309556),U=m(U,V,K,z,y[E+1],4,-1530992060),z=m(z,U,V,K,y[E+4],11,1272893353),K=m(K,z,U,V,y[E+7],16,-155497632),V=m(V,K,z,U,y[E+10],23,-1094730640),U=m(U,V,K,z,y[E+13],4,681279174),z=m(z,U,V,K,y[E+0],11,-358537222),K=m(K,z,U,V,y[E+3],16,-722521979),V=m(V,K,z,U,y[E+6],23,76029189),U=m(U,V,K,z,y[E+9],4,-640364487),z=m(z,U,V,K,y[E+12],11,-421815835),K=m(K,z,U,V,y[E+15],16,530742520),V=m(V,K,z,U,y[E+2],23,-995338651),U=g(U,V,K,z,y[E+0],6,-198630844),z=g(z,U,V,K,y[E+7],10,1126891415),K=g(K,z,U,V,y[E+14],15,-1416354905),V=g(V,K,z,U,y[E+5],21,-57434055),U=g(U,V,K,z,y[E+12],6,1700485571),z=g(z,U,V,K,y[E+3],10,-1894986606),K=g(K,z,U,V,y[E+10],15,-1051523),V=g(V,K,z,U,y[E+1],21,-2054922799),U=g(U,V,K,z,y[E+8],6,1873313359),z=g(z,U,V,K,y[E+15],10,-30611744),K=g(K,z,U,V,y[E+6],15,-1560198380),V=g(V,K,z,U,y[E+13],21,1309151649),U=g(U,V,K,z,y[E+4],6,-145523070),z=g(z,U,V,K,y[E+11],10,-1120210379),K=g(K,z,U,V,y[E+2],15,718787259),V=g(V,K,z,U,y[E+9],21,-343485551),U=a(U,A),V=a(V,O),K=a(K,N),z=a(z,B);return r(U)+r(V)+r(K)+r(z)}let $se=1,E5=console,oi=class{static setLogger(e){E5=e}constructor(e,t){mt(this,"id",void 0),mt(this,"lockingPromise",Fe.resolve()),mt(this,"locks",0),mt(this,"name",""),mt(this,"lockId",void 0),this.lockId=$se++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){const r=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),a=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(t??"");E5.debug("".concat(r," ").concat(a))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);const r=new Fe((o=>{t=()=>{this.locks-=1,this.logger("unlocked",e),o()}})),a=this.lockingPromise.then((()=>t));return this.lockingPromise=this.lockingPromise.then((()=>r)),a}};function L_(e,t){return function(r,a,o){const u=o.value;if(typeof u!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){const h=this[t];if(!h)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const m=await h.lock("From ".concat(e,".").concat(a));try{for(var g=arguments.length,y=new Array(g),E=0;E<g;E++)y[E]=arguments[E];return await u.apply(this,y)}finally{m()}},o}}const sr={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function lD(e,t){const r=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,r)}function jc(e,t,r,a){const o=Object.assign({},sr,a);let u=o.timeout;const h=async()=>{await(function(y){return new Fe((E=>{window.setTimeout(E,y)}))})(u),u*=o.timeoutFactor,u=Math.min(o.maxRetryTimeout,u)};let m=!1;const g=new Fe((async(y,E)=>{t=t||(()=>!1),r=r||(()=>!0);for(let A=0;A<o.maxRetryCount;A+=1){if(m)return E(new ve(q.OPERATION_ABORTED));try{const O=await e();if(!t(O,A)||A+1===o.maxRetryCount)return y(O);await h()}catch(O){if(!r(O,A)||A+1===o.maxRetryCount)return E(O);await h()}}}));return g.cancel=()=>m=!0,g}let DC,S5=class{constructor(e){mt(this,"input",[]),mt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:vi(e=this.input).call(e,((t,r)=>t+r))/this.input.length}},PC=0,uD=0;function dD(e,t,r,a){return new Fe(((o,u)=>{t.responseType=t.responseType||"json",t.data&&!r?(t.data=JSON.stringify(t.data),PC+=Nl(t.data)):r&&(t.data.size?PC+=t.data.size:t.data instanceof FormData?PC+=p5(t.data):PC+=Nl(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,oa.request(t).then((h=>{typeof h.data=="string"?uD+=Nl(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?uD+=h.data.byteLength:uD+=Nl(JSON.stringify(h.data)),o(h.data)})).catch((h=>{oa.isCancel(h)?u(new ve(q.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new ve(q.NETWORK_TIMEOUT,h.message)):h.response?u(new ve(q.NETWORK_RESPONSE_ERROR,h.response.status)):u(new ve(q.NETWORK_ERROR,h.message))}))}))}async function Zse(e,t){const r=new Blob([t.data],{type:"buffer"});return await dD(e,xe(xe({},t),{},{data:r,headers:{"Content-Type":"application/octet-stream"}}),!0)}const b5=()=>window.isSecureContext!==void 0;function Ro(e){if(Array.isArray(e))return e.map((r=>r));if(!T5(e))return e;const t={};for(const r in e){const a=e[r];T5(a)||Array.isArray(a)?t[r]=Ro(a):t[r]=a}return t}function T5(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let hD=class{constructor(e){mt(this,"input",[]),mt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const xl={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},z0={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:xl,remoteCandidate:xl},updateInterval:0},w5={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},R5={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},C5={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},A5={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let fD=class{constructor(e,t){mt(this,"onFirstVideoReceived",void 0),mt(this,"onFirstVideoDecoded",void 0),mt(this,"onFirstAudioReceived",void 0),mt(this,"onFirstVideoDecodedTimeout",void 0),mt(this,"onFirstAudioDecoded",void 0),mt(this,"onSelectedLocalCandidateChanged",void 0),mt(this,"onSelectedRemoteCandidateChanged",void 0),mt(this,"videoIsReady",!1),mt(this,"videoIsReady2",{}),mt(this,"pc",void 0),mt(this,"options",void 0),mt(this,"intervalTimer",void 0),mt(this,"stats",Ro(z0)),mt(this,"isFirstVideoReceived",{}),mt(this,"isFirstVideoDecoded",{}),mt(this,"isFirstAudioReceived",{}),mt(this,"isFirstAudioDecoded",{}),mt(this,"isFirstVideoDecodedTimeout",{}),mt(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval((async()=>{this.updateStats()}),this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new Fe((e=>{e({local:xe({},xl),remote:xe({},xl)})}))}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,r=["videoSend","audioSend","videoRecv","audioRecv"];let a=0,o=0,u=0,h=0;for(const m of r)e[m].forEach(((g,y)=>{if(!this.lossRateWindowStats[t-1][m][y]||!this.lossRateWindowStats[0][m][y])return;const E=this.lossRateWindowStats[t-1][m][y].packets-this.lossRateWindowStats[0][m][y].packets,A=this.lossRateWindowStats[t-1][m][y].packetsLost-this.lossRateWindowStats[0][m][y].packetsLost;m==="videoSend"||m==="audioSend"?(a+=E,u+=A):(o+=E,h+=A),Number.isNaN(E)||Number.isNaN(E)?g.packetLostRate=0:g.packetLostRate=E<=0||A<=0?0:A/(E+A)}));e.sendPacketLossRate=a<=0||u<=0?0:u/(a+u),e.recvPacketLossRate=o<=0||h<=0?0:h/(o+h)}},Qse=class extends fD{constructor(){super(...arguments),mt(this,"_stats",z0),mt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=Ro(z0);const r=t.filter((o=>o.type==="ssrc"));this.processSSRCStats(r);const a=t.find((o=>o.type==="VideoBwe"));a&&this.processBandwidthStats(a),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach((t=>{var r;const a=je(r=t.id).call(r,"send");switch("".concat(t.mediaType,"_").concat(a?"send":"recv")){case"video_send":{const o=Ro(R5);o.codec=t.googCodecName,o.adaptionChangeReason="none",t.googCpuLimitedResolution&&(o.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(o.adaptionChangeReason="bandwidth"),o.avgEncodeMs=Number(t.googAvgEncodeMs),o.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},o.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},o.firsCount=Number(t.googFirReceived),o.nacksCount=Number(t.googNacksReceived),o.plisCount=Number(t.googPlisReceived),o.frameCount=Number(t.framesEncoded),o.bytes=Number(t.bytesSent),o.packets=Number(t.packetsSent),o.packetsLost=Number(t.packetsLost),o.ssrc=Number(t.ssrc),o.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(o),this._stats.rtt=o.rttMs;break}case"video_recv":{const o=Ro(w5),u=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(o.codec=t.googCodecName,o.targetDelayMs=Number(t.googTargetDelayMs),o.renderDelayMs=Number(t.googRenderDelayMs),o.currentDelayMs=Number(t.googCurrentDelayMs),o.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),o.decodeMs=Number(t.googDecodeMs),o.maxDecodeMs=Number(t.googMaxDecodeMs),o.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},o.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},o.decodeFrameRate=Number(t.googFrameRateDecoded),o.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},o.jitterBufferMs=Number(t.googJitterBufferMs),o.firsCount=Number(t.googFirsSent),o.nacksCount=Number(t.googNacksSent),o.plisCount=Number(t.googPlisSent),o.framesDecodeCount=Number(t.framesDecoded),o.bytes=Number(t.bytesReceived),o.packets=Number(t.packetsReceived),o.packetsLost=Number(t.packetsLost),o.ssrc=Number(t.ssrc),o.packets>0&&!this.isFirstVideoReceived[o.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(o.ssrc),this.isFirstVideoReceived[o.ssrc]=!0),o.framesDecodeCount>0&&!this.isFirstVideoDecoded[o.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(o.ssrc,o.decodedFrame.width,o.decodedFrame.height),this.isFirstVideoDecoded[o.ssrc]=!0),u){const h=u.stats,m=Date.now()-u.lts;o.framesDecodeFreezeTime=h.framesDecodeFreezeTime,o.framesDecodeInterval=h.framesDecodeInterval,o.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[o.ssrc]?(u.lts=Date.now(),o.framesDecodeInterval=m,o.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?o.framesDecodeFreezeTime+=o.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):o.framesDecodeCount<u.stats.framesDecodeCount&&(o.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(o.ssrc,{stats:xe({},o),lts:Date.now()}),this._stats.videoRecv.push(o);break}case"audio_recv":{const o=Ro(A5);o.codec=t.googCodecName,o.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,o.decodingCNG=Number(t.googDecodingCNG),o.decodingCTN=Number(t.googDecodingCTN),o.decodingCTSG=Number(t.googDecodingCTSG),o.decodingNormal=Number(t.googDecodingNormal),o.decodingPLC=Number(t.googDecodingPLC),o.decodingPLCCNG=Number(t.googDecodingPLCCNG),o.expandRate=Number(t.googExpandRate),o.accelerateRate=Number(t.googAccelerateRate),o.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),o.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),o.speechExpandRate=Number(t.googSpeechExpandRate),o.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),o.jitterBufferMs=Number(t.googJitterBufferMs),o.jitterMs=Number(t.googJitterReceived),o.bytes=Number(t.bytesReceived),o.packets=Number(t.packetsReceived),o.packetsLost=Number(t.packetsLost),o.ssrc=Number(t.ssrc),o.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),o.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),o.receivedFrames>0&&!this.isFirstAudioReceived[o.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(o.ssrc),this.isFirstAudioReceived[o.ssrc]=!0),o.decodingNormal>0&&!this.isFirstAudioDecoded[o.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(o.ssrc),this.isFirstAudioDecoded[o.ssrc]=!0),this._stats.audioRecv.push(o);break}case"audio_send":{const o=Ro(C5);o.codec=t.googCodecName,o.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,o.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),o.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),o.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),o.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),o.bytes=Number(t.bytesSent),o.packets=Number(t.packetsSent),o.packetsLost=Number(t.packetsLost),o.ssrc=Number(t.ssrc),o.rttMs=Number(t.googRtt||0),this._stats.rtt=o.rttMs,this._stats.audioSend.push(o);break}}}))}_getStats(){return new Fe(((e,t)=>{this.pc.getStats(e,t)}))}statsResponsesToObjects(e){const t=[];return e.result().forEach((r=>{const a={id:r.id,timestamp:r.timestamp.valueOf().toString(),type:r.type};r.names().forEach((o=>{a[o]=r.stat(o)})),t.push(a)})),t}},K0=(function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e})({}),kC=(function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e})({}),pD=(function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e})({}),vs=(function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e})({});var M_=(function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e})(M_||{});function Y0(e,t,r,a){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:M_.kNone;if(!t)return;const u=Number(t[r]);if(typeof u!="number")return;const h=Number(t[a]);if(typeof h!="number")return;if(!e)return h?u/h*o:void 0;const m=Number(e[r]);if(typeof m!="number")return;const g=Number(e[a]);if(typeof g!="number")return;const y=h-g;return y?(u-m)/y*o:void 0}let O5=class extends fD{constructor(){super(...arguments),mt(this,"_stats",z0),mt(this,"report",void 0),mt(this,"lastDecodeVideoReceiverStats",new Map),mt(this,"lastVideoFramesRecv",new Map),mt(this,"lastVideoFramesSent",new Map),mt(this,"lastVideoFramesDecode",new Map),mt(this,"lastVideoFramesOutput",new Map),mt(this,"lastVideoJBDelay",new Map),mt(this,"lastAudioJBDelay",new Map),mt(this,"mediaBytesSent",new Map),mt(this,"mediaBytesRetransmit",new Map),mt(this,"mediaBytesTargetEncode",new Map),mt(this,"lastDecodeAudioReceiverStats",new Map),mt(this,"lastAudioConcealment",new Map),mt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Ro(z0),this.report.forEach((e=>{switch(e.type){case vs.OUTBOUND:case vs.INBOUND:{const t=e.mediaType||e.kind,r=!t&&"frameWidth"in e,a=!t&&!("frameWidth"in e);e.type===vs.OUTBOUND?t==="audio"||a?this.processAudioOutboundStats(e):(t==="video"||r)&&this.processVideoOutboundStats(e):e.type===vs.INBOUND&&(t==="audio"||a?this.processAudioInboundStats(e):(t==="video"||r)&&this.processVideoInboundStats(e));break}case vs.TRANSPORT:{const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case vs.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}})),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:xe({},xl),remote:xe({},xl)};return e.forEach((r=>{let a;if(r.type===vs.TRANSPORT&&(a=e.get(r.selectedCandidatePairId)),r.type===vs.CANDIDATE_PAIR&&r.selected&&(a=r),a){const o=(u,h)=>{u.type=h.type,u.id=h.id,h.address&&(u.address=h.address),h.candidateType&&(u.candidateType=h.candidateType),h.port&&(u.port=h.port),h.priority&&(u.priority=h.priority),h.protocol&&(u.protocol=h.protocol),h.relayProtocol&&(u.relayProtocol=h.relayProtocol)};if(a.localCandidateId){const u=e.get(a.localCandidateId);u&&o(t.local,u)}if(a.remoteCandidateId){const u=e.get(a.remoteCandidateId);u&&o(t.remote,u)}}})),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach((t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)})),this._stats.audioSend.forEach((t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)})),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===vs.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===vs.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===vs.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(xe({},t),xe({},this.stats.selectedCandidatePair.localCandidate)),e.type===vs.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(xe({},t),xe({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find((a=>a.ssrc===e.ssrc));t||(t=Ro(A5),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const r=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=Y0(r,t,"totalProcessingDelay","jitterBufferEmittedCount",M_.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),this.calculateAudioFreeze(t,r,e),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,xe({},t))}calculateAudioFreeze(e,t,r){const a=this.lastAudioConcealment.get(e.ssrc);if(t!=null&&a!=null){const o=a.lts,u=r.timestamp,h=u-o;if(h<=0)return;const m=e.concealedSamples-t.concealedSamples-0,g=a.nonSilent+m,y=e.totalSamplesReceived-t.totalSamplesReceived;if(y<=0)return;const E=80*y/h,A=200*y/h,O=h/y;let N=0;e.freezeSamples80=t.freezeSamples80,e.freezeMs80=t.freezeMs80,g>E&&(a.plc80>0?(e.freezeSamples80+=m,e.freezeMs80+=Math.round(m*O)):(e.freezeSamples80+=g,e.freezeMs80+=Math.round(g*O)),N=a.plc80+1);let B=0;e.freezeSamples200=t.freezeSamples200,e.freezeMs200=t.freezeMs200,g>A&&(a.plc200>0?(e.freezeSamples200+=m,e.freezeMs200+=Math.round(m*O)):(e.freezeSamples200+=g,e.freezeMs200+=Math.round(g*O)),B=a.plc200+1),this.lastAudioConcealment.set(e.ssrc,{nonSilent:m,lts:u,plc80:N,plc200:B})}else e.freezeSamples80=0,e.freezeSamples200=0,e.freezeMs80=0,e.freezeMs200=0,this.lastAudioConcealment.set(e.ssrc,{nonSilent:0,lts:r.timestamp,plc80:0,plc200:0})}processVideoInboundStats(e){let t=this._stats.videoRecv.find((h=>h.ssrc===e.ssrc));t||(t=Ro(w5),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const r=this.lastDecodeVideoReceiverStats.get(t.ssrc),a=this.lastVideoFramesDecode.get(t.ssrc),o=this.lastVideoFramesOutput.get(t.ssrc),u=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){const h=t.decodedFrame?t.decodedFrame.width:0,m=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,h,m),this.isFirstVideoDecoded[t.ssrc]=!0}if(r){const h=r.stats,m=u-r.lts;t.framesDecodeFreezeTime=h.framesDecodeFreezeTime,t.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&m>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(r.lts=Date.now(),t.framesDecodeInterval=m,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<h.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(r.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-r.qpSum)/(e.framesDecoded-r.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=Y0(r?.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=Y0(r?.stats,t,"totalProcessingDelay","framesDecodeCount",M_.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=Y0(r?.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",M_.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=Y0(r?.stats,t,"totalInterFrameDelay","framesDecodeCount",M_.kMillisecondsFromSeconds),a&&u-a.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-a.count)/((u-a.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:u,rate:t.decodeFrameRate})):a?t.decodeFrameRate=a.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:u,rate:0}),t.framesDroppedCount&&e.framesReceived&&(o&&u-o.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-o.count)/((u-o.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:u,rate:Math.max(t.outputFrameRate,0)})):o?t.outputFrameRate=o.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:u,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:xe({},t),lts:r?r.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find((a=>a.ssrc===e.ssrc));t||(t=Ro(R5),this._stats.videoSend.push(t));const r=this.mediaBytesSent.get(e.ssrc);if(r)r.add(e.bytesSent);else{const a=new hD(10);a.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,a)}if(e.retransmittedBytesSent!==void 0){const a=this.mediaBytesRetransmit.get(e.ssrc);if(a)a.add(e.retransmittedBytesSent);else{const o=new hD(10);o.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,o)}}if(e.totalEncodedBytesTarget){const a=this.mediaBytesTargetEncode.get(e.ssrc);if(a)a.add(e.totalEncodedBytesTarget);else{const o=new hD(10);o.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,o)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,t.targetBitrate=e.targetBitrate,e.totalEncodeTime&&e.framesEncoded){const a=this.lastEncoderMs.get(e.ssrc);if(!a||a.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const o=e.framesEncoded-a.lastFrameCount,u=e.totalEncodeTime-a.lastEncoderTime;t.avgEncodeMs=1e3*u/o}}if(e.framesEncoded&&e.qpSum){const a=this.lastEncoderMs.get(e.ssrc);!a||a.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-a.lastQpSum)/(e.framesEncoded-a.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const a=this.findRemoteStatsId(e.ssrc,vs.REMOTE_INBOUND);a&&this.processRemoteInboundStats(a,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find((r=>r.ssrc===e.ssrc));if(t||(t=Ro(C5),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const r=this.findRemoteStatsId(e.ssrc,vs.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,t)}}findRemoteStatsId(e,t){var r;const a=Array.from(Pi(r=this.report).call(r)).find((o=>o.type===t&&o.ssrc===e));return a?a.id:null}processVideoMediaSource(e,t){const r=this.report.get(e);r&&r.width&&r.height&&r.framesPerSecond&&(t.inputFrame={width:r.width,height:r.height,frameRate:r.framesPerSecond})}processAudioMediaSource(e,t){const r=this.report.get(e);r&&(t.inputLevel=r.audioLevel)}processVideoTrackSenderStats(e,t,r){var a,o,u,h;const m=t?this.report.get(t):void 0,g=(a=m?.framesSent)!==null&&a!==void 0?a:e.framesSent;if(typeof g!="number")return;let y=(o=m?.frameWidth)!==null&&o!==void 0?o:e.frameWidth,E=(u=m?.frameHeight)!==null&&u!==void 0?u:e.frameHeight,A=(h=m?.framesPerSecond)!==null&&h!==void 0?h:e.framesPerSecond;if(typeof y=="number"&&typeof E=="number"||(y=0,E=0),A==null){const O=Date.now(),N=this.lastVideoFramesSent.get(r.ssrc);N&&O-N.lts>=800?(A=Math.round((g-N.count)/((O-N.lts)/1e3)),this.lastVideoFramesSent.set(r.ssrc,{count:g,lts:O,rate:A})):N?A=N.rate:this.lastVideoFramesSent.set(r.ssrc,{count:g,lts:O,rate:0})}r.sentFrame={width:y,height:E,frameRate:Math.max(0,A)}}processVideoTrackReceiverStats(e,t,r){var a,o,u,h,m;const g=t?this.report.get(t):void 0,y=(a=g?.framesReceived)!==null&&a!==void 0?a:e.framesReceived,E=(o=g?.frameWidth)!==null&&o!==void 0?o:e.frameWidth,A=(u=g?.frameHeight)!==null&&u!==void 0?u:e.frameHeight,O=(h=g?.jitterBufferDelay)!==null&&h!==void 0?h:e.jitterBufferDelay,N=(m=g?.jitterBufferEmittedCount)!==null&&m!==void 0?m:e.jitterBufferEmittedCount;if(typeof y=="number"){const B=this.lastVideoFramesRecv.get(r.ssrc),U=Date.now();r.framesReceivedCount=y;let V=0;B&&U-B.lts>=800?(V=Math.round((y-B.count)/((U-B.lts)/1e3)),this.lastVideoFramesRecv.set(r.ssrc,{count:y,lts:U,rate:V})):B?V=B.rate:this.lastVideoFramesRecv.set(r.ssrc,{count:y,lts:U,rate:0}),r.receivedFrame={width:E||0,height:A||0,frameRate:V||0},r.decodedFrame={width:E||0,height:A||0,frameRate:r.decodeFrameRate||0},r.outputFrame={width:E||0,height:A||0,frameRate:r.outputFrameRate||r.decodeFrameRate||0}}if(O&&N){const B=this.lastVideoJBDelay.get(r.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let U=B.jitterBufferMs;const V=N-B.jitterBufferEmittedCount;V>0&&(U=1e3*(O-B.jitterBufferDelay)/V),r.jitterBufferMs=U,r.currentDelayMs=Math.round(U),this.lastVideoJBDelay.set(r.ssrc,{jitterBufferDelay:O,jitterBufferEmittedCount:N,jitterBufferMs:r.currentDelayMs})}}processAudioTrackSenderStats(e,t,r){var a,o,u,h;const m=t?this.report.get(t):void 0,g=(a=(o=m?.echoReturnLoss)!==null&&o!==void 0?o:e.echoReturnLoss)!==null&&a!==void 0?a:0,y=(u=(h=m?.echoReturnLossEnhancement)!==null&&h!==void 0?h:e.echoReturnLossEnhancement)!==null&&u!==void 0?u:0;r.aecReturnLoss=g,r.aecReturnLossEnhancement=y}processAudioTrackReceiverStats(e,t,r){var a,o,u,h,m,g,y,E,A;const O=t?this.report.get(t):void 0,N=(a=O?.removedSamplesForAcceleration)!==null&&a!==void 0?a:e.removedSamplesForAcceleration,B=(o=O?.totalSamplesReceived)!==null&&o!==void 0?o:e.totalSamplesReceived,U=(u=O?.jitterBufferDelay)!==null&&u!==void 0?u:e.jitterBufferDelay,V=(h=O?.jitterBufferEmittedCount)!==null&&h!==void 0?h:e.jitterBufferEmittedCount,K=(m=O?.audioLevel)!==null&&m!==void 0?m:e?.audioLevel,z=(g=O?.totalSamplesDuration)!==null&&g!==void 0?g:e?.totalSamplesDuration,J=(y=O?.concealedSamples)!==null&&y!==void 0?y:e.concealedSamples,ae=(E=O?.silentConcealedSamples)!==null&&E!==void 0?E:e.silentConcealedSamples,ie=(A=O?.concealmentEvents)!==null&&A!==void 0?A:e.concealmentEvents;if(typeof B=="number"&&(r.totalSamplesReceived=B),typeof ae=="number"&&(r.silentConcealedSamples=ae),typeof ie=="number"&&(r.concealmentEvents=ie),typeof J=="number"&&(r.concealedSamples=J),N&&B&&(r.accelerateRate=N/B),U&&V){const le=this.lastAudioJBDelay.get(r.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let ye=le.jitterBufferMs;const we=V-le.jitterBufferEmittedCount;we>0&&(ye=1e3*(U-le.jitterBufferDelay)/we),r.jitterBufferMs=Math.round(ye),this.lastAudioJBDelay.set(r.ssrc,{jitterBufferDelay:U,jitterBufferEmittedCount:V,jitterBufferMs:r.jitterBufferMs})}r.outputLevel=K;let ee=1920;z&&B&&(ee=B/z/50,r.receivedFrames=Math.round(B/ee)),J&&(r.droppedFrames=Math.round(J/ee))}processRemoteInboundStats(e,t){const r=this.report.get(e);r&&(t.packetsLost=r.packetsLost,r.roundTripTime&&(t.rttMs=1e3*r.roundTripTime),r.jitter&&(t.jitterMs=1e3*r.jitter),r.timestamp&&(t.timestamp=r.timestamp))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const r=t.mimeType.match(/\/(.*)$/);return r&&r[1]?r[1]:""}updateSendBitrate(){let e=0,t=null,r=null;this.mediaBytesSent.forEach((o=>{e+=o.diffMean()})),this.mediaBytesRetransmit.forEach((o=>{t=t===null?o.diffMean():t+o.diffMean()})),this.mediaBytesTargetEncode.forEach((o=>{r=r===null?o.diffMean():r+o.diffMean()}));const a=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*a/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),r!==null&&(this._stats.bitrate.targetEncoded=8*r/(this.options.updateInterval/1e3))}},eoe=class extends fD{updateStats(){return Fe.resolve()}};function mD(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const u=(function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null})();return u?u<76?new Qse(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:a,firstVideoDecodedTimeout:o}):new O5(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:a,firstVideoDecodedTimeout:o}):(function(h){if(!window.RTCStatsReport)return!1;const m=h.getStats();return!!(m instanceof Fe||(function(g){return!!g&&(typeof g=="object"||typeof g=="function")&&typeof g.then=="function"})(m))})(e)?new O5(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:a,firstVideoDecodedTimeout:o}):new eoe(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:a,firstVideoDecodedTimeout:o})}const I5="websdk_ng_install_id";function gD(){try{if(X("INSTALL_ID"))return X("INSTALL_ID");let e=window.localStorage.getItem(I5);return e||(e=xp(),window.localStorage.setItem(I5,e)),sn("INSTALL_ID",e),e}catch{return}}const Fs=(function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){const r=t[1],a=t[2];return"".concat(r,".").concat(a)}return"4.0.0.999"})("4.24.0"),_D=(function(){try{return JSON.parse("true")===!0}catch{return!0}})();let Dp=(function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e})({});const ti=(function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),r=["t","s","t"];r.splice(1,0,"e");const a=r.join(""),o=[];for(let m=0;m<6;m++)o.push("1");const u=o.join(""),h={};return h[e]=a,h[t]=u,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})})();window.DEFAULT_TURN_CONFIG=ti;const LC={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},vD={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},yD="v4.24.0-0-gf2267710-dirty(7/31/2025, 7:00:42 PM)",ED={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0},In=xe(xe(xe(xe({},ED),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:vD,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},LC),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!1,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1});function sn(e,t,r){var a,o,u;je(a=Object.keys(In)).call(a,e)&&(!r&&je(o=Object.keys(Vc)).call(o,e)||(In[e]=t,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS"||t!==!0||(In.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&t&&(u=!!t,In.USE_NEW_NETWORK_CONFIG=u,u&&(In.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],In.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],In.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],In.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],In.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",In.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",In.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(In.ENABLE_INSTANT_VIDEO=!0,In.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(In.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&t&&(In.NEW_TURN_MODE||(In.NEW_TURN_MODE=4))))}function X(e){return In[e]}_D||(In.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],In.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],In.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],In.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],In.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],In.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],In.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",In.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",In.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",In.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",In.AREAS=["NORTH_AMERICA","OVERSEA"]);let N5=(function(e){return e[e.REALTIME=1]="REALTIME",e})({});const Vc={};var gt=(function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",e.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",e.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",e.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",e.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",e.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",e.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e})(gt||{});let q0=(function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e})({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const x5=128,toe=96,D5=1e3,U_=10;let noe=0;var P5=(()=>{var e={8:(a,o,u)=>{u.r(o),u.d(o,{Parser:()=>we,Printer:()=>Xt,parse:()=>Ue,print:()=>Je});const h=`
`,m="".concat("\r").concat(h),g=" ";let y;function E(Re){return Re>="0"&&Re<="9"}function A(Re){return Re>="!"&&Re<="~"}function O(Re){return A(Re)||Re>=""&&Re<=""}function N(Re){return Re==="!"||Re>="#"&&Re<="'"||Re>="*"&&Re<="+"||Re>="-"&&Re<="."||Re>="0"&&Re<="9"||Re>="A"&&Re<="Z"||Re>="^"&&Re<="~"}function B(Re){return Re>="1"&&Re<="9"}function U(Re){return Re>="A"&&Re<="Z"||Re>="a"&&Re<="z"}function V(Re){return Re==="d"||Re==="h"||Re==="m"||Re==="s"}function K(Re){return Re>""&&Re<"	"||Re>"\v"&&Re<"\f"||Re>""&&Re<""}function z(Re){return U(Re)||E(Re)||Re==="+"||Re==="/"}function J(Re){return E(Re)||U(Re)||Re==="+"||Re==="/"||Re==="-"||Re==="_"}function ae(Re){return U(Re)||E(Re)||Re==="+"||Re==="/"}function ie(Re,M){var Q=Object.keys(Re);if(Object.getOwnPropertySymbols){var re=Object.getOwnPropertySymbols(Re);M&&(re=re.filter((function(De){return Object.getOwnPropertyDescriptor(Re,De).enumerable}))),Q.push.apply(Q,re)}return Q}function ee(Re){for(var M=1;M<arguments.length;M++){var Q=arguments[M]!=null?arguments[M]:{};M%2?ie(Object(Q),!0).forEach((function(re){le(Re,re,Q[re])})):Object.getOwnPropertyDescriptors?Object.defineProperties(Re,Object.getOwnPropertyDescriptors(Q)):ie(Object(Q)).forEach((function(re){Object.defineProperty(Re,re,Object.getOwnPropertyDescriptor(Q,re))}))}return Re}function le(Re,M,Q){return M in Re?Object.defineProperty(Re,M,{value:Q,enumerable:!0,configurable:!0,writable:!0}):Re[M]=Q,Re}(function(Re){Re.VERSION="v",Re.ORIGIN="o",Re.SESSION_NAME="s",Re.INFORMATION="i",Re.URI="u",Re.EMAIL="e",Re.PHONE="p",Re.CONNECTION="c",Re.BANDWIDTH="b",Re.TIME="t",Re.REPEAT="r",Re.ZONE_ADJUSTMENTS="z",Re.KEY="k",Re.ATTRIBUTE="a",Re.MEDIA="m"})(y||(y={}));class ye{consumeText(M,Q){let re=Q;for(;re<M.length;){const De=M[re];if(De==="\0"||De==="\r"||De===h)break;re+=1}if(re-Q==0)throw new Error("Invalid text, at ".concat(M));return re}consumeUnicastAddress(M,Q,re){return this.consumeTill(M,Q,g)}consumeOneOrMore(M,Q,re){let De=Q;for(;re(M[De]);)De++;if(De-Q==0)throw new Error("Invalid rule at ".concat(Q,"."));return De}consumeSpace(M,Q){if(M[Q]===g)return Q+1;throw new Error("Invalid space at ".concat(Q,"."))}consumeIP4Address(M,Q){let re=Q;for(let De=0;De<4;De++)if(re=this.consumeDecimalUChar(M,re),De!==3){if(M[re]!==".")throw new Error("Invalid IP4 address.");re++}return re}consumeDecimalUChar(M,Q){let re=Q;for(let vt=0;vt<3&&E(M[re]);vt++,re++);if(re-Q==0)throw new Error("Invalid decimal uchar.");const De=parseInt(M.slice(Q,re));if(De>=0&&De<=255)return re;throw new Error("Invalid decimal uchar")}consumeIP6Address(M,Q){let re=this.consumeHexpart(M,Q);return M[re]===":"&&(re+=1,re=this.consumeIP4Address(M,re)),re}consumeHexpart(M,Q){let re=Q;if(M[re]===":"&&M[re+1]===":"){re+=2;try{re=this.consumeHexseq(M,re)}catch{}return re}if(re=this.consumeHexseq(M,re),M[re]===":"&&M[re+1]===":"){re+=2;try{re=this.consumeHexseq(M,re)}catch{}return re}return re}consumeHexseq(M,Q){let re=Q;for(;re=this.consumeHex4(M,re),M[re]===":"&&M[re+1]!==":";)re+=1;return re}consumeHex4(M,Q){let re=0;for(;re<4;re++)if(!((De=M[Q+re])>="0"&&De<="9"||De>="a"&&De<="f"||De>="A"&&De<="F")){if(re===0)throw new Error("Invalid hex 4");break}var De;return Q+re}consumeFQDN(M,Q){let re=Q;for(;E(M[re])||U(M[re])||M[re]==="-"||M[re]===".";)re+=1;if(re-Q<4)throw new Error("Invalid FQDN");return re}consumeExtnAddr(M,Q){return this.consumeOneOrMore(M,Q,O)}consumeMulticastAddress(M,Q,re){switch(re){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(M,Q);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(M,Q);default:try{return this.consumeFQDN(M,Q)}catch{return this.consumeExtnAddr(M,Q)}}}consumeIP6MulticastAddress(M,Q){const re=this.consumeHexpart(M,Q);return M[re]==="/"?this.consumeInteger(M,re+1):re}consumeIP4MulticastAddress(M,Q){let re=Q+3;const De=M.slice(Q,re),vt=parseInt(De);if(vt<224||vt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let mn=0;mn<3;mn++){if(M[re]!==".")throw new Error("Invalid IP4 multicast address.");re+=1,re=this.consumeDecimalUChar(M,re)}return M[re]==="/"&&(re+=1),re=this.consumeTTL(M,re),M[re]==="/"&&(re=this.consumeInteger(M,re)),re}consumeInteger(M,Q){if(!B(M[Q]))throw new Error("Invalid integer.");for(Q+=1;E(M[Q]);)Q+=1;return Q}consumeTTL(M,Q){if(M[Q]==="0")return Q+1;if(!B(M[Q]))throw new Error("Invalid TTL.");Q+=1;for(let re=0;re<2&&E(M[Q]);re++)Q+=1;return Q}consumeToken(M,Q){return this.consumeOneOrMore(M,Q,N)}consumeTime(M,Q){let re=Q;if(M[re]==="0")return re+1;for(B(M[re])&&(re+=1);E(M[re]);)re++;if(re-Q<10)throw new Error("Invalid time");return re}consumeAddress(M,Q){return this.consumeTill(M,Q,g)}consumeTypedTime(M,Q){let re=Q;return re=this.consumeOneOrMore(M,re,E),V(M[re])?re+1:re}consumeRepeatInterval(M,Q){if(!B(M[Q]))throw new Error("Invalid repeat interval");for(Q+=1;E(M[Q]);)Q+=1;return V(M[Q])&&(Q+=1),Q}consumePort(M,Q){return this.consumeOneOrMore(M,Q,E)}consume(M,Q,re){for(let De=0;De<re.length;De++){if(Q+De>=M.length)throw new Error("consume exceeding value length");if(M[Q+De]!==re[De])throw new Error("consume ".concat(re," failed at ").concat(De))}return Q+re.length}consumeTill(M,Q,re){let De=Q;for(;De<M.length&&(typeof re!="string"||M[De]!==re)&&(typeof re!="function"||!re(M[De]));)De++;return De}}class we extends ye{constructor(){super(),le(this,"records",[]),le(this,"currentLine",0)}parse(M){const Q=this.probeEOL(M);this.records=M.split(Q).filter((qu=>!!ki(qu).call(qu))).map(this.parseLine),this.currentLine=0;const re=this.parseVersion(),De=this.parseOrigin(),vt=this.parseSessionName(),mn=this.parseInformation(),fr=this.parseUri(),Js=this.parseEmail(),Uo=this.parsePhone(),DS=this.parseConnection(),Zp=this.parseBandWidth(),mv=this.parseTimeFields(),XA=this.parseKey(),JA=this.parseSessionAttribute(),$s=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:re,origin:De,sessionName:vt,information:mn,uri:fr,emails:Js,phones:Uo,connection:DS,bandwidths:Zp,timeFields:mv,key:XA,attributes:JA,mediaDescriptions:$s}}getCurrentRecord(){const M=this.records[this.currentLine];if(!M)throw new Error("Record doesn't exit.");return M}probeEOL(M){for(let Q=0;Q<M.length;Q++)if(M[Q]===h)return M[Q-1]==="\r"?m:h;throw new Error("Invalid newline character.")}parseLine(M,Q){if(M.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const re=M[0];if(M[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:re,value:M.slice(2),line:Q,cur:0}}parseSessionAttribute(){const M=new bt;for(;this.currentLine<this.records.length;){const Q=this.getCurrentRecord();if(Q.type!==y.ATTRIBUTE)break;const re={attField:this.extractOneOrMore(Q,(De=>N(De)&&De!==":")),_cur:0};Q.value[Q.cur]===":"&&(Q.cur+=1,re.attValue=this.extractOneOrMore(Q,K)),M.parse(re),this.currentLine++}return M.digest()}parseMediaAttributes(M){const Q=new Rt(M);for(;this.currentLine<this.records.length;){const re=this.getCurrentRecord();if(re.type!==y.ATTRIBUTE)break;const De={attField:this.extractOneOrMore(re,(vt=>N(vt)&&vt!==":")),_cur:0};re.value[re.cur]===":"&&(re.cur+=1,De.attValue=this.extractOneOrMore(re,K)),Q.parse(De),this.currentLine++}return Q.digest()}parseKey(){const M=this.getCurrentRecord();if(M.type===y.KEY){if(M.value==="prompt"||M.value==="clear:"||M.value==="base64:"||M.value==="uri:")return M.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const M=this.getCurrentRecord();if(M.type===y.ZONE_ADJUSTMENTS){const Q=[];for(;;)try{const re=this.extract(M,this.consumeTime);this.consumeSpaceForRecord(M);let De=!1;M.value[M.cur]==="-"&&(De=!0,M.cur+=1);const vt=this.extract(M,this.consumeTypedTime);Q.push({time:re,typedTime:vt,back:De})}catch{break}if(Q.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,Q}return[]}parseRepeat(){const M=[];for(;;){const Q=this.getCurrentRecord();if(Q.type!==y.REPEAT)break;{const re=this.extract(Q,this.consumeRepeatInterval),De=this.parseTypedTime(Q);M.push({repeatInterval:re,typedTimes:De}),this.currentLine++}}return M}parseTypedTime(M){const Q=[];for(;;)try{this.consumeSpaceForRecord(M),Q.push(this.extract(M,this.consumeTypedTime))}catch{break}if(Q.length===0)throw new Error("Invalid typed time.");return Q}parseTime(){const M=this.getCurrentRecord(),Q=this.extract(M,this.consumeTime);this.consumeSpaceForRecord(M);const re=this.extract(M,this.consumeTime);return this.currentLine++,{startTime:Q,stopTime:re}}parseBandWidth(){const M=[];for(;this.currentLine<this.records.length;){const Q=this.getCurrentRecord();if(Q.type!==y.BANDWIDTH)break;{const re=this.extractOneOrMore(Q,N);if(Q.value[Q.cur]!==":")throw new Error("Invalid bandwidth field.");Q.cur++;const De=this.extractOneOrMore(Q,E);M.push({bwtype:re,bandwidth:De}),this.currentLine++}}return M}parseVersion(){const M=this.getCurrentRecord();if(M.type!==y.VERSION)throw new Error("first sdp record must be version");const Q=M.value.slice(0,this.consumeOneOrMore(M.value,0,E));if(Q.length!==M.value.length)throw new Error('invalid proto version, "v='.concat(M.value,'"'));return this.currentLine++,Q}parseOrigin(){const M=this.getCurrentRecord();if(M.type!==y.ORIGIN)throw new Error("second line of sdp must be origin");const Q=this.extractOneOrMore(M,O);this.consumeSpaceForRecord(M);const re=this.extractOneOrMore(M,E);this.consumeSpaceForRecord(M);const De=this.extractOneOrMore(M,E);this.consumeSpaceForRecord(M);const vt=this.extractOneOrMore(M,N);this.consumeSpaceForRecord(M);const mn=this.extractOneOrMore(M,N);this.consumeSpaceForRecord(M);const fr=this.extract(M,this.consumeUnicastAddress);return this.currentLine++,{username:Q,sessId:re,sessVersion:De,nettype:vt,addrtype:mn,unicastAddress:fr}}parseSessionName(){const M=this.getCurrentRecord();if(M.type===y.SESSION_NAME){const Q=this.extract(M,this.consumeText);return this.currentLine++,Q}}parseInformation(){const M=this.getCurrentRecord();if(M.type!==y.INFORMATION)return;const Q=this.extract(M,this.consumeText);return this.currentLine++,Q}parseUri(){const M=this.getCurrentRecord();if(M.type===y.URI)return this.currentLine++,M.value}parseEmail(){const M=[];for(;;){const Q=this.getCurrentRecord();if(Q.type!==y.EMAIL)break;M.push(Q.value),this.currentLine++}return M}parsePhone(){const M=[];for(;;){const Q=this.getCurrentRecord();if(Q.type!==y.PHONE)break;M.push(Q.value),this.currentLine++}return M}parseConnection(){const M=this.getCurrentRecord();if(M.type===y.CONNECTION){const Q=this.extractOneOrMore(M,N);this.consumeSpaceForRecord(M);const re=this.extractOneOrMore(M,N);this.consumeSpaceForRecord(M);const De=this.extract(M,this.consumeAddress);return this.currentLine++,{nettype:Q,addrtype:re,address:De}}}parseMedia(){const M=this.getCurrentRecord(),Q=this.extract(M,this.consumeToken);this.consumeSpaceForRecord(M);let re=this.extract(M,this.consumePort);M.value[M.cur]==="/"&&(M.cur+=1,re+=this.extract(M,this.consumeInteger)),this.consumeSpaceForRecord(M);const De=[];for(De.push(this.extract(M,this.consumeToken));M.value[M.cur]==="/";)M.cur+=1,De.push(this.extract(M,this.consumeToken));if(De.length===0)throw new Error("Invalid proto");const vt=this.parseFmt(M);return this.currentLine++,{mediaType:Q,port:re,protos:De,fmts:vt}}parseTimeFields(){const M=[];for(;this.getCurrentRecord().type===y.TIME;){const Q=this.parseTime(),re=this.parseRepeat(),De=this.parseZone();M.push({time:Q,repeats:re,zones:De})}return M}parseMediaDescription(){const M=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===y.MEDIA;){const Q=this.parseMedia(),re=this.parseInformation(),De=this.parseConnections(),vt=this.parseBandWidth(),mn=this.parseKey(),fr=this.parseMediaAttributes(Q);M.push({media:Q,information:re,connections:De,bandwidths:vt,key:mn,attributes:fr})}return M}parseConnections(){const M=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===y.CONNECTION;)M.push(this.parseConnection());return M}parseFmt(M){const Q=[];for(;;)try{this.consumeSpaceForRecord(M),Q.push(this.extract(M,this.consumeToken))}catch{break}if(Q.length===0)throw new Error("Invalid fmts");return Q}extract(M,Q){for(var re=arguments.length,De=new Array(re>2?re-2:0),vt=2;vt<re;vt++)De[vt-2]=arguments[vt];const mn=Q.call(this,M.value,M.cur,...De),fr=M.value.slice(M.cur,mn);return M.cur=mn,fr}extractOneOrMore(M,Q){const re=this.consumeOneOrMore(M.value,M.cur,Q),De=M.value.slice(M.cur,re);return M.cur=re,De}consumeSpaceForRecord(M){if(M.value[M.cur]!==g)throw new Error("Invalid space at ".concat(M.cur,"."));M.cur+=1}}class Ne extends ye{constructor(){super(...arguments),le(this,"attributes",void 0),le(this,"digested",!1)}extractOneOrMore(M,Q,re){const De=this.consumeOneOrMore(M.attValue,M._cur,Q),vt=M.attValue.slice(M._cur,De),[mn,fr]=re||[];if(typeof mn=="number"&&vt.length<mn)throw new Error("error in length, should be more or equal than ".concat(mn," characters."));if(typeof fr=="number"&&vt.length>fr)throw new Error("error in length, should be less or equal than ".concat(fr," characters."));return M._cur=De,vt}consumeAttributeSpace(M){if(M.attValue[M._cur]!==g)throw new Error("Invalid space at ".concat(M._cur,"."));M._cur+=1}extract(M,Q){if(!M.attValue)throw new Error("Nothing to extract from attValue.");for(var re=arguments.length,De=new Array(re>2?re-2:0),vt=2;vt<re;vt++)De[vt-2]=arguments[vt];const mn=Q.call(this,M.attValue,M._cur,...De),fr=M.attValue.slice(M._cur,mn);return M._cur=mn,fr}atEnd(M){if(!M.attValue)throw new Error;return M._cur>=M.attValue.length}peekChar(M){if(!M.attValue)throw new Error;return M.attValue[M._cur]}peek(M,Q){if(!M.attValue)throw new Error;for(let re=0;re<Q.length;re++)if(Q[re]!==M.attValue[M._cur+re])return!1;return!0}parseIceUfrag(M){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(M,z,[4,256])}parseIcePwd(M){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(M,z,[22,256])}parseIceOptions(M){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const Q=[];for(;!this.atEnd(M);){Q.push(this.extractOneOrMore(M,z));try{this.consumeAttributeSpace(M)}catch(re){if(this.atEnd(M))break;throw re}}this.attributes.iceOptions=Q}parseFingerprint(M){const Q=this.extract(M,this.consumeToken);this.consumeAttributeSpace(M);const re=this.extract(M,this.consumeTill);this.attributes.fingerprints.push({hashFunction:Q,fingerprint:re})}parseExtmap(M){const Q=this.extractOneOrMore(M,E);let re;this.peekChar(M)==="/"&&(this.extract(M,this.consume,"/"),re=this.extract(M,this.consumeToken)),this.consumeAttributeSpace(M);const De=this.extract(M,this.consumeTill,g),vt=ee(ee({entry:parseInt(Q,10)},re&&{direction:re}),{},{extensionName:De});this.peekChar(M)===g&&(this.consumeAttributeSpace(M),vt.extensionAttributes=this.extract(M,this.consumeTill)),this.attributes.extmaps.push(vt)}parseSetup(M){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const Q=this.extract(M,this.consumeTill);if(Q!=="active"&&Q!=="passive"&&Q!=="actpass"&&Q!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=Q}}class bt extends Ne{constructor(){super(...arguments),le(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(M){if(this.digested)throw new Error("already digested");try{switch(M.attField){case"group":this.parseGroup(M);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(M);break;case"ice-pwd":this.parseIcePwd(M);break;case"ice-options":this.parseIceOptions(M);break;case"fingerprint":this.parseFingerprint(M);break;case"setup":this.parseSetup(M);break;case"tls-id":this.parseTlsId(M);break;case"identity":this.parseIdentity(M);break;case"extmap":this.parseExtmap(M);break;case"msid-semantic":this.parseMsidSemantic(M);break;default:M.ignored=!0,this.attributes.unrecognized.push(M)}}catch(Q){throw console.error("parsing session attribute ".concat(M.attField,' error, "a=').concat(M.attField,":").concat(M.attValue,'"')),Q}if(!M.ignored&&M.attValue&&!this.atEnd(M))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(M){const Q=this.extract(M,this.consumeToken),re=[];for(;!this.atEnd(M)&&this.peekChar(M)===g;)this.consumeAttributeSpace(M),re.push(this.extract(M,this.consumeToken));this.attributes.groups.push({semantic:Q,identificationTag:re})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(M){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(M,J)}parseIdentity(M){const Q=this.extractOneOrMore(M,ae),re=[];for(;!this.atEnd(M)&&this.peekChar(M)===g;){this.consumeAttributeSpace(M);const De=this.extract(M,this.consumeToken);this.extract(M,this.consume,"=");const vt=this.extractOneOrMore(M,(mn=>mn!==g&&K(mn)));re.push({name:De,value:vt})}this.attributes.identities.push({assertionValue:Q,extensions:re})}parseMsidSemantic(M){this.peekChar(M)===g&&this.consumeAttributeSpace(M);const Q={semantic:this.extract(M,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(M)}catch{break}if(this.peekChar(M)==="*"){this.extract(M,this.consume,"*"),Q.applyForAll=!0;break}{const re=this.extract(M,this.consumeTill,g);Q.identifierList.push(re)}}this.attributes.msidSemantic=Q}}class Rt extends Ne{constructor(M){super(),le(this,"attributes",void 0),M.protos.indexOf("RTP")!==-1||M.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(M){if(this.digested)throw new Error("already digested");try{switch(M.attField){case"extmap":this.parseExtmap(M);break;case"setup":this.parseSetup(M);break;case"ice-ufrag":this.parseIceUfrag(M);break;case"ice-pwd":this.parseIcePwd(M);break;case"ice-options":this.parseIceOptions(M);break;case"candidate":this.parseCandidate(M);break;case"remote-candidate":this.parseRemoteCandidate(M);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(M);break;case"rtpmap":this.parseRtpmap(M);break;case"ptime":this.parsePtime(M);break;case"maxptime":this.parseMaxPtime(M);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(M);break;case"ssrc":this.parseSSRC(M);break;case"fmtp":this.parseFmtp(M);break;case"rtcp-fb":this.parseRtcpFb(M);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(M);break;case"mid":this.parseMid(M);break;case"msid":this.parseMsid(M);break;case"imageattr":this.parseImageAttr(M);break;case"rid":this.parseRid(M);break;case"simulcast":this.parseSimulcast(M);break;case"sctp-port":this.parseSctpPort(M);break;case"max-message-size":this.parseMaxMessageSize(M);break;case"ssrc-group":this.parseSSRCGroup(M);break;default:M.ignored=!0,this.attributes.unrecognized.push(M)}}catch(Q){throw console.error("parsing media attribute ".concat(M.attField,' error, "a=').concat(M.attField,":").concat(M.attValue,'"')),Q}if(!M.ignored&&M.attValue&&!this.atEnd(M))throw new Error("attribute parsing error")}parseCandidate(M){const Q=this.extractOneOrMore(M,z,[1,32]);this.consumeAttributeSpace(M);const re=this.extractOneOrMore(M,E,[1,5]);this.consumeAttributeSpace(M);const De=this.extract(M,this.consumeToken);this.consumeAttributeSpace(M);const vt=this.extractOneOrMore(M,E,[1,10]);this.consumeAttributeSpace(M);const mn=this.extract(M,this.consumeAddress);this.consumeAttributeSpace(M);const fr=this.extract(M,this.consumePort);this.consumeAttributeSpace(M),this.extract(M,this.consume,"typ"),this.consumeAttributeSpace(M);const Js={foundation:Q,componentId:re,transport:De,priority:vt,connectionAddress:mn,port:fr,type:this.extract(M,this.consumeToken),extension:{}};for(this.peek(M," raddr")&&(this.extract(M,this.consume," raddr"),this.consumeAttributeSpace(M),Js.relAddr=this.extract(M,this.consumeAddress)),this.peek(M," rport")&&(this.extract(M,this.consume," rport"),this.consumeAttributeSpace(M),Js.relPort=this.extract(M,this.consumePort));this.peekChar(M)===g;){this.consumeAttributeSpace(M);const Uo=this.extract(M,this.consumeToken);this.consumeAttributeSpace(M),Js.extension[Uo]=this.extractOneOrMore(M,A)}this.attributes.candidates.push(Js)}parseRemoteCandidate(M){const Q=[];for(;;){const re=this.extractOneOrMore(M,E,[1,5]);this.consumeAttributeSpace(M);const De=this.extract(M,this.consumeAddress);this.consumeAttributeSpace(M);const vt=this.extract(M,this.consumePort);Q.push({componentId:re,connectionAddress:De,port:vt});try{this.consumeAttributeSpace(M)}catch{break}}this.attributes.remoteCandidatesList.push(Q)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(M){const Q=this.extract(M,this.consumeToken);this.consumeAttributeSpace(M);const re=this.extract(M,this.consumeTill,"/");this.extract(M,this.consume,"/");const De={encodingName:re,clockRate:this.extractOneOrMore(M,E)};this.atEnd(M)||this.peekChar(M)!=="/"||(this.extract(M,this.consume,"/"),De.encodingParameters=parseInt(this.extract(M,this.consumeTill),10));const vt=this.attributes.payloads.find((mn=>mn.payloadType===parseInt(Q,10)));vt?vt.rtpMap=De:this.attributes.payloads.push({payloadType:parseInt(Q,10),rtpMap:De,rtcpFeedbacks:[]})}parsePtime(M){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(M,this.consumeTill)}parseMaxPtime(M){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(M,this.consumeTill)}parseDirection(M){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=M.attField}parseSSRC(M){const Q=this.extractOneOrMore(M,E);this.consumeAttributeSpace(M);const re=this.extract(M,this.consumeTill,":");let De;this.peekChar(M)===":"&&(this.extract(M,this.consume,":"),De=this.extract(M,this.consumeTill));const vt=this.attributes.ssrcs.find((mn=>mn.ssrcId===parseInt(Q,10)));vt?vt.attributes[re]=De:this.attributes.ssrcs.push({ssrcId:parseInt(Q,10),attributes:{[re]:De}})}parseFmtp(M){const Q=this.extract(M,this.consumeTill,g);this.consumeAttributeSpace(M);const re=this.extract(M,this.consumeTill),De={};re.split(";").forEach((mn=>{let[fr,Js]=mn.split("=");fr=ki(fr).call(fr);const Uo=typeof Js=="string"?ki(Js).call(Js):null;typeof fr=="string"&&fr.length>0&&(De[fr]=Uo)}));const vt=this.attributes.payloads.find((mn=>mn.payloadType===parseInt(Q,10)));vt?vt.fmtp={parameters:De}:this.attributes.payloads.push({payloadType:parseInt(Q,10),rtcpFeedbacks:[],fmtp:{parameters:De}})}parseFmtParameters(M){const Q={},re=this.extract(M,this.consumeTill,"=");M._cur++;const De=this.extract(M,this.consumeTill,";");for(Q[re]=De;M.attValue[M._cur]===";";){const vt=this.extract(M,this.consumeTill,"=");M._cur++;const mn=this.extract(M,this.consumeTill,";");Q[vt]=mn}return Q}parseRtcpFb(M){let Q="";Q=this.peekChar(M)==="*"?this.extract(M,this.consume,"*"):this.extract(M,this.consumeTill,g),this.consumeAttributeSpace(M);const re=this.extract(M,this.consumeTill,g);let De;if(re==="trr-int")De={type:re,interval:this.extract(M,this.consumeTill)};else{const vt={type:re};this.peekChar(M)===g&&(this.consumeAttributeSpace(M),vt.parameter=this.extract(M,this.consumeToken),this.peekChar(M)===g&&(vt.additional=this.extract(M,this.consumeTill))),De=vt}if(Q==="*")this.attributes.rtcpFeedbackWildcards.push(De);else{const vt=this.attributes.payloads.find((mn=>mn.payloadType===parseInt(Q,10)));vt?vt.rtcpFeedbacks.push(De):this.attributes.payloads.push({payloadType:parseInt(Q,10),rtcpFeedbacks:[De]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(M){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const Q={port:this.extract(M,this.consumePort)};this.peekChar(M)===g&&(this.consumeAttributeSpace(M),Q.netType=this.extractOneOrMore(M,N),this.consumeAttributeSpace(M),Q.addressType=this.extractOneOrMore(M,N),this.consumeAttributeSpace(M),Q.address=this.extract(M,this.consumeAddress)),this.attributes.rtcp=Q}parseMsid(M){const Q={id:this.extractOneOrMore(M,N,[1,64])};this.peekChar(M)===g&&(this.consumeAttributeSpace(M),Q.appdata=this.extractOneOrMore(M,N,[1,64])),this.attributes.msids.push(Q)}parseImageAttr(M){this.attributes.imageattr.push(M.attValue)}parseRid(M){const Q=this.extractOneOrMore(M,(De=>U(De)||E(De)||De==="_"||De==="-"));this.consumeAttributeSpace(M);const re={id:Q,direction:this.extract(M,this.consumeToken),params:[]};if(this.peekChar(M)===g){if(this.consumeAttributeSpace(M),this.peek(M,"pt=")){this.extract(M,this.consume,"pt=");const De=[];for(;;){const vt=this.extract(M,this.consumeToken);De.push(vt);try{this.extract(M,this.consume,",")}catch{break}}re.payloads=De,this.peekChar(M)===g&&this.extract(M,this.consume,g)}for(;;){const De=this.extract(M,this.consumeToken);switch(De){case"depend":{const vt={type:De,rids:this.extract(M,this.consume,"=").split(",")};re.params.push(vt);break}default:{const vt={type:De};this.peekChar(M)==="="&&(this.extract(M,this.consume,"="),vt.val=this.extract(M,this.consumeTill,";")),re.params.push(vt)}}try{this.extract(M,this.consume,";")}catch{break}}}this.attributes.rids.push(re)}parseSimulcast(M){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=M.attValue,this.extract(M,this.consumeTill)}parseSctpPort(M){this.attributes.sctpPort=this.extractOneOrMore(M,E,[1,5])}parseMaxMessageSize(M){this.attributes.maxMessageSize=this.extractOneOrMore(M,E,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(M){this.attributes.mid=this.extract(M,this.consumeToken)}parseSSRCGroup(M){const Q=this.extract(M,this.consumeToken),re=[];for(;;)try{this.consumeAttributeSpace(M);const De=this.extract(M,this.consumeInteger);re.push(parseInt(De,10))}catch{break}this.attributes.ssrcGroups.push({semantic:Q,ssrcIds:re})}}function ft(Re,M,Q){return M in Re?Object.defineProperty(Re,M,{value:Q,enumerable:!0,configurable:!0,writable:!0}):Re[M]=Q,Re}class Xt{constructor(){ft(this,"eol",m)}print(M,Q){let re="";return Q&&(this.eol=Q),re+=this.printVersion(M.version),re+=this.printOrigin(M.origin),re+=this.printSessionName(M.sessionName),re+=this.printInformation(M.information),re+=this.printUri(M.uri),re+=this.printEmail(M.emails),re+=this.printPhone(M.phones),re+=this.printConnection(M.connection),re+=this.printBandwidth(M.bandwidths),re+=this.printTimeFields(M.timeFields),re+=this.printKey(M.key),re+=this.printSessionAttributes(M.attributes),re+=this.printMediaDescription(M.mediaDescriptions),re}printVersion(M){return"v=".concat(M).concat(this.eol)}printOrigin(M){return"o=".concat(M.username," ").concat(M.sessId," ").concat(M.sessVersion," ").concat(M.nettype," ").concat(M.addrtype," ").concat(M.unicastAddress).concat(this.eol)}printSessionName(M){return M?"s=".concat(M).concat(this.eol):""}printInformation(M){return M?"i=".concat(M).concat(this.eol):""}printUri(M){return M?"u=".concat(M).concat(this.eol):""}printEmail(M){let Q="";for(const re of M)Q+="e=".concat(re).concat(this.eol);return Q}printPhone(M){let Q="";for(const re of M)Q+="e=".concat(re).concat(this.eol);return Q}printConnection(M){return M?"c=".concat(M.nettype," ").concat(M.addrtype," ").concat(M.address).concat(this.eol):""}printBandwidth(M){let Q="";for(const re of M)Q+="b=".concat(re.bwtype,":").concat(re.bandwidth).concat(this.eol);return Q}printTimeFields(M){let Q="";for(const re of M){Q+="t=".concat(re.time.startTime," ").concat(re.time.startTime).concat(this.eol);for(const De of re.repeats)Q+="r=".concat(De.repeatInterval," ").concat(De.typedTimes.join(" ")).concat(this.eol);re.zoneAdjustments&&(Q+="z=",Q+="z=".concat(re.zoneAdjustments.map((De=>"".concat(De.time," ").concat(De.back?"-":""," ").concat(De.typedTime))).join(" ")).concat(this.eol),Q+=this.eol)}return Q}printKey(M){return M?"k=".concat(M).concat(this.eol):""}printAttributes(M){let Q="";for(const re of M)Q+="a=".concat(re.attField).concat(re.attValue?":".concat(re.attValue):"").concat(this.eol);return Q}printMediaDescription(M){let Q="";for(const re of M)Q+=this.printMedia(re.media),Q+=this.printInformation(re.information),Q+=this.printConnections(re.connections),Q+=this.printBandwidth(re.bandwidths),Q+=this.printKey(re.key),Q+=this.printMediaAttributes(re);return Q}printConnections(M){let Q="";for(const re of M)Q+=this.printConnection(re);return Q}printMedia(M){return"m=".concat(M.mediaType," ").concat(M.port," ").concat(M.protos.join("/")," ").concat(M.fmts.join(" ")).concat(this.eol)}printSessionAttributes(M){return new hi(this.eol).print(M)}printMediaAttributes(M){return new Te(this.eol).print(M)}}class Wt{constructor(M){ft(this,"eol",void 0),this.eol=M}printIceUfrag(M){return M===void 0?"":"a=ice-ufrag:".concat(M).concat(this.eol)}printIcePwd(M){return M===void 0?"":"a=ice-pwd:".concat(M).concat(this.eol)}printIceOptions(M){return M===void 0?"":"a=ice-options:".concat(M.join(g)).concat(this.eol)}printFingerprints(M){return M.length>0?M.map((Q=>"a=fingerprint:".concat(Q.hashFunction).concat(g).concat(Q.fingerprint))).join(this.eol)+this.eol:""}printExtmap(M){return M.map((Q=>"a=extmap:".concat(Q.entry).concat(Q.direction?"/".concat(Q.direction):"").concat(g).concat(Q.extensionName).concat(Q.extensionAttributes?"".concat(g).concat(Q.extensionAttributes):"").concat(this.eol))).join("")}printSetup(M){return M===void 0?"":"a=setup:".concat(M).concat(this.eol)}printUnrecognized(M){return M.map((Q=>"a=".concat(Q.attField).concat(Q.attValue?":".concat(Q.attValue):"").concat(this.eol))).join("")}}class hi extends Wt{print(M){let Q="";return Q+=this.printGroups(M.groups),Q+=this.printMsidSemantic(M.msidSemantic),Q+=this.printIceLite(M.iceLite),Q+=this.printIceUfrag(M.iceUfrag),Q+=this.printIcePwd(M.icePwd),Q+=this.printIceOptions(M.iceOptions),Q+=this.printFingerprints(M.fingerprints),Q+=this.printSetup(M.setup),Q+=this.printTlsId(M.tlsId),Q+=this.printIdentity(M.identities),Q+=this.printExtmap(M.extmaps),Q+=this.printUnrecognized(M.unrecognized),Q}printGroups(M){let Q="";return M.length>0&&(Q+=M.map((re=>"a=group:".concat(re.semantic).concat(re.identificationTag.map((De=>"".concat(g).concat(De))).join("")).concat(this.eol))).join("")),Q}printIceLite(M){return M===void 0?"":"a=ice-lite"+this.eol}printTlsId(M){return M?"a=tls-id:".concat(M).concat(this.eol):""}printIdentity(M){return M.length===0?"":M.map((Q=>"a=identity:".concat(Q.assertionValue).concat(Q.extensions.map((re=>"".concat(g).concat(re.name).concat(re.value?"=".concat(re.value):"")))))).join(this.eol)+this.eol}printMsidSemantic(M){if(!M)return"";let Q="a=msid-semantic:".concat(M.semantic);return M.applyForAll?Q+="".concat(g,"*"):M.identifierList.length>0&&(Q+=M.identifierList.map((re=>"".concat(g).concat(re)))),Q+this.eol}}class Te extends Wt{print(M){const Q=M.attributes;let re="";return re+=this.printRTCP(Q.rtcp),re+=this.printIceUfrag(Q.iceUfrag),re+=this.printIcePwd(Q.icePwd),re+=this.printIceOptions(Q.iceOptions),re+=this.printCandidates(Q.candidates),re+=this.printRemoteCandidatesList(Q.remoteCandidatesList),re+=this.printEndOfCandidates(Q.endOfCandidates),re+=this.printFingerprints(Q.fingerprints),re+=this.printSetup(Q.setup),re+=this.printMid(Q.mid),re+=this.printExtmap(Q.extmaps),re+=this.printRTPRelated(Q),re+=this.printPtime(Q.ptime),re+=this.printMaxPtime(Q.maxPtime),re+=this.printDirection(Q.direction),re+=this.printSSRCGroups(Q.ssrcGroups),re+=this.printSSRC(Q.ssrcs),re+=this.printRTCPMux(Q.rtcpMux),re+=this.printRTCPMuxOnly(Q.rtcpMuxOnly),re+=this.printRTCPRsize(Q.rtcpRsize),re+=this.printMSId(Q.msids),re+=this.printImageattr(Q.imageattr),re+=this.printRid(Q.rids),re+=this.printSimulcast(Q.simulcast),re+=this.printSCTPPort(Q.sctpPort),re+=this.printMaxMessageSize(Q.maxMessageSize),re+=this.printUnrecognized(Q.unrecognized),re}printCandidates(M){return M.map((Q=>"a=candidate:".concat(Q.foundation).concat(g).concat(Q.componentId).concat(g).concat(Q.transport).concat(g).concat(Q.priority).concat(g).concat(Q.connectionAddress).concat(g).concat(Q.port).concat(g,"typ").concat(g).concat(Q.type).concat(Q.relAddr?"".concat(g,"raddr").concat(g).concat(Q.relAddr):"").concat(Q.relPort?"".concat(g,"rport").concat(g).concat(Q.relPort):"").concat(Object.keys(Q.extension).map((re=>"".concat(g).concat(re).concat(g).concat(Q.extension[re]))).join("")).concat(this.eol))).join("")}printRemoteCandidatesList(M){return M.map((Q=>"a=remote-candidates:".concat(Q.join(g)).concat(this.eol))).join("")}printEndOfCandidates(M){return M===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(M){if(!M.payloads)return"";const Q=M.payloads;let re="";re+=M.rtcpFeedbackWildcards.map((De=>this.printRTCPFeedback("*",De))).join("");for(const De of Q)re+=this.printRtpMap(De.payloadType,De.rtpMap),re+=this.printFmtp(De.payloadType,De.fmtp),re+=De.rtcpFeedbacks.map((vt=>this.printRTCPFeedback(De.payloadType,vt))).join("");return re}printFmtp(M,Q){if(!Q)return"";const re=Object.keys(Q.parameters);return re.length===1&&Q.parameters[re[0]]===null?"a=fmtp:".concat(M).concat(g).concat(re[0]).concat(this.eol):"a=fmtp:".concat(M).concat(g).concat(Object.keys(Q.parameters).map((De=>"".concat(De,"=").concat(Q.parameters[De]))).join(";")).concat(this.eol)}printRtpMap(M,Q){return Q?"a=rtpmap:".concat(M).concat(g).concat(Q.encodingName,"/").concat(Q.clockRate).concat(Q.encodingParameters?"/".concat(Q.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(M,Q){let re="a=rtcp-fb:".concat(M).concat(g),De=Q;return De.type==="trr-int"?re+="ttr-int".concat(g).concat(De.interval):(re+="".concat(De.type),De.parameter&&(re+="".concat(g).concat(De.parameter),De.additional&&(re+="".concat(g).concat(De.additional)))),re+this.eol}printPtime(M){return M===void 0?"":"a=ptime:".concat(M).concat(this.eol)}printMaxPtime(M){return M===void 0?"":"a=maxptime:".concat(M).concat(this.eol)}printDirection(M){return M===void 0?"":"a=".concat(M).concat(this.eol)}printSSRC(M){return M.map((Q=>Object.keys(Q.attributes).map((re=>"a=ssrc:".concat(Q.ssrcId.toString(10)).concat(g).concat(re).concat(Q.attributes[re]?":".concat(Q.attributes[re]):"").concat(this.eol))).join(""))).join("")}printRTCPMux(M){return M===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(M){return M===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(M){return M===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(M){if(M===void 0)return"";let Q="a=rtcp:".concat(M.port);return M.netType&&(Q+="".concat(g).concat(M.netType)),M.addressType&&(Q+="".concat(g).concat(M.addressType)),M.address&&(Q+="".concat(g).concat(M.address)),Q+this.eol}printMSId(M){return M.map((Q=>"a=msid:".concat(Q.id).concat(Q.appdata?"".concat(g).concat(Q.appdata):"").concat(this.eol))).join("")}printImageattr(M){return M.map((Q=>"a=imageattr:".concat(Q).concat(this.eol))).join("")}printRid(M){return M.map((Q=>{let re="a=rid:".concat(Q.id).concat(g).concat(Q.direction);return Q.payloads&&(re+="".concat(g,"pt=").concat(Q.payloads.join(","))),Q.params.length>0&&(re+="".concat(g).concat(Q.params.map((De=>De.type==="depend"?"depend=".concat(De.rids.join(",")):"".concat(De.type,"=").concat(De.val))).join(";"))),re+this.eol})).join("")}printSimulcast(M){return M===void 0?"":"a=simulcast:".concat(M).concat(this.eol)}printSCTPPort(M){return M===void 0?"":"a=sctp-port:".concat(M).concat(this.eol)}printMaxMessageSize(M){return M===void 0?"":"a=max-message-size:".concat(M).concat(this.eol)}printMid(M){return M===void 0?"":"a=mid:".concat(M).concat(this.eol)}printSSRCGroups(M){return M.map((Q=>"a=ssrc-group:".concat(Q.semantic).concat(Q.ssrcIds.map((re=>"".concat(g).concat(re.toString(10)))).join("")).concat(this.eol))).join("")}}function Ue(Re){return new we().parse(Re)}function Je(Re,M){return new Xt().print(Re,M)}}},t={};function r(a){if(t[a])return t[a].exports;var o=t[a]={exports:{}};return e[a](o,o.exports,r),o.exports}return r.d=(a,o)=>{for(var u in o)r.o(o,u)&&!r.o(a,u)&&Object.defineProperty(a,u,{enumerable:!0,get:o[u]})},r.o=(a,o)=>Object.prototype.hasOwnProperty.call(a,o),r.r=a=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},r(8)})();function Ca(e){return P5.parse(e)}function Dh(e,t){return P5.print(e,t)}var roe=ia("Array","keys"),ioe=ac,aoe=jr,soe=D,ooe=roe,SD=Array.prototype,coe={DOMTokenList:!0,NodeList:!0},loe=function(e){var t=e.keys;return e===SD||soe(SD,e)&&t===SD.keys||aoe(coe,ioe(e))?ooe:t},Aa=f(loe);function Fn(e,t,r){return(t=(function(a){var o=(function(u,h){if(typeof u!="object"||!u)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var g=m.call(u,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)})(a);return typeof o=="symbol"?o:o+""})(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function k5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),r.push.apply(r,a)}return r}function St(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?k5(Object(r),!0).forEach((function(a){Fn(e,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):k5(Object(r)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))}))}return e}const L5=new class extends Mn{constructor(){super(...arguments),Fn(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class uoe{constructor(t){Fn(this,"logger",void 0),Fn(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];this.logger.debug(...this.prefixLists,...r)}info(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];this.logger.info(...this.prefixLists,...r)}warning(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];this.logger.warning(...this.prefixLists,...r)}error(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];this.logger.error(...this.prefixLists,...r)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function bD(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function M5(){const e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?t?.[0]+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const Gs={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},MC=Date.now(),X0=e=>{for(const t in Gs)if(Object.prototype.hasOwnProperty.call(Gs,t)&&Gs[t]===e)return t;return"DEFAULT"},k=new class{constructor(){Fn(this,"proxyServerURL",void 0),Fn(this,"logLevel",Gs.DEBUG),Fn(this,"uploadState","collecting"),Fn(this,"uploadLogWaitingList",[]),Fn(this,"uploadLogUploadingList",[]),Fn(this,"uploadErrorCount",0),Fn(this,"currentLogID",0),Fn(this,"url",void 0),Fn(this,"extLog",((e,t)=>{this.appendLogToWaitingList(e,...t)}))}debug(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const a=[Gs.DEBUG].concat(t);this.log.apply(this,a)}info(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const a=[Gs.INFO].concat(t);this.log.apply(this,a)}warning(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const a=[Gs.WARNING].concat(t);this.log.apply(this,a)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const a=[Gs.ERROR].concat(t);this.log.apply(this,a)}upload(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const a=[Gs.DEBUG].concat(t);this.uploadLog.apply(this,a)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){sn("UPLOAD_LOG",!0)}disableLogUpload(){sn("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new uoe(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(Date.now()-MC<100)return void setTimeout((()=>{this.log(...t)}),Date.now()-MC);const a=Math.max(0,Math.min(4,t[0]));if(t[0]=bD()+" Agora-SDK [".concat(X0(a),"]:"),this.appendLogToWaitingList(a,...t),a<this.logLevel)return;const o=bD()+" %cAgora-SDK [".concat(X0(a),"]:");let u=[];if(!X("USE_NEW_LOG"))switch(a){case Gs.DEBUG:u=[o,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,u);break;case Gs.INFO:u=[o,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,u);break;case Gs.WARNING:u=[o,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,u);break;case Gs.ERROR:u=[o,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,u)}}uploadLog(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(Date.now()-MC<100)return void setTimeout((()=>{this.uploadLog(...t)}),Date.now()-MC);const a=Math.max(0,Math.min(4,t[0]));t[0]=bD()+" Agora-SDK [".concat(X0(a),"]:"),this.appendLogToWaitingList(a,...t)}appendLogToWaitingList(e){if(!X("UPLOAD_LOG"))return;for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];Array.isArray(r[0])?r[0][0]=M5()+" Agora-SDK [".concat(X0(e),"]:"):r[0]=M5()+" Agora-SDK [".concat(X0(e),"]:");let o="";r.forEach((u=>{typeof u=="object"&&(u=JSON.stringify(u)),o+="".concat(u," ")})),this.uploadLogWaitingList.push({payload_str:o,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:Fs,process_id:X("PROCESS_ID"),payload:JSON.stringify(e)};return jc((async()=>{const r=await oa.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(X("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(X("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(r.data!=="OK"){const a=new Error("unexpected upload log response");throw a.response=r,a}}),(()=>(this.uploadLogUploadingList=[],!1)),(r=>{const a={status:-1,message:r.message,errorRange:e.map((o=>o.log_item_id))};return r.response?(a.status=r.response.status,a.data=r.response.data,a.headers=r.response.headers):r.request&&(a.status=r.request.status),L5.reportLogUploadError(a),!0}),{timeout:X("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:X("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,X("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then((()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout((()=>this.uploadLogInterval()),X("UPLOAD_LOG_INTERVAL"))})).catch((e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout((()=>this.uploadLogInterval()),X("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout((()=>this.uploadLogInterval()),X("UPLOAD_LOG_RETRY_INTERVAL_V1"))})))}};var U5;function doe(e){return Gr(e.reportId,"params.reportId",0,100,!1),Gr(e.category,"params.category",0,100,!1),Gr(e.event,"params.event",0,100,!1),Gr(e.label,"params.label",0,100,!1),ln(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(U5={}).FREE="free",U5.UPLOADING="uploading",(function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"})({});const hoe={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let yr=(function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e})({}),Nn=(function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e})({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let foe=(function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e})({});function lt(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,r,a){const o=a.value;if(typeof o=="function"){const u=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);a.value=function(){for(var h,m=arguments.length,g=new Array(m),y=0;y<m;y++)g[y]=arguments[y];let E=g;if(e.argsMap)try{E=e.argsMap(this,...g)}catch(O){k.warning(O),E=[]}try{JSON.stringify(E)}catch{k.warning("arguments for method ".concat(u,".").concat(String(r)," not serializable for apiInvoke.")),E=[]}const A=(e.report||nt).reportApiInvoke(this._sessionId||null,{id:this._clientId||((h=this.store)===null||h===void 0?void 0:h.clientId)||this._ID,name:"".concat(u,".").concat(String(r)),options:E,tag:Dn.TRACER,reportResult:e.reportResult},e.throttleTime);try{const O=o.apply(this,g);return O instanceof Fe?O.then((N=>(A.onSuccess(e.reportResult&&N),N))).catch((N=>{throw A.onError(N),N})):(A.onSuccess(e.reportResult&&O),O)}catch(O){throw A.onError(O),O}}}return a}}const nt=new class{constructor(){Fn(this,"baseInfoMap",new Map),Fn(this,"proxyServer",void 0),Fn(this,"eventUploadTimer",void 0),Fn(this,"setSessionIdTimer",void 0),Fn(this,"url",void 0),Fn(this,"sids",new Set),Fn(this,"backupUrl",void 0),Fn(this,"_appId",void 0),Fn(this,"_aid",0),Fn(this,"keyEventUploadPendingItems",[]),Fn(this,"normalEventUploadPendingItems",[]),Fn(this,"apiInvokeUploadPendingItems",[]),Fn(this,"apiInvokeCount",0),Fn(this,"apiInvokeLoggedCount",0),Fn(this,"ltsList",[]),Fn(this,"lastSendNormalEventTime",Date.now()),Fn(this,"customReportCounterTimer",void 0),Fn(this,"customReportCount",0),Fn(this,"extApiInvoke",(async e=>{for(const t of e){const r=St(St({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Dn.TRACER});this.sendApiInvoke(r)}})),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),X("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),X("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,(t=>{let[r,a]=t;return r+a})),16)||0}reportApiInvoke(e,t,r){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;const a=Date.now();this.apiInvokeCount+=1;const o=this.apiInvokeCount,u=!!X("SHOW_REPORT_INVOKER_LOG"),h=!!X("SHOW_REPORT_USER_INVOKER_LOG"),m=u||h&&t.id;m&&(this.apiInvokeLoggedCount+=1);const g=this.apiInvokeLoggedCount;function y(N,B){if(m){let U="[apiInvoke-".concat(g,"]");if(t.id&&(U+="[".concat(t.id,"]")),t.name&&(U+="[".concat(t.name,"]"),t.name===Xn.JOIN))return k.info("".concat(U," ").concat(N));k.info("".concat(U," ").concat(N),N==="start"?t.options:B||"")}}const E=()=>({tag:t.tag,invokeId:o,sid:e,name:t.name,apiInvokeTime:a,options:t.options,states:t.states||null});y("start");let A=!1;Hr(t.timeout).then((()=>{A||(this.sendApiInvoke(St(St({},E()),{},{error:q.API_INVOKE_TIMEOUT,success:!1})),y("timeout"))}));const O=new ve(q.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:N=>{const B=()=>{if(A)throw O;return A=!0,this.sendApiInvoke(St(St({},E()),{},{success:!0},t.reportResult&&{result:N})),y("onSuccess"),N};return r?g5(B,t.name+"Success",r,(()=>A=!0)):B()},onError:N=>{const B=()=>{if(A)throw N;A=!0,this.sendApiInvoke(St(St({},E()),{},{success:!1,error:N})),y("onFailure",N.toString())};return r?g5(B,t.name+"Error",r,(()=>A=!0)):B()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const r=Date.now(),a=this.createBaseInfo(e,r);a.cname=t.cname;const o=Object.assign({},{willUploadConsoleLog:X("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:_D?"global":"oversea",areas:X("AREAS")&&X("AREAS").join(",")},t.extend),{stringUid:u,channelProfile:h,channelMode:m,isABTestSuccess:g,lsid:y,clientRole:E}=t,A=Date.now(),O=St(St({},a),{},{eventType:yr.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:yD,lts:A,elapse:A-r,extend:JSON.stringify(o),mode:t.mode,process:X("PROCESS_ID"),appType:X("APP_TYPE"),success:!0,version:Fs,stringUid:u,channelProfile:h,channelMode:m,isABTestSuccess:g,lsid:y,clientType:je(N=window.navigator.userAgent).call(N,"AgoraWebView")?42:20,clientRole:E,serviceId:X("PROCESS_ID"),extensionID:X("PLUGIN_INFO").join(",")||""});var N;this.send({type:Nn.SESSION,data:O},!0)}joinChooseServer(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,o=Date.now(),u=St(St({},a),{},{role:t.role,eventType:yr.JOIN_CHOOSE_SERVER,lts:o,eventElapse:t.elapse||o-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:o-r.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0,resourceTimingInfo:t.resourceTimingInfo||void 0});this.send({type:Nn.JOIN_CHOOSE_SERVER,data:u},!0)}reqUserAccount(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,o=Date.now(),u=St(St({},a),{},{eventType:yr.REQ_USER_ACCOUNT,lts:o,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||o-r.startTime,eventElapse:o-t.lts,extend:JSON.stringify(t.extend)});this.send({type:Nn.REQ_USER_ACCOUNT,data:u},!0)}joinGateway(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info;t.vid&&(a.vid=t.vid),a.uid=t.uid,a.cid=t.cid;const o=Date.now(),{firstSuccess:u,addr:h,isProxy:m}=t,g=o-r.startTime,y=St(St({},a),{},{eventType:yr.JOIN_GATEWAY,lts:o,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:g,eventElapse:o-t.lts,firstSuccess:u,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:gD(),isABTestSuccess:t.isABTestSuccess?1:0}),E=y.success?1:0;if(t.succ&&(r.lastJoinSuccessTime=o),u)this.send({type:Nn.JOIN_GATEWAY,data:y},!0);else{let A;if(h)if(m){const N=h.match(/h=(\d{1,3}-){3}\d{1,3}/g),B=h.match(/p=[0-9]{1,6}/g);A={isSuccess:E,gatewayIp:N&&N.length?N[0].split("=")[1].replace(/-/g,"."):"",port:B&&B.length?B[0].split("=")[1]:"",isProxy:m?1:0}}else{const N=h.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),B=h.match(/(:|p=)[0-9]{1,6}/g);A={isSuccess:E,gatewayIp:N&&N.length?N[0].split("//")[1].replace(/-/g,"."):"",port:B&&B.length?B[0].split(/:|p=/g)[1]:"",isProxy:m?1:0}}else A={isSuccess:E,gatewayIp:"",port:"",isProxy:m?1:0};delete y.success,delete y.eventType,delete y.firstSuccess,y.vid=Number(y.vid);const O=Object.assign({},y,A,{eventType:yr.REJOIN_GATEWAY});this.send({type:Nn.RE_JOIN_GATEWAY,data:O},!0)}}joinChannelTimeout(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=Date.now(),o=St(St({},r.info),{},{lts:a,timeout:t,elapse:a-r.startTime});this.send({type:Nn.JOIN_CHANNEL_TIMEOUT,data:o},!0)}publish(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,o=Date.now(),u=St(St({},a),{},{eventType:yr.PUBLISH,lts:o,eventElapse:t.eventElapse,elapse:o-r.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:Nn.PUBLISH,data:u},!0)}subscribe(e,t,r){const a=this.baseInfoMap.get(e);if(!a)return;const o=a.info,u=Date.now(),h=St(St({},o),{},{eventType:yr.SUBSCRIBE,lts:u,eventElapse:t.eventElapse,elapse:u-a.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},r&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?h.peerSuid=t.peerid:h.peer=t.peerid,this.send({type:Nn.SUBSCRIBE,data:h},!0)}wsCompressorInit(e){var t;const r=[...Aa(t=this.baseInfoMap).call(t)],a=r.length?r[0]:"UnableToGetSid",o=this.baseInfoMap.get(a);if(!o)return;const u=o.info,h=Date.now(),m=St(St({},u),{},{eventType:yr.WS_COMPRESSOR_INIT,lts:h,eventElapse:e.eventElapse,elapse:h-o.startTime,status:e.status?1:2});this.send({type:Nn.WS_COMPRESSOR_INIT,data:m},!0)}firstXLAPeerFirstVideoFrame(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,o=Date.now(),u=t.peerPubStatusMs-(r.lastJoinSuccessTime||o),h=St(St({},a),{},{elapse:o-r.startTime,eventType:yr.XLA_PEER_FIRST_VIDEO_FRAME,lts:o,peer:t.peer,width:t.width,height:t.height,ssrc:t.ssrc,p2pid:t.p2pid,peerPublishDuration:t.peerPublishDuration,joinChannelSuccessElapse:u,peerPubStatusMs:t.peerPubStatusMs-t.joinChannelStart,availablePublish:t.peerPublishDuration>u?1:0,preloadStart:Math.max(t.preloadStart-t.joinChannelStart,0),preloadEnd:Math.max(t.preloadEnd-t.joinChannelStart,0),encrypt:Math.max(t.apStart-t.joinChannelStart,0),ap:Math.max(t.apEnd-t.joinChannelStart,0),sua:Math.max(t.suaEnd-t.joinChannelStart,0),beforeConnect:Math.max(t.beforeConnect-t.joinChannelStart,0),peerRecevier:Math.max(t.peerReceiver-t.joinChannelStart,0),ice:Math.max(t.ice-t.joinChannelStart,0),pc:Math.max(t.pc-t.joinChannelStart,0),signalConnected:Math.max(t.signalConnected-t.joinChannelStart,0),joinReq:Math.max(t.joinReq-t.joinChannelStart,0),joinRes:Math.max(t.joinRes-t.joinChannelStart,0),userJoinNotify:Math.max(t.userJoinNotify-t.joinChannelStart,0),videoSsrcNotify:Math.max(t.videoAddNotify-t.joinChannelStart,0),subscribeDelayMs:Math.max(t.subscribeStart-t.videoAddNotify,0),subscribeStart:Math.max(t.subscribeStart-t.joinChannelStart,0),subscribeEnd:Math.max(t.subscribeEnd-t.joinChannelStart,0),firstReceived:Math.max(t.firstReceived-t.joinChannelStart,0),firstDecoded:Math.max(t.firstDecoded-t.joinChannelStart,0),firstPreRender:Math.max(t.firstPreRender-t.joinChannelStart,0),firstRender:Math.max(t.firstRender-t.joinChannelStart,0),playDelayMs:Math.max(t.playStart-t.subscribeEnd,0),playStart:Math.max(t.playStart-t.joinChannelStart,0),playEnd:Math.max(t.playEnd-t.joinChannelStart,0),isPreSub:t.isPreSub?1:0,isPrePc:t.isPrePc?1:0,isPreInstantVideo:t.isPreInstantVideo?1:0});this.send({type:Nn.XLA_PEER_FIRST_VIDEO_FRAME,data:h},!0)}firstRemoteVideoDecode(e,t,r,a){const o=this.baseInfoMap.get(e);if(!o)return;const u=o.info,h=Date.now(),m=St(St(St({},u),a),{},{elapse:h-o.startTime,eventType:t,lts:h,firstDecodeFrame:Math.max((a.firstFrame||h)-o.startTime,0),apEnd:Math.max(a.apEnd-o.startTime,0),apStart:Math.max(a.apStart-o.startTime,0),joinGwEnd:Math.max(a.joinGwEnd-o.startTime,0),joinGwStart:Math.max(a.joinGwStart-o.startTime,0),pcEnd:Math.max(a.pcEnd-o.startTime,0),pcStart:Math.max(a.pcStart-o.startTime,0),subscriberEnd:Math.max(a.subscriberEnd-o.startTime,0),subscriberStart:Math.max(a.subscriberStart-o.startTime,0),videoAddNotify:Math.max(a.videoAddNotify-o.startTime,0)});this.send({type:r,data:m},!0)}firstRemoteFrame(e,t,r,a){const o=this.baseInfoMap.get(e);if(!o)return;const u=o.info,h=Date.now(),m=St(St(St({},u),a),{},{elapse:h-o.startTime,eventType:t,lts:h});this.send({type:r,data:m},!0)}abTest(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,o=Date.now(),u=St(St(St({},a),t),{},{vid:a.vid===void 0?0:Number(a.vid),elapse:o-r.startTime,eventType:yr.AB_TEST,lts:o});this.send({type:Nn.AB_TEST,data:u},!0)}pcStats(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,o=Date.now(),u=St(St(St({},a),t),{},{vid:a.vid===void 0?0:Number(a.vid),elapse:o-r.startTime,eventType:yr.PC_STATS,lts:o,preallocation:t.preallocation?1:0});this.send({type:Nn.PC_STATS,data:u},!0)}updateRemoteRTPCapabilities(e,t){if(e){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,o=Date.now(),u=St(St(St({},a),t),{},{vid:a.vid===void 0?0:Number(a.vid),eventType:yr.UPDATE_REMOTE_RTPCAPABILITIES,lts:o});this.send({type:Nn.UPDATE_REMOTE_RTPCAPABILITIES,data:u},!0)}}onGatewayStream(e,t,r,a){const o=this.baseInfoMap.get(e);if(!o)return;const u=o.info,h=Date.now(),m=St(St(St({},u),a),{},{eventType:t,lts:h});this.send({type:r,data:m},!0)}streamSwitch(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,o=Date.now(),u=St(St({},a),{},{eventType:yr.STREAM_SWITCH,lts:o,isDual:t.isdual,elapse:o-r.startTime,success:t.succ});this.send({type:Nn.STREAM_SWITCH,data:u},!0)}requestProxyAppCenter(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,o=Date.now(),u=St(St({},a),{},{eventType:yr.REQUEST_PROXY_APPCENTER,lts:o,eventElapse:o-t.lts,elapse:o-r.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Nn.REQUEST_PROXY_APPCENTER,data:u},!0)}requestProxyWorkerManager(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,o=Date.now(),u=St(St({},a),{},{eventType:yr.REQUEST_PROXY_WORKER_MANAGER,lts:o,eventElapse:o-t.lts,elapse:o-r.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Nn.REQUEST_PROXY_WORKER_MANAGER,data:u},!0)}setProxyServer(e){this.proxyServer=e,e?k.debug("reportProxyServerurl: ".concat(e)):k.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,o=Date.now(),u=St(St({},a),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:o,elapse:o-r.startTime,joinChannelSuccessElapse:o-(r.lastJoinSuccessTime||o),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:Nn.PEER_PUBLISH_STATUS,data:u},!0)}workerEvent(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,o=Date.now();(function(u,h,m){const g=u[h];if(!g||typeof g!="string")return[u];u[h]="";const y=Nl(JSON.stringify(u));let E=0;const A=[];let O=0;for(let N=0;N<g.length;N++)O+=g.charCodeAt(N)<=127?1:3,O<=m-y||(A[A.length]=xe(xe({},u),{},{[h]:g.substring(E,N)}),E=N,O=g.charCodeAt(N)<=127?1:3);return E!==g.length-1&&(A[A.length]=xe(xe({},u),{},{[h]:g.substring(E)})),A})(St(St(St({},a),t),{},{elapse:o-r.startTime,lts:o,productType:"WebRTC"}),"payload",1300).forEach((u=>this.send({type:Nn.WORKER_EVENT,data:u},!0)))}apworkerEvent(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,o=Date.now(),u=St(St(St({},a),t),{},{elapse:o-r.startTime,lts:o});this.send({type:Nn.AP_WORKER_EVENT,data:u},!0)}joinWebProxyAP(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,o=Date.now(),u=St(St(St({},a),t),{},{elapse:o-r.startTime,lts:o,extend:t.extend||void 0});this.send({type:Nn.JOIN_WEB_PROXY_AP,data:u},!0)}WebSocketQuit(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const a=r.info,o=Date.now(),u=St(St(St({},a),t),{},{elapse:o-r.startTime,lts:o});this.send({type:Nn.WEBSOCKET_QUIT,data:u},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>X("CUSTOM_REPORT_LIMIT"))throw new ve(q.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval((()=>{this.customReportCount=0}),5e3));const r=Date.now(),a=t.map((o=>({type:Nn.USER_ANALYTICS,data:St(St({sid:e},o),{},{lts:r})})));try{X("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(a):await this.postDataToStatsCollector(a)}catch(o){throw k.error("send custom report message failed",o.toString()),new ve(q.CUSTOM_REPORT_SEND_FAILED,o.message)}}sendApiInvoke(e){const t=X("NOT_REPORT_EVENT");if(e.tag&&je(t)&&je(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const r=this.baseInfoMap.get(e.sid);if(!r)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:a,uid:o,cid:u}=r.info;let h;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof ve){const{code:g,message:y}=e.error;h=g||y||e.error.toString()}else h=e.error.toString();const m={invokeId:e.invokeId,sid:e.sid,cname:a,cid:u,uid:o,lts:e.lts,success:e.success,elapse:e.lts-r.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?h:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:Nn.API_INVOKE,data:m},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const t=Array.from(this.sids).find((r=>r!==null));t&&e.forEach((r=>{r&&(r.sid=t,this.sendApiInvoke(Object.assign({},r)))})),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>X("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const r=[],a=[];for(;e.length;){const u=e.shift();r.length<20?r.push(u):a.push(u)}e.push(...a);for(const u of[...r]){var o;this.ltsList.indexOf(u.data.lts)!==-1?(u.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(u.data.lts)):(this.ltsList.push(u.data.lts),_(o=this.ltsList).call(o,((h,m)=>h-m)))}return t||(this.lastSendNormalEventTime=Date.now()),X("ENABLE_EVENT_REPORT")&&r.length&&(X("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(r):this.postDataToStatsCollector(r)).catch((u=>h=>{X("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(u):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(u),this.normalEventUploadPendingItems.length>X("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-X("NORMAL_EVENT_QUEUE_CAPACITY")),k.warning("report: drop normal events"))))})(r)),e}async postDataToStatsCollector2(e){nr.networkState===Xa.OFFLINE&&await Fe.race([nr.onlineWaiter,Hr(2*sr.maxRetryTimeout)]);const t=o=>{let u=new Uint8Array;return o.forEach((h=>{const m=iD(JSON.stringify(h.data)),g=new ArrayBuffer(5),y=(A=>{let O=0;return Object.entries(Nn).forEach((N=>{let[B,U]=N;U===A.type&&(O=foe[B])})),O})(h),E=new DataView(g);E.setUint16(0,m.byteLength,!0),E.setUint8(2,255&y),E.setUint8(3,y>>>8&255),E.setUint8(4,y>>>16&255),u=o5(u,new Uint8Array(g)),u=o5(u,m)})),u},r="event";let a=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(X("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(r):"https://".concat(X("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(r);for(let o=0;o<2;o+=1){o===1&&(a=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(X("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(r):"https://".concat(X("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(r));try{await dD(a,{timeout:1e4,data:t(e),headers:St(St({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(u){if(o===1)throw u;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const r=(m=>{const g=m&&m.data.sid&&this.baseInfoMap.get(m.data.sid);return g&&g.info.vid&&+g.info.vid||0})(e[0]),a=r?void 0:this._aid,o={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map((m=>JSON.stringify(m))),vid:r,aid:a};nr.networkState===Xa.OFFLINE&&await Fe.race([nr.onlineWaiter,Hr(2*sr.maxRetryTimeout)]);const u=t?"/events/proto-raws":"/events/messages";let h=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(X("EVENT_REPORT_DOMAIN"),"&p=").concat(X("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(X("EVENT_REPORT_DOMAIN"),":").concat(X("STATS_COLLECTOR_PORT")).concat(u));for(let m=0;m<2;m+=1){m===1&&(h=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(X("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(X("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(X("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(X("STATS_COLLECTOR_PORT")).concat(u)));try{t?await Zse(h,{timeout:1e4,data:o}):await dD(h,{timeout:1e4,data:o})}catch(g){if(m===1)throw g;continue}return}}createBaseInfo(e,t){const r=Object.assign({},hoe);return r.sid=e,this.baseInfoMap.set(e,{info:r,startTime:t}),r}reportResourceTiming(e,t){const r=performance.getEntriesByName(e),a=r[r.length-1];a&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:a,tag:Dn.TRACER}).onSuccess()}};L5.on("REPORT_LOG_UPLOAD",(e=>{e.networkState=nr.networkState,nt.reportApiInvoke(null,{name:"logUploadError",options:e,tag:Dn.TRACER}).onSuccess("logUploadError")}));class fe extends ve{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Fn(this,"name","AgoraRTCException")}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(t,k)}throw(){super.throw(k)}}const Wr={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Vt(){return Wr}function j5(){return"setSinkId"in HTMLAudioElement.prototype&&(!X("RESTRICTION_SET_PLAYBACK_DEVICE")||(Uu()||XB())&&!tD())}function UC(){return!Wr.supportUnifiedPlan||X("CHROME_FORCE_PLAN_B")&&ju()}function TD(e){return!(Vn()||JB(87)||UC()||!X("ENABLE_PRE_SUB")&&(e==null||!e.autoSubscribe||X("FORCE_DISABLE_AUTO_SUB")))}function V5(e){return!!X("ENABLE_INSTANT_VIDEO")||!(e==null||!e.autoSubscribe||X("FORCE_DISABLE_AUTO_SUB"))}let zr=(function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e})({});function j_(e,t,r){return{sampleRate:e,stereo:t,bitrate:r}}function Bt(e,t,r,a,o){return{width:e,height:t,frameRate:r,bitrateMin:a,bitrateMax:o}}function Co(e,t,r,a,o){return{width:{max:e},height:{max:t},frameRate:r,bitrateMin:a,bitrateMax:o}}function wD(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}const poe={"90p":Bt(160,90),"90p_1":Bt(160,90),"120p":Bt(160,120,15,30,65),"120p_1":Bt(160,120,15,30,65),"120p_3":Bt(120,120,15,30,50),"120p_4":Bt(212,120),"180p":Bt(320,180,15,30,140),"180p_1":Bt(320,180,15,30,140),"180p_3":Bt(180,180,15,30,100),"180p_4":Bt(240,180,15,30,120),"240p":Bt(320,240,15,40,200),"240p_1":Bt(320,240,15,40,200),"240p_3":Bt(240,240,15,40,140),"240p_4":Bt(424,240,15,40,220),"360p":Bt(640,360,15,80,400),"360p_1":Bt(640,360,15,80,400),"360p_3":Bt(360,360,15,80,260),"360p_4":Bt(640,360,30,80,600),"360p_6":Bt(360,360,30,80,400),"360p_7":Bt(480,360,15,80,320),"360p_8":Bt(480,360,30,80,490),"360p_9":Bt(640,360,15,80,800),"360p_10":Bt(640,360,24,80,800),"360p_11":Bt(640,360,24,80,1e3),"480p":Bt(640,480,15,100,500),"480p_1":Bt(640,480,15,100,500),"480p_2":Bt(640,480,30,100,1e3),"480p_3":Bt(480,480,15,100,400),"480p_4":Bt(640,480,30,100,750),"480p_6":Bt(480,480,30,100,600),"480p_8":Bt(848,480,15,100,610),"480p_9":Bt(848,480,30,100,930),"480p_10":Bt(640,480,10,100,400),"720p":Bt(1280,720,15,120,1130),"720p_auto":Bt(1280,720,30,900,3e3),"720p_1":Bt(1280,720,15,120,1130),"720p_2":Bt(1280,720,30,120,2e3),"720p_3":Bt(1280,720,30,120,1710),"720p_5":Bt(960,720,15,120,910),"720p_6":Bt(960,720,30,120,1380),"1080p":Bt(1920,1080,15,120,2080),"1080p_1":Bt(1920,1080,15,120,2080),"1080p_2":Bt(1920,1080,30,120,3e3),"1080p_3":Bt(1920,1080,30,120,3150),"1080p_5":Bt(1920,1080,60,120,4780),"1440p":Bt(2560,1440,30,120,4850),"1440p_1":Bt(2560,1440,30,120,4850),"1440p_2":Bt(2560,1440,60,120,7350),"4k":Bt(3840,2160,30,120,8910),"4k_1":Bt(3840,2160,30,120,8910),"4k_3":Bt(3840,2160,60,120,13500)},moe={"480p":Co(640,480,5),"480p_1":Co(640,480,5),"480p_2":Co(640,480,30),"480p_3":Co(640,480,15),"720p":Co(1280,720,5),"720p_auto":Bt(1280,720,30,900,3e3),"720p_1":Co(1280,720,5),"720p_2":Co(1280,720,30),"720p_3":Co(1280,720,15),"1080p":Co(1920,1080,5),"1080p_1":Co(1920,1080,5),"1080p_2":Co(1920,1080,30),"1080p_3":Co(1920,1080,15)},goe={"1SL1TL":wD(1,1),"3SL3TL":wD(3,3),"2SL3TL":wD(2,3)};function Ao(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},poe[e]):e}function RD(e){return typeof e=="string"?Object.assign({},moe[e]):e}function jC(e){return typeof e=="string"?Object.assign({},goe[e]):e}const _oe={speech_low_quality:j_(16e3,!1),speech_standard:j_(32e3,!1,18),music_standard:j_(48e3,!1),standard_stereo:j_(48e3,!0,56),high_quality:j_(48e3,!1,128),high_quality_stereo:j_(48e3,!0,192)};function VC(e){return typeof e=="string"?Object.assign({},_oe[e]):e}const V_=[];function B5(e){return vr(e,"mediaSource",["screen","window","application"]),!0}let $e=(function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e})({}),un=(function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e})({}),B_=(function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e})({}),voe=(function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e})({}),yoe=(function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e})({}),Pp=(function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e})({}),F_=(function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e})({}),Hs=(function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e.PLAY_START="play-start",e.PLAY_END="play-end",e.FIRST_FRAME_RENDER="first-frame-render",e})({}),G_=(function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e})({}),ys=(function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e})({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const CD={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},AD={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},F5={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},Eoe={uplinkNetworkQuality:0,downlinkNetworkQuality:0},G5={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let qi=(function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e})({}),Es=(function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e})({}),J0=(function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e})({}),kp=(function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e})({}),ci=(function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e})({}),Dl=(function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e})({});const OD={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let BC=(function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e})({});function kt(e,t,r,a,o){var u,h,m={};return Object.keys(a).forEach((function(g){m[g]=a[g]})),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=vi(u=Ps(h=r.slice()).call(h)).call(u,(function(g,y){return y(e,t,g)||g}),m),o&&m.initializer!==void 0&&(m.value=m.initializer?m.initializer.call(o):void 0,m.initializer=void 0),m.initializer===void 0?(Object.defineProperty(e,t,m),null):m}function ue(e,t,r){return(t=(function(a){var o=(function(u,h){if(typeof u!="object"||!u)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var g=m.call(u,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)})(a);return typeof o=="symbol"?o:o+""})(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function H5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),r.push.apply(r,a)}return r}function vn(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?H5(Object(r),!0).forEach((function(a){ue(e,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):H5(Object(r)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))}))}return e}class W5 extends Mn{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(Pp.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,r){super(),ue(this,"trackMediaType",void 0),ue(this,"_ID",void 0),ue(this,"_rtpTransceiver",void 0),ue(this,"_lowRtpTransceiver",void 0),ue(this,"_hints",[]),ue(this,"_isClosed",!1),ue(this,"_originMediaStreamTrack",void 0),ue(this,"mediaStreamTrack",void 0),ue(this,"_external",{}),this._ID=r||fn(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,(function(a){je(V_).call(V_,a)||V_.push(a)})(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||Nh((()=>{var r;nt.reportApiInvoke(null,{name:Xn.GET_MEDIA_STREAM_TRACK,options:[],tag:Dn.TRACER}).onSuccess(((r=this._mediaStreamTrack)===null||r===void 0?void 0:r.label)||"")}),this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===B_.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,(function(t){const r=V_.indexOf(t);r!==-1&&V_.splice(r,1)})(this),this.emit(F_.CLOSED),this.removeAllListeners(Pp.SEI_RECEIVED)}_updateRtpTransceiver(t,r){if(r===B_.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(Pp.TRANSCEIVER_UPDATED,t,r)}}class H_ extends W5{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,r){super(t,r),ue(this,"_enabled",!0),ue(this,"_muted",!1),ue(this,"_isExternalTrack",!1),ue(this,"_isClosed",!1),ue(this,"_enabledMutex",void 0),ue(this,"processor",void 0),ue(this,"_processorContext",void 0),ue(this,"_handleTrackEnded",(()=>{this.onTrackEnded()})),this._enabledMutex=new oi("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,r;return(t=(r=this._originMediaStreamTrack)===null||r===void 0?void 0:r.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,k.debug("[".concat(this.getTrackId(),"] close")),this.emit($e.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,r){let a=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=a,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await hn(this,$e.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){k.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(F_.TRACK_ENDED)}stateCheck(t,r){if(k.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(r,"]")),Uc(r,t),this._enabled&&this._muted&&t==="enabled"&&r===!1)throw new ve(q.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",k);if(!this._enabled&&!this._muted&&t==="muted"&&r===!0)throw new ve(q.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",k)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():Fe.resolve([])}}const z5=window.AudioContext||window.webkitAudioContext;let Ss=null;const on=new class extends Mn{constructor(){super(...arguments),ue(this,"prevState",void 0),ue(this,"curState",void 0),ue(this,"currentTime",void 0),ue(this,"currentTimeStuckAt",void 0),ue(this,"interruptDetectorTrack",void 0),ue(this,"onLocalAudioTrackMute",(()=>{k.info("ios15-interruption-start"),this.emit(zr.IOS_15_16_INTERRUPTION_START)})),ue(this,"onLocalAudioTrackUnmute",(async()=>{k.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?k.info("ios15-interruption-end-canceled"):(Ss&&await Ss.suspend(),this.emit(zr.IOS_15_16_INTERRUPTION_END))}))}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){k.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){k.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function W_(){if(!Ss){if((function(){if(!z5)return void k.error("your browser is not support web audio");k.info("create audio context");const e=vn({},X("WEBAUDIO_INIT_OPTIONS"));k.debug("audio context init option:",JSON.stringify(e)),Ss=new z5(e),on.curState=Ss.state,Ss.onstatechange=()=>{on.prevState=on.curState,on.curState=Ss?Ss.state:void 0;const{prevState:t,curState:r}=on,a=r==="running",o=r==="interrupted",u=t==="running",h=t==="suspended",m=t==="interrupted",g=Lt().osVersion;(Ti()||wo())&&u&&o&&(k.info("ios".concat(g,"-interruption-start")),on.emit(zr.IOS_INTERRUPTION_START)),(Ti()||wo())&&(h||m)&&a&&(k.info("ios".concat(g,"-interruption-end")),on.emit(zr.IOS_INTERRUPTION_END)),t!==r&&on.emit(zr.STATE_CHANGE,r,t)},setInterval((()=>{var t;const r=(t=Ss)===null||t===void 0?void 0:t.currentTime;on.currentTime!==r?(on.currentTimeStuckAt&&(k.debug("AudioContext current time resume at ".concat(r)),on.currentTimeStuckAt=void 0),on.currentTime=r):(r!==on.currentTimeStuckAt&&(nt.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:r},tag:Dn.TRACER}).onSuccess(),k.warning("AudioContext current time stuck at ".concat(r))),on.currentTimeStuckAt=r)}),5e3),(async function(t){const r=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let a,o=!1,u=!1,h=!1;function m(U){t.state==="running"?g(!1):Ti()||wo()?t.state==="suspended"&&(g(!0),U&&t.resume().then(y,y)):t.state!=="closed"&&(g(!0),U&&t.resume().then(y,y))}function g(U){if(o!==U){o=U;for(let V=0,K=r;V<K.length;V+=1){const z=K[V];U?window.addEventListener(z,E,{capture:!0,passive:!0}):window.removeEventListener(z,E,{capture:!0,passive:!0})}}}function y(){m(!1)}function E(){m(!0)}function A(U){if(!h)if(a.paused)if(U){let V;O(!1),h=!0;try{V=a.play(),V?V.then(N,N):(a.addEventListener("playing",N),a.addEventListener("abort",N),a.addEventListener("error",N))}catch{N()}}else O(!0);else O(!1)}function O(U){if(u!==U){u=U;for(let V=0,K=r;V<K.length;V++){const z=K[V];U?window.addEventListener(z,B,{capture:!0,passive:!0}):window.removeEventListener(z,B,{capture:!0,passive:!0})}}}function N(){a.removeEventListener("playing",N),a.removeEventListener("abort",N),a.removeEventListener("error",N),h=!1,A(!1)}function B(){A(!0)}if(Ti()){const U=t.createMediaStreamDestination(),V=document.createElement("div");V.innerHTML="<audio x-webkit-airplay='deny'></audio>",a=V.children.item(0),a.controls=!1,a.disableRemotePlayback=!0,a.preload="auto",a.srcObject=U.stream,A(!0)}on.on(zr.STATE_CHANGE,(function(){m(!0)})),m(!1)})(Ss)})(),!Ss)throw new ve(q.NOT_SUPPORTED,"can not create audio context");return Ss}return Ss}function Lp(e){if((function(){if(ID!==null)return ID;const a=W_(),o=a.createBufferSource(),u=a.createGain(),h=a.createGain();o.connect(u),o.connect(h),o.disconnect(u);let m=!1;try{o.disconnect(u)}catch{m=!0}return o.disconnect(),ID=m,m})())return;const t=e.connect,r=e.disconnect;e.connect=(a,o,u)=>{var h;return e._inputNodes||(e._inputNodes=[]),je(h=e._inputNodes).call(h,a)||(a instanceof AudioNode?(e._inputNodes.push(a),t.call(e,a,o,u)):t.call(e,a,o)),e},e.disconnect=(a,o,u)=>{r.call(e),a?IC(e._inputNodes,a):e._inputNodes=[];for(const h of e._inputNodes)t.call(e,h)}}let ID=null;function ND(e,t){let r=!1;const a=1/t;if(X("DISABLE_WEBAUDIO")){const o=window.setInterval((()=>{r?window.clearInterval(o):e(performance.now()/1e3)}),1e3*a)}else{const o=W_();let u=o.createGain();u.gain.value=0,u.connect(o.destination);const h=()=>{if(r)return void(u=null);const m=o.createOscillator();m.onended=h,m.connect(u),m.start(0),m.stop(o.currentTime+a),e(o.currentTime)};h()}return()=>{r=!0}}class K5{constructor(){ue(this,"context",void 0),ue(this,"analyserNode",void 0),ue(this,"sourceNode",void 0),this.context=W_(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t?.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Ti()||wo()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{const a=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(a);for(let o=0;o<t.length;++o)t[o]=a[o]/128-1}const r=vi(t).call(t,((a,o)=>a+o*o),0)/t.length;return Math.max(10*Math.log10(r)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,r;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(r=this.sourceNode)===null||r===void 0||r.connect(this.analyserNode)}catch{k.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class Y5 extends Mn{get processSourceNode(){return this.sourceNode}set processedNode(t){var r;if(!this.isDestroyed&&this._processedNode!==t){try{var a;(a=this.sourceNode)===null||a===void 0||a.disconnect(this.outputNode)}catch{}(r=this._processedNode)===null||r===void 0||r.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),ue(this,"outputNode",void 0),ue(this,"outputTrack",void 0),ue(this,"isPlayed",!1),ue(this,"sourceNode",void 0),ue(this,"context",void 0),ue(this,"audioBufferNode",void 0),ue(this,"destNode",void 0),ue(this,"audioOutputLevel",0),ue(this,"volumeLevelAnalyser",void 0),ue(this,"_processedNode",void 0),ue(this,"playNode",void 0),ue(this,"isDestroyed",!1),ue(this,"onNoAudioInput",void 0),ue(this,"isNoAudioInput",!1),ue(this,"_noAudioInputCount",0),this.context=W_(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Lp(this.outputNode),this.volumeLevelAnalyser=new K5}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=r=>{this.emit(ys.ON_AUDIO_BUFFER,(function(a){for(let o=0;o<a.outputBuffer.numberOfChannels;o+=1){const u=a.outputBuffer.getChannelData(o);for(let h=0;h<u.length;h+=1)u[h]=0}return a.inputBuffer})(r))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Vt().webAudioMediaStreamDest)throw new ve(q.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&NC((()=>{on.emit("autoplay-failed")})),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Ti()||wo()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const r=this.volumeLevelAnalyser.getAnalyserNode();let a;r.getFloatTimeDomainData?(a=new Float32Array(r.fftSize),r.getFloatTimeDomainData(a)):(a=new Uint8Array(r.fftSize),r.getByteTimeDomainData(a));let o=!1;for(let u=0;u<a.length;u++)a[u]!==0&&(o=!0);return o?(this.isNoAudioInput=!1,!0):(await Hr(200),await this.checkHasAudioInput(t?t+1:1)&&o)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,r;(t=this.processedNode)===null||t===void 0||t.disconnect(),(r=this.sourceNode)===null||r===void 0||r.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class q5 extends Y5{get isFreeze(){return!1}constructor(t,r,a){var o;if(super(),ue(this,"sourceNode",void 0),ue(this,"track",void 0),ue(this,"clonedTrack",void 0),ue(this,"audioElement",void 0),ue(this,"isCurrentTrackCloned",!1),ue(this,"isRemoteTrack",!1),ue(this,"originVolumeLevelAnalyser",void 0),ue(this,"rebuildWebAudio",(async()=>{if(k.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void k.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then((()=>k.info("resume success"))),k.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const m=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?m.stop():this.isCurrentTrackCloned=!0;const g=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(g),Lp(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const y=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(y,this.context.currentTime),Lp(this.outputNode),this.emit(ys.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=g,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()})),t.kind!=="audio")throw new ve(q.UNEXPECTED_ERROR);this.track=t;const u=new MediaStream([this.track]);if(this.isRemoteTrack=!!r,this.sourceNode=this.context.createMediaStreamSource(u),Lp(this.sourceNode),a){const m=a.clone();m.enabled=!0,this.clonedTrack=m,k.debug("create an unmuted track ".concat(m.id," from the original track ").concat(a.id," to get the volume"));const g=this.context.createMediaStreamSource(new MediaStream([m]));Lp(g),this.originVolumeLevelAnalyser=new K5,this.originVolumeLevelAnalyser.updateSource(g)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=u;const h=Lt();r&&h.os===Cr.IOS&&Number((o=h.osVersion)===null||o===void 0?void 0:o.split(".")[0])<15&&(on.on(zr.STATE_CHANGE,(()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()})),this.checkHasAudioInput().then((m=>{m||document.body.addEventListener("click",this.rebuildWebAudio,!0)})))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const r=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(r),Lp(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(ys.UPDATE_SOURCE),this.audioElement.srcObject=r}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),on.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){const r=t.clone();r.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=r),k.debug("create an unmuted track ".concat(r.id," from the original track ").concat(t.id," to get the volume"));const a=this.context.createMediaStreamSource(new MediaStream([r]));Lp(a),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(a)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function X5(e,t,r){const a=(u,h)=>u?typeof u!="number"?u.max||u.exact||u.ideal||u.min||h:u:h,o={audio:!!r&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:a(t.height,1080),maxWidth:a(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(o.video.mandatory.maxFrameRate=t.frameRate.max,o.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(o.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(o)}async function Soe(e,t){const r=await J5(e.mediaSource),{sourceId:a,audio:o}=await(function(u){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new Fe(((m,g)=>{const y=document.createElement("div");y.innerText="share screen",y.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const E=document.createElement("div");E.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const A=document.createElement("div");A.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",A.setAttribute("style","height: 12%;");const O=document.createElement("div");O.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const N=document.createElement("div");N.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const B=document.createElement("button");B.innerHTML="cancel",B.setAttribute("style","width: 85px;"),B.onclick=()=>{document.body.removeChild(K);const z=new Error("NotAllowedError");z.name="NotAllowedError",g(z)};let U=h;const V=document.createElement("div");if(h){const z=document.createElement("input");z.setAttribute("type","checkbox");const J=document.createElement("span");z.setAttribute("style","margin-right: 6px;"),J.innerText="Share audio",z.checked=U,z.onchange=()=>{U=z.checked},V.appendChild(z),V.appendChild(J)}N.appendChild(V),N.appendChild(B),E.appendChild(A),E.appendChild(O),E.appendChild(N);const K=document.createElement("div");K.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),K.appendChild(y),K.appendChild(E),document.body.appendChild(K),u.map((z=>{if(z.id){const J=document.createElement("div");J.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let ae=z.thumbnail;try{const{width:ie}=ae.getSize();ie>1920&&(ae=ae.resize({width:1920}))}catch(ie){throw ie&&ie.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),ie}J.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+ae.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+z.name.replace(/[\u00A0-\u9999<>\&]/g,(function(ie){return"&#"+ie.charCodeAt(0)+";"}))+"</span>",J.onclick=()=>{document.body.removeChild(K),m({sourceId:z.id,audio:U})},O.appendChild(J)}}))}))})(r,t);return await X5(a,e,o)}async function J5(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);const r=c5();if(!r)throw console.error("failed to fetch electron, please mount it to window"),new ve(q.ELECTRON_IS_NULL);let a=null;try{var o;a=((o=r.desktopCapturer)===null||o===void 0?void 0:o.getSources({types:t}))||r.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{a=null}a&&a.then||(a=new Fe(((u,h)=>{r.desktopCapturer.getSources({types:t},((m,g)=>{m?h(m):u(g)}))})));try{return await a}catch(u){throw new ve(q.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,u.toString())}}const xD=new oi("safari");let $5=!1,Z5=!1;async function bs(e,t){let r=0,a=null;for(;r<2;)try{a=await boe(e,t,r>0);break}catch(o){if(o instanceof ve)throw k.error("[".concat(t,"] ").concat(o.toString())),o;const u=FC(o.name||o.code||o,o.message);if(u.code===q.MEDIA_OPTION_INVALID){k.debug("[".concat(t,"] detect media option invalid, retry")),r+=1,await Hr(500);continue}throw k.error("[".concat(t,"] ").concat(u.toString())),u}if(!a)throw new ve(q.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return a}async function boe(e,t,r){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new ve(q.NOT_SUPPORTED,"can not find getUserMedia");r&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const a=Vt(),o=new MediaStream;if(e.audioSource&&o.addTrack(e.audioSource),e.videoSource&&o.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return k.debug("Using Video Source/ Audio Source"),o;if(e.screen)if(c5())e.screen.sourceId?z_(o,await X5(e.screen.sourceId,e.screen,!!e.screenAudio)):z_(o,await Soe(e.screen,!!e.screenAudio));else if(Uu()&&e.screen.extensionId&&e.screen.mandatory){if(!a.getStreamFromExtension)throw new ve(q.NOT_SUPPORTED,"This browser does not support screen sharing");k.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const O=await(h=e.screen.extensionId,m=t,new Fe(((N,B)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},(U=>{if(!U||!U.streamId)return k.error("[".concat(m,"] No response from Chrome Plugin. Plugin not installed properly"),U),void B(new ve(q.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));N(U.streamId)}))}catch(U){k.error("[".concat(m,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),U.toString()),B(new ve(q.CHROME_PLUGIN_NOT_INSTALL))}})));e.screen.mandatory.chromeMediaSourceId=O,z_(o,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(a.getDisplayMedia){var u;e.screen.mediaSource&&B5(e.screen.mediaSource);const O={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(u=e.screen.displaySurface)!==null&&u!==void 0?u:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:N,surfaceSwitching:B,systemAudio:U,preferCurrentTab:V}=e.screen,K={selfBrowserSurface:N,surfaceSwitching:B,systemAudio:U,preferCurrentTab:V};!N&&delete K.selfBrowserSurface,!B&&delete K.surfaceSwitching,!U&&delete K.systemAudio,!V&&delete K.preferCurrentTab,k.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:O,audio:e.screenAudio,controls:K})),z_(o,await navigator.mediaDevices.getDisplayMedia(vn({video:O,audio:e.screenAudio},K)))}else{if(!Vn())throw k.error("[".concat(t,"] This browser does not support screenSharing")),new ve(q.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&B5(e.screen.mediaSource);const O={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};k.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(O))),z_(o,await navigator.mediaDevices.getUserMedia(O))}}var h,m;if(!e.video&&!e.audio)return o;let g={video:e.video,audio:e.audio},y=X("MEDIA_DEVICE_CONSTRAINTS");if(y)try{typeof y=="string"&&(y=JSON.parse(y)),g=oD(g,y)}catch{}k.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(g)),Lt();let E,A=null;(Zr()||Ti()||AC())&&(A=await xD.lock());try{E=await navigator.mediaDevices.getUserMedia(g)}catch(O){throw A&&A(),O}return g.audio&&($5=!0),g.video&&(Z5=!0),z_(o,E),A&&A(),o}function FC(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new ve(q.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new ve(q.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new ve(q.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new ve(q.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new ve(q.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new ve(q.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return k.error("getUserMedia unexpected error",e),new ve(q.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function z_(e,t){const r=e.getVideoTracks()[0],a=e.getAudioTracks()[0],o=t.getVideoTracks()[0],u=t.getAudioTracks()[0];u&&(a&&e.removeTrack(a),e.addTrack(u)),o&&(r&&e.removeTrack(r),e.addTrack(o))}const Ts=new class extends Mn{get state(){return this._state}set state(e){e!==this._state&&(this.emit(kp.STATE_CHANGE,e),this._state=e)}constructor(){super(),ue(this,"_state",J0.IDLE),ue(this,"isAccessMicrophonePermission",!1),ue(this,"isAccessCameraPermission",!1),ue(this,"lastAccessMicrophonePermission",!1),ue(this,"lastAccessCameraPermission",!1),ue(this,"checkdeviceMatched",!1),ue(this,"deviceInfoMap",new Map),this.init().then((()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval((()=>{(X("ENUMERATE_DEVICES_INTERVAL")||(OC()||CC()===Cr.HARMONY_OS)&&ju())&&this.updateDevicesInfo()}),X("ENUMERATE_DEVICES_INTERVAL_TIME"))})).catch((e=>k.error(e.toString())))}async enumerateDevices(e,t){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new ve(q.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const a=await navigator.mediaDevices.enumerateDevices(),o=this.checkMediaDeviceInfoIsOk(a);let u=!this.isAccessMicrophonePermission&&e,h=!this.isAccessCameraPermission&&t;o.audio&&(u=!1),o.video&&(h=!1);let m=null,g=null,y=null;if(!r&&(u||h)){if(xD.isLocked&&(k.debug("[device manager] wait GUM lock"),(await xD.lock())(),k.debug("[device manager] GUM unlock")),$5&&(u=!1,this.isAccessMicrophonePermission=!0),Z5&&(h=!1,this.isAccessCameraPermission=!0),k.debug("[device manager] check media device permissions",e,t,u,h),u&&h){try{y=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(E){const A=FC(E.name||E.code||E,E.message);if(A.code===q.PERMISSION_DENIED)throw A;k.warning("getUserMedia failed in getDevices",A)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(u){try{m=await navigator.mediaDevices.getUserMedia({audio:e})}catch(E){const A=FC(E.name||E.code||E,E.message);if(A.code===q.PERMISSION_DENIED)throw A;k.warning("getUserMedia failed in getDevices",A)}this.isAccessMicrophonePermission=!0}else if(h){try{g=await navigator.mediaDevices.getUserMedia({video:t})}catch(E){const A=FC(E.name||E.code||E,E.message);if(A.code===q.PERMISSION_DENIED)throw A;k.warning("getUserMedia failed in getDevices",A)}this.isAccessCameraPermission=!0}k.debug("[device manager] mic permission",e,"cam permission",t)}try{const E=await navigator.mediaDevices.enumerateDevices();return m&&m.getTracks().forEach((A=>A.stop())),g&&g.getTracks().forEach((A=>A.stop())),y&&y.getTracks().forEach((A=>A.stop())),m=null,g=null,y=null,E}catch(E){return m&&m.getTracks().forEach((A=>A.stop())),g&&g.getTracks().forEach((A=>A.stop())),y&&y.getTracks().forEach((A=>A.stop())),m=null,g=null,y=null,new ve(q.ENUMERATE_DEVICES_FAILED,E.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter((t=>t.kind==="audioinput"))}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter((t=>t.kind==="videoinput"))}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter((t=>t.kind==="audiooutput"))}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach((r=>{r.device.label===e&&(t=r.device.deviceId)})),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find((r=>r.deviceId===e));if(!t)throw new ve(q.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=J0.INITING;try{await this.updateDevicesInfo(),this.state=J0.INITEND}catch(e){throw k.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=J0.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new ve(q.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),r=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const o=e.find((h=>h.kind==="audioinput"&&h.deviceId==="default")),u=e.find((h=>h.kind==="audiooutput"&&h.deviceId==="default"));o&&u?u.groupId===o.groupId?k.debug("[device-check] default input ".concat(o.label," and output ").concat(u.label," is the same group")):k.debug("[device-check] default input ".concat(o.label," and output ").concat(u.label," is not the same group")):k.debug("[device-check] default input or output not found")}const a=this.checkMediaDeviceInfoIsOk(e);if(e.forEach((o=>{if(!o.deviceId)return;const u=this.deviceInfoMap.get("".concat(o.kind,"_").concat(o.deviceId));if((u?u.state:"INACTIVE")!=="ACTIVE"){const h={initAt:t,updateAt:t,device:o,state:"ACTIVE"};this.deviceInfoMap.set("".concat(o.kind,"_").concat(o.deviceId),h),r.push(h)}u&&(u.updateAt=t)})),this.deviceInfoMap.forEach(((o,u)=>{o.state==="ACTIVE"&&o.updateAt!==t&&(o.state="INACTIVE",r.push(o))})),this.state!==J0.INITEND)return a.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(a.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));r.forEach((o=>{switch(o.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(kp.RECORDING_DEVICE_CHANGED,o);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(kp.CAMERA_DEVICE_CHANGED,o);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(kp.PLAYOUT_DEVICE_CHANGED,o)}})),a.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),a.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter((o=>o.kind==="audioinput")),r=e.filter((o=>o.kind==="videoinput")),a={audio:!1,video:!1};for(const o of t)if(o.label&&o.deviceId){a.audio=!0;break}for(const o of r)if(o.label&&o.deviceId){a.video=!0;break}return a}};let DD=!1;const ws=new class extends Mn{constructor(){super(...arguments),ue(this,"onAutoplayFailed",void 0),ue(this,"onAudioAutoplayFailed",void 0)}};function Q5(){if(Lt(),!DD){const e=t=>{t.preventDefault(),DD=!1,B0()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};DD=!0,B0()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),k.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),ws.onAutoplayFailed?ws.onAutoplayFailed():ws.onAudioAutoplayFailed?k.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):k.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),ws.emit("autoplay-failed")}}function eF(e,t,r,a){if(!e)return;const o=nt.getBaseInfoBySessionId(e);if(!o)return;const u=o.info,h=Date.now(),m=vn(vn({},u),{},{vid:u.vid===void 0?0:Number(u.vid),lts:h,elapse:h-o.startTime,cbRegistered:ws.onAutoplayFailed||ws.onAudioAutoplayFailed?1:-1,errorMsg:r,mediaType:t,trackId:a,extend:void 0});nt.send({type:Nn.AUTOPLAY_FAILED,data:m},!0)}const Toe=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],ca=new class{constructor(){ue(this,"onAutoplayFailed",void 0),ue(this,"elementMap",new Map),ue(this,"elementStateMap",new Map),ue(this,"elementsNeedToResume",[]),ue(this,"sinkIdMap",new Map),ue(this,"autoResumeAfterInterruption",(e=>{Array.from(this.elementMap.entries()).forEach((t=>{let[r,a]=t;const o=this.elementStateMap.get(r),u=a.srcObject.getAudioTracks()[0],h=u&&u.readyState;if(k.debug("resume after interrupted, ele: ".concat(o," audio: ").concat(h," ").concat(e)),h==="live"){if(e)return a.pause(),void a.play();if(on.curState==="running")return x_()?(a.pause(),void a.play()):void(o&&o==="paused"&&a.play())}}))})),ue(this,"autoResumeAfterInterruptionOnIOS15_16",(()=>{Array.from(this.elementMap.entries()).forEach((e=>{let[t,r]=e;const a=r.srcObject.getAudioTracks()[0];a&&a.readyState==="live"&&(k.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),r.pause(),r.play())}))})),this.autoResumeAudioElement(),on.on(zr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),on.on(zr.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),on.on(zr.STATE_CHANGE,(()=>{Ti()&&on.prevState==="suspended"&&on.curState==="running"&&this.autoResumeAfterInterruption()}))}async setSinkID(e,t){const r=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),r)try{await r.setSinkId(t)}catch(a){throw new ve(q.PERMISSION_DENIED,"can not set sink id: "+a.toString())}}play(e,t,r,a){if(this.elementMap.has(t))return;const o=document.createElement("audio");o.autoplay=!0,o.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,o),this.elementMap.set(t,o),this.elementStateMap.set(t,ci.INIT),this.setVolume(t,r);const u=this.sinkIdMap.get(t);if(u)try{o.setSinkId(u).catch((m=>{k.warning("[".concat(t,"] set sink id failed"),m.toString())}))}catch(m){k.warning("[".concat(t,"] set sink id failed"),m.toString())}const h=o.play();h&&h.then&&h.catch((m=>{a&&eF(a,"audio",m.message,t),k.warning("audio element play warning",m.toString()),this.elementMap.has(t)&&m.name==="NotAllowedError"&&(k.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(o),NC((()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),Q5()})))}))}updateTrack(e,t){const r=this.elementMap.get(e);r&&(r.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){const r=this.elementMap.get(e);r&&(t=Math.max(0,Math.min(100,t)),r.volume=t/100)}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const r=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(r,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){Toe.forEach((r=>{t.addEventListener(r,(a=>{const o=this.elementStateMap.get(e),u=a.type==="pause"?"paused":a.type;if(k.debug("[".concat(e,"] audio-element-status change ").concat(o," => ").concat(u)),a.type==="error"){const h=t?.error;h&&k.error("[".concat(e,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(e,u)}))}))}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach((t=>{t.play().then((r=>{k.debug("Auto resume audio element success")})).catch((r=>{k.warning("Auto resume audio element failed!",r)}))})),this.elementsNeedToResume=[]};new Fe((t=>{document.body?t():window.addEventListener("load",(()=>t()))})).then((()=>{B0()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))}))}};function Wn(){return function(e,t,r){const a=r.value;return typeof a=="function"&&(r.value=function(){this._isClosed&&new ve(q.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",k);for(var o=arguments.length,u=new Array(o),h=0;h<o;h++)u[h]=arguments[h];const m=a.apply(this,u);return m instanceof Fe?new Fe(((g,y)=>{m.then(g).catch(y)})):m}),r}}class tF extends Mn{constructor(t){super(),ue(this,"name","VideoProcessorDestination"),ue(this,"ID","0"),ue(this,"_source",void 0),ue(this,"videoContext",void 0),ue(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new ve(q.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new ve(q.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(qi.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(qi.ON_TRACK,void 0)}}class nF extends Mn{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,r){super(),ue(this,"constraintsMap",new Map),ue(this,"statsRegistry",[]),ue(this,"usageRegistry",[]),ue(this,"trackId",void 0),ue(this,"direction",void 0),ue(this,"_chained",!1),this.trackId=t,this.direction=r}async getConstraints(){return await ei(this,Es.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,r){var a;return k.info("processor ".concat(r.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(r,t),hn(this,Es.REQUEST_UPDATE_CONSTRAINTS,Array.from(Pi(a=this.constraintsMap).call(a)))}async requestRevertConstraints(t){var r;if(this.constraintsMap.has(t))return k.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),hn(this,Es.REQUEST_UPDATE_CONSTRAINTS,Array.from(Pi(r=this.constraintsMap).call(r)))}registerStats(t,r,a){this.statsRegistry.find((o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===r))||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:r,cb:a})}unregisterStats(t,r){const a=this.statsRegistry.findIndex((o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===r));a!==-1&&this.statsRegistry.splice(a,1)}gatherStats(){const t=[];for(const{processorID:r,processorName:a,type:o,cb:u}of this.statsRegistry)try{const h=u();t.push({processorID:r,processorName:a,type:o,stats:h})}catch(h){k.error(new ve(q.UNEXPECTED_ERROR,h.message))}return t}registerUsage(t,r){this.usageRegistry.find((a=>a.processorID===t.ID&&a.processorName===t.name))||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:r})}unregisterUsage(t){const r=this.usageRegistry.findIndex((a=>a.processorID===t.ID&&a.processorName===t.name));r!==-1&&this.usageRegistry.splice(r,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:r}of this.usageRegistry)try{let a=r();a instanceof Fe&&(a=await a),t.push(vn(vn({},a),{},{direction:this.direction}))}catch(a){k.error("gather extension usage error",a)}return t}getDirection(){return this.direction}}class rF extends Mn{constructor(t){super(),ue(this,"name","AudioProcessorDestination"),ue(this,"ID","0"),ue(this,"inputTrack",void 0),ue(this,"inputNode",void 0),ue(this,"audioProcessorContext",void 0),ue(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new ve(q.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new ve(q.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(qi.ON_TRACK,void 0),this.emit(qi.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(qi.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(qi.ON_NODE,this.inputNode))}}class iF extends Mn{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,r,a){super(),ue(this,"constraintsMap",new Map),ue(this,"statsRegistry",[]),ue(this,"audioContext",void 0),ue(this,"trackId",void 0),ue(this,"direction",void 0),ue(this,"usageRegistry",[]),ue(this,"_chained",!1),this.audioContext=t,this.trackId=r,this.direction=a}async getConstraints(){return ei(this,Es.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,r){var a;return k.info("processor ".concat(r.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(r,t),hn(this,Es.REQUEST_UPDATE_CONSTRAINTS,Array.from(Pi(a=this.constraintsMap).call(a)))}async requestRevertConstraints(t){var r;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),hn(this,Es.REQUEST_UPDATE_CONSTRAINTS,Array.from(Pi(r=this.constraintsMap).call(r)))}registerStats(t,r,a){this.statsRegistry.find((o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===r))||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:r,cb:a})}unregisterStats(t,r){const a=this.statsRegistry.findIndex((o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===r));a!==-1&&this.statsRegistry.splice(a,1)}gatherStats(){const t=[];for(const{processorID:r,processorName:a,type:o,cb:u}of this.statsRegistry)try{const h=u();t.push({processorID:r,processorName:a,type:o,stats:h})}catch(h){k.error(new ve(q.UNEXPECTED_ERROR,h.message))}return t}registerUsage(t,r){this.usageRegistry.find((a=>a.processorID===t.ID&&a.processorName===t.name))||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:r})}unregisterUsage(t){const r=this.usageRegistry.findIndex((a=>a.processorID===t.ID&&a.processorName===t.name));r!==-1&&this.usageRegistry.splice(r,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:r}of this.usageRegistry)try{let a=r();a instanceof Fe&&(a=await a),t.push(vn(vn({},a),{},{direction:this.direction}))}catch(a){k.error("gather extension usage error",a)}return t}getDirection(){return this.direction}}class PD extends Mn{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),ue(this,"context",void 0),ue(this,"processSourceNode",void 0),ue(this,"outputTrack",void 0),ue(this,"processedNode",void 0),ue(this,"clonedTrack",void 0),ue(this,"outputNode",void 0),this.outputNode=new woe}setVolume(){}createOutputTrack(){throw new ve(q.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class woe{disconnect(){}connect(){}}function aF(e){return new Fe(((t,r)=>{let a=!1;const o=document.createElement("video");o.setAttribute("autoplay",""),o.setAttribute("muted",""),o.muted=!0,o.autoplay=!0,o.setAttribute("playsinline",""),o.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(o);const u=Ti()?"canplay":"playing";o.addEventListener(u,(()=>{const h=o.videoWidth,m=o.videoHeight;!h&&Vn()||(a=!0,o.srcObject=null,o.remove(),t([h,m]))})),o.srcObject=new MediaStream([e]),o.play().catch(xC),setTimeout((()=>{a||(o.srcObject=null,o.remove(),t([o.videoWidth,o.videoHeight]))}),4e3)}))}function GC(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const r=Ao(e.encoderConfig);return r.width!=null&&(t.width=r.width),r.height!=null&&(t.height=r.height),!r5()&&r.frameRate&&(t.frameRate=r.frameRate),XB()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),Vn()&&(t.frameRate={ideal:30,max:30}),t}function sF(e){const t={};return r5()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,Uu()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function oF(e){const t=sF(e);if(e.encoderConfig){const r=VC(e.encoderConfig);t.channelCount=r.stereo?2:1,t.sampleRate=r.sampleRate,t.sampleSize=r.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),OC()&&(t.sampleRate=void 0),t}const Roe=e=>{const t=e._encoderConfig;if(!t)return;const{frameRate:r,width:a,height:o}=e.getMediaStreamTrackSettings();let{frameRate:u=r,width:h=a,height:m=o}=t;if(!u||!h||!m)return;h=k_(h),m=k_(m),u=k_(u);const{max:g,min:y}=(function(N,B,U){const V=200*Math.pow(U/15,.6)*Math.pow(N*B/640/360,.75);return{min:Math.floor(V),max:Math.floor(4*V)}})(h,m,u),{bitrateMax:E,bitrateMin:A}=t||{};E||k.debug("calculate bitrate: [w: ".concat(h,", h: ").concat(m,", fps: ").concat(u,"] => [brMax: ").concat(E,", brMin: ").concat(A,"]"));const{maxFramerate:O}=X("ENCODER_CONFIG_LIMIT");return O&&typeof O=="number"&&(u=Math.min(u,O)),{frameRate:u,bitrateMax:E||g,bitrateMin:A||y,scaleResolutionDownBy:1,scale:0}},cF=async(e,t,r)=>await(async(a,o,u)=>{const h=(function(y){const E=[];for(let A=0;A<y.length;A+=2)E.push(parseInt(y.slice(A,A+2),16));return Uint8Array.from(E)})(y5(""+o+u)).slice(0,16),m=h.slice(0,12),g=await window.crypto.subtle.importKey("raw",h,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:m},g,a))})(e.buffer,t,r),kD=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new Fe(((r,a)=>{t.toBlob((async o=>{if(t.remove(),o){const u=await lF(o);r({buffer:u,width:t.width,height:t.height})}else a(new ve(q.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))}),e,1)}))},lF=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};var uF,dF,hF,fF,pF,mF,gF,_F,vF,yF,EF,SF,bF,TF,wF,RF,CF,AF,Un,OF,IF,NF,xF,DF,PF,Pl,kF,LF,MF,UF,jF,VF,BF,FF,GF,HF,WF,zF,KF,ni;let zn=(uF=lt({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),dF=lt({argsMap:(e,t)=>[e.getTrackId(),t]}),hF=Wn(),fF=L_("LocalAudioTrack","_enabledMutex"),pF=lt({argsMap:(e,t)=>[e.getTrackId(),t]}),mF=Wn(),gF=L_("LocalAudioTrack","_enabledMutex"),_F=lt({argsMap:(e,t)=>[e.getTrackId(),t]}),vF=Wn(),yF=Wn(),EF=Wn(),SF=lt({argsMap:e=>[e.getTrackId()]}),bF=Wn(),TF=lt({argsMap:e=>[e.getTrackId()]}),wF=Wn(),RF=lt({argsMap:e=>[e.getTrackId()]}),CF=lt({argsMap:(e,t)=>[e.getTrackId(),t.name]}),AF=lt({argsMap:e=>[e.getTrackId()]}),kt((Un=class extends H_{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?ca.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,r,a){super(e,r),ue(this,"trackMediaType",G_.AUDIO),ue(this,"_encoderConfig",void 0),ue(this,"_trackSource",void 0),ue(this,"metadata",[]),ue(this,"_enabled",!0),ue(this,"_volume",100),ue(this,"_useAudioElement",!0),ue(this,"_bypassWebAudio",!1),ue(this,"processor",void 0),ue(this,"_processorContext",void 0),ue(this,"_processorDestination",void 0),ue(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!a,this._trackSource=new PD,X("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),X("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Zr()&&!Ss?setTimeout((()=>this.initWebAudio())):this.initWebAudio()}setVolume(e){ln(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&ca.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void k.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,hn(this,$e.NEED_REPLACE_TRACK,this).then((()=>{k.debug("[".concat(this.getTrackId(),"] replace web audio track success"))})).catch((r=>{k.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),r)})))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!j5())throw new ve(q.NOT_SUPPORTED,"your browser does not support setting the audio output device");await ca.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,r){return this._setEnabled(e,t,r)}async _setEnabled(e,t,r){if(!r){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(k.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{r||(this._enabled=!0),await hn(this,$e.NEED_ENABLE_TRACK,this),k.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(a){throw r||(this._enabled=!1),k.error("[".concat(this.getTrackId(),"] setEnabled to true error"),a.toString()),a}}else{this._originMediaStreamTrack.enabled=!1,r||(this._enabled=!1);try{await hn(this,$e.NEED_DISABLE_TRACK,this)}catch(a){throw r||(this._enabled=!0),k.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,k.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await hn(this,$e.NEED_MUTE_TRACK,this):await hn(this,$e.NEED_UNMUTE_TRACK,this))}getStats(){return Nh((()=>{k.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")}),"localAudioTrackGetStatsWarning"),_s(this,$e.GET_STATS)||vn({},CD)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(ys.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(ys.ON_AUDIO_BUFFER),this._source.on(ys.ON_AUDIO_BUFFER,(r=>e(r)))}play(){k.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(k.debug("[".concat(this.getTrackId(),"] start audio playback in element")),ca.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){k.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?ca.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];k.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&ca.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await hn(this,$e.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return Fe.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new ve(q.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new ve(q.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(qi.ON_TRACK,(async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await hn(this,$e.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await hn(this,$e.NEED_REPLACE_TRACK,this))})),e.on(qi.ON_NODE,(t=>{this._source.processedNode=t}))}unbindProcessorDestinationEvents(e){e.removeAllListeners(qi.ON_TRACK),e.removeAllListeners(qi.ON_NODE)}bindProcessorContextEvents(e){e.on(Es.REQUEST_CONSTRAINTS,(async t=>{t(this._originMediaStreamTrack.getSettings())}))}unbindProcessorContextEvents(e){e.removeAllListeners(Es.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof PD&&(this._trackSource=new q5(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new iF(this._source.context,this.getTrackId(),"local"),t=new rF(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(ys.UPDATE_SOURCE,(()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})})),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(ca.stop(this.getTrackId()),this._source.play()),hn(this,$e.NEED_REPLACE_MIXING_TRACK,this).then((()=>{k.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))})).catch((r=>{k.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),r)}))),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[uF],Object.getOwnPropertyDescriptor(Un.prototype,"setVolume"),Un.prototype),kt(Un.prototype,"setPlaybackDevice",[dF,hF],Object.getOwnPropertyDescriptor(Un.prototype,"setPlaybackDevice"),Un.prototype),kt(Un.prototype,"setEnabled",[fF,pF,mF],Object.getOwnPropertyDescriptor(Un.prototype,"setEnabled"),Un.prototype),kt(Un.prototype,"setMuted",[gF,_F,vF],Object.getOwnPropertyDescriptor(Un.prototype,"setMuted"),Un.prototype),kt(Un.prototype,"getStats",[yF],Object.getOwnPropertyDescriptor(Un.prototype,"getStats"),Un.prototype),kt(Un.prototype,"setAudioFrameCallback",[EF],Object.getOwnPropertyDescriptor(Un.prototype,"setAudioFrameCallback"),Un.prototype),kt(Un.prototype,"play",[SF,bF],Object.getOwnPropertyDescriptor(Un.prototype,"play"),Un.prototype),kt(Un.prototype,"stop",[TF,wF],Object.getOwnPropertyDescriptor(Un.prototype,"stop"),Un.prototype),kt(Un.prototype,"close",[RF],Object.getOwnPropertyDescriptor(Un.prototype,"close"),Un.prototype),kt(Un.prototype,"pipe",[CF],Object.getOwnPropertyDescriptor(Un.prototype,"pipe"),Un.prototype),kt(Un.prototype,"unpipe",[AF],Object.getOwnPropertyDescriptor(Un.prototype,"unpipe"),Un.prototype),Un),$0=(OF=lt({argsMap:(e,t)=>[e.getTrackId(),t]}),IF=Wn(),NF=L_("MicrophoneAudioTrack","_enabledMutex"),xF=lt({argsMap:(e,t,r)=>[e.getTrackId(),t,r]}),DF=Wn(),PF=lt({argsMap:e=>[e.getTrackId()]}),kt((Pl=class extends zn{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,r,a){super(e,t.encoderConfig?VC(t.encoderConfig):{},a,X("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),ue(this,"_config",void 0),ue(this,"_deviceName","default"),ue(this,"_constraints",void 0),ue(this,"_originalConstraints",void 0),ue(this,"_enabled",!0),this._config=t,this._constraints=r,this._originalConstraints=r,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(x_()||eD())&&on.bindInterruptDetectorTrack(this)}async setDevice(e){if(k.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await Ts.getDeviceById(e),r={};r.audio=vn({},this._constraints),r.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let a=null;try{a=await bs(r,this.getTrackId())}catch(o){throw k.error("[".concat(this.getTrackId(),"] setDevice failed"),o.toString()),a=await bs({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!1),o}await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw k.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await Ts.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw k.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}k.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,r){if(t)return k.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!r){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(k.info("[".concat(this.getTrackId(),"] start setEnabled"),e),X("AUTO_RESET_AUDIO_ROUTE")&&(Ti()||wo())){const h=navigator.audioSession;h&&(e||(h.type="playback"),h.type="auto")}if(!e){var a;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(a=this._source.clonedTrack)===null||a===void 0||a.stop(),r||(this._enabled=!1);try{await hn(this,$e.NEED_DISABLE_TRACK,this)}catch(h){throw k.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),h}return}const o=vn({},this._constraints),u=Ts.searchDeviceIdByName(this._deviceName);u&&!o.deviceId&&(o.deviceId=u);try{r||(this._enabled=!0);const h=await bs({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await hn(this,$e.NEED_ENABLE_TRACK,this)}catch(h){throw r||(this._enabled=!1),k.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}k.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(x_()||eD())&&on.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Ti()||wo())&&this._enabled&&!this._isClosed&&on.duringInterruption){const e=async()=>{on.off(zr.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(k.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};on.on(zr.IOS_INTERRUPTION_END,e)}else k.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(F_.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,r=Ts.searchDeviceIdByName(this._deviceName);if(r&&!t.deviceId&&(t.deviceId=r),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const a=await bs({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(Es.REQUEST_UPDATE_CONSTRAINTS,(async(t,r,a)=>{try{const o=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(o),r()}catch(o){a(o)}}))}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(Es.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[OF,IF],Object.getOwnPropertyDescriptor(Pl.prototype,"setDevice"),Pl.prototype),kt(Pl.prototype,"setEnabled",[NF,xF,DF],Object.getOwnPropertyDescriptor(Pl.prototype,"setEnabled"),Pl.prototype),kt(Pl.prototype,"close",[PF],Object.getOwnPropertyDescriptor(Pl.prototype,"close"),Pl.prototype),Pl),Coe=(kF=lt({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),LF=Wn(),MF=lt({argsMap:e=>[e.getTrackId()]}),UF=Wn(),jF=lt({argsMap:e=>[e.getTrackId()]}),VF=Wn(),BF=lt({argsMap:e=>[e.getTrackId()]}),FF=Wn(),GF=lt({argsMap:e=>[e.getTrackId()]}),HF=Wn(),WF=lt({argsMap:e=>[e.getTrackId()]}),zF=lt({argsMap:e=>[e.getTrackId()]}),KF=Wn(),kt((ni=class extends zn{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,r,a){super(t.createOutputTrack(),r,a),ue(this,"source",void 0),ue(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(ys.AUDIO_SOURCE_STATE_CHANGE,(o=>{this.safeEmit(F_.SOURCE_STATE_CHANGE,o)}));try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){ln(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[kF,LF],Object.getOwnPropertyDescriptor(ni.prototype,"startProcessAudioBuffer"),ni.prototype),kt(ni.prototype,"pauseProcessAudioBuffer",[MF,UF],Object.getOwnPropertyDescriptor(ni.prototype,"pauseProcessAudioBuffer"),ni.prototype),kt(ni.prototype,"seekAudioBuffer",[jF,VF],Object.getOwnPropertyDescriptor(ni.prototype,"seekAudioBuffer"),ni.prototype),kt(ni.prototype,"resumeProcessAudioBuffer",[BF,FF],Object.getOwnPropertyDescriptor(ni.prototype,"resumeProcessAudioBuffer"),ni.prototype),kt(ni.prototype,"stopProcessAudioBuffer",[GF,HF],Object.getOwnPropertyDescriptor(ni.prototype,"stopProcessAudioBuffer"),ni.prototype),kt(ni.prototype,"close",[WF],Object.getOwnPropertyDescriptor(ni.prototype,"close"),ni.prototype),kt(ni.prototype,"setAudioBufferPlaybackSpeed",[zF,KF],Object.getOwnPropertyDescriptor(ni.prototype,"setAudioBufferPlaybackSpeed"),ni.prototype),ni);class dr extends zn{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){const t=W_().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,fn(8,"track-mix-")),ue(this,"trackList",void 0),ue(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(k.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):k.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){k.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}IC(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){const t={};this.trackList.forEach((r=>{r._encoderConfig&&((r._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=r._encoderConfig.bitrate),(r._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=r._encoderConfig.sampleRate),(r._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=r._encoderConfig.sampleSize),r._encoderConfig.stereo&&(t.stereo=!0))})),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach((r=>{r instanceof dr?r.emit(Pp.TRANSCEIVER_UPDATED,t):r._updateRtpTransceiver(t)})))}}class Aoe extends Y5{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(ys.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),ue(this,"audioBuffer",void 0),ue(this,"sourceNode",void 0),ue(this,"startPlayTime",0),ue(this,"startPlayOffset",0),ue(this,"pausePlayTime",0),ue(this,"options",void 0),ue(this,"currentLoopCount",0),ue(this,"currentPlaybackSpeed",100),ue(this,"_currentState","stopped"),this.audioBuffer=t,this.options=r,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):k.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const YF=new Map;function qF(e,t){if(e.length===0||t.length===0)return 1/0;const r=cD(e),a=cD(t);return Math.floor(a/r)}class LD{get rendFrameRate(){const t=Math.max(1,qF(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/t)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:ci.DESTROYED}set videoElementStatus(t){t!==this._videoElementStatus&&(k.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var r;t!==this._videoState&&(this._videoState=t,(r=this.onVideoStateChanged)===null||r===void 0||r.call(this,this.videoState))}constructor(t){ue(this,"trackId",void 0),ue(this,"config",void 0),ue(this,"onFirstVideoFrameDecoded",void 0),ue(this,"onFirstVideoFrameRender",void 0),ue(this,"onVideoStateChanged",void 0),ue(this,"freezeTimeCounterList",[]),ue(this,"renderFreezeAccTime",0),ue(this,"renderFreezeAccTime2",0),ue(this,"isKeepLastFrame",!1),ue(this,"isDestroyed",!1),ue(this,"timeUpdatedCount",0),ue(this,"freezeTime",0),ue(this,"playbackTime",0),ue(this,"lastTimeUpdatedTime",0),ue(this,"autoplayFailed",!1),ue(this,"videoTrack",void 0),ue(this,"videoElement",void 0),ue(this,"cacheVideoElement",void 0),ue(this,"internal",!1),ue(this,"_render_interframe_delays",[]),ue(this,"_render_interframe_delays_sizes",[]),ue(this,"_videoState",Dl.VideoStateStopped),ue(this,"videoElementCheckInterval",void 0),ue(this,"videoElementFreezeTimeout",void 0),ue(this,"_videoElementStatus",ci.NONE),ue(this,"_isInPage",!0),ue(this,"isGettingVideoDimensions",!1),ue(this,"startGetVideoDimensions",(()=>{const r=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return k.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(r,500)};!this.isGettingVideoDimensions&&r()})),ue(this,"autoResumeAfterInterruption",(()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&on.curState==="running"&&(k.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(YB())),t5()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))})),ue(this,"handleVideoEvents",(r=>{switch(r.type){case"play":case"playing":r.type==="play"&&k.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=ci.PLAYING;break;case"loadeddata":if(this.videoState=Dl.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=ci.CANPLAY;break;case"stalled":this.videoElementStatus=ci.STALLED;break;case"suspend":this.videoElementStatus=ci.SUSPEND;break;case"pause":this.videoElementStatus=ci.PAUSED,Ti()||wo()||Zr()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(k.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=ci.WAITING;break;case"abort":this.videoElementStatus=ci.ABORT;break;case"ended":this.videoElementStatus=ci.ENDED;break;case"emptied":this.videoElementStatus=ci.EMPTIED;break;case"error":{const a=this.videoElement.error;a&&(this.videoElementStatus=ci.ERROR,k.error("[".concat(this.trackId,"] media error: ").concat(a.message," (").concat(a.code,")")));break}case"timeupdate":{const a=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=a);const o=a-this.lastTimeUpdatedTime,u=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=a,kl.lastVisibleTime<kl.lastHiddenTime||u<kl.lastHiddenTime||u<kl.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(o>X("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=o),this.playbackTime+=o;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}})),ue(this,"autoResumeAfterInterruptionOnIOS15_16",(()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(k.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(YB())),t5()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))})),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),on.on(zr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),on.on(zr.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){const r=this.videoElement.play();r&&r.catch&&r.catch((o=>{t&&eF(t,"video",o.message,this.trackId),o.name==="NotAllowedError"?(k.warning("detected video element autoplay failed",o),this.autoplayFailed=!0,this.handleAutoPlayFailed()):k.warning("[".concat(this.trackId,"] play warning: "),o)}));const a=Lt();if((a.name==="Safari"&&Number(a.version)===15||x_())&&r&&r.then){const o=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};r.then(o).catch(o)}}getCurrentFrame(){const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const r=t.getContext("2d");if(!r)return k.error("create canvas context failed!"),new ImageData(2,2);r.drawImage(this.videoElement,0,0,t.width,t.height);const a=r.getImageData(0,0,t.width,t.height);return t.remove(),a}async getCurrentFrameToUint8Array(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const a=document.createElement("canvas");a.width=this.videoElement.videoWidth,a.height=this.videoElement.videoHeight;const o=a.getContext("2d");return o?(o.drawImage(this.videoElement,0,0,a.width,a.height),new Fe(((u,h)=>{a.toBlob((async m=>{if(a.remove(),m){const g=await lF(m);u({buffer:g,width:a.width,height:a.height})}else h(new ve(q.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))}),t,r<0?.1:r>1?1:r)}))):await kD(t)}destroy(){this.isDestroyed=!0,on.off(zr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),on.off(zr.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Dl.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=ci.INIT,!this.videoElementCheckInterval&&(XF.forEach((u=>{this.videoElement.addEventListener(u,this.handleVideoEvents)})),this.videoElementCheckInterval=window.setInterval((()=>{this._isInPage=(function(u){return u!==document.body&&document.body.contains(u)})(this.videoElement)}),1e3),X("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,r;let u;const h=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",h),this.videoElementFreezeTimeout=window.setTimeout(m,X("VIDEO_FREEZE_DURATION")))},m=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Dl.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=Dl.VideoStateFrozen:document.addEventListener("visibilitychange",h))},g=(y,E)=>{if(this.videoElementStatus===ci.PLAYING){if(u){const N=E.presentationTime-u.presentationTime,B=E.presentedFrames-u.presentedFrames;this._render_interframe_delays_sizes.push(B),this._render_interframe_delays.push(N);const U=cD(this._render_interframe_delays_sizes),V=U-this._render_interframe_delays_sizes[0];if(U>30&&V>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===Dl.VideoStateStarting&&(this.videoState=Dl.VideoStateDecoding),this.videoState===Dl.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(m,X("VIDEO_FREEZE_DURATION"))),N<X("VIDEO_FREEZE_DURATION")&&this.videoState===Dl.VideoStateFrozen&&(this.videoState=Dl.VideoStateDecoding),N>X("VIDEO_FREEZE_DURATION")&&kl.lastVisibleTime>=kl.lastHiddenTime&&u.timestamp>kl.lastVisibleTime&&u.timestamp>kl.lastHiddenTime){const K=Math.min(66,qF(this._render_interframe_delays_sizes,this._render_interframe_delays)),z=Math.max(0,N-(B-1)*K);this.renderFreezeAccTime2+=z>K?z:0,this.renderFreezeAccTime+=N}}u=vn(vn({},E),{},{timestamp:y})}else this.isSkipCalcRenderFreezeTime()&&(u=vn(vn({},E),{},{timestamp:y}));var A,O;X("ENABLE_VIDEO_FRAME_CALLBACK")&&((A=(O=this.videoElement).requestVideoFrameCallback)===null||A===void 0||A.call(O,g))};(t=(r=this.videoElement).requestVideoFrameCallback)===null||t===void 0||t.call(r,g)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),OC()&&!X("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const a=Lt();a.name==="Safari"&&Number(a.version)===15||x_()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Vn()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Vn()&&this.videoElement.load());const o=this.videoElement.play();o!==void 0&&o.catch((u=>{k.debug("[".concat(this.trackId,"] playback interrupted"),u.toString())}))}resetVideoElement(){XF.forEach((t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)})),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=ci.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===ci.DESTROYED||this.internal}handleAutoPlayFailed(){const t=r=>{r.preventDefault(),this.videoElement.play().then((()=>{k.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))})).catch((a=>{k.error(a)})),this.autoplayFailed=!1,B0()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};B0()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),Q5()}}const XF=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class MD extends LD{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(t),ue(this,"container",void 0),ue(this,"slot",void 0),this.slot=t.element,this.internal=r,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const r=t.element;var a;!this.internal||this.slot?(r!==this.slot&&(this.destroy(),this.slot=r),this.createElements()):(this.slot=r,r&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(a=this.slot)===null||a===void 0||a.appendChild(this.container)):this.createElements())}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var r;(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var r;let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,a):await kD(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var t;this.container.remove(),(t=this.slot)===null||t===void 0||t.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var t;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",X("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(t=this.slot)===null||t===void 0||t.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var JF,$F,ZF,QF,e6,t6,n6,r6,i6,a6,s6,o6,c6,l6,u6,d6,h6,f6,p6,m6,g6,_6,v6,y6,E6,S6,b6,T6,Ot,w6,R6,C6,A6,O6,I6,N6,x6,Rs;let wn=(JF=lt({argsMap:(e,t,r)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),$F=Wn(),ZF=lt({argsMap:e=>[e.getTrackId()]}),QF=L_("LocalVideoTrack","_enabledMutex"),e6=lt({argsMap:(e,t)=>[e.getTrackId(),t]}),t6=Wn(),n6=L_("LocalVideoTrack","_enabledMutex"),r6=lt({argsMap:(e,t)=>[e.getTrackId(),t]}),i6=Wn(),a6=lt({argsMap:(e,t)=>[e.getTrackId(),t,e._saveEncodeBitrateRatio]}),s6=Wn(),o6=lt({argsMap:(e,t)=>[e.getTrackId(),t]}),c6=Wn(),l6=Wn(),u6=lt({argsMap:(e,t,r)=>[e.getTrackId(),t,r]}),d6=Wn(),h6=Wn(),f6=Wn(),p6=lt({argsMap:e=>[e.getTrackId()]}),m6=Wn(),g6=Wn(),_6=Wn(),v6=Wn(),y6=Wn(),E6=lt({argsMap:(e,t)=>[e.getTrackId(),t.name]}),S6=lt({argsMap:e=>[e.getTrackId()]}),b6=lt({argsMap:e=>[e.getTrackId()]}),T6=lt({argsMap:(e,t,r)=>[e.getTrackId(),t.label,r]}),Ot=class zq extends H_{get videoHeight(){if(Zr()){const{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(Zr()){const{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==ci.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,r,a,o,u,h){if(super(t,u),ue(this,"trackMediaType",G_.VIDEO),ue(this,"_player",void 0),ue(this,"isUseScaleResolutionDownBy",!1),ue(this,"_videoVisibleTimer",null),ue(this,"_previousVideoVisibleStatus",void 0),ue(this,"_clearPreviousVideoVisibleStatus",(()=>this._previousVideoVisibleStatus=void 0)),ue(this,"_encoderConfig",void 0),ue(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),ue(this,"_optimizationMode",void 0),ue(this,"_saveEncodeBitrateRatio",1),ue(this,"_videoHeight",void 0),ue(this,"_videoWidth",void 0),ue(this,"_forceBitrateLimit",void 0),ue(this,"_enabled",!0),ue(this,"_processorDestination",void 0),ue(this,"_processorContext",void 0),Zr()){const{width:m,height:g}=t.getSettings();this._videoWidth=m,this._videoHeight=g}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=a,this._optimizationMode=o,this._hints=h||[],r&&this._hints.indexOf(un.CUSTOM_TRACK)!==-1?this._encoderConfig=Pn(r):this._encoderConfig=r,this._hints.indexOf(un.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(X1(Gt.CHROME,115)&&CC().indexOf("Windows")!==-1){const m=(function(g,y){if("VideoFrame"in window&&"TransformStream"in window&&Vt().supportWebRTCInsertableStream){const E=new MediaStreamTrackProcessor(g),A=new MediaStreamTrackGenerator({kind:"video"});let O,N,B=Date.now();const U=()=>{V&&(clearInterval(V),V=void 0),O&&(O.close(),O=void 0),g.stop(),N=void 0,A.removeEventListener("ended",U)};let V=window.setInterval((()=>{if(N&&O&&Date.now()-B>1e3)try{A.readyState==="live"?N.enqueue(O.clone()):U()}catch{U()}}),1e3);const K=new TransformStream({transform:(z,J)=>{A.readyState==="live"?(N=J,B=Date.now(),O===void 0?(O=z,J.enqueue(z.clone())):(J.enqueue(O),O=z)):z.close()}});return A.addEventListener("ended",U),E.readable.pipeThrough(K).pipeTo(A.writable),A}})(t);m&&(k.info("local screen video track begin to inject frame"),this._mediaStreamTrack=m)}r&&this._hints.indexOf(un.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(r),this._processorContext=new nF(this.getTrackId(),"local"),this._processorDestination=new tF(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const o=document.getElementById(t);o?t=o:(k.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}k.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const a=vn(vn(vn({},this._getDefaultPlayerConfig()),r),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(a):(t instanceof HTMLVideoElement?this._player=new LD(a):this._player=new MD(a),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval((()=>{try{const o=this.getVideoElementVisibleStatus();this.safeEmit(F_.VIDEO_ELEMENT_VISIBLE_STATUS,o)}catch{}}),X("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,k.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,r){if(!r){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(k.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await hn(this,$e.NEED_DISABLE_TRACK,this)}catch(a){throw k.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}return r||(this._enabled=!1),void k.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await hn(this,$e.NEED_ENABLE_TRACK,this)}catch(a){throw k.error("[".concat(this.getTrackId(),"] setEnabled to true error"),a.toString()),a}k.info("[".concat(this.getTrackId(),"] setEnabled to true success")),r||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,k.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await hn(this,$e.NEED_MUTE_TRACK,this):await hn(this,$e.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*t),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*t),k.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(t)),this._saveEncodeBitrateRatio=1;try{await hn(this,$e.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(k)}}}async setEncoderConfiguration(t,r){if(!this._enabled)throw new ve(q.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=Ao(t),X("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){const a=GC({encoderConfig:t});(Zr()||Ti()||wo())&&(a.deviceId=void 0),k.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(a));try{await this._originMediaStreamTrack.applyConstraints(a),this.updateMediaStreamTrackResolution()}catch(o){const u=new ve(q.UNEXPECTED_ERROR,o.toString());throw k.error("[".concat(this.getTrackId(),"] applyConstraints error"),u.toString()),u}}this._encoderConfig=t,this._hints.indexOf(un.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await hn(this,$e.NEED_UPDATE_VIDEO_ENCODER,this)}catch(a){return a.throw(k)}}getStats(){return Nh((()=>{k.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")}),"localVideoTrackGetStatsWarning"),_s(this,$e.GET_STATS)||vn({},AD)}async setBeautyEffect(t){k.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,r):await kD(t)}async findClosestProfile(){const{width:t,height:r,frameRate:a}=this.getMediaStreamTrackSettings(),{width:o,height:u,frameRate:h}=this._encoderConfig||{},m=k_(this._videoWidth||t||o||0),g=k_(this._videoHeight||r||u||0),y=(function(E,A,O){if(!Array.isArray(X("VIDEO_ENCODER_CONFIG_LIST"))||X("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;const N=Math.min(E,A);return!(N>=480)&&vn(vn({},X("VIDEO_ENCODER_CONFIG_LIST").find((B=>B.height>N))),{},{frameRate:O})})(m,g,k_(a||h||15));if(y)return k.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(m,"x").concat(g," => ").concat(JSON.stringify(y))),this.setEncoderConfiguration(y)}async setBitrateLimit(t){k.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t&&(this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate))}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void k.error(q.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const r=this._optimizationMode;try{this._optimizationMode=t,await hn(this,$e.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(a){throw this._optimizationMode=r,k.error("[".concat(this.getTrackId(),"] set optimization mode failed"),a.toString()),a}k.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return k.error(q.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,k.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){aF(this._originMediaStreamTrack).then((t=>{let[r,a]=t;this._videoHeight=a,this._videoWidth=r})).catch(xC)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new ve(q.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");k.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=Ao(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(un.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await hn(this,$e.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(k)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:r,frameRate:a}=this.getMediaStreamTrackSettings();if(!t||!r||!a)return;const{bitrateMax:o,bitrateMin:u}=this._encoderConfig;if(u==null||o==null){const{max:h,min:m}=(function(g,y,E,A,O){const N=X("BITRATE_ADAPTER_TYPE");if(N==="DEFAULT_BITRATE")return{min:A,max:O};if(O===void 0){const B=Math.floor(200*Math.pow(E/15,.6)*Math.pow(g*y/640/360,.75));O=N==="STANDARD_BITRATE"?4*B:2*B,A=A??B}else A=A??Math.floor(O/10);return{min:A,max:O}})(t,r,a,u,o);if(this._encoderConfig.bitrateMin=m,this._encoderConfig.bitrateMax=h,X("VIDEO_STANDARD_BITRATE_VERSION")&&u==null&&o==null){const[g,y]=(function(E,A,O){const N=4*Math.floor(2e5*Math.pow(O/15,.6)*Math.pow(E*A/230400,.75)),B=E*A,U=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),V=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let K=Pi(U).call(U).next().value,z=1;if(U.has(B))K=U.get(B);else{var J;const Ne=_(J=Array.from(U.entries())).call(J,((Rt,ft)=>{let[Xt]=Rt,[Wt]=ft;return Xt-Wt})),bt=Ne.find((Rt=>{let[ft]=Rt;return ft>B}));if(bt){const Rt=Ne.indexOf(bt);if(Rt>0){const ft=Ne[Rt-1],Xt=(B-ft[0])/(bt[0]-ft[0]);K=ft[1]+Xt*(bt[1]-ft[1])}else K=bt[1]}else K=Ne[Ne.length-1][1]}if(V.has(B))z=V.get(B);else{var ae;const Ne=_(ae=Array.from(V.entries())).call(ae,((Rt,ft)=>{let[Xt]=Rt,[Wt]=ft;return Xt-Wt})),bt=Ne.find((Rt=>{let[ft]=Rt;return ft>B}));if(bt){const Rt=Ne.indexOf(bt);if(Rt>0){const ft=Ne[Rt-1],Xt=(B-ft[0])/(bt[0]-ft[0]);z=ft[1]+Xt*(bt[1]-ft[1])}else z=bt[1]}else z=Ne[Ne.length-1][1]}const ie=X("VIDEO_NEW_BITRATE_RATIO");ie&&ie>0&&(K=ie/100);const ee=Math.floor(N*K),le=Math.floor(65e4*Math.pow(E*A/230400,.5)*Math.pow(O/15,.69));let ye=ee;const we=X("VIDEO_STANDARD_BITRATE_VERSION");return we&&we>0&&(we===1?ye=N:we===2?ye=ee:we===3&&(ye=le)),[Math.floor(ye/1e3),z]})(t,r,a);this._encoderConfig.bitrateMax=g,this._encoderConfig.bitrateMin=m?Math.min(m,g):g,this._saveEncodeBitrateRatio=y,k.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(t,", h: ").concat(r,", fps: ").concat(a,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else k.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(r,", fps: ").concat(a,"] => [brMax: ").concat(h,", brMin: ").concat(m,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var t,r;const a=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),o={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:a?.parentElement},{element:u,slot:h}=o;if(this.isPlaying&&u instanceof HTMLVideoElement&&h instanceof HTMLElement){const m=s5.checkOneElementVisible(u),g=Object.assign({},m);if(g.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=g.visible;const y=nt.reportApiInvoke(null,{tag:Dn.TRACER,name:Xn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});g.visible?y.onSuccess("Video is visible"):y.onSuccess("Invisible because of ".concat(g.reason))}return g}return}catch(a){throw new ve(q.GET_VIDEO_ELEMENT_VISIBLE_ERROR,a.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new ve(q.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],a=this._encoderConfig;t&&(a=vn(vn({},a),Ao(t))),a=Ip(a);const o=fn(8,"track-video-cloned-"),u=new zq(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,a,Ip(this._scalabilityMode),this._optimizationMode,o,Ip(this._hints));return t&&a&&u.setEncoderConfiguration(a),k.debug("clone video track from ".concat(this.getTrackId()," to ").concat(o,", clone ").concat(r)),u}async replaceTrack(t,r){if(!(t instanceof MediaStreamTrack))throw new ve(q.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new ve(q.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,r,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t){if(Nh((()=>{nt.reportApiInvoke(null,{name:Xn.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Dn.TRACER}).onSuccess("")}),this._mediaStreamTrack.id||this.getTrackId()),!X("ENABLE_VIDEO_SEI")||!X("ENABLE_ENCODED_TRANSFORM"))return void k.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new ve(q.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const r=this.getRTCRtpTransceiver();if(!r)return void k.warning("Video track is not published, SEI can not be send");const a=r.sender.getParameters();if(a.codecs.length===0)return;const o=a.codecs[0].mimeType.toLocaleLowerCase();o==="video/h264"||o==="video/h265"?this.safeEmit("sei-to-send",t):k.warning("SEI is not supported by ".concat(o))}bindProcessorDestinationEvents(){this.processorDestination.on(qi.ON_TRACK,(async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await hn(this,$e.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await hn(this,$e.NEED_REPLACE_TRACK,this))}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(qi.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Es.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Es.REQUEST_CONSTRAINTS)}},kt(Ot.prototype,"play",[JF,$F],Object.getOwnPropertyDescriptor(Ot.prototype,"play"),Ot.prototype),kt(Ot.prototype,"stop",[ZF],Object.getOwnPropertyDescriptor(Ot.prototype,"stop"),Ot.prototype),kt(Ot.prototype,"setEnabled",[QF,e6,t6],Object.getOwnPropertyDescriptor(Ot.prototype,"setEnabled"),Ot.prototype),kt(Ot.prototype,"setMuted",[n6,r6,i6],Object.getOwnPropertyDescriptor(Ot.prototype,"setMuted"),Ot.prototype),kt(Ot.prototype,"setSaveEncodeBitrateRatio",[a6,s6],Object.getOwnPropertyDescriptor(Ot.prototype,"setSaveEncodeBitrateRatio"),Ot.prototype),kt(Ot.prototype,"setEncoderConfiguration",[o6,c6],Object.getOwnPropertyDescriptor(Ot.prototype,"setEncoderConfiguration"),Ot.prototype),kt(Ot.prototype,"getStats",[l6],Object.getOwnPropertyDescriptor(Ot.prototype,"getStats"),Ot.prototype),kt(Ot.prototype,"setBeautyEffect",[u6,d6],Object.getOwnPropertyDescriptor(Ot.prototype,"setBeautyEffect"),Ot.prototype),kt(Ot.prototype,"getCurrentFrameData",[h6],Object.getOwnPropertyDescriptor(Ot.prototype,"getCurrentFrameData"),Ot.prototype),kt(Ot.prototype,"getCurrentFrameImage",[f6],Object.getOwnPropertyDescriptor(Ot.prototype,"getCurrentFrameImage"),Ot.prototype),kt(Ot.prototype,"findClosestProfile",[p6,m6],Object.getOwnPropertyDescriptor(Ot.prototype,"findClosestProfile"),Ot.prototype),kt(Ot.prototype,"setBitrateLimit",[g6],Object.getOwnPropertyDescriptor(Ot.prototype,"setBitrateLimit"),Ot.prototype),kt(Ot.prototype,"setOptimizationMode",[_6],Object.getOwnPropertyDescriptor(Ot.prototype,"setOptimizationMode"),Ot.prototype),kt(Ot.prototype,"setScalabiltyMode",[v6],Object.getOwnPropertyDescriptor(Ot.prototype,"setScalabiltyMode"),Ot.prototype),kt(Ot.prototype,"updateMediaStreamTrackResolution",[y6],Object.getOwnPropertyDescriptor(Ot.prototype,"updateMediaStreamTrackResolution"),Ot.prototype),kt(Ot.prototype,"pipe",[E6],Object.getOwnPropertyDescriptor(Ot.prototype,"pipe"),Ot.prototype),kt(Ot.prototype,"unpipe",[S6],Object.getOwnPropertyDescriptor(Ot.prototype,"unpipe"),Ot.prototype),kt(Ot.prototype,"close",[b6],Object.getOwnPropertyDescriptor(Ot.prototype,"close"),Ot.prototype),kt(Ot.prototype,"replaceTrack",[T6],Object.getOwnPropertyDescriptor(Ot.prototype,"replaceTrack"),Ot.prototype),Ot),HC=(w6=lt({argsMap:(e,t)=>[e.getTrackId(),t]}),R6=Wn(),C6=L_("CameraVideoTrack","_enabledMutex"),A6=lt({argsMap:(e,t)=>[e.getTrackId(),t]}),O6=Wn(),I6=lt({argsMap:(e,t)=>[e.getTrackId(),t]}),N6=Wn(),x6=lt({argsMap:e=>[e.getTrackId()]}),Rs=class Kq extends wn{get __className__(){return"CameraVideoTrack"}constructor(t,r,a,o,u,h){super(t,Ao(r.encoderConfig),o,u,h),ue(this,"_config",void 0),ue(this,"_originalConstraints",void 0),ue(this,"_constraints",void 0),ue(this,"_enabled",!0),ue(this,"_deviceName","default"),ue(this,"tryResumeVideoForIOS15_16WeChat",(async()=>{(x_()||eD())&&!(function(){const m=Lt();if(m.os!==Cr.IOS||!m.osVersion)return!1;const g=m.osVersion.split(".");return Number(g[0])===15&&Number(g[1])>=2})()&&n5()&&this._enabled&&!this._isClosed&&(k.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())})),this._config=r,this._originalConstraints=a,this._constraints=a,this._deviceName=t.label,this._encoderConfig=Ao(this._config.encoderConfig),on.on(zr.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),on.on(zr.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(k.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{const r=await Ts.getDeviceById(t),a={};a.video=vn({},this._constraints),a.video.deviceId={exact:t},a.video.facingMode=void 0,this._originMediaStreamTrack.stop();let o=null;try{o=await bs(a,this.getTrackId())}catch(u){throw k.error("[".concat(this.getTrackId(),"] setDevice failed"),u.toString()),o=await bs({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),u}await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=r.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(r){throw k.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}else try{const r=await Ts.getDeviceById(t);this._deviceName=r.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(r){throw k.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}k.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){k.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));const r={video:vn(vn({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let a=null;try{a=await bs(r,this.getTrackId())}catch(o){throw k.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),o.toString()),a=await bs({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),o}await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=vn({},r.video),k.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,r){if(!r){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(k.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const a=await bs({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1)}await hn(this,$e.NEED_ENABLE_TRACK,this)}catch(a){throw k.error("[".concat(this.getTrackId(),"] setEnabled true error"),a.toString()),a}this.updateMediaStreamTrackResolution(),k.info("[".concat(this.getTrackId(),"] setEnabled to true success")),r||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),r||(this._enabled=!1);try{await hn(this,$e.NEED_DISABLE_TRACK,this)}catch(a){throw k.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}k.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,r){if(!this._enabled)throw new ve(q.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=Ao(t),X("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);const a=Pn(this._config);a.encoderConfig=t;const o=GC(a);(Zr()||Ti()||wo())&&(o.deviceId=void 0),k.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(o));try{await this._originMediaStreamTrack.applyConstraints(o),this.updateMediaStreamTrackResolution()}catch(u){const h=new ve(q.UNEXPECTED_ERROR,u.toString());throw k.error("[".concat(this.getTrackId(),"] applyConstraints error"),h.toString()),h}this._config=a,this._constraints=o,this._originalConstraints=o,this._encoderConfig=t,this._hints.indexOf(un.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await hn(this,$e.NEED_UPDATE_VIDEO_ENCODER,this)}catch(u){return u.throw(k)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Ti()||wo())&&this._enabled&&!this._isClosed&&on.duringInterruption){const t=async()=>{on.off(zr.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(k.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};on.on(zr.IOS_INTERRUPTION_END,t)}else k.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(F_.TRACK_ENDED)}async renewMediaStreamTrack(t){const r=t||this._constraints,a=Ts.searchDeviceIdByName(this._deviceName);if(a&&!r.deviceId&&(r.deviceId={exact:a}),this._enabled){const o=await bs({video:r},this.getTrackId());this._constraints=r,await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),on.off(zr.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),on.off(zr.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],a=this._encoderConfig;t&&(a=vn(vn({},a),Ao(t))),a=Ip(a);const o=fn(8,"track-cam-cloned-"),u=new Kq(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,Ip(vn(vn({},this._config),{},{encoderConfig:a})),Ip(this._constraints),Ip(this._scalabilityMode),this._optimizationMode,o);return t&&a&&u.setEncoderConfiguration(a),k.debug("clone track from ".concat(this.getTrackId()," to ").concat(o,", clone ").concat(r)),u}bindProcessorContextEvents(){this.processorContext.on(Es.REQUEST_UPDATE_CONSTRAINTS,(async(t,r,a)=>{try{const o=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(o),r()}catch(o){a(o)}})),this.processorContext.on(Es.REQUEST_CONSTRAINTS,(async t=>{t(this._originMediaStreamTrack.getSettings())}))}},kt(Rs.prototype,"setDevice",[w6,R6],Object.getOwnPropertyDescriptor(Rs.prototype,"setDevice"),Rs.prototype),kt(Rs.prototype,"setEnabled",[C6,A6,O6],Object.getOwnPropertyDescriptor(Rs.prototype,"setEnabled"),Rs.prototype),kt(Rs.prototype,"setEncoderConfiguration",[I6,N6],Object.getOwnPropertyDescriptor(Rs.prototype,"setEncoderConfiguration"),Rs.prototype),kt(Rs.prototype,"close",[x6],Object.getOwnPropertyDescriptor(Rs.prototype,"close"),Rs.prototype),Rs);function UD(e,t,r,a){r.optimizationMode&&(a&&a.width&&a.height?(r.encoderConfig=vn(vn({},a),{},{bitrateMin:a.bitrateMin,bitrateMax:a.bitrateMax}),r.optimizationMode!=="motion"&&r.optimizationMode!=="detail"||(t.contentHint=r.optimizationMode,t.contentHint===r.optimizationMode?k.debug("[".concat(e,"] set content hint to"),r.optimizationMode):k.debug("[".concat(e,"] set content hint failed")))):k.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var D6,P6,k6,L6,Ws,M6,U6,j6,V6,B6,F6,Li;class G6 extends W5{getUserId(){return this._userId}constructor(t,r,a,o){super(t,"track-".concat(t.kind,"-").concat(r,"-").concat(o.clientId,"_").concat(fn(5,""))),ue(this,"_userId",void 0),ue(this,"_uintId",void 0),ue(this,"_isDestroyed",!1),ue(this,"store",void 0),ue(this,"processor",void 0),ue(this,"processorContext",void 0),this._userId=r,this._uintId=a,this.store=o}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,k.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let K_=(D6=lt({argsMap:(e,t,r)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),P6=lt({argsMap:e=>[e.getTrackId()]}),k6=lt({argsMap:(e,t)=>[e.getTrackId(),t.name]}),L6=lt({argsMap:e=>[e.getTrackId()]}),kt((Ws=class extends G6{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==ci.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,r,a,o){super(e,t,r,a),ue(this,"_videoVisibleTimer",null),ue(this,"_previousVideoVisibleStatus",void 0),ue(this,"_clearPreviousVideoVisibleStatus",(()=>this._previousVideoVisibleStatus=void 0)),ue(this,"trackMediaType",G_.VIDEO),ue(this,"_videoWidth",void 0),ue(this,"_videoHeight",void 0),ue(this,"_player",void 0),ue(this,"_prePlayer",void 0),ue(this,"processorDestination",void 0),ue(this,"processorContext",void 0),this._prePlayer=o,this.updateMediaStreamTrackResolution(),this.processorContext=new nF(this.getTrackId(),"remote"),this.processorDestination=new tF(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Nh((()=>{k.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")}),"remoteVideoTrackGetStatsWarning"),_s(this,$e.GET_STATS)||vn({},G5)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit(Hs.PLAY_START),typeof e=="string"){const a=document.getElementById(e);a?e=a:(k.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}k.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const r=vn(vn({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});if(this._player)this._player.updateConfig(r);else{let a=!1,o=!1;e instanceof HTMLVideoElement?(this._player=new LD(r),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,o=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,a=this._player.videoState>0,this._player.updateConfig(r)):this._player=new MD(r),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Hs.FIRST_FRAME_DECODED),o&&this.safeEmit(Hs.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=u=>{this.safeEmit(Hs.VIDEO_STATE_CHANGED,u)},a&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval((()=>{try{const a=this.getVideoElementVisibleStatus();this.safeEmit(Hs.VIDEO_ELEMENT_VISIBLE_STATUS,a)}catch{}}),X("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(Hs.PLAY_END)}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,k.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){aF(this._originMediaStreamTrack).then((e=>{let[t,r]=e;this._videoHeight=r,this._videoWidth=t})).catch(xC)}_updatePlayerSource(){k.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const r=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),a={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:r?.parentElement},{element:o,slot:u}=a;if(this.isPlaying&&o instanceof HTMLVideoElement&&u instanceof HTMLElement){const h=s5.checkOneElementVisible(o),m=Object.assign({},h);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;const g=nt.reportApiInvoke(null,{tag:Dn.TRACER,name:Xn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});m.visible?g.onSuccess("Video is visible"):g.onSuccess("Invisible because of ".concat(m.reason))}return m}return}catch(r){throw new ve(q.GET_VIDEO_ELEMENT_VISIBLE_ERROR,r.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new ve(q.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(qi.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(qi.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(Pp.SEI_RECEIVED,e)}}).prototype,"play",[D6],Object.getOwnPropertyDescriptor(Ws.prototype,"play"),Ws.prototype),kt(Ws.prototype,"stop",[P6],Object.getOwnPropertyDescriptor(Ws.prototype,"stop"),Ws.prototype),kt(Ws.prototype,"pipe",[k6],Object.getOwnPropertyDescriptor(Ws.prototype,"pipe"),Ws.prototype),kt(Ws.prototype,"unpipe",[L6],Object.getOwnPropertyDescriptor(Ws.prototype,"unpipe"),Ws.prototype),Ws),Y_=(M6=lt({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),U6=lt({argsMap:(e,t)=>[e.getTrackId(),t]}),j6=lt({argsMap:e=>[e.getTrackId()]}),V6=lt({argsMap:e=>[e.getTrackId()]}),B6=lt({argsMap:(e,t)=>[e.getTrackId(),t.name]}),F6=lt({argsMap:e=>[e.getTrackId()]}),kt((Li=class extends G6{get isPlaying(){return this._useAudioElement?ca.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,r,a){super(e,t,r,a),ue(this,"trackMediaType",G_.AUDIO),ue(this,"_source",void 0),ue(this,"_useAudioElement",!0),ue(this,"_volume",100),ue(this,"processorContext",void 0),ue(this,"processorDestination",void 0),ue(this,"_played",!1),ue(this,"_bypassWebAudio",!1),X("DISABLE_WEBAUDIO")?(this._source=new PD,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new q5(e,!0),X("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(ys.RECEIVE_TRACK_BUFFER,(()=>{this.safeEmit(Hs.FIRST_FRAME_DECODED)})),this.processorContext=new iF(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new rF(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(ys.UPDATE_SOURCE,(()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})}))}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(ys.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(ys.ON_AUDIO_BUFFER),this._source.on(ys.ON_AUDIO_BUFFER,(r=>e(r)))}setVolume(e){this._volume=e,this._useAudioElement?ca.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!j5())throw new ve(q.NOT_SUPPORTED,"your browser does not support setting the audio output device");await ca.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Nh((()=>{k.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")}),"remoteAudioTrackGetStatsWarning"),_s(this,$e.GET_STATS)||vn({},F5)}play(){k.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(k.debug("[".concat(this.getTrackId(),"] use audio element to play")),ca.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){k.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?ca.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];k.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&ca.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new ve(q.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new ve(q.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new ve(q.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(qi.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})),this.processorDestination.on(qi.ON_NODE,(e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(qi.ON_TRACK),this.processorDestination.removeAllListeners(qi.ON_NODE)}}).prototype,"setVolume",[M6],Object.getOwnPropertyDescriptor(Li.prototype,"setVolume"),Li.prototype),kt(Li.prototype,"setPlaybackDevice",[U6],Object.getOwnPropertyDescriptor(Li.prototype,"setPlaybackDevice"),Li.prototype),kt(Li.prototype,"play",[j6],Object.getOwnPropertyDescriptor(Li.prototype,"play"),Li.prototype),kt(Li.prototype,"stop",[V6],Object.getOwnPropertyDescriptor(Li.prototype,"stop"),Li.prototype),kt(Li.prototype,"pipe",[B6],Object.getOwnPropertyDescriptor(Li.prototype,"pipe"),Li.prototype),kt(Li.prototype,"unpipe",[F6],Object.getOwnPropertyDescriptor(Li.prototype,"unpipe"),Li.prototype),Li);const kl=new class extends Mn{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),ue(this,"_lastHiddenTime",0),ue(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",(()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),k.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)}))}};class H6 extends Mn{constructor(t,r){super(),ue(this,"trackMediaType",G_.DATA),ue(this,"_version",1),ue(this,"_type",3),ue(this,"_config",void 0),ue(this,"_originDataChannel",void 0),ue(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),ue(this,"_dataStreamPacketHandler",{serialize:a=>a,deserialize:a=>a}),ue(this,"_datachannelEventMap",new Map),this._config=t,r&&(this._originDataChannel=r,this._bandDataChannelEvents(r)),this._initPacketHeader()}useDataStream(t){this._dataStreamPacketHandler=t}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return X("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,r;return(t=(r=this._originDataChannel)===null||r===void 0?void 0:r.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,r;return(t=(r=this._originDataChannel)===null||r===void 0?void 0:r.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new Fe(((t,r)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();const a=setTimeout((()=>{var o;r(new ve(q.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((o=this._originDataChannel)===null||o===void 0?void 0:o.id)))}),1e4);this._originDataChannel.onopen=()=>{clearTimeout(a),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(a),new ve(q.DATACHANNEL_CONNECTION_TIMEOUT)}}else r(new ve(q.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))}))}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){const t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[BC.OPEN,BC.CLOSE,BC.ERROR].forEach((r=>{const a=()=>{this.emit(r)};this._datachannelEventMap.set(r,a),t.addEventListener(r,a)}))}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach((r=>{let[a,o]=r;t.removeEventListener(a,o)})),this._datachannelEventMap.clear()}}class Ooe extends H6{constructor(t){super(t),ue(this,"_messageListener",void 0),this._messageListener=r=>{if(r.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const a=r.data.slice(0,this._dataStreamPacketHeader.byteLength),o=new DataView(a).getUint8(3);if(o!==this.id)return void(X("SHOW_DATASTREAM2_LOG")&&k.debug("invalid datachannel id: ".concat(o," !== ").concat(this.id)));let u=r.data.slice(this._dataStreamPacketHeader.byteLength);u=this._dataStreamPacketHandler.deserialize(u),this.emit(BC.MESSAGE,u)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class Ioe extends H6{send(t){if(this._originDataChannel){let r=t;r=this._dataStreamPacketHandler.serialize(t);const a=new Uint8Array(this._dataStreamPacketHeader.byteLength+r.byteLength);a.set(new Uint8Array(this._dataStreamPacketHeader),0),a.set(new Uint8Array(r),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(a.buffer)}}}function WC(){const e=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcjtsZXQgbj1bXSxyPVtdO2Uub3B0aW9ucy5wb3J0Lm9ubWVzc2FnZT10PT57dC5kYXRhLnNlaSYmbi5wdXNoKHQuZGF0YS5zZWkpLHQuZGF0YS5tZXRhZGF0YSYmci5wdXNoKHQuZGF0YS5tZXRhZGF0YSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBoPWUucmVhZGFibGUuZ2V0UmVhZGVyKCksVT1lLndyaXRhYmxlLmdldFdyaXRlcigpOyJzZWktcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtoLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRWaWRlb0ZyYW1lKXtjb25zdCB0PWkobmV3IFVpbnQ4QXJyYXkobi52YWx1ZS5kYXRhKSkscj1hKG4udmFsdWUsdCk7ciYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTpyfSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6InNlaS10eCI9PT1lLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2gucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9aShuZXcgVWludDhBcnJheShhLnZhbHVlLmRhdGEpKSxlPW4uc2hpZnQoKTtpZihlKXtjb25zdCBuPW8oYS52YWx1ZS5kYXRhLGUsdCk7biYmKGEudmFsdWUuZGF0YT1uKX19VS53cml0ZShhLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6ImF1ZGlvLW1ldGFkYXRhLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1uZXcgRGF0YVZpZXcobi52YWx1ZS5kYXRhKSxhPXQuZ2V0VWludDgoMCk7bGV0IHI7aWYoMCE9KDEyOCZhKSYmNzEhPT1hKXtsZXQgZT1mdW5jdGlvbih0KXtpZih0LmJ5dGVMZW5ndGg8PTApcmV0dXJuW107Y29uc3QgZT1bXTtsZXQgbj0wO2Zvcig7bjx0LmJ5dGVMZW5ndGg7KXtjb25zdCBhPSgxMjgmdC5nZXRVaW50OChuKSk+Pjcscj0xMjcmdC5nZXRVaW50OChuKTtpZighKGEmJm4rNDw9dC5ieXRlTGVuZ3RoKSl7bisrO2JyZWFrfXtjb25zdCBhPXQuZ2V0VWludDMyKG4sITEpLG89KDE2Nzc2MTkyJmEpPj4xMCxpPTEwMjMmYTtlLnB1c2goe3B0OnIsdHNfb2Zmc2V0Om8sbGVuZ3RoOmksZGF0YTpuZXcgVWludDhBcnJheX0pLG4rPTR9fWxldCBhPXQuYnl0ZUxlbmd0aC1uO2Zvcihjb25zdCByIG9mIGUpe2lmKHIubGVuZ3RoPmEpcmV0dXJuIGNvbnNvbGUud2FybigiQnJva2VuIHJlZCBwYXlsb2FkIiksW107ci5sZW5ndGg+MCYmKHIuZGF0YT1uZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixyLmxlbmd0aCksbis9ci5sZW5ndGgsYS09ci5sZW5ndGgpfWlmKGE+MCl7Y29uc3Qgcj17cHQ6ZS5sZW5ndGg+MD9lW2UubGVuZ3RoLTFdLnB0OjAsdHNfb2Zmc2V0OjAsbGVuZ3RoOmEsZGF0YTpuZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixhKX07ZS5wdXNoKHIpfXJldHVybiBlfSh0KTtpZihlLmxlbmd0aD4wKXtjb25zdCB0PWZ1bmN0aW9uKHQpe2xldCBlPTA7Zm9yKGxldCBuPTA7bjx0Lmxlbmd0aDtuKyspZSs9bjx0Lmxlbmd0aC0xPzQ6MSxlKz10W25dLmxlbmd0aDtjb25zdCBuPW5ldyBVaW50OEFycmF5KGUpO2xldCBhPTA7Zm9yKGxldCBlPTA7ZTx0Lmxlbmd0aDtlKyspaWYoZTx0Lmxlbmd0aC0xKXtjb25zdCByPSgyMTQ3NDgzNjQ4fCgxMjcmdFtlXS5wdCk8PDI0fCgyNjIxNDMmdFtlXS50c19vZmZzZXQpPDwxMHwxMDIzJnRbZV0ubGVuZ3RoKT4+PjA7blthKytdPXI+PjI0JjI1NSxuW2ErK109cj4+MTYmMjU1LG5bYSsrXT1yPj44JjI1NSxuW2ErK109MjU1JnJ9ZWxzZSBuW2ErK109MTI3JnRbZV0ucHQ7Zm9yKGNvbnN0IGUgb2YgdCluLnNldChlLmRhdGEsYSksYSs9ZS5sZW5ndGg7cmV0dXJuIG59KGUubWFwKCh0PT57bGV0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout((()=>HR.revokeObjectURL(e)),0),new Worker(HR.createObjectURL(e))}const W6=71,jD=1,VD=2,BD=1,z6=2;var Ph=(function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e})(Ph||{});function FD(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const r=e.getUint8(0);if(r!==W6)return;const a=e.getUint16(1),o=jD+VD+a,u=new Uint8Array(e.byteLength-o);u.set(new Uint8Array(e.buffer,o,e.byteLength-o));const h={m:r,tlvLen:a,tlv:[],frame:u};let m=jD+VD;for(;m<o;){const g=e.getUint8(m),y=e.getUint16(m+BD),E=BD+z6;if(g===Ph.AUDIO_LEVEL){let A=e.getUint8(m+E);for(let O=1;O<y;O++)A=A<<8|e.getUint8(m+E+O);h.tlv.push({tag:g,length:y,value:t?127^A>>1:127&A})}else if(g===Ph.METADATA||g===Ph.AUDIO_64_BIT_PTS){const A=new Uint8Array(y);for(let O=0;O<y;O++)A[O]=e.getUint8(m+E+O);h.tlv.push({tag:g,length:y,value:A})}m+=E+y}return h}const zC=new Map,KC=127,Mp=1e-10,GD=139/13,YC=new Map;function HD(e,t,r){const a="".concat(e,"-").concat(t,"-").concat(r);let o=0;return YC.has(a)?o=YC.get(a):(o=Math.log((function(h,m){const g=h-m;m<g&&(m=g);let y=1;for(let E=h,A=1;E>m;E--,A++)y=y*E/A;return y})(t,e))+e*Math.log(.5)+(t-e)*Math.log(1-.5)-Math.log(r)+r*e,YC.set(a,o)),o<Mp&&(o=Mp),o}function K6(e,t,r){const a=t.length,o=e.length/a;let u=!1;for(let h=0,m=0;h<a;h++){let g=0;for(let y=m+o;m<y;m++)e[m]>r&&g++;t[h]!==g&&(t[h]=g,u=!0)}return u}window.cache=YC;let Noe=0;class Y6{constructor(t){ue(this,"id",void 0),ue(this,"immediates",[]),ue(this,"lastNonSilence",-1),ue(this,"immediateSpeechActivityScore",Mp),ue(this,"lastLevelChangedTime",Date.now()),ue(this,"levels",[]),ue(this,"longs",[]),ue(this,"longSpeechActivityScore",Mp),ue(this,"mediums",[]),ue(this,"mediumSpeechActivityScore",Mp),ue(this,"minLevel",0),ue(this,"nextMinLevel",0),ue(this,"nextMinLevelWindowLength",0),ue(this,"energyScore",0),this.id=t||"".concat(Noe++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const t=this.immediates,r=this.levels,a=this.minLevel+GD;let o=!1;for(let u=0;u<t.length;++u){let h=r[u];h<a&&(h=0);const m=Math.floor(h/GD);t[u]!==m&&(t[u]=m,o=!0)}return o}computeLongs(){return K6(this.mediums,this.longs,4)}computeMediums(){return K6(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=HD(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(t){this.longSpeechActivityScore=HD(this.longs[0],10,47),this.longSpeechActivityScore>Mp&&(this.lastNonSilence=t)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=HD(this.mediums[0],5,24)}evaluateSpeechActivityScores(t){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(t)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var t;return"[".concat(Ps(t=[...this.levels]).call(t).join(),"]")}getSpeechActivityScore(t){switch(t){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+t)}}levelChanged(t,r){if(this.lastLevelChangedTime<=r){this.lastLevelChangedTime=r;let a=t;return t<0&&(a=0),t>KC&&(a=KC),this.levels.unshift(a),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(a),a>=this.minLevel+GD?a:a/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(t){if(t!==0){if(this.minLevel===0||this.minLevel>t)return this.minLevel=t,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=t,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>t&&(this.nextMinLevel=t),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let r=Math.sqrt(this.minLevel*this.nextMinLevel);r<0?r=0:r>KC&&(r=KC),this.minLevel=r,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class xoe{constructor(t){ue(this,"algorithm",void 0),this.algorithm=t}execute(){let t=!this.algorithm;if(!t)try{const r=this.algorithm.runInDecisionMaker(this);r<=0?t=!0:setTimeout(this.execute.bind(this),r)}catch{t=!0}t&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class WD{constructor(t,r,a){ue(this,"isDominant",void 0),ue(this,"energyRanking",void 0),ue(this,"energyScore",void 0),this.isDominant=t,this.energyRanking=r,this.energyScore=a}}class Doe extends Mn{constructor(t){super(),ue(this,"dominantId",null),ue(this,"lastDecisionTime",0),ue(this,"lastLevelChangedTime",0),ue(this,"lastLevelIdleTime",0),ue(this,"relativeSpeechActivities",[]),ue(this,"speakers",new Map),ue(this,"enableSilence",!1),ue(this,"timeoutToSilenceInterval",0),ue(this,"decisionMaker",null),ue(this,"loudest",[]),ue(this,"numLoudestToTrack",3),ue(this,"energyExpireTimeMs",250),ue(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=t,this.enableSilence=t>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,r=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=t,r!=null&&(this.energyExpireTimeMs=r),a!=null&&(this.energyAlphaPct=a),this.loudest.length>t&&this.loudest.splice(t)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(t){return this.loudest.some((r=>r.id===t))}levelChanged(t,r){const a=Date.now(),o=this.getOrCreateSpeaker(t);this.lastLevelChangedTime<a&&(this.lastLevelChangedTime=a,this.maybeStartDecisionMaker());const u=o.levelChanged(r,a);return this.updateLoudestList(o,u,a)}runInDecisionMaker(t){return this.decisionMaker!==t||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(t){this.decisionMaker===t&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(t){t.forEach((r=>{this.speakers.has(r.id)||this.speakers.set(r.id,r)}))}removeSpeakers(t){t.forEach((r=>{this.speakers.delete(r.id)}))}getOrCreateSpeaker(t){let r=this.speakers.get(t);return r||(r=new Y6(t),this.speakers.set(t,r),this.maybeStartDecisionMaker()),r}updateLoudestList(t,r,a){const o=t.id===this.dominantId;if(r<0){let g=0;for(;g<this.loudest.length&&this.loudest[g]!==t;)++g;return new WD(o,g,t.energyScore)}if(t.energyScore=Math.floor((this.energyAlphaPct*r+(100-this.energyAlphaPct)*t.energyScore+50)/100),this.numLoudestToTrack===0)return new WD(o,0,t.energyScore);const u=a-this.energyExpireTimeMs;let h=0;for(;h<this.loudest.length;){const g=this.loudest[h];if(g.getLastLevelChangedTime()<u&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(h,1);else if(g.id!==t.id)++h;else if(this.loudest.splice(h,1),this.loudest.length<this.numLoudestToTrack)break}let m=0;for(;m<this.loudest.length&&!(this.loudest[m].energyScore<t.energyScore);)++m;return m<this.numLoudestToTrack&&(this.loudest.splice(m,0,t),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new WD(o,m,t.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new xoe(this),this.decisionMaker.execute())}makeDecision(t){let r=null,a=null;const o=this.speakers.size;let u=null;if(o===0)u=null;else if(o===1){var h;const m=Pi(h=this.speakers).call(h).next().value;this.enableSilence&&m&&(u=m.id,m.evaluateSpeechActivityScores(t),t-m.lastNonSilence>this.timeoutToSilenceInterval&&(u=null))}else{let m=this.dominantId==null?null:this.speakers.get(this.dominantId);if(m==null){const E=this.speakers.entries().next();E.value&&(u=E.value[0],m=E.value[1])}else u=m.id;m?.evaluateSpeechActivityScores(t);const g=this.relativeSpeechActivities;let y=2;for(const E of this.speakers.entries()){const[A,O]=E;if(O===m)continue;O.evaluateSpeechActivityScores(t);for(let V=0;V<g.length;++V){const K=m==null?Mp:m.getSpeechActivityScore(V);g[V]=Math.log(O.getSpeechActivityScore(V)/K)}const N=g[0],B=g[1],U=g[2];N>3&&B>2&&U>0&&B>y&&(y=B,u=A)}this.enableSilence&&m!=null&&u===m.id&&t-m.lastNonSilence>this.timeoutToSilenceInterval&&(u=null)}u==null&&!this.enableSilence||u===this.dominantId||(r=this.dominantId,this.dominantId=u,a=this.dominantId),a==null&&!this.enableSilence||a===r||this.emit("ActiveSpeakerChanged",a)}_runInDecisionMaker(){const t=Date.now(),r=300-(t-this.lastLevelIdleTime);let a=0;r<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(t),this.lastLevelIdleTime=t):a=r;let o=300-(t-this.lastDecisionTime);return o<=0&&(this.lastDecisionTime=t,this.makeDecision(t),o=300-(Date.now()-t)),o>0&&a>o&&(a=o),a}timeoutIdleLevels(t){const r=[];for(const o of Pi(a=this.speakers).call(a)){var a;const u=t-o.getLastLevelChangedTime();36e5<u&&(this.dominantId==null||o.id!==this.dominantId)?r.push(o.id):300<u&&o.levelTimedOut()}r.forEach((o=>this.speakers.delete(o)))}}const q_=new Map;let Bc=null,qC=null;const q6=3;let Up=[];const Fc=new Map,XC=new Map;class Poe{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(t,r){ue(this,"id",void 0),ue(this,"track",void 0),ue(this,"score",0),ue(this,"active",!0),ue(this,"muted",!1),ue(this,"timer",0),ue(this,"actives",0),ue(this,"inactives",0),this.id=t,this.track=r,this.setActive(Fc.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const t=this.active;this.active=this.activeRate>=.8;const{actives:r,inactives:a}=(function(){const o=[],u=[];return Array.from(Pi(Fc).call(Fc)).forEach((h=>{h.active?o.push(h):u.push(h)})),{actives:o,inactives:u}})();if(r.length>3){let o;r.forEach((u=>{(!o||o.score>u.score)&&(o=u)})),o&&o.setActive(!1)}if(r.length<3&&a.length>0){let o;a.forEach((u=>{(!o||o.score<u.score)&&u.id!==this.id&&(o=u)})),o&&t&&!this.active&&(o.samples>40&&o.activeRate-this.activeRate>.4?o.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(t){this.active=t,this.resetTimer(),this.setMuted(!t)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const t=(function(r){let a;return Array.from(Pi(Fc).call(Fc)).forEach((o=>{!o.active||o.id===r||o.samples<40||(!a||o.score<a.score)&&(a=o)})),a})(this.id);t&&this.activeRate-t.activeRate>.4&&(t.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const t=(function(r){let a;return Array.from(Pi(Fc).call(Fc)).forEach((o=>{o.active||o.id===r||o.samples<40||(!a||o.score>a.score)&&(a=o)})),a})(this.id);t&&t.activeRate-this.activeRate>.4&&(t.setActive(!0),this.setActive(!1))}addSample(t){t?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(t){this.track&&(this.track.enabled=!t,this.muted=t)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout((()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()}),1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let JC;function X6(e){const t=Fc.get(e);t&&(Fc.delete(e),t.clearTimer())}const $C=new Map,koe=new Map,zD="video/h264",KD="video/h265";function J6(e,t,r){let a=new Uint8Array(e,t,r),o=[],u=0;for(;o.length<r;)u+3<r&&a[u]===0&&a[u+1]===0&&a[u+2]===3&&(a[u+3]===0||a[u+3]===1||a[u+3]===2||a[u+3]===3)?(o.push(a[u],a[u+1],a[u+3]),u+=4):(o.push(a[u]),u++);return new Uint8Array(o)}function $6(e){const t=e.length;let r=[],a=0;for(;a<t;)a+2<t&&e[a]===0&&e[a+1]===0&&(e[a+2]===0||e[a+2]===1||e[a+2]===2||e[a+2]===3)?(r.push(e[a],e[a+1],3,e[a+2]),a+=3):(r.push(e[a]),a++);return new Uint8Array(r)}function Z6(e){if(e.length<5)return"";let t=-1;for(let o=0;o<e.length-3;o++){if(e[o]===0&&e[o+1]===0&&e[o+2]===1){t=o;break}if(o<e.length-4&&e[o]===0&&e[o+1]===0&&e[o+2]===0&&e[o+3]===1){t=o;break}}if(t===-1)return"";const r=t+(e[t+2]===0?4:3);if(r>=e.length)return"";const a=e[r];return 128&a?"":(a>>1&63)>=32||r+1<e.length&&(248&e[r+1])==0?KD:(31&a)<=31?zD:""}const ZC=new Map,Z0=new Map;(function(){const e=Lt();Wr.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Wr.getStreamFromExtension=e.name===Gt.CHROME&&Number(e.version)>34,Wr.supportUnifiedPlan=(function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let r=!1;try{t.addTransceiver("audio"),r=!0}catch{}return t.close(),r})(),Wr.supportMinBitrate=e.name===Gt.CHROME||e.name===Gt.EDGE,Wr.supportSetRtpSenderParameters=(function(){const t=Lt();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!ju()||!(!Zr()&&!AC())||t.name===Gt.FIREFOX&&Number(t.version)>=64)})(),e.name===Gt.SAFARI&&(Number(e.version)>=14?Wr.supportDualStream=!0:Wr.supportDualStream=!1),Wr.webAudioMediaStreamDest=(function(){const t=Lt();return!(t.name===Gt.SAFARI&&Number(t.version)<12)})(),Wr.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Wr.supportWebGL=typeof WebGLRenderingContext<"u",Wr.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,ju()||(Wr.webAudioWithAEC=!0),Wr.supportShareAudio=(function(){const t=Lt();return(t.os===Cr.WIN_10||t.os===Cr.WIN_81||t.os===Cr.WIN_7||t.os===Cr.LINUX||t.os===Cr.MAC_OS||t.os===Cr.CHROMIUM_OS)&&t.name===Gt.CHROME&&Number(t.version)>=74})(),Wr.supportDataChannel=!!(N_(76)||$1(68)||$B(14)),Wr.supportPCSetConfiguration=(function(){const t=window.RTCPeerConnection;return!Vn()&&!!t&&t.prototype.setConfiguration instanceof Function})(),Wr.supportWebRTCEncodedTransform=N_(87)||qB()||$1(117),Wr.supportWebRTCInsertableStream=(function(){const t=Lt();return(t.name===Gt.CHROME||t.name===Gt.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window})(),Wr.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Wr.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,NC((()=>{Wr.supportDualStreamEncoding=(function(){const t=Lt();return!!X("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&X("CHROME_DUAL_STREAM_USE_ENCODING"))})(),k.debug("browser ua: ",navigator.userAgent),k.info("browser info: ",e),k.info("browser compatibility: ",Wr)}))})();const Loe=["CHINA","GLOBAL"],Q6=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],jp=[],X_=[];function Vp(e,t){return!!t&&jp.some((r=>r.uid===e&&r.channelName===t))}function YD(){return X_.length>0}var Moe=f4.forEach,e8=Ud("forEach")?[].forEach:function(e){return Moe(this,e,arguments.length>1?arguments[1]:void 0)};Jt({target:"Array",proto:!0,forced:[].forEach!==e8},{forEach:e8});var Uoe=ia("Array","forEach"),joe=ac,Voe=jr,Boe=D,Foe=Uoe,qD=Array.prototype,Goe={DOMTokenList:!0,NodeList:!0},Hoe=function(e){var t=e.forEach;return e===qD||Boe(qD,e)&&t===qD.forEach||Voe(Goe,joe(e))?Foe:t},Woe=f(Hoe),zoe=ya,t8=mu;Jt({target:"Object",stat:!0,forced:p((function(){t8(1)}))},{keys:function(e){return t8(zoe(e))}});var Koe=f(ra.Object.keys),Yoe=f(kf),qoe=f(sc),Xoe=Jt,n8=Vd,Joe=wr,$oe=Ur,r8=Ym,Zoe=Ua,Qoe=gr,ece=Dx,tce=qn,nce=zi,rce=r4("slice"),ice=tce("species"),XD=Array,ace=Math.max;Xoe({target:"Array",proto:!0,forced:!rce},{slice:function(e,t){var r,a,o,u=Qoe(this),h=Zoe(u),m=r8(e,h),g=r8(t===void 0?h:t,h);if(n8(u)&&(r=u.constructor,(Joe(r)&&(r===XD||n8(r.prototype))||$oe(r)&&(r=r[ice])===null)&&(r=void 0),r===XD||r===void 0))return nce(u,m,g);for(a=new(r===void 0?XD:r)(ace(g-m,0)),o=0;m<g;m++,o++)m in u&&ece(a,o,u[m]);return a.length=o,a}});var sce=ia("Array","slice"),oce=D,cce=sce,JD=Array.prototype,lce=function(e){var t=e.slice;return e===JD||oce(JD,e)&&t===JD.slice?cce:t},uce=f(lce);function Qe(e,t,r,a,o){var u,h,m,g={};return Woe(u=Koe(a)).call(u,(function(y){g[y]=a[y]})),g.enumerable=!!g.enumerable,g.configurable=!!g.configurable,("value"in g||g.initializer)&&(g.writable=!0),g=Yoe(h=qoe(m=uce(r).call(r)).call(m)).call(h,(function(y,E){return E(e,t,y)||y}),g),o&&g.initializer!==void 0&&(g.value=g.initializer?g.initializer.call(o):void 0,g.initializer=void 0),g.initializer===void 0?(Q3(e,t,g),null):g}let QC=(function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e})({}),$D=(function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e})({}),Oo=(function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e})({}),Xi=(function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e})({}),ot=(function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e})({}),yn=(function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e})({}),pt=(function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e})({}),ht=(function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e.DOWNGRADE_CODEC="downgrade_codec",e})({}),Q0=(function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e})({}),Dt=(function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e})({}),Ji=(function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e})({}),yt=(function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e})({});function eA(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw k.error("Invalid Channel Name ".concat(e)),new fe(q.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function tA(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||a5(e,1,255)))throw new fe(q.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&k.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Bu=(function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e})({});const dce={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},ZD={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function QD(e,t){Gr(e.url,"".concat(t,".url"),1,1e3,!1),Bn(e.x)||ln(e.x,"".concat(t,".x"),0,1e4),Bn(e.y)||ln(e.y,"".concat(t,".y"),0,1e4),Bn(e.width)||ln(e.width,"".concat(t,".width"),0,1e4),Bn(e.height)||ln(e.height,"".concat(t,".height"),0,1e4),Bn(e.zOrder)||ln(e.zOrder,"".concat(t,".zOrder"),0,255),Bn(e.alpha)||ln(e.alpha,"".concat(t,".alpha"),0,1,!1)}const hce={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let kh=(function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e})({}),eP=(function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e})({}),hr=(function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e})({});function i8(e){if(!e.channelName)throw new fe(q.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new fe(q.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&Gr(e.token,"info.token",1,2047),tA(e.uid),eA(e.channelName),!0}let $i=(function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e})({}),Fu=(function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e})({}),Oa=(function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e})({}),J_=(function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e})({}),Qt=(function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e})({}),Dr=(function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e})({}),nA=(function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e})({}),Ar=(function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e})({}),Kt=(function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e})({});const a8=[Kt.AFRICA,Kt.ASIA,Kt.CHINA,Kt.EUROPE,Kt.GLOBAL,Kt.INDIA,Kt.JAPAN,Kt.NORTH_AMERICA,Kt.OCEANIA,Kt.OVERSEA,Kt.SOUTH_AMERICA];let li=(function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e})({});const rA={CHINA:{},ASIA:{CODE:li.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:li.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:li.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:li.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:li.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:li.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:li.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:li.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:li.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:li.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:li.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:li.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:li.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};_D&&(rA.CHINA={CODE:li.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let eS=(function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e})({});function s8(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class o8 extends Mn{constructor(t,r){super(),H(this,"onICEConnectionStateChange",void 0),H(this,"onConnectionStateChange",void 0),H(this,"onDTLSTransportStateChange",void 0),H(this,"onDTLSTransportError",void 0),H(this,"onICETransportStateChange",void 0),H(this,"onFirstAudioReceived",void 0),H(this,"onFirstVideoReceived",void 0),H(this,"onFirstAudioDecoded",void 0),H(this,"onFirstVideoDecoded",void 0),H(this,"onFirstVideoRender",void 0),H(this,"onFirstVideoDecodedTimeout",void 0),H(this,"onSelectedLocalCandidateChanged",void 0),H(this,"onSelectedRemoteCandidateChanged",void 0),H(this,"onICECandidateError",void 0),H(this,"getLocalVideoStats",void 0)}}class c8 extends o8{constructor(t,r){super(t,r),H(this,"establishPromise",void 0)}}let Xe=(function(e){return e.VIDEO="video",e.AUDIO="audio",e})({}),ui=(function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e})({}),Gu=(function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e})({});const l8=["disconnected","failed"];let Ie=(function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e})({}),Zt=(function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e})({}),at=(function(e){return e.AudioMetadata="audioMetadata",e.AudioPts="audioPts",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e})({}),Io=(function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e})({}),No=(function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e})({}),Pr=(function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e})({}),u8=(function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e})({}),Ll=(function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e})({}),zs=(function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e})({}),Gc=(function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e})({}),$_=(function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e})({}),er=(function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e})({}),Z_=(function(e){return e.ABORT="abort",e})({}),Lh=(function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e})({}),fce=(function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e})({});const pce={[QC.ACCESS_POINT]:{[Xi.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Xi.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Xi.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Xi.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Xi.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Xi.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Xi.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Xi.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Xi.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Xi.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Xi.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Xi.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Xi.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Xi.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Xi.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Xi.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Xi.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Xi.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[QC.UNILBS]:{[Oo.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Oo.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Oo.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Oo.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Oo.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Oo.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Oo.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Oo.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Oo.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Oo.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Oo.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Oo.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[QC.STRING_UID_ALLOCATOR]:{[$D.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[$D.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[$D.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Q_(e){const t=pce[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};const r=t[e%1e4];if(!r){if(Math.floor(e/1e4)===QC.ACCESS_POINT){const a=e%1e4;if(a.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(a.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return r}const mce={[ot.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[ot.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[ot.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[ot.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[ot.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[ot.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[ot.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[ot.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[ot.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[ot.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[ot.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[ot.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[ot.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[ot.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[ot.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[ot.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[ot.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[ot.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[ot.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[ot.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[ot.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[ot.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[ot.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[ot.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[ot.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[ot.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[ot.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[ot.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[ot.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[ot.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[ot.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[ot.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[ot.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[ot.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[ot.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[ot.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[ot.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[ot.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[ot.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[ot.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[ot.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[ot.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[ot.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[ot.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[ot.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[ot.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[ot.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[ot.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[ot.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[ot.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[ot.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[ot.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[ot.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[ot.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[ot.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[ot.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[ot.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[ot.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[ot.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[ot.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[ot.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[ot.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[ot.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[ot.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function tS(e){return mce[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function d8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),r.push.apply(r,a)}return r}function tP(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?d8(Object(r),!0).forEach((function(a){H(e,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d8(Object(r)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))}))}return e}function nP(e,t){if(typeof e=="string")return e;const{proxy:r,host:a,port:o}=e;if(t){const u=X("JOIN_GATEWAY_FALLBACK_PORT")||443;return u===443?"wss://".concat(a,"/ws/?p=").concat(Number(o)+150):"wss://".concat(a,":").concat(u,"/ws/?p=").concat(Number(o)+150)}return r?"wss://".concat(r,"/ws/?h=").concat(a,"&p=").concat(o):"wss://".concat(a,":").concat(o)}const gce=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,_ce=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,vce=/wss:\/\/(.+):([0-9]+)\/?/,yce=/wss:\/\/(.[^\/]+)\/?/;let Ece=0;class Sce{constructor(t,r){H(this,"id",0),H(this,"store",void 0),H(this,"recordIndex",void 0),H(this,"websockets",[]),H(this,"try443PortDuration",2e3),H(this,"forceCloseWSDuration",5e3),H(this,"try443PortTimeout",null),H(this,"forceCloseTimeout",null),H(this,"isTry443PortFailed",!1),H(this,"isNormalPortFailed",!1),H(this,"useDoubleDomain",!1),H(this,"useProxy",!1),H(this,"startTime",Date.now()),this.id=++Ece,this.try443PortDuration=X("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=r}closeAllWebsockets(){this.websockets.forEach((t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()})),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var t;const r=Date.now()-this.startTime;for(var a=arguments.length,o=new Array(a),u=0;u<a;u++)o[u]=arguments[u];k.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(r,"ms:"),...o)}createWebSocket(t,r,a){this.logger("createWebSocket:",t,{isTry443Port:r,hasTimeoutDetection:a});const o=X("GATEWAY_DOMAINS"),u=Date.now(),h=[],m=o.find((O=>{var N;return je(N=t.host).call(N,O)}));m||(this.useDoubleDomain=!1);const g=[];if(this.useDoubleDomain)o.forEach((O=>{g.push(nP(tP(tP({},t),{},{host:t.host.replace(m,O)}),r))}));else{const O=tP({},t);if(r&&m){const N=o.find((B=>B!==m));N&&(O.host=O.host.replace(m,N))}g.push(nP(O,r))}try{g.forEach((O=>{const N=new WebSocket(O);N.binaryType="arraybuffer",h.push(N),this.logger("ws is connecting:",N.url)}))}catch(O){if(this.logger("ws create failed"),h.forEach((N=>N.close())),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,r,a);if(!r&&Number(t.port)!==443)return this.createWebSocket(t,!0,a);throw new fe(q.WS_ERR,"init websocket failed! Error: ".concat(O.toString()))}const y=V0();this.store&&this.store.recordJoinChannelService({urls:h.map((O=>O.url)),service:"gateway"},this.recordIndex),h.forEach((O=>{O.onopen=()=>{this.logger("onopen: ws ".concat(O.url," open cost ").concat(Date.now()-u,"ms")),this.websockets.forEach((N=>{N!==O&&(N.onopen=null,N.onclose=null,N.onmessage=null,N.close(),this.logger("close backup websocket: ".concat(N.url)))})),this.websockets.length=0,y.resolve(O)},O.onclose=N=>{this.logger("onclose: ws ".concat(O.url," closed cost ").concat(Date.now()-u,"ms state: ").concat(O.readyState));const B=h.every((U=>U.readyState===WebSocket.CLOSED||U.readyState===WebSocket.CLOSING));this.logger("".concat(r?"443":"47xx"," websocket closed, all failed: ").concat(B)),B&&(r||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(N.reason)),y.reject({code:N.code,reason:nA.A_ROUND_WS_FAILED})):!r&&B&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),A()),r?this.isTry443PortFailed=B:this.isNormalPortFailed=B},O.onmessage=N=>this.logger("".concat(O.url," onmessage: ").concat(N.data))})),this.websockets.push(...h);const E=()=>{this.websockets.forEach((O=>O.readyState!==WebSocket.OPEN&&O.close()))},A=()=>{if(y.isResolved)return E();Lt().os===Cr.MAC_OS&&Vn()&&E(),this.createWebSocket(t,!0,!0).then((O=>{y.resolve(O)})).catch((O=>{this.isNormalPortFailed&&y.reject(O),this.logger("try 443 port to create ws failed")})),this.forceCloseTimeout=window.setTimeout((()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",y.isResolved),this.forceCloseTimeout=null,E()}),this.forceCloseWSDuration)};return a||(()=>{if(r||this.useProxy)return this.logger("add 5s timeout at ".concat(r?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout((()=>{this.forceCloseTimeout=null,E()}),this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout((()=>{this.logger("2s timeout, isWebsocket created: ",y.isResolved),this.try443PortTimeout=null,A()}),this.try443PortDuration)})(),y.promise}chooseBestWebsocket(t,r,a,o){return this.useDoubleDomain=!!r,typeof t=="string"&&(t=(function(u){let h,m,g;return[,h,m,g]=u.match(gce)||[],h||([,m,g]=u.match(_ce)||[]),m&&g||([,m,g]=u.match(vce)||[]),m&&g||([,m]=u.match(yce)||[]),m||k.warning("un-destructible url: ",u),{proxy:h,host:m,port:g||"443"}})(t)),this.recordIndex=o,this.useProxy=!!t.proxy,a&&this.useProxy&&(k.warn("cannot use 443 only when use proxy"),a=!1),this.createWebSocket(t,!!a,!1).finally((()=>this.clearTimeout()))}}function h8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),r.push.apply(r,a)}return r}class f8 extends Mn{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var r;je(r=["tryNext","recover"]).call(r,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(yt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(yt.CONNECTED):this._state==="closed"?this.emit(yt.CLOSED):this._state==="failed"&&this.emit(yt.FAILED))}resetReconnectCount(t){k.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,r){let a=arguments.length>2&&arguments[2]!==void 0&&arguments[2],o=arguments.length>3&&arguments[3]!==void 0&&arguments[3],u=arguments.length>4&&arguments[4]!==void 0&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),H(this,"_websocketUrl",null),H(this,"connectionID",0),H(this,"currentURLIndex",0),H(this,"urls",[]),H(this,"_reconnectMode","tryNext"),H(this,"reconnectReason",void 0),H(this,"_initMutex",void 0),H(this,"name",void 0),H(this,"_state","closed"),H(this,"reconnectInterrupter",void 0),H(this,"websocket",void 0),H(this,"retryConfig",void 0),H(this,"reconnectCount",0),H(this,"forceCloseTimeout",5e3),H(this,"onlineReconnectListener",void 0),H(this,"useCompress",void 0),H(this,"tryDoubleDomain",!1),H(this,"use443PortOnly",!1),H(this,"wsInflateLength",0),H(this,"wsDeflateLength",0),H(this,"closeEstablishingWs",(()=>{})),H(this,"store",void 0),H(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=t,this.retryConfig=(function(A){for(var O=1;O<arguments.length;O++){var N=arguments[O]!=null?arguments[O]:{};O%2?h8(Object(N),!0).forEach((function(B){H(A,B,N[B])})):Object.getOwnPropertyDescriptors?Object.defineProperties(A,Object.getOwnPropertyDescriptors(N)):h8(Object(N)).forEach((function(B){Object.defineProperty(A,B,Object.getOwnPropertyDescriptor(N,B))}))}return A})({},r),this.useCompress=a,this.tryDoubleDomain=o,this.use443PortOnly=u,this._initMutex=new oi("websocket",h?h.clientId:void 0);const{timeout:m,timeoutFactor:g}=r,y=Math.max(300,Math.floor(3*m/5)),E=Math.max(1.2,Math.floor(8*g)/10);Xa.ONLINE&&(this.retryConfig.timeout=y,this.retryConfig.timeoutFactor=E),nr.on(D_.NETWORK_STATE_CHANGE,((A,O)=>{A!==O&&(this.resetReconnectCount("network state change: ".concat(O," -> ").concat(A)),A===Xa.ONLINE?(this.retryConfig.timeout=y,this.retryConfig.timeoutFactor=E):(this.retryConfig.timeout=m,this.retryConfig.timeoutFactor=g))}))}getConnection(){return this.websocket||void 0}async init(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const a=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=r,this.urls=t,this.state="connecting";try{var o;const u=V0(),h=this.urls[this.currentURLIndex];(o=this.store)===null||o===void 0||o.beforeConnect(),(function(m){return!(UC()||X("USE_NEW_TOKEN")||!X("ENABLE_PREALLOC_PC")&&(m==null||!m.autoSubscribe||X("FORCE_DISABLE_AUTO_SUB")))})(this.store)&&this.emit(u8.PRE_CONNECT_PC),this.createWebSocketConnection(h).then(u.resolve).catch(u.reject),this.once(yt.CLOSED,(()=>{u.reject(new ve(q.WS_DISCONNECT))})),this.once(yt.CONNECTED,u.resolve),await u.promise}catch{}finally{a()}}close(t,r){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const a=this.websocket;r?setTimeout((()=>a.close()),500):a.close(),this.websocket=void 0,this._websocketUrl=null}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,r){if(!this.websocket)return void k.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),k.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(r)]},this.joinGatewayRecordIndex);const a=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),a&&a.bind(this.websocket)({code:9999,reason:r})}sendMessage(t){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new ve(q.WS_ABORT,"websocket is not ready");try{r||(t=JSON.stringify(t)),this.websocket.send(t)}catch(a){throw new ve(q.WS_ERR,"send websocket message error"+a.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,r=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:r}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var r;const a=V0();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const o=E=>{var A;(A=this.store)===null||A===void 0||A.signalChannelOpen(),k.debug("[".concat(this.name,"] websocket opened:"),E),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),a.resolve()},u=async E=>{var A;if(k.debug("[".concat(this.name,"] websocket close ").concat((A=this.websocket)===null||A===void 0?void 0:A.url,", code: ").concat(E.code,", reason: ").concat(E.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)a.reject(new ve(q.WS_DISCONNECT,"websocket close: ".concat(E.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=E.reason,this.state="reconnecting");const O=_s(this,yt.WILL_RECONNECT,this.reconnectMode,E.reason)||this.reconnectMode,N=await this.reconnectWithAction(O);if(this.state==="closed")return void k.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!N)return a.reject(new ve(q.WS_DISCONNECT,"websocket reconnect failed: ".concat(E.code))),this.close(!0);a.resolve()}},h=E=>{this.emit(yt.ON_MESSAGE,E)},m=E=>{k.warn("[".concat(this.connectionID,"] ws open error ").concat(E))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),X("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=X("GATEWAY_WSS_ADDRESS")),k.debug("[".concat(this.name,"] start connect, url:"),t);const g=(r=this.store)===null||r===void 0?void 0:r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var y;this._websocketUrl=nP(t);const E=await this.chooseBestWebsocketConnection(t);this.websocket=E,o&&o(this.websocket.url),this.websocket.onclose=u,this.websocket.onmessage=h,this.websocket.onerror=m,(y=this.store)===null||y===void 0||y.recordJoinChannelService({endTs:Date.now(),status:"success"},g),this.joinGatewayRecordIndex=g}catch(E){const A=this.state==="closed",O=E instanceof ve,N=O&&E.code===q.WS_ABORT,B=O&&E.code===q.WS_ERR,U=O?E.message:E&&(E.reason||E.toString());k.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(U)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:N?"aborted":"error",errors:[E]},g),A||B?(a.reject(A?new ve(q.WS_DISCONNECT,"websocket is closed: ".concat(U)):new ve(q.WS_ERR,"init websocket failed: ".concat(U))),B&&k.error("[".concat(this.name,"] init websocket failed: ").concat(U))):u&&u(E)}return a.promise}async reconnectWithAction(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;k.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||nr.isOnline||!nr.onlineWaiter||(this.onlineReconnectListener=nr.onlineWaiter.then((()=>{this.onlineReconnectListener=void 0})));let a=!0;if(this.reconnectInterrupter=()=>a=!1,r){const h=lD(this.reconnectCount,this.retryConfig);k.debug("[".concat(this.name,"] wait ").concat(h,"ms to reconnect websocket, mode: ").concat(t)),await Fe.race([Hr(h),this.onlineReconnectListener||new Fe((()=>{}))])}if(this._state==="closed"||!a)return!1;this.reconnectCount+=1;const o=async(h,m)=>{this.emit(yt.RECONNECT_CREATE_CONNECTION,m),await this.createWebSocketConnection(h)};try{if(t==="retry")await o(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);k.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await o(this.urls[this.currentURLIndex],t)}else t==="recover"&&(k.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await ei(this,yt.REQUEST_NEW_URLS),this.currentURLIndex=0,await o(this.urls[this.currentURLIndex],t))}catch(h){var u;k.error("[".concat(this.name,"] reconnect failed ").concat(h&&h.toString()));const m=h==null||(u=h.data)===null||u===void 0?void 0:u.desc;return Array.isArray(m)&&je(m).call(m,"dynamic key expired")?(this.emit(yt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(t,r)}return!0}}class rP extends f8{constructor(t,r){super(t,r,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,r){const a=V0(),o=(function(h,m){return new Sce(h,m)})(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{k.debug("[choose-best-ws] close establishing websockets"),o.closeAllWebsockets(),a.reject(new ve(q.WS_ABORT,"choose best websocket aborted"))};const u=X("GATEWAY_DOMAINS");return k.debug("[choose-best-ws] currentDomain: ",t,", domains: ",u,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),o.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,r).then(a.resolve).catch(a.reject),a.promise.finally((()=>{this.closeEstablishingWs=void 0}))}}class nS extends f8{constructor(t,r){super(t,r,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,r){return new Fe(((a,o)=>{let u=!1;const h=[];this.closeEstablishingWs=()=>{k.debug("[choose-best-ws] close establishing websockets"),h.forEach((B=>{B.onclose=null,B.onopen=null,B.onmessage=null,B.close()})),o(new ve(q.WS_ABORT,"choose best websocket aborted"))};const m=X("GATEWAY_DOMAINS");let g;const y=t.indexOf("?h="),E=m.find((B=>y!==-1?je(t).call(t,B,y):je(t).call(t,B)));k.debug("[choose-best-ws] currentDomain: ",E,", domains: ",m);let A=!this.tryDoubleDomain||!E;if(!A&&E){var O;const B=Date.now();try{m.forEach((U=>{const V=y===-1?t.replace(E,U):t.substr(0,y)+t.substr(y).replace(E,U),K=new WebSocket(V);K.binaryType="arraybuffer",h.push(K),k.debug("[choose-best-ws] ws is connecting:",K.url)}))}catch{for(k.debug("[choose-best-ws] ws create failed, fallback to single url"),h.forEach((V=>V.close()));h.length;)h.pop();A=!0}(O=this.store)===null||O===void 0||O.recordJoinChannelService({urls:h.map((U=>U.url)),service:"gateway"},r),h.forEach((U=>{U.onopen=()=>{if(u)return;const V=Date.now()-B;k.debug("[choose-best-ws] ws open cost ".concat(V,"ms")),h.filter((K=>K!==U)).forEach((K=>{k.debug("[choose-best-ws]close backup websocket: ".concat(K.url)),K.close()})),u=!0,a(U)},U.onclose=V=>{g=V,!u&&(h.find((K=>!(K.readyState===WebSocket.CLOSED||K.readyState===WebSocket.CLOSING)))||(k.debug("[choose-best-ws] all websocket is closed"),u=!0,o(g)))},U.onmessage=V=>{k.debug("[choose-best-ws]".concat(U.url," onmessage: ").concat(V.data))}})),Hr(this.forceCloseTimeout).then((()=>{h.forEach((U=>{U.readyState!==WebSocket.OPEN&&U.close()}))}))}if(A){var N;let B;k.debug("[choose-best-ws] use single url: ",t),(N=this.store)===null||N===void 0||N.recordJoinChannelService({urls:[t],service:"gateway"},r);try{B=new WebSocket(t),h.push(B),B.binaryType="arraybuffer"}catch(U){const V=new ve(q.WS_ERR,"init websocket failed! Error: ".concat(U.toString()));return k.error("[".concat(this.name,"]").concat(V)),void o(V)}B.onopen=()=>{a(B)},B.onclose=U=>{o(U)},B.onmessage=U=>{k.debug("[choose-best-ws]".concat(B.url," onmessage: ").concat(U.data))},Hr(this.forceCloseTimeout).then((()=>{B&&B.readyState!==WebSocket.OPEN&&B.close()}))}})).then((a=>(this.closeEstablishingWs=void 0,a))).catch((a=>{throw this.closeEstablishingWs=void 0,a}))}}class bce extends Mn{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===yn.CONNECTED?this.emit(pt.WS_CONNECTED):t===yn.RECONNECTING?this.emit(pt.WS_RECONNECTING,this._websocketReconnectReason):t===yn.CLOSED&&this.emit(pt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,r){super(),H(this,"_disconnectedReason",void 0),H(this,"_websocketReconnectReason",void 0),H(this,"_connectionState",yn.CLOSED),H(this,"reconnectToken",void 0),H(this,"websocket",void 0),H(this,"openConnectionTime",void 0),H(this,"clientId",void 0),H(this,"lastMsgTime",Date.now()),H(this,"uploadCache",[]),H(this,"uploadCacheInterval",void 0),H(this,"rttRolling",new S5(5)),H(this,"pingpongTimer",void 0),H(this,"wsInflateDataTimer",void 0),H(this,"pingpongTimeoutCount",0),H(this,"ortc",void 0),H(this,"joinResponse",void 0),H(this,"multiIpOption",void 0),H(this,"initError",void 0),H(this,"spec",void 0),H(this,"store",void 0),H(this,"onWebsocketMessage",(a=>{if(a.data instanceof ArrayBuffer)return void this.emit(pt.ON_BINARY_DATA,a.data);const o=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(o,"_id")){const u="res-@".concat(o._id);this.emit(u,o._result,o._message)}else if(Object.prototype.hasOwnProperty.call(o,"_type")){if(this.emit(o._type,o._message),o._type===Dt.ON_NOTIFICATION&&this.handleNotification(o._message),o._type===Dt.ON_USER_BANNED)switch(o._message.error_code){case 14:this.close($t.UID_BANNED);break;case 15:this.close($t.IP_BANNED);break;case 16:this.close($t.CHANNEL_BANNED)}if(o._type===Dt.ON_USER_LICENSE_BANNED)switch(o._message.error_code){case ot.ERR_LICENSE_MISSING:this.close($t.LICENSE_MISSING);break;case ot.ERR_LICENSE_EXPIRED:this.close($t.LICENSE_EXPIRED);break;case ot.ERR_LICENSE_MINUTES_EXCEEDED:this.close($t.LICENSE_MINUTES_EXCEEDED);break;case ot.ERR_LICENSE_PERIOD_INVALID:this.close($t.LICENSE_PERIOD_INVALID);break;case ot.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close($t.LICENSE_MULTIPLE_SDK_SERVICE);break;case ot.ERR_LICENSE_ILLEGAL:this.close($t.LICENSE_ILLEGAL);break;default:this.close()}}})),this.clientId=t.clientId,this.spec=t,this.store=r,this.websocket=new rP("gateway-".concat(this.clientId),this.spec.retryConfig,!0,X("JOIN_GATEWAY_USE_DUAL_DOMAIN"),X("JOIN_GATEWAY_USE_443PORT_ONLY"),r),this.handleWebsocketEvents(),window.addEventListener("offline",(()=>{this.connectionState===yn.CONNECTED&&this.reconnect("retry",Qr.OFFLINE)}))}async request(t,r,a,o){const u=fn(6,""),h={_id:u,_type:t,_message:r},m=this.websocket.connectionID,g=()=>new Fe(((B,U)=>{if(this.connectionState===yn.CONNECTED)return B();const V=()=>{this.off(pt.WS_CLOSED,K),B()},K=()=>{this.off(pt.WS_CONNECTED,V),U(new fe(q.WS_ABORT))};this.once(pt.WS_CONNECTED,V),this.once(pt.WS_CLOSED,K),t!==ht.PUBLISH&&t!==ht.PUBLISH_DATASTREAM&&t!==ht.SUBSCRIBE&&t!==ht.SUBSCRIBE_DATASTREAM&&t!==ht.UNSUBSCRIBE&&t!==ht.UNSUBSCRIBE_DATASTREAM&&t!==ht.UNPUBLISH&&t!==ht.UNPUBLISH_DATASTREAM&&t!==ht.CONTROL&&t!==ht.RESTART_ICE||this.once(pt.DISCONNECT_P2P,(()=>{U(new fe(q.DISCONNECT_P2P))})),t!==ht.PUBLISH&&t!==ht.RESTART_ICE||this.once(pt.ABORT_P2P_EXECUTION,(()=>{U(new fe(q.DISCONNECT_P2P))}))}));if(this.connectionState!==yn.CONNECTING&&this.connectionState!==yn.RECONNECTING||t===ht.JOIN||t===ht.REJOIN||await g(),this.websocket.sendMessage(h,!0),o)return;const y=new Fe(((B,U)=>{let V=!1;const K=(J,ae)=>{V=!0,B({isSuccess:J==="success",message:ae||{}}),this.off(pt.WS_CLOSED,z),this.off(pt.WS_RECONNECTING,z),this.emit(pt.REQUEST_SUCCESS,t,r)};this.once("res-@".concat(u),K);const z=()=>{U(new fe(q.WS_ABORT,"type: ".concat(t))),this.off(pt.WS_CLOSED,z),this.off(pt.WS_RECONNECTING,z),this.off("res-@".concat(u),K)};this.once(pt.WS_CLOSED,z),this.once(pt.WS_RECONNECTING,z),Hr(X("SIGNAL_REQUEST_TIMEOUT")).then((()=>{this.websocket.connectionID!==m||V||(k.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(pt.REQUEST_TIMEOUT,t,r))}))}));let E=null;try{E=await y}catch(B){if(this.connectionState===yn.CLOSED||t===ht.LEAVE)throw new fe(q.WS_ABORT);return!this.spec.forceWaitGatewayResponse||a?B.throw():t===ht.JOIN||t===ht.REJOIN?null:(await g(),await this.request(t,r))}if(E.isSuccess)return E.message;const A=Number(E.message.error_code||E.message.code),O=tS(A),N=new fe(q.UNEXPECTED_RESPONSE,"".concat(O.desc,": ").concat(E.message.error_str),{code:A,data:E.message,desc:O.desc});return O.action==="success"?E.message:(k.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(A,", message: ").concat(O.desc,", action: ").concat(O.action)),A===ot.ERR_TOO_MANY_BROADCASTERS?((t===ht.JOIN||t===ht.REJOIN)&&(this.initError=N,this.close()),N.throw()):O.action==="failed"?N.throw():O.action==="quit"?(this.initError=N,this.close(),N.throw()):(A===ot.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=E.message.option,k.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Qr.MULTI_IP)):this.reconnect(O.action,Qr.SERVER_ERROR),t===ht.JOIN||t===ht.REJOIN?null:await this.request(t,r)))}waitMessage(t,r){return new Fe((a=>{const o=u=>{(!r||r(u))&&(this.off(t,o),a(u))};this.on(t,o)}))}uploadWRTCStats(t){if(!this.store.sessionId)return void k.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const r={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Q0.WRTC_STATS,r)}upload(t,r){const a={_type:t,_message:r};try{this.websocket.sendMessage(a)}catch{const u=X("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((()=>{if(this.connectionState!==yn.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)}),X("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,r){const a={_type:t,_message:r};this.websocket.sendMessage(a)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Fe(((r,a)=>{this.once(pt.WS_CONNECTED,(()=>r(this.joinResponse))),this.once(pt.WS_CLOSED,(o=>a(this.initError||new fe(q.WS_ABORT,o)))),this.connectionState=yn.CONNECTING,this.websocket.init(t).catch(a),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval((()=>{this.handleWsInflateData()}),2e4)}))}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||$t.LEAVE,this.connectionState=yn.CLOSED,k.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(pt.ABORT_P2P_EXECUTION),this.store.signalConnected();const t=await ei(this,pt.REQUEST_JOIN_INFO);this.store.joinReq();const r=await this.request(ht.JOIN,t);if(this.ortc=t?.ortc,this.store.joinRep(),!r)return this.emit(pt.REPORT_JOIN_GATEWAY,nA.TIMEOUT,this.url||""),!1;this.joinResponse=r,this.emit(pt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=yn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new fe(q.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=W0(this,pt.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const r=await this.request(ht.REJOIN,t);return!!r&&(this.connectionState=yn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),r.peers&&r.peers.forEach((a=>{this.emit(Dt.ON_USER_ONLINE,{uid:a.uid}),a.audio&&this.emit(Dt.ON_ADD_AUDIO_STREAM,{uid:a.uid,uint_id:a.uint_id,audio:!0,ssrcId:a.audio_ssrc}),a.video&&this.emit(Dt.ON_ADD_VIDEO_STREAM,{uid:a.uid,uint_id:a.uint_id,video:!0,ssrcId:a.video_ssrc}),a.audio_mute?this.emit(Dt.MUTE_AUDIO,{uid:a.uid}):this.emit(Dt.UNMUTE_AUDIO,{uid:a.uid}),a.video_mute?this.emit(Dt.MUTE_VIDEO,{uid:a.uid}):this.emit(Dt.UNMUTE_VIDEO,{uid:a.uid}),a.audio_enable_local?this.emit(Dt.ENABLE_LOCAL_AUDIO,{uid:a.uid}):this.emit(Dt.DISABLE_LOCAL_AUDIO,{uid:a.uid}),a.video_enable_local?this.emit(Dt.ENABLE_LOCAL_VIDEO,{uid:a.uid}):this.emit(Dt.DISABLE_LOCAL_VIDEO,{uid:a.uid}),a.audio||a.video||this.emit(Dt.ON_REMOVE_STREAM,{uid:a.uid,uint_id:a.uint_id})})),!0)}reconnect(t,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,r)}async downgradeCodec(t){if(!this.ortc)return!1;const r={downgrade_codec:t,ortc:this.ortc};return!!await this.request(ht.DOWNGRADE_CODEC,r)}handleNotification(t){k.debug("[".concat(this.clientId,"] receive notification: "),t);const r=tS(t.code);if(t.code===28&&"detail"in t&&(k.info("[".concat(this.clientId,"] receive recover notification: "),t.detail),this.emit(pt.RECOVER_NOTIFICATION,t.detail)),r.action!=="success"){if(r.action!=="failed")return r.action==="quit"?(r.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close($t.UID_BANNED),void this.close()):void this.reconnect(r.action,Qr.SERVER_ERROR);k.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=X("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=t&&(k.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>X("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Qr.TIMEOUT):this.request(ht.PING,void 0,!0).then((()=>{this.pingpongTimeoutCount=0;const a=Date.now()-r;this.rttRolling.add(a),X("REPORT_STATS")&&this.send(ht.PING_BACK,{pingpongElapse:a})})).catch((a=>{}))}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:r}=this.websocket.getWsInflateData();t!==0&&r!==0&&this.upload(Q0.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:r,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(yt.RECONNECT_CREATE_CONNECTION,(t=>{this.emit(pt.WS_RECONNECT_CREATE_CONNECTION,t)})),this.websocket.on(yt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(yt.CLOSED,(()=>{this.connectionState=yn.CLOSED})),this.websocket.on(yt.FAILED,(()=>{this._disconnectedReason=$t.NETWORK_ERROR,this.connectionState=yn.CLOSED})),this.websocket.on(yt.RECONNECTING,(t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===yn.CONNECTED?this.connectionState=yn.RECONNECTING:this.connectionState=yn.CONNECTING})),this.websocket.on(yt.WILL_RECONNECT,((t,r,a)=>{const o=W0(this,pt.IS_P2P_DISCONNECTED),u=o||t!=="retry";o&&t==="retry"&&(k.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",r=nA.P2P_DISCONNECTED),u&&(k.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(pt.REPORT_JOIN_GATEWAY,r||nA.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(pt.DISCONNECT_P2P)),a(t)})),this.websocket.on(yt.CONNECTED,(()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch((t=>{k.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",Qr.SERVER_ERROR)})):this.join().catch((t=>{if(this.emit(pt.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof fe){if(t.code===q.UNEXPECTED_RESPONSE&&t.data.code===ot.ERR_NO_AUTHORIZED)return this.initError=new fe(q.TOKEN_EXPIRE,"dynamic key expired"),void this.close($t.TOKEN_EXPIRE);k.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Qr.SERVER_ERROR):(this.initError=t,this.close())}}))})),this.websocket.on(yt.REQUEST_NEW_URLS,((t,r)=>{ei(this,pt.REQUEST_RECOVER,this.multiIpOption).then(t).catch(r)})),this.websocket.on(yt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{this.emit(Dt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})),this.websocket.on(u8.PRE_CONNECT_PC,(()=>{this.emit(pt.PRE_CONNECT_PC)}))}}let Tce=(function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e})({}),rr=(function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e})({});function p8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),r.push.apply(r,a)}return r}function iA(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?p8(Object(r),!0).forEach((function(a){H(e,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p8(Object(r)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))}))}return e}function Mh(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(X("TURN_DOMAIN")):(k.debug("Cannot recognized as ip address: ".concat(e,", use as host2")),e)}function aA(e){try{const t=X("GATEWAY_DOMAINS").concat(X("TURN_DOMAIN")).find((r=>je(e).call(e,r)));return t?e.split(".".concat(t))[0].replace(/-/g,"."):e}catch{return k.debug("serverUrlToIp error, fallback to url",e),e}}function iP(e,t){e.addresses||(e.addresses=[]);const r=(function(m,g){if(X("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return m.map((A=>{let{ip:O,port:N}=A;return{address:"".concat(O,":").concat(N)}}));const y=X("GATEWAY_DOMAINS");let E=y[1]&&je(g).call(g,y[1])?1:0;return m.map((A=>{let{domain_prefix:O,port:N,ip:B}=A;if(O)return{address:"".concat(O,".").concat(y[E++%y.length],":").concat(N)};const U=/^[\.\:\d]+$/.test(B),V=U?"".concat(B.replace(/[^\d]/g,"-"),".").concat(y[E++%y.length],":").concat(N):"".concat(B,":").concat(N);return U||k.debug("Cannot recognized as ip address: ".concat(B,", use as host3")),{ip:B,port:N,address:V}}))})(e.addresses,t),a=Array.isArray(e.detail)&&e.detail[18];if(a&&typeof a=="string"){const m=a.split(";");for(let g=0;g<m.length;g++){var o;const y=ki(o=m[g]).call(o);r[g]&&y&&(r[g].ip6=y)}}const u=e.detail&&e.detail.candidate;let h;if(u){const[m,g]=u.split(":");m&&g&&(h={port:Number(g),ip:m,address:"".concat(m,":").concat(g)})}return{gatewayAddrs:r,apGatewayAddress:h,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function Ja(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function m8(e){const t=e._encoderConfig;if(!t)return{};const r={resolution:t.width&&t.height?"".concat(Ja(t.width),"x").concat(Ja(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(r.maxFrameRate=t.frameRate,r.minFrameRate=t.frameRate):t.frameRate&&(r.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,r.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),r}function g8(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function rS(e,t){let r,a,o;switch(t){case rr.CHOOSE_SERVER:a=4096,o="choose server";break;case rr.CLOUD_PROXY:a=1048576,o="proxy";break;case rr.CLOUD_PROXY_5:a=4194304,o="proxy5";break;case rr.CLOUD_PROXY_FALLBACK:a=4194310,o="proxy fallback";break;default:throw new fe(q.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach((u=>{u.buffer&&u.buffer.flag===a&&(r={code:u.buffer.code,addresses:(u.buffer.edges_services||[]).map((h=>iA(iA({},h),{},{ticket:u.buffer.cert}))),server_ts:e.enter_ts,uid:u.buffer.uid,cid:u.buffer.cid,cname:u.buffer.cname,detail:iA(iA({},u.buffer.detail),e.detail),flag:u.buffer.flag,opid:e.opid,cert:u.buffer.cert})})),!r)throw new fe(q.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(o," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return r}async function _8(e,t){return await Fe.all(e.addresses.map((async r=>({address:Mh(r.ip),tcpport:r.port,udpport:r.port,username:t&&X("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():ti.username,password:t&&X("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await aD(t.toString()):ti.password}))))}function aP(e,t){const r=t.getMediaStreamTrack(!0).getSettings(),a=t.videoHeight||r.height,o=t.videoWidth||r.width;return a&&o?Math.max(Math.min(a,o)/Math.min(Ja(e.height),Ja(e.width)),1):(k.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Uh(e){let{candidateType:t,relayProtocol:r,type:a,address:o,port:u,protocol:h}=e;const m={candidateType:t,relayProtocol:r,protocol:h};if(a!=="local-candidate"){const g=o.split(".");g.length>=4&&(g[1]="*",g[2]="*"),m.address=g.join("."),m.port=u}return m}function Bp(e){const t=e.split(":"),r=e.split(/[-.]/),a=je(e).call(e,"-")?"-":".";let o=e;return t.length>1?r.length>1?(r[1]="**",o=r[0]+a+"**:"+t[t.length-1]):o=t.length>2?t[0]+a+"**:"+t[t.length-1]:"**:"+t[t.length-1]:r.length>1&&(o=r[0]+a+"**"),o}function sA(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:X("SVC_MODE");if(X("ENABLE_SVC"))return(function(t){return t in kC})(e)?e:kC.L1T3}const v8={[Xe.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[Xe.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function oA(e,t,r){t.forEach((a=>{var o;const u=v8[e].find((m=>{var g;let{key:y}=m;return je(g=a.extensionName).call(g,y)}));if(!u)return;const h=r.find((m=>{let{extensionName:g}=m;return je(g).call(g,u.key)}));h&&je(o=h.extensionName).call(o,"gdpr_forbidden")&&(a.extensionName=h.extensionName)}))}function ev(e,t){t.forEach((r=>{var a;const o=v8[e].find((u=>{var h;let{key:m}=u;return je(h=r.extensionName).call(h,m)}));je(a=r.extensionName).call(a,"gdpr_forbidden")&&o&&(r.extensionName=o.extensionName)}))}function y8(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||je(e).call(e,"abs-send-time")}function cA(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||je(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function E8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),r.push.apply(r,a)}return r}function S8(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?E8(Object(r),!0).forEach((function(a){H(e,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E8(Object(r)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))}))}return e}function iS(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0;const{filterRTX:o,filterVideoFec:u,filterAudioFec:h,filterAudioCodec:m,filterVideoCodec:g,unsupportedVideoUplinkCodec:y,unsupportedVideoDownlinkCodec:E}=t,{useXR:A}=r;let O=[],N=[],B=[],U=[],V=!1,K=!1;if(Ca(e).mediaDescriptions.forEach((J=>{a&&a!==J.attributes.direction||(J.media.mediaType!=="video"||V||(N=J.attributes.payloads,U=J.attributes.extmaps,V=!0),J.media.mediaType!=="audio"||K||(O=J.attributes.payloads,B=J.attributes.extmaps,K=!0))})),!U||N.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!B||O.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(N.forEach((J=>{var ae;(ae=J.rtpMap)!==null&&ae!==void 0&&ae.clockRate&&(J.rtpMap.clockRate=parseInt(J.rtpMap.clockRate)),A&&J.rtcpFeedbacks.push({type:"rrtr"})})),O.forEach((J=>{var ae;(ae=J.rtpMap)!==null&&ae!==void 0&&ae.clockRate&&(J.rtpMap.clockRate=parseInt(J.rtpMap.clockRate)),A&&J.rtcpFeedbacks.push({type:"rrtr"})})),o&&(O=O.filter((J=>{var ae;return((ae=J.rtpMap)===null||ae===void 0?void 0:ae.encodingName.toLowerCase())!=="rtx"})),N=N.filter((J=>{var ae;return((ae=J.rtpMap)===null||ae===void 0?void 0:ae.encodingName.toLowerCase())!=="rtx"}))),u){const J=N.filter((ee=>{var le;return/(red)|(ulpfec)|(flexfec)/i.test(((le=ee.rtpMap)===null||le===void 0?void 0:le.encodingName)||"")})),ae=Vh(J,N).map((ee=>ee.payloadType)),ie=[...J.map((ee=>ee.payloadType)),...ae];N=N.filter((ee=>!je(ie).call(ie,ee.payloadType)))}if(h&&(O=O.filter((J=>{var ae;return!/(red)|(ulpfec)|(flexfec)/i.test(((ae=J.rtpMap)===null||ae===void 0?void 0:ae.encodingName)||"")}))),m&&m?.length>0&&(O=O.filter((J=>{var ae;return je(m).call(m,((ae=J.rtpMap)===null||ae===void 0?void 0:ae.encodingName.toLowerCase())||"")}))),g&&g?.length>0){const J=N.filter((ae=>{var ie;return je(g).call(g,((ie=ae.rtpMap)===null||ie===void 0?void 0:ie.encodingName.toLowerCase())||"")}));N=J.concat(o?[]:Vh(J,N))}const z=X("UNSUPPORTED_VIDEO_CODEC");if(z&&z.length>0){const J=N.filter((ee=>ee.rtpMap&&je(z).call(z,ee.rtpMap.encodingName.toLowerCase()))),ae=Vh(J,N),ie=J.concat(ae).map((ee=>ee.payloadType));N=N.filter((ee=>!je(ie).call(ie,ee.payloadType))),k.debug("unsupportedVideoCodec: ".concat(z,", toBeRemoved: ").concat(ie))}if(y&&y.length>0&&a==="sendonly"){const J=N.filter((ee=>ee.rtpMap&&je(y).call(y,ee.rtpMap.encodingName.toLowerCase()))),ae=Vh(J,N),ie=J.concat(ae).map((ee=>ee.payloadType));N=N.filter((ee=>!je(ie).call(ie,ee.payloadType))),k.debug("unsupportedVideoUplinkCodec: ".concat(y,", toBeRemoved: ").concat(ie))}if(E&&E.length>0&&a==="recvonly"){const J=N.filter((ee=>ee.rtpMap&&je(E).call(E,ee.rtpMap.encodingName.toLowerCase()))),ae=Vh(J,N),ie=J.concat(ae).map((ee=>ee.payloadType));N=N.filter((ee=>!je(ie).call(ie,ee.payloadType))),k.debug("unsupportedVideoDownlinkCodec: ".concat(E,", toBeRemoved: ").concat(ie))}return{audioCodecs:O,videoCodecs:N,audioExtensions:B,videoExtensions:U}}function jh(e){const t=Ca(e);let r,a;for(const o of t.mediaDescriptions){if(!r){const u=o.attributes.iceUfrag,h=o.attributes.icePwd;if(!u||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");r={iceUfrag:u,icePwd:h}}if(!a){const u=o.attributes.fingerprints;u.length>0&&(a={fingerprints:u})}}if(!a&&t.attributes.fingerprints.length>0&&(a={fingerprints:t.attributes.fingerprints}),!a||!r)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:r,dtlsParameters:a}}function b8(e,t){const r=[],a=e.attributes.ssrcGroups.filter((h=>h.semantic==="FID")),o=e.attributes.ssrcGroups.find((h=>h.semantic==="SIM")),u=e.attributes.ssrcs;if(o)o.ssrcIds.forEach((h=>{var m;const g=(m=a.find((y=>y.ssrcIds[0]===h)))===null||m===void 0?void 0:m.ssrcIds[1];r.push({ssrcId:h,rtx:t?g:void 0})}));else if(a.length>0){const h=a[0].ssrcIds[0],m=a[0].ssrcIds[1];r.push({ssrcId:h,rtx:t?m:void 0})}else{if(u.length===0)throw new Error("No ssrcs found on local media description.");r.push({ssrcId:u[0].ssrcId})}return r}function T8(e,t,r){const{cname:a}=e;let o=[];t&&(o=w8(t)),o.length===0&&(o=e.iceParameters.candidates.map((E=>({foundation:E.foundation,componentId:"1",transport:E.protocol,priority:E.priority.toString(),connectionAddress:E.ip,port:E.port.toString(),type:E.type,extension:{}}))),k.debug("Using candidates from gateway."));const u={fingerprints:e.dtlsParameters.fingerprints.map((E=>({hashFunction:E.algorithm,fingerprint:E.fingerprint})))},h={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let m;switch(e.dtlsParameters.role){case"server":m="passive";break;case"client":m="active";break;case"auto":m="actpass"}const g=uA(e.rtpCapabilities),y=[];return Array.isArray(r)&&r.length>0&&r.forEach((E=>{y.push({kind:Xe.VIDEO,ssrcMsg:[{ssrcId:E.v,rtx:E.v_rtx}],mslabel:"".concat(E.v,"_").concat(E.a)},{kind:Xe.AUDIO,ssrcMsg:[{ssrcId:E.a}],mslabel:"".concat(E.v,"_").concat(E.a)})})),{dtlsParameters:u,iceParameters:h,candidates:o,rtpCapabilities:g,setup:m,cname:a,preSSRCs:y}}function w8(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],k.debug("Using remote candidate from AP ".concat(Bp(e.ip),":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),k.debug("Using IPV6 remote candidate from AP ".concat(Bp(e.ip6),":").concat(e.port)))),t}function aS(e,t,r){const a=[],o=[];return e.forEach((u=>{let{ssrcId:h,rtx:m}=u;const g=fn(8,"track-"),y={ssrcId:h,attributes:S8({label:g,mslabel:r=r||fn(10,""),msid:"".concat(r," ").concat(g)},t&&{cname:t})};if(a.push(y),m!==void 0){const E={ssrcId:m,attributes:S8({label:g,mslabel:r,msid:"".concat(r," ").concat(g)},t&&{cname:t})};a.push(E),o.push({semantic:"FID",ssrcIds:[h,m]})}})),e.length>1&&o.push({semantic:"SIM",ssrcIds:e.map((u=>{let{ssrcId:h}=u;return h}))}),{ssrcs:a,ssrcGroups:o}}function tv(e,t){t instanceof zn&&e.attributes.payloads.forEach((r=>{var a;const o=(a=r.rtpMap)===null||a===void 0?void 0:a.encodingName.toLowerCase();if(!o||["opus","pcmu","pcma","g722"].indexOf(o)===-1)return;r.fmtp||(r.fmtp={parameters:{}}),o==="opus"&&typeof X("OPUS_PTIME")=="number"?r.fmtp.parameters.ptime=X("OPUS_PTIME"):r.fmtp.parameters.minptime="10",r.fmtp.parameters.useinbandfec="1";const u=t._encoderConfig;u&&(o!=="pcmu"&&o!=="pcma"&&o!=="g722"&&(u.bitrate&&!Vn()&&(r.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*u.bitrate))),u.sampleRate&&(r.fmtp.parameters.maxplaybackrate="".concat(u.sampleRate),r.fmtp.parameters["sprop-maxcapturerate"]="".concat(u.sampleRate)),u.stereo&&(r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1")),t instanceof $0&&o==="opus"&&t._config.DTX&&(r.fmtp.parameters.usedtx="1"))}))}function sP(e){const t=e.attributes.unrecognized.findIndex((r=>r.attField==="x-google-flag"&&r.attValue==="conference"));t!==-1&&e.attributes.unrecognized.splice(t,1)}function oP(e,t){var r;if(!(t instanceof wn&&t._encoderConfig&&t._hints.indexOf(un.SCREEN_TRACK)===-1))return;const a=t._encoderConfig;Vt().supportMinBitrate&&a.bitrateMin&&e.attributes.payloads.forEach((o=>{var u,h;je(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=o.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(o.fmtp||(o.fmtp={parameters:{}}),o.fmtp.parameters["x-google-min-bitrate"]="".concat(a.bitrateMin))})),Vt().supportMinBitrate&&!je(r=t._hints).call(r,un.LOW_STREAM)&&a.bitrateMax&&e.attributes.payloads.forEach((o=>{var u,h;je(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=o.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(o.fmtp||(o.fmtp={parameters:{}}),o.fmtp.parameters["x-google-start-bitrate"]="".concat(X("X_GOOGLE_START_BITRATE")||Math.floor(a.bitrateMax)))}))}function R8(e){if(e.media.mediaType!=="video")return;const t=Lt();if(t.name!==Gt.SAFARI&&t.os!==Cr.IOS)return;const r=e.attributes.extmaps.findIndex((a=>/video-orientation/g.test(a.extensionName)));r!==-1&&e.attributes.extmaps.splice(r,1)}function lA(e,t,r){if(!t)return;let a,o;if(e.media.mediaType==="video"?(a=r.videoExtensions,o=r.videoCodecs):(a=r.audioExtensions,o=r.audioCodecs),t.twcc===!0){const u=a.find((h=>cA(h.extensionName)));if(u){const h=u.extensionName;e.attributes.extmaps.find((g=>cA(g.extensionName)))||e.attributes.extmaps.push({entry:u.entry,extensionName:h}),(function(g,y){return y.filter((E=>!!g.find((A=>A.payloadType===E.payloadType&&!!A.rtcpFeedbacks.find((O=>O.type==="transport-cc"))))))})(o,e.attributes.payloads).forEach((g=>{g.rtcpFeedbacks.find((y=>y.type==="transport-cc"))||g.rtcpFeedbacks.push({type:"transport-cc"})}))}}else if(t.twcc===!1){const u=e.attributes.extmaps.findIndex((h=>cA(h.extensionName)));u!==-1&&e.attributes.extmaps.splice(u,1),e.attributes.payloads.forEach((h=>{const m=h.rtcpFeedbacks.findIndex((g=>g.type==="transport-cc"));m!==-1&&h.rtcpFeedbacks.splice(m,1)}))}if(t.remb===!0){const u=a.find((h=>y8(h.extensionName)));if(u){const h=u.extensionName;e.attributes.extmaps.find((g=>g.extensionName===h))||e.attributes.extmaps.push({entry:u.entry,extensionName:h}),(function(g,y){return y.filter((E=>!!g.find((A=>A.payloadType===E.payloadType&&!!A.rtcpFeedbacks.find((O=>O.type==="goog-remb"))))))})(o,e.attributes.payloads).forEach((g=>{g.rtcpFeedbacks.find((y=>y.type==="goog-remb"))||g.rtcpFeedbacks.push({type:"goog-remb"})}))}}else if(t.remb===!1){const u=e.attributes.extmaps.findIndex((h=>y8(h.extensionName)));u!==-1&&e.attributes.extmaps.splice(u,1),e.attributes.payloads.forEach((h=>{const m=h.rtcpFeedbacks.findIndex((g=>g.type==="goog-remb"));m!==-1&&h.rtcpFeedbacks.splice(m,1)}))}}function C8(e,t,r){if(Vn()||e.media.mediaType!=="video"||!(t instanceof wn)||r!=="vp9"&&r!=="vp8"||r==="vp8"&&!X("SIMULCAST")||r==="vp9"&&X("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;const a=r==="vp8"?2:t._scalabilityMode.numSpatialLayers,o=e.attributes.ssrcs[0],u=e.attributes.ssrcGroups.find((m=>m.semantic==="FID"&&m.ssrcIds[0]===o.ssrcId)),h={semantic:"SIM",ssrcIds:[o.ssrcId]};for(let m=1;m<a;m++)e.attributes.ssrcs.push({ssrcId:o.ssrcId+m,attributes:Pn(o.attributes)}),h.ssrcIds.push(o.ssrcId+m),u&&(e.attributes.ssrcs.push({ssrcId:u.ssrcIds[1]+m,attributes:Pn(o.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[o.ssrcId+m,u.ssrcIds[1]+m]}));e.attributes.ssrcGroups.unshift(h)}async function A8(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=new RTCPeerConnection;r.addTransceiver("video",{direction:"sendonly"}),r.addTransceiver("audio",{direction:"sendonly"}),r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"});const a=(await r.createOffer()).sdp,{send:o,recv:u,sendrecv:h}=(function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},y=arguments.length>2?arguments[2]:void 0;const E=iS(y,m,g,"sendonly"),A=iS(y,m,g,"recvonly"),O={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},N={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},B={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(xo(E,A,"videoExtensions",O,N,B),xo(E,A,"videoCodecs",O,N,B),xo(E,A,"audioExtensions",O,N,B),xo(E,A,"audioCodecs",O,N,B),X("RAISE_H264_BASELINE_PRIORITY")){const U=[],V=[];if(B.videoCodecs.forEach(((K,z)=>{var J;if(((J=K.rtpMap)===null||J===void 0?void 0:J.encodingName.toLocaleLowerCase())==="h264"){var ae,ie;const ee=B.videoCodecs[z+1],le=ee&&D8(K,ee),ye=(ae=K.fmtp)===null||ae===void 0?void 0:ae.parameters["profile-level-id"],we=(ie=K.fmtp)===null||ie===void 0?void 0:ie.parameters["packetization-mode"];!ye||ye!==X("FIRST_H264_PROFILE_LEVEL_ID")||X("FIRST_PACKETIZATION_MODE")&&we!==X("FIRST_PACKETIZATION_MODE")?le?V.push([K,ee]):V.push([K]):le?U.push([K,ee]):U.push([K])}})),U.length>0&&V.length>0){k.debug("raising H264 baseline profile priority"),B.videoCodecs.forEach(((z,J)=>{var ae;if(((ae=z.rtpMap)===null||ae===void 0?void 0:ae.encodingName.toLocaleLowerCase())==="h264"){const ie=D8(z,B.videoCodecs[J+1]),ee=U.shift()||V.shift()||[];ee.length>0&&(ie?B.videoCodecs.splice(J,2,...ee):B.videoCodecs.splice(J,1,...ee))}}));const K=N.videoCodecs.filter((z=>{var J,ae;return((J=z.rtpMap)===null||J===void 0?void 0:J.encodingName.toLocaleLowerCase())==="h264"&&((ae=z.fmtp)===null||ae===void 0?void 0:ae.parameters["profile-level-id"])!==X("FIRST_H264_PROFILE_LEVEL_ID")}));if(K.length>0){const z=Vh(K,N.videoCodecs).map((ae=>ae.payloadType)),J=[...K.map((ae=>ae.payloadType)),...z];N.videoCodecs=N.videoCodecs.filter((ae=>!je(J).call(J,ae.payloadType)))}X("FILTER_SEND_H264_BASELINE")&&(O.videoCodecs=O.videoCodecs.filter((z=>{var J,ae;return!(((J=z.rtpMap)===null||J===void 0?void 0:J.encodingName.toLocaleLowerCase())==="h264"&&((ae=z.fmtp)===null||ae===void 0?void 0:ae.parameters["profile-level-id"])!==X("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:O,recv:N,sendrecv:B}}return{send:O,recv:N,sendrecv:B}})(e,t,a);try{r.close()}catch{}return{send:o,recv:u,sendrecv:h}}function O8(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=iS(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(xo(e,t,"videoExtensions",r,a,o),xo(e,t,"videoCodecs",r,a,o),xo(e,t,"audioExtensions",r,a,o),xo(e,t,"audioCodecs",r,a,o),X("RAISE_H264_BASELINE_PRIORITY")){const u=o.videoCodecs.findIndex((h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]==="42001f"));if(u!==-1){const h=o.videoCodecs.findIndex((m=>m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264"));if(h<u){k.debug("raising H264 baseline profile priority");const m=o.videoCodecs[u];o.videoCodecs.splice(u,1),o.videoCodecs.splice(h,0,m)}h!==-1&&(a.videoCodecs=a.videoCodecs.filter((m=>!(m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&m.fmtp&&m.fmtp.parameters["profile-level-id"]!=="42001f"))))}}return{send:r,recv:a,sendrecv:o}}function xo(e,t,r,a,o,u){if(r==="videoExtensions"||r==="audioExtensions"){const h=[];return e[r].forEach((m=>{t[r].some(((g,y)=>{if(m.entry===g.entry&&m.extensionName===g.extensionName)return h.push(y),!0}))?u[r].push(m):a[r].push(m)})),void t[r].forEach(((m,g)=>{h.indexOf(g)===-1&&o[r].push(m)}))}if(r==="videoCodecs"||r==="audioCodecs"){const h=[];return e[r].forEach((m=>{t[r].some(((g,y)=>{if(m.payloadType===g.payloadType&&JSON.stringify(m)===JSON.stringify(g))return h.push(y),!0}))?u[r].push(m):a[r].push(m)})),void t[r].forEach(((m,g)=>{h.indexOf(g)===-1&&o[r].push(m)}))}}function uA(e){const{send:t,recv:r,sendrecv:a}=e;if(!a){if(!t||!r)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:r}}let o,u;return t?(o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o.audioCodecs=[...t.audioCodecs,...a.audioCodecs],o.videoCodecs=[...t.videoCodecs,...a.videoCodecs],o.audioExtensions=[...t.audioExtensions,...a.audioExtensions],o.videoExtensions=[...t.videoExtensions,...a.videoExtensions]):o=a,r?(u={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},u.audioCodecs=[...r.audioCodecs,...a.audioCodecs],u.videoCodecs=[...r.videoCodecs,...a.videoCodecs],u.audioExtensions=[...r.audioExtensions,...a.audioExtensions],u.videoExtensions=[...r.videoExtensions,...a.videoExtensions]):u=a,{send:o,recv:u}}function nv(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter((t=>{var r;return((r=t.rtpMap)===null||r===void 0?void 0:r.encodingName.toLowerCase())==="opus"})).forEach((t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"}))}function sS(e,t,r,a){let o=[];if(e===Xe.VIDEO){if(X("H264_PROFILE_LEVEL_ID")&&a==="h264"&&(o=t.videoCodecs.filter((u=>{var h;return je(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,a)&&u&&u.fmtp&&u.fmtp.parameters["profile-level-id"]===X("H264_PROFILE_LEVEL_ID")}))),!Array.isArray(o)||o.length===0){let u=[];const h=[],m=[],g=[];if(r.videoCodecs.forEach((y=>{const E=y.rtpMap&&y.rtpMap.encodingName.toLowerCase()||"";je(E).call(E,a)?u.push(y):je(E).call(E,"vp9")?h.push(y):je(E).call(E,"vp8")?m.push(y):je(E).call(E,"h264")&&g.push(y)})),u.length===0){let y="";h.length!==0?(u=h,y="vp9"):m.length!==0?(u=m,y="vp8"):g.length!==0&&(u=g,y="h264"),k.warning("codec ".concat(a," not included in rtpCapabilities, fallback to default payloads: ").concat(y))}u.length!==0&&(o=t.videoCodecs.filter((y=>u.some((E=>E.payloadType===y.payloadType)))))}if(o.length===0&&(k.warning("codec ".concat(a," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),o=t.videoCodecs),X("USE_PUB_RTX")||X("USE_SUB_RTX")){const u=Vh(o,t.videoCodecs);o=[...o,...u]}}else{o=t.audioCodecs.filter((h=>{var m;return je(m=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(m,a)}));const u=t.audioCodecs.filter((h=>{var m;return je(m=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(m,"red")}));o.length===0&&(k.warning("codec ".concat(a," not included in rtpCapabilities, fallback to opus")),o=t.audioCodecs.filter((h=>{var m;return je(m=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(m,"opus")}))),X("ENABLE_AUDIO_RED")&&u.length!==0&&(o=[...u,...o])}return o}function Vh(e,t){const r=e.map((a=>a.payloadType.toString()));return t.filter((a=>a.rtpMap&&a.rtpMap.encodingName==="rtx"&&a.fmtp&&a.fmtp.parameters.apt&&je(r).call(r,a.fmtp&&a.fmtp.parameters.apt)))}async function Bh(e,t,r){const a=t.toString(),o=N8(a,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:a});const u=await e.createAnswer();if(!u.sdp)throw new Error("cannot get answer sdp");let h=u.sdp;h=I8(h,r||{}),o?.(h||""),await e.setLocalDescription({type:"answer",sdp:h})}function I8(e,t,r){const a=Ca(e),{useXR:o}=t;return a.mediaDescriptions.forEach((u=>{var h;u.attributes.mid&&(Array.isArray(r)&&!je(r).call(r,u.attributes.mid)||(u.media.mediaType==="audio"&&nv(u),o&&je(h=["audio","video"]).call(h,u.media.mediaType)&&u.attributes.payloads.forEach((m=>{m.rtcpFeedbacks.findIndex((g=>g.type==="rrtr"))===-1&&m.rtcpFeedbacks.push({type:"rrtr"})}))))})),Dh(a)}function N8(e,t,r,a){if(X("SDP_LOGGING"))return k.upload("exchanging ".concat(r," ").concat(t," SDP during P2PConnection.").concat(a,`
`),e),t==="offer"?o=>{N8(o,"answer",r==="local"?"remote":"local",a)}:void 0}function x8(e){const t=X("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some((r=>je(e).call(e,r)))}function D8(e,t){try{var r;return((r=e.fmtp)===null||r===void 0?void 0:r.parameters.apt)===t.payloadType.toString()}catch{return!1}}function P8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),r.push.apply(r,a)}return r}function Cs(e,t){return typeof X(e)===t?X(e):void 0}function wce(){try{const e=X("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:(function(t){for(var r=1;r<arguments.length;r++){var a=arguments[r]!=null?arguments[r]:{};r%2?P8(Object(a),!0).forEach((function(o){H(t,o,a[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):P8(Object(a)).forEach((function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(a,o))}))}return t})({},e)}catch(e){return k.debug("handle gateway attributes failed: ",e),{}}}const k8={};function Fh(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&k.debug("install service ".concat(e.name)),k8[e.name]=e}function Hu(e){const t=k8[e];if(!t)throw new ve(q.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function L8(e,t){return Hu("DataStream").create(e,t)}function dA(){return Hu("InterceptFrame").create()}function M8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),r.push.apply(r,a)}return r}function wi(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?M8(Object(r),!0).forEach((function(a){H(e,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):M8(Object(r)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))}))}return e}const cP=new Map;class Rce extends Mn{get state(){return this._state}set state(t){if(t===this._state)return;const r=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(Dr.CONNECTION_STATE_CHANGE,t,r,this._disconnectedReason):this.emit(Dr.CONNECTION_STATE_CHANGE,t,r)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){k.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,r){var a,o,u;super(),H(this,"store",void 0),H(this,"joinInfo",void 0),H(this,"key",void 0),H(this,"ntpOffset",0),H(this,"signal",void 0),H(this,"role",void 0),H(this,"isPreallocation",void 0),H(this,"isPreSub",void 0),H(this,"inChannelInfo",{joinAt:null,duration:0}),H(this,"spec",void 0),H(this,"_state","DISCONNECTED"),H(this,"_statsCollector",void 0),H(this,"_disconnectedReason",void 0),H(this,"isSignalRecover",!1),H(this,"hasChangeBGPAddress",!1),H(this,"trafficStatsInterval",void 0),H(this,"networkQualityInterval",void 0),H(this,"_joinGatewayStartTime",0),H(this,"_signalTimeout",!1),H(this,"_clientRoleOptions",void 0),H(this,"_isProactiveJoin",!1),this.store=t,this.spec=r,this.signal=this.store.useP2P?(a={spec:wi(wi({},r),{},{retryConfig:r.websocketRetryConfig}),store:t},(o=(u=Hu("P2PChannel")).createSubmodule)===null||o===void 0?void 0:o.call(u,a)):new bce(wi(wi({},r),{},{retryConfig:r.websocketRetryConfig}),t),this._statsCollector=r.statsCollector,this.role=r.role||"audience",this._clientRoleOptions=r.clientRoleOptions,this.handleSignalEvents()}async join(t,r,a){this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const o=Date.now();let u=cP.get(t.cname);if(u||(u=new Map,cP.set(t.cname,u)),this._isProactiveJoin=!0,u.has(t.uid)){const y=new fe(q.UID_CONFLICT);throw nt.joinGateway(t.sid,{lts:o,succ:!1,ec:y.code,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!t.proxyServer,signalChannel:"0",preload:t.preload}),y}u.set(t.uid,!0),this.joinInfo=t,this.key=r;let h=0;this.joinGatewayStartTime=o;const m=t.proxyServer;try{k.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(h));const y=t.gatewayAddrs.map((E=>{let{address:A}=E;const[O,N]=A.split(":"),B={host:O,port:N};return t.proxyServer&&(B.proxy=t.proxyServer),B}));h=(await this.signal.init(y)).uid,k.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(h," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(y){var g;throw k.error("[".concat(this.store.clientId,"] User join failed"),y.toString()),nt.joinGateway(t.sid,{lts:o,succ:!1,ec:((g=y.data)===null||g===void 0?void 0:g.desc)||y.code,errorMsg:y.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!m,signalChannel:"0",preload:t.preload}),u.delete(t.uid),this.signal.close(),y}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),k.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval((()=>{this.updateTrafficStats().catch((y=>{k.warning("[".concat(this.store.clientId,"] get traffic stats error"),y.toString())}))}),3e3),this.networkQualityInterval=window.setInterval((()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Dr.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Dr.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Dr.NETWORK_QUALITY,{uplinkNetworkQuality:g8(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:g8(this._statsCollector.trafficStats.B_dnq)}):this.emit(Dr.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})}),2e3),this.store.joinGatewayEnd(),h}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],r=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){r!==$t.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==yn.CONNECTED||await(function(a,o){return o===1/0?a:Fe.race([a,Jse(o)])})(this.signal.request(ht.LEAVE,void 0,!0),3e3)}catch(a){k.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),a)}this.signal.close(r),r!==$t.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,r,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new fe(q.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const o={state:"offer",p2p_id:this.store.p2pId,ortc:r,mode:this.spec.mode,extend:X("PUB_EXTEND"),twcc:!!X("PUBLISH_TWCC"),rtx:!!X("USE_PUB_RTX")};try{return(await this.signal.request(ht.PUBLISH,o,!0))._message}catch(u){if(a&&u.data&&u.data.code===ot.ERR_PUBLISH_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),u.toString()),await this.tryUnpubBeforeRepub(t,r),this.publish(t,r,!1);throw u}}async publishDataChannel(t,r,a){var o;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new fe(q.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const u={stream_id:r.streamId,ordered:r.ordered?1:0,max_retrans_times:(o=r.maxRetransmits)!==null&&o!==void 0?o:10,channel_id:r.channelId,metadata:r.metadata};try{await this.signal.request(ht.PUBLISH_DATASTREAM,u,!0)}catch(h){if(a&&h.data&&h.data.code===ot.ERR_PUBLISH_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),h.toString()),await this.tryUnpubDataChannelBeforeRepub(t,r),this.publishDataChannel(t,r,!1);throw h}}async unpublish(t,r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new fe(q.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(ht.UNPUBLISH,{stream_id:r,ortc:t},!0)}catch(a){k.warning("[".concat(this.store.clientId,"] unpublish warning: "),a)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new fe(q.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Fe.all(t.map((r=>this.signal.request(ht.UNPUBLISH_DATASTREAM,{channel_id:r},!0))))}catch(r){k.warning("unpublish datachannels warning: ",r)}}async presubscribe(t,r,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new fe(q.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const o={stream_id:t,stream_type:r,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!X("SUBSCRIBE_TWCC"),rtx:!!X("USE_SUB_RTX")||void 0,extend:X("SUB_EXTEND"),svc:Array.isArray(X("SVC"))&&X("SVC").length!==0?X("SVC"):void 0};try{return await this.signal.request(ht.PRE_SUBSCRIBE,o,!0)}catch(u){if(a&&u.data&&u.data.code===ot.ERR_SUBSCRIBE_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),u.toString()),this.presubscribe(t,r,!1);throw u}}async subscribe(t,r,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new fe(q.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const o={stream_id:t,stream_type:r.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!X("SUBSCRIBE_TWCC"),rtx:!!X("USE_SUB_RTX"),extend:X("SUB_EXTEND"),ssrcId:r.ssrcId,svc:Array.isArray(X("SVC"))&&X("SVC").length!==0?X("SVC"):void 0};try{return(await this.signal.request(ht.SUBSCRIBE,o,!0))._message}catch(u){if(a&&u.data&&u.data.code===ot.ERR_SUBSCRIBE_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),u.toString()),await this.tryUnsubBeforeResub(t,r),await this.subscribe(t,r,!1);throw u}}async subscribeDataChannel(t,r,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new fe(q.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const o={uid:t,stream_id:r.id,channel_id:r.datachannelId};try{return void await this.signal.request(ht.SUBSCRIBE_DATASTREAM,o,!0)}catch(u){if(a&&u.data&&u.data.code===ot.ERR_SUBSCRIBE_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),u.toString()),await this.tryUnsubDataChannelBeforeResub(t,r),await this.subscribeDataChannel(t,r,!1);throw u}}async subscribeAll(t,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new fe(q.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const a={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!X("USE_SUB_RTX"),twcc:!!X("SUBSCRIBE_TWCC"),svc:Array.isArray(X("SVC"))&&X("SVC").length!==0?X("SVC"):void 0};try{return await this.signal.request(ht.SUBSCRIBE_STREAMS,a,!0)}catch(o){if(r&&o.data&&o.data.code===ot.ERR_SUBSCRIBE_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),o.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw o}}async setVideoProfile(t){const r=(function(a){if(!(a.bitrateMax&&a.bitrateMin&&a.frameRate&&a.height&&a.width))return;let o=a.frameRate,u=a.width,h=a.height,m=!0;return typeof o!="number"&&(o=o.exact||o.ideal||o.max||o.min||0,o||(m=!1)),typeof u!="number"&&(u=u.exact||u.ideal||u.max||u.min||0,u||(m=!1)),typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,o||(m=!1)),m?{stream_type:0,width:u,height:h,fps:o,start_bps:1e3*a.bitrateMax,min_bps:1e3*a.bitrateMin,target_bps:1e3*a.bitrateMax}:void 0})(t);if(r)return this.signal.request(ht.SET_VIDEO_PROFILE,r);k.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,r){try{await this.signal.request(ht.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:r},!0)}catch(a){k.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),a)}}async unsubscribeDataChannel(t,r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new fe(q.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Fe.all(t.map((a=>this.signal.request(ht.UNSUBSCRIBE_DATASTREAM,{stream_id:a,uid:r},!0))))}catch(a){k.warning("unsubscribeDataChannel warning: ",a)}}async massUnsubscribe(t){try{await this.signal.request(ht.UNSUBSCRIBE_STREAMS,t,!0)}catch(r){k.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),r)}}async reconnectPC(t){const{iceParameters:r,dtlsParameters:a,rtpCapabilities:o}=t;return{gatewayEstablishParams:await this.signal.request(ht.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:r,dtlsParameters:a,rtpCapabilities:o}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(ht.GATEWAY_INFO)}async renewToken(t){await this.signal.request(ht.RENEW_TOKEN,t),this.key=t.token}updateClientRole(t,r){r&&(this._clientRoleOptions=Object.assign({},r)),X("CLIENT_ROLE_OPTIONS")&&(k.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(X("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},X("CLIENT_ROLE_OPTIONS"))),this.role=t}async setClientRole(t,r){if(r&&(this._clientRoleOptions=Object.assign({},r)),X("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},X("CLIENT_ROLE_OPTIONS")),k.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(X("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=t);let a,o=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(a=this._clientRoleOptions.delay,o=1):o=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:o=0;const u=Object.assign({},r);delete u.delay,delete u.level,await this.signal.request(ht.SET_CLIENT_ROLE,wi(wi({role:t,level:o,delay:a},u),{},{client_ts:Date.now()})),this.role=t}async setRemoteVideoStreamType(t,r){await this.signal.request(ht.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:r})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(ht.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,r){await this.signal.request(ht.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:r})}async pickSVCLayer(t,r){await this.signal.request(ht.PICK_SVC_LAYER,{stream_id:t,spatial_layer:r.spatialLayer,temporal_layer:r.temporalLayer})}async setRTM2Flag(t){await this.signal.request(ht.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,r,a){if(this.store.useP2P)return this.signal.sendExtensionMessage(t,r,a)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),wi({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(ht.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=cP.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=(function(r){let a;return a=r.startsWith("dc")?r.match(/(dc\:\/\/)?([^:]+):(\d+)/):r.match(/(wss\:\/\/)?([^:]+):(\d+)/),a?{username:ti.username,password:ti.password,turnServerURL:a[2],tcpport:parseInt(a[3])+30,udpport:parseInt(a[3])+30,forceturn:!1}:null})((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(wi(wi({},ti),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const t=await this.signal.request(ht.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach((r=>{const a=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find((o=>o.peer_uid===r.peer_uid));a&&a.B_st!==r.B_st&&NC((()=>{this.emit(Dr.STREAM_TYPE_CHANGE,r.peer_uid,r.B_st)}))})),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){var r,a;if(!this.joinInfo||!this.key)throw new fe(q.UNEXPECTED_ERROR,"can not generate join message, no join info");const o=Object.assign({},this.joinInfo.apResponse);let u=X("REPORT_APP_SCENARIO");if(typeof u!="string")try{u=JSON.stringify(u)}catch{u=void 0}var h;u&&u.length>128&&(u=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(Dr.UPDATE_GATEWAY_CONFIG),h=this.store.clientId,je(X_).call(X_,h)||X_.push(h);const m=TD(this.store),g=!((r=this.isPreallocation)===null||r===void 0||!r.call(this)),y=V5(this.store),E=wce(),A=N_(87)||qB()||$1(117),O=((function(){const B=Lt();if(B.name!==Gt.SAFARI||!B.browserVersion)return!1;const U=B.browserVersion.split(".");return Number(U[0])>18||Number(U[0])===18&&Number(U[1])>=4})()||ZB(18,4,!1))&&Z1(18,6,!0)&&this.spec.codec==="h264"&&X("ENABLE_ABSSENDTIME_AS_SENTTS"),N=wi({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Fs,browser:navigator.userAgent,process_id:X("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:o,extend:X("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:u,attributes:{userAttributes:wi(wi({enableEncodedTransform:(!!X("ENABLE_AUDIO_METADATA")||!!X("ENABLE_AUDIO_PTS"))&&A||!!X("ENABLE_AUDIO_TOPN")&&X1(Gt.CHROME,87,116)||void 0,enableAudioMetadata:!!X("ENABLE_AUDIO_METADATA")&&A,enableAudioPts:!!X("ENABLE_AUDIO_PTS")&&A,topnSmoothLevel:X("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:X("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:X("TOPN_SWITCH_HOLD_MS"),topnAudioGain:X("TOPN_AUDIO_GAIN"),enablePublishedUserList:X("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:X("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:Cs("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:Cs("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:Cs("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:X("USE_PUB_RTX")===!0||X("USE_SUB_RTX")===!0||void 0,disableFEC:X("DISABLE_FEC"),enableNTPReport:!!X("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:y,enableFulllinkAvSync:!!X("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Cs("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!X("FORCE_ENABLE_AUT_CC")||!UC()&&(!!X("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!X("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Cs("USE_XR","boolean"),enableLossbasedBwe:Cs("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!X("FORCE_ENABLE_AUT_CC")||!UC()&&(!!X("ENABLE_AUT_CC")||void 0),enableCCFallback:Cs("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:g,preSubNum:m?Cs("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Cs("PUBLISH_TWCC","boolean"),enableSubTWCC:Cs("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Cs("USE_PUB_RTX","boolean"),enableSubRTX:Cs("USE_SUB_RTX","boolean"),enableSubSVC:X("ENABLE_SVC")?X("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(X("SVC"))&&X("SVC").length!==0?X("SVC"):void 0,enableSvcExtended:X("ENABLE_SVC")&&Array.isArray(X("SVC_EXTENDED"))&&X("SVC_EXTENDED").length!==0?X("SVC_EXTENDED"):void 0},E),{},{audioDuplicate:Cs("ENABLE_AUDIO_RED","boolean")?(a=Cs("AUDIO_DUPLICATE_NUM","number"))!==null&&a!==void 0?a:2:void 0,senttsUsesAbsSendTime:!!O||void 0})},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(N.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(N.aes_mode=this.joinInfo.aesmode,X("ENCRYPT_AES")?(N.aes_secret=this.joinInfo.aespassword,N.aes_encrypt=!0):N.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(N.aes_salt=this.joinInfo.aessalt)),o.addresses[this.signal.websocket.currentURLIndex]&&(N.ap_response.ticket=o.addresses[this.signal.websocket.currentURLIndex].ticket,delete o.addresses),this.joinInfo.defaultVideoStream!==void 0&&(N.default_video_stream=this.joinInfo.defaultVideoStream),N}getRejoinMessage(){if(!this.joinInfo)throw new fe(q.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(pt.WS_RECONNECT_CREATE_CONNECTION,(t=>{this.joinGatewayStartTime=Date.now()})),this.signal.on(pt.WS_RECONNECTING,(t=>{this.joinInfo&&nt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||Qr.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",nt.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())})),this.signal.on(pt.WS_CLOSED,(t=>{let r;switch(t){case $t.LEAVE:r=Qr.LEAVE;break;case $t.UID_BANNED:case $t.IP_BANNED:case $t.CHANNEL_BANNED:case $t.SERVER_ERROR:r=Qr.SERVER_ERROR;break;case $t.FALLBACK:r=Qr.FALLBACK;break;case $t.LICENSE_MISSING:case $t.LICENSE_EXPIRED:case $t.LICENSE_MINUTES_EXCEEDED:case $t.LICENSE_PERIOD_INVALID:case $t.LICENSE_MULTIPLE_SDK_SERVICE:case $t.LICENSE_ILLEGAL:case $t.TOKEN_EXPIRE:r=t;break;default:r=Qr.NETWORK_ERROR}k.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(r||"undefined -> "+Qr.NETWORK_ERROR)),this.joinInfo&&nt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===$t.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r}),this._disconnectedReason=t,t!==$t.FALLBACK&&(this.state="DISCONNECTED"),this.reset()})),this.signal.on(pt.WS_CONNECTED,(()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const t=X("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;t&&(t.level||t.delay)&&(k.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(t.level,", delay: ").concat(t.delay)),this.setClientRole(this.role,t))}if(nt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void k.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));sn("EVENT_REPORT_DOMAIN",t[1]),sn("EVENT_REPORT_BACKUP_DOMAIN",t[1]),sn("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}})),this.signal.on(Dt.ON_UPLINK_STATS,(t=>{this._statsCollector.updateUplinkStats(t)})),this.signal.on(pt.REQUEST_RECOVER,((t,r,a)=>{if(!this.joinInfo)return a(new fe(q.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,ei(this,Dr.REQUEST_NEW_GATEWAY_LIST).then(r).catch(a)})),this.signal.on(pt.REQUEST_JOIN_INFO,(async(t,r,a)=>{var o,u,h;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));const m=Pn((o=this.joinInfo)===null||o===void 0?void 0:o.turnServer);if(X("NEW_TURN_MODE")&&m&&((u=this.joinInfo)===null||u===void 0?void 0:u.cloudProxyServer)==="disabled"){var g;let O=m.servers.map((U=>"turnServerURL"in U&&X("USE_TURN_IP")?wi(wi({},U),{},{turnServerURL:aA(U.turnServerURL)}):U)),N=(g=m.serversFromGateway)===null||g===void 0?void 0:g.map((U=>X("USE_TURN_IP")?wi(wi({},U),{},{turnServerURL:aA(U.turnServerURL)}):U));const B=this.signal.currentURLIndex;O.length>0&&(O=[O[B%O.length]],m.servers=O),Array.isArray(N)&&N.length>0&&(N=[N[0]],m.serversFromGateway=N),k.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(B))}const{iceParameters:y,dtlsParameters:E,rtpCapabilities:A}=await ei(this,Dr.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:m,cloudProxyServer:(h=this.joinInfo)===null||h===void 0?void 0:h.cloudProxyServer});try{t(this.getJoinMessage({ortc:{iceParameters:y,dtlsParameters:E,rtpCapabilities:A,version:"2"}}))}catch(O){r(O)}})),this.signal.on(pt.REQUEST_REJOIN_INFO,(t=>{t(this.getRejoinMessage())})),this.signal.on(pt.REPORT_JOIN_GATEWAY,((t,r)=>{if(!this.joinInfo)return;let a,o="";var u;t instanceof fe?(a=((u=t.data)===null||u===void 0?void 0:u.desc)||t.code,o=t.message):a=t,nt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:a,errorMsg:o,addr:r,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})})),this.signal.on(pt.IS_P2P_DISCONNECTED,(t=>{t(W0(this,Dr.IS_P2P_DISCONNECTED))})),this.signal.on(pt.DISCONNECT_P2P,(()=>{this.emit(Dr.DISCONNECT_P2P)})),this.signal.on(pt.REQUEST_SUCCESS,(()=>{this._signalTimeout=!1})),this.signal.on(pt.REQUEST_TIMEOUT,(()=>{this._signalTimeout=!0})),this.signal.on(pt.JOIN_RESPONSE,(t=>{const r=this.getCurrentGatewayAddress();this.emit(Dr.JOIN_RESPONSE,t,r)})),this.signal.on(pt.PRE_CONNECT_PC,(async()=>{if(this.joinInfo){var t,r;this.updateTurnConfigFromSignal();const o=this.getCurrentGatewayAddress(),u=Pn((t=this.joinInfo)===null||t===void 0?void 0:t.turnServer);if(X("NEW_TURN_MODE")&&u&&((r=this.joinInfo)===null||r===void 0?void 0:r.cloudProxyServer)==="disabled"){var a;let m=u.servers.map((E=>"turnServerURL"in E&&X("USE_TURN_IP")?wi(wi({},E),{},{turnServerURL:aA(E.turnServerURL)}):E)),g=(a=u.serversFromGateway)===null||a===void 0?void 0:a.map((E=>X("USE_TURN_IP")?wi(wi({},E),{},{turnServerURL:aA(E.turnServerURL)}):E));const y=this.signal.currentURLIndex;m.length>0&&(m=[m[y%m.length]],u.servers=m),Array.isArray(g)&&g.length>0&&(g=[g[0]],u.serversFromGateway=g),k.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(y,",in pre pc"))}const h=X("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(o&&h){const m=w8(o);this.emit(Dr.PRE_CONNECT_PC,{candidates:m,fingerprint:h,turnServer:u})}}})),this.signal.on(pt.RECOVER_NOTIFICATION,(t=>{this.joinInfo&&typeof X("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(X("AP_REQUEST_DETAIL"),";").concat(t))}))}async tryUnsubBeforeResub(t,r){try{await this.signal.request(ht.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[r]},!0)}catch(a){throw k.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),a),a}}async tryUnsubDataChannelBeforeResub(t,r){try{await this.signal.request(ht.UNSUBSCRIBE,{stream_id:r.id},!0)}catch(a){throw k.warning("unsubscribe datachannel warning",a),a}}async tryUnpubBeforeRepub(t,r){try{await this.signal.request(ht.UNPUBLISH,{stream_id:t,ortc:r},!0)}catch(a){throw k.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),a),a}}async tryUnpubDataChannelBeforeRepub(t,r){try{await this.signal.request(ht.UNPUBLISH_DATASTREAM,{channnel_id:r.channelId},!0)}catch(a){throw k.warning("unpublish datastream warning: ",a),a}}async tryMassUnsubBeforeResub(t){const r={users:t.map((a=>({stream_id:a.stream_id,stream_type:a.stream_type})))};try{await this.signal.request(ht.UNSUBSCRIBE_STREAMS,r,!0)}catch(a){throw k.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),a),a}}async muteLocal(t,r){const a={action:t.find((o=>o.stream_type===Qt.Audio))?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:r};try{await this.signal.request(ht.CONTROL,a,!0,!0)}catch(o){throw k.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),o),o}}async unmuteLocal(t,r){const a={action:t.find((o=>o.stream_type===Qt.Audio))?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:r};try{await this.signal.request(ht.CONTROL,a,!0,!0)}catch(o){throw k.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),o),o}}async muteRemote(t,r){const a={action:t===Xe.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:r};try{await this.signal.request(ht.CONTROL,a,!0,!0)}catch(o){throw k.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),o),o}}async unmuteRemote(t,r){const a={action:t===Xe.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:r};try{await this.signal.request(ht.CONTROL,a,!0,!0)}catch(o){throw k.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),o),o}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,r){this.signal.upload(t,r)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const r={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(ht.RESTART_ICE,r,!0)}catch(a){throw k.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),a),a}}reconnect(t,r){this.state==="CONNECTED"&&this.signal.reconnect(t||void 0,r||Qr.P2P_FAILED)}getCurrentGatewayAddress(){var t,r;if(!X("GATEWAY_WSS_ADDRESS"))return X("USE_CANDIDATE_FROM_AP_DETAIL")&&(t=this.joinInfo)!==null&&t!==void 0&&t.apGatewayAddress?(k.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(r=this.joinInfo)!==null&&r!==void 0&&r.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(ht.SET_PARAMETER,{enablePublishAudioFilter:t})}downgradeCodec(t){this.signal.downgradeCodec(t)}}let hA=0,lP=0;function Hc(e,t,r,a){return new Fe(((o,u)=>{t.timeout=t.timeout||X("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!r?(t.data=JSON.stringify(t.data),hA+=Nl(t.data)):r&&(t.data.size?hA+=t.data.size:t.data instanceof FormData?hA+=p5(t.data):hA+=Nl(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,oa.request(t).then((h=>{typeof h.data=="string"?lP+=Nl(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?lP+=h.data.byteLength:lP+=Nl(JSON.stringify(h.data)),a&&o({data:h.data,headers:h.headers}),o(h.data)})).catch((h=>{oa.isCancel(h)?u(new fe(q.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new fe(q.NETWORK_TIMEOUT,h.message)):h.response?u(new fe(q.NETWORK_RESPONSE_ERROR,h.response.status)):u(new fe(q.NETWORK_ERROR,h.message))}))}))}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function t(Te){var Ue=0;return function(){return Ue<Te.length?{done:!1,value:Te[Ue++]}:{done:!0}}}var r=typeof Object.defineProperties=="function"?Object.defineProperty:function(Te,Ue,Je){return Te==Array.prototype||Te==Object.prototype||(Te[Ue]=Je.value),Te},a,o=(function(Te){Te=[typeof globalThis=="object"&&globalThis,Te,typeof window=="object"&&window,typeof self=="object"&&self,typeof c=="object"&&c];for(var Ue=0;Ue<Te.length;++Ue){var Je=Te[Ue];if(Je&&Je.Math==Math)return Je}throw Error("Cannot find global object")})(this);function u(Te,Ue){if(Ue)e:{var Je=o;Te=Te.split(".");for(var Re=0;Re<Te.length-1;Re++){var M=Te[Re];if(!(M in Je))break e;Je=Je[M]}(Ue=Ue(Re=Je[Te=Te[Te.length-1]]))!=Re&&Ue!=null&&r(Je,Te,{configurable:!0,writable:!0,value:Ue})}}function h(Te){return(Te={next:Te})[Symbol.iterator]=function(){return this},Te}function m(Te){var Ue=typeof Symbol<"u"&&Symbol.iterator&&Te[Symbol.iterator];return Ue?Ue.call(Te):{next:t(Te)}}if(u("Symbol",(function(Te){function Ue(M,Q){this.A=M,r(this,"description",{configurable:!0,writable:!0,value:Q})}if(Te)return Te;Ue.prototype.toString=function(){return this.A};var Je="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Re=0;return function M(Q){if(this instanceof M)throw new TypeError("Symbol is not a constructor");return new Ue(Je+(Q||"")+"_"+Re++,Q)}})),u("Symbol.iterator",(function(Te){if(Te)return Te;Te=Symbol("Symbol.iterator");for(var Ue="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Je=0;Je<Ue.length;Je++){var Re=o[Ue[Je]];typeof Re=="function"&&typeof Re.prototype[Te]!="function"&&r(Re.prototype,Te,{configurable:!0,writable:!0,value:function(){return h(t(this))}})}return Te})),typeof Object.setPrototypeOf=="function")a=Object.setPrototypeOf;else{var g;e:{var y={};try{y.__proto__={a:!0},g=y.a;break e}catch{}g=!1}a=g?function(Te,Ue){if(Te.__proto__=Ue,Te.__proto__!==Ue)throw new TypeError(Te+" is not extensible");return Te}:null}var E=a;function A(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function O(Te){if(Te.m)throw new TypeError("Generator is already running");Te.m=!0}function N(Te,Ue){return Te.h=3,{value:Ue}}function B(Te){this.g=new A,this.G=Te}function U(Te,Ue,Je,Re){try{var M=Ue.call(Te.g.j,Je);if(!(M instanceof Object))throw new TypeError("Iterator result "+M+" is not an object");if(!M.done)return Te.g.m=!1,M;var Q=M.value}catch(re){return Te.g.j=null,Te.g.s(re),V(Te)}return Te.g.j=null,Re.call(Te.g,Q),V(Te)}function V(Te){for(;Te.g.h;)try{var Ue=Te.G(Te.g);if(Ue)return Te.g.m=!1,{value:Ue.value,done:!1}}catch(Je){Te.g.v=void 0,Te.g.s(Je)}if(Te.g.m=!1,Te.g.l){if(Ue=Te.g.l,Te.g.l=null,Ue.F)throw Ue.D;return{value:Ue.return,done:!0}}return{value:void 0,done:!0}}function K(Te){this.next=function(Ue){return Te.o(Ue)},this.throw=function(Ue){return Te.s(Ue)},this.return=function(Ue){return(function(Je,Re){O(Je.g);var M=Je.g.j;return M?U(Je,"return"in M?M.return:function(Q){return{value:Q,done:!0}},Re,Je.g.return):(Je.g.return(Re),V(Je))})(Te,Ue)},this[Symbol.iterator]=function(){return this}}function z(Te,Ue){return Ue=new K(new B(Ue)),E&&Te.prototype&&E(Ue,Te.prototype),Ue}if(A.prototype.o=function(Te){this.v=Te},A.prototype.s=function(Te){this.l={D:Te,F:!0},this.h=this.C||this.u},A.prototype.return=function(Te){this.l={return:Te},this.h=this.u},B.prototype.o=function(Te){return O(this.g),this.g.j?U(this,this.g.j.next,Te,this.g.o):(this.g.o(Te),V(this))},B.prototype.s=function(Te){return O(this.g),this.g.j?U(this,this.g.j.throw,Te,this.g.o):(this.g.s(Te),V(this))},u("Array.prototype.entries",(function(Te){return Te||function(){return(function(Ue,Je){Ue instanceof String&&(Ue+="");var Re=0,M=!1,Q={next:function(){if(!M&&Re<Ue.length){var re=Re++;return{value:Je(re,Ue[re]),done:!1}}return M=!0,{done:!0,value:void 0}}};return Q[Symbol.iterator]=function(){return Q},Q})(this,(function(Ue,Je){return[Ue,Je]}))}})),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var J=function(Te,Ue){for(var Je=0;Je<Te.length;Je++)Ue(Te[Je])},ae=function(Te){return Te.replace(/\r?\n|\r/g,`\r
`)},ie=function(Te,Ue,Je){return Ue instanceof Blob?(Je=Je!==void 0?Je+"":typeof Ue.name=="string"?Ue.name:"blob",Ue.name===Je&&Object.prototype.toString.call(Ue)!=="[object Blob]"||(Ue=new File([Ue],Je)),[String(Te),Ue]):[String(Te),String(Ue)]},ee=function(Te,Ue){if(Te.length<Ue)throw new TypeError(Ue+" argument required, but only "+Te.length+" present.")},le=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,ye=le.FormData,we=le.XMLHttpRequest&&le.XMLHttpRequest.prototype.send,Ne=le.Request&&le.fetch,bt=le.navigator&&le.navigator.sendBeacon,Rt=le.Element&&le.Element.prototype,ft=le.Symbol&&Symbol.toStringTag;ft&&(Blob.prototype[ft]||(Blob.prototype[ft]="Blob"),"File"in le&&!File.prototype[ft]&&(File.prototype[ft]="File"));try{new File([],"")}catch{le.File=function(Ue,Je,Re){return Ue=new Blob(Ue,Re||{}),Object.defineProperties(Ue,{name:{value:Je},lastModified:{value:+(Re&&Re.lastModified!==void 0?new Date(Re.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),ft&&Object.defineProperty(Ue,ft,{value:"File"}),Ue}}var Xt=function(Te){return Te.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Wt=function(Te){this.i=[];var Ue=this;Te&&J(Te.elements,(function(Je){if(Je.name&&!Je.disabled&&Je.type!=="submit"&&Je.type!=="button"&&!Je.matches("form fieldset[disabled] *"))if(Je.type==="file"){var Re=Je.files&&Je.files.length?Je.files:[new File([],"",{type:"application/octet-stream"})];J(Re,(function(M){Ue.append(Je.name,M)}))}else Je.type==="select-multiple"||Je.type==="select-one"?J(Je.options,(function(M){!M.disabled&&M.selected&&Ue.append(Je.name,M.value)})):Je.type==="checkbox"||Je.type==="radio"?Je.checked&&Ue.append(Je.name,Je.value):(Re=Je.type==="textarea"?ae(Je.value):Je.value,Ue.append(Je.name,Re))}))};if((e=Wt.prototype).append=function(Te,Ue,Je){ee(arguments,2),this.i.push(ie(Te,Ue,Je))},e.delete=function(Te){ee(arguments,1);var Ue=[];Te=String(Te),J(this.i,(function(Je){Je[0]!==Te&&Ue.push(Je)})),this.i=Ue},e.entries=function Te(){var Ue,Je=this;return z(Te,(function(Re){if(Re.h==1&&(Ue=0),Re.h!=3)return Ue<Je.i.length?Re=N(Re,Je.i[Ue]):(Re.h=0,Re=void 0),Re;Ue++,Re.h=2}))},e.forEach=function(Te,Ue){ee(arguments,1);for(var Je=m(this),Re=Je.next();!Re.done;Re=Je.next()){var M=m(Re.value);Re=M.next().value,M=M.next().value,Te.call(Ue,M,Re,this)}},e.get=function(Te){ee(arguments,1);var Ue=this.i;Te=String(Te);for(var Je=0;Je<Ue.length;Je++)if(Ue[Je][0]===Te)return Ue[Je][1];return null},e.getAll=function(Te){ee(arguments,1);var Ue=[];return Te=String(Te),J(this.i,(function(Je){Je[0]===Te&&Ue.push(Je[1])})),Ue},e.has=function(Te){ee(arguments,1),Te=String(Te);for(var Ue=0;Ue<this.i.length;Ue++)if(this.i[Ue][0]===Te)return!0;return!1},e.keys=function Te(){var Ue,Je,Re,M,Q=this;return z(Te,(function(re){if(re.h==1&&(Ue=m(Q),Je=Ue.next()),re.h!=3)return Je.done?void(re.h=0):(Re=Je.value,M=m(Re),N(re,M.next().value));Je=Ue.next(),re.h=2}))},e.set=function(Te,Ue,Je){ee(arguments,2),Te=String(Te);var Re=[],M=ie(Te,Ue,Je),Q=!0;J(this.i,(function(re){re[0]===Te?Q&&(Q=!Re.push(M)):Re.push(re)})),Q&&Re.push(M),this.i=Re},e.values=function Te(){var Ue,Je,Re,M,Q=this;return z(Te,(function(re){if(re.h==1&&(Ue=m(Q),Je=Ue.next()),re.h!=3)return Je.done?void(re.h=0):(Re=Je.value,(M=m(Re)).next(),N(re,M.next().value));Je=Ue.next(),re.h=2}))},Wt.prototype._asNative=function(){for(var Te=new ye,Ue=m(this),Je=Ue.next();!Je.done;Je=Ue.next()){var Re=m(Je.value);Je=Re.next().value,Re=Re.next().value,Te.append(Je,Re)}return Te},Wt.prototype._blob=function(){var Te="----formdata-polyfill-"+Math.random(),Ue=[],Je="--"+Te+`\r
Content-Disposition: form-data; name="`;return this.forEach((function(Re,M){return typeof Re=="string"?Ue.push(Je+Xt(ae(M))+`"\r
\r
`+ae(Re)+`\r
`):Ue.push(Je+Xt(ae(M))+'"; filename="'+Xt(Re.name)+`"\r
Content-Type: `+(Re.type||"application/octet-stream")+`\r
\r
`,Re,`\r
`)})),Ue.push("--"+Te+"--"),new Blob(Ue,{type:"multipart/form-data; boundary="+Te})},Wt.prototype[Symbol.iterator]=function(){return this.entries()},Wt.prototype.toString=function(){return"[object FormData]"},Rt&&!Rt.matches&&(Rt.matches=Rt.matchesSelector||Rt.mozMatchesSelector||Rt.msMatchesSelector||Rt.oMatchesSelector||Rt.webkitMatchesSelector||function(Te){for(var Ue=(Te=(this.document||this.ownerDocument).querySelectorAll(Te)).length;0<=--Ue&&Te.item(Ue)!==this;);return-1<Ue}),ft&&(Wt.prototype[ft]="FormData"),we){var hi=le.XMLHttpRequest.prototype.setRequestHeader;le.XMLHttpRequest.prototype.setRequestHeader=function(Te,Ue){hi.call(this,Te,Ue),Te.toLowerCase()==="content-type"&&(this.B=!0)},le.XMLHttpRequest.prototype.send=function(Te){Te instanceof Wt?(Te=Te._blob(),this.B||this.setRequestHeader("Content-Type",Te.type),we.call(this,Te)):we.call(this,Te)}}Ne&&(le.fetch=function(Te,Ue){return Ue&&Ue.body&&Ue.body instanceof Wt&&(Ue.body=Ue.body._blob()),Ne.call(this,Te,Ue)}),bt&&(le.navigator.sendBeacon=function(Te,Ue){return Ue instanceof Wt&&(Ue=Ue._asNative()),bt.call(this,Te,Ue)}),le.FormData=Wt}})();const oS=()=>{const e=X("AREAS");return e.length===0&&e.push(Kt.GLOBAL),vi(e).call(e,((t,r,a)=>{const o=U8(r);return o?a===0?o:"".concat(t,",").concat(o):t}),"")},U8=e=>e===Kt.OVERSEA?"".concat(li.ASIA,",").concat(li.EUROPE,",").concat(li.AFRICA,",").concat(li.NORTH_AMERICA,",").concat(li.SOUTH_AMERICA,",").concat(li.OCEANIA):li[e],Cce=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map((r=>{const a=rA[r],o=Object.keys(a);o&&o.map((u=>{u!=="CODE"&&(t[u]=t[u].concat(a[u]))}))})),t},fA={GLOBAL:{ASIA:[Kt.CHINA,Kt.JAPAN,Kt.INDIA,Kt.KOREA,Kt.HKMC],EUROPE:[],NORTH_AMERICA:[Kt.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},pA=Object.keys(fA[Kt.GLOBAL]),uP=[Kt.CHINA,Kt.NORTH_AMERICA,Kt.EUROPE,Kt.ASIA,Kt.JAPAN,Kt.INDIA,Kt.OCEANIA,Kt.SOUTH_AMERICA,Kt.AFRICA,Kt.KOREA,Kt.HKMC,Kt.US],Ace=function(e,t){let r=[];if(je(e).call(e,Kt.GLOBAL)){const u=[Kt.GLOBAL,Kt.OVERSEA],h=Object.keys(rA);if(t===Kt.GLOBAL)throw new fe(q.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===Kt.CHINA)r=[Kt.OVERSEA];else if(o=t,je(pA).call(pA,o)){const m=(a=t,fA[Kt.GLOBAL][a]||[]),g=[...u,t,...m];r=h.filter((y=>!je(g).call(g,y)))}else if((function(m){let g=!1;return pA.forEach((y=>{var E;je(E=fA[Kt.GLOBAL][y]).call(E,m)&&(g=!0)})),g})(t)){const m=(function(y){let E;return pA.forEach((A=>{var O;je(O=fA[Kt.GLOBAL][A]).call(O,y)&&(E=A)})),E})(t),g=[...u,m,t];r=h.filter((y=>!je(g).call(g,y)))}else r=e;r=(function(m){const g=[];return uP.forEach((y=>{je(m).call(m,y)&&g.push(y)})),g.concat(m.filter((y=>!je(uP).call(uP,y))))})(r)}else r=e;var a,o;return r};function j8(e){var t,r;if(!e&&je(t=X("AREAS")).call(t,Kt.EXTENSIONS))return k.debug("update area from ap : reset"),void dP(Loe,!0);if(!je(r=X("AREAS")).call(r,Kt.GLOBAL)||!e)return;let a=rA.EXTENSIONS;a&&(a={CODE:U8(Kt.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},k.debug("update area from ap success: ".concat(e,",config is "),a),sn("AREAS",[Kt.EXTENSIONS],!0),Object.keys(a).map((o=>{o==="LOG_UPLOAD_SERVER"||o==="EVENT_REPORT_DOMAIN"||o==="EVENT_REPORT_BACKUP_DOMAIN"||o==="PROXY_SERVER_TYPE3"?sn(o,a[o][0]):sn(o,a[o])})))}function dP(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const r=nt.reportApiInvoke(null,{name:Xn.SET_AREA,options:e,tag:Dn.TRACER});try{let a=[];if(typeof e=="string"&&(a=[e]),Array.isArray(e)&&(e.forEach((u=>{if(!je(a8).call(a8,u))throw new fe(q.INVALID_PARAMS,"invalid area code")})),a=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:u,excludedArea:h}=e;if(!u)throw new fe(q.INVALID_PARAMS,"area code is needed");let m=u;typeof u=="string"&&(m=[u]),a=h?Ace(m,h):m}if(!t){if(Vc.AREAS){const u=new fe(q.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return r.onError(u),void k.warning("setArea is prohibited because of config-distribute")}if(je(a).call(a,Kt.GLOBAL)&&X("AREAS")===Kt.EXTENSIONS){const u=new fe(q.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return r.onError(u),void k.warning("setArea is prohibited because of ap extensions")}}sn("AREAS",a,t);const o=Cce(a);Object.keys(o).map((u=>{u==="LOG_UPLOAD_SERVER"||u==="EVENT_REPORT_DOMAIN"||u==="EVENT_REPORT_BACKUP_DOMAIN"||u==="PROXY_SERVER_TYPE3"?sn(u,o[u][0]):sn(u,o[u])})),k.debug("set area success:",a.join(","))}catch(a){throw r.onError(a),a}r.onSuccess()}function V8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),r.push.apply(r,a)}return r}function Ml(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?V8(Object(r),!0).forEach((function(a){H(e,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):V8(Object(r)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))}))}return e}let hP=1;function Oce(e,t,r,a,o){hP+=1;const u={sid:r.sid,command:"convergeAllocateEdge",uid:"666",appId:r.appId,ts:Math.floor(Date.now()/1e3),seq:hP,requestId:hP,version:Fs,cname:r.cname},h={service_name:t,json_body:JSON.stringify(u)};let m,g,y=e[0];return jc((async()=>{m=Date.now();const E=await Hc(y,{data:h,cancelToken:a,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(g=Date.now()-m,E.code!==0){const N=new fe(q.UNEXPECTED_RESPONSE,"live streaming ap error, code"+E.code,{retry:!0,responseTime:g});throw k.error(N.toString()),N}const A=JSON.parse(E.json_body);if(A.code!==200){const N=new fe(q.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(A.code,", reason: ").concat(A.reason),{code:A.code,responseTime:g});throw k.error(N.toString()),N}if(!A.servers||A.servers.length===0){const N=new fe(q.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:A.code,responseTime:g});throw k.error(N.toString()),N}const O=(function(N,B){return{addressList:N.servers.map((U=>"wss://".concat(U.address.replace(/\./g,"-"),".").concat(X("WORKER_DOMAIN"),":").concat(U.wss,"?serviceName=").concat(encodeURIComponent(B)))),workerToken:N.workerToken,vid:N.vid}})(A,t);return X("LIVE_STREAMING_ADDRESS")&&(O.addressList=X("LIVE_STREAMING_ADDRESS")instanceof Array?X("LIVE_STREAMING_ADDRESS"):[X("LIVE_STREAMING_ADDRESS")]),Ml(Ml({},O),{},{responseTime:g})}),((E,A)=>(nt.apworkerEvent(r.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(E.addressList),firstSuccess:A===0,responseTime:g,serverIp:e[A%e.length]}),!1)),((E,A)=>(nt.apworkerEvent(r.sid,{success:!1,sc:E.data&&E.data.code||200,serviceName:t,responseTime:g,serverIp:e[A%e.length]}),!!(E.code!==q.OPERATION_ABORTED&&E.code!==q.UNEXPECTED_RESPONSE||E.data&&E.data.retry)&&(y=e[(A+1)%e.length],!0))),o)}let fP=1;function B8(e,t,r,a){let{url:o,areaCode:u}=e;const{clientId:h,sid:m}=t,g=Date.now();let y;const E=t.role,[A,O]=mP(t,u,[rr.CHOOSE_SERVER]);let N=nr.networkState;return jc((async()=>{N&&nr.networkState===Xa.OFFLINE&&nr.onlineWaiter&&await Fe.race([nr.onlineWaiter,Hr(a&&a.maxRetryTimeout||sr.maxRetryTimeout)]),N=nr.networkState;const{data:B,headers:U}=await Hc(o,{data:A,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);y=U.http3==="1"?1:-1,nt.reportResourceTiming(o,m),G8(B,o,t,g,[rr.CHOOSE_SERVER],y);const V=rS(B,rr.CHOOSE_SERVER);return pP(V),iP(V,o)}),(B=>(B&&nt.joinChooseServer(m,{role:E,lts:g,succ:!0,csAddr:o,opid:O,serverList:B.gatewayAddrs.map((U=>U.address)),ec:null,cid:B.cid.toString(),uid:B.uid.toString(),csIp:B.csIp,unilbsServerIds:[rr.CHOOSE_SERVER].toString(),isHttp3:y,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:B.res.detail&&B.res.detail[38]}),!1)),(B=>B.code!==q.OPERATION_ABORTED&&(B.code===q.CAN_NOT_GET_GATEWAY_SERVER?B.data.retry:(nt.joinChooseServer(m,{role:E,lts:g,succ:!1,csAddr:o,serverList:null,opid:O,ec:B.code,csIp:B.data&&B.data.csIp,unilbsServerIds:[rr.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:N}),isHttp3:y,corssRegionTagReq:t.apRequestDetail}),k.warning("[".concat(h||"sid-".concat(m.slice(0,6)),"] Choose server network error, retry"),B),!0))),a)}function F8(e,t,r,a){let o,{url:u,areaCode:h,serviceIds:m}=e;const g=Date.now(),y=t.role,[E,A]=mP(t,h,m);let O;return jc((async()=>{O&&nr.networkState===Xa.OFFLINE&&nr.onlineWaiter&&await Fe.race([nr.onlineWaiter,Hr(a&&a.maxRetryTimeout||sr.maxRetryTimeout)]),O=nr.networkState;const{data:N,headers:B}=await Hc(u,{data:E,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);o=B.http3==="1"?1:-1,nt.reportResourceTiming(u,t.sid),G8(N,u,t,g,m,o);const U=rS(N,rr.CHOOSE_SERVER),V=rS(N,t.cloudProxyServer==="proxy5"?rr.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?rr.CLOUD_PROXY:rr.CLOUD_PROXY_FALLBACK),K=performance.getEntriesByName(u),z=K[K.length-1];let J;return z&&(J={name:z.name,protocol:"nextHopProtocol"in z?z.nextHopProtocol:"",dnscost:"domainLookupEnd"in z&&"domainLookupStart"in z&&typeof z.domainLookupEnd=="number"&&typeof z.domainLookupStart=="number"?z.domainLookupEnd-z.domainLookupStart:-1,tcpTlsCost:"connectEnd"in z&&"connectStart"in z&&typeof z.connectEnd=="number"&&typeof z.connectStart=="number"?z.connectEnd-z.connectStart:-1,reqCost:"requestStart"in z&&typeof z.requestStart=="number"&&"responseEnd"in z&&typeof z.responseEnd=="number"?z.responseEnd-z.requestStart:-1,handleCost:"leave_ts"in N&&"enter_ts"in N&&typeof N.leave_ts=="number"&&typeof N.enter_ts=="number"?N.leave_ts-N.enter_ts:-1}),pP(U),{gatewayInfo:iP(U,u),proxyInfo:V,url:u,resourceTimingInfo:J}}),(N=>(N.gatewayInfo&&nt.joinChooseServer(t.sid,{role:y,lts:g,succ:!0,csAddr:u,serverList:N.gatewayInfo.gatewayAddrs.map((B=>B.address)),ec:null,opid:A,cid:N.gatewayInfo.cid.toString(),uid:N.gatewayInfo.uid.toString(),csIp:N.gatewayInfo.csIp,unilbsServerIds:m.toString(),isHttp3:o,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:N.gatewayInfo.res.detail&&N.gatewayInfo.res.detail[38],resourceTimingInfo:N.resourceTimingInfo?JSON.stringify(N.resourceTimingInfo):void 0}),N.proxyInfo&&nt.joinWebProxyAP(t.sid,{lts:g,sucess:1,apServerAddr:u,turnServerAddrList:N.proxyInfo.addresses.map((B=>B.ip)).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:m.toString()}),!1)),(N=>N.code!==q.OPERATION_ABORTED&&(N.code===q.CAN_NOT_GET_GATEWAY_SERVER?N.data.retry:(nt.joinWebProxyAP(t.sid,{lts:g,sucess:0,apServerAddr:u,turnServerAddrList:null,errorCode:N.code,eventType:t.cloudProxyServer,unilbsServerIds:m.toString(),extend:JSON.stringify({networkState:O})}),k.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),N),!0))),a)}const G8=(e,t,r,a,o,u)=>{const{sid:h,clientId:m,cloudProxyServer:g}=r,y=[],E=A=>{A.flag===4096?nt.joinChooseServer(h,{role:r.role,lts:a,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:A.error.message,csIp:A.error.data&&A.error.data.csIp,unilbsServerIds:o.toString(),isHttp3:u,corssRegionTagReq:r.apRequestDetail}):A.flag!==1048576&&A.flag!==4194304&&A.flag!==4194310||nt.joinWebProxyAP(h,{lts:a,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:A.error.code,eventType:g,unilbsServerIds:o.toString()})};if(e.response_body.forEach((A=>{const O=A.buffer.code;if(A.uri===23&&O===0&&!A.buffer.edges_services)if(A.buffer.flag===4194310)k.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),A.buffer.edges_services=[];else{const N={error:new fe(q.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:A.buffer.flag};y.push(N),E(N)}if(O!==0){const N=Q_(O),B={error:new fe(q.CAN_NOT_GET_GATEWAY_SERVER,N.desc,{desc:N.desc,retry:N.retry,csIp:e.detail[502]}),flag:A.buffer.flag};A.buffer.flag===4194310?k.warning(B.error.toString()):y.push(B),E(B)}})),y.length)throw k.warning("[".concat(m||"sid-".concat(h.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(y.map((A=>"flag: ".concat(A.flag,", message: ").concat(A.error.message,", retry: ").concat(A.error.data.retry))).join(" | "))),new fe(q.CAN_NOT_GET_GATEWAY_SERVER,y.map((A=>"flag: ".concat(A.flag,", message: ").concat(A.error.message))).join(" | "),{retry:!!y.find((A=>A.error.data.retry)),csIp:e.detail[502],desc:[...new Set(y.map((A=>{var O;return A==null||(O=A.error)===null||O===void 0||(O=O.data)===null||O===void 0?void 0:O.desc})).filter((A=>!!A)))]})},pP=e=>{var t,r,a,o;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new fe(q.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(X("AP_AREA")&&((a=e.detail)!==null&&a!==void 0&&a[23]&&typeof((o=e.detail)===null||o===void 0?void 0:o[23])=="string"?j8(e.detail[23].toLowerCase()):j8()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((r=e.detail)===null||r===void 0?void 0:r[19])=="string"){const h=e.detail[19],m=h?.split(";");for(let g=0;g<m.length;g++){var u;const y=ki(u=m[g]).call(u);e.addresses[g]&&m&&(e.addresses[g].fingerprint=y)}}if(X("GATEWAY_ADDRESS")&&X("GATEWAY_ADDRESS").length>0){k.debug("assign gateway address to",X("GATEWAY_ADDRESS"));const h=X("GATEWAY_ADDRESS").map((m=>{var g,y;const E=(g=(y=e.addresses.find((A=>A.ip===m.ip&&A.port===m.port)))===null||y===void 0?void 0:y.fingerprint)!==null&&g!==void 0?g:"";return{ip:m.ip,port:m.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:E}}));e.addresses=h}},Ice=(e,t)=>{if(e.response_body&&e.response_body.length){const r=e.response_body[0];if(r.buffer.code!==0){const a=Q_(r.buffer.code);throw new fe(q.UPDATE_TICKET_FAILED,"[".concat(r.buffer.code,"]: ").concat(a.desc),{retry:a.retry})}return r.buffer.ticket}throw k.debug("update ticket request received ap response without response body:",t),new fe(q.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},mP=(e,t,r)=>{const a=Math.floor(Math.random()*1e12),o=e.role==="host"?"1":e.role==="audience"?"2":void 0,u={appid:e.appId,client_ts:Date.now(),opid:a,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:Ml(Ml(Ml({6:e.stringUid,11:t,12:X("USE_NEW_TOKEN")?"1":void 0},o?{17:o}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:r,uid:e.uid||0}}]};u.request_bodies.forEach((m=>{e.multiIP&&e.multiIP.gateway_ip&&(m.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))}));const h=new FormData;return h.append("request",JSON.stringify(u)),[h,a]},Nce=(e,t)=>{const r=Math.floor(Math.random()*1e12),a={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map((u=>({ip:u.ip,port:u.port})))}}]},o=new FormData;return o.append("request",JSON.stringify(a)),[o,r]};let rv=0;function iv(e){return Fe.all(e.map((t=>t.then((r=>{throw r}),(r=>r))))).then((t=>{throw t}),(t=>t))}const cS=async e=>{let{fragementLength:t,referenceList:r,asyncMapHandler:a,allFailedhandler:o,promisesCollector:u}=e,h=0;const m=t;let g,y=0;const E=async()=>{const A=(()=>{const O=h*m,N=O+m;return r.slice(O,N).map(a)})();u&&u.push(...A);try{g=await iv(A)}catch(O){if(y+=m,h++,!(y>=r.length))return void await E();o(O)}A.forEach((O=>O.cancel()))};return await E(),g},H8=async e=>{let{referenceList:t,asyncMapHandler:r,closeFn:a}=e;const o=t.length;let u=0;const h=async()=>{const m=r(t.shift());try{return await m}catch(g){if(u++,u>=o||a!=null&&a(g))throw g;return h()}};return h()};async function xce(){if(typeof VideoDecoder>"u")return!0;let e;const t=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],r=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],a=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],o=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],u=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],h=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new Fe(((g,y)=>{let E;(async function(){e&&e.state!=="closed"||await(async function(){e=new VideoDecoder({output:O=>{O.close(),clearTimeout(E),g(!0)},error:O=>{clearTimeout(E),g(!1)}}),await e.configure({codec:"av01.0.05M.08",width:160,height:90})})();const A=[t,r,a,o,u,h];for(let O=0;O<A.length;O++){const N=new EncodedVideoChunk({type:O==0?"key":"delta",timestamp:33333*O,duration:33333,data:new Uint8Array(A[O])});try{await e.decode(N)}catch{return void g(!1)}}})(),E=setTimeout((()=>{g(!1)}),5e3)}))}async function gP(e,t,r,a){return{gatewayInfo:await(async function(u,h,m,g){let y=null;const E=[],A=async()=>{const N=X("WEBCS_DOMAIN").slice(0,X("AJAX_REQUEST_CONCURRENT")).map((V=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(V+"/api/v2/transpond/webrtc?v=2"):"https://".concat(V,"/api/v2/transpond/webrtc?v=2"),areaCode:oS()}))),B=g.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:N.map((V=>V.url))}),U=await cS({fragementLength:X("FRAGEMENT_LENGTH"),referenceList:N,asyncMapHandler:V=>(k.debug("[".concat(u.clientId,"] Connect to choose_server:"),V.url),B8(V,u,h,m)),allFailedhandler:V=>{throw g.recordJoinChannelService({endTs:Date.now(),status:"error",errors:V},B),V[0]},promisesCollector:E});return g.recordJoinChannelService({endTs:Date.now(),status:"success"},B),U},O=async()=>{if(await Hr(1e3),y!==null)return y;const N=X("WEBCS_DOMAIN_BACKUP_LIST").map((V=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(V+"/api/v2/transpond/webrtc?v=2"):"https://".concat(V,"/api/v2/transpond/webrtc?v=2"),areaCode:oS()}))),B=g.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:N.map((V=>V.url))}),U=await cS({fragementLength:X("FRAGEMENT_LENGTH"),referenceList:N,asyncMapHandler:V=>(k.debug("[".concat(u.clientId,"] Connect to backup choose_server:"),V.url),B8(V,u,h,m)),allFailedhandler:V=>{throw g.recordJoinChannelService({endTs:Date.now(),status:"error",errors:V},B),V[0]},promisesCollector:E});return g.recordJoinChannelService({endTs:Date.now(),status:"success"},B),U};try{return y=await iv([A(),O()]),E.length&&E.forEach((N=>N.cancel&&typeof N.cancel=="function"&&N.cancel())),y}catch(N){throw N[0]}})(e,t,r,a)}}async function W8(e,t,r,a,o){const u=e.cloudProxyServer;if(u==="disabled"){if(e.useLocalAccessPoint)return await gP(e,t,r,o);if(X("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:O,proxyInfo:N}=await Y8(e,t,r,o);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:O};const B=N.map((U=>({turnServerURL:U.address,tcpport:U.tcpport||ti.tcpport,udpport:U.udpport||ti.udpport,username:U.username||ti.username,password:U.password||ti.password,forceturn:!1,security:!0})));if(o.useP2P){var h;const U=(h=e.uid)!==null&&h!==void 0?h:O.uid,V="glb:".concat(U.toString()),K=await aD(V),z=N.map((J=>({turnServerURL:J.address,tcpport:J.tcpport||ti.tcpport,udpport:J.udpport||ti.udpport,username:V,password:K,forceturn:!1,security:!0})));B.push(...z)}return e.turnServer={mode:"manual",servers:B},{gatewayInfo:O}}return await gP(e,t,r,o)}const{proxyInfo:m,gatewayInfo:g}=await Y8(e,t,r,o),y={gatewayInfo:g},E=m.map((O=>({turnServerURL:O.address,tcpport:u==="proxy3"?void 0:O.tcpport?O.tcpport:ti.tcpport,udpport:u==="proxy4"?void 0:O.udpport?O.udpport:ti.udpport,username:O.username||ti.username,password:O.password||ti.password,forceturn:u!=="proxy4",security:u==="proxy5"})));if(o.useP2P){var A;const O=(A=e.uid)!==null&&A!==void 0?A:g.uid,N="glb:".concat(O.toString()),B=await aD(N),U=m.map((V=>({turnServerURL:V.address,tcpport:u==="proxy3"?void 0:V.tcpport||ti.tcpport,udpport:u==="proxy4"?void 0:V.udpport||ti.udpport,username:N,password:B,forceturn:u!=="proxy4",security:u==="proxy5"})));E.push(...U)}return e.turnServer={mode:"manual",servers:E},k.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(u)),y}async function z8(e,t,r,a,o){const u=X("ACCOUNT_REGISTER").slice(0,X("AJAX_REQUEST_CONCURRENT"));let h=[];h=t.proxyServer?u.map((g=>"https://".concat(t.proxyServer,"/ap/?url=").concat(g+"/api/v1"))):u.map((g=>"https://".concat(g,"/api/v1")));const m=o?.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const g=await(async function(y,E,A,O,N){const B=Date.now(),U={sid:A.sid,opid:10,appid:A.appId,string_uid:E};let V=y[0];const K=await jc((()=>Hc(V+"".concat(V.indexOf("?")===-1?"?":"&","action=stringuid"),{data:U,cancelToken:O,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}})),((z,J)=>{if(z.code===0){if(z.uid<=0||z.uid>=Math.pow(2,32))throw k.error("Invalid Uint Uid ".concat(E," => ").concat(z.uid),z),nt.reqUserAccount(U.sid,{lts:B,success:!1,serverAddr:V,stringUid:U.string_uid,uid:z.uid,errorCode:q.INVALID_UINT_UID_FROM_STRING_UID,extend:U}),new fe(q.INVALID_UINT_UID_FROM_STRING_UID);return nt.reqUserAccount(U.sid,{lts:B,success:!0,serverAddr:V,stringUid:U.string_uid,uid:z.uid,errorCode:null,extend:U}),!1}const ae=Q_(z.code);return ae.retry&&(V=y[(J+1)%y.length]),nt.reqUserAccount(U.sid,{lts:B,success:!1,serverAddr:V,stringUid:U.string_uid,uid:z.uid,errorCode:ae.desc,extend:U}),ae.retry}),((z,J)=>z.code!==q.OPERATION_ABORTED&&(nt.reqUserAccount(U.sid,{lts:B,success:!1,serverAddr:V,stringUid:U.string_uid,uid:null,errorCode:z.code,extend:U}),V=y[(J+1)%y.length],!0)),N);if(K.code!==0){const z=Q_(K.code);throw new fe(q.UNEXPECTED_RESPONSE,z.desc)}return K})(h,e,t,r,a);return o?.recordJoinChannelService({status:"success",endTs:Date.now()},m),g.uid}catch(g){throw o?.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[g]},m),g}}async function Dce(e,t,r){const a=X("ACCOUNT_REGISTER");let o=[];o=t.proxyServer?a.map((u=>"https://".concat(t.proxyServer,"/ap/?url=").concat(u+"/api/v1"))):a.map((u=>"https://".concat(u,"/api/v1")));try{return await H8({referenceList:o,asyncMapHandler:h=>(async function(m,g,y,E){const A=Date.now(),O={sid:y.sid,opid:10,appid:y.appId,string_uid:g};try{const N=await Hc(m+"".concat(m.indexOf("?")===-1?"?":"&","action=stringuid"),{data:O,cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(N.code!==0){const B=Q_(N.code);throw new fe(q.UNEXPECTED_RESPONSE,"preload sua error:".concat(B.desc),B)}if(N.uid<=0||N.uid>=Math.pow(2,32))throw new fe(q.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:A,url:m,req:O,uid:N.uid,elapse:Date.now()-A}}catch(N){throw N}})(h,e,t,r),closeFn:h=>h.code===q.OPERATION_ABORTED||h.code===q.UNEXPECTED_RESPONSE&&!h.data.retry})}catch(u){throw u}}async function Pce(e,t,r){const a=X("CDS_AP").slice(0,X("AJAX_REQUEST_CONCURRENT")).map((g=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(g+"/api/v1"):"https://".concat(g,"/api/v1?action=config"))),o=a.map((g=>(function(y,E,A,O){const N=Lt(),B={flag:64,cipher_method:0,features:Ml(Ml(Ml(Ml(Ml({install_id:gD(),device:N.name,system:N.os,system_general:navigator.userAgent,vendor:E.appId,version:Fs,cname:E.cname,session_id:E.sid,proxyServer:E.proxyServer,sdk_type:Tce.WEB_RTC,browser_name:N.name,browser_version:N.version,user_agent:navigator.userAgent,channel_name:E.cname},E.stringUid&&{string_uid:E.stringUid}),E.uid&&{uid:E.uid+""}),N.os&&{os_name:N.os}),N.osVersion&&{os_version:N.osVersion}),{},{detail:""})};return jc((()=>Hc(y,{data:B,timeout:1e3,cancelToken:A,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}})),void 0,(U=>U.code!==q.OPERATION_ABORTED),O)})(g,e,t,r)));let u=null,h=null,m={};try{u=await iv(o)}catch(g){if(g.code===q.OPERATION_ABORTED)throw g;h=g}if(o.forEach((g=>g.cancel())),nt.reportApiInvoke(e.sid,{name:Xn.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:u}}).onSuccess(),u&&u.test_tags)try{m=(function(g){if(!g.test_tags)return{};const y=g.test_tags,E=Object.keys(y),A={};return E.forEach((O=>{var N;const B=ki(N=O.slice(4)).call(N),U=JSON.parse(y[O]),V=U[1];A[B]={tag:U[0]||"",value:V}})),A})(u)}catch{}return m}async function K8(e,t){const r=X("WEBCS_DOMAIN").concat(X("WEBCS_DOMAIN_BACKUP_LIST")).map((a=>({url:"https://".concat(a,"/api/v2/transpond/webrtc?v=2"),areaCode:oS(),serviceIds:[rr.CHOOSE_SERVER,rr.CLOUD_PROXY_FALLBACK]})));try{return await H8({referenceList:r,asyncMapHandler:o=>(async function(u,h,m){let g,{url:y,areaCode:E,serviceIds:A}=u;const O=Date.now(),[N,B]=mP(h,E,A);let U=nr.networkState;try{U&&nr.networkState===Xa.OFFLINE&&nr.onlineWaiter&&await Fe.race([nr.onlineWaiter,Hr(sr.maxRetryTimeout)]),U=nr.networkState;const{data:V,headers:K}=await Hc(y,{data:N,cancelToken:m,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);g=K.http3==="1"?1:-1,(ie=>{const ee=[];if(ie.response_body.forEach((le=>{const ye=le.buffer.code;if(le.uri===23&&ye===0&&!le.buffer.edges_services)if(le.buffer.flag===4194310)le.buffer.edges_services=[];else{const we={error:new fe(q.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:ie.detail[502]}),flag:le.buffer.flag};ee.push(we)}if(ye!==0){const we=Q_(ye),Ne={error:new fe(q.CAN_NOT_GET_GATEWAY_SERVER,we.desc,{desc:we.desc,retry:we.retry,csIp:ie.detail[502]}),flag:le.buffer.flag};le.buffer.flag===4194310?k.warning(Ne.error.toString()):ee.push(Ne)}})),ee.length)throw new fe(q.CAN_NOT_GET_GATEWAY_SERVER,ee.map((le=>"flag: ".concat(le.flag,", message: ").concat(le.error.message))).join(" | "),{retry:!!ee.find((le=>le.error.data.retry)),csIp:ie.detail[502],desc:[...new Set(ee.map((le=>{var ye;return le==null||(ye=le.error)===null||ye===void 0||(ye=ye.data)===null||ye===void 0?void 0:ye.desc})).filter((le=>!!le)))]})})(V);const J=rS(V,rr.CHOOSE_SERVER),ae=rS(V,rr.CLOUD_PROXY_FALLBACK);return pP(J),{gatewayInfo:iP(J,y),proxyInfo:ae,opid:B,requestTime:O,url:y,isHttp3:g,elapse:Date.now()-O}}catch(V){throw V}})(o,e,t),closeFn:o=>o.code===q.OPERATION_ABORTED||o.code===q.CAN_NOT_GET_GATEWAY_SERVER&&!o.data.retry})}catch(a){throw a}}async function Y8(e,t,r,a){const o=X("PROXY_SERVER_TYPE3"),u=(N,B,U)=>{let V=U||o;return Array.isArray(V)&&(V=B%2==0&&o[1]||o[0]),"https://".concat(V,"/ap/?url=").concat(N)};let h=null;const m=[],g=async()=>{const N=X("WEBCS_DOMAIN").slice(0,X("AJAX_REQUEST_CONCURRENT")).map(((V,K)=>{let z;return z=e.cloudProxyServer==="disabled"&&e.proxyServer?u("".concat(V,"/api/v2/transpond/webrtc?v=2"),K,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(V,"/api/v2/transpond/webrtc?v=2"):u("".concat(V,"/api/v2/transpond/webrtc?v=2"),K),{url:z,areaCode:oS(),serviceIds:[rr.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?rr.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?rr.CLOUD_PROXY:rr.CLOUD_PROXY_FALLBACK]}})),B=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:N.map((V=>V.url))}),U=await cS({fragementLength:X("FRAGEMENT_LENGTH"),referenceList:N,asyncMapHandler:V=>(k.debug("[".concat(e.clientId,"] Connect to choose_server:"),V.url),F8(V,e,t,r)),allFailedhandler:V=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:V},B),V[0]},promisesCollector:m});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},B),U},y=async()=>{if(await Hr(1e3),h!==null)return h;const N=X("WEBCS_DOMAIN_BACKUP_LIST").map(((V,K)=>{let z;return z=e.cloudProxyServer==="disabled"&&e.proxyServer?u("".concat(V,"/api/v2/transpond/webrtc?v=2"),K,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(V,"/api/v2/transpond/webrtc?v=2"):u("".concat(V,"/api/v2/transpond/webrtc?v=2"),K),{url:z,areaCode:oS(),serviceIds:[rr.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?rr.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?rr.CLOUD_PROXY:rr.CLOUD_PROXY_FALLBACK]}})),B=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:N.map((V=>V.url))}),U=await cS({fragementLength:X("FRAGEMENT_LENGTH"),referenceList:N,asyncMapHandler:V=>(k.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),V.url),F8(V,e,t,r)),allFailedhandler:V=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:V},B),V[0]},promisesCollector:m});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},B),U};let E,A,O;try{({gatewayInfo:E,proxyInfo:A,url:O}=await iv([g(),y()]))}catch(N){throw N[0]}if(m.length&&m.forEach((N=>N.cancel&&typeof N.cancel=="function"&&N.cancel())),!E||!A)throw new fe(q.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=O,e.cloudProxyServer!=="disabled"&&Array.isArray(o)&&O){const N=/^https?:\/\/(.+?)(\/.*)?$/.exec(O)[1];je(o).call(o,N)&&(e.proxyServer=N,k.setProxyServer(N),nt.setProxyServer(N))}return h={gatewayInfo:E,proxyInfo:await _8(A,E.uid)},h}async function kce(e,t,r){const a=X("UAP_AP").slice(0,X("AJAX_REQUEST_CONCURRENT")).map((u=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(u+"/api/v1?action=uap"):"https://".concat(u,"/api/v1?action=uap"))),o=a.map((u=>(function(h,m,g,y){const E={command:"convergeAllocateEdge",sid:m.sid,appId:m.appId,token:m.token,ts:Date.now(),version:Fs,cname:m.cname,uid:m.uid.toString(),requestId:fP,seq:fP};fP+=1;const A={service_name:"tele_channel",json_body:JSON.stringify(E)};return jc((async()=>{const O=await Hc(h,{data:A,cancelToken:g,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(O.code!==0){const B=new fe(q.UNEXPECTED_RESPONSE,"cross channel ap error, code"+O.code,{retry:!0});throw k.error(B.toString()),B}const N=JSON.parse(O.json_body);if(N.code!==200){const B=new fe(q.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(N.code,", reason: ").concat(N.reason));throw k.error(B.toString()),B}if(!N.servers||N.servers.length===0){const B=new fe(q.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw k.error(B.toString()),B}return{vid:N.vid,workerToken:N.workerToken,addressList:(X("CHANNEL_MEDIA_RELAY_SERVERS")||N.servers).map((B=>"wss://".concat(B.address.replace(/\./g,"-"),".").concat(X("WORKER_DOMAIN"),":").concat(B.wss)))}}),void 0,(O=>!!(O.code!==q.OPERATION_ABORTED&&O.code!==q.UNEXPECTED_RESPONSE||O.data&&O.data.retry)),y)})(u,e,t,r)));try{const u=await iv(o);return o.forEach((h=>h.cancel())),u}catch(u){throw u[0]}}async function Lce(e,t,r){let a=null;const o=[],u=async h=>{const m=X(h?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map((g=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(g+"/api/v2/transpond/webrtc?v=2"):"https://".concat(g,"/api/v2/transpond/webrtc?v=2")));return h&&(await Hr(1e3),a!==null)?a:await cS({fragementLength:X("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:g=>(k.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(h?"backup":""," choose_server:"),g),(function(y,E,A,O){const[N]=Nce(E,[rr.CHOOSE_SERVER]);let B=nr.networkState;return jc((async()=>{B&&nr.networkState===Xa.OFFLINE&&nr.onlineWaiter&&await Fe.race([nr.onlineWaiter,Hr(O&&O.maxRetryTimeout||sr.maxRetryTimeout)]),B=nr.networkState;const U=await Hc(y,{data:N,cancelToken:A,headers:{"Content-Type":"multipart/form-data;"}},!0);return Ice(U,y)}),(()=>!1),(U=>U.code!==q.OPERATION_ABORTED&&(U.code===q.UPDATE_TICKET_FAILED?U.data.retry:(k.warning("[".concat(E.clientId,"] update ticket network error, retry"),U),!0))),O)})(g,e,t,r)),allFailedhandler:g=>{throw g[0]},promisesCollector:o})};try{return a=await iv([u(!1),u(!0)]),o.length&&o.forEach((h=>h.cancel&&typeof h.cancel=="function"&&h.cancel())),a}catch(h){throw h[0]}}function q8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),r.push.apply(r,a)}return r}function _P(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?q8(Object(r),!0).forEach((function(a){H(e,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):q8(Object(r)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))}))}return e}class Mce extends Mn{get isSuccess(){return!!this.configs}constructor(t,r){super(),H(this,"configs",void 0),H(this,"store",void 0),H(this,"joinInfo",void 0),H(this,"cancelToken",void 0),H(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),H(this,"interval",void 0),H(this,"mutex",void 0),H(this,"mutableParamsRead",!1),H(this,"configCache",{}),H(this,"limit_bitrate",void 0),this.mutex=new oi("config-distribute",t),this.store=r}startGetConfigDistribute(t,r){this.joinInfo=t,this.cancelToken=r,this.interval&&this.stopGetConfigDistribute(),X("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval((()=>{this.updateConfigDistribute()}),X("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,nt.reportApiInvoke(null,{options:void 0,name:Xn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Dn.TRACER}).onSuccess(JSON.stringify(Vc))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void k.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const r=await this.mutex.lock();try{t=await Pce(this.joinInfo,this.cancelToken,this.retryConfig),k.debug("[config-distribute] get config distribute",JSON.stringify(t));const a=(function(o){var u;const h=_(u=Object.keys(o).filter((y=>/^webrtc_ng_global_parameter/.test(y)))).call(u);for(let y=0;y<h.length;y++)for(let E=h.length-1;E>y;E--){const A=h[E],O=o[A].value;if(typeof O.__priority=="number"){const N=O.__priority,B=h[E-1],U=o[B].value;if(typeof U.__priority=="number"){if(!(N>U.__priority))continue;{const V=A;h[E]=h[E-1],h[E-1]=V}}else{const V=A;h[E]=h[E-1],h[E-1]=V}}}const m=Date.now();let g={};return h.forEach((y=>{const E=o[y].value.__expires;E&&E<=m||(g[y]=o[y])})),g})(t);this.cacheGlobalParameterConfig(a),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=a}catch(a){const o=new fe(q.NETWORK_RESPONSE_ERROR,a);k.warning("[config-distribute] ".concat(o.toString()))}finally{r()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(t){s8(t)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==t.id&&this.emit(eS.UPDATE_BITRATE_LIMIT,t):this.emit(eS.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.limit_bitrate&&_P({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(t){try{const r={},a=Object.keys(t),o=[];a.forEach((u=>{const h=t[u].value;r[u]=h;const m=h.__id;if(m&&this.configCache[u]&&this.configCache[u].__id===m)return;const g=h.__type,y=t[u].value,E=t[u].tag;let A=0;g?g===N5.REALTIME&&(A=1):Object.keys(y).some((O=>Object.prototype.hasOwnProperty.call(ED,O)||!YD()&&Object.prototype.hasOwnProperty.call(LC,O)?(A=1,!0):void 0)),o.push({tag:E,isApplied:A,feature:u,params:JSON.stringify(h)})})),o.forEach((u=>{let{tag:h,feature:m,params:g,isApplied:y}=u;this.store.sessionId&&nt.abTest(this.store.sessionId,{intSucc:1,isApplied:y,tag:h,feature:m,params:g,cid:this.store.cid,uid:this.store.intUid})})),this.configCache=r}catch(r){k.debug("handleABTestConfigDistribute error",r)}}cacheGlobalParameterConfig(t){const r=(function(o){const u={};return Object.keys(o).forEach((h=>{const m=o[h].value,g=m.__expires,y=m.__type;Object.keys(m).forEach((E=>{E==="__id"||E==="__type"||E==="__priority"||E==="__expires"||Object.prototype.hasOwnProperty.call(u,E)||(u[E]=_P(_P({value:m[E]},g&&{expires:g}),y&&{type:y}))}))})),u})(t);try{var a;const o=(a=r.LIMIT_BITRATE)===null||a===void 0?void 0:a.value;delete r.LIMIT_BITRATE,o&&s8(o)&&this.handleBitrateLimit(o),this.limit_bitrate=o,this.handleGlobalParameterConfig(r),this.handleABTestConfigDistribute(t),(function(m){try{const g=Date.now();Object.keys(m).forEach((y=>{const{value:E,type:A,expires:O}=m[y];O&&O<=g||((A===N5.REALTIME||Object.prototype.hasOwnProperty.call(ED,y))&&(Vc[y]=E,In[y]=E,k.debug("Update realtime parameters from config distribute",y,E)),A||YD()||!Object.prototype.hasOwnProperty.call(LC,y)||(Vc[y]=E,In[y]=E,k.debug("Update gateway parameters from config distribute",y,E)))}))}catch(g){k.error("Error update config immediately: ".concat(m),g.message)}})(r);const u=JSON.stringify(r),h=window.btoa(u);window.localStorage.setItem("websdk_ng_global_parameter",h),k.debug("Caching global parameters ".concat(u))}catch(o){k.error("Error caching global parameters:",o.message)}}handleGlobalParameterConfig(t){try{const r=Date.now();Object.keys(t).forEach((a=>{if(a==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(In,a)){const{value:o,expires:u}=t[a];if(u&&u<=r)return;(function(h,m){try{return typeof h=="object"&&typeof m=="object"&&JSON.stringify(h)===JSON.stringify(m)}catch{return!1}})(In[a],o)||(Vc[a]=o,In[a]=o,this.emit(eS.UPDATE_CLIENT_ROLE_OPTIONS,o),k.debug("Updating client role options: ".concat(JSON.stringify(o))))}}))}catch(r){k.error("Error handling global parameter config:",r.message)}}}class Uce extends Mn{constructor(){super(...arguments),H(this,"resultStorage",new Map)}setLocalAudioStats(t,r,a){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(a,r)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(a,r))}setLocalVideoStats(t,r,a){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(a,r)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(a,r)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(a)),!r.muted&&this.record("VIDEO_ENCODE_FAILED",t,this.checResolutionSent(a))}setRemoteAudioStats(t,r){const a=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",a,this.checkAudioOutputLevel(r))}setRemoteVideoStats(t,r){const a=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",a,this.checkVideoDecode(r))}record(t,r,a){if(X("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const o=this.resultStorage.get(t);if(!o)return;o.result.push(a);const u=t==="VIDEO_ENCODE_FAILED"?X("ENCODE_EXCEPTION_TIMES"):5;if(o.result.length>=u){var h;const m=je(h=o.result).call(h,!0);o.isPrevNormal&&!m&&this.emit("exception",vP[t],t,r),!o.isPrevNormal&&m&&this.emit("exception",vP[t]+2e3,t+"_RECOVER",r),o.isPrevNormal=m,o.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,r){return r instanceof dr&&!r.isActive||!!r.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,r){let a=null;r._encoderConfig&&r._encoderConfig.frameRate&&(a=Ja(r._encoderConfig.frameRate));const o=t.captureFrameRate;return!a||!o||!(a>10&&o<5||a<10&&a>=5&&o<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checResolutionSent(t){var r;return!(!t.codecType||je(r=X("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(r,t.codecType.toLocaleLowerCase()))||!t.captureFrameRate||t.sendFrameRate!==0||t.sendResolutionWidth!==0||t.sendResolutionHeight!==0}checkSendVideoBitrate(t,r){return!!r.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,r){return r instanceof dr&&!r.isActive||!!r.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const vP={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},di=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const r=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(r.length>0){const a=r[r.length-1];return Math.round(performance.now()-a.startTime)}return 0}measureFromPublishStart(e,t){const r=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(r.length>0){const a=r[r.length-1];return Math.round(performance.now()-a.startTime)}return 0}};function X8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),r.push.apply(r,a)}return r}function Fp(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?X8(Object(r),!0).forEach((function(a){H(e,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):X8(Object(r)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))}))}return e}class lS{constructor(t){H(this,"store",void 0),H(this,"onStatsException",void 0),H(this,"onUploadPublishDuration",void 0),H(this,"onStatsChanged",void 0),H(this,"onVideoCodecChanged",void 0),H(this,"localStats",new Map),H(this,"remoteStats",new Map),H(this,"updateStatsInterval",void 0),H(this,"trafficStats",void 0),H(this,"trafficStatsPeerList",[]),H(this,"uplinkStats",void 0),H(this,"exceptionMonitor",void 0),H(this,"p2pChannel",void 0),H(this,"scalabilityMode",kC.L1T1),H(this,"updateStats",(()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))})),this.store=t,this.exceptionMonitor=new Uce,this.exceptionMonitor.on("exception",((r,a,o)=>{this.onStatsException&&this.onStatsException(r,a,o)}))}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Ie.LocalAudioTrack)||Fp({},CD)}getLocalVideoTrackStats(){return this.localStats.get(Ie.LocalVideoTrack)||Fp({},AD)}getRemoteAudioTrackStats(t){const r=(u,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find((g=>g.peer_uid===u));return m&&(h.publishDuration=m.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},a={};if(t){var o;const u=(o=this.remoteStats.get(t))===null||o===void 0?void 0:o.audioStats;u&&(a[t]=r(t,u))}else Array.from(this.remoteStats.entries()).forEach((u=>{let[h,{audioStats:m}]=u;m&&(a[h]=r(h,m))}));return a}getRemoteNetworkQualityStats(t){const r={};if(t){var a;const o=(a=this.remoteStats.get(t))===null||a===void 0?void 0:a.networkStats;o&&(r[t]=o)}else Array.from(this.remoteStats.entries()).forEach((o=>{let[u,{networkStats:h}]=o;h&&(r[u]=h)}));return r}getRemoteVideoTrackStats(t){const r=(u,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find((g=>g.peer_uid===u));return m&&(h.publishDuration=m.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},a={};if(t){var o;const u=(o=this.remoteStats.get(t))===null||o===void 0?void 0:o.videoStats;u&&(a[t]=r(t,u))}else Array.from(this.remoteStats.entries()).forEach((u=>{let[h,{videoStats:m}]=u;m&&(a[h]=r(h,m))}));return a}getRTCStats(){let t=0,r=0,a=0,o=0;const u=this.localStats.get(Ie.LocalAudioTrack);u&&(t+=u.sendBytes,r+=u.sendBitrate);const h=this.localStats.get(Ie.LocalVideoTrack);h&&(t+=h.sendBytes,r+=h.sendBitrate);const m=this.localStats.get(Ie.LocalVideoLowTrack);m&&(t+=m.sendBytes,r+=m.sendBitrate),this.remoteStats.forEach((y=>{let{audioStats:E,videoStats:A}=y;E&&(a+=E.receiveBytes,o+=E.receiveBitrate),A&&(a+=A.receiveBytes,o+=A.receiveBitrate)}));let g=1;return this.trafficStats&&(g+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:g,SendBitrate:r,SendBytes:t,RecvBytes:a,RecvBitrate:o,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter((r=>r.B_ppad!==void 0||r.B_ppvd!==void 0)),t.peer_delay.filter((r=>this.trafficStatsPeerList.indexOf(r.peer_uid)===-1)).forEach((r=>{var a;const o=(a=this.p2pChannel)===null||a===void 0?void 0:a.getRemoteMedia(r.peer_uid),u=o!=null&&o.videoSSRC?di.measureFromSubscribeStart(this.store.clientId,o.videoSSRC):0,h=o!=null&&o.audioSSRC?di.measureFromSubscribeStart(this.store.clientId,o.audioSSRC):0;r.B_ppad!==void 0&&r.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(r.peer_uid,r.B_ppad,r.B_ppvd,u>h?u:h),this.trafficStatsPeerList.push(r.peer_uid))})),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&k.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,r,a){if(!t)return!1;const o=!!a&&r.framesDecodeFreezeTime>a.framesDecodeFreezeTime,u=!a||r.framesDecodeCount>a.framesDecodeCount;return o||!u}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach((r=>{let[a,o]=r;switch(a){case Ie.LocalVideoTrack:case Ie.LocalVideoLowTrack:{const m=o,g=Fp({},AD),y=t.getStats(),E=t.getLocalMedia(a);if(y){const A=y.videoSend.find((O=>O.ssrc===E?.ssrcs[0].ssrcId));if(A){const O=t.getLocalVideoSize(),N=t.getEncoderConfig(Ie.LocalVideoTrack);var u;(A.codec==="H264"||A.codec==="H265"||A.codec==="VP8"||A.codec==="VP9"||A.codec==="AV1X"||A.codec==="AV1")&&(g.codecType=A.codec,m?.codecType!==A.codec&&((u=this.onVideoCodecChanged)===null||u===void 0||u.call(this,A.codec.toLocaleLowerCase()))),g.sendBytes=A.bytes,g.sendBitrate=m?8*Math.max(0,g.sendBytes-m.sendBytes):0,A.inputFrame?(g.captureFrameRate=A.inputFrame.frameRate,g.captureResolutionHeight=A.inputFrame.height,g.captureResolutionWidth=A.inputFrame.width):O&&(g.captureResolutionWidth=O.width,g.captureResolutionHeight=O.height),A.sentFrame?(g.sendFrameRate=A.sentFrame.frameRate,g.sendResolutionHeight=A.sentFrame.height,g.sendResolutionWidth=A.sentFrame.width):O&&(g.sendResolutionWidth=O.width,g.sendResolutionHeight=O.height),A.avgEncodeMs&&(g.encodeDelay=A.avgEncodeMs),N&&N.bitrateMax?g.targetSendBitrate=1e3*N.bitrateMax:A.targetBitrate&&(g.targetSendBitrate=A.targetBitrate),g.sendPackets=A.packets,g.sendPacketsLost=A.packetsLost,g.sendJitterMs=A.jitterMs,g.sendRttMs=A.rttMs,g.totalDuration=m?m.totalDuration+1:1,g.totalFreezeTime=m?m.totalFreezeTime:0,this.isLocalVideoFreeze(A)&&(g.totalFreezeTime+=1),A.scalabilityMode&&this.scalabilityMode!==A.scalabilityMode&&(k.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(A.scalabilityMode)),this.scalabilityMode=A.scalabilityMode)}this.trafficStats&&(g.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var h;this.localStats.set(a,g),(m?.sendResolutionWidth!==g.sendResolutionWidth||m?.sendResolutionHeight!==g.sendResolutionHeight)&&((h=this.onStatsChanged)===null||h===void 0||h.call(this,"resolution",{width:g.sendResolutionWidth,height:g.sendResolutionHeight})),g&&E&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,E.track,g);break}case Ie.LocalAudioTrack:{const m=o,g=Fp({},CD),y=t.getStats(),E=t.getLocalMedia(a);if(y){const A=y.audioSend.find((O=>O.ssrc===E?.ssrcs[0].ssrcId));if(A){if(A.codec!=="opus"&&A.codec!=="aac"&&A.codec!=="PCMU"&&A.codec!=="PCMA"&&A.codec!=="G722"||(g.codecType=A.codec),A.inputLevel)g.sendVolumeLevel=Math.round(32767*A.inputLevel);else{const O=t.getLocalAudioVolume();O&&(g.sendVolumeLevel=Math.round(32767*O))}g.sendBytes=A.bytes,g.sendPackets=A.packets,g.sendPacketsLost=A.packetsLost,g.sendJitterMs=A.jitterMs,g.sendRttMs=A.rttMs,g.sendBitrate=m?8*Math.max(0,g.sendBytes-m.sendBytes):0}}this.trafficStats&&(g.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Ie.LocalAudioTrack,g),g&&E&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,E.track,g);break}}}))}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach((r=>{var a,o;let[u,{videoStats:h,audioStats:m,videoPcStats:g}]=r;const y=m,E=h,A=g,O=Fp({},F5),N=Fp({},G5),B=Fp({},Eoe),{audioTrack:U,videoTrack:V,audioSSRC:K,videoSSRC:z}=t.getRemoteMedia(u);let J;J=this.store.useP2P?t.getStats(!0):t.getStats();const ae=(a=J)===null||a===void 0?void 0:a.audioRecv.find((ye=>ye.ssrc===K)),ie=(o=J)===null||o===void 0?void 0:o.videoRecv.find((ye=>ye.ssrc===z)),ee=this.trafficStats&&this.trafficStats.peer_delay.find((ye=>ye.peer_uid===u));if(ae&&(ae.codec!=="opus"&&ae.codec!=="aac"&&ae.codec!=="PCMU"&&ae.codec!=="PCMA"&&ae.codec!=="G722"||(O.codecType=ae.codec),ae.outputLevel?O.receiveLevel=Math.round(32767*ae.outputLevel):U&&(O.receiveLevel=Math.round(32767*U.getVolumeLevel())),O.receiveBytes=ae.bytes,O.receivePackets=ae.packets,O.receivePacketsLost=ae.packetsLost,O.receivePacketsDiscarded=ae.packetsDiscarded,O.packetLossRate=O.receivePacketsLost/(O.receivePackets+O.receivePacketsLost),O.receiveBitrate=y?8*Math.max(0,O.receiveBytes-y.receiveBytes):0,O.totalDuration=y?y.totalDuration+1:1,O.totalFreezeTime=y?y.totalFreezeTime:0,O.freezeRate=O.totalFreezeTime/O.totalDuration,O.receiveDelay=ae.jitterBufferMs,O.totalDuration>10&&lS.isRemoteAudioFreeze(U)&&(O.totalFreezeTime+=1)),ie){var le;ie.codec!=="H264"&&ie.codec!=="H265"&&ie.codec!=="VP8"&&ie.codec!=="VP9"&&ie.codec!=="AV1X"&&ie.codec!=="AV1"||(N.codecType=ie.codec),N.receiveBytes=ie.bytes,N.receiveBitrate=E?8*Math.max(0,N.receiveBytes-E.receiveBytes):0,N.decodeFrameRate=ie.decodeFrameRate<0?0:ie.decodeFrameRate,N.renderFrameRate=ie.decodeFrameRate<0?0:ie.decodeFrameRate,ie.outputFrame&&(N.renderFrameRate=ie.outputFrame.frameRate),ie.receivedFrame?(N.receiveFrameRate=ie.receivedFrame.frameRate,N.receiveResolutionHeight=ie.receivedFrame.height,N.receiveResolutionWidth=ie.receivedFrame.width):V&&(N.receiveResolutionHeight=V._videoHeight||0,N.receiveResolutionWidth=V._videoWidth||0),ie.framesRateFirefox!==void 0&&(N.receiveFrameRate=Math.round(ie.framesRateFirefox)),N.receivePackets=ie.packets,N.receivePacketsLost=ie.packetsLost,N.packetLossRate=N.receivePacketsLost/(N.receivePackets+N.receivePacketsLost);const ye=E?E.totalFreezeTime:0,we=E?E.totalDuration:0;N.totalDuration=E?E.totalDuration+1:1,N.totalFreezeTime=(le=ie.totalFreezesDuration)!==null&&le!==void 0?le:ye||0,N.receiveDelay=ie.jitterBufferMs||0;const Ne=!!z&&t.getRemoteVideoIsReady(z);ie.totalFreezesDuration===void 0&&V&&Ne&&lS.isRemoteVideoFreeze(V,ie,A)&&(N.totalFreezeTime+=1),N.freezeRate=Math.max(0,Math.min((N.totalFreezeTime-ye)/(N.totalDuration-we),1))}ee&&(O.end2EndDelay=ee.B_ad,N.end2EndDelay=ee.B_vd,O.transportDelay=ee.B_ed,N.transportDelay=ee.B_ed,O.currentPacketLossRate=ee.B_ealr4/100,N.currentPacketLossRate=ee.B_evlr4/100,B.uplinkNetworkQuality=ee.B_punq?ee.B_punq:0,B.downlinkNetworkQuality=ee.B_pdnq?ee.B_pdnq:0),this.remoteStats.set(u,{audioStats:O,videoStats:N,videoPcStats:ie,networkStats:B}),U&&this.exceptionMonitor.setRemoteAudioStats(U,O),V&&this.exceptionMonitor.setRemoteVideoStats(V,N)}))}}class J8{constructor(){H(this,"destChannelMediaInfos",new Map),H(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){i8(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){i8(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){eA(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function $8(e){if(!(e instanceof J8))return new fe(q.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),r=e.getDestChannelMediaInfo();if(!t)return new fe(q.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(r.size===0)return new fe(q.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Gh{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,r){H(this,"uid",void 0),H(this,"_uintid",void 0),H(this,"_trust_in_room_",!0),H(this,"_trust_audio_enabled_state_",!0),H(this,"_trust_video_enabled_state_",!0),H(this,"_trust_audio_mute_state_",!0),H(this,"_trust_video_mute_state_",!0),H(this,"_audio_muted_",!1),H(this,"_video_muted_",!1),H(this,"_audio_enabled_",!0),H(this,"_video_enabled_",!0),H(this,"_audio_added_",!1),H(this,"_video_added_",!1),H(this,"_is_pre_created",!1),H(this,"_video_pre_subscribed",!1),H(this,"_audio_pre_subscribed",!1),H(this,"_trust_video_stream_added_state_",!0),H(this,"_trust_audio_stream_added_state_",!0),H(this,"_audioTrack",void 0),H(this,"_videoTrack",void 0),H(this,"_dataChannels",[]),H(this,"_audioSSRC",void 0),H(this,"_videoSSRC",void 0),H(this,"_audioOrtc",void 0),H(this,"_videoOrtc",void 0),H(this,"_cname",void 0),H(this,"_rtxSsrcId",void 0),H(this,"_videoMid",void 0),H(this,"_audioMid",void 0),this.uid=t,this._uintid=r}}function Z8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),r.push.apply(r,a)}return r}function yP(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Z8(Object(r),!0).forEach((function(a){H(e,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Z8(Object(r)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))}))}return e}const mA="9",EP=2e4,gA=4e4;function Q8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),r.push.apply(r,a)}return r}function Wu(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Q8(Object(r),!0).forEach((function(a){H(e,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Q8(Object(r)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))}))}return e}var av=(function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e})(av||{});const _A=new Map;function eG(e,t,r,a){let{scale:o}=e;if(o===0&&a===av.UP||o>=t.length-1&&a===av.DOWN)return e;let u=Wu(Wu({},e),{},{scale:a===av.DOWN?++o:--o});switch(r){case"maintain-framerate":u=Wu(Wu({},u),t[o].motion);break;case"maintain-resolution":u=Wu(Wu({},u),t[o].detail);break;case"balanced":u=Wu(Wu({},u),t[o].balanced)}return u}function tG(e,t){if(t){const r={overUse:0,underUse:0,adaptationList:nG(t)};_A.set(e,r)}else _A.delete(e)}function nG(e){const t=Wu({},e),{bitrateMax:r,frameRate:a,scaleResolutionDownBy:o,bitrateMin:u}=t,{MIN_FRAME_RATE:h,MAX_THRESHOLD_FRAMERATE:m,MAX_SCALE:g,BITRATE_MIN_THRESHOLD:y,BITRATE_MAX_THRESHOLD:E,BWE_SCALE_UP_THRESHOLD:A,BWE_SCALE_DOWN_THRESHOLD:O,PERF_SCALE_DOWN_THRESHOLD:N,PERF_SCALE_UP_THRESHOLD:B,BALANCE_BITRATE_FACTOR:U,BALANCE_FRAMERATE_FACTOR:V,BALANCE_RESOLUTION_FACTOR:K,MOTION_RESOLUTION_FACTOR:z,MOTION_BITRATE_FACTOR:J,DETAIL_FRAMERATE_FACTOR:ae,DETAIL_BITRATE_FACTOR:ie}=vD,ee=Math.min(t.frameRate,m),le=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(O,1)*r),bwe_up:r,fps_down:Math.round(Math.pow(N,1)*ee),fps_up:a},balanced:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:r,bitrateMin:u},motion:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:r,bitrateMin:u},detail:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:r,bitrateMin:u}}];for(let ye=1;ye<=g;ye++){const we={bwe_up:Math.round(Math.pow(A,ye)*r),bwe_down:Math.round(Math.pow(O,ye+1)*r),fps_up:Math.round(Math.pow(B,ye)*ee),fps_down:Math.round(Math.pow(N,ye+1)*ee)},Ne={scaleResolutionDownBy:o/Math.pow(K,ye),frameRate:Math.max(Math.round(Math.pow(V,ye)*a),h),bitrateMax:Math.max(Math.round(Math.pow(U,ye)*r),E),bitrateMin:Math.max(Math.round(Math.pow(U,ye)*u),y)},bt={scaleResolutionDownBy:o/Math.pow(z,ye),frameRate:a,bitrateMax:Math.max(Math.round(Math.pow(J,ye)*r),E),bitrateMin:Math.max(Math.round(Math.pow(J,ye)*u),y)},Rt={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(ae,ye)*a),h),bitrateMax:Math.max(Math.round(Math.pow(ie,ye)*r),E),bitrateMin:Math.max(Math.round(Math.pow(ie,ye)*u),y)};le.push({scale:ye,threshold:we,balanced:Ne,motion:bt,detail:Rt})}return le}function jce(e,t,r,a,o,u){const h=_A.get(e)||{overUse:0,underUse:0,adaptationList:nG(o)},{adaptationList:m}=h;_A.set(e,h);const{OVERUSE_TIMES_THRESHOLD:g,UNDERUSE_TIMES_THRESHOLD:y}=vD,{scale:E}=a;let A,O;return typeof t=="number"&&t>0&&(function(N,B,U,V){if(B>=U.length)return!1;let{threshold:{fps_down:K}}=U[B];return X("FORCE_AG_HIGH_FRAMERATE")&&V==="maintain-framerate"&&(K=U[0].threshold.fps_down),N<K})(t,E,m,u)&&(h.overUse++,O=K0.CPU,h.overUse>g)||typeof r=="number"&&r>0&&(function(N,B,U){if(B>=U.length)return!1;const{threshold:{bwe_down:V}}=U[B];return N<V})(r,E,m)&&(h.overUse++,O=K0.BANDWIDTH,h.overUse>g)?(h.overUse=0,h.underUse=0,A=eG(a,m,u,av.DOWN),[A,O]):(typeof t=="number"&&t>0&&typeof r=="number"&&r>0&&(function(N,B,U,V){if(B===0)return;let{threshold:{fps_up:K}}=U[B];return X("FORCE_AG_HIGH_FRAMERATE")&&V==="maintain-framerate"&&(K=U[1].threshold.fps_up),N>K})(t,E,m,u)&&(function(N,B,U){if(B===0)return;const{threshold:{bwe_up:V}}=U[B];return N>V})(r,E,m)&&(h.underUse++,h.underUse>y&&(h.overUse=0,h.underUse=0,A=eG(a,m,u,av.UP),A.scale===0&&(O=K0.NONE))),[A,O])}function rG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),r.push.apply(r,a)}return r}function SP(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?rG(Object(r),!0).forEach((function(a){H(e,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rG(Object(r)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))}))}return e}const vA=new Map;function yA(e,t){const r=vA.get(e);if(r){const{timer:a}=r;window.clearTimeout(a),vA.delete(e)}t.qualityLimitationReason=K0.NONE,tG(e)}function Vce(e,t){var r;let a;switch(t){case Ie.LocalAudioTrack:a=Qt.Audio;break;case Ie.LocalVideoTrack:a=je(r=e._hints).call(r,un.SCREEN_TRACK)?Qt.Screen:Qt.High;break;case Ie.LocalVideoLowTrack:a=Qt.Low}return a}function bP(e){const t=Vt();if(e.some((r=>r._bypassWebAudio)))throw new ve(q.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new ve(q.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function TP(e,t){bP(e);const r=new dr;return e.forEach((a=>r.addAudioTrack(a))),r}const Bce=!Vt().supportUnifiedPlan||X("CHROME_FORCE_PLAN_B")&&ju();function EA(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var r;return Bce?(r={spec:t,store:e},Hu("PlanBConnection").create(r)):new Ks(t,e)}function wP(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function iG(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(H0(e.turnServer.servers))return!1;if(X("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some((t=>t.forceturn)))return!0}return!1}catch{return!1}}var Mt;function aG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),r.push.apply(r,a)}return r}function Wc(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?aG(Object(r),!0).forEach((function(a){H(e,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):aG(Object(r)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))}))}return e}let Ks=(Mt=class tm extends c8{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,r;return(t=(r=this.peerConnection.getReceivers()[0])===null||r===void 0||(r=r.transport)===null||r===void 0?void 0:r.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map((t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"")).filter((t=>{var r;return je(r=Object.keys(q0)).call(r,t)})))]}constructor(t,r){super(t,r),H(this,"id",fn(5,"connection-")),H(this,"store",void 0),H(this,"peerConnection",void 0),H(this,"forceTurn",!1),H(this,"remoteSDP",void 0),H(this,"initialOffer",void 0),H(this,"transportEventReceiver",void 0),H(this,"statsFilter",void 0),H(this,"extension",{useXR:X("USE_XR")}),H(this,"localCapabilities",void 0),H(this,"remoteCodecs",void 0),H(this,"localCandidateCount",0),H(this,"allCandidatesReceived",!1),H(this,"isPreallocation",!1),H(this,"preMediaMap",new Map),H(this,"dataStreamChannelMap",new Map),H(this,"establishPromise",void 0),H(this,"recoveredDataChannelIds",[]),H(this,"currentDataChannelId",1),H(this,"supportAV1RtpSpec",!1),H(this,"mutex",void 0),H(this,"qualityLimitationReason",K0.NONE),H(this,"isFirstConnected",!1),this.store=r,this.forceTurn=iG(t),this.mutex=new oi("P2PConnection-mutex",r.clientId),this.peerConnection=new RTCPeerConnection(tm.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=mD(this.peerConnection,X("STATS_UPDATE_INTERVAL"),void 0,Vn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(t){return this.preMediaMap.get(t)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(t,r){if(this.remoteCodecs=r,!this.remoteSDP)return void k.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(r));if(this.remoteSDP.updateRemoteCodec(t,r,this.store.codec)){const a=await this.peerConnection.createOffer(),o=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a);const u=this.remoteSDP.toString();o?.(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}else k.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const a=await this.peerConnection.createOffer();if(!a.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const o=jh(a.sdp),u=await A8({filterRTX:!X("USE_PUB_RTX")&&!X("USE_SUB_RTX"),filterVideoFec:X("FILTER_VIDEO_FEC"),filterAudioFec:X("FILTER_AUDIO_FEC"),filterVideoCodec:X("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:X("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:X("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=uA(u),this.initialOffer=a,X("ENABLE_SVC")&&this.store.codec=="av1"){const m=await(async function(){try{const g=new RTCPeerConnection;g.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:kC.L1T3}]});const y=await g.createOffer();if(!y.sdp)return void g.close();const E=Ca(y.sdp).mediaDescriptions[0];if(!E)return;const A=E.attributes.extmaps.find((O=>O.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension"));return g.close(),A}catch{return}})();var t;m&&(this.supportAV1RtpSpec=!0,(t=u.send)===null||t===void 0||t.videoExtensions.push(m))}let h;return a.sdp&&x8(a.sdp)&&(h=Pn(u),(r=h).send&&(ev(Xe.VIDEO,r.send.videoExtensions),ev(Xe.AUDIO,r.send.audioExtensions)),r.recv&&(ev(Xe.VIDEO,r.recv.videoExtensions),ev(Xe.AUDIO,r.recv.audioExtensions)),r.sendrecv&&(ev(Xe.VIDEO,r.sendrecv.videoExtensions),ev(Xe.AUDIO,r.sendrecv.audioExtensions))),Wc(Wc({},o),{},{rtpCapabilities:h||u,offerSDP:a.sdp})}catch(a){throw new ve(q.GET_LOCAL_CONNECTION_PARAMS_FAILED,a.toString())}var r}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&x8(this.initialOffer.sdp)&&(r=t.rtpCapabilities,a=this.localCapabilities,r.send&&(oA(Xe.VIDEO,r.send.videoExtensions,a.send.videoExtensions),oA(Xe.AUDIO,r.send.audioExtensions,a.send.audioExtensions)),r.recv&&(oA(Xe.VIDEO,r.recv.videoExtensions,a.recv.videoExtensions),oA(Xe.AUDIO,r.recv.audioExtensions,a.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return Pn(this._localCapabilities)}get rtpCapabilities(){return Pn(this._rtpCapabilities)}get candidates(){return Pn(this._candidates)}get iceParameters(){return Pn(this._iceParameters)}get dtlsParameters(){return Pn(this._dtlsParameters)}constructor(g){let y=arguments.length>1&&arguments[1]!==void 0&&arguments[1],E=arguments.length>2&&arguments[2]!==void 0&&arguments[2];H(this,"sessionDesc",void 0),H(this,"_localCapabilities",void 0),H(this,"_rtpCapabilities",void 0),H(this,"_candidates",void 0),H(this,"_originCandidates",void 0),H(this,"_iceParameters",void 0),H(this,"_isUseExtmapAllowMixed",void 0),H(this,"_isUseLocalCodecs",void 0),H(this,"_dtlsParameters",void 0),H(this,"setup",void 0),H(this,"currentMidIndex",void 0),H(this,"cname",void 0),H(this,"useLocalCodecsMids",[]),H(this,"preloadSsrcs",[]),H(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=y,this._isUseLocalCodecs=E,g=Pn(g);const{iceParameters:A,dtlsParameters:O,candidates:N,rtpCapabilities:B,setup:U,localCapabilities:V,cname:K}=g;this._rtpCapabilities=B,this._candidates=N,this._originCandidates=Pn(N),this._iceParameters=A,this._dtlsParameters=O,this._localCapabilities=V,this.setup=U,this.cname=K,[this.sessionDesc]=this.updateRemoteRTPCapabilities(B),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(g){return g.length===this.preloadSsrcs.length&&g.every((y=>{var E;return je(E=this.preloadSsrcs).call(E,y)}))}preloadRemoteMedia(g){let y=0;const E=[],A=[];for(;g>0;){const O=[yP({ssrcId:gA+y},X("USE_SUB_RTX")?{rtx:gA+y+1}:{})],N="".concat(gA+y,"_").concat(EP+y),{ssrcs:B,ssrcGroups:U}=aS(O,this.cname,X("SYNC_GROUP")?N:void 0),V=this.preCreateOrRecycleSendMedia("video",B,U,void 0),K=[{ssrcId:EP+y}],z="".concat(gA+y,"_").concat(EP+y),{ssrcs:J,ssrcGroups:ae}=aS(K,this.cname,X("SYNC_GROUP")?z:void 0),ie=this.preCreateOrRecycleSendMedia("audio",J,ae,void 0);g--,y+=2,E.push(V,ie),A.push(B[0].ssrcId,J[0].ssrcId)}return this.useLocalCodecsMids.push(...E),this.preloadSsrcs=A,{mids:E,preSSRCs:A,isAvailable:!0}}preCreateOrRecycleSendMedia(g,y,E,A){const O=this.rtpCapabilities.send.videoCodecs,N=this._isUseLocalCodecs||O.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;k.debug("create or recycle send media without remote rtp capabilities, ssrcs ",y[0].ssrcId);const B=g===Xe.VIDEO?N.videoCodecs:N.audioCodecs,U=g===Xe.VIDEO?N.videoExtensions:N.audioExtensions;this.currentMidIndex+=1;const V="".concat(this.currentMidIndex);let K={media:{mediaType:g,port:mA,protos:["UDP","TLS","RTP","SAVPF"],fmts:B.map((z=>z.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:U,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:y,ssrcGroups:E,rtcpFeedbackWildcards:[],payloads:B,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(V)}};return K=this.mungSendMediaDesc(K,A),this.sessionDesc.mediaDescriptions.push(K),this.updateBundleMids(),V}toString(){return Dh(this.sessionDesc)}send(g,y,E,A){const{ssrcs:O,ssrcGroups:N}=aS(y,this.cname,X("SYNC_GROUP")?E:void 0),B=this.findPreloadMediaDesc(O);if(B){if(Vn()&&this.firefoxSsrcMidMap.set(O[0].ssrcId,B.attributes.mid),A&&(A.twcc||A.remb)){const U=this.sessionDesc.mediaDescriptions.indexOf(B);return this.sessionDesc.mediaDescriptions[U]=this.mungSendMediaDesc(B,A),{mid:B.attributes.mid,needExchangeSDP:!0}}return{mid:B.attributes.mid,needExchangeSDP:!1}}{const U=this.findAvailableMediaIndex(g,O);let V;return U===-1||U===1&&(Zr()||(function(){const K=Lt();return!(K.name!==Gt.CHROME||!K.osVersion)&&Number(K.version)<=90})()||X("ENABLE_ENCODED_TRANSFORM")&&Uu())||U===0&&!(function(K){const z=Lt();return!(z.name!==Gt.FIREFOX||!z.osVersion)&&Number(z.version)===K})(138)&&X("USE_SUB_RTX")||e5()?(V=this.createOrRecycleSendMedia(g,O,N,"sendonly",A),this.updateBundleMids()):(V=Pn(this.sessionDesc.mediaDescriptions[U]),V.attributes.direction="sendonly",V.attributes.ssrcs=O,V.attributes.ssrcGroups=N,this.sessionDesc.mediaDescriptions[U]=this.mungSendMediaDesc(V,A)),Vn()&&this.firefoxSsrcMidMap.set(O[0].ssrcId,V.attributes.mid),{mid:V.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:g,needExchangeSDP:y}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:g.attributes.mid,needExchangeSDP:y}}batchSend(g){const y=g.map((O=>{let{kind:N,ssrcMsg:B,mslabel:U}=O;return this.send(N,B,U)})),E=[];let A=!1;return y.forEach((O=>{let{mid:N,needExchangeSDP:B}=O;B&&(A=!0),E.push(N)})),{mids:E,needExchangeSDP:A}}stopSending(g){const y=this.sessionDesc.mediaDescriptions.filter((E=>E.attributes.mid&&g.indexOf(E.attributes.mid)!==-1));if(y.length!==g.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");y.forEach((E=>{E.attributes.mid==="0"||Vn()||e5()?E.attributes.ssrcs=[]:(E.attributes.ssrcs=[],E.attributes.direction="inactive",E.media.port="0")})),this.updateBundleMids()}mute(g){const y=this.sessionDesc.mediaDescriptions.find((E=>E.attributes.mid===g));if(!y)throw new Error("mediaDescription not found with ".concat(g," in remote SDP when calling RemoteSDP.mute."));y.attributes.direction="inactive"}unmute(g){const y=this.sessionDesc.mediaDescriptions.find((E=>E.attributes.mid===g));if(!y)throw new Error("mediaDescription not found with ".concat(g," in remote SDP when calling RemoteSDP.unmute."));y.attributes.direction="sendonly"}muteRemote(g){const y=this.sessionDesc.mediaDescriptions.filter((E=>je(g).call(g,E.attributes.mid||"")));if(y.length!==g.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");y.forEach((E=>{E.attributes.direction="inactive"}))}unmuteRemote(g){const y=this.sessionDesc.mediaDescriptions.filter((E=>je(g).call(g,E.attributes.mid||"")));if(y.length!==g.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");y.forEach((E=>{E.attributes.direction="recvonly"}))}receive(g,y,E,A){g.forEach(((O,N)=>{this.createOrRecycleRecvMedia(O,[],"recvonly",y,E,A[N])})),this.updateBundleMids()}stopReceiving(g){const y=this.sessionDesc.mediaDescriptions.filter((E=>g.indexOf(E.attributes.mid)!==-1));if(y.length!==g.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");y.forEach((E=>{E.media.port="0",E.attributes.direction="inactive"})),this.updateBundleMids()}updateRemoteRTPCapabilities(g){const y=this.sessionDesc||Ca((E=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(E?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var E;this._rtpCapabilities=g;let A=!1;const O=this.rtpCapabilities.send,N=this.localCapabilities.send,B=this.localCapabilities.recv,U=B.videoCodecs,V=B.audioCodecs,K=B.videoExtensions,z=B.audioExtensions;for(const ee of y.mediaDescriptions){var J;if(ee.attributes.direction!=="sendonly"||typeof ee.attributes.mid!="string"||!je(J=this.useLocalCodecsMids).call(J,ee.attributes.mid)){if(A=!0,ee.attributes.iceUfrag=this._iceParameters.iceUfrag,ee.attributes.icePwd=this._iceParameters.icePwd,ee.attributes.fingerprints=this._dtlsParameters.fingerprints,ee.attributes.candidates=this._candidates,ee.attributes.setup=this.setup,ee.media.mediaType==="application"&&(ee.attributes.sctpPort="5000"),ee.media.mediaType==="video")if(this._isUseLocalCodecs&&ee.attributes.direction==="sendonly"){var ae;ee.media.fmts=U.map((ye=>ye.payloadType.toString(10))),ee.attributes.payloads=U,ee.attributes.extmaps=K;const le=ee.attributes.mid;typeof le!="string"||je(ae=this.useLocalCodecsMids).call(ae,le)||this.useLocalCodecsMids.push(le)}else if(O.videoCodecs.length===0){const le=N.videoCodecs.filter((ye=>{var we,Ne;return(we=ye.rtpMap)===null||we===void 0?void 0:je(Ne=we.encodingName.toLowerCase()).call(Ne,"vp8")}))||[N.videoCodecs[0]];ee.media.fmts=le.map((ye=>ye.payloadType.toString(10))),ee.attributes.payloads=le,ee.attributes.extmaps=[]}else ee.media.fmts=O.videoCodecs.map((le=>le.payloadType.toString(10))),ee.attributes.payloads=O.videoCodecs,ee.attributes.extmaps=O.videoExtensions;if(ee.media.mediaType==="audio")if(this._isUseLocalCodecs&&ee.attributes.direction==="sendonly"){var ie;ee.media.fmts=V.map((ye=>ye.payloadType.toString(10))),ee.attributes.payloads=V,ee.attributes.extmaps=z;const le=ee.attributes.mid;typeof le!="string"||je(ie=this.useLocalCodecsMids).call(ie,le)||this.useLocalCodecsMids.push(le)}else if(O.audioCodecs.length===0){const le=N.audioCodecs.filter((ye=>{var we,Ne;return(we=ye.rtpMap)===null||we===void 0?void 0:je(Ne=we.encodingName.toLowerCase()).call(Ne,"opus")}))||[N.audioCodecs[0]];ee.media.fmts=le.map((ye=>ye.payloadType.toString(10))),ee.attributes.payloads=le,ee.attributes.extmaps=[]}else ee.media.fmts=O.audioCodecs.map((le=>le.payloadType.toString(10))),ee.attributes.payloads=O.audioCodecs,ee.attributes.extmaps=O.audioExtensions,nv(ee)}}return this.sessionDesc=y,this.currentMidIndex=y.mediaDescriptions.length-1,[this.sessionDesc,A]}updateCandidates(g){const y=this._originCandidates.filter((A=>A.transport==="udp")),E=[];if(y.forEach((A=>{E.push(yP(yP({},A),{},{foundation:"tcpcandidate",priority:Number(A.priority)-1+"",transport:"tcp",port:Number(A.port)+90+""}))})),y.length!==0){switch(g){case ui.TCP_RELAY:this._candidates=E;break;case ui.UDP_TCP_RELAY:case ui.RELAY:this._candidates=[...y,...E];break;default:this._candidates=y}for(const A of this.sessionDesc.mediaDescriptions)A.attributes.candidates=this.candidates}}restartICE(g){g=Pn(g),this._iceParameters=g,this.sessionDesc.mediaDescriptions.forEach((y=>{y.attributes.iceUfrag=g.iceUfrag,y.attributes.icePwd=g.icePwd}))}predictReceivingMids(g){const y=[];for(let E=0;E<g;E++)y.push((this.currentMidIndex+E+1).toString(10));return y}findAvailableMediaIndex(g,y){return this.sessionDesc.mediaDescriptions.findIndex((E=>{const A=E.media.mediaType===g&&E.media.port!=="0"&&(E.attributes.direction==="sendonly"||E.attributes.direction==="sendrecv")&&E.attributes.ssrcs.length===0;if(Vn()){if(A){const O=this.firefoxSsrcMidMap.get(y[0].ssrcId);return!(O||E.attributes.mid!=="0"&&E.attributes.mid!=="1")||!(!O||O!==E.attributes.mid)}return!1}return A}))}createOrRecycleDataChannel(){for(const E of this.sessionDesc.mediaDescriptions)if(E.media.mediaType==="application")return{mediaDesc:E,needExchangeSDP:!1};this.currentMidIndex+=1;const g="".concat(this.currentMidIndex),y={media:{mediaType:"application",port:mA,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(g),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(y),{mediaDesc:y,needExchangeSDP:!0}}createOrRecycleRecvMedia(g,y,E,A,O,N){const B=g._mediaStreamTrack.kind,U=this.rtpCapabilities.recv,V=sS(B,U,this.localCapabilities.send,B===Xe.VIDEO?A:O),K=B===Xe.VIDEO?U.videoExtensions:U.audioExtensions;this.currentMidIndex+=1;const z="".concat(this.currentMidIndex);let J={media:{mediaType:B,port:mA,protos:["UDP","TLS","RTP","SAVPF"],fmts:V.map((ie=>ie.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:K,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:y,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:V,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:E,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(z)}};J=this.mungRecvMediaDsec(J,g,N);const ae=this.findFirstClosedMedia(B);if(ae){const ie=this.sessionDesc.mediaDescriptions.indexOf(ae);this.sessionDesc.mediaDescriptions[ie]=J}else this.sessionDesc.mediaDescriptions.push(J);return J}updateRemoteDtlsParameters(g){const y=new Set(this._dtlsParameters.fingerprints.map((O=>O.fingerprint))),E=new Set(g.map((O=>O.fingerprint)));let A=!1;y.size!==E.size&&(A=!0);for(const O of y)E.has(O)||(A=!0);return A}updateRemoteCodec(g,y,E){const A=[...new Set(this._rtpCapabilities.recv.videoCodecs.map((J=>J.rtpMap&&J.rtpMap.encodingName.toLowerCase()||"")).filter((J=>{var ae;return je(ae=Object.keys(q0)).call(ae,J)})))],O=new Set(y);if(A.every((J=>O.has(J))))return k.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(y)),!1;const N=this._rtpCapabilities.recv.videoCodecs.filter((J=>y.some((ae=>{var ie;return je(ie=J.rtpMap&&J.rtpMap.encodingName.toLowerCase()||"").call(ie,ae)}))));if(N.length===0)return k.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(A," codecs: ").concat(y)),!1;const B=[...new Set(N.map((J=>J.rtpMap&&J.rtpMap.encodingName.toLowerCase()||"")))];let U;if(k.debug("updateRemoteCodec, from ".concat(A," to ").concat(B)),g.length===0)U=this.sessionDesc.mediaDescriptions.filter((J=>J.media.mediaType==="video"&&J.attributes.direction==="recvonly"));else if(U=this.sessionDesc.mediaDescriptions.filter((J=>J.attributes.mid&&J.media.mediaType==="video"&&je(g).call(g,J.attributes.mid)&&J.attributes.direction==="recvonly")),U.length!==g.length)return k.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(g,", codecs: ").concat(y)),!1;if(X("USE_PUB_RTX")||X("USE_SUB_RTX")){const J=Vh(N,this.rtpCapabilities.recv.videoCodecs);N.push(...J)}this._rtpCapabilities.recv.videoCodecs=N;const V=this.localCapabilities.send,K=this.rtpCapabilities.recv,z=sS(Xe.VIDEO,K,V,E);return U.forEach((J=>{const ae=z.map((ie=>ie.payloadType.toString(10)));k.debug("updateRemoteCodec mid: ".concat(J.attributes.mid,", from"),J.attributes.payloads,"to",z),J.attributes.payloads=z,J.media.fmts=ae})),!0}createOrRecycleSendMedia(g,y,E,A,O){const N=this.rtpCapabilities.send.videoCodecs,B=this._isUseLocalCodecs||N.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,U=g===Xe.VIDEO?B.videoCodecs:B.audioCodecs,V=g===Xe.VIDEO?B.videoExtensions:B.audioExtensions;this.currentMidIndex+=1;const K="".concat(this.currentMidIndex);let z={media:{mediaType:g,port:mA,protos:["UDP","TLS","RTP","SAVPF"],fmts:U.map((ae=>ae.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:V,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:y,ssrcGroups:E,rtcpFeedbackWildcards:[],payloads:U,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:A,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(K)}};z=this.mungSendMediaDesc(z,O);const J=this.findFirstClosedMedia(g);if(J){const ae=this.sessionDesc.mediaDescriptions.indexOf(J);this.sessionDesc.mediaDescriptions[ae]=z}else this.sessionDesc.mediaDescriptions.push(z);return z}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((g=>g.media.port!=="0")).map((g=>g.attributes.mid))}mungRecvMediaDsec(g,y,E){const A=Pn(g);return sP(A),tv(A,y),oP(A,y),R8(A),lA(A,E,this.localCapabilities.send),A}mungSendMediaDesc(g,y){const E=Pn(g);return lA(E,y,this.localCapabilities.recv),nv(E),E}updateRecvMedia(g,y){const E=this.sessionDesc.mediaDescriptions.findIndex((A=>A.attributes.mid===g));if(E!==-1){const A=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[E],y);this.sessionDesc.mediaDescriptions[E]=A}}bumpMid(g){this.currentMidIndex+=g}findFirstClosedMedia(g){return this.sessionDesc.mediaDescriptions.find((y=>Vn()?y.media.port==="0"&&y.media.mediaType===g:y.media.port==="0"))}findPreloadMediaDesc(g){return this.sessionDesc.mediaDescriptions.find((y=>{var E;return((E=y.attributes)===null||E===void 0||(E=E.ssrcs[0])===null||E===void 0?void 0:E.ssrcId)===g[0].ssrcId}))}getSSRC(g){var y;return(y=this.sessionDesc.mediaDescriptions.find((E=>E.attributes.mid===g)))===null||y===void 0?void 0:y.attributes.ssrcs}}(Wc(Wc({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!X("ENABLE_PRE_SUB_WITH_PRE_PC")||!X("PRE_USE_LOCAL_CODECS"))&&TD(this.store)),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const o=this.remoteSDP.toString(),u=I8(this.initialOffer.sdp,this.extension),h=this.logSDPExchange(u||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:u}),h?.(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o});const m=this.peerConnection.getTransceivers()[0];if(m!=null&&m.receiver&&this.tryBindTransportEvents(m.receiver),TD(this.store))if(t.preallocation&&X("ENABLE_PRE_SUB_WITH_PRE_PC")){const g=X("PRE_SUB_NUM"),{mids:y,preSSRCs:E}=this.remoteSDP.preloadRemoteMedia(g);await Bh(this.peerConnection,this.remoteSDP,this.extension),k.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(E)),this.presetMedia(y,E)}else{const{preSSRCs:g=[]}=t,y=g.map((A=>A.ssrcMsg[0].ssrcId));if(g.length===0)return;const{mids:E}=this.remoteSDP.batchSend(g.map((A=>Object.assign({},A))));await Bh(this.peerConnection,this.remoteSDP,this.extension),k.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(y)),this.presetMedia(E,y)}}catch(o){throw new ve(q.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(o.toString()))}var r,a}presetMedia(t,r){t.forEach(((a,o)=>{this.peerConnection.getTransceivers().forEach((u=>{if(u.mid!=null&&a===u.mid&&u.receiver.track){const h=u.receiver.track;let m;h.kind==="video"&&X("ENABLE_PRE_RENDER")&&(m=new MD({trackId:"track-".concat(h.kind,"-unknown-").concat(this.store.clientId,"_").concat(fn(5,""))},!0),m.updateVideoTrack(h),m.onFirstVideoFrameRender=()=>{var g;const y=this.preMediaMap.get(r[o]);y&&(y.firstVideoRender=Date.now()),(g=this.onFirstVideoRender)===null||g===void 0||g.call(this,r[o])},m.play(this.store.sessionId||void 0)),this.preMediaMap.set(r[o],{mid:a,track:h,player:m,transceiver:u})}})),this.store.peerReceiver()}))}checkDtlsParameters(t){return!!this.remoteSDP&&t.length>0&&this.remoteSDP.updateRemoteDtlsParameters(t)}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let r=!1;const{rtpCapabilities:a}=t;if([,r]=this.remoteSDP.updateRemoteRTPCapabilities(a),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const h=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);r=r||h}const{preSSRCs:o=[]}=t,u=o.map((h=>h.ssrcMsg[0].ssrcId));if(!this.remoteSDP.checkPreloadSsrcs(u)){const h=[],m=[];if(Array.from(this.preMediaMap.entries()).every((g=>{let[y,{mid:E,player:A,track:O}]=g;return h.push(E),m.push(y),this.preMediaMap.delete(y),A&&A.destroy(),!0})),h.length>0&&(this.remoteSDP.stopSending(h),await Bh(this.peerConnection,this.remoteSDP,this.extension),k.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(m)),nt.reportApiInvoke(this.store.sessionId,{name:Xn.PRELOAD_MEDIA_FAILED,options:[o,m],tag:Dn.TRACER}).onSuccess()),o.length>0){const{mids:g}=this.remoteSDP.batchSend(o.map((y=>Object.assign({},y))));await Bh(this.peerConnection,this.remoteSDP,this.extension),k.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(u)),this.presetMedia(g,u)}}r?(await Bh(this.peerConnection,this.remoteSDP,this.extension),k.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):k.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(r){throw new ve(q.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(r.toString()))}}send(t,r,a){var o=this;return Bs((function*(){const u=yield jt(o.mutex.lock("From P2PConnection.send"));try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=sA();t.forEach((V=>{const K=o.peerConnection.addTransceiver(V._mediaStreamTrack,Wc({direction:"sendonly"},V.trackMediaType==="video"&&o.supportAV1RtpSpec&&m?{sendEncodings:[{scalabilityMode:m}]}:{}));h.push(K),V._updateRtpTransceiver(K)})),Vn()&&X("SIMULCAST")===!0&&(yield jt(o.applySimulcastForFirefox(h,t)));const g=yield jt(o.peerConnection.createOffer()),y=o.remoteSDP.predictReceivingMids(t.length),E=o.mungSendOfferSDP(g.sdp,t,y),A=Ca(E),O=y.map((V=>{const K=A.mediaDescriptions.find((z=>z.attributes.mid===V));if(!K)throw new Error("Cannot extract ssrc from mediaDescription.");return b8(K,X("USE_PUB_RTX"))}));let N;try{N=yield O}catch(V){N=[],o.remoteSDP.receive(t,r,a,N);const K=o.remoteSDP.toString();throw yield jt(o.peerConnection.setLocalDescription({type:"offer",sdp:E})),yield jt(o.peerConnection.setRemoteDescription({type:"answer",sdp:K})),yield jt(o.stopSending(y,!0)),V}o.remoteSDP.receive(t,r,a,N);const B=o.remoteSDP.toString(),U=o.logSDPExchange(E,"offer","local","send");return yield jt(o.peerConnection.setLocalDescription({type:"offer",sdp:E})),yield jt(o.applySimulcastEncodings(h,t)),yield jt(o.applySendEncodings(h,t)),U?.(B),yield jt(o.peerConnection.setRemoteDescription({type:"answer",sdp:B})),h.map(((V,K)=>{const z=y[K];return{localSSRC:O[K],id:z,transceiver:V}}))}catch(h){throw h instanceof ve?h:new ve(q.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}}))()}async createDataChannels(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let a=this.dataStreamChannelMap.get(t);if(a&&a.readyState==="open")k.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const u=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof u!="number")throw new Error("create DataChannel error, because cannot get dc id");a=this.peerConnection.createDataChannel("datastream-channel",{id:u,negotiated:!0,ordered:!1,maxRetransmits:X("DATASTREAM_MAX_RETRANSMITS")}),a.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,a)}r.forEach((u=>{u._updateOriginDataChannel(a)}));const{needExchangeSDP:o}=this.remoteSDP.sendDataChannel();if(o){const u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),k.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else k.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(a){throw a instanceof ve?a:new ve(q.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(a.toString()))}}async stopDataChannels(t){try{const r=this.dataStreamChannelMap.get(t);return r&&(r.id&&this.recoveredDataChannelIds.push(r.id),r.close()),void this.dataStreamChannelMap.delete(t)}catch(r){throw r instanceof ve?r:new ve(q.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(r.toString()))}}async stopSending(t,r){const a=r?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const o=this.peerConnection.getTransceivers().filter((g=>t.indexOf(g.mid)!==-1));if(o.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");o.map((g=>{var y;yA(this.id+g.mid,this),g.direction="inactive",(y=g.stop)===null||y===void 0||y.call(g)}));const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(t);const m=this.remoteSDP.toString();h?.(m),await this.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(o){throw new ve(q.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(o.toString()))}finally{a&&a()}}async receive(t,r,a,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(t,r,a,o);h&&(await Bh(this.peerConnection,this.remoteSDP,this.extension),k.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));const m=this.peerConnection.getTransceivers().find((g=>g.mid===u));if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:u,transceiver:m}}catch(u){throw new ve(q.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:r,needExchangeSDP:a}=this.remoteSDP.batchSend(t);return a&&(await Bh(this.peerConnection,this.remoteSDP,this.extension),k.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),r.map((o=>{const u=this.peerConnection.getTransceivers().find((h=>h.mid===o));if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:o,transceiver:u}}))}catch(r){throw new ve(q.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(r.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach((u=>{Array.from(this.preMediaMap.entries()).some((h=>{let[m,{mid:g,player:y}]=h;if(g===u)return this.preMediaMap.delete(m),y&&y.destroy(),!0}))})),this.remoteSDP.stopSending(t);const r=this.remoteSDP.toString(),a=this.logSDPExchange(r,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const o=await this.peerConnection.createAnswer();a?.(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(r){throw new ve(q.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const r=this.remoteSDP.toString(),a=this.logSDPExchange(r,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const o=await this.peerConnection.createAnswer();a?.(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(r){throw new ve(q.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(r.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const r=this.remoteSDP.toString(),a=this.logSDPExchange(r,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const o=await this.peerConnection.createAnswer();a?.(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(r){throw new ve(q.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(r.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const r=this.peerConnection.getTransceivers().filter((h=>h.mid&&t.indexOf(h.mid)!==-1));if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map((h=>{h.direction="inactive"}));const a=await this.peerConnection.createOffer(),o=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.muteRemote(t);const u=this.remoteSDP.toString();o?.(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(r){throw new ve(q.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const r=this.peerConnection.getTransceivers().filter((h=>h.mid&&t.indexOf(h.mid)!==-1));if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map((async(h,m)=>{h.direction="sendonly"}));const a=await this.peerConnection.createOffer(),o=this.logSDPExchange(a.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);const u=this.remoteSDP.toString();o?.(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(r){throw new ve(q.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r.toString()))}}restartICE(t){var r=this;return Bs((function*(){const a=yield jt(r.mutex.lock("From P2PConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const o=Vt().supportPCSetConfiguration,u=X("FORCE_TURN_TCP")||r.forceTurn;if(t===ui.RELAY&&!o)return;if(o&&!u){const A=t===ui.RELAY?"relay":"all",O=r.peerConnection.getConfiguration();O.iceTransportPolicy!==A&&(k.debug("[".concat(r.store.clientId,"] restartICE change iceTransportPolicy from [").concat(O.iceTransportPolicy,"] to [").concat(A,"]")),O.iceTransportPolicy=A,r.peerConnection.setConfiguration(O))}r.remoteSDP.updateCandidates(t);const h=yield jt(r.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const m=jh(h.sdp),{remoteIceParameters:g}=yield m.iceParameters;r.remoteSDP.restartICE(g);const y=r.remoteSDP.toString(),E=r.logSDPExchange(h.sdp||"","offer","local","restartICE");r.store.descriptionStart(),yield jt(r.peerConnection.setLocalDescription(h)),E?.(y),yield jt(r.peerConnection.setRemoteDescription({type:"answer",sdp:y}))}catch(o){k.warning("[".concat(r.store.clientId,"] restart ICE failed, abort operation"),o)}finally{a()}}))()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const t=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(ui.TCP_RELAY),await Bh(this.peerConnection,this.remoteSDP,this.extension)}catch(r){k.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),r)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach((r=>{yA(this.id+r.mid,this)})),this.preMediaMap.forEach((r=>{let{player:a}=r;a&&a.destroy()})),this.preMediaMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Wc(Wc({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const a=await this.peerConnection.createOffer(),o=this.mungSendOfferSDP(a.sdp,[r],[t]);this.remoteSDP.updateRecvMedia(t,r);const u=this.remoteSDP.toString(),h=this.logSDPExchange(o,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),h?.(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(a){throw new ve(q.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(t,r){const a=this.peerConnection.getTransceivers().filter((o=>o.mid===t));a.length===1&&(this.isVP8Simulcast(r)?Vn()||await this.applySimulcastEncodings(a,[r]):await this.applySendEncodings(a,[r]))}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){const a=this.peerConnection.getTransceivers().find((o=>o.mid===r));a&&await a.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const r=t[0].transport.iceTransport,{local:a,remote:o}=r.getSelectedCandidatePair();return{local:Wc(Wc({},xl),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port}),remote:Wc(Wc({},xl),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var r;const a="code: ".concat(t.errorCode,", message: ").concat(t.errorText),o=t.port?"local: ".concat(t.port):"",u=Bp(t.url||"");k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(a,"), url: ").concat(u||"",", host_candidate:").concat(o)),(r=this.onICECandidateError)===null||r===void 0||r.call(this,a)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),X("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const r={iceServers:[]},a=t.cloudProxyServer||"disabled";return t.iceServers?r.iceServers=t.iceServers:t.turnServer&&(H0(t.turnServer.servers)?r.iceServers=t.turnServer.servers:X("NEW_TURN_MODE")&&r.iceServers&&a==="disabled"?(X("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&r.iceServers.push(...tm.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):r.iceServers.push(...tm.newTurnServerConfigToIceServers(t.turnServer.servers)),X("NEW_FORCE_TURN")&&(r.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(r.iceServers&&r.iceServers.push(...tm.turnServerConfigToIceServers(t.turnServer.servers)),X("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&t.turnServer.serversFromGateway&&r.iceServers.push(...tm.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),X("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((o=>{o.forceturn&&(r.iceTransportPolicy="relay")})))),X("ENABLE_ENCODED_TRANSFORM")&&Vt().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),r}static turnServerConfigToIceServers(t){const r=[];return t.forEach((a=>{a.security?a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(Mh(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&!X("FORCE_TURN_TCP")&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))})),r}static newTurnServerConfigToIceServers(t){const r=[];return t.forEach((a=>{const o=X("NEW_TURN_MODE");o===1?r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=udp")}):o===2?r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=tcp")}):o===3?r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(Mh(a.turnServerURL),":443?transport=tcp")}):o===4&&(r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=udp")}),r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=tcp")}),r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(Mh(a.turnServerURL),":443?transport=tcp")}))})),r}tryBindTransportEvents(t){const r=t.transport;if(r){this.transportEventReceiver=t,r.onstatechange=()=>{var o;r!=null&&r.state&&((o=this.onDTLSTransportStateChange)===null||o===void 0||o.call(this,r.state))},r.onerror=o=>{var u;(u=this.onDTLSTransportError)===null||u===void 0||u.call(this,"error"in o?o.error:o)};const a=r.iceTransport;a&&(a.onstatechange=()=>{const o=r?.iceTransport.state;var u;o&&((u=this.onICETransportStateChange)===null||u===void 0||u.call(this,o))},a.getSelectedCandidatePair&&(a.onselectedcandidatepairchange=()=>{if(a.getSelectedCandidatePair()){const{local:o,remote:u}=a.getSelectedCandidatePair()||{};if(o&&u){const h=o.address+":"+o.port,m=u.address+":"+u.port;k.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Bp(h)),", remote ").concat(JSON.stringify(Bp(m))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,r){var a,o;if(r||(r=this.peerConnection.getSenders().find((V=>V.track===t._mediaStreamTrack))),!r)return k.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return k.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Vt().supportSetRtpSenderParameters)return k.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const u={},h={};switch(t._optimizationMode){case"motion":u.degradationPreference="maintain-framerate";break;case"detail":u.degradationPreference="maintain-resolution";break;case"balanced":u.degradationPreference="balanced"}const m=(function(U,V){return U.getTransceivers().find((K=>K.sender.track===V||K.receiver.track===V))})(this.peerConnection,t._mediaStreamTrack),g=Roe(t);if((function(U){var V;return!(!X("ENABLE_AG_ADAPTATION")||!(U instanceof HC||je(V=U._hints).call(V,un.CUSTOM_TRACK))||!X("FORCE_SUPPORT_AG_ADAPTATION")&&!(ZB(14,0,!1)&&QB(17,4)||$B(14)&&Z1(17,4,!0)))})(t)&&m&&r&&g&&this.getLocalVideoStats&&je(a=["vp8","vp9"]).call(a,this.store.codec)){var y;const U=u.degradationPreference||(je(y=t._hints).call(y,un.CUSTOM_TRACK)?X("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(V,K,z,J,ae,ie){if(yA(V,z),ae(K),J!=="balanced"&&J!=="maintain-framerate"&&J!=="maintain-resolution")return;let ee=-1;tG(V,K);const le=window.setInterval((()=>{const we=vA.get(V);if(!X("ENABLE_AG_ADAPTATION")||!we)return yA(V,z),void ae(K);const Ne=ie();if(Ne.sendPackets>0&&Ne.OutgoingAvailableBandwidth>0){if(ee===-1)return void(ee=Date.now());if(Date.now()-ee<1e3)return;const bt=Ne.sendFrameRate,Rt=Ne.OutgoingAvailableBandwidth,[ft,Xt]=jce(V,bt,Rt,we.adaptationConfig,K,J);Xt&&(z.qualityLimitationReason=Xt),ft&&we.adaptationConfig.scale!==ft.scale&&(k.debug("[".concat(V,"] applyAdaptation: ").concat(z.qualityLimitationReason,`
           sendFps `).concat(bt,", bwe ").concat(Rt,", switch from ").concat(we.adaptationConfig.scale," to ").concat(ft.scale," ")),we.adaptationConfig=SP(SP({},we.adaptationConfig),ft),ae(ft))}}),X("CHECK_LOCAL_STATS_INTERVAL")),ye=SP({},K);vA.set(V,{timer:le,adaptationConfig:ye,originConfig:K,adaptationFunc:ae}),k.debug("[".concat(V,"] start adaptation, originConfig: ").concat(JSON.stringify(K),", degradationPreference: ").concat(J))})(this.id+m.mid,g,this,U,(V=>{r&&this.updateAdaptation(r,V)}),this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var E;const{bitrateMax:U,frameRate:V,scaleResolutionDownBy:K}=t._encoderConfig;U&&(h.maxBitrate=1e3*U),(je(E=t._hints).call(E,un.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(V&&(h.maxFramerate=Ja(V)),K&&K>=1&&(h.scaleResolutionDownBy=K))}const{maxFramerate:A}=X("ENCODER_CONFIG_LIMIT");if(A&&typeof A=="number"&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,A):A),X("DSCP_TYPE")&&ju()){var O;const U=X("DSCP_TYPE");je(O=["very-low","low","medium","high"]).call(O,U)&&(h.networkPriority=U)}const N=r.getParameters(),B=(o=N.encodings)===null||o===void 0?void 0:o[0];Vn()&&!B&&(u.encodings=[h]),B&&Object.assign(B,h),Object.assign(N,u),k.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(N.encodings))),await r.setParameters(N),await(async function(U,V,K){try{var z;if(!Vt().supportSetRtpSenderParameters||!(function(le){return le==="vp9"||le==="av1"})(U)||!X("ENABLE_SVC"))return;const J={},ae={},ie=V.getParameters(),ee=(z=ie.encodings)===null||z===void 0?void 0:z[0];ae.scalabilityMode=sA(K),ee&&Object.assign(ee,ae),Object.assign(ie,J),await V.setParameters(ie),k.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(ie.encodings)))}catch(J){k.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",J)}})(this.store.codec,r,X("SVC_MODE"))}async updateAdaptation(t,r){var a,o;if(!t)return k.debug("[updateAdaptation] no rtpSender found");if(!Vt().supportSetRtpSenderParameters)return k.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const u={},{bitrateMax:h,frameRate:m,scaleResolutionDownBy:g}=r;h&&(u.maxBitrate=1e3*h),m&&(u.maxFramerate=Ja(m)),g&&g>=1&&je(a=["vp8","vp9"]).call(a,this.store.codec)&&(u.scaleResolutionDownBy=g);const y=t.getParameters(),E=(o=y.encodings)===null||o===void 0?void 0:o[0];E&&Object.assign(E,u),Object.assign(y,{});try{await t.setParameters(y),k.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(y.encodings)))}catch(A){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?k.debug("[updateAdaptation] peerConnection not connected}"):k.debug("[updateAdaptation] updateRtpSenderEncodings failed",A):k.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,r){try{if(!Vt().supportSetRtpSenderParameters||t.length!==r.length)return;for(let a=0;a<t.length;a++){const o=t[a],u=r[a];u instanceof wn&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,o.sender)}}catch{k.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,r,a){const o=Ca(t);return r.forEach(((u,h)=>{const m=a[h],g=o.mediaDescriptions.find((y=>y.attributes.mid===m));g&&(tv(g,u),C8(g,u,this.store.codec))})),Dh(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,a)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,t,r,a)},this.statsFilter.onSelectedLocalCandidateChanged=(t,r)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,t,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,r)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,t,r)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var r;(r=this.onFirstVideoDecodedTimeout)===null||r===void 0||r.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,r){if(t.length===r.length)for(let g=0;g<t.length;g++){var a,o,u,h,m;const y=t[g],E=r[g];if(E instanceof wn&&!je(a=E._hints).call(a,un.LOW_STREAM)&&(o=E._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((u=E._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=E._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=E._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const A={},O={high:1e3*(E._encoderConfig.bitrateMax-50),medium:5e4};A.encodings=[{rid:"m",active:!0,maxBitrate:O.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:O.high}];const N=y.sender.getParameters();await y.sender.setParameters(Object.assign(N,A))}}}async applySimulcastEncodings(t,r){if(!Vn()&&t.length===r.length)for(let a=0;a<t.length;a++){const o=r[a];if(o instanceof wn&&this.isVP8Simulcast(o)){const u=t[a],h={},m={high:1e3*(o._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const g=u.sender.getParameters();await u.sender.setParameters(Object.assign(g,h))}}}isVP8Simulcast(t){var r,a,o,u,h;return!!(t instanceof wn&&X("SIMULCAST")&&this.store.codec==="vp8"&&!je(r=t._hints).call(r,un.LOW_STREAM)&&(a=t._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((o=t._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(u=t._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=t._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(t,r,a,o){if(X("SDP_LOGGING"))return k.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(r," SDP during P2PConnection.").concat(o,`
`),t),r==="offer"?u=>{this.logSDPExchange(u,"answer",a==="local"?"remote":"local",o)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const r=this.remoteSDP.getSSRC(t);return r&&r.length!==0?r[0].ssrcId:void 0}setConfiguration(t){if(Vt().supportPCSetConfiguration){const r=tm.resolvePCConfiguration(t);this.peerConnection.setConfiguration(r)}t.isPreallocation&&(this.isPreallocation=!0)}},Qe(Mt.prototype,"updateRemoteRTPCapabilities",[la],Object.getOwnPropertyDescriptor(Mt.prototype,"updateRemoteRTPCapabilities"),Mt.prototype),Qe(Mt.prototype,"connect",[la],Object.getOwnPropertyDescriptor(Mt.prototype,"connect"),Mt.prototype),Qe(Mt.prototype,"updateRemoteConnect",[la],Object.getOwnPropertyDescriptor(Mt.prototype,"updateRemoteConnect"),Mt.prototype),Qe(Mt.prototype,"createDataChannels",[la],Object.getOwnPropertyDescriptor(Mt.prototype,"createDataChannels"),Mt.prototype),Qe(Mt.prototype,"receive",[la],Object.getOwnPropertyDescriptor(Mt.prototype,"receive"),Mt.prototype),Qe(Mt.prototype,"batchReceive",[la],Object.getOwnPropertyDescriptor(Mt.prototype,"batchReceive"),Mt.prototype),Qe(Mt.prototype,"stopReceiving",[la],Object.getOwnPropertyDescriptor(Mt.prototype,"stopReceiving"),Mt.prototype),Qe(Mt.prototype,"muteRemote",[la],Object.getOwnPropertyDescriptor(Mt.prototype,"muteRemote"),Mt.prototype),Qe(Mt.prototype,"unmuteRemote",[la],Object.getOwnPropertyDescriptor(Mt.prototype,"unmuteRemote"),Mt.prototype),Qe(Mt.prototype,"muteLocal",[la],Object.getOwnPropertyDescriptor(Mt.prototype,"muteLocal"),Mt.prototype),Qe(Mt.prototype,"unmuteLocal",[la],Object.getOwnPropertyDescriptor(Mt.prototype,"unmuteLocal"),Mt.prototype),Qe(Mt.prototype,"close",[la],Object.getOwnPropertyDescriptor(Mt.prototype,"close"),Mt.prototype),Qe(Mt.prototype,"updateEncoderConfig",[la],Object.getOwnPropertyDescriptor(Mt.prototype,"updateEncoderConfig"),Mt.prototype),Qe(Mt.prototype,"updateSendParameters",[la],Object.getOwnPropertyDescriptor(Mt.prototype,"updateSendParameters"),Mt.prototype),Qe(Mt.prototype,"replaceTrack",[la],Object.getOwnPropertyDescriptor(Mt.prototype,"replaceTrack"),Mt.prototype),Qe(Mt.prototype,"updateAdaptation",[la],Object.getOwnPropertyDescriptor(Mt.prototype,"updateAdaptation"),Mt.prototype),Qe(Mt.prototype,"getRemoteSSRC",[la],Object.getOwnPropertyDescriptor(Mt.prototype,"getRemoteSSRC"),Mt.prototype),Mt);function la(e,t,r){const a=e[t];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const o=this.mutex,u=await o.lock("From P2PConnection.".concat(t));try{for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];return await a.apply(this,m)}finally{u()}},r}function RP(e,t){let r=document.createElement("video"),a=document.createElement("canvas");r.setAttribute("style","display:none"),a.setAttribute("style","display:none"),r.setAttribute("muted",""),r.muted=!0,r.setAttribute("autoplay",""),r.autoplay=!0,r.setAttribute("playsinline",""),a.width=Ja(t.width),a.height=Ja(t.height);const o=Ja(t.framerate||15);document.body.append(r),document.body.append(a);let u=e._mediaStreamTrack;r.srcObject=new MediaStream([u]),r.play();const h=a.getContext("2d");if(!h)throw new fe(q.UNEXPECTED_ERROR,"can not get canvas context");const m=Vt(),g=a.captureStream(m.supportRequestFrame?0:o).getVideoTracks()[0];g.canvas||(g.canvas=a),a.startCapture=()=>{if(!r)return a.stopCapture&&a.stopCapture();if(r.paused&&r.play(),r.videoHeight>2&&r.videoWidth>2){const E=r.videoWidth,A=r.videoHeight/E,O=a.width*A;Math.abs(O-a.height)>=2&&(k.debug("adjust low stream resolution","".concat(a.width,"x").concat(a.height," -> ").concat(a.width,"x").concat(O)),a.height=O)}h.drawImage(r,0,0,a.width,a.height),g.requestFrame&&g.requestFrame(),u!==e._mediaStreamTrack&&(u=e._mediaStreamTrack,r.srcObject=new MediaStream([u]))},a.stopCapture=ND((()=>a.startCapture&&a.startCapture()),o);const y=g.stop;return g.stop=()=>{y.call(g),r&&(r.remove(),r.srcObject=null,r=null),a&&(a.width=0,a.remove(),a.stopCapture&&a.stopCapture(),a.startCapture=void 0,a.stopCapture=void 0,a=null),k.debug("clean low stream renderer")},g}var sG=(function(e){return e[e.Video_Send_Type=190]="Video_Send_Type",e})(sG||{}),zc=(function(e){return e[e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",e[e.Video_Send_Freeze=2082]="Video_Send_Freeze",e[e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",e[e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",e[e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",e[e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",e[e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",e[e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",e})(zc||{}),_t=(function(e){return e[e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",e[e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",e[e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",e[e.Video_Send_Transmit=2066]="Video_Send_Transmit",e[e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",e[e.Video_Capture_Height=2033]="Video_Capture_Height",e[e.Video_Capture_Width=2035]="Video_Capture_Width",e[e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",e[e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",e[e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",e[e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",e[e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",e[e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",e[e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",e[e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",e[e.Video_Send_Width=2003]="Video_Send_Width",e[e.Video_Send_Height=2004]="Video_Send_Height",e[e.Video_Send_Disabled=2095]="Video_Send_Disabled",e[e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",e[e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",e[e.Video_Send_Nacks=2009]="Video_Send_Nacks",e[e.Video_Send_Plis=2010]="Video_Send_Plis",e[e.Video_Send_Firs=2011]="Video_Send_Firs",e[e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",e[e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",e[e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",e[e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",e[e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",e[e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",e[e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",e[e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",e[e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",e[e.Audio_Send_Level=2038]="Audio_Send_Level",e[e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",e[e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",e[e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",e[e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",e[e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",e[e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",e[e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",e[e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",e[e.Video_Recv_Height=2019]="Video_Recv_Height",e[e.Video_Recv_Width=2018]="Video_Recv_Width",e[e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",e[e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",e[e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",e[e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",e[e.Video_Recv_Plis=2027]="Video_Recv_Plis",e[e.Video_Recv_Firs=2028]="Video_Recv_Firs",e[e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",e[e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",e[e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",e[e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",e[e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",e[e.Audio_Render_Level=2043]="Audio_Render_Level",e[e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",e[e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",e[e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",e[e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",e[e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",e[e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",e[e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",e[e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",e[e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",e[e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",e[e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",e[e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",e})(_t||{}),Kr=(function(e){return e[e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",e[e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",e[e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",e[e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",e[e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",e[e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",e[e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",e[e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",e[e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",e[e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",e[e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",e[e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",e[e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",e[e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",e[e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",e[e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",e[e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",e[e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",e[e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",e[e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",e[e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",e})(Kr||{}),ua=(function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e})(ua||{}),SA=(function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e})(SA||{});const Gp=1e3,bA=6,uS=3,Fce=Math.max(bA,uS,60);function ct(e,t,r){r!=null&&Number.isFinite(r)&&(e[t]=Math.round(Math.max(0,r)))}function oG(e){const t={[ua.CONN_TYPE]:0,[ua.RTT]:e.rtt,[ua.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const r=e.selectedCandidatePair.localCandidate.relayProtocol;r==="udp"&&(t[ua.CONN_TYPE]=1),r==="tcp"&&(t[ua.CONN_TYPE]=3),r==="tls"&&(t[ua.CONN_TYPE]=4);break}case"srflx":t[ua.CONN_TYPE]=2;break;case"unknown":t[ua.CONN_TYPE]=5;break;default:t[ua.CONN_TYPE]=0}return t}function cG(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class lG extends Mn{constructor(t){super(),H(this,"store",void 0),H(this,"uploadWRTCStatsTimer",void 0),H(this,"uploadOutboundDenoiserStatsTimer",void 0),H(this,"uploadExtStatsTimer",void 0),H(this,"uploadExtUsageStatsTimer",void 0),H(this,"uploadInboundExtStatsTimer",void 0),H(this,"requestStats",void 0),H(this,"requestTransportStats",void 0),H(this,"requestLocalMedia",void 0),H(this,"requestRemoteMedia",void 0),H(this,"requestAllTracks",void 0),H(this,"requestVideoIsReady",void 0),H(this,"requestUploadStats",void 0),H(this,"requestUpload",void 0),H(this,"uploadOutboundStarted",!1),H(this,"uploadInboundStarted",!1),H(this,"uploadTransportStarted",!1),H(this,"uploadBaseStatsStarted",!1),H(this,"uploadExtensionUsageStarted",!1),H(this,"lastRecvStats",void 0),H(this,"lastSendStats",void 0),H(this,"lastRefRecvStats",void 0),H(this,"lastRefSendStats",void 0),H(this,"lastNormalRecvStats",void 0),H(this,"lastNormalSendStats",void 0),H(this,"lastExtendStats",{}),H(this,"needUploadStats",{}),H(this,"needUploadRenderFreezeTime",!0),H(this,"lastUploadCompensateTime",-1),H(this,"uploadCompensateDeltaTime",0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;const r=t%uS==0,a=t%bA==0,o=t%60==0;let u,h;if(this.uploadTransportStarted&&(u=this.requestStats(),this.store.useP2P&&(h=this.requestStats(!0))),!u&&this.uploadOutboundStarted&&(u=this.requestStats()),!h&&this.uploadInboundStarted&&(h=this.requestStats(!0)),u||h){var m;const g={};if(this.uploadTransportStarted&&u){const E=this.getTransportStats(u,h,r);E&&(g.misc=[E])}if(this.uploadOutboundStarted&&u){const E=this.getOutboundStats(u,a?this.lastNormalSendStats:void 0,r?this.lastRefSendStats:void 0,this.lastSendStats,o);E&&(g.outbound=[E])}if(this.uploadInboundStarted&&h){this.uploadCompensateStats(t);const E=this.getInboundStats(h,a?this.lastNormalRecvStats:void 0,r?this.lastRefRecvStats:void 0,this.lastRecvStats);E&&(g.inbound=E)}const y=(m=this.requestTransportStats)===null||m===void 0?void 0:m.call(this).connectState;y&&(Array.isArray(g.misc)?g.misc[0]&&g.misc[0].addition&&(g.misc[0].addition[SA.RTC_PEER_CONNECTION_STATE]=pD[y]):g.misc=[{addition:{[SA.RTC_PEER_CONNECTION_STATE]:pD[y]}}]),this.needUploadStats.sendType&&(Array.isArray(g.outbound)&&g.outbound[0]&&g.outbound[0].high&&(g.outbound[0].high[sG.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(g)}this.lastRecvStats=h,this.lastSendStats=u,a&&(this.lastNormalRecvStats=h,this.lastNormalSendStats=u),r&&(this.lastRefRecvStats=h,this.lastRefSendStats=u)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let t=1;this.uploadWRTCStatsTimer=window.setInterval((()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var r,a;const o=(r=this.requestTransportStats)===null||r===void 0?void 0:r.call(this);return void(o&&((a=this.requestUploadStats)===null||a===void 0||a.call(this,{misc:[{addition:{[SA.RTC_PEER_CONNECTION_STATE]:pD[o.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(t),++t===Fce+1&&(t=1)}),Gp)}uploadCompensateStats(t){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const r=t%uS==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!r)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());const a=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=a,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const o=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*o;const u=this.requestStats(!0);new Array(o).fill(0).forEach((()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const h={};if(this.uploadInboundStarted&&u){const m=this.requestRemoteMedia()||[],g=[];m.forEach((y=>{let[E,A]=y;const O={peer:E.uid};if(E._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(E._videoSSRC)&&A.has(Xe.VIDEO)&&E.videoTrack){const N=(function(B,U,V){if(!U.videoRecv.find((z=>z.ssrc===B)))return;const K={};if(V&&V._player){const z=V._player,{renderFreezeAccTime2:J,videoElementStatus:ae}=z;if(kl.visibility==="visible"&&ae===ci.PLAYING&&Vt().supportRequestVideoFrameCallback){const ie=Math.min(6e3,J);z.renderFreezeAccTime2=Math.max(0,J-ie),ct(K,zc.Video_Render_Freeze_Time_Render2,ie),X("USE_NEW_RENDER_FREEZE_TIME")&&ct(K,zc.Video_Render_Freeze_Time_Render,ie)}}return K})(E._videoSSRC,u,E.videoTrack);N&&(O.video=N)}O.video&&g.push(O)})),g.length>0&&(h.inbound=g,this.requestUploadStats(h))}}))}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(t,r,a){if(!this.requestStats)return;if(!a)return t.rtt==null?void 0:{addition:{[ua.RTT]:t.rtt,[ua.CONN_TYPE]:void 0,[ua.STATS_UPDATE_INTERVAL]:t.updateInterval||void 0}};const o=oG(t);if(this.store.useP2P){if(r){const u=oG(r);o[ua.CONN_TYPE]+=u[ua.CONN_TYPE]<<3}o[ua.CONN_TYPE]+=110}else o[ua.CONN_TYPE]+=100;return{addition:o}}getOutboundStats(t,r,a,o,u){if(!this.requestUploadStats||!this.requestLocalMedia)return;const h=this.requestLocalMedia();if(!h||h.length===0)return;let m,g,y;return h.forEach((E=>{let[A,{track:O,ssrcs:N}]=E;switch(A){case Ie.LocalVideoLowTrack:case Ie.LocalVideoTrack:if(A===Ie.LocalVideoTrack){var B;const U=(function(J,ae,ie,ee,le,ye){const we=ae.videoSend.find((ft=>ft.ssrc===J));if(!we)return;const Ne={},{sentFrame:bt,inputFrame:Rt}=we;if(ee&&(ct(Ne,zc.Video_Send_Qp_Sum,we.qpSumPerFrame),Rt&&bt)){const ft=Rt.frameRate,Xt=bt.frameRate;Ne[zc.Video_Send_Freeze]=(function(Wt,hi){let Te=!0;return Te=!(Wt<=5)&&(Wt<=10?hi<3:Wt<=20?hi<4:hi<5),Te})(ft,Xt)?1:0}if(le){switch(bt&&(ct(Ne,_t.Video_Send_Height,bt.height),ct(Ne,_t.Video_Send_Width,bt.width),ct(Ne,_t.Video_Send_Frame_Rate,bt.frameRate)),Ne[_t.Video_Send_Disabled]=ie._originMediaStreamTrack&&!ie._originMediaStreamTrack.enabled||ie._mediaStreamTrack&&!ie._mediaStreamTrack.enabled?1:0,we.adaptionChangeReason){case"none":Ne[_t.Video_Send_Adaptation]=0;break;case"cpu":Ne[_t.Video_Send_Adaptation]=1;break;case"bandwidth":Ne[_t.Video_Send_Adaptation]=2;break;case"other":Ne[_t.Video_Send_Adaptation]=3}let ft=0;we.adaptionChangeReason&&(ft+=cG(we.adaptionChangeReason)),ae.qualityLimitationReason&&(ft+=cG(ae.qualityLimitationReason)<<3),Ne[_t.Video_Send_Adaptation]=ft,Ne[_t.Video_Send_Player_Status]=OD[ie._player?ie._player.videoElementStatus:"uninit"],ct(Ne,_t.Video_Send_Nacks,we.nacksCount),ct(Ne,_t.Video_Send_Plis,we.plisCount),ct(Ne,_t.Video_Send_Firs,we.firsCount),ct(Ne,_t.Video_Send_Avg_Encode,we.avgEncodeMs),ct(Ne,_t.Video_Send_Huge_Frame_Sent,we.hugeFramesSent),ct(Ne,_t.Video_Send_Bytes_Retransmit,we.retransmittedBytesSent),ct(Ne,_t.Video_Send_Packages_Retransmit,we.retransmittedPacketsSent),ct(Ne,_t.Video_Send_Key_Frames_Encoded,we.keyFramesEncoded);const Xt=le.videoSend.find((Wt=>Wt.ssrc===J));if(Xt){let Wt=Gp*uS;Xt.timestamp&&we.timestamp&&(Wt=we.timestamp-Xt.timestamp),Xt.packets!=null&&we.packets!=null&&ct(Ne,_t.Video_Send_Package_Rate,1e3*(we.packets-Xt.packets)/Wt),we.packetsLost!=null&&Xt.packetsLost!=null&&ct(Ne,_t.Video_Send_Package_Lost,we.packetsLost-Xt.packetsLost),Xt.bytes!=null&&we.bytes!=null&&ct(Ne,_t.Video_Send_Bitrate,8*(we.bytes-Xt.bytes)/Wt)}}return Ne})(N[0].ssrcId,t,O,r,a),V=O.__className__==="CameraVideoTrack"?3:je(B=O._hints).call(B,un.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==V||u)&&(this.needUploadStats={sendType:V},this.lastExtendStats.sendType=V);const K=O&&(function(J,ae,ie,ee){const le=ae.videoSend.find((we=>we.ssrc===J));if(!le)return null;const ye={};if(ee){const we=le.inputFrame,Ne=we&&we.height||ie.videoHeight||0,bt=we&&we.width||ie.videoWidth||0,Rt=we&&we.frameRate||0;ct(ye,_t.Video_Capture_Height,Ne),ct(ye,_t.Video_Capture_Width,bt),ct(ye,_t.Video_Capture_Frame_Rate,Rt)}return ye})(N[0].ssrcId,t,O,!!a),z=(function(J,ae){const ie={};return ae&&(ct(ie,_t.Video_Send_Retransmit,J.bitrate.retransmit),ct(ie,_t.Video_Send_Target_Encoded,J.bitrate.targetEncoded),ct(ie,_t.Video_Send_Actual_Encoded,J.bitrate.actualEncoded),ct(ie,_t.Video_Send_Transmit,J.bitrate.transmit),ct(ie,_t.Video_Send_Bandwidth,J.sendBandwidth)),ie})(t,!!a);g=Object.assign({},U,K,z)}else y=(function(U,V,K,z,J){const ae=V.videoSend.find((ee=>ee.ssrc===U));if(!ae)return;const ie={};if(z){const ee=ae.sentFrame;ee&&(ct(ie,_t.Video_Send_Low_Height,ee.height),ct(ie,_t.Video_Send_Low_Width,ee.width),ct(ie,_t.Video_Send_Low_Frame_Rate,ee.frameRate));const le=z.videoSend.find((ye=>ye.ssrc===U));if(le){let ye=Gp*bA;le.timestamp&&ae.timestamp&&(ye=ae.timestamp-le.timestamp),le.packets!=null&&ae.packets!=null&&ct(ie,_t.Video_Send_Low_Package_Rate,1e3*(ae.packets-le.packets)/ye),ae.packetsLost!=null&&le.packetsLost!=null&&ct(ie,_t.Video_Send_Low_Package_Lost,ae.packetsLost-le.packetsLost),le.bytes!=null&&ae.bytes!=null&&ct(ie,_t.Video_Send_Low_Bitrate,8*(ae.bytes-le.bytes)/ye)}}return ie})(N[0].ssrcId,t,0,a);break;case Ie.LocalAudioTrack:m=O&&(function(U,V,K,z,J,ae){const ie=V.audioSend.find((le=>le.ssrc===U));if(!ie)return;const ee={};if(J){ee[_t.Audio_Send_Disabled]=K._originMediaStreamTrack&&!K._originMediaStreamTrack.enabled||K._mediaStreamTrack&&!K._mediaStreamTrack.enabled?1:0;const le=100*K._source.getAccurateVolumeLevel(),ye=ie.inputLevel;if(ye!=null){const Ne=Math.ceil(50*Math.log10(100*ye+1));ct(ee,_t.Audio_Send_Level,Ne)}ct(ee,_t.Audio_Capture_PCM_Level,le),ct(ee,_t.Audio_Send_AEC_Return_Loss,ie.aecReturnLoss),ct(ee,_t.Audio_Send_AEC_Return_Loss_Enhancement,ie.aecReturnLossEnhancement),ct(ee,_t.Audio_Send_Bytes_Retransmit,ie.retransmittedBytesSent),ct(ee,_t.Audio_Send_Packages_Retransmit,ie.retransmittedPacketsSent),ee[_t.Audio_Send_Freeze]=0;const we=J.audioSend.find((Ne=>Ne.ssrc===U));if(we){let Ne=Gp*bA;we.timestamp&&ie.timestamp&&(Ne=ie.timestamp-we.timestamp),we.bytes!=null&&ie.bytes!=null&&ct(ee,_t.Audio_Send_Bitrate,8*(ie.bytes-we.bytes)/Ne),we.packets!=null&&ie.packets!=null&&ct(ee,_t.Audio_Send_Package_Rate,1e3*(ie.packets-we.packets)/Ne)}}return ee})(N[0].ssrcId,t,O,0,a)}})),{high:g,low:y,audio:m}}getInboundStats(t,r,a,o){if(!this.requestRemoteMedia)return;const u=this.requestRemoteMedia()||[],h=[];return u.forEach((m=>{let[g,y]=m;const E={peer:g.uid};if(y.has(Xe.VIDEO)&&g.videoTrack){const A=g._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(g._videoSSRC)||!1,O=g.videoTrack?(function(N,B,U,V,K,z,J,ae){const ie=B.videoRecv.find((ft=>ft.ssrc===N));if(!ie)return;const ee={},{receivedFrame:le,outputFrame:ye,decodeFrameRate:we}=ie;ct(ee,Kr.Video_Render_Frame_Rate_Decode,we),ie.framesRateFirefox&&ct(ee,Kr.Video_Recv_Frame_Rate,ie.framesRateFirefox),le&&ct(ee,Kr.Video_Recv_Frame_Rate,le.frameRate),ct(ee,Kr.Video_Recv_Frame_Dropped,ie.framesDroppedCount),ct(ee,Kr.Video_Recv_Bytes_Retransmit,ie.retransmittedBytesReceived),ct(ee,Kr.Video_Recv_Packages_Retransmit,ie.retransmittedPacketsReceived),ct(ee,Kr.Video_Recv_Packages_Discarded,ie.packetsDiscarded),ct(ee,Kr.Video_Recv_Avg_Decode,ie.avgDecodeMs),ct(ee,Kr.Video_Recv_Avg_Processing_Delay,ie.avgProcessingDelayMs),ct(ee,Kr.Video_Recv_Avg_Assembly_Time,ie.avgFramesAssembledFromMultiplePacketsMs),ct(ee,Kr.Video_Recv_Avg_Inter_Frame_Delay,ie.avgInterFrameDelayMs),ct(ee,Kr.Video_Recv_Key_Frames_Decoded,ie.keyFramesDecoded);const Ne=ae&&ae.videoRecv.find((ft=>ft.ssrc===N));if(Ne){const ft=B.timestamp-ae.timestamp||Gp;ie.packetsLost!=null&&Ne.packetsLost!=null&&ct(ee,Kr.Video_Recv_Package_Lost,ie.packetsLost-Ne.packetsLost),Ne.bytes!=null&&ie.bytes!=null&&ct(ee,Kr.Video_Recv_Bitrate,8*(ie.bytes-Ne.bytes)/ft),Ne.packets!=null&&ie.packets!=null&&ct(ee,Kr.Video_Recv_Package_Rate,1e3*(ie.packets-Ne.packets)/ft)}const bt=z&&z.videoRecv.find((ft=>ft.ssrc===N));if(bt&&(ct(ee,zc.Video_Recv_Qp_Sum,ie.qpSumPerFrame),ee[zc.Video_Recv_Freeze]=V&&lS.isRemoteVideoFreeze(U,ie,bt)?1:0),J){var Rt;const ft=J.videoRecv.find((Wt=>Wt.ssrc===N));le?(ct(ee,_t.Video_Recv_Height,le.height),ct(ee,_t.Video_Recv_Width,le.width)):U&&(ct(ee,_t.Video_Recv_Height,U._videoHeight||0),ct(ee,_t.Video_Recv_Width,U._videoWidth||0)),ye&&ct(ee,_t.Video_Recv_Frame_Rate_Output,ye.frameRate);const Xt=(Rt=U._player)===null||Rt===void 0?void 0:Rt.rendFrameRate.toFixed(0);if(Xt&&ct(ee,_t.Video_Render_Frame_Rate_Render,+Xt),ct(ee,_t.Video_Recv_Jitter_Buffer,ie.jitterBufferMs),ct(ee,_t.Video_Recv_Current_Delay,ie.currentDelayMs),ct(ee,_t.Video_Recv_Firs,ie.firsCount),ct(ee,_t.Video_Recv_Nacks,ie.nacksCount),ct(ee,_t.Video_Recv_Plis,ie.plisCount),U){ee[_t.Video_Recv_Disabled]=U._originMediaStreamTrack.enabled&&U._mediaStreamTrack.enabled?0:1;const Wt=U._player;if(Wt){const{freezeTimeCounterList:hi,renderFreezeAccTime:Te,renderFreezeAccTime2:Ue,videoElementStatus:Je}=Wt;if(hi&&hi.length>0&&ct(ee,zc.Video_Render_Freeze_Time,hi.splice(0,1)[0]),K&&kl.visibility==="visible"&&Je===ci.PLAYING&&Vt().supportRequestVideoFrameCallback){const Re=Math.min(6e3,Ue);Wt.renderFreezeAccTime2=Math.max(0,Ue-Re),ct(ee,zc.Video_Render_Freeze_Time_Render2,Re);const M=Math.min(6e3,Te);Wt.renderFreezeAccTime=Math.max(0,Te-M),ct(ee,zc.Video_Render_Freeze_Time_Render,X("USE_NEW_RENDER_FREEZE_TIME")?Re:M)}if(typeof ie.totalFreezesDuration=="number"){const Re=ft&&ft.totalFreezesDuration?ie.totalFreezesDuration-ft.totalFreezesDuration:ie.totalFreezesDuration;ct(ee,_t.Video_Render_Freeze_Duration,1e3*Re)}}}if(ee[_t.Video_Recv_Player_Status]=OD[U._player?U._player.videoElementStatus:"uninit"],ft&&ie.totalInterFrameDelay!==void 0&&ie.totalSquaredInterFrameDelay!==void 0&&ft.totalInterFrameDelay!==void 0&&ft.totalSquaredInterFrameDelay!==void 0){const Wt=ie.totalInterFrameDelay-ft.totalInterFrameDelay,hi=ie.totalSquaredInterFrameDelay-ft.totalSquaredInterFrameDelay,Te=ie.framesDecodeCount-ft.framesDecodeCount,Ue=Wt/Te*1e3,Je=Math.round(1e3*Math.sqrt((hi-Math.pow(Wt,2)/Te)/Te));!isNaN(Je)&&Ue+Je>Math.max(3*Ue,Ue+150)&&(ee[_t.Video_Recv_I_Frame_Delay]=Je)}}return ee})(g._videoSSRC,t,g.videoTrack,A===!0,this.needUploadRenderFreezeTime,r,a,o):void 0;O&&(E.video=O)}if(y.has(Xe.AUDIO)&&g.audioTrack){const A=g.audioTrack?(function(O,N,B,U,V,K){const z=N.audioRecv.find((ee=>ee.ssrc===O));if(!z)return;const J={};ct(J,Kr.Audio_Recv_Jitter,z.jitterMs),ct(J,Kr.Audio_Recv_Bytes_Retransmit,z.retransmittedBytesReceived),ct(J,Kr.Audio_Recv_Packages_Retransmit,z.retransmittedPacketsReceived),ct(J,Kr.Audio_Recv_Packages_Discarded,z.packetsDiscarded),ct(J,Kr.Audio_Recv_Avg_Processing_Delay,z.avgProcessingDelayMs);const ae=K&&K.audioRecv.find((ee=>ee.ssrc===O));if(ae){const ee=Gp;z.packets!=null&&ae.packets!=null&&ct(J,Kr.Audio_Recv_Package_Rate,1e3*(z.packets-ae.packets)/ee),z.packetsLost!=null&&ae.packetsLost!=null&&ct(J,Kr.Audio_Recv_Package_Lost,z.packetsLost-ae.packetsLost)}if(U){const{receivedFrames:ee,droppedFrames:le}=z;ee!=null&&le!=null&&(J[zc.Audio_Recv_Freeze]=(ie=ee)===0||100*le/ie>20?1:0)}var ie;if(V){const ee=100*B._source.getAccurateVolumeLevel(),le=z.outputLevel;if(le!=null){const we=Math.ceil(50*Math.log10(100*le+1));ct(J,_t.Audio_Render_Level,we)}ct(J,_t.Audio_Recv_PCM_Level,ee),B&&(J[_t.Audio_Recv_Disabled]=B._originMediaStreamTrack.enabled&&B._mediaStreamTrack.enabled?0:1),ct(J,_t.Audio_Recv_Jitter_Buffer,z.jitterBufferMs),ct(J,_t.Audio_Recv_Current_Delay,z.jitterBufferMs),J[_t.Audio_Recv_Player_Status]=OD[ca.getPlayerState(B.getTrackId())];const ye=V.audioRecv.find((we=>we.ssrc===O));if(ye){ye.bytes!=null&&z.bytes!=null&&ct(J,_t.Audio_Recv_Bitrate,8*(z.bytes-ye.bytes)/(Gp*uS));const we=z.concealedSamples-ye.concealedSamples;we>0&&ct(J,_t.Audio_Recv_Concealed_Samples,we);const Ne=z.totalSamplesReceived-ye.totalSamplesReceived;Ne>0&&ct(J,_t.Audio_Recv_Total_Samples_Received,Ne);const bt=z.freezeSamples80-ye.freezeSamples80;bt>0&&ct(J,_t.Audio_Render_Freeze_Samples_80ms,bt);const Rt=z.freezeSamples200-ye.freezeSamples200;Rt>0&&ct(J,_t.Audio_Render_Freeze_Samples_200ms,Rt);const ft=z.freezeMs80-ye.freezeMs80;ct(J,_t.Audio_Render_Freeze_Time_80ms,ft<0?0:ft);const Xt=z.freezeMs200-ye.freezeMs200;ct(J,_t.Audio_Render_Freeze_Time_200ms,Xt<0?0:Xt)}}return J})(g._audioSSRC,t,g.audioTrack,r,a,o):void 0;A&&(E.audio=A)}(E.video||E.audio)&&h.push(E)})),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,h}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval((()=>{if(!this.requestAllTracks||!this.requestUpload)return;const t=(this.requestAllTracks()||[]).find((r=>r instanceof $0));if(t&&t._external.getDenoiserStats){const r=t._external.getDenoiserStats();r&&this.requestUpload(Q0.DENOISER_STATS,r)}}),2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval((()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach((t=>{t.getProcessorStats().forEach((r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)}))}))}),2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval((()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach((t=>{let[r,a]=t;a.has(Xe.VIDEO)&&r.videoTrack&&r.videoTrack.getProcessorStats().forEach((o=>{this.requestUpload&&this.requestUpload(o.type,o.stats)})),a.has(Xe.AUDIO)&&r.audioTrack&&r.audioTrack.getProcessorStats().forEach((o=>{this.requestUpload&&this.requestUpload(o.type,o.stats)}))}))}),2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const t=new Map;this.uploadExtUsageStatsTimer=window.setInterval((async()=>{const r=Date.now(),a={connectionInterval:X("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:r};let o=[];const u=this.requestAllTracks&&this.requestAllTracks()||[];for(const y of u)!y.muted&&y.enabled&&(o=o.concat(await y.getProcessorUsage()));const h=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[y,E]of h)E.has(Xe.VIDEO)&&y.videoTrack&&(o=o.concat(await y.videoTrack.getProcessorUsage())),E.has(Xe.AUDIO)&&y.audioTrack&&(o=o.concat(await y.audioTrack.getProcessorUsage()));if(o.length===0)return;a.details=(function(y,E){const A={};for(const{id:U,value:V,level:K,direction:z}of y){var O;const J=(O=E.get(U))!==null&&O!==void 0?O:0,ae=V===2?J+X("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:J;var N,B;E.set(U,ae),A[U]?(V===2&&(A[U].value=V),K>A[U].level&&(A[U].level=K),z==="remote"&&(A[U].remoteUidCount+=1),A[U].totalTs=(N=E.get(U))!==null&&N!==void 0?N:0):A[U]={value:V,level:K,remoteUidCount:z==="local"?0:1,totalTs:(B=E.get(U))!==null&&B!==void 0?B:0}}return Object.keys(A).map((U=>{const{level:V,value:K,totalTs:z}=A[U];return{id:U,level:V,value:K,totalTs:z}}))})(o,t);const m=Date.now(),g=m>r?m:r+1;this.requestUpload&&this.requestUpload(Q0.EXTENSION_USAGE_STATS,{usageStats:a,sendTs:g})}),X("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const Gce=X("ICE_RESTART_INTERVAL");let TA=new Map,sv=new Map,Hh=[ui.UDP_TCP_RELAY,ui.TCP_RELAY,ui.RELAY],CP=X("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Vt().supportPCSetConfiguration;function uG(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const r=TA.get(e.id);r&&(window.clearTimeout(r),TA.delete(e.id));const a=sv.get(e.id);t&&a&&a.index===Hh.length-1&&(k.debug("[".concat(e.id,"] reset ICE restart policy")),sv.delete(e.id))}function dG(e,t,r){if(TA.size===0&&sv.size===0&&(Array.isArray(X("RESTART_SEQUENCE"))&&X("RESTART_SEQUENCE").length>0&&!(function(m,g){if(m.length!==g.length)return!1;for(let y=0;y<m.length;y+=1){const E=m[y];if(m.filter((A=>A===E)).length!==g.filter((A=>A===E)).length)return!1}return!0})(Hh,X("RESTART_SEQUENCE"))&&(Hh=X("RESTART_SEQUENCE").filter((m=>{var g;if(je(g=Object.values(ui)).call(g,m))return!0})),k.debug("use reconnection policy from config distribution, queues: ".concat(Hh.join(" => ")))),CP=X("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Vt().supportPCSetConfiguration),Hh.length===0)return void r();let a,{index:o=0,type:u}=sv.get(e.id)||{};if(CP&&u===ui.RELAY)return void r();let h=u&&o>=Hh.length-1;if(CP)u=ui.RELAY;else{if(h)return void r();u?(o++,u=Hh[o]):(u=Hh[0],o=0)}k.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(u,", index: ").concat(o)),t(u),sv.set(e.id,{index:o,type:u}),a=window.setTimeout((()=>dG(e,t,r)),Gce),TA.set(e.id,a)}var It;function hG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),r.push.apply(r,a)}return r}function Ul(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?hG(Object(r),!0).forEach((function(a){H(e,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hG(Object(r)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))}))}return e}function fG(e){var t,r,a,o=2;for(typeof Symbol<"u"&&(r=F1,a=Symbol.iterator);o--;){if(r&&(t=e[r])!=null)return t.call(e);if(a&&(t=e[a])!=null)return new wA(t.call(e));r="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function wA(e){function t(r){if(Object(r)!==r)return Fe.reject(new TypeError(r+" is not an object."));var a=r.done;return Fe.resolve(r.value).then((function(o){return{value:o,done:a}}))}return wA=function(r){this.s=r,this.n=r.next},wA.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(r){var a=this.s.return;return a===void 0?Fe.resolve({value:r,done:!0}):t(a.apply(this.s,arguments))},throw:function(r){var a=this.s.return;return a===void 0?Fe.reject(r):t(a.apply(this.s,arguments))}},new wA(e)}let dS=(It=class extends Mn{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(at.StateChange,t,this._state)}constructor(e,t){super(),H(this,"isPlanB",void 0),H(this,"store",void 0),H(this,"statsUploader",void 0),H(this,"connection",void 0),H(this,"localTrackMap",new Map),H(this,"remoteUserMap",new Map),H(this,"localDataChannels",[]),H(this,"remoteDataChannelMap",new Map),H(this,"pendingLocalTracks",[]),H(this,"pendingRemoteTracks",[]),H(this,"pendingLocalDataChannels",[]),H(this,"pendingRemoteDataChannels",[]),H(this,"statsCollector",void 0),H(this,"shouldForwardP2PCreation",void 0),H(this,"iceFailedCount",0),H(this,"dtlsFailedCount",0),H(this,"mutex",void 0),H(this,"_state",Zt.Disconnected),H(this,"_pcStatsUploadType",X("NEW_ICE_RESTART")?Gu.FIRST_CONNECTION:Gu.OLD_FIRST_CONNECTION),H(this,"_isStartRestartIce",!1),H(this,"_restartTimer",void 0),H(this,"_isTryConnecting",!1),H(this,"_iceError",null),H(this,"_forceTurn",!1),H(this,"_isWaitPcToRePub",!1),H(this,"handleMuteLocalTrack",(async(r,a,o)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Zt.Connected)return void o(new ve(q.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const h=this.filterTobeMutedTracks(r);if(h.length===0)return void a();const m=h.find((y=>y[0]==="videoLowTrack"));if(m){const y=m[1];this.store.enableInstantMuteRestore?(y.track._originMediaStreamTrack.enabled=!1,k.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):y.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?k.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(h.map((y=>{let[,{id:E}]=y;return E})));const g=this.createMuteMessage(h);await hn(this,at.RequestMuteLocal,g),a()}catch(h){o(h)}finally{u()}})),H(this,"handleUnmuteLocalTrack",(async(r,a,o)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Zt.Connected)return void o(new ve(q.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const h=this.filterTobeUnmutedTracks(r);if(h.length===0)return void a();const m=h.find((y=>y[0]==="videoLowTrack"));if(m){const y=m[1];if(this.store.enableInstantMuteRestore)y.track._originMediaStreamTrack.enabled=!0,k.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(y.track._originMediaStreamTrack.stop(),!X("DISABLE_DUAL_STREAM_USE_ENCODING")&&Vt().supportDualStreamEncoding){const E=r._mediaStreamTrack.clone();y.track._mediaStreamTrack=E,y.track._originMediaStreamTrack=E}else{const E=RP(r,W0(this,at.RequestLowStreamParameter));y.track._mediaStreamTrack=E,y.track._originMediaStreamTrack=E}await new Fe(((E,A)=>{this.handleReplaceTrack(y.track,E,A,!0)}))}}this.store.enableInstantMuteRestore?k.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(h.map((y=>{let[,{id:E}]=y;return E})));const g=this.createUnmuteMessage(h);await hn(this,at.RequestUnmuteLocal,g),a()}catch(h){o(h)}finally{u()}})),H(this,"handleUpdateVideoEncoder",(async(r,a,o,u)=>{let h;u||(h=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const g=this.localTrackMap.get(Ie.LocalVideoTrack);if(!this.connection||!g||g.track!==r||this.state!==Zt.Connected)return void a();const{id:y,track:E}=g;await this.connection.updateSendParameters(y,E),await this.connection.updateEncoderConfig(y,E),this.emit(at.UpdateVideoEncoder,E),a()}catch(g){o(g)}finally{var m;(m=h)===null||m===void 0||m()}})),H(this,"handleUpdateVideoSendParameters",(async(r,a,o)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(Ie.LocalVideoTrack);if(!this.connection||!h||h.track!==r||this.state!==Zt.Connected)return void a();const{id:m,track:g}=h;await this.connection.updateSendParameters(m,g),a()}catch(h){o(h)}finally{u()}})),H(this,"handleReplaceMixingTrack",(async(r,a,o,u)=>{if(!this.connection||this.state!==Zt.Connected)return void a();const h=TP([r]);let m;k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(h.getTrackId(),"]")),typeof u=="boolean"&&u||(m=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(r,h),a()}catch(y){o(y)}finally{var g;(g=m)===null||g===void 0||g()}})),H(this,"handleReplaceTrack",(async(r,a,o,u)=>{let h;k.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(r.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var m;const y=Array.from(this.localTrackMap.entries()).find((E=>{let[,{track:A}]=E;return r===A}));if(!this.connection||!y||this.state!==Zt.Connected)return void a();if(await((m=this.connection)===null||m===void 0?void 0:m.replaceTrack(r,y[1].id)),this.isPlanB){const E=y[1];E.id=r._mediaStreamTrack.id,this.localTrackMap.set(y[0],E)}if(y[0]===Ie.LocalVideoTrack&&!X("DISABLE_DUAL_STREAM_USE_ENCODING")&&Vt().supportDualStreamEncoding){const E=this.localTrackMap.get(Ie.LocalVideoLowTrack);if(E){const A=r._mediaStreamTrack.clone();E.track._originMediaStreamTrack.stop(),E.track._mediaStreamTrack=A,E.track._originMediaStreamTrack=A,await new Fe(((O,N)=>{this.handleReplaceTrack(E.track,O,N,!0)}))}}a()}catch(y){o(y)}finally{var g;(g=h)===null||g===void 0||g()}})),H(this,"handleGetRTCStats",(r=>{r(this.statsCollector.getRTCStats())})),H(this,"handleGetLocalVideoStats",(r=>{r(this.statsCollector.getLocalVideoTrackStats())})),H(this,"handleGetLocalAudioStats",(r=>{r(this.statsCollector.getLocalAudioTrackStats())})),H(this,"handleGetRemoteVideoStats",(r=>this.statsCollector.getRemoteVideoTrackStats(r.uid)[r.uid])),H(this,"handleGetRemoteAudioStats",(r=>this.statsCollector.getRemoteAudioTrackStats(r.uid)[r.uid])),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new lG(this.store),this.bindStatsUploaderEvents(),this.mutex=new oi("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Vt().supportUnifiedPlan||X("CHROME_FORCE_PLAN_B")&&ju(),this.shouldForwardP2PCreation=X("FORWARD_P2P_CREATION")&&Vt().supportPCSetConfiguration&&tD(),this.shouldForwardP2PCreation&&(this.connection=EA(this.store),this.emit(at.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var r;this.state=Zt.New,this._forceTurn=iG(e),k.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const a=this.shouldForwardP2PCreation&&((r=this.connection)===null||r===void 0?void 0:r.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||a||t)&&((a||t)&&this.connection&&(k.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=EA(this.store,e),this.emit(at.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new ve(q.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=X("NEW_ICE_RESTART")?Gu.FIRST_CONNECTION:Gu.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new ve(q.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(this.isPreallocation()&&this.state===Zt.Connected){if(this.connection instanceof Ks&&this.connection.checkDtlsParameters(e.dtlsParameters.fingerprints))return k.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),nt.reportApiInvoke(this.store.sessionId,{name:Xn.MISMATCH_DTLS_PARAMETERS,options:[e.dtlsParameters.fingerprints],tag:Dn.TRACER}).onSuccess(),void setTimeout((()=>{this.emit(at.RequestReconnect)}));await this.connection.updateRemoteConnect(e)}else this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Zt.Connected}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter((o=>{var u;let[h]=o;return je(u=[Ie.LocalVideoLowTrack,Ie.LocalVideoTrack]).call(u,h)})),r=t.map((o=>{let[,{id:u}]=o;return u})),a=t.map((o=>{let[u]=o;return u}));if(this.connection instanceof Ks){if(nt.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(a),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!je(e).call(e,this.store.codec)){const o=["vp9","vp8","h264"].find((u=>je(e).call(e,u)));o&&(this.store.codec=o,k.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(o,".")))}this.connection.updateRemoteRTPCapabilities(r,e)}}async getEstablishParams(){var e;if(this.connection instanceof Ks&&this.connection.peerConnectionState!=="closed"&&je(e=[Zt.New,Zt.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==Zt.Connected){if(this.state===Zt.Disconnected)throw new ve(q.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach((r=>{var a;je(a=this.pendingLocalDataChannels).call(a,r)||this.pendingLocalDataChannels.push(r)})),[]}const t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach((r=>{const a=Date.now();this.store.publish(r.id.toString(),"datachannel",a)})),await this.connection.createDataChannels(this.store.uid,t),t.forEach((r=>{this.localDataChannels.push(r);const a=Date.now();this.store.publish(r.id+"","datachannel",void 0,a)})),e.map((r=>({streamId:r.id,ordered:r.ordered,maxRetransmits:r.maxRetransmits,metadata:r.metadata,channelId:r._originDataChannelId}))))}publish(e,t,r){var a=this;return Bs((function*(){const o=yield jt(a.mutex.lock("From P2PChannel.publish"));try{var u;const h=a.connection&&je(u=["disconnected","failed"]).call(u,a.connection.peerConnectionState);if(!a.connection||a.state!==Zt.Connected||h){if(a.state===Zt.Disconnected)throw new ve(q.UNEXPECTED_ERROR,"PeerConnection already disconnected.");a.throwIfTrackTypeNotMatch(e);const g=e.filter((y=>a.pendingLocalTracks.indexOf(y)===-1));return a.pendingLocalTracks=a.pendingLocalTracks.concat(g),void(h&&(a._isWaitPcToRePub=!0))}a.store.pubId=a.store.pubId+1,di.markPublishStart(a.store.clientId,a.store.pubId);const m=a.filterTobePublishedTracks(e,t,r);if(m.length===0)return void(yield jt(a.tryToUnmuteAudio(e)));yield*gC(fG(a.doPublish(a.connection,m)))}finally{o()}}))()}doPublish(e,t){var r=this;return Bs((function*(){t.forEach((O=>{let{track:N,type:B}=O;const U=Date.now();r.store.publish(N.getTrackId(),B===Ie.LocalAudioTrack?"audio":"video",U)})),r.bindLocalTrackEvents(t);const a=t.map((O=>{let{track:N}=O;return N})),o=yield jt(e.send(a,r.store.codec,r.store.audioCodec)),u=(yield jt(o.next())).value,h=r.createGatewayPublishMessage(t,u);let m;try{m=yield h}catch(O){throw o.throw(O),O?.code===q.WS_ABORT&&t.forEach((N=>{let{track:B}=N;r.pendingLocalTracks.indexOf(B)===-1&&r.pendingLocalTracks.push(B)})),r.unbindLocalTrackEvents(t),O}const g=r.mapPubResToRemoteConfig(h,m,a),y=(yield jt(o.next(g))).value;if(r.state===Zt.Disconnected)throw new ve(q.UNEXPECTED_ERROR,"PeerConnection already disconnected.");X("ENABLE_VIDEO_SEI");const E=X("ENABLE_ENCODED_TRANSFORM"),A=X("ENABLE_AUDIO_METADATA");a.forEach((async O=>{const N=O.getRTCRtpTransceiver();if(!N||!E)return;const{interceptLocalVideoFrame:B,interceptLocalAudioFrame:U}=dA();O.trackMediaType===Xe.VIDEO?await B(N.sender,O):O.trackMediaType===Xe.AUDIO&&await U(N.sender,{metadata:A?()=>{const V=O.metadata.shift();return V&&V.value}:void 0})})),t.forEach((O=>{let{type:N}=O;r.statsCollector.addLocalStats(N)})),r.assignLocalTracks(t,y),r.statsUploader.startUploadOutboundStats(),t.forEach((O=>{let{track:N,type:B}=O;const U=Date.now();r.store.publish(N.getTrackId(),B===Ie.LocalAudioTrack?"audio":"video",void 0,U)}))}))()}async updateVideoStreamParameter(e,t){const r=this.localTrackMap.get(t);if(!r||!this.connection)return;if(!(r.track instanceof wn))return k.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:a}=r,o=(function(u,h){const m={};return u.height&&u.width&&(m.scaleResolutionDownBy=aP(u,h)),m.maxFramerate=u.framerate?Ja(u.framerate):void 0,m.maxBitrate=u.bitrate?1e3*u.bitrate:void 0,m})(e,a);if(a._encoderConfig||(a._encoderConfig={}),t!==Ie.LocalVideoLowTrack||!X("DISABLE_DUAL_STREAM_USE_ENCODING")&&Vt().supportDualStreamEncoding)o.scaleResolutionDownBy!=null&&(a._encoderConfig.scaleResolutionDownBy=o.scaleResolutionDownBy);else{const u=a._originMediaStreamTrack;if(!u.canvas)return k.warn("[".concat(a.getTrackId(),"] no canvas on track"));(function(h,m){const g=h.canvas;m.width&&(g.width=Ja(m.width)),m.height&&(g.height=Ja(m.height)),m.framerate&&(g.stopCapture&&g.stopCapture(),g.stopCapture=ND((()=>{!g.startCapture&&g.stopCapture&&g.stopCapture(),g.startCapture&&g.startCapture()}),Ja(m.framerate)))})(u,e)}o.maxBitrate!=null&&(a._encoderConfig.bitrateMax=o.maxBitrate/1e3),o.maxFramerate!=null&&(a._encoderConfig.frameRate&&typeof a._encoderConfig.frameRate=="object"?a._encoderConfig.frameRate.max=o.maxFramerate:a._encoderConfig.frameRate={max:o.maxFramerate}),k.debug("[".concat(a.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(a._encoderConfig))),await this.connection.updateRtpSenderEncodings(a)}publishLowStream(e){var t=this;return Bs((function*(){if(!t.connection||t.state!==Zt.Connected)return;const r=yield jt(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const o=t.localTrackMap.get(Ie.LocalVideoTrack);if(!o)throw new ve(q.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(Ie.LocalVideoLowTrack))throw new ve(q.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const u=[{track:t.getLowVideoTrack(o.track,e),type:Ie.LocalVideoLowTrack}];if(yield*gC(fG(t.doPublish(t.connection,u))),o.track.muted||!o.track.enabled){var a;const h=(a=t.localTrackMap.get(Ie.LocalVideoLowTrack))===null||a===void 0?void 0:a.id;h!==void 0&&(yield jt(t.connection.muteLocal([h])))}}finally{r()}}))()}async republish(){this.pendingLocalTracks.length>0&&(k.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ei(this,at.RequestRePublish,this.pendingLocalTracks),this.emit(at.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(k.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await ei(this,at.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:r,kind:a}=this.pendingRemoteTracks[t];(a!==Xe.AUDIO||r._audio_added_&&r._audioSSRC)&&(a!==Xe.VIDEO||r._video_added_&&r._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await ei(this,at.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:r}of this.pendingRemoteTracks)await this.subscribe(t,r,r===Xe.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach((t=>{let{user:r}=t;this.emit(at.MediaReconnectEnd,r.uid)})),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==Zt.Connected)return void e.forEach((a=>{const o=this.pendingLocalTracks.indexOf(a);o!==-1&&this.pendingLocalTracks.splice(o,1)}));const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const r=t.find((a=>a[0]==="videoLowTrack"));return r&&r[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==Zt.Connected)return void e.forEach((r=>{const a=this.pendingLocalDataChannels.indexOf(r);a!==-1&&this.pendingLocalDataChannels.splice(a,1)}));const t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach((r=>{const a=this.localDataChannels.indexOf(r);a!==-1&&this.localDataChannels.splice(a,1)})),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map((r=>r.id))):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Zt.Connected)return;const e=this.localTrackMap.get(Ie.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[Ie.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const r=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map((a=>{let[,{id:o}]=a;return o}))),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map((a=>{let[o,{track:u}]=a;return{type:o,track:u}}))),t.forEach((a=>{let[o]=a;this.statsCollector.removeLocalStats(o)})),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),r}async subscribeDataChannel(e,t){if(!this.connection||this.state!==Zt.Connected)throw new ve(q.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const r=t.filter((a=>{var o;return!((o=this.remoteDataChannelMap.get(e))!==null&&o!==void 0&&o.get(a.id))}));if(r.length!==0)return await this.connection.createDataChannels(e.uid,r),r.forEach((a=>{var o;this.remoteDataChannelMap.has(e)?(o=this.remoteDataChannelMap.get(e))===null||o===void 0||o.set(a.id,a):this.remoteDataChannelMap.set(e,new Map([[a.id,a]]));const u=this.pendingRemoteDataChannels.findIndex((h=>{let{user:m,id:g}=h;return m.uid===e.uid&&g===a.id}));u!==-1&&this.pendingRemoteDataChannels.splice(u,1)})),r.map((a=>a.id))}async subscribe(e,t,r,a,o){var u;if(!this.connection||this.state!==Zt.Connected)throw new ve(q.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((u=this.remoteUserMap.get(e))!==null&&u!==void 0&&u.has(t))return;let h,m,g,y;const E=this.connection.getPreMedia(r);if(E)k.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(r,", no need to send sub to gateway.")),g=E.transceiver,h=E.track,m=E.mid,y=E.player,E.firstVideoRender&&this.store.firstVideoFrameDecoded(e.uid,{firstPreRender:E.firstVideoRender});else if(o){const N=o.find((U=>{let{stream_type:V}=U;return V===t}));if(!N)throw new ve(q.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const B=await this.connection.receive(t,N.ssrcs,String(e._uintid),N.attributes);this.connection instanceof Ks&&(g=B.transceiver),h=B.track,m=B.id}else{const N=await this.connection.receive(t,[{ssrcId:r,rtx:a}],String(e._uintid),void 0);this.connection instanceof Ks&&(g=N.transceiver),h=N.track,m=N.id}if(t===Xe.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(h):(e._audioTrack=new Y_(h,e.uid,e._uintid,this.store),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),g&&e._audioTrack._updateRtpTransceiver(g),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(h):(e._videoTrack=new K_(h,e.uid,e._uintid,this.store,y),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId())),e._videoTrack.once(Hs.PLAY_START,(()=>{this.store.firstVideoFrameDecoded(e.uid,{playStart:Date.now()})})),e._videoTrack.once(Hs.PLAY_END,(()=>{this.store.firstVideoFrameDecoded(e.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(e)})),y?e._videoTrack.once(Hs.FIRST_FRAME_RENDER,(()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)})):e._videoTrack.once(Hs.FIRST_FRAME_DECODED,(()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)}))),g&&e._videoTrack._updateRtpTransceiver(g),this.bindRemoteTrackEvents(e,e._videoTrack)),g&&X("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:N,interceptRemoteAudioFrame:B}=dA();t==Xe.VIDEO?await N(g.receiver,{onSei:X("ENABLE_VIDEO_SEI")&&(U=>{var V;return(V=e._videoTrack)===null||V===void 0?void 0:V._onSei(U)})}):t==Xe.AUDIO&&await B(g.receiver,{enableTopn:!!X("ENABLE_AUDIO_TOPN"),enableMetadata:!!X("ENABLE_AUDIO_METADATA"),enablePts:!!X("ENABLE_AUDIO_PTS"),onMetadata:U=>{this.safeEmit(at.AudioMetadata,U)},onPts:U=>{this.safeEmit(at.AudioPts,U)}})}const A=this.remoteUserMap.get(e);A?A.set(t,m):this.remoteUserMap.set(e,new Map([[t,m]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const O=this.pendingRemoteTracks.findIndex((N=>{let{user:B,kind:U}=N;return B.uid===e.uid&&t===U}));O!==-1&&(this.pendingRemoteTracks.splice(O,1),this.emit(at.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==Zt.Connected)throw new ve(q.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter((o=>{var u;let{user:h,mediaType:m}=o;return!((u=this.remoteUserMap.get(h))!==null&&u!==void 0&&u.has(m))}));const t=[],r=new Map;e.forEach((o=>{if(!this.connection)return;const u=this.connection.getPreMedia(o.ssrcId);if(u){const{track:h,mid:m,transceiver:g,player:y}=u;r.set(o.ssrcId,{track:h,id:m,transceiver:g,player:y})}else t.push(o)}));const a=await this.connection.batchReceive(t.map((o=>{let{user:u,mediaType:h,ssrcId:m,rtxSsrcId:g}=o;return{kind:h,ssrcMsg:[{ssrcId:m,rtx:g}],mslabel:String(u._uintid)}})));t.forEach(((o,u)=>{r.set(o.ssrcId,a[u])}));for(const{user:o,mediaType:u,ssrcId:h}of e){const m=r.get(h);if(!m)return void k.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(o.uid," subscribe data,").concat(u,", ").concat(h));const{track:g,id:y,transceiver:E,player:A}=m;if(E&&X("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:B,interceptRemoteAudioFrame:U}=dA();u==Xe.VIDEO?await B(E.receiver,{onSei:X("ENABLE_VIDEO_SEI")&&(V=>{var K;return(K=o._videoTrack)===null||K===void 0?void 0:K._onSei(V)})}):u==Xe.AUDIO&&await U(E.receiver,{enableTopn:!!X("ENABLE_AUDIO_TOPN"),enableMetadata:!!X("ENABLE_AUDIO_METADATA"),enablePts:!!X("ENABLE_AUDIO_PTS"),onMetadata:V=>{this.safeEmit(at.AudioMetadata,V)},onPts:V=>{this.safeEmit(at.AudioPts,V)}})}if(u===Xe.AUDIO?(o._audioTrack?o._audioTrack._updateOriginMediaStreamTrack(g):(o._audioTrack=new Y_(g,o.uid,o._uintid,this.store),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(o._audioTrack.getTrackId()))),E&&o._audioTrack._updateRtpTransceiver(E),this.bindRemoteTrackEvents(o,o._audioTrack)):(o._videoTrack?o._videoTrack._updateOriginMediaStreamTrack(g):(o._videoTrack=new K_(g,o.uid,o._uintid,this.store,A),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(o._videoTrack.getTrackId()))),E&&o._videoTrack._updateRtpTransceiver(E),this.bindRemoteTrackEvents(o,o._videoTrack)),X("ENABLE_VIDEO_SEI")&&E){const{interceptRemoteVideoFrame:B,interceptRemoteAudioFrame:U}=dA();u==Xe.VIDEO?await B(E.receiver,{onSei:V=>{var K;(K=o._videoTrack)===null||K===void 0||K._onSei(V)}}):u==Xe.AUDIO&&await U(E.receiver)}const O=this.remoteUserMap.get(o);O?O.set(u,y):this.remoteUserMap.set(o,new Map([[u,y]])),this.statsCollector.addRemoteStats(o.uid),this.statsUploader.startUploadInboundStats();const N=this.pendingRemoteTracks.findIndex((B=>{let{user:U,kind:V}=B;return U.uid===o.uid&&u===V}));N!==-1&&(this.pendingRemoteTracks.splice(N,1),this.emit(at.MediaReconnectEnd,o.uid))}}async unsubscribe(e,t,r){const a=this.pendingRemoteTracks.filter((h=>{let{user:m,kind:g}=h;return t!==void 0?m.uid===e.uid&&t===g:m.uid===e.uid}));if(a.forEach((h=>{const m=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(m,1)})),this.connection&&this.state===Zt.Connected||r||a.forEach((h=>{let{kind:m}=h;var g;if(m===Xe.AUDIO)(g=e._audioTrack)===null||g===void 0||g._destroy(),e._audioTrack=void 0;else if(m===Xe.VIDEO){var y;(y=e._videoTrack)===null||y===void 0||y._destroy(),e._videoTrack=void 0}})),!this.connection||this.state!==Zt.Connected)return;const o=this.filterTobeUnSubscribedTracks(e,t);if(o.length===0)return;await this.connection.stopReceiving(o.map((h=>{let[,{id:m}]=h;return m})));const u=this.createUnsubscribeMessage(o);return this.withdrawRemoteTracks(o),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),o.forEach((h=>{let[m,{kind:g}]=h;var y,E;if(g===Xe.VIDEO&&m._videoSSRC&&((y=this.connection)===null||y===void 0||y.setStatsRemoteVideoIsReady(m._videoSSRC,!1)),g===Xe.VIDEO)this.unbindRemoteTrackEvents(m._videoTrack),r||((E=m._videoTrack)===null||E===void 0||E._destroy(),m._videoTrack=void 0);else if(g===Xe.AUDIO){var A;this.unbindRemoteTrackEvents(m._audioTrack),!r&&((A=m._audioTrack)===null||A===void 0||A._destroy(),m._audioTrack=void 0)}})),u}async unsubscribeDataChannel(e,t){if(t.forEach((o=>{const u=this.pendingRemoteDataChannels.findIndex((h=>h.id===o.id));u!==-1&&this.pendingRemoteDataChannels.splice(u,1)})),!this.connection)return;const r=this.filterTobeUnSubscribedDataChannels(e,t);if(r.length===0)return;t.forEach((o=>{o._close()}));const a=this.remoteDataChannelMap.get(e);return r.forEach((o=>{a&&a.delete(o.id)})),a&&a.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),r.map((o=>o.id))}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:o,mediaType:u}of e){const h=this.pendingRemoteTracks.filter((m=>{let{user:g,kind:y}=m;return u!==void 0?g.uid===o.uid&&u===y:g.uid===o.uid}));h.forEach((m=>{const g=this.pendingRemoteTracks.indexOf(m);this.pendingRemoteTracks.splice(g,1)})),t=t.concat(h)}if(!this.connection||this.state!==Zt.Connected)return void t.forEach((o=>{let{user:u,kind:h}=o;var m;if(h===Xe.AUDIO)(m=u._audioTrack)===null||m===void 0||m._destroy(),u._audioTrack=void 0;else if(h===Xe.VIDEO){var g;(g=u._videoTrack)===null||g===void 0||g._destroy(),u._videoTrack=void 0}}));const r=vi(e).call(e,((o,u)=>{let{user:h,mediaType:m}=u;const g=this.filterTobeUnSubscribedTracks(h,m);return o.concat(g)}),[]);if(r.length===0)return;await this.connection.stopReceiving(r.map((o=>{let[,{id:u}]=o;return u})));const a=this.createUnsubscribeAllMessage(r);return this.withdrawRemoteTracks(r),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),r.forEach((o=>{let[u,{kind:h}]=o;var m,g;if(h===Xe.VIDEO&&u._videoSSRC&&((m=this.connection)===null||m===void 0||m.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),h===Xe.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),(g=u._videoTrack)===null||g===void 0||g._destroy(),u._videoTrack=void 0;else if(h===Xe.AUDIO){var y;this.unbindRemoteTrackEvents(u._audioTrack),(y=u._audioTrack)===null||y===void 0||y._destroy(),u._audioTrack=void 0}})),a}isPreSubScribe(e){return!this.connection||this.state!==Zt.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;const r=this.remoteUserMap.get(e);if(!r)return void k.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!r.get(t))return void k.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const a=t===Xe.VIDEO?e._videoSSRC:e._audioSSRC;a!==void 0&&this.connection.setStatsRemoteVideoIsReady(a,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const r=this.remoteUserMap.get(e);if(!r)return void k.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));r.get(t)||k.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}addAudioMetadata(e){const t=this.localTrackMap.get(Ie.LocalAudioTrack),r=t&&t.track;r&&r.metadata.push(e)}getAllTracks(e){const t=this.localTrackMap.get(Ie.LocalAudioTrack);if(t?.track instanceof dr){const r=t.track;return Array.from(this.localTrackMap.entries()).filter((a=>{let[o]=a;return o!==Ie.LocalAudioTrack})).filter((a=>{let[o]=a;return!(e&&o===Ie.LocalVideoLowTrack)})).map((a=>{let[,{track:o}]=a;return o})).concat(r.trackList)}return Array.from(this.localTrackMap.entries()).filter((r=>{let[a]=r;return!(e&&a===Ie.LocalVideoLowTrack)})).map((r=>{let[,{track:a}]=r;return a}))}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,r,a,o){if(e){const h=this.localTrackMap.get(Ie.LocalAudioTrack),m=a?this.localTrackMap.get(Ie.LocalVideoLowTrack):this.localTrackMap.get(Ie.LocalVideoTrack);nt.publish(this.store.sessionId,{eventElapse:di.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:h?.track.getTrackLabel(),videoName:m?.track.getTrackLabel(),screenshare:m?.track._hints.indexOf(un.SCREEN_TRACK)!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:o})}else{var u;r||(r=[]);const h=r.find((g=>g instanceof zn)),m=a?(u=this.localTrackMap.get(Ie.LocalVideoTrack))===null||u===void 0?void 0:u.track:r.find((g=>g instanceof wn));nt.publish(this.store.sessionId,{eventElapse:di.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:h?.getTrackLabel(),videoName:m?.getTrackLabel(),screenshare:m?._hints.indexOf(un.SCREEN_TRACK)!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:o})}}reportSubscribeEvent(e,t,r,a){const o=a===Xe.VIDEO?r._videoSSRC:r._audioSSRC;o&&nt.subscribe(this.store.sessionId,{succ:e,ec:t,video:a===Xe.VIDEO,audio:a===Xe.AUDIO,peerid:r.uid,subscribeRequestid:o,p2pid:this.store.p2pId,eventElapse:di.measureFromSubscribeStart(this.store.clientId,o),preSsrc:this.isPreSubScribe(o)})}reset(){k.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new oi("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=EA(this.store),this.emit(at.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(Ie.LocalAudioTrack);if(e?.track instanceof dr){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach((r=>{t.removeAudioTrack(r)}))}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Zt.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(Ie.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(Ie.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof wn||t&&t.track instanceof zn?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}getRemoteMedia(e){var t;const r=Array.from(Aa(t=this.remoteUserMap).call(t)).find((a=>a.uid===e));return r?{audioTrack:r.audioTrack,audioSSRC:r._audioSSRC,videoTrack:r.videoTrack,videoSSRC:r._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map((r=>{let[a]=r;return{uid:a.uid,level:a.audioTrack?100*a.audioTrack._source.getAccurateVolumeLevel():0}}));const t=this.localTrackMap.get(Ie.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=_(e).call(e,((r,a)=>r.level-a.level)),e}async disconnectForReconnect(){this.connection&&(k.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Zt.Reconnecting,X("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t]=e;var r;t._videoTrack&&t._videoTrack._player&&((r=t._videoTrack._player.getVideoElement())===null||r===void 0||r.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())})),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=EA(this.store),this.emit(at.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach((e=>{var t;let[r,{track:a}]=e;switch(r){case Ie.LocalVideoTrack:je(t=a._hints).call(t,un.LOW_STREAM)?a.close():this.pendingLocalTracks.push(a);break;case Ie.LocalAudioTrack:a instanceof dr?this.pendingLocalTracks=this.pendingLocalTracks.concat(a.trackList):this.pendingLocalTracks.push(a);case Ie.LocalVideoLowTrack:}})),this.emit(at.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,r]=e;Array.from(Aa(r).call(r)).forEach((a=>{this.setPendingRemoteMedia(t,a)})),this.emit(at.MediaReconnectStart,t.uid)})),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach((e=>{this.pendingLocalDataChannels.push(e)})),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach((e=>{let[t,r]=e;Array.from(Aa(r).call(r)).forEach((a=>{this.setPendingRemoteDataChannel(t,a)}))})),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),k.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const r of this.pendingRemoteDataChannels){const{user:a,id:o}=r;if((e instanceof Gh?e.uid:e)===a.uid&&o===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const r of this.pendingRemoteTracks){const{user:a,kind:o}=r;if((e instanceof Gh?e.uid:e)===a.uid&&t===o)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return Bs((function*(){if(!t.connection||t.state!==Zt.Connected)return;const r=yield jt(t.mutex.lock("From P2PChannel.restartICE"));let a;try{a=yield jt(t.connection.restartICE(e));const u=yield jt(a.next());if(u.done)return;const h=u.value,m=yield h;switch(wP(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case ui.UDP_TCP_RELAY:t._pcStatsUploadType=Gu.UDP_TCP_RESTART;break;case ui.TCP_RELAY:t._pcStatsUploadType=Gu.TCP_RESTART;break;case ui.RELAY:t._pcStatsUploadType=Gu.RELAY_RESTART;break;default:t._pcStatsUploadType=Gu.OLD_RESTART}t._isTryConnecting=!0,a.next(m)}catch(u){var o;(o=a)===null||o===void 0||o.throw(u)}finally{r()}}))()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(Ie.LocalVideoTrack),r=this.localTrackMap.get(Ie.LocalAudioTrack),a=e.videoSend.find((N=>N.ssrc===t?.ssrcs[0].ssrcId)),o=e.audioSend.find((N=>N.ssrc===r?.ssrcs[0].ssrcId));if(!a||!o)return 1;const u=_s(this,at.NeedSignalRTT),h=a?a.rttMs:void 0,m=o?o.rttMs:void 0,g=h&&m?(h+m)/2:h||m,y=(g&&u?(g+u)/2:g||u)||0,E=100*e.sendPacketLossRate*.7/50+.3*y/1500,A=E<.17?1:E<.36?2:E<.59?3:E<.1?4:5,O=t?.track;if(O&&O._encoderConfig&&O._hints.indexOf(un.SCREEN_TRACK)===-1){const N=O._encoderConfig.bitrateMax,B=e.bitrate.actualEncoded;if(N&&B){const U=(1e3*N-B)/(1e3*N);return Q6[U<.15?0:U<.3?1:U<.45?2:U<.6?3:4][A]}}return A}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach((r=>{let[a]=r;const o=a._audioSSRC,u=a._videoSSRC,h=e.audioRecv.find((B=>B.ssrc===o)),m=e.videoRecv.find((B=>B.ssrc===u));if(!h&&!m)return void(t+=1);const g=_s(this,at.NeedSignalRTT),y=e.rtt,E=(y&&g?(y+g)/2:y||g)||0,A=h?h.jitterMs:void 0,O=e.recvPacketLossRate;let N=.7*O*100/50+.3*E/1500;A&&(N=.6*O*100/50+.2*E/1500+.2*A/400),t+=N<.1?1:N<.17?2:N<.36?3:N<.59?4:5})),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new Fe(((t,r)=>{this.handleMuteLocalTrack(e,t,r)}))}async replaceTrack(e,t){var r;if(k.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==Zt.Connected)return;const a=Array.from(this.localTrackMap.entries()).find((u=>{let[,{track:h}]=u;return e===h}));if(!a)return;const o=a[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:o}]),this.bindLocalTrackEvents([{track:t,type:o}]),a[1].track=t),await((r=this.connection)===null||r===void 0?void 0:r.replaceTrack(t,a[1].id)),this.isPlanB){const u=a[1];u.id=t._mediaStreamTrack.id,this.localTrackMap.set(o,u)}if(o===Ie.LocalVideoTrack&&!X("DISABLE_DUAL_STREAM_USE_ENCODING")&&Vt().supportDualStreamEncoding){const u=this.localTrackMap.get(Ie.LocalVideoLowTrack);if(u){const h=e._mediaStreamTrack.clone();u.track._originMediaStreamTrack.stop(),u.track._mediaStreamTrack=h,u.track._originMediaStreamTrack=h,await new Fe(((m,g)=>{this.handleReplaceTrack(u.track,m,g,!0)}))}}}filterTobePublishedTracks(e,t,r){const a=[],o=this.getAllTracks();e=P_(e=e.filter((g=>o.indexOf(g)===-1)));let u,h=!1;const m=this.localTrackMap.get(Ie.LocalAudioTrack);for(const g of e){if(g instanceof wn&&(this.localTrackMap.has(Ie.LocalVideoTrack)||h?new ve(q.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(a.push({track:g,type:Ie.LocalVideoTrack}),h=!0),t)){const y=this.getLowVideoTrack(g,r);a.push({track:y,type:Ie.LocalVideoLowTrack})}if(g instanceof zn)if(m){const y=m.track;if(y instanceof dr)bP([g]),y.addAudioTrack(g),this.bindLocalAudioTrackEvents(g,!0);else{const E=TP([y,g]);k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(E.getTrackId(),"]")),this.replaceTrack(y,E)}}else u instanceof dr?(bP([g]),u.addAudioTrack(g)):u||!g._useAudioElement&&Vt().webAudioMediaStreamDest&&!g._bypassWebAudio?u=TP(u?[g,u]:[g]):u=g}return u&&(k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(u.getTrackId(),"]")),a.push({track:u,type:Ie.LocalAudioTrack})),a}filterTobeUnpublishedTracks(e){const t=[],r=this.getAllTracks();e=P_(e=e.filter((a=>r.indexOf(a)!==-1)));for(const a of e){if(a instanceof zn){const o=this.localTrackMap.get(Ie.LocalAudioTrack);if(!o)continue;o.track instanceof dr?(o.track.removeAudioTrack(a),this.unbindLocalAudioTrackEvents(a),o.track.trackList.length===0&&(t.push([Ie.LocalAudioTrack,o]),o.track.close())):t.push([Ie.LocalAudioTrack,o])}if(a instanceof wn){const o=this.localTrackMap.get(Ie.LocalVideoTrack);if(!o)continue;t.push([Ie.LocalVideoTrack,o]);const u=this.localTrackMap.get(Ie.LocalVideoLowTrack);u&&t.push([Ie.LocalVideoLowTrack,u])}}return t}filterTobePublishedDataChannels(e){return e=(e=P_(e)).filter((t=>this.localDataChannels.findIndex((r=>r.id===t.id))===-1))}filterTobeUnpublishedDataChannels(e){return e=(e=(e=P_(e)).filter((t=>this.localDataChannels.indexOf(t)!==-1))).filter((t=>t._originDataChannel))}bindLocalTrackEvents(e){e.forEach((t=>{let{track:r,type:a}=t;switch(a){case Ie.LocalVideoTrack:r.addListener($e.GET_STATS,this.handleGetLocalVideoStats),r.addListener($e.GET_RTC_STATS,this.handleGetRTCStats),r.addListener($e.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener($e.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener($e.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.addListener($e.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.addListener($e.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.addListener($e.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener($e.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ie.LocalAudioTrack:this.bindLocalAudioTrackEvents(r);case Ie.LocalVideoLowTrack:}}))}bindLocalAudioTrackEvents(e,t){e instanceof dr?e.trackList.forEach((r=>{r.addListener($e.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener($e.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener($e.GET_STATS,this.handleGetLocalAudioStats),r.addListener($e.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener($e.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.addListener($e.GET_STATS,this.handleGetLocalAudioStats),e.addListener($e.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener($e.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener($e.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener($e.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener($e.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener($e.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map((t=>{let[r,{track:a}]=t;return{track:a,type:r}}))),e.forEach((t=>{let{track:r,type:a}=t;switch(a){case Ie.LocalVideoTrack:r.off($e.GET_STATS,this.handleGetLocalVideoStats),r.off($e.GET_RTC_STATS,this.handleGetRTCStats),r.off($e.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off($e.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off($e.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.off($e.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.off($e.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.off($e.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off($e.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ie.LocalAudioTrack:this.unbindLocalAudioTrackEvents(r);case Ie.LocalVideoLowTrack:}}))}unbindLocalAudioTrackEvents(e){e instanceof dr?e.trackList.forEach((t=>{t.off($e.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off($e.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off($e.GET_STATS,this.handleGetLocalAudioStats),t.off($e.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off($e.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.off($e.GET_STATS,this.handleGetLocalAudioStats),e.off($e.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off($e.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off($e.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off($e.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off($e.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off($e.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof K_&&t.addListener($e.GET_STATS,(r=>{r(this.handleGetRemoteVideoStats(e))})),t instanceof Y_&&t.addListener($e.GET_STATS,(r=>{r(this.handleGetRemoteAudioStats(e))}))}unbindRemoteTrackEvents(e){e&&e.removeAllListeners($e.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,r]=e;r.has(Xe.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),r.has(Xe.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)}))}createGatewayPublishMessage(e,t){return e.map(((r,a)=>{var o;let u,h,{track:m,type:g}=r;switch(g){case Ie.LocalAudioTrack:u=Qt.Audio,h={dtx:m instanceof $0&&m._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Ie.LocalVideoTrack:u=je(o=m._hints).call(o,un.SCREEN_TRACK)?Qt.Screen:Qt.High,h=Ul(Ul({},m8(m)),{},{codec:this.store.codec,svc_mode:sA()});break;case Ie.LocalVideoLowTrack:u=Qt.Low,h=Ul(Ul({},m8(m)),{},{codec:this.store.codec,svc_mode:sA()})}return{stream_type:u,attributes:h,ssrcs:t[a]}}))}createGatewayUnpublishMessage(e){return e.map((t=>{var r;let a,[o,{track:u,ssrcs:h,id:m}]=t;switch(o){case Ie.LocalVideoTrack:a=je(r=u._hints).call(r,un.SCREEN_TRACK)?Qt.Screen:Qt.High;break;case Ie.LocalAudioTrack:a=Qt.Audio;break;case Ie.LocalVideoLowTrack:a=Qt.Low}return{stream_type:a,ssrcs:h,mid:m}}))}assignLocalTracks(e,t){e.forEach(((r,a)=>{let{track:o,type:u}=r;this.localTrackMap.set(u,{track:o,id:t[a].id,ssrcs:t[a].localSSRC})}))}withdrawLocalTracks(e){e.forEach((t=>{let[r]=t;this.localTrackMap.delete(r)}))}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(at.PeerConnectionStateChange,t),t==="connecting"&&e instanceof Ks&&!Vn()&&X("FIRST_TCP_CANDIDATE")&&window.setTimeout((()=>{t==="connecting"&&e.extendCandidate()}),X("FIRST_TCP_CANDIDATE_INTERVAL")),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof Ks&&uG(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=Gu.DISCONNECTED_OR_FAILED,_s(this,at.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const r=this.pendingLocalTracks.map((o=>o.getTrackId())),a=this.pendingLocalDataChannels.map((o=>"dc_".concat(o.id)));nt.reportApiInvoke(this.store.sessionId,{name:Xn.REPUB_AFTER_PC_CONNECTED,options:r.concat(a),tag:Dn.TRACER}).onSuccess(),this.republish()}if(X("NEW_ICE_RESTART")&&e instanceof Ks&&!Vn()&&!this._forceTurn){if(je(l8).call(l8,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const r=o=>{wP(e)&&(k.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(o)),_s(this,at.QueryClientConnectionState)==="CONNECTED"&&this.emit(at.RequestRestartICE,o))},a=()=>{wP(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),k.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout((()=>this.emit(at.P2PLost)),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout((()=>{dG(e,r,a)}),800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout((()=>{e.iceConnectionState==="disconnected"&&X("ICE_RESTART")&&_s(this,at.QueryClientConnectionState)==="CONNECTED"&&this.emit(at.RequestRestartICE)}),800),void setTimeout((()=>{e.peerConnectionState==="disconnected"&&(k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout((()=>this.emit(at.P2PLost)),0),this.iceFailedCount+=1,this.requestReconnect())}),4e3);t==="failed"&&(k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout((()=>this.emit(at.P2PLost)),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),nt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Dn.TRACER}).onSuccess(),this.emit(at.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var r;const a=Array.from(Aa(r=this.remoteUserMap).call(r)).find((u=>u._audioSSRC===t));var o;a&&(this.store.subscribe(a.uid,"audio",void 0,void 0,void 0,Date.now()),(o=a.audioTrack)===null||o===void 0||o.emit(Hs.FIRST_FRAME_DECODED),nt.firstRemoteFrame(this.store.sessionId,yr.FIRST_AUDIO_DECODE,Nn.FIRST_AUDIO_DECODE,{peer:a._uintid,subscribeElapse:di.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var r;const a=Array.from(Aa(r=this.remoteUserMap).call(r)).find((o=>o._audioSSRC===t));a&&nt.firstRemoteFrame(this.store.sessionId,yr.FIRST_AUDIO_RECEIVED,Nn.FIRST_AUDIO_RECEIVED,{peer:a._uintid,subscribeElapse:di.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,r,a)=>{var o;const u=Array.from(Aa(o=this.remoteUserMap).call(o)).find((h=>h._videoSSRC===t));u&&this.store.firstVideoFrameDecoded(u.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(t,r,a)},e.onFirstVideoRender=t=>{var r;const a=Array.from(Aa(r=this.remoteUserMap).call(r)).find((o=>o._videoSSRC===t));a&&(this.store.firstVideoFrameDecoded(a.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(a))},e.onFirstVideoReceived=t=>{var r;const a=Array.from(Aa(r=this.remoteUserMap).call(r)).find((o=>o._videoSSRC===t));a&&(this.store.firstVideoFrameDecoded(a.uid,{firstReceived:Date.now()}),nt.firstRemoteFrame(this.store.sessionId,yr.FIRST_VIDEO_RECEIVED,Nn.FIRST_VIDEO_RECEIVED,{peer:a._uintid,subscribeElapse:di.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onSelectedLocalCandidateChanged=(t,r)=>{const a=t.candidateType==="relay",o=r.candidateType==="relay";r.candidateType!=="unknown"&&a===o||this.emit(at.ConnectionTypeChange,a),k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Uh(r))," -> ").concat(JSON.stringify(Uh(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,r)=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Uh(r))," -> ").concat(JSON.stringify(Uh(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const t=this.statsCollector.getLocalVideoTrackStats(),r=this.statsCollector.getRTCStats();return Ul(Ul({},t),r)},e.onICECandidateError=t=>{this._iceError=t}}resetConnection(e){e instanceof Ks&&(function(t){sv.delete(t.id),uG(t)})(e),e.close(),this.emit(at.PeerConnectionStateChange,"closed"),(function(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.getLocalVideoStats=void 0})(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const r=this.localTrackMap.get(Ie.LocalAudioTrack);if(e instanceof zn&&r?.track instanceof dr)return r.track.isActive||t.push([Ie.LocalAudioTrack,r]),t;const a=Array.from(this.localTrackMap.entries()).find((o=>{let[,{track:u}]=o;return e===u}));if(a&&(t.push(a),a[0]===Ie.LocalVideoTrack)){const o=this.localTrackMap.get(Ie.LocalVideoLowTrack);o&&t.push([Ie.LocalVideoLowTrack,o])}return t}filterTobeUnmutedTracks(e){const t=[],r=this.localTrackMap.get(Ie.LocalAudioTrack);if(e instanceof zn&&r?.track instanceof dr)return r.track.isActive&&t.push([Ie.LocalAudioTrack,r]),t;const a=Array.from(this.localTrackMap.entries()).find((o=>{let[,{track:u}]=o;return e===u}));if(a)if(a[0]===Ie.LocalVideoTrack){t.push(a);const o=this.localTrackMap.get(Ie.LocalVideoLowTrack);o&&t.push([Ie.LocalVideoLowTrack,o])}else t.push(a);return t}createMuteMessage(e){return e.map((t=>{var r;let a,[o,{track:u,ssrcs:h,id:m}]=t;switch(o){case Ie.LocalAudioTrack:a=Qt.Audio;break;case Ie.LocalVideoTrack:a=je(r=u._hints).call(r,un.SCREEN_TRACK)?Qt.Screen:Qt.High;break;case Ie.LocalVideoLowTrack:a=Qt.Low}return{stream_type:a,ssrcs:h,mid:m}}))}createUnmuteMessage(e){return e.map((t=>{var r;let a,[o,{track:u,ssrcs:h,id:m}]=t;switch(o){case Ie.LocalAudioTrack:a=Qt.Audio;break;case Ie.LocalVideoTrack:a=je(r=u._hints).call(r,un.SCREEN_TRACK)?Qt.Screen:Qt.High;break;case Ie.LocalVideoLowTrack:a=Qt.Low}return{stream_type:a,ssrcs:h,mid:m}}))}filterTobeUnSubscribedTracks(e,t){const r=[],a=this.remoteUserMap.get(e);if(!a)return r;if(t){const o=a.get(t);if(!o)return r;r.push([e,{kind:t,id:o}])}else Array.from(a.entries()).forEach((o=>{let[u,h]=o;r.push([e,{kind:u,id:h}])}));return r}filterTobeUnSubscribedDataChannels(e,t){const r=[];return t.forEach((a=>{var o;(o=this.remoteDataChannelMap.get(e))!==null&&o!==void 0&&o.has(a.id)&&r.push(a)})),r}createUnsubscribeMessage(e){const t=[];return e.forEach((r=>{let[a,{kind:o,id:u}]=r;switch(o){case Xe.VIDEO:return void(a._videoSSRC&&t.push({stream_type:Xe.VIDEO,ssrcId:a._videoSSRC}));case Xe.AUDIO:return void(a._audioSSRC&&t.push({stream_type:Xe.AUDIO,ssrcId:a._audioSSRC}))}})),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach((r=>{let[a,{kind:o}]=r;if(t.has(a)){let u=t.get(a);o===Xe.VIDEO?u|=Ar.Video:u|=Ar.Audio,t.set(a,u)}else o===Xe.VIDEO?t.set(a,Ar.Video):t.set(a,Ar.Audio)})),{users:Array.from(t.entries()).map((r=>{let[a,o]=r;return{stream_id:a.uid,stream_type:o}}))}}withdrawRemoteTracks(e){e.forEach((t=>{let[r,{kind:a}]=t;const o=this.remoteUserMap.get(r);o&&(o.delete(a),Array.from(o.entries()).length===0&&this.remoteUserMap.delete(r))}))}async updateBitrateLimit(e){const t=this.localTrackMap.get(Ie.LocalVideoTrack),r=this.localTrackMap.get(Ie.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new Fe(((a,o)=>{this.handleUpdateVideoEncoder(t.track,a,o,!0)}))),r&&e.low_stream_uplink&&(await r.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new Fe(((a,o)=>{this.handleUpdateVideoEncoder(r.track,a,o,!0)})))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return this.connection instanceof Ks&&this.connection.isPreallocation}isPreSub(){return this.connection instanceof Ks&&this.connection.isPreSub()}mapPubResToRemoteConfig(e,t,r){return e.map(((a,o)=>{var u;let{stream_type:h}=a;const m=(u=t.find((g=>{let{stream_type:y}=g;return h===y})))===null||u===void 0?void 0:u.attributes;if(m&&X("DISABLE_SCREEN_SHARE_REMB")){const g=r[o]._hints;(je(g).call(g,un.SCREEN_TRACK)||je(g).call(g,un.SCREEN_LOW_TRACK))&&(m.remb=!1,k.debug("disable remb for screen share, hints:",g))}return m}))}async tryToUnmuteAudio(e){for(let r=0;r<e.length;r++)if(e[r]instanceof zn){var t;const a=this.filterTobeUnmutedTracks(e[r]);if(a.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(a.map((u=>{let[,{id:h}]=u;return h}))));const o=this.createUnmuteMessage(a);return void await hn(this,at.RequestUnmuteLocal,o)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(at.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(at.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Hr(lD(this.dtlsFailedCount,sr)),this.emit(at.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await ei(this,at.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(at.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Ie.LocalVideoTrack)||this.pendingLocalTracks.some((e=>e instanceof wn))}throwIfTrackTypeNotMatch(e){if(e.filter((t=>t instanceof wn)).length>1)throw new ve(q.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter((t=>t instanceof zn)).length>1&&(e.some((t=>t instanceof zn&&t._bypassWebAudio))||!Vt().webAudioMediaStreamDest))throw new ve(q.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof wn&&this.pendingLocalTracks.some((r=>r instanceof wn)))throw new ve(q.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof zn&&this.pendingLocalTracks.some((r=>r instanceof zn))&&(!Vt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some((r=>r instanceof zn&&r._bypassWebAudio))))throw new ve(q.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var r;const a=!X("DISABLE_DUAL_STREAM_USE_ENCODING")&&Vt().supportDualStreamEncoding,o=Ul(Ul({},{width:160,height:120,framerate:15,bitrate:50}),t);let u;u=a?e._mediaStreamTrack.clone():RP(e,o);const h=fn(8,"track-low-"),m=new wn(u,Ul(Ul({},a&&{scaleResolutionDownBy:aP(o,e)}),{},{frameRate:o.framerate,bitrateMax:o.bitrate,bitrateMin:o.bitrate}),void 0,void 0,h);return m.on(Pp.TRANSCEIVER_UPDATED,(g=>{e._updateRtpTransceiver(g,B_.LOW_STREAM)})),m._hints.push(un.LOW_STREAM),je(r=e._hints).call(r,un.SCREEN_TRACK)&&m._hints.push(un.SCREEN_LOW_TRACK),e.on("sei-to-send",(g=>{m.emit("sei-to-send",g)})),e.addListener($e.NEED_CLOSE,(()=>{m.close()})),m}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,r){let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Ks){var o,u,h,m;const g=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:y,dtlsTransportState:E,peerConnectionState:A}=this.connection,{local:O,remote:N}=await this.connection.getSelectedCandidatePair();nt.pcStats(this.store.sessionId,{startTime:g,eventElapse:e-g||0,iceconnectionsate:y,dtlsstate:E,connectionstate:A,intSucc:t?1:2,error:this._iceError||a||"",selectedLocalCandidateProtocol:(o=O?.protocol)!==null&&o!==void 0?o:"",selectedLocalCandidateType:(u=O.candidateType)!==null&&u!==void 0?u:"",selectedLocalCandidateAddress:"".concat(O.address,":").concat(O.port),selectedRemoteCandidateProtocol:(h=N.protocol)!==null&&h!==void 0?h:"",selectedRemoteCandidateType:(m=N.candidateType)!==null&&m!==void 0?m:"",selectedRemoteCandidateAddress:"".concat(N.address,":").concat(N.port),restartCnt:r,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(e){const t=this.store.keyMetrics,r=t.firstVideoFrameDecoded.find((E=>E.userId===e.uid));if(!r)return;const{isInternalUpload:a,isExternalUpload:o}=r;if(a&&o)return;const{subscribeEnd:u,firstPreRender:h,peerPublishDuration:m,peerPubStatusMs:g}=r;let{firstRender:y=0}=r;if(u&&(y||h)&&m&&g){r.isInternalUpload=!0;const{playEnd:E}=r;E&&(r.isExternalUpload=!0);const{firstPreRender:A=0}=r;y=A||y;const O=e.videoTrack,N={peer:e._uintid,width:O?._videoWidth||0,height:O?._videoHeight||0,ssrc:e._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:m,peerPubStatusMs:g,joinChannelStart:t.joinStart||0,preloadStart:t.preloadStart||0,preloadEnd:t.preloadEnd||0,apStart:t.requestAPStart||0,apEnd:t.requestAPEnd||0,suaEnd:t.requestSUAEnd||0,beforeConnect:t.beforeConnect||0,peerReceiver:t.peerReceiver||0,ice:t.iceConnectionEnd||0,pc:t.peerConnectionEnd||0,signalConnected:t.signalConnected||0,joinReq:t.joinReq||0,joinRes:t.joinRep||0,userJoinNotify:r.userJoinNotify||0,videoAddNotify:r.videoAddNotify||0,subscribeStart:r.subscribeStart||0,subscribeEnd:r.subscribeEnd||0,firstReceived:r.firstReceived||0,firstDecoded:r.firstDecoded||0,firstPreRender:A||0,firstRender:E?Math.max(y,E):Math.max(y,u),playStart:r.playStart||0,playEnd:r.playEnd||0,isPreSub:!(!e._videoSSRC||!this.isPreSubScribe(e._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:V5(this.store)};nt.firstXLAPeerFirstVideoFrame(this.store.sessionId,N)}}reportVideoFirstFrameDecoded(e,t,r,a){var o;const u=Array.from(Aa(o=this.remoteUserMap).call(o)).find((h=>h._videoSSRC===e));if(u){a||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find((g=>g.userId===u.uid&&g.type==="video"));nt.firstRemoteVideoDecode(this.store.sessionId,yr.FIRST_VIDEO_DECODE,Nn.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:t,videoheight:r,subscribeElapse:di.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:m?.subscribeEnd||0,subscriberStart:m?.subscribeStart||0,videoAddNotify:m?.streamAdded||0,state:a?1:0,firstFrame:m?.firstFrame||0})}}async remoteMediaSsrcChanged(e,t,r){if(!this.connection)return!1;const a=this.remoteUserMap.get(e);if(!a)return!1;const o=a.get(t);if(!o)return!1;const u=await this.connection.getRemoteSSRC(o);return u!==void 0&&u!==r}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach((e=>{let[t,{track:r}]=e;t===Ie.LocalVideoLowTrack?r._updateRtpTransceiver(void 0,B_.LOW_STREAM):r._updateRtpTransceiver(void 0)}))}},Qe(It.prototype,"startP2PConnection",[Mi],Object.getOwnPropertyDescriptor(It.prototype,"startP2PConnection"),It.prototype),Qe(It.prototype,"connect",[Mi],Object.getOwnPropertyDescriptor(It.prototype,"connect"),It.prototype),Qe(It.prototype,"updateRemoteRTPCapabilities",[Mi],Object.getOwnPropertyDescriptor(It.prototype,"updateRemoteRTPCapabilities"),It.prototype),Qe(It.prototype,"publishDataChannel",[Mi],Object.getOwnPropertyDescriptor(It.prototype,"publishDataChannel"),It.prototype),Qe(It.prototype,"unpublish",[Mi],Object.getOwnPropertyDescriptor(It.prototype,"unpublish"),It.prototype),Qe(It.prototype,"unpublishDataChannel",[Mi],Object.getOwnPropertyDescriptor(It.prototype,"unpublishDataChannel"),It.prototype),Qe(It.prototype,"unpublishLowStream",[Mi],Object.getOwnPropertyDescriptor(It.prototype,"unpublishLowStream"),It.prototype),Qe(It.prototype,"subscribeDataChannel",[Mi],Object.getOwnPropertyDescriptor(It.prototype,"subscribeDataChannel"),It.prototype),Qe(It.prototype,"subscribe",[Mi],Object.getOwnPropertyDescriptor(It.prototype,"subscribe"),It.prototype),Qe(It.prototype,"massSubscribe",[Mi],Object.getOwnPropertyDescriptor(It.prototype,"massSubscribe"),It.prototype),Qe(It.prototype,"unsubscribe",[Mi],Object.getOwnPropertyDescriptor(It.prototype,"unsubscribe"),It.prototype),Qe(It.prototype,"unsubscribeDataChannel",[Mi],Object.getOwnPropertyDescriptor(It.prototype,"unsubscribeDataChannel"),It.prototype),Qe(It.prototype,"massUnsubscribe",[Mi],Object.getOwnPropertyDescriptor(It.prototype,"massUnsubscribe"),It.prototype),Qe(It.prototype,"muteRemote",[Mi],Object.getOwnPropertyDescriptor(It.prototype,"muteRemote"),It.prototype),Qe(It.prototype,"unmuteRemote",[Mi],Object.getOwnPropertyDescriptor(It.prototype,"unmuteRemote"),It.prototype),Qe(It.prototype,"hasRemoteMediaWithLock",[Mi],Object.getOwnPropertyDescriptor(It.prototype,"hasRemoteMediaWithLock"),It.prototype),Qe(It.prototype,"disconnectForReconnect",[Mi],Object.getOwnPropertyDescriptor(It.prototype,"disconnectForReconnect"),It.prototype),Qe(It.prototype,"updateBitrateLimit",[Mi],Object.getOwnPropertyDescriptor(It.prototype,"updateBitrateLimit"),It.prototype),Qe(It.prototype,"remoteMediaSsrcChanged",[Mi],Object.getOwnPropertyDescriptor(It.prototype,"remoteMediaSsrcChanged"),It.prototype),It);function Mi(e,t,r){const a=e[t];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const o=this.mutex,u=await o.lock("From P2PChannel.".concat(t));try{for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];return await a.apply(this,m)}finally{u()}},r}function pG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),r.push.apply(r,a)}return r}function mG(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?pG(Object(r),!0).forEach((function(a){H(e,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pG(Object(r)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))}))}return e}const Hce=Date.now(),Wce=20,AP=new Map,RA=new Map;async function gG(e){const t=AP.get(e),r=Array.isArray(t)&&t[t.length-1],a=RA.get(e);if(!r)return void(a.isSyncing=!1);const o={uid:r.uid,payload:r.payload};a.firstRecvTs===0&&(a.firstRecvTs=r.recvTs,a.firstSendTs=r.sendTs);const u=r.sendTs-a.firstSendTs,h=u-(Date.now()-a.firstRecvTs);h>0&&(a.firstRecvTs=Date.now()-u);let m=r.mediaDelay+h;m<=0?(t.pop(),_G(r.context,o),m=0):m=Math.min(m,Wce),setTimeout((()=>t.length&&gG(e)),m)}function _G(e,t){e.safeEmit(xt.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function zce(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return _G(r,{uid:e.uid,payload:e.payload});const a="".concat(r.id,"-").concat(e.uid),o=AP.get(a)||[],u=o.findIndex((y=>e.sendTs>=y.sendTs)),h=mG(mG({},e),{},{context:r,mediaDelay:t,recvTs:Date.now()});u===-1?o.push(h):o.splice(u,0,h),AP.set(a,o);let m=!1;var g;RA.has(a)?m=!((g=RA.get(a))===null||g===void 0||!g.isSyncing):RA.set(a,{isSyncing:m,firstRecvTs:0,firstSendTs:0}),m||gG(a)}const Kce=Lt().name;function vG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),r.push.apply(r,a)}return r}function yG(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?vG(Object(r),!0).forEach((function(a){H(e,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):vG(Object(r)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))}))}return e}const ov="websdk_ng_cache_parameter",Yce=X("MAX_PRELOAD_ASYNC_LENGTH"),qce=1e4,Hp=new Map,Wp=[];let OP=null,IP=0,NP=0;const CA=new Map,Xce=(function(e,t){const r=[];let a=0;const o=async()=>{const u=r.shift();u&&await u(),r.length>0&&a<t?o():a--};return async function(){for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];return new Fe((async(g,y)=>{r.push((async()=>{try{const E=await e(...h);g(E)}catch(E){y(E)}})),a<t&&(a++,o())}))}})(EG,Yce),xP=oa.CancelToken.source();async function EG(e,t,r,a,o,u){try{if(!X("ENABLE_PRELOAD"))return;if(!Vt().supportWebCrypto)return void Nh((()=>{k.warn("Your browser does not support preloading, this feature  be run in a secure environment")}),"preload_webcrypto_not_supported");if(!r&&r!==null)throw new ve(q.INVALID_PARAMS,"Invalid token: ".concat(r,". If you don not use token, set it to null"));r&&Gr(r,"token",1,2047),Gr(e,"appid",1,2047),eA(t),a&&tA(a);const h=xp();k.debug("preload channel ".concat(t,", uid is ").concat(a));const m={appId:e,cname:t,token:r||e,uid:typeof a!="string"?a:null,sid:h,proxyServer:o};let g,y;typeof a=="string"?(m.stringUid=a,[y,g]=await Fe.all([Dce(a,{sid:h,appId:e},xP.token),K8(yG(yG({},m),{},{token:r||e,uid:0}),xP.token)]),m.uid=y.uid,g.gatewayInfo.uid=m.uid,g.gatewayInfo.res.uid=m.uid):(u&&(m.stringUid=u),g=await K8(m,xP.token));const E={sid:h,appId:e,cname:t,token:r||e,uid:m.stringUid||a,intUid:m.uid||g.gatewayInfo.uid,stringUid:m.stringUid,ts:Date.now(),sua:y,ap:g};await(async function(A){let O;try{A.uid&&bG({appId:A.appId,cname:A.cname,token:A.token,uid:A.uid,stringUid:A.stringUid});const N=CG(A),B=await(async function(V,K){try{const z=await window.crypto.subtle.importKey("raw",h5(K),"AES-GCM",!1,["encrypt"]),J=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},z,Np(window.btoa(JSON.stringify(V))));return xh(new Uint8Array(J))}catch{return}})(A,A.token||A.appId);if(!B)return;O=RG(ov);const U=O?JSON.parse(O):[];U.push({[N]:B}),U.length>X("AP_CACHE_NUM")&&U.shift(),AA(ov,JSON.stringify(U))}catch(N){k.warn("Error caching server parameters:",N.message),AA(ov,"")}})(E),IP++}catch(h){throw NP++,(function(m){OP||(OP=window.setTimeout((()=>{let y="";CA.forEach(((E,A)=>{y+="".concat(A,": ").concat(E," ;")})),nt.reportApiInvoke(null,{name:Xn.PRELOAD,options:{success:IP,failed:NP,err:y}}).onError(m),IP=0,NP=0,CA.clear(),OP=null}),qce));const g=CA.get(m.code)||0;CA.set(m.code,g+1)})(h),h}}async function SG(e){try{if(X("AP_REQUEST_DETAIL")||X("ENABLE_ROLE_SELECT_EDGE"))return;const t=bG(e);if(!t||e.cloudProxyServer!=="disabled")return;const r=await(async function(a,o){try{const u=await window.crypto.subtle.importKey("raw",h5(o),"AES-GCM",!1,["decrypt"]),h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},u,Np(a));return JSON.parse(window.atob(xh(new Uint8Array(h))))}catch{return}})(t,e.token||e.appId);if(!r||!(function(a,o){return a.cname===o.cname&&a.appId===o.appId&&a.token===o.token?o.stringUid?a.stringUid===o.stringUid:typeof o.uid=="number"?a.uid===o.uid:a.uid==o.uid:!1})(r,e))return;if(r&&Date.now()-r.ts<X("AP_CACHE_LIFETIME"))return r}catch(t){k.warn("Error get preloadInfo",t.message)}}function bG(e){let t;try{if(t=RG(ov),!t)return;const r=JSON.parse(t),a=CG(e),o=(function(h,m){for(let g=h.length-1;g>=0;g--)if(m(h[g]))return g;return-1})(r,(h=>a in h));if(o===-1)return;const u=r.splice(o,1)[0];return AA(ov,JSON.stringify(r)),u[a]}catch(r){k.warn("Error delete preload info: ".concat(t),r.message),AA(ov,"")}}function DP(e){if(e){let t=Hp.get(e);t&&(window.clearTimeout(t),t=null,Hp.delete(e)),je(Wp).call(Wp,e)||e.cloudProxyServer!=="disabled"||Wp.push(e)}if(Hp.size<X("AP_CACHE_NUM")&&Wp.length>0){const t=Wp.shift();Hp.set(t,window.setTimeout((async()=>{const{appId:r,cname:a,token:o,stringUid:u,uid:h,proxyServer:m}=t;try{await Xce(r,a,o,h,m,u),Hp.has(t)&&DP(t)}catch(g){k.warn("update preload failed",g.message),TG(t)}}),X("AP_UPDATE_INTERVAL")))}}function TG(e){const t=Wp.indexOf(e);t!==-1&&Wp.splice(t,1);let r=Hp.get(e);r&&(window.clearTimeout(r),r=null,Hp.delete(e),DP())}function wG(e,t){const r=e.sua,a=e.ap;t&&r&&nt.reqUserAccount(e.sid,{lts:r.requestTime,elapse:r.elapse,success:!0,serverAddr:r.url,stringUid:t,uid:e.intUid,errorCode:null,extend:r.req}),nt.reportResourceTiming(e.ap.url,e.sid),nt.joinWebProxyAP(e.sid,{lts:a.requestTime,elapse:a.elapse,sucess:1,apServerAddr:a.url,turnServerAddrList:a.proxyInfo.addresses.map((o=>o.ip)).join(","),eventType:"disabled",unilbsServerIds:[rr.CHOOSE_SERVER,rr.CLOUD_PROXY_FALLBACK].toString()}),nt.joinChooseServer(e.sid,{lts:a.requestTime,elapse:a.elapse,succ:!0,csAddr:a.url,opid:a.opid,serverList:a.gatewayInfo.gatewayAddrs.map((o=>o.address)),ec:null,cid:a.gatewayInfo.cid.toString(),uid:a.gatewayInfo.uid.toString(),csIp:a.gatewayInfo.csIp,unilbsServerIds:[rr.CHOOSE_SERVER].toString(),isHttp3:a.isHttp3})}function RG(e){return window.atob(window.localStorage.getItem(e)||"")}function AA(e,t){window.localStorage.setItem(e,window.btoa(t))}function CG(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),y5(t)}function Jce(e){let t=(function(){const r=Qce.pop();return r?(r.offset=r.limit=0,r):{bytes:new Uint8Array(64),offset:0,limit:0}})();return(function(r,a){let o=r.appId;o!==void 0&&(ir(a,10),Wh(a,o));let u=r.cid;u!==void 0&&(ir(a,16),ir(a,u));let h=r.cname;h!==void 0&&(ir(a,26),Wh(a,h));let m=r.deviceId;m!==void 0&&(ir(a,34),Wh(a,m));let g=r.elapse;g!==void 0&&(ir(a,40),zh(a,g));let y=r.fileSize;y!==void 0&&(ir(a,48),zh(a,cv(y)));let E=r.height;E!==void 0&&(ir(a,56),zh(a,cv(E)));let A=r.jpg;A!==void 0&&(ir(a,66),ir(a,A.length),OG(a,A));let O=r.networkType;O!==void 0&&(ir(a,72),zh(a,cv(O)));let N=r.osType;N!==void 0&&(ir(a,80),zh(a,cv(N)));let B=r.requestId;B!==void 0&&(ir(a,90),Wh(a,B));let U=r.sdkVersion;U!==void 0&&(ir(a,98),Wh(a,U));let V=r.sequence;V!==void 0&&(ir(a,104),zh(a,cv(V)));let K=r.sid;K!==void 0&&(ir(a,114),Wh(a,K));let z=r.timestamp;z!==void 0&&(ir(a,120),zh(a,z));let J=r.uid;J!==void 0&&(ir(a,128),ir(a,J));let ae=r.vid;ae!==void 0&&(ir(a,136),ir(a,ae));let ie=r.width;ie!==void 0&&(ir(a,144),zh(a,cv(ie)));let ee=r.service;ee!==void 0&&(ir(a,152),ir(a,ee));let le=r.callbackData;le!==void 0&&(ir(a,162),ir(a,le.length),OG(a,le));let ye=r.ticket;ye!==void 0&&(ir(a,170),Wh(a,ye));let we=r.vendorConfigs;we!==void 0&&(ir(a,178),Wh(a,we))})(e,t),(function(r){let a=r.bytes,o=r.limit;return a.length===o?a:a.subarray(0,o)})(t)}function $ce(e){return(function(r){let a={};e:for(;!ele(r);){let o=hS(r);switch(o>>>3){case 0:break e;case 1:a.code=hS(r);break;case 2:a.msg=IG(r,hS(r));break;case 3:a.requestId=IG(r,hS(r));break;case 4:a.timestamp=tle(r,!1);break;default:Zce(r,7&o)}}return a})({bytes:t=e,offset:0,limit:t.length});var t}function Zce(e,t){switch(t){case 0:for(;128&Do(e););break;case 2:PP(e,hS(e));break;case 5:PP(e,4);break;case 1:PP(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function cv(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let Qce=[];function PP(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function ele(e){return e.offset>=e.limit}function OA(e,t){let r=e.bytes,a=e.offset,o=e.limit,u=a+t;if(u>r.length){let h=new Uint8Array(2*u);h.set(r),e.bytes=h}return e.offset=u,u>o&&(e.limit=u),a}function AG(e,t){let r=e.offset;if(r+t>e.limit)throw new Error("Read past limit");return e.offset+=t,r}function OG(e,t){let r=OA(e,t.length);e.bytes.set(t,r)}function IG(e,t){let r=AG(e,t),a=String.fromCharCode,o=e.bytes,u="",h="";for(let m=0;m<t;m++){let g,y,E,A,O=o[m+r];(128&O)==0?h+=a(O):(224&O)==192?m+1>=t?h+=u:(g=o[m+r+1],(192&g)!=128?h+=u:(A=(31&O)<<6|63&g,A<128?h+=u:(h+=a(A),m++))):(240&O)==224?m+2>=t?h+=u:(g=o[m+r+1],y=o[m+r+2],(49344&(g|y<<8))!=32896?h+=u:(A=(15&O)<<12|(63&g)<<6|63&y,A<2048||A>=55296&&A<=57343?h+=u:(h+=a(A),m+=2))):(248&O)==240?m+3>=t?h+=u:(g=o[m+r+1],y=o[m+r+2],E=o[m+r+3],(12632256&(g|y<<8|E<<16))!=8421504?h+=u:(A=(7&O)<<18|(63&g)<<12|(63&y)<<6|63&E,A<65536||A>1114111?h+=u:(A-=65536,h+=a(55296+(A>>10),56320+(1023&A)),m+=3))):h+=u}return h}function Wh(e,t){let r=t.length,a=0;for(let h=0;h<r;h++){let m=t.charCodeAt(h);m>=55296&&m<=56319&&h+1<r&&(m=(m<<10)+t.charCodeAt(++h)-56613888),a+=m<128?1:m<2048?2:m<65536?3:4}ir(e,a);let o=OA(e,a),u=e.bytes;for(let h=0;h<r;h++){let m=t.charCodeAt(h);m>=55296&&m<=56319&&h+1<r&&(m=(m<<10)+t.charCodeAt(++h)-56613888),m<128?u[o++]=m:(m<2048?u[o++]=m>>6&31|192:(m<65536?u[o++]=m>>12&15|224:(u[o++]=m>>18&7|240,u[o++]=m>>12&63|128),u[o++]=m>>6&63|128),u[o++]=63&m|128)}}function Do(e){return e.bytes[AG(e,1)]}function NG(e,t){let r=OA(e,1);e.bytes[r]=t}function hS(e){let t,r=0,a=0;do t=Do(e),r<32&&(a|=(127&t)<<r),r+=7;while(128&t);return a}function ir(e,t){for(t>>>=0;t>=128;)NG(e,127&t|128),t>>>=7;NG(e,t)}function tle(e,t){let r,a=0,o=0,u=0;return r=Do(e),a=127&r,128&r&&(r=Do(e),a|=(127&r)<<7,128&r&&(r=Do(e),a|=(127&r)<<14,128&r&&(r=Do(e),a|=(127&r)<<21,128&r&&(r=Do(e),o=127&r,128&r&&(r=Do(e),o|=(127&r)<<7,128&r&&(r=Do(e),o|=(127&r)<<14,128&r&&(r=Do(e),o|=(127&r)<<21,128&r&&(r=Do(e),u=127&r,128&r&&(r=Do(e),u|=(127&r)<<7))))))))),{low:a|o<<28,high:o>>>4|u<<24,unsigned:t}}function zh(e,t){let r=t.low>>>0,a=(t.low>>>28|t.high<<4)>>>0,o=t.high>>>24,u=o===0?a===0?r<16384?r<128?1:2:r<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:o<128?9:10,h=OA(e,u),m=e.bytes;switch(u){case 10:m[h+9]=o>>>7&1;case 9:m[h+8]=u!==9?128|o:127&o;case 8:m[h+7]=u!==8?a>>>21|128:a>>>21&127;case 7:m[h+6]=u!==7?a>>>14|128:a>>>14&127;case 6:m[h+5]=u!==6?a>>>7|128:a>>>7&127;case 5:m[h+4]=u!==5?128|a:127&a;case 4:m[h+3]=u!==4?r>>>21|128:r>>>21&127;case 3:m[h+2]=u!==3?r>>>14|128:r>>>14&127;case 2:m[h+1]=u!==2?r>>>7|128:r>>>7&127;case 1:m[h]=u!==1?128|r:127&r}}const xG={},DG={},IA=4294967296,nle=IA*IA,PG=nle/2;LG(0,!0);const kG=LG(0),rle=fS(0,-2147483648,!1),ile=fS(-1,2147483647,!1);function LG(e,t){let r,a,o;return t?(o=0<=(e>>>=0)&&e<256)&&(a=DG[e],a)?a:(r=fS(e,0,!0),o&&(DG[e]=r),r):(o=-128<=(e|=0)&&e<128)&&(a=xG[e],a)?a:(r=fS(e,e<0?-1:0,!1),o&&(xG[e]=r),r)}function fS(e,t,r){return{low:0|e,high:0|t,unsigned:!!r}}function MG(e,t){if(isNaN(e))return kG;{if(e<=-PG)return rle;if(e+1>=PG)return ile}return e<0?kG:fS(e%IA|0,e/IA|0,t)}function UG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),r.push.apply(r,a)}return r}class kP extends Mn{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const r=this._connectionState;this._connectionState=t,this.emit(Gc.CONNECTION_STATE_CHANGE,t,r)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout((()=>{this.quality=this._quality/this._qualityRatio}),6e4))}constructor(t){var r;super(),H(this,"name","AgoraRTCImageModeration"),H(this,"_connectionState",zs.CONNECTING),H(this,"_sequence",0),H(this,"_moderationStartTime",void 0),H(this,"_workerConnection",void 0),H(this,"_workerMessageLengthLimit",void 0),H(this,"_qualityRatio",void 0),H(this,"_connectInfo",void 0),H(this,"_cancelTokenSource",oa.CancelToken.source()),H(this,"_retryConfig",void 0),H(this,"_moderationInterval",void 0),H(this,"_moderationTimer",null),H(this,"_moderationMode",1),H(this,"_quality",1),H(this,"_qualityTimer",null),H(this,"_ticket",void 0),H(this,"_moderationIntervalMinimum",void 0),H(this,"_uploadFailedNum",0),H(this,"_uploadNum",0),H(this,"_uploadTimer",null),H(this,"_extraInfo",void 0),H(this,"_vendor",""),H(this,"_encoder",new TextEncoder),H(this,"_moderationId",void 0),H(this,"inspectImage",(()=>{if(this.connectionState!==zs.CONNECTED)throw new fe(q.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval((()=>{this.connectionState===zs.CONNECTED?this.requestToInspectImage():k.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)}),this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()})),this._moderationId=fn(5,"image-moderation-"),this._workerMessageLengthLimit=X("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=X("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(r=t.interval)!==null&&r!==void 0?r:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=X("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new nS("worker-"+this._moderationId,sr),this.on(Gc.STATE_CHANGE,((a,o)=>{k.debug("[".concat(this._moderationId,"] Moderation operation :").concat($_[a]," ").concat(o||""))})),this.handleWorkerEvents()}async init(t,r){this.emit(Gc.STATE_CHANGE,$_.CONNECT_AP),this._connectInfo=t;const a=this._cancelTokenSource.token;return this._retryConfig=r,new Fe(((o,u)=>{this.on(Gc.CONNECTION_STATE_CHANGE,((h,m)=>{h===zs.CONNECTED&&o()})),this.requestAP(t,a,r).then((h=>{this.connectWorker(h)})).catch((h=>{u(h)}))}))}updateConfig(t){var r;this._moderationInterval=(r=t.interval)!==null&&r!==void 0?r:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),k.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===zs.CONNECTED&&this.inspectImage()}async requestAP(t,r,a){const o=X("WEBCS_DOMAIN").map((g=>"https://".concat(g,"/api/v1"))),u=await(function(g,y,E,A){let{appId:O,areaCode:N,cname:B,sid:U,token:V,uid:K}=y;rv++;const z="moderation_plugin",J={service_name:z,json_body:JSON.stringify({appId:O,areaCode:N,cname:B,command:"allocateEdge",requestId:rv,seq:rv,sid:U,appToken:V,ts:Date.now(),uid:K+""})};let ae,ie,ee=g[0];return jc((async()=>{ae=Date.now();const le=await Hc(ee,{data:J,cancelToken:E,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(ie=Date.now()-ae,le.code!==0){const Ne=new fe(q.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+le.code,{retry:!0,responseTime:ie});throw k.error(Ne.toString()),Ne}const ye=JSON.parse(le.json_body);if(ye.code!==200){const Ne=new fe(q.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(ye.code,", reason: ").concat(ye.reason),{code:ye.code,responseTime:ie});throw k.error(Ne.toString()),Ne}if(!ye.servers||!Array.isArray(ye.servers)||ye.servers.length===0){const Ne=new fe(q.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:ye.code,responseTime:ie});throw k.error(Ne.toString()),Ne}if(!ye.servers.some((Ne=>!!Ne.wss))){const Ne=new fe(q.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:ye.code,responseTime:ie});throw k.error(Ne.toString()),Ne}const we=X("IMAGE_MODERATION_WORKER_HOST");return{addressList:ye.servers.map((Ne=>{let{address:bt,wss:Rt}=Ne;if(bt&&Rt)return"wss://".concat(bt.replace(/\./g,"-"),".").concat(we,":").concat(Rt,"/moderation")})).filter((Ne=>!!Ne)),workerToken:ye.workerToken,vid:ye.vid,ticket:ye.appTicket,responseTime:ie}}),((le,ye)=>(nt.apworkerEvent(U,{success:!0,sc:200,serviceName:z,responseDetail:JSON.stringify(le.addressList),firstSuccess:ye===0,responseTime:ie,serverIp:g[ye%g.length]}),!1)),((le,ye)=>(nt.apworkerEvent(U,{success:!1,sc:le.data&&le.data.code||200,serviceName:z,responseTime:ie,serverIp:g[ye%g.length]}),!!(le.code!==q.OPERATION_ABORTED&&le.code!==q.UNEXPECTED_RESPONSE||le.data&&le.data.retry)&&(ee=g[(ye+1)%g.length],!0))),A)})(o,t,r,a);this.emit(Gc.STATE_CHANGE,$_.AP_CONNECTED);const{addressList:h,ticket:m}=u;return this._ticket=m,h}async connectWorker(t){this.emit(Gc.STATE_CHANGE,$_.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(yt.CONNECTED,(async()=>{this.emit(Gc.STATE_CHANGE,$_.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=zs.CONNECTED})),this._workerConnection.on(yt.CLOSED,(()=>{this.connectionState=zs.CLOSED})),this._workerConnection.on(yt.FAILED,(()=>{this.connectionState=zs.CLOSED})),this._workerConnection.on(yt.RECONNECTING,(()=>{this.connectionState=this.connectionState===zs.CONNECTED?zs.RECONNECTING:zs.CONNECTING})),this._workerConnection.on(yt.ON_MESSAGE,(async t=>{if(t.data instanceof ArrayBuffer){const r=$ce(new Uint8Array(t.data));X("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&k.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(r)),this._uploadNum++,r.code===void 0||r.code===0||(this._uploadFailedNum++,k.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(r.code,", msg is ").concat(r.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout((()=>{nt.reportApiInvoke(this._connectInfo.sid||null,{name:Xn.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,r.code],tag:Dn.TRACER}).onError(new fe(q.IMAGE_MODERATION_UPLOAD_FAILED,r.msg)),this._uploadTimer=null}),X("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else k.error("[".concat(this._moderationId,"] Unexpected message type from worker"))})),this._workerConnection.on(yt.WILL_RECONNECT,((t,r,a)=>{t==="recover"&&a(t),a("tryNext")})),this._workerConnection.on(yt.REQUEST_NEW_URLS,((t,r)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(r)}))}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){const t=_s(this,Gc.CLIENT_LOCAL_VIDEO_TRACK),r={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(X("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&k.debug("Only the track being played can be inspected"));this._sequence++;const a=await this.generateRequestData(t,r);this._workerConnection.sendMessage(a,!0,!0)}else X("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&k.debug("Only the track being published can be inspected")}async generateRequestData(t,r){let{appId:a,cname:o,cid:u,vid:h,sid:m,uid:g}=r;const y=Date.now(),E=await t.getCurrentFrameImage("image/jpeg",this.quality),A=await cF(E,a,o),O=this._sequence+"-"+u+"-"+g+"-"+y+"-"+fn(12,""),N={appId:a,cid:u,cname:o,deviceId:"",elapse:kP.intToLong(Number(y-this._moderationStartTime)),fileSize:E.buffer.byteLength,height:E.height,width:E.width,jpg:A,networkType:6,osType:7,requestId:O,sdkVersion:"4.24.0",sequence:this._sequence,sid:m,timestamp:MG(y),uid:g,vid:h,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete N.callbackData;const B=Jce(N);if(B.byteLength<this._workerMessageLengthLimit){if(X("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const U=(function(V){for(var K=1;K<arguments.length;K++){var z=arguments[K]!=null?arguments[K]:{};K%2?UG(Object(z),!0).forEach((function(J){H(V,J,z[J])})):Object.getOwnPropertyDescriptors?Object.defineProperties(V,Object.getOwnPropertyDescriptors(z)):UG(Object(z)).forEach((function(J){Object.defineProperty(V,J,Object.getOwnPropertyDescriptor(z,J))}))}return V})({},N);delete U.jpg,k.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(U))}return B}{const U=this.quality*this._qualityRatio;return this.quality=U,await this.generateRequestData(t,{appId:a,cname:o,cid:u,vid:h,sid:m,uid:g})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=oa.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=zs.CLOSED,this.emit(Gc.STATE_CHANGE,$_.CLOSED)}}function jG(e){if(ln(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new fe(q.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new fe(q.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const ale={name:"ImageModeration",create:function(e){let{config:t}=e;return jG(t),new kP(t)}};var VG,BG,FG,GG,HG,WG,zG,KG,YG,qG,XG,JG,$G,ZG,QG,eH,tH,nH,rH,iH,aH,sH,oH,cH,lH,uH,dH,hH,fH,pH,mH,gH,_H,vH,yH,EH,SH,bH,TH,wH,RH,Ye;function CH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),r.push.apply(r,a)}return r}function Po(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?CH(Object(r),!0).forEach((function(a){H(e,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):CH(Object(r)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))}))}return e}oi.setLogger(k);let sle=(VG=lt(),BG=lt({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof H_))return[t];t=[t]}return t.map((r=>r?Object(r).toString():"null"))}}),FG=lt({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==G_.DATA?(Array.isArray(t)||(t=[t]),t.map((r=>r.getTrackId()))):[t.getChannelId()])}),GG=lt({argsMap:(e,t,r,a)=>[typeof t=="object"?t.uid:t,r,a]}),HG=lt({argsMap:(e,t,r)=>[t,r]}),WG=lt({argsMap:(e,t)=>t.map((r=>{let{user:a,mediaType:o}=r;return[a?.uid,o]}))}),zG=lt({argsMap:(e,t,r,a)=>[typeof t=="object"?t.uid:t,r,a]}),KG=lt({argsMap:(e,t)=>t.map((r=>{let{user:a,mediaType:o}=r;return{uid:a?.uid,mediaType:o}}))}),YG=lt(),qG=lt(),XG=lt(),JG=lt(),$G=lt(),ZG=lt(),QG=lt(),eH=lt(),tH=lt(),nH=lt(),rH=lt(),iH=lt(),aH=lt(),sH=lt(),oH=lt(),cH=lt({argsMap:(e,t)=>[t]}),lH=lt(),uH=lt(),dH=lt(),hH=lt(),fH=lt(),pH=lt(),mH=lt(),gH=lt(),_H=lt({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),vH=lt(),yH=lt(),EH=lt(),SH=lt(),bH=lt(),TH=lt(),wH=lt({reportResult:!0}),RH=lt(),Ye=class extends Mn{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let r;if(super(),H(this,"store",void 0),H(this,"_uid",void 0),H(this,"_channelName",void 0),H(this,"_uintUid",void 0),H(this,"_users",[]),H(this,"_config",void 0),H(this,"_clientId",void 0),H(this,"_appId",void 0),H(this,"_sessionId",null),H(this,"_key",void 0),H(this,"_rtmConfig",{}),H(this,"_joinInfo",void 0),H(this,"_gateway",void 0),H(this,"_statsCollector",void 0),H(this,"_configDistribute",void 0),H(this,"_leaveMutex",void 0),H(this,"_publishMutex",void 0),H(this,"_renewTokenMutex",void 0),H(this,"_subscribeMutex",void 0),H(this,"_encryptionMode","none"),H(this,"_encryptionSecret",null),H(this,"_encryptionSalt",null),H(this,"_encryptDataStream",!1),H(this,"_encryptDataStreamKey",null),H(this,"_encryptDataStreamIv",null),H(this,"_proxyServer",void 0),H(this,"_turnServer",{servers:[],mode:"auto"}),H(this,"_cloudProxyServerMode","disabled"),H(this,"_isDualStreamEnabled",!1),H(this,"_defaultStreamFallbackType",void 0),H(this,"_lowStreamParameter",void 0),H(this,"_streamFallbackTypeCacheMap",new Map),H(this,"_remoteStreamTypeCacheMap",new Map),H(this,"_axiosCancelSource",oa.CancelToken.source()),H(this,"_audioVolumeIndicationInterval",void 0),H(this,"_networkQualityInterval",void 0),H(this,"_userOfflineTimeout",void 0),H(this,"_streamRemovedTimeout",void 0),H(this,"_liveTranscodeStreamingClient",void 0),H(this,"_liveRawStreamingClient",void 0),H(this,"_channelMediaRelayClient",void 0),H(this,"_networkQualitySensitivity","normal"),H(this,"_p2pChannel",void 0),H(this,"_useLocalAccessPoint",!1),H(this,"_setLocalAPVersion",void 0),H(this,"_joinAndNotLeaveYet",!1),H(this,"_numberOfJoinCount",0),H(this,"_joinResponse",null),H(this,"_remoteDefaultVideoStreamType",void 0),H(this,"_inspect",void 0),H(this,"_moderation",void 0),H(this,"_license",void 0),H(this,"_pendingPublishedUsers",[]),H(this,"ntpAlignErrorCount",0),H(this,"remoteInboundOffset",0),H(this,"_peerConnectionState",void 0),H(this,"_handleLocalTrackEnable",((o,u,h)=>{this.publish(o,!1).then(u).catch(h)})),H(this,"_handleLocalTrackDisable",((o,u,h)=>{this.unpublish(o).then(u).catch(h)})),H(this,"_handleUserOnline",(o=>{if(X("BLOCK_LOCAL_CLIENT")&&Vp(o.uid,this.channelName))return void k.debug("[".concat(o.uid,"] will be ignored in local"));this.isStringUID&&typeof o.uid!="string"&&k.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const u=this._users.find((h=>h.uid===o.uid));if(u)u._trust_in_room_=!0,u._is_pre_created&&(u._is_pre_created=!1,this.safeEmit(xt.USER_JOINED,u));else{const h=new Gh(o.uid,o.uint_id||o.uid);this._users.push(h),k.debug("[".concat(this._clientId,"] user online"),o.uid),this.store.firstVideoFrameDecoded(h.uid,{userJoinNotify:Date.now()}),this.safeEmit(xt.USER_JOINED,h)}})),H(this,"_handleUserOffline",(o=>{if(X("BLOCK_LOCAL_CLIENT")&&Vp(o.uid,this.channelName))return;const u=this._users.find((h=>h.uid===o.uid));u&&(this._handleRemoveStream(o),this._handleRemoveDataChannels(o),u._audio_pre_subscribed||u._video_pre_subscribed?u._is_pre_created=!0:IC(this._users,u),this._remoteStreamTypeCacheMap.delete(u.uid),this._streamFallbackTypeCacheMap.delete(u.uid),k.debug("[".concat(this._clientId,"] user offline"),o.uid,"reason:",o.reason),this.safeEmit(xt.USER_LEAVED,u,o.reason))})),H(this,"_handleAddAudioOrVideoStream",((o,u,h,m,g,y,E,A)=>{if(X("BLOCK_LOCAL_CLIENT")&&Vp(u,this.channelName))return;const O=this._users.find((B=>B.uid===u));if(!O)return void k.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));k.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(o)),this.store.subscribe(O.uid,o,void 0,void 0,void 0,Date.now()),o==="video"&&this.store.firstVideoFrameDecoded(O.uid,{videoAddNotify:Date.now()});const N=o==="audio"?O.hasAudio:O.hasVideo;if(O._uintid||(O._uintid=y||u),o==="audio"?O._trust_audio_stream_added_state_=!0:O._trust_video_stream_added_state_=!0,o==="audio"?(O._audio_added_=!0,h!==void 0&&(O._audioSSRC=h),m!==void 0&&(O._cname=m),E&&(O._audioOrtc=E)):(O._video_added_=!0,h!==void 0&&(O._videoSSRC=h),m!==void 0&&(O._cname=m),A!==void 0&&(O._rtxSsrcId=A),E&&(O._videoOrtc=E)),(o==="audio"?O.hasAudio:O.hasVideo)&&!N&&(k.info("[".concat(this._clientId,"] remote user ").concat(O.uid," published ").concat(o)),this.safeEmit(xt.USER_PUBLISHED,O,o)),o==="video"?nt.onGatewayStream(this._sessionId,yr.ON_ADD_VIDEO_STREAM,Nn.ON_ADD_VIDEO_STREAM,{peer:y||u,ssrc:O._videoSSRC}):nt.onGatewayStream(this._sessionId,yr.ON_ADD_AUDIO_STREAM,Nn.ON_ADD_AUDIO_STREAM,{peer:y||u,ssrc:O._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(O,o,h).then((B=>{if(B&&(k.debug("[".concat(this._clientId,"] resubscribe ").concat(o," for user ").concat(O.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof dS))return this._p2pChannel.unsubscribe(O,o,!0).then((()=>this._subscribe(O,o,!0).catch((U=>{k.error("[".concat(this._clientId,"] resubscribe error"),U.toString())}))))})),this._p2pChannel.hasPendingRemoteMedia(O,o)&&(k.debug("[".concat(this._clientId,"] resubscribe ").concat(o," for user ").concat(O.uid," after reconnect.")),this._subscribe(O,o,!0).catch((B=>{k.error("[".concat(this._clientId,"] resubscribe error"),B.toString())}))),o==="video"&&!Zr()&&!Ti()){const B=this._getEncodingName(g);B?.toLocaleLowerCase()==q0.av1&&xce().then((U=>{U||this._gateway.downgradeCodec(B)}))}})),H(this,"_handleRemoveStream",(o=>{if(X("BLOCK_LOCAL_CLIENT")&&Vp(o.uid,this.channelName))return;const u=this._users.find((m=>m.uid===o.uid));if(!u)return void k.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));k.debug("[".concat(this._clientId,"] stream removed with uid ").concat(o.uid));let h=()=>{};u.hasAudio&&u.hasVideo?h=()=>{k.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(xt.USER_UNPUBLISHED,u,"audio"),k.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(xt.USER_UNPUBLISHED,u,"video")}:u.hasVideo?h=()=>{k.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(xt.USER_UNPUBLISHED,u,"video")}:u.hasAudio&&(h=()=>{k.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(xt.USER_UNPUBLISHED,u,"audio")}),u._video_pre_subscribed||u._audio_pre_subscribed||(u._trust_audio_stream_added_state_=!0,u._trust_video_stream_added_state_=!0,u._audio_added_=!1,u._video_added_=!1,this._p2pChannel instanceof dS&&this._p2pChannel.unsubscribe(u).then((m=>{if(m)return this._gateway.unsubscribe(m,u.uid)})),u._audioSSRC=void 0,u._videoSSRC=void 0,u._audioOrtc=void 0,u._videoOrtc=void 0,u._rtxSsrcId=void 0),nt.onGatewayStream(this._sessionId,yr.ON_REMOVE_STREAM,Nn.ON_REMOVE_STREAM,{peer:o.uint_id||o.uid}),h()})),H(this,"_handleSetStreamLocalEnable",((o,u,h)=>{if(X("BLOCK_LOCAL_CLIENT")&&Vp(u,this.channelName))return;const m=this._users.find((E=>E.uid===u));if(!m)return void k.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));k.debug("[".concat(this._clientId,"] local ").concat(o," ").concat(h?"enabled":"disabled"," with uid ").concat(u));const g=o==="audio"?m.hasAudio:m.hasVideo;if(o==="audio"){m._trust_audio_enabled_state_=!0;const E=m._audio_enabled_;if(m._audio_enabled_=h,m._audio_enabled_===E)return;{const A=m._audio_enabled_?"enable-local-audio":"disable-local-audio";k.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(u,", msg: ").concat(A)),this.safeEmit(xt.USER_INFO_UPDATED,u,A)}}else{m._trust_video_enabled_state_=!0;const E=m._video_enabled_;if(m._video_enabled_=h,m._video_enabled_===E)return;{const A=m._video_enabled_?"enable-local-video":"disable-local-video";k.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(u,", msg: ").concat(A)),this.safeEmit(xt.USER_INFO_UPDATED,u,A)}}const y=o==="audio"?m.hasAudio:m.hasVideo;return g!==y?!g&&y?(k.info("[".concat(this._clientId,"] remote user ").concat(u," published ").concat(o)),void this.safeEmit(xt.USER_PUBLISHED,m,o)):(o==="video"&&m._videoTrack&&m._videoTrack._destroy(),o==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,o),k.info("[".concat(this._clientId,"] remote user ").concat(u," unpublished ").concat(o)),void this.safeEmit(xt.USER_UNPUBLISHED,m,o)):void 0})),H(this,"_handleMuteStream",((o,u,h)=>{if(X("BLOCK_LOCAL_CLIENT")&&Vp(o,this.channelName))return;k.debug("[".concat(this._clientId,"] receive mute message"),o,u,h);const m=this._users.find((E=>E.uid===o));if(!m)return void k.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(o));const g=u==="audio"?m.hasAudio:m.hasVideo;if(u==="audio"){m._trust_audio_mute_state_=!0;const E=m._audio_muted_;if(m._audio_muted_=h,m._audio_muted_===E)return;{const A=m._audio_muted_?"mute-audio":"unmute-audio";k.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(o,", msg: ").concat(A)),this.safeEmit(xt.USER_INFO_UPDATED,o,A)}}else{m._trust_video_mute_state_=!0;const E=m._video_muted_;if(m._video_muted_=h,m._video_muted_===E)return;{const A=m._video_muted_?"mute-video":"unmute-video";k.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(o,", msg: ").concat(A)),this.safeEmit(xt.USER_INFO_UPDATED,o,A)}}const y=u==="audio"?m.hasAudio:m.hasVideo;if(g!==y){if(!g&&y)return(u==="audio"?m._audioSSRC:m._videoSSRC)?(k.info("[".concat(this._clientId,"] remote user ").concat(o," published ").concat(u)),void this.safeEmit(xt.USER_PUBLISHED,m,u)):void k.warning("[".concat(this._clientId,"] remote user ").concat(o," receive ").concat(u," unmute message  before add stream message, ").concat(u," SSRC doesn't exist yet."));u==="video"&&m._videoTrack&&!m._video_pre_subscribed&&m._videoTrack._destroy(),u==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,u),k.info("[".concat(this._clientId,"] remote user ").concat(o," unpublished ").concat(u)),this.safeEmit(xt.USER_UNPUBLISHED,m,u)}})),H(this,"_handleP2PLost",(async o=>{k.debug("[".concat(this._clientId,"] receive p2p lost"),o),parseInt(o.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():k.warning("[".concat(this._clientId,"] P2PLost stream not found"),o)})),H(this,"_handleTokenWillExpire",(()=>{k.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(xt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)})),H(this,"_handleBeforeUnload",(o=>{o.type==="beforeunload"&&o.returnValue!==void 0&&o.returnValue!==""||(this.leave(),k.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))})),H(this,"_handleUpdateNetworkQuality",(()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(xt.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const o={downlinkNetworkQuality:0,uplinkNetworkQuality:0};o.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),o.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(xt.NETWORK_QUALITY,o)})),H(this,"_handleP2PAddAudioOrVideoStream",((o,u,h,m)=>{const g=this._users.find((E=>E.uid===u));if(!g)return void k.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));k.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(o)),this.store.subscribe(g.uid,o,void 0,void 0,void 0,Date.now());const y=o==="audio"?g.hasAudio:g.hasVideo;o==="audio"?g._trust_audio_stream_added_state_=!0:g._trust_video_stream_added_state_=!0,o==="audio"?(g._audio_added_=!0,h!==void 0&&(g._audioSSRC=h),m!==void 0&&(g._audioMid=m)):(g._video_added_=!0,h!==void 0&&(g._videoSSRC=h),m!==void 0&&(g._videoMid=m)),(o==="audio"?g.hasAudio:g.hasVideo)&&!y&&(k.info("[".concat(this._clientId,"] remote user ").concat(g.uid," published ").concat(o)),this.safeEmit(xt.USER_PUBLISHED,g,o)),this._p2pChannel.hasPendingRemoteMedia(g,o)&&(k.debug("[".concat(this._clientId,"] resubscribe ").concat(o," for user ").concat(g.uid," after reconnect.")),this._subscribe(g,o,!0).catch((E=>{k.error("[".concat(this._clientId,"] resubscribe error"),E.toString())})))})),this._config=e,this._clientId=t||fn(5,"client-"),this.store=new class{constructor(o,u,h,m){mt(this,"state",void 0),this.state={codec:o,audioCodec:u,mode:h,clientId:m,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:Dp.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,autoSubscribe:!1,enableInstantMuteRestore:!1}}dispatch(o){this.state=(function(u,h){switch(h.type){case gt.SET_SESSION_ID:return xe(xe({},u),{},{sessionId:h.sessionId});case gt.SET_P2P_ID:return xe(xe({},u),{},{p2pId:h.p2pId});case gt.SET_UID:return xe(xe({},u),{},{uid:h.uid});case gt.SET_INT_UID:return xe(xe({},u),{},{intUid:h.intUid});case gt.SET_PUB_ID:return xe(xe({},u),{},{pubId:h.pubId});case gt.KEY_METRIC_CLIENT_CREATED:return xe(xe({},u),{},{keyMetrics:xe(xe({},u.keyMetrics),{},{clientCreated:h.metric})});case gt.KEY_METRIC_JOIN_START:return xe(xe({},u),{},{keyMetrics:xe(xe({},u.keyMetrics),{},{joinStart:h.metric})});case gt.KEY_METRIC_PRELOAD_START:return xe(xe({},u),{},{keyMetrics:xe(xe({},u.keyMetrics),{},{preloadStart:h.metric})});case gt.KEY_METRIC_PRELOAD_END:return xe(xe({},u),{},{keyMetrics:xe(xe({},u.keyMetrics),{},{preloadEnd:h.metric})});case gt.KEY_METRIC_JOIN_END:return xe(xe({},u),{},{keyMetrics:xe(xe({},u.keyMetrics),{},{joinEnd:h.metric})});case gt.KEY_METRIC_REQUEST_AP_START:return xe(xe({},u),{},{keyMetrics:xe(xe({},u.keyMetrics),{},{requestAPStart:h.metric})});case gt.KEY_METRIC_REQUEST_AP_END:return xe(xe({},u),{},{keyMetrics:xe(xe({},u.keyMetrics),{},{requestAPEnd:h.metric})});case gt.KEY_METRIC_REQUEST_SUA_END:return xe(xe({},u),{},{keyMetrics:xe(xe({},u.keyMetrics),{},{requestSUAEnd:h.metric})});case gt.KEY_METRIC_BEFORE_CONNECT:return xe(xe({},u),{},{keyMetrics:xe(xe({},u.keyMetrics),{},{beforeConnect:h.metric})});case gt.KEY_METRIC_PEER_RECEIVER:return xe(xe({},u),{},{keyMetrics:xe(xe({},u.keyMetrics),{},{peerReceiver:h.metric})});case gt.KEY_METRIC_SIGNAL_CONNECTED:return xe(xe({},u),{},{keyMetrics:xe(xe({},u.keyMetrics),{},{signalConnected:h.metric})});case gt.KEY_METRIC_JOIN_REQ:return xe(xe({},u),{},{keyMetrics:xe(xe({},u.keyMetrics),{},{joinReq:h.metric})});case gt.KEY_METRIC_JOIN_REP:return xe(xe({},u),{},{keyMetrics:xe(xe({},u.keyMetrics),{},{joinRep:h.metric})});case gt.KEY_METRIC_JOIN_GATEWAY_START:return xe(xe({},u),{},{keyMetrics:xe(xe({},u.keyMetrics),{},{joinGatewayStart:h.metric})});case gt.KEY_METRIC_JOIN_GATEWAY_END:return xe(xe({},u),{},{keyMetrics:xe(xe({},u.keyMetrics),{},{joinGatewayEnd:h.metric})});case gt.KEY_METRIC_PEER_CONNECTION_START:return xe(xe({},u),{},{keyMetrics:xe(xe({},u.keyMetrics),{},{peerConnectionStart:h.metric})});case gt.KEY_METRIC_PEER_CONNECTION_END:return xe(xe({},u),{},{keyMetrics:xe(xe({},u.keyMetrics),{},{peerConnectionEnd:h.metric})});case gt.KEY_METRIC_DESCRIPTION_START:return xe(xe({},u),{},{keyMetrics:xe(xe({},u.keyMetrics),{},{descriptionStart:h.metric})});case gt.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return xe(xe({},u),{},{keyMetrics:xe(xe({},u.keyMetrics),{},{signalChannelOpen:h.metric})});case gt.KEY_METRIC_ICE_CONNECTION_END:return xe(xe({},u),{},{keyMetrics:xe(xe({},u.keyMetrics),{},{iceConnectionEnd:h.metric})});case gt.KEY_METRIC_PUBLISH:{const m=u.keyMetrics.publish,g=m.findIndex((y=>y.trackId===h.metric.trackId));return g!==-1?(m[g]=xe(xe({},m[g]),h.metric),xe(xe({},u),{},{keyMetrics:xe(xe({},u.keyMetrics),{},{publish:[...m]})})):xe(xe({},u),{},{keyMetrics:xe(xe({},u.keyMetrics),{},{publish:[...u.keyMetrics.publish,h.metric]})})}case gt.KEY_METRIC_SUBSCRIBE:{const m=u.keyMetrics.subscribe,g=m.findIndex((y=>y.userId===h.metric.userId&&y.type===h.metric.type));return g!==-1?(m[g]=xe(xe({},m[g]),h.metric),xe(xe({},u),{},{keyMetrics:xe(xe({},u.keyMetrics),{},{subscribe:[...m]})})):xe(xe({},u),{},{keyMetrics:xe(xe({},u.keyMetrics),{},{subscribe:[...u.keyMetrics.subscribe,h.metric]})})}case gt.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{const m=u.keyMetrics.firstVideoFrameDecoded,g=m.findIndex((y=>y.userId===h.metric.userId));return g!==-1?(m[g]=xe(xe({},m[g]),h.metric),xe(xe({},u),{},{keyMetrics:xe(xe({},u.keyMetrics),{},{firstVideoFrameDecoded:[...m]})})):xe(xe({},u),{},{keyMetrics:xe(xe({},u.keyMetrics),{},{firstVideoFrameDecoded:[...u.keyMetrics.firstVideoFrameDecoded,h.metric]})})}case gt.RESET_FIRST_VIDEO_FRAME_DECODED:return u.keyMetrics.firstVideoFrameDecoded=[],u;case gt.SET_CLOUD_PROXY_SERVER_MODE:return u.cloudProxyServerMode=h.mode,u;case gt.RECORD_JOIN_CHANNEL_SERVICE:return typeof h.index!="number"?u.joinChannelServiceRecords=[...u.joinChannelServiceRecords,h.record]:(u.joinChannelServiceRecords[h.index]=xe(xe({},u.joinChannelServiceRecords[h.index]),h.record),u.joinChannelServiceRecords=[...u.joinChannelServiceRecords]),u;case gt.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return u.joinChannelServiceRecords=[],u;case gt.RESET_KEY_METRICS:return u.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},u;case gt.SET_USE_P2P:return xe(xe({},u),{},{useP2P:h.val});case gt.SET_TRANSPORT_TYPE:return xe(xe({},u),{},{p2pTransport:h.val});default:return u}})(this.state,o)}set autoSubscribe(o){this.state.autoSubscribe=o}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(o){this.state.enableInstantMuteRestore=o}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set sessionId(o){this.dispatch({type:gt.SET_SESSION_ID,sessionId:o})}get sessionId(){return this.state.sessionId}set cid(o){this.state.cid=o}get cid(){return this.state.cid}set codec(o){this.state.codec=o}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(o){this.dispatch({type:gt.SET_P2P_ID,p2pId:o})}get p2pId(){return this.state.p2pId}set dcId(o){this.dispatch({type:gt.SET_DC_ID,dcId:o})}get dcId(){return this.state.dcId}set uid(o){this.dispatch({type:gt.SET_UID,uid:o})}get uid(){return this.state.uid}set intUid(o){this.dispatch({type:gt.SET_INT_UID,intUid:o})}get intUid(){return this.state.intUid}set pubId(o){this.dispatch({type:gt.SET_PUB_ID,pubId:o})}get pubId(){return this.state.pubId}set cloudProxyServerMode(o){this.dispatch({type:gt.SET_CLOUD_PROXY_SERVER_MODE,mode:o})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(o){this.dispatch({type:gt.SET_USE_P2P,val:o})}get useP2P(){return this.state.useP2P}set p2pTransport(o){this.dispatch({type:gt.SET_TRANSPORT_TYPE,val:o})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(o){this.state.hasStartJoinChannel=o}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(o){this.state.isABTestSuccess=o}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:gt.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:gt.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:gt.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:gt.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:gt.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:gt.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:gt.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:gt.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:gt.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:gt.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:gt.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:gt.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:gt.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:gt.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:gt.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:gt.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:gt.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(o,u){this.dispatch({type:gt.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:xe({userId:o},u)})}descriptionStart(){this.dispatch({type:gt.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:gt.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:gt.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(o,u,h,m){this.dispatch({type:gt.KEY_METRIC_PUBLISH,metric:xe(xe({trackId:o,type:u},h&&{publishStart:h}),m&&{publishEnd:m})})}subscribe(o,u,h,m,g,y,E){this.dispatch({type:gt.KEY_METRIC_SUBSCRIBE,metric:xe(xe(xe(xe(xe({userId:o,type:u},h&&{subscribeStart:h}),m&&{subscribeEnd:m}),g&&{firstFrame:g}),y&&{streamAdded:y}),E&&{firstDecoded:E})})}massSubscribe(o,u,h,m){o.forEach((g=>{this.dispatch({type:gt.KEY_METRIC_SUBSCRIBE,metric:xe(xe(xe({userId:g.userId,type:g.type},u&&{subscribeStart:u}),h&&{subscribeEnd:h}),m&&{firstFrame:m})})}))}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(o,u){o.service==="gateway"&&Array.isArray(o.urls)&&(o.urls=o.urls.map((h=>h.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2"))));try{return typeof u!="number"?(this.dispatch({type:gt.RECORD_JOIN_CHANNEL_SERVICE,record:xe(xe({},o),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(u<0||u>=this.state.joinChannelServiceRecords.length||this.dispatch({type:gt.RECORD_JOIN_CHANNEL_SERVICE,record:o,index:u}),u)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:gt.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:gt.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:gt.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new oi("client-leave",this._clientId),this._publishMutex=new oi("client-publish",this._clientId),this._renewTokenMutex=new oi("client-renewtoken",this._clientId),this._subscribeMutex=new oi("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),k.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Fs," build: ").concat(yD,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{sD(e.clientRoleOptions),r=Object.assign({},e.clientRoleOptions)}catch(o){k.warning("[".concat(this._clientId,"] ").concat(o.toString()))}var a;this._statsCollector=new lS(this.store),this._statsCollector.onStatsException=(o,u,h)=>{k.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(o,", msg: ").concat(u,", uid: ").concat(h)),o===vP.VIDEO_ENCODE_FAILED&&this.localTracks.forEach((m=>{m instanceof HC&&X("ENABLE_ENCODE_EXCEPTION")&&m.findClosestProfile()})),this.safeEmit(xt.EXCEPTION,{code:o,msg:u,uid:h})},this._statsCollector.onUploadPublishDuration=(o,u,h,m)=>{const g=this._users.find((y=>y.uid===o));g&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(g._uintid,{peerPublishDuration:h,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(g)),nt.peerPublishStatus(this._sessionId,{subscribeElapse:m,audioPublishDuration:u,videoPublishDuration:h,peer:g._uintid}))},this._statsCollector.onVideoCodecChanged=o=>{if(X("VIDEO_STANDARD_BITRATE_VERSION")&&(o==="av1"||o==="h265"||o==="h264")){const u=this.localTracks.find((h=>h instanceof wn));u&&u._saveEncodeBitrateRatio!==1&&u.setSaveEncodeBitrateRatio(o==="h264"?X("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=e.mode==="p2p",this._gateway=new Rce(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||sr,httpRetryConfig:e.httpRetryConfig||sr,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:r}),this._configDistribute=new Mce(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(a={store:this.store,statsCollector:this._statsCollector},Hu("P2PChannel").create(a)),this._handleP2PEvents()):this._p2pChannel=new dS(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,r,a,o){let u=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],h=arguments.length>6&&arguments[6]!==void 0&&arguments[6];sn("JOIN_GATEWAY_USE_443PORT_ONLY",u),sn("JOIN_GATEWAY_USE_DUAL_DOMAIN",h);const m=this._gateway.signal.websocket;return m instanceof rP&&(m.use443PortOnly=u,m.tryDoubleDomain=h),(async function(g,y,E){wC.get(g)||wC.set(g,[]),RC.get(g)||RC.set(g,y),Il.get(g)||Il.set(g,0);const A=wC.get(g),O=RC.get(g);if(!A||!O)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Il.get(g)===O){const K=V0();A.push(K),await K.promise}Il.set(g,Il.get(g)+1);for(var N=arguments.length,B=new Array(N>3?N-3:0),U=3;U<N;U++)B[U-3]=arguments[U];const V=await E(...B);return Il.set(g,Il.get(g)-1),Il.get(g)===O-1&&A.length>0&&(A[0].resolve(),A.shift()),Il.get(g)===0&&(wC.set(g,[]),RC.set(g,0),Il.set(g,0)),V})("client.join",X("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,r,a,o)}async join(e,t,r,a,o){const u=++this._numberOfJoinCount;this.store.joinStart(),a&&(this.store.uid=a);const h=(DC||DC||(DC=(window.location.protocol.split(":")[0]||"").toUpperCase(),DC))==="HTTPS",m=b5()?window.isSecureContext:"Browser Not Support";(!b5()&&!h||!window.isSecureContext)&&k.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");let g;nt.setAppId(e);try{if(!r&&r!==null)throw new fe(q.INVALID_PARAMS,"Invalid token: ".concat(r,". If you don not use token, set it to null"));if(r&&Gr(r,"token",1,2047),Gr(e,"appid",1,2047),eA(t),a&&tA(a),o)if(typeof o=="string")Gr(o,"optionalInfo",1,256),g=o;else{if(typeof o!="object")throw new fe(q.INVALID_PARAMS,"Invalid options: options is not a string or object");{const{autoSubscribe:V,enableInstantMuteRestore:K}=o;V&&(Uc(V,"autoSubscribe"),k.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(V)),this.store.autoSubscribe=V),K&&(Uc(K,"enableInstantMuteRestore"),k.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(K)),this.store.enableInstantMuteRestore=K)}}}catch(V){throw nt.reportApiInvoke(xp(),{name:Xn.JOIN,options:[e,t,r,a],states:{isHttps:h,isSecureContext:m},tag:Dn.TRACER}).onError(V),V}if(this._leaveMutex.isLocked&&(k.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),k.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const V=new fe(q.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw nt.reportApiInvoke(xp(),{name:Xn.JOIN,options:[e,t,r,a],states:{isHttps:h,isSecureContext:m},tag:Dn.TRACER}).onError(V),V}this._gateway.state="CONNECTING",this.store.preloadStart();const y=await SG({appId:e,cname:t,uid:a,stringUid:typeof a=="string"?a:void 0,token:r||e,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new fe(q.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const E=y?.sid||xp();k.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(u)),this._sessionId||(this._sessionId=E,this.store.sessionId=this._sessionId);const A=nt.reportApiInvoke(E,{id:this._clientId,name:Xn.JOIN,options:[e,t,r,a],states:{isHttps:h,isSecureContext:m},tag:Dn.TRACER}),O=Po(Po(Po({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof a!="string"?a:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:r||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:g,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!y},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:X("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(O.setLocalAPVersion=this._setLocalAPVersion),typeof a=="string"&&(O.stringUid=a,this._uintUid?(O.uid=this._uintUid,this._uintUid=void 0):O.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(O.aesmode=this._encryptionMode,O.aespassword=await(async V=>{const K=(function(ie){const ee=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),le=new Uint8Array(new ArrayBuffer(ee.length));for(let ye=0;ye<ee.length;ye+=1)le[ye]=ee.charCodeAt(ye);return le})(),z=await window.crypto.subtle.importKey("spki",K,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),J=iD(V),ae=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},z,J);return(function(ie){let ee="";for(let le=0;le<ie.length;le+=1)ee+=String.fromCharCode(ie[le]);return window.btoa(ee)})(new Uint8Array(ae))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new fe(q.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(O.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const V=new TextEncoder,K=X("USE_PURE_ENCRYPTION_MASTER_KEY")?V.encode(O.appId+this._encryptionSecret+this._encryptionSecret):V.encode(O.appId+O.cname+this._encryptionSecret);this._encryptDataStreamIv=await(async function(z,J,ae){const ie=await window.crypto.subtle.importKey("raw",J,"PBKDF2",!1,["deriveBits","deriveKey"]),ee=z==="aes-128-gcm2"?128:256,le=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:D5,hash:"SHA-256",salt:ae},ie,ee+toe);return new Uint8Array(le).subarray(ee/8)})(this._encryptionMode,K,Np(this._encryptionSalt)),this._encryptDataStreamKey=await(async function(z,J,ae){const ie=await window.crypto.subtle.importKey("raw",J,"PBKDF2",!1,["deriveBits","deriveKey"]),ee=z==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:D5,hash:"SHA-256",salt:ae},ie,{name:"AES-GCM",length:ee},!0,["encrypt","decrypt"])})(this._encryptionMode,K,Np(this._encryptionSalt))}else m?k.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):k.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,k.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:O.stringUid});const N=this._sessionId;setTimeout((()=>{this.connectionState==="CONNECTING"&&N===this._sessionId&&nt.joinChannelTimeout(this._sessionId,5)}),5e3);try{var B;let V;const K=O.cloudProxyServer;if(je(B=["proxy3","proxy4","proxy5"]).call(B,K)){const ee=X("PROXY_SERVER_TYPE3");Array.isArray(ee)?O.proxyServer=ee[0]:O.proxyServer=ee}if(nt.setProxyServer(O.proxyServer),k.setProxyServer(O.proxyServer),this.store.requestAPStart(),y){if(k.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(O.stringUid?", ".concat(O.stringUid," => ").concat(y.intUid):""," ")),O.stringUid&&!O.uid&&(O.uid=y.intUid),V={gatewayInfo:y.ap.gatewayInfo},X("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&O.turnServer.mode==="auto")if(y.ap.proxyInfo.addresses.length===0)k.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const ee=(await _8(y.ap.proxyInfo,y.ap.gatewayInfo.uid)).map((le=>({turnServerURL:le.address,tcpport:le.tcpport||ti.tcpport,udpport:le.udpport||ti.udpport,username:le.username||ti.username,password:le.password||ti.password,forceturn:!1,security:!0})));O.turnServer={mode:"manual",servers:ee}}wG(y,O.stringUid)}else{if(O.stringUid&&!O.uid){let ee;[ee,V]=await Fe.all([z8(O.stringUid,O,this._axiosCancelSource.token,this._config.httpRetryConfig||sr,this.store).finally((()=>{this.store.requestSUAEnd()})),W8(O,this._axiosCancelSource.token,this._config.httpRetryConfig||sr,!0,this.store).finally((()=>{this.store.requestAPEnd()}))]),k.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(O.stringUid," => ").concat(ee)),O.uid=ee,V.gatewayInfo.uid=ee,V.gatewayInfo.res.uid=ee}else V=await W8(O,this._axiosCancelSource.token,this._config.httpRetryConfig||sr,!0,this.store);if(!this._joinAndNotLeaveYet)throw new fe(q.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout((()=>{this._configDistribute.startGetConfigDistribute(O,this._axiosCancelSource.token),this._configDistribute.on(eS.UPDATE_BITRATE_LIMIT,(ee=>{this._p2pChannel.updateBitrateLimit(ee)})),this._configDistribute.on(eS.UPDATE_CLIENT_ROLE_OPTIONS,(ee=>{this._setClientRoleOptions(ee)}))}),0),this._key=r||e;const z=V.gatewayInfo,J=O.uid?O.uid:z.uid;this._joinInfo=Po(Po({},O),{},{cid:z.cid,uid:J,vid:z.vid,apResponse:z.res,apGatewayAddress:z.apGatewayAddress,uni_lbs_ip:z.uni_lbs_ip,gatewayAddrs:z.gatewayAddrs}),this.store.intUid=J,this.store.cid=z.cid;const ae=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new fe(q.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));A.onSuccess(ae),this._appId=e,this._channelName=O.cname,this._uid=ae,this.store.uid=ae,setTimeout((()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Zr()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()}),0);const ie=O.stringUid?"string uid: ".concat(O.stringUid,",uid: ").concat(O.uid):"uid: ".concat(this._uid);return k.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(ie)),setTimeout((()=>{k.startUpload()}),5e3),this.store.joinEnd(),U=this,je(jp).call(jp,U)||jp.push(U),this._cloudProxyServerMode==="disabled"&&Vt().supportWebCrypto&&X("ENABLE_PRELOAD")&&DP(this._joinInfo),ae}catch(V){const K=Array.isArray(V)?V[0]:V;throw K&&K.code===q.OPERATION_ABORTED?k.warning("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),K):k.error("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),K),K.code!==q.OPERATION_ABORTED&&this._numberOfJoinCount===u&&(this._gateway.state="DISCONNECTED",this._reset()),A.onError(K),K}var U}_joinGateway(){if(!this._joinInfo||!this._key)throw new fe(q.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!X("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){k.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Zr()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),(function(t){const r=jp.indexOf(t);r!==-1&&jp.splice(r,1)})(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return k.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED",$t.LEAVE),k.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof H_))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new fe(q.INVALID_PARAMS,"param list is empty");const r=e;if(this._gateway.role==="audience")throw new fe(q.INVALID_OPERATION,"audience can not publish stream");for(const o of r){if(!(o instanceof H_))throw new fe(q.INVALID_PARAMS,"parameter is not local track");if(!o._enabled&&t)throw new fe(q.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(o.getTrackId()))}k.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(r.map((o=>"".concat(o.getTrackId()," ")))));const a=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&r.forEach((o=>{const u=this._configDistribute.getBitrateLimit();o instanceof wn&&u&&o.setBitrateLimit(u.uplink)}));try{await this._publishHighStream(r),k.info("[".concat(this._clientId,"] Publish success, id ").concat(r.map((o=>"".concat(o.getTrackId()," ")))))}catch(o){throw k.error("[".concat(this._clientId,"] publish error"),o.toString()),o}finally{a()}}async _publishDataChannel(e){if(e==null)throw new fe(q.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(e)));ln(e.id,"id",0,65535,!0),Uc(e.ordered,"ordered"),Gr(e.metadata,"metadata",0,512),k.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex((o=>o.id===e.id))!==-1)throw new fe(q.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new fe(q.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new fe(q.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&X("FORCE_TURN")&&!X("TURN_ENABLE_TCP")&&!X("TURN_ENABLE_UDP"))throw new fe(q.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const r=(function(o){return L8(o,!1)})(e),a=await this._p2pChannel.publishDataChannel([r]);if(a.length>0){if(typeof r._originDataChannelId!="number")throw k.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new fe(q.CREATE_DATACHANNEL_ERROR);try{await Fe.all(a.map((o=>this._uid&&this._gateway.publishDataChannel(this._uid,o,!0)))),await r._waitTillOpen()}catch(o){if(o.code!==q.DISCONNECT_P2P)throw o}}return k.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(r.id)),r}catch(r){throw k.error("[".concat(this._clientId,"] publish datachannels error"),r.toString()),r}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new fe(q.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof H_))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);k.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map((a=>"".concat(a.getTrackId()," ")))," "));const r=await this._publishMutex.lock();try{if(this.store.useP2P){const a=await this._p2pChannel.unpublish(t);a&&await this._gateway.sendExtensionMessage(er.UNPUBLISH,{unpubMsg:a},!0)}else{const a=await this._p2pChannel.unpublish(t);a&&await this._gateway.unpublish(a,this._uid),k.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map((o=>"".concat(o.getTrackId())))))}}catch(a){throw k.error("[".concat(this._clientId,"] unpublish error"),a.toString()),a}finally{r&&r()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),k.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map((r=>"".concat(r.id," ")))," "));const t=await this._publishMutex.lock();try{const r=await this._p2pChannel.unpublishDataChannel(e);r&&await this._gateway.unpublishDataChannel(r),k.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map((a=>"".concat(a.id)))))}catch(r){throw k.error("[".concat(this._clientId,"] unpublish dataChannel error"),r.toString()),r}finally{t&&t()}}async subscribe(e,t,r){if(!(e instanceof Gh)){const a=this.remoteUsers.find((o=>o.uid===e));if(!a)throw new fe(q.INVALID_REMOTE_USER,"user is not in the channel");e=a}return t==="datachannel"?this._subscribeDataChannel(e,r):this._subscribe(e,t)}async presubscribe(e,t){if(vr(t,"mediaType",["audio","video"]),this.store.useP2P)throw new fe(q.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new fe(q.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new fe(q.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const r=t===Xe.AUDIO,a=t===Xe.VIDEO,o=await this._subscribeMutex.lock();try{const{ssrcId:u,ortc:h,rtxSsrcId:m,cname:g,uint_id:y}=await this._gateway.presubscribe(e,t,!0);if(u==null)throw new fe(q.UNEXPECTED_RESPONSE,"no ssrc id");let E=this._users.find((O=>O.uid===e));E||(E=new Gh(e,y||e),E._is_pre_created=!0,this._users.push(E)),g&&(E._cname=g),E._uintid||(E._uintid=y||e),r&&(E._audioSSRC=u,E._audio_pre_subscribed=!0,h&&(E._audioOrtc=h)),a&&(E._videoSSRC=u,E._video_pre_subscribed=!0,h&&(E._videoOrtc=h),m!=null&&(E._rtxSsrcId=m)),k.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(u)),await this._p2pChannel.subscribe(E,t,u,m,h);const A=r?E._audioTrack:E._videoTrack;if(!A)throw new fe(q.UNEXPECTED_ERROR,"can not find remote track in user");return r&&(E._trust_audio_stream_added_state_=!0,E._audio_added_=!0),a&&(E._trust_video_stream_added_state_=!0,E._video_added_=!0),A}catch(u){throw k.error("[".concat(this._clientId,"] presub user ").concat(e," error"),u),u}finally{o()}}async _subscribeDataChannel(e,t){var r;if(ln(t,"channelId",0,65535,!0),!this._joinInfo)throw new fe(q.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new fe(q.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find((m=>m===e)))throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new fe(q.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new fe(q.INVALID_REMOTE_USER,"user is not published");const o=(r=e._dataChannels)===null||r===void 0?void 0:r.find((m=>m.id===t));if(!o)throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new fe(q.REMOTE_USER_IS_NOT_PUBLISHED);const u=await this._subscribeMutex.lock();k.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const m=await this._p2pChannel.subscribeDataChannel(e,[o]);if(m&&je(m).call(m,o.id))try{var h;if(typeof o._originDataChannelId!="number")throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new fe(q.CREATE_DATACHANNEL_ERROR);const g={id:o.id,datachannelId:o._originDataChannelId,ordered:o.ordered,maxRetransmits:o.maxRetransmits,metadata:(h=o.metadata)!==null&&h!==void 0?h:""};await this._gateway.subscribeDataChannel(e.uid,g,!0),await o._waitTillOpen()}catch(g){if(g?.code!==q.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[o]),g;await this._p2pChannel.unsubscribeDataChannel(e,[o]),this._p2pChannel.setPendingRemoteDataChannel(e,o.id)}return k.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),o}finally{u()}}async _p2pSubscribe(e,t,r){if(vr(t,"mediaType",["audio","video"]),!this._joinInfo)throw new fe(q.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new fe(q.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find((u=>u===e))){const u=new fe(q.INVALID_REMOTE_USER,"user is not in the channel");throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),u}if(!e.hasAudio&&!e.hasVideo){const u=new fe(q.INVALID_REMOTE_USER,"user is not published");throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),u}if(!r&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){const u=new fe(q.REMOTE_USER_IS_NOT_PUBLISHED);throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),u}const o=await this._subscribeMutex.lock();k.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const h=t==="audio"?e._audioSSRC:e._videoSSRC,m=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,h,m)}catch(h){throw h}k.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch((h=>{k.warning("[".concat(this._clientId,"] auto set fallback failed"),h)}));const u=t==="audio"?e._audioTrack:e._videoTrack;if(!u)throw new fe(q.UNEXPECTED_ERROR,"can not find remote track in user object");return u}catch(u){throw k.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),u),u}finally{o()}}async _subscribe(e,t,r){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(vr(t,"mediaType",["audio","video"]),!this._joinInfo)throw new fe(q.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new fe(q.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find((y=>y===e))){const y=new fe(q.INVALID_REMOTE_USER,"user is not in the channel");throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),y}if(!e.hasAudio&&!e.hasVideo){const y=new fe(q.INVALID_REMOTE_USER,"user is not published");throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),y}if(!(r||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const y=new fe(q.REMOTE_USER_IS_NOT_PUBLISHED);throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),y}let o=t==="audio"?e._audioSSRC:e._videoSSRC,u=t==="audio"?e._audioOrtc:e._videoOrtc,h=t==="video"?e._rtxSsrcId:void 0,m={stream_type:t==="audio"?Xe.AUDIO:Xe.VIDEO,ssrcId:o};t==="video"&&this.store.firstVideoFrameDecoded(e.uid,{subscribeStart:Date.now()});const g=await this._subscribeMutex.lock();k.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const E=t==="audio"?e._audioSSRC:e._videoSSRC;E!==void 0&&E!==o&&(o=E,u=t==="audio"?e._audioOrtc:e._videoOrtc,h=t==="video"?e._rtxSsrcId:void 0,m={stream_type:t==="audio"?Xe.AUDIO:Xe.VIDEO,ssrcId:o}),di.markSubscribeStart(this.store.clientId,o),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,o,h,u);try{this._p2pChannel.isPreSubScribe(o)||await this._gateway.subscribe(e.uid,m,!0)}catch(A){if(A?.code!==q.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),A;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(E){throw this._p2pChannel.reportSubscribeEvent(!1,E?.code,e,t),E}k.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch((E=>{k.warning("[".concat(this._clientId,"] auto set fallback failed"),E)}));const y=t==="audio"?e._audioTrack:e._videoTrack;if(!y)throw new fe(q.UNEXPECTED_ERROR,"can not find remote track in user object");return t==="video"&&(this.store.firstVideoFrameDecoded(e.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(e)),y}catch(y){throw k.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),y),y}finally{g()}}async massSubscribe(e){if(Vu(e,"subscribeList"),!this._joinInfo)throw new fe(q.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new fe(q.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),r=new Map,a=await this._subscribeMutex.lock();k.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map((m=>{let{user:g,mediaType:y}=m;return"user: ".concat(g?.uid,", mediaType: ").concat(y)})).join("; ")));const o=(e=[...e]).map((m=>{let{user:g,mediaType:y}=m;return{user:g,mediaType:y}})),u=await this._p2pChannel.globalLock();try{var h;for(let g=e.length-1;g>=0;g--){const y=e[g],{user:E,mediaType:A}=y;if(vr(A,"mediaType",["audio","video"]),!E){const U=new fe(q.INVALID_PARAMS,"user property does not exist in subscribeList item");throw k.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),U}if(!this._users.find((U=>U===E))){const U=new fe(q.INVALID_REMOTE_USER,"user is not in the channel");k.error("[".concat(this._clientId,"] can not massSubscribe ").concat(E.uid,", this user is not in the channel")),o[g].error=U,e.splice(g,1);continue}if(A==="audio"&&(!E.hasAudio||E._audioSSRC===void 0)||A==="video"&&(!E.hasVideo||E._videoSSRC===void 0)){const U=new fe(q.REMOTE_USER_IS_NOT_PUBLISHED);k.error("[".concat(this._clientId,"] can not subscribe ").concat(E.uid," with mediaType ").concat(A,", remote user is not published")),o[g].error=U,e.splice(g,1);continue}const N=Ar.Video|Ar.LwoVideo,B=r.get(E);if(B){if(A==="video"?B&N:B&Ar.Audio){e.splice(g,1),k.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(E.uid,", mediaType:").concat(A," twice"));continue}r.set(E,B|(A==="video"?N:Ar.Audio))}else r.set(E,A==="video"?N:Ar.Audio)}for(let g=e.length-1;g>=0;g--){const y=e[g],{user:E,mediaType:A}=y,O=Ar.Video|Ar.LwoVideo;if(this._p2pChannel.hasRemoteMedia(E,A)){await this._p2pChannel.unmuteRemoteNoLock(E,A);const N=r.get(E);r.set(E,A==="video"?N^O:N^Ar.Audio),e.splice(g,1)}}this.store.massSubscribe(e.map((g=>({userId:g.user.uid,type:g.mediaType}))),t);let m=vi(h=Array.from(r.entries())).call(h,((g,y)=>{let[E,A]=y;if(A===0)return g;const O={stream_id:E.uid,stream_type:A};return A&Ar.Audio&&(O.audio_ssrc=E._audioSSRC),A&Ar.Video&&(O.video_ssrc=E._videoSSRC),g.push(O),g}),[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map((y=>{let{user:E,mediaType:A}=y;return{user:E,mediaType:A,ssrcId:A===Xe.VIDEO?E._videoSSRC:E._audioSSRC,rtxSsrcId:A===Xe.VIDEO?E._rtxSsrcId:void 0}})));const g=new Map;if(m=m.filter((y=>y.video_ssrc&&!this._p2pChannel.isPreSubScribe(y.video_ssrc)||y.audio_ssrc&&!this._p2pChannel.isPreSubScribe(y.audio_ssrc)||!y.video_ssrc&&!y.audio_ssrc)),m.length>0){const y=await this._gateway.subscribeAll(m,!0);(y?.users||[]).forEach((E=>{let{stream_id:A,video_error_code:O,audio_error_code:N,error_code:B}=E;(O||N||B)&&g.set(A,{video_error_code:O,audio_error_code:N,error_code:B})}))}if(Array.from(g.entries()).length>0){const y=[];Array.from(g.entries()).forEach((E=>{let[A,O]=E;const N=this.remoteUsers.find((B=>B.uid===A));if(N){let B;O.error_code||O.video_error_code&&O.audio_error_code?B=void 0:O.video_error_code?B=Xe.VIDEO:O.audio_error_code&&(B=Xe.AUDIO),y.push({user:N,mediaType:B})}})),y.length>0&&await this._p2pChannel.massUnsubscribeNoLock(y)}for(const y of o){const E=g.get(y.user.uid);if(E){const A=E.error_code||y.mediaType==="audio"&&E.audio_error_code||y.mediaType==="video"&&E.video_error_code;if(A){const O=tS(A);k.error("user:".concat(y.user.uid," mediaType:").concat(y.mediaType," has massSubscribe error ").concat(O.desc)),y.error=new fe(q.SUBSCRIBE_FAILED,"code ".concat(A,": ").concat(O.desc))}}y.error||(y.mediaType==="video"?y.track=y.user.videoTrack:y.track=y.user.audioTrack)}return this.store.massSubscribe(o.filter((y=>!y.error)).map((y=>({userId:y.user.uid,type:y.mediaType}))),void 0,Date.now()),o.forEach((y=>{var E;nt.subscribe(this.store.sessionId,{succ:!!y.error,ec:((E=y.error)===null||E===void 0?void 0:E.code)||null,video:y.mediaType===Xe.VIDEO,audio:y.mediaType===Xe.AUDIO,peerid:y.user.uid,subscribeRequestid:y.mediaType===Xe.VIDEO?y.user._videoSSRC:y.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(y.user._videoSSRC)},!0)})),k.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map((y=>{let{user:E,mediaType:A}=y;return"user: ".concat(E?.uid,", mediaType: ").concat(A)})).join("; "))),o}catch(g){throw await this._p2pChannel.massUnsubscribeNoLock(e),g}}finally{u(),a()}}async unsubscribe(e,t,r){if(!(e instanceof Gh)){const u=this.remoteUsers.find((h=>h.uid===e));if(!u)throw new fe(q.INVALID_REMOTE_USER,"user is not in the channel");e=u}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,r)}else await this._unsubscribeDataChannel(e,r);if(t&&vr(t,"mediaType",["audio","video"]),!this._joinInfo)throw new fe(q.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find((u=>u===e))){const u=new fe(q.INVALID_REMOTE_USER,"user is not in the channel");throw k.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),u}k.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const o=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{const u=await this._p2pChannel.unsubscribe(e,t);u&&await this._gateway.unsubscribe(u,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&IC(this._users,e),k.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(u){if(u.code===q.DISCONNECT_P2P)return void k.warning("disconnecting p2p, abort unsubscribe request.");throw k.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),u.toString()),u}finally{o()}}async _unsubscribeDataChannel(e,t){if(t&&ln(t,"id",0,65535,!0),!this._joinInfo)throw new fe(q.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find((o=>o===e))){const o=new fe(q.INVALID_REMOTE_USER,"user is not in the channel");throw k.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),o}let a;if(typeof t=="number"){const o=e._dataChannels.find((u=>u.id===t));o&&(a=[o])}else a=e._dataChannels;if(a===void 0){const o=new fe(q.REMOTE_USER_IS_NOT_PUBLISHED);throw k.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),o}k.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(a.map((o=>o.id))));try{const o=await this._p2pChannel.unsubscribeDataChannel(e,a);o&&await this._gateway.unsubscribeDataChannel(o,e.uid),k.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(o))}catch(o){if(o.code===q.DISCONNECT_P2P)return void k.warning("disconnecting p2p, abort unsubscribe request.");throw k.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),o.toString()),o}}async massUnsubscribe(e){if(Vu(e,"unsubscribeList"),!this._joinInfo)throw new fe(q.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");k.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map((r=>{let{user:a,mediaType:o}=r;return"user: ".concat(a?.uid,", mediaType: ").concat(o,";")})).join())),e=[...e];const t=new Map;for(let r=e.length-1;r>=0;r--){const{user:a,mediaType:o}=e[r];if(!a){const m=new fe(q.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw k.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),m}if(vr(o,"mediaType",["video","audio",void 0]),!this._users.find((m=>m===a))){k.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(a.uid,", user is not in the channel")),e.splice(r,1);continue}const h=Ar.Video|Ar.LwoVideo;if(t.has(a)){const m=t.get(a);let g;switch(o){case"video":g=m&h;break;case"audio":g=m&Ar.Audio;break;default:g=m&(Ar.Audio|h)}if(g){k.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(a.uid,",mediaType:").concat(o," twice.")),e.splice(r,1);continue}o?o==="audio"?t.set(a,m|Ar.Audio):o==="video"&&t.set(a,m|h):t.set(a,m|Ar.Audio|h)}else o?o==="audio"?t.set(a,Ar.Audio):o==="video"&&t.set(a,h):t.set(a,Ar.Audio|h)}try{const r=await this._p2pChannel.massUnsubscribe(e);r&&await this._gateway.massUnsubscribe(r),k.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map((a=>{let{user:o,mediaType:u}=a;return"user: ".concat(o?.uid,", mediaType: ").concat(u,";")})).join()))}catch(r){if(r.code===q.DISCONNECT_P2P)return void k.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw k.error("[".concat(this._clientId,"] massUnsubscribe error"),r.toString()),r}}async setLowStreamParameter(e){(function(r){if(!r)throw new ve(q.INVALID_PARAMS);Bn(r.width)||nD(r.width,"streamParameter.width"),Bn(r.height)||nD(r.height,"streamParameter.height"),Bn(r.framerate)||nD(r.framerate,"streamParameter.framerate"),Bn(r.bitrate)||ln(r.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&k.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),k.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,Ie.LocalVideoLowTrack)}async enableDualStream(){if(!Vt().supportDualStream)throw nt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new fe(q.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new fe(q.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw nt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,nt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),k.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new fe(q.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Ie.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw nt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,nt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),k.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if((function(a){vr(a,"role",["audience","host"])})(e),t&&sD(t),this.mode==="rtc"||this.mode==="p2p")throw k.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new fe(q.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new fe(q.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new fe(q.INVALID_OPERATION,"can not set client role to audience when publishing stream");const r=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==r&&X("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",Qr.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),k.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&sD(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch{}finally{k.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const r=t.timestamp-Date.now();return Math.abs(r)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?r:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(Gr(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new fe(q.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new fe(q.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,nt.setProxyServer(this._proxyServer),k.setProxyServer(this._proxyServer),k.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new fe(q.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new fe(q.INVALID_OPERATION,"You have already set the proxy")}if(H0(e))return this._turnServer={servers:e,mode:"original-manual"},void k.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map((r=>r.urls)).join(","),"."));e.forEach((r=>u5(r))),this._turnServer={servers:e,mode:"manual"},k.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new fe(q.INVALID_OPERATION,"you should set license before join channel");if(Gr(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new fe(q.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,k.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new fe(q.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new fe(q.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let r;switch(e===void 0&&(e=3),e){case 1:case 2:throw new fe(q.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:r="proxy3";break;case 4:r="proxy4";break;case 5:r="proxy5";break;default:throw new fe(q.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=r,this.store.cloudProxyServerMode=r,k.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new fe(q.INVALID_OPERATION,"Stop proxy server after leave channel");nt.setProxyServer(),k.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",k.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new fe(q.INVALID_PARAMS,"accessPoints is required.");Vu(e.accessPoints.serverList,"accessPoints.serverList"),Gr(e.accessPoints.domain,"accessPoints.domain");const t=(O,N)=>{ln(O,N,0,65535,!0)};let r=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),r=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new fe(q.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");X("CLOSE_AFB_FOR_LOCAL_AP")&&(sn("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),sn("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const a=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,o=e.accessPoints.domain,u=e.accessPoints.serverList.map((O=>a.test(O)?"".concat(O.replace(/\./g,"-"),".").concat(o):O)),h=u.map((O=>"".concat(O,":").concat(r)));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,sn("WEBCS_DOMAIN",h),sn("WEBCS_DOMAIN_BACKUP_LIST",h),sn("GATEWAY_DOMAINS",[o]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(Vu(e.report.hostname,"report.hostname"),sn("EVENT_REPORT_DOMAIN",e.report.hostname[0]),sn("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(sn("EVENT_REPORT_DOMAIN",u[0]),sn("EVENT_REPORT_BACKUP_DOMAIN",u[1]||u[0]));let m=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),m=e.report.port),sn("STATS_COLLECTOR_PORT",m),e.report?sn("ENABLE_EVENT_REPORT",!0):sn("ENABLE_EVENT_REPORT",!1);let g="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(Vu(e.log.hostname,"log.hostname"),g=e.log.hostname[0]):g=u[0];let y=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),y=e.log.port),sn("LOG_UPLOAD_SERVER","".concat(g,":").concat(y));let E=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(Vu(e.cds.hostname,"cds.hostname"),E=e.cds.hostname):E=u;let A=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),A=e.cds.port),sn("CDS_AP",E.map((O=>"".concat(O,":").concat(A)))),e.cds?sn("ENABLE_CONFIG_DISTRIBUTE",!0):sn("ENABLE_CONFIG_DISTRIBUTE",!1),k.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(Vu(e,"serverList"),Gr(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new fe(q.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const r=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map((a=>r.test(a)?"".concat(a.replace(/\./g,"-"),".").concat(t):a)),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,sn("WEBCS_DOMAIN",e),sn("WEBCS_DOMAIN_BACKUP_LIST",e),sn("GATEWAY_DOMAINS",[t]),sn("EVENT_REPORT_DOMAIN",e[0]),sn("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),sn("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),k.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(vr(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw k.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else k.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){vr(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout((()=>{const r=this._users.find((a=>a.uid===e));r&&r.videoTrack&&r.videoTrack.updateMediaStreamTrackResolution()}),2e3)}catch(r){throw k.error("[".concat(this._clientId,"] set remote video stream type error"),r.toString()),r}k.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){vr(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(r){throw k.error("[".concat(this._clientId,"] set stream fallback option"),r.toString()),r}k.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,r,a){(function(u){vr(u,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),Gr(t,"secret");const o=["aes-128-gcm2","aes-256-gcm2"];if(je(o).call(o,e)){if(!r||!(r instanceof Uint8Array&&r.length===32))throw new fe(q.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(r)throw new fe(q.INVALID_PARAMS,"current encrypt mode does not need salt");if(a){if(Uc(a,"encryptDataStream"),!je(o).call(o,e))throw new fe(q.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||k.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,r&&(this._encryptionSalt=xh(r))}async renewToken(e){if(Gr(e,"token",1,2047),!this._key||!this._joinInfo)throw new fe(q.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const r=await this._renewTokenMutex.lock();try{if(X("USE_NEW_TOKEN")){k.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const a=await Lce(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||sr);k.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:a})}else k.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});k.debug("[".concat(this._clientId,"] renewToken success"))}catch(a){throw this._key=t,this._joinInfo.token=t,k.error("[".concat(this._clientId,"] renewToken failed"),a.toString()),a}finally{r()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?k.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval((()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(xt.VOLUME_INDICATOR,e)}),X("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new fe(q.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new fe(q.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new fe(q.LIVE_STREAMING_TASK_CONFLICT);const r=t?Bu.TRANSCODE:Bu.RAW;return this._createLiveStreamingClient(r).startLiveStreamingTask(e,r)}setLiveTranscoding(e){return this._createLiveStreamingClient(Bu.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter((r=>r&&r.hasUrl(e)));if(!t.length)throw new fe(q.INVALID_PARAMS,"can not find live streaming url to stop");await Fe.all(t.map((r=>r&&r.stopLiveStreamingTask(e))))}async startChannelMediaRelay(e){$8(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){$8(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof dS&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new fe(q.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const o=new TextEncoder;e.payload=o.encode(e.payload)}let a=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&je(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(a=!0,e.payload=await(async function(o,u,h){var m;const g=vi(m=Array.from(h)).call(m,((U,V)=>U+V),0),y={serverTs:0,seq:noe++,length:h.length,checkSum:g},E=new Uint8Array(v5(g,2)),A=new ArrayBuffer(U_),O=new DataView(A);O.setUint32(0,y.serverTs),O.setUint16(4,y.seq),O.setUint16(6,y.length),O.setUint16(8,y.checkSum);const N=16-h.length%16;h=f5(h,new Uint8Array(N));const B=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:o,tagLength:x5,additionalData:E},u,h);return f5(new Uint8Array(A),new Uint8Array(B))})(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new fe(q.INVALID_PARAMS,a?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(ht.DATA_STREAM,{payload:xh(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-Hce},!r)}sendMetadata(e){if(!this._joinInfo)throw new fe(q.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new fe(q.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(ht.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:xh(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(doe),!this._joinInfo)throw new fe(q.INVALID_OPERATION,"can not send custom report, not joined");await nt.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){const e=this._statsCollector.getRemoteNetworkQualityStats();if(X("DELETE_NEQ_AFTER_USER_LEAVE")){const t=this._users.map((r=>r.uid+""));Object.keys(e).forEach((r=>{je(t).call(t,r)||delete e[r]}))}return e}async pickSVCLayer(e,t){vr(t.spatialLayer,"spatialLayer",[0,1,2,3]),vr(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(r){throw k.error("[".concat(this._clientId,"] pick SVC layer failed"),r.toString()),r}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:r}=e;if(Uc(t,"apRTM"),ln(r,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=r,k.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=r,this._gateway.setRTM2Flag(r)}_reset(){if(k.debug("[".concat(this._clientId,"] reset client")),(function(e){const t=X_.indexOf(e);t!==-1&&X_.splice(t,1)})(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=oa.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&TG(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&nt.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach((e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach((t=>t._close())),e._dataChannels.length=0)})),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new oi("client-publish",this._clientId),this._subscribeMutex=new oi("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var r;const a=e||xp();e?k.debug("[".concat(this._clientId,"] new Session ").concat(a)):k.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(a));const o=e?"":this._sessionId||"";this._sessionId=a,this.store.sessionId=a,nt.addSid(a);const u={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:t?.stringUid||((r=this._joinInfo)===null||r===void 0?void 0:r.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:o,clientRole:this.role==="audience"?2:1};nt.sessionInit(this._sessionId,Po({cname:t.channel,appid:t.appId},u)),this._joinInfo&&(this._joinInfo.sid=a),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=a)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new fe(q.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new fe(q.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&X("FORCE_TURN")&&!X("TURN_ENABLE_TCP")&&!X("TURN_ENABLE_UDP"))throw new fe(q.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");k.debug("[".concat(this._clientId,"] publish high stream"));try{const r=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const a=(await r.next()).value;if(a){try{await this._gateway.sendExtensionMessage(er.PUBLISH,a,!0)}catch(o){throw r.throw(o),o}await r.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const a=(await r.next()).value;if(a){var t;let o;try{o=await this._gateway.publish(this._uid,a,!0)}catch(u){if(u.code!==q.DISCONNECT_P2P)throw r.throw(u),u}await r.next(((t=o)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const o of e)o instanceof wn&&o._encoderConfig&&this._gateway.setVideoProfile(o._encoderConfig).catch((u=>{k.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))})),!o.muted&&o.enabled||await this._p2pChannel.muteLocalTrack(o)}}catch(r){if(this._p2pChannel.reportPublishEvent(!1,r?.code,e),r?.code===q.WS_ABORT)return;throw r}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new fe(q.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new fe(q.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));k.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const r=await this._p2pChannel.publishLowStream(this._lowStreamParameter),a=(await r.next()).value;if(a){var t;let o;try{o=await this._gateway.publish(this._uid,a,!0)}catch(u){if(u.code!==q.DISCONNECT_P2P)throw r.throw(u),u}r.next(((t=o)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(r){if(this._p2pChannel.reportPublishEvent(!1,r?.code,void 0,!0),r?.code===q.WS_ABORT)return;throw r}}_createLiveStreamingClient(e){const t=()=>{if(!this._joinInfo||!this._appId)return new fe(q.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const r=(a={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Hu("LiveStreaming").create(a));var a;return r.onLiveStreamError=(o,u)=>{nt.reportApiInvoke(this._sessionId,{name:Xn.ON_LIVE_STREAM_ERROR,options:[o,u],tag:Dn.TRACER}).onSuccess(),this.safeEmit(xt.LIVE_STREAMING_ERROR,o,u)},r.onLiveStreamWarning=(o,u)=>{nt.reportApiInvoke(this._sessionId,{name:Xn.ON_LIVE_STREAM_WARNING,options:[o,u],tag:Dn.TRACER}).onSuccess(),this.safeEmit(xt.LIVE_STREAMING_WARNING,o,u)},r.on(eP.REQUEST_WORKER_MANAGER_LIST,((o,u,h)=>{if(!this._joinInfo)return h(new fe(q.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(m,g,y,E){const A=X("UAP_AP").slice(0,X("AJAX_REQUEST_CONCURRENT")).map((O=>g.proxyServer?"https://".concat(g.proxyServer,"/ap/?url=").concat(O+"/api/v1?action=uap"):"https://".concat(O,"/api/v1?action=uap")));return await Oce(A,m,g,y,E)})(o,this._joinInfo,this._axiosCancelSource.token,sr).then(u).catch(h)})),r};return e===Bu.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new fe(q.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:r}=this.getLocalVideoStats(),a=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:r}},Hu("ChannelMediaRelay").create(e));a.on("state",(o=>{o===Oa.RELAY_STATE_FAILURE&&a&&a.dispose(),this.safeEmit(xt.CHANNEL_MEDIA_RELAY_STATE,o)})),a.on("event",(o=>{this.safeEmit(xt.CHANNEL_MEDIA_RELAY_EVENT,o)})),this._channelMediaRelayClient=a,this._statsCollector.onStatsChanged=(o,u)=>{var h;o==="resolution"&&((h=this._channelMediaRelayClient)===null||h===void 0||h.setVideoProfile(u))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:r,deleted:a}=e,o=[];if(t){const u=[];this._users.forEach((h=>{h._dataChannels.forEach((m=>{r.every((g=>g.uid!==h._uintid||g.stream_id!==m.id))&&u.push({uid:h._uintid,stream_id:m.id,ordered:m.ordered,max_retrans_times:m.maxRetransmits,metadata:m.metadata})}))})),u.length>0&&this._handleUpdateDataChannel({added:[],deleted:u})}Array.isArray(r)&&r.length>0&&r.forEach((u=>{const{uid:h,stream_id:m,ordered:g,max_retrans_times:y,metadata:E}=u,A=this._users.find((O=>O._uintid===h));if(!A)return void k.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(k.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(h)),je(o).call(o,A)||o.push(A),A._uintid||(A._uintid=h),A._dataChannels.findIndex((O=>O.id===u.stream_id))===-1){const O={id:m,ordered:!!g,maxRetransmits:y,metadata:E},N=(function(B){return L8(B,!0)})(O);A._dataChannels.push(N),k.info("[".concat(this._clientId,"] remote user ").concat(A.uid," published datachannel")),t||this.safeEmit(xt.USER_PUBLISHED,A,"datachannel",O)}this._p2pChannel.hasPendingRemoteDataChannel(A,u.stream_id)&&(k.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(A.uid," after reconnect.")),this._subscribeDataChannel(A,u.stream_id).catch((O=>{k.error("[".concat(this._clientId,"] resubscribe datachannel error"),O.toString())})))})),t&&(this.safeEmit(xt.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(a)&&a.length>0&&a.forEach((u=>{const{uid:h,stream_id:m}=u,g=this._users.find((E=>E._uintid===h));if(!g)return void k.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const y=g._dataChannels.find((E=>E.id===u.stream_id));y&&(k.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(h)),this._p2pChannel.unsubscribeDataChannel(g,[y]).then((E=>{if(g._dataChannels=g._dataChannels.filter((A=>A!==y)),E)return this._gateway.unsubscribeDataChannel(E,g.uid)})),k.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished datachannel ,id:").concat(y.id)),this.safeEmit(xt.USER_UNPUBLISHED,g,"datachannel",y._config))}))}_getEncodingName(e){var t;if(!this._joinResponse)return;const r=(t=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||t===void 0?void 0:t.videoCodecs;if(r)for(const o of r){var a;if(o.payloadType===e)return o==null||(a=o.rtpMap)===null||a===void 0?void 0:a.encodingName}}_handleRemoveDataChannels(e){const t=this._users.find((r=>r.uid===e.uid));if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){k.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const r=()=>{k.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach((a=>{this.safeEmit(xt.USER_UNPUBLISHED,t,"datachannel",a._config)}))};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then((a=>{if(a)return this._gateway.unsubscribeDataChannel(a,t.uid)})),r()}}else k.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(Dr.UPDATE_GATEWAY_CONFIG,(()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void k.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),r=Date.now();Object.keys(t).forEach((a=>{const{value:o,type:u,expires:h}=t[a];h&&h<=r||u||YD()||!Object.prototype.hasOwnProperty.call(LC,a)||(Vc[a]=o,In[a]=o,k.debug("Update gateway parameters from config distribute",a,o))}))}catch(t){k.error("Error update config from local cache",t.message)}})()})),this._gateway.on(Dr.DISCONNECT_P2P,(async()=>{await this._p2pChannel.disconnectForReconnect()})),this._gateway.on(Dr.CONNECTION_STATE_CHANGE,((e,t,r)=>{var a;if(r===$t.FALLBACK)return;const o=()=>{this.safeEmit(xt.CONNECTION_STATE_CHANGE,e,t,r)};if(nt.reportApiInvoke(this._sessionId||((a=this._gateway.joinInfo)===null||a===void 0?void 0:a.sid)||null,{name:Xn.CONNECTION_STATE_CHANGE,options:[e,t,r],tag:Dn.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:r})),k.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void o();if(e==="RECONNECTING")this._users.forEach((h=>{h._trust_in_room_=!1,h._trust_audio_enabled_state_=!1,h._trust_video_enabled_state_=!1,h._trust_audio_mute_state_=!1,h._trust_video_mute_state_=!1,h._trust_audio_stream_added_state_=!1,h._trust_video_stream_added_state_=!1,h._is_pre_created||(h._audio_pre_subscribed||(h._audioSSRC=void 0,h._audioOrtc=void 0),h._video_pre_subscribed||(h._videoSSRC=void 0,h._videoOrtc=void 0,h._rtxSsrcId=void 0),h._cname=void 0)})),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var u;this._streamFallbackTypeCacheMap.forEach(((h,m)=>{this._gateway.setStreamFallbackOption(m,h).catch((g=>{k.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),g)}))})),this._remoteStreamTypeCacheMap.forEach(((h,m)=>{this._gateway.setRemoteVideoStreamType(m,h).catch((g=>{k.warning("[".concat(this._clientId,"] auto set remote stream type failed"),g)}))})),this._remoteDefaultVideoStreamType!==void 0&&((u=this._joinInfo)===null||u===void 0?void 0:u.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then((()=>{k.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))})).catch((h=>{k.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(h))})),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout((()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter((h=>!h._trust_in_room_)).forEach((h=>{k.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(h.uid)),this._handleUserOffline({uid:h.uid})})))}),3e3),this._streamRemovedTimeout=window.setTimeout((()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach((h=>{h._trust_audio_mute_state_||(k.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,Xe.AUDIO,!1)),h._trust_video_mute_state_||(k.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,Xe.VIDEO,!1)),h._trust_audio_enabled_state_||(k.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(h.uid)),this._handleSetStreamLocalEnable("audio",h.uid,!0)),h._trust_video_enabled_state_||(k.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(h.uid)),this._handleSetStreamLocalEnable("video",h.uid,!0)),h._trust_video_stream_added_state_||(k.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(h.uid)),this._handleResetAddStream(h,"video")),h._trust_audio_stream_added_state_||(k.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(h.uid)),this._handleResetAddStream(h,"audio")),h._video_added_||h._audio_added_||(k.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(h.uid)),this._handleRemoveStream({uid:h.uid,uint_id:h._uintid}))})))}),1e3))}o()})),this._gateway.on(Dr.REQUEST_NEW_GATEWAY_LIST,(async(e,t)=>{if(!this._joinInfo)return t(new fe(q.UNEXPECTED_ERROR,"can not recover, no join info"));try{let r;const a=await SG(Po(Po({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));a?(r=a.ap,wG(a),this._joinInfo.preload=!0):(r=await gP(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||sr,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=r.gatewayInfo.res,this._joinInfo.gatewayAddrs=r.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=r.gatewayInfo.uni_lbs_ip);const o=[];r.gatewayInfo.gatewayAddrs.forEach((u=>{let{address:h}=u;const[m,g]=h.split(":");this._joinInfo&&this._joinInfo.proxyServer?o.push({proxy:this._joinInfo.proxyServer,host:m,port:g}):o.push({host:m,port:g})})),e(o)}catch(r){t(r)}})),this._gateway.on(Dr.NETWORK_QUALITY,(e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(xt.NETWORK_QUALITY,e)})),this._gateway.on(Dr.STREAM_TYPE_CHANGE,((e,t)=>{this.safeEmit(xt.STREAM_TYPE_CHANGED,e,t),nt.reportApiInvoke(this._sessionId,{name:Xn.STREAM_TYPE_CHANGE,options:[e,t],tag:Dn.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))})),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(Dr.IS_P2P_DISCONNECTED,(e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)})),this._gateway.on(Dr.REQUEST_P2P_CONNECTION_PARAMS,(async(e,t,r)=>{try{let a=await this._p2pChannel.getEstablishParams();a&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(a=await this._p2pChannel.startP2PConnection(e)),t(a)}catch(a){r(a)}})),this._gateway.on(Dr.JOIN_RESPONSE,((e,t)=>{if(this.store.useP2P)return;let r;this._joinResponse=e,e.attributes?r=e.attributes.userAttributes.preSubSsrcs:k.debug("no attributes in joinResponse");const a=T8(e.ortc,t,r);this._p2pChannel.connect(a)})),this._gateway.on(Dr.PRE_CONNECT_PC,(async e=>{const{candidates:t,fingerprint:r,turnServer:a}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){const{cert:u,cid:h}=this._joinInfo.apResponse,m="".concat(h,"_").concat(u);if(m.length<4||m.length>256)return;await this._p2pChannel.startP2PConnection({turnServer:a,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var o;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(h,"_").concat(u),icePwd:"".concat(h,"_").concat(u)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(o=X("FINGERPRINT"))!==null&&o!==void 0?o:r}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}catch(g){g.code&&g.code===q.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:a,cloudProxyServer:this._joinInfo.cloudProxyServer},!0)}}}))}_handleGatewaySignalEvents(){this._gateway.signal.on(Dt.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Dt.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Dt.ON_ADD_AUDIO_STREAM,(e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc))),this._gateway.signal.on(Dt.ON_ADD_VIDEO_STREAM,(e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc,e.rtxSsrcId))),this._gateway.signal.on(Dt.ON_REMOTE_DATASTREAM_UPDATE,(e=>{this._handleUpdateDataChannel(e)})),this._gateway.signal.on(Dt.ON_REMOTE_FULL_DATASTREAM_INFO,(e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)})),this._gateway.signal.on(Dt.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Dt.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Dt.MUTE_AUDIO,(e=>this._handleMuteStream(e.uid,Xe.AUDIO,!0))),this._gateway.signal.on(Dt.UNMUTE_AUDIO,(e=>this._handleMuteStream(e.uid,Xe.AUDIO,!1))),this._gateway.signal.on(Dt.MUTE_VIDEO,(e=>this._handleMuteStream(e.uid,Xe.VIDEO,!0))),this._gateway.signal.on(Dt.UNMUTE_VIDEO,(e=>this._handleMuteStream(e.uid,Xe.VIDEO,!1))),this._gateway.signal.on(Dt.RECEIVE_METADATA,(e=>{const t=Np(e.metadata);this.safeEmit(xt.RECEIVE_METADATA,e.uid,t)})),this._gateway.signal.on(Dt.ON_DATA_STREAM,(async e=>{var t;if(!e)return;let r=Np(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&je(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<U_)throw new fe(q.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(U_));r=await(async function(u,h,m){const g=m.subarray(0,U_),y=g.slice(8,U_),E=(y[0]<<8)+y[1],A=(g[6]<<8)+g[7],O=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:u,tagLength:x5,additionalData:new Uint8Array(v5(E,2))},h,m.subarray(U_));return new Uint8Array(O).subarray(0,A)})(this._encryptDataStreamIv,this._encryptDataStreamKey,r)}let a=0;if(e.ordered||e.syncWithAudio){const o=this._p2pChannel.getStats(),u=this.remoteUsers.find((m=>m.uid===e.uid)),h=o?.audioRecv.find((m=>m.ssrc===u?._audioSSRC));a=h?.jitterBufferMs}(a==null||Number.isNaN(a))&&(a=0),zce(Po(Po({},e),{},{payload:r}),a,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})})),this._gateway.signal.on(Dt.ON_CRYPT_ERROR,(()=>{Nh((()=>{k.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(xt.CRYPT_ERROR)}),this._sessionId)})),this._gateway.signal.on(Dt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Dt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{k.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,$t.TOKEN_EXPIRE),this.safeEmit(xt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()})),this._gateway.signal.on(Dt.ON_STREAM_FALLBACK_UPDATE,(e=>{k.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(xt.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")})),this._gateway.signal.on(Dt.ON_PUBLISH_STREAM,(e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),k.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))})),this._gateway.signal.on(Dt.ENABLE_LOCAL_VIDEO,(e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)})),this._gateway.signal.on(Dt.DISABLE_LOCAL_VIDEO,(e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)})),this._gateway.signal.on(pt.REQUEST_TIMEOUT,((e,t)=>{if(this._joinInfo)switch(e){case ht.PUBLISH:{if(!t)return;const o=t.ortc;if(o){var r,a;const u=o.some((g=>{let{stream_type:y}=g;return y===Qt.Audio})),h=o.some((g=>{let{stream_type:y}=g;return y!==Qt.Audio})),m=o.some((g=>{let{stream_type:y}=g;return y===Qt.Screen||y===Qt.ScreenLow}));t.state==="offer"&&nt.publish(this._joinInfo.sid,{eventElapse:di.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:q.TIMEOUT,audio:u,video:h,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:m,audioName:u?(r=o.find((g=>{let{stream_type:y}=g;return y===Qt.Audio})))===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId.toString():void 0,videoName:h?(a=o.find((g=>{let{stream_type:y}=g;return y!==Qt.Audio})))===null||a===void 0||(a=a.ssrcs[0])===null||a===void 0?void 0:a.ssrcId.toString():void 0})}break}case ht.SUBSCRIBE:t&&nt.subscribe(this._joinInfo.sid,{succ:!1,ec:q.TIMEOUT,audio:t.stream_type===Xe.AUDIO,video:t.stream_type===Xe.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:di.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}})),this._gateway.signal.on(Dt.ON_P2P_OK,(e=>{this.uid,this._uid})),this._gateway.signal.on(Dt.ON_PUBLISHED_USER_LIST,(e=>{if(e==null||!e.users)return;X("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter((a=>!Vp(a.string_id||a.stream_id,this.channelName))));const t=[],r=[];for(const a of e.users){let o=this._users.find((E=>E._uintid===a.stream_id));o?o._trust_in_room_=!0:(o=new Gh(a.string_id||a.stream_id,a.stream_id),this._users.push(o),this.store.firstVideoFrameDecoded(o.uid,{userJoinNotify:Date.now()}),this.getListeners(xt.PUBLISHED_USER_LIST).length===0&&(k.debug("[".concat(this._clientId,"] user online"),a.stream_id),this.safeEmit(xt.USER_JOINED,o)));const u=Ar.Audio&a.stream_type,h=(Ar.Video|Ar.LwoVideo)&a.stream_type,m=(65280&a.stream_type)!=0,g=u&&o.hasAudio,y=h&&o.hasVideo;h&&(o._trust_video_stream_added_state_=!0,o._video_added_=!0,o._videoSSRC=a.video_ssrc,o._rtxSsrcId=a.video_rtx),u&&(o._trust_audio_stream_added_state_=!0,o._audio_added_=!0,o._audioSSRC=a.audio_ssrc),u&&!g&&this.getListeners(xt.PUBLISHED_USER_LIST).length===0&&(k.info("[".concat(this._clientId,"] remote user ").concat(o.uid," published audio")),this.safeEmit(xt.USER_PUBLISHED,o,"audio")),h&&!y&&this.getListeners(xt.PUBLISHED_USER_LIST).length===0&&(k.info("[".concat(this._clientId,"] remote user ").concat(o.uid," published video")),this.safeEmit(xt.USER_PUBLISHED,o,"video")),(u&&!g||h&&!y||m)&&t.push(o),h&&this._p2pChannel.hasPendingRemoteMedia(o,"video")&&r.push({user:o,mediaType:"video"}),u&&this._p2pChannel.hasPendingRemoteMedia(o,"audio")&&r.push({user:o,mediaType:"audio"})}r.length>0&&(k.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(r.map((a=>"user: ".concat(a.user.uid,", mediaType: ").concat(a.mediaType))).join("; ")," ")),this.massSubscribe(r).catch((a=>{k.error("[".concat(this._clientId,"] mass resubscribe error"),a.toString())}))),this.getListeners(xt.PUBLISHED_USER_LIST).length>0?X("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(k.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map((a=>a.uid)).join(", "))),this.safeEmit(xt.PUBLISHED_USER_LIST,t)):k.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map((a=>a.uid)).join(", ")))})),this._gateway.signal.on(Dt.ON_RTP_CAPABILITY_CHANGE,(e=>{const{video_codec:t}=e;this._p2pChannel instanceof dS&&this._p2pChannel.updateRemoteRTPCapabilities(t.map((r=>r.toLowerCase())).filter((r=>{var a;return je(a=Object.keys(q0)).call(a,r)})))}))}_handleP2PEvents(){this._gateway.signal.on(Dt.ON_USER_OFFLINE,(()=>{this._p2pChannel.disconnectForReconnect()})),this._gateway.signal.on(er.PUBLISH,((e,t,r)=>{const{uid:a}=e;e.forEach((o=>{const{kind:u,ssrcs:h,mid:m,isMuted:g}=o;this._handleP2PAddAudioOrVideoStream(u,a,h[0].ssrcId,m);const y=this._users.find((E=>E.uid===a));return y&&this.store.useP2P?this._p2pChannel.mockSubscribe(y,u,h[0].ssrcId,m).then((()=>{t()})).catch(r):t(),this._handleMuteStream(a,u,!!g)}))})),this._gateway.signal.on(er.CALL,(async(e,t,r)=>{if(this.store.useP2P)try{var a;t(await this._p2pChannel.startP2P({turnServer:(a=this._joinInfo)===null||a===void 0?void 0:a.turnServer},e))}catch(o){r(o)}})),this._gateway.signal.on(pt.P2P_CONNECTION,(async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)})),this._gateway.signal.on(er.UNPUBLISH,(async(e,t,r)=>{if(this.store.useP2P){const{unpubMsg:a,uid:o}=e,u=this._users.find((h=>h.uid===o));if(!u)return k.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(o)),void t();try{a.forEach((async h=>{let{stream_type:m}=h;const g=m===Qt.Audio?Xe.AUDIO:Xe.VIDEO;await this._p2pChannel.unsubscribe(u,g),this._handleMuteStream(o,g,!0)})),t()}catch(h){r(h)}}})),this._gateway.signal.on(er.CONTROL,(async(e,t)=>{const{action:r}=e;switch(r){case Lh.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,Xe.VIDEO,!0);break;case Lh.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,Xe.AUDIO,!0);break;case Lh.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,Xe.VIDEO,!1);break;case Lh.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,Xe.AUDIO,!1)}})),this._gateway.signal.on(er.RESTART_ICE,(async(e,t,r)=>{if(this.store.useP2P)try{const{direction:a,iceParameter:o}=e;a!==Ji.SEND_ONLY||o?t(await this._p2pChannel.restartICE(a,o)):(this._p2pChannel.handleDisconnect(a),t())}catch(a){r(a)}})),this._gateway.signal.on(er.CANDIDATE,(e=>{if(this.store.useP2P){const{candidate:t,direction:r}=e;this._p2pChannel.addRemoteCandidate(t,r)}})),this._p2pChannel.on(at.RequestP2PRestartICE,(async(e,t,r)=>{try{const{direction:a}=e;t(await this._gateway.sendExtensionMessage(er.RESTART_ICE,e,a===Ji.SEND_ONLY))}catch(a){r(a)}})),this._p2pChannel.on(at.LocalCandidate,(e=>{this._gateway.sendExtensionMessage(er.CANDIDATE,JSON.stringify(e),!0)})),this._p2pChannel.on(at.RequestP2PMuteLocal,(async(e,t,r)=>{try{await this._gateway.sendExtensionMessage(er.CONTROL,e,!0),t()}catch(a){r(a)}})),this._p2pChannel.on(at.RequestP2PUnmuteRemote,(async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(a){a.code===q.DISCONNECT_P2P?t():r(a)}else t()})),this._p2pChannel.on(at.RequestP2PMuteRemote,(async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(a){a.code===q.DISCONNECT_P2P?t():r(a)}else t()})),this._p2pChannel.on(at.StateChange,((e,t)=>{t===Zt.Connected&&this._p2pChannel.republish()}))}_handleP2PChannelEvents(){this._p2pChannel.on(at.PeerConnectionStateChange,(e=>{const t=this._peerConnectionState;e!==t&&(this.safeEmit(xt.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)})),this._p2pChannel.on(at.RequestMuteLocal,(async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(a){a.code===q.DISCONNECT_P2P?t():r(a)}else t()})),this._p2pChannel.on(at.RequestUnmuteLocal,(async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(a){a.code===q.DISCONNECT_P2P?t():r(a)}else t()})),this._p2pChannel.on(at.RequestRePublish,((e,t,r)=>{this.publish(e,!1).then(t).catch(r)})),this._p2pChannel.on(at.RequestRePublishDataChannel,((e,t,r)=>{Fe.all(e.map((async a=>{const o=await this._p2pChannel.publishDataChannel([a]);try{o.forEach((u=>{this._uid&&this._gateway.publishDataChannel(this._uid,u,!0)}))}catch(u){if(u.code!==q.DISCONNECT_P2P)throw u}}))).then(t).catch(r)})),this._p2pChannel.on(at.RequestReSubscribe,(async(e,t,r)=>{try{for(const{user:a,kind:o}of e)o===Xe.VIDEO?await this.subscribe(a,"video"):await this.subscribe(a,"audio");t()}catch(a){r(a)}})),this._p2pChannel.on(at.RequestUpload,((e,t)=>{this._gateway.upload(e,t)})),this._p2pChannel.on(at.RequestUploadStats,(e=>{this._gateway.uploadWRTCStats(e)})),this._p2pChannel.on(at.MediaReconnectStart,(e=>{this.safeEmit(xt.MEDIA_RECONNECT_START,e)})),this._p2pChannel.on(at.MediaReconnectEnd,(e=>{this.safeEmit(xt.MEDIA_RECONNECT_END,e)})),this._p2pChannel.on(at.NeedSignalRTT,(e=>{e(this._gateway.getSignalRTT())})),this._p2pChannel.on(at.RequestRestartICE,(async e=>{if(this.store.useP2P)return;const t=await this._p2pChannel.restartICE(e),r=await t.next();if(r.done)return;const a=r.value;let o;try{o=await this._gateway.restartICE({iceParameters:a})}catch(h){return void t.throw(h)}const{iceParameters:u}=(function(h){const m=h.iceParameters;return{iceParameters:{iceUfrag:m.iceUfrag,icePwd:m.icePwd}}})(o);await t.next({remoteIceParameters:u})})),this._p2pChannel.on(at.RequestReconnect,(async()=>{this._gateway.reconnect()})),this._p2pChannel.on(at.RequestReconnectPC,(async()=>{var e;const{iceParameters:t,dtlsParameters:r,rtpCapabilities:a}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:o,gatewayAddress:u}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:r,rtpCapabilities:a}),h=T8(o,u);await this._p2pChannel.connect(h),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()})),this._p2pChannel.on(at.RequestUnpublishForReconnectPC,(async(e,t,r)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):r()})),this._p2pChannel.on(at.P2PLost,(()=>{this.safeEmit(xt.P2P_LOST,this.store.uid)})),this._p2pChannel.on(at.UpdateVideoEncoder,(e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)})),this._p2pChannel.on(at.ConnectionTypeChange,(e=>{this.safeEmit(xt.IS_USING_CLOUD_PROXY,e)})),this._p2pChannel.on(at.RequestLowStreamParameter,(e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})})),this._p2pChannel.on(at.QueryClientConnectionState,(e=>{e(this.connectionState)})),this._p2pChannel.on(at.AudioMetadata,(e=>{this.safeEmit(xt.AUDIO_METADATA,e)})),this._p2pChannel.on(at.AudioPts,(e=>{this.safeEmit(xt.AUDIO_PTS,Number(e))}))}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new fe(q.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new fe(q.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const r=(t={config:e},Hu("ContentInspect").create(t));this._inspect=r,this.handleVideoInspectEvents(r);const{appId:a,cname:o,sid:u,token:h,uid:m,cid:g,vid:y}=this._joinInfo;await r.init({appId:a,areaCode:"",cname:o,sid:u,token:h,uid:m,cid:g,vid:y?Number(y):0},sr)}catch(r){throw Array.isArray(r)?r[0]:r}var t}handleVideoInspectEvents(e){e.on(Pr.CONNECTION_STATE_CHANGE,((t,r)=>{if(this.safeEmit(xt.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,r),r===Io.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(xt.CONTENT_INSPECT_ERROR,new fe(q.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}})),e.on(Pr.INSPECT_RESULT,((t,r)=>{var a;if(r?.code===q.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return k.debug("Stop inspect content because that has left channel"),this==null||(a=this._inspect)===null||a===void 0||a.close(),void(this._inspect=void 0);this.safeEmit(xt.CONTENT_INSPECT_RESULT,t,r)})),e.on(Pr.CLIENT_LOCAL_VIDEO_TRACK,(t=>{t(this.localTracks.filter((r=>r.trackMediaType==="video"))[0])}))}async disableContentInspect(){if(!this._inspect)throw new fe(q.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(Uc(e,"enabled"),e){if(!t)throw new fe(q.INVALID_PARAMS,"config is required");if(jG(t),!this._joinInfo)throw new fe(q.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{const a=(r={config:t},Hu("ImageModeration").create(r));this._moderation=a,this.handleImageModerationEvents(a);const{appId:o,cname:u,sid:h,token:m,uid:g,cid:y,vid:E}=this._joinInfo;await a.init({appId:o,areaCode:"",cname:u,sid:h,token:m,uid:g,cid:y,vid:E?Number(E):0},sr)}}catch(a){throw Array.isArray(a)?a[0]:a}}else{var r;if(!this._moderation)throw new fe(q.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(a){throw Array.isArray(a)?a[0]:a}}}handleImageModerationEvents(e){e.on(Gc.CONNECTION_STATE_CHANGE,((t,r)=>{if(this.safeEmit(xt.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,r),t===zs.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new fe(q.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}})),e.on(Gc.CLIENT_LOCAL_VIDEO_TRACK,(t=>{t(this.localTracks.filter((r=>r.trackMediaType==="video"))[0])}))}setP2PTransport(e){if((function(t){vr(t,"transport",["default","auto","relay","sd-rtn"])})(e),this.mode!=="p2p")throw new fe(q.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,k.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return k.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){Uc(e,"enabled"),sn("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},Qe(Ye.prototype,"leave",[VG],Object.getOwnPropertyDescriptor(Ye.prototype,"leave"),Ye.prototype),Qe(Ye.prototype,"publish",[BG],Object.getOwnPropertyDescriptor(Ye.prototype,"publish"),Ye.prototype),Qe(Ye.prototype,"unpublish",[FG],Object.getOwnPropertyDescriptor(Ye.prototype,"unpublish"),Ye.prototype),Qe(Ye.prototype,"subscribe",[GG],Object.getOwnPropertyDescriptor(Ye.prototype,"subscribe"),Ye.prototype),Qe(Ye.prototype,"presubscribe",[HG],Object.getOwnPropertyDescriptor(Ye.prototype,"presubscribe"),Ye.prototype),Qe(Ye.prototype,"massSubscribe",[WG],Object.getOwnPropertyDescriptor(Ye.prototype,"massSubscribe"),Ye.prototype),Qe(Ye.prototype,"unsubscribe",[zG],Object.getOwnPropertyDescriptor(Ye.prototype,"unsubscribe"),Ye.prototype),Qe(Ye.prototype,"massUnsubscribe",[KG],Object.getOwnPropertyDescriptor(Ye.prototype,"massUnsubscribe"),Ye.prototype),Qe(Ye.prototype,"setLowStreamParameter",[YG],Object.getOwnPropertyDescriptor(Ye.prototype,"setLowStreamParameter"),Ye.prototype),Qe(Ye.prototype,"enableDualStream",[qG],Object.getOwnPropertyDescriptor(Ye.prototype,"enableDualStream"),Ye.prototype),Qe(Ye.prototype,"disableDualStream",[XG],Object.getOwnPropertyDescriptor(Ye.prototype,"disableDualStream"),Ye.prototype),Qe(Ye.prototype,"setClientRole",[JG],Object.getOwnPropertyDescriptor(Ye.prototype,"setClientRole"),Ye.prototype),Qe(Ye.prototype,"_setClientRoleOptions",[$G],Object.getOwnPropertyDescriptor(Ye.prototype,"_setClientRoleOptions"),Ye.prototype),Qe(Ye.prototype,"setProxyServer",[ZG],Object.getOwnPropertyDescriptor(Ye.prototype,"setProxyServer"),Ye.prototype),Qe(Ye.prototype,"setTurnServer",[QG],Object.getOwnPropertyDescriptor(Ye.prototype,"setTurnServer"),Ye.prototype),Qe(Ye.prototype,"setLicense",[eH],Object.getOwnPropertyDescriptor(Ye.prototype,"setLicense"),Ye.prototype),Qe(Ye.prototype,"startProxyServer",[tH],Object.getOwnPropertyDescriptor(Ye.prototype,"startProxyServer"),Ye.prototype),Qe(Ye.prototype,"stopProxyServer",[nH],Object.getOwnPropertyDescriptor(Ye.prototype,"stopProxyServer"),Ye.prototype),Qe(Ye.prototype,"setLocalAccessPointsV2",[rH],Object.getOwnPropertyDescriptor(Ye.prototype,"setLocalAccessPointsV2"),Ye.prototype),Qe(Ye.prototype,"setLocalAccessPoints",[iH],Object.getOwnPropertyDescriptor(Ye.prototype,"setLocalAccessPoints"),Ye.prototype),Qe(Ye.prototype,"setRemoteDefaultVideoStreamType",[aH],Object.getOwnPropertyDescriptor(Ye.prototype,"setRemoteDefaultVideoStreamType"),Ye.prototype),Qe(Ye.prototype,"setRemoteVideoStreamType",[sH],Object.getOwnPropertyDescriptor(Ye.prototype,"setRemoteVideoStreamType"),Ye.prototype),Qe(Ye.prototype,"setStreamFallbackOption",[oH],Object.getOwnPropertyDescriptor(Ye.prototype,"setStreamFallbackOption"),Ye.prototype),Qe(Ye.prototype,"setEncryptionConfig",[cH],Object.getOwnPropertyDescriptor(Ye.prototype,"setEncryptionConfig"),Ye.prototype),Qe(Ye.prototype,"renewToken",[lH],Object.getOwnPropertyDescriptor(Ye.prototype,"renewToken"),Ye.prototype),Qe(Ye.prototype,"enableAudioVolumeIndicator",[uH],Object.getOwnPropertyDescriptor(Ye.prototype,"enableAudioVolumeIndicator"),Ye.prototype),Qe(Ye.prototype,"startLiveStreaming",[dH],Object.getOwnPropertyDescriptor(Ye.prototype,"startLiveStreaming"),Ye.prototype),Qe(Ye.prototype,"setLiveTranscoding",[hH],Object.getOwnPropertyDescriptor(Ye.prototype,"setLiveTranscoding"),Ye.prototype),Qe(Ye.prototype,"stopLiveStreaming",[fH],Object.getOwnPropertyDescriptor(Ye.prototype,"stopLiveStreaming"),Ye.prototype),Qe(Ye.prototype,"startChannelMediaRelay",[pH],Object.getOwnPropertyDescriptor(Ye.prototype,"startChannelMediaRelay"),Ye.prototype),Qe(Ye.prototype,"updateChannelMediaRelay",[mH],Object.getOwnPropertyDescriptor(Ye.prototype,"updateChannelMediaRelay"),Ye.prototype),Qe(Ye.prototype,"stopChannelMediaRelay",[gH],Object.getOwnPropertyDescriptor(Ye.prototype,"stopChannelMediaRelay"),Ye.prototype),Qe(Ye.prototype,"sendCustomReportMessage",[_H],Object.getOwnPropertyDescriptor(Ye.prototype,"sendCustomReportMessage"),Ye.prototype),Qe(Ye.prototype,"pickSVCLayer",[vH],Object.getOwnPropertyDescriptor(Ye.prototype,"pickSVCLayer"),Ye.prototype),Qe(Ye.prototype,"setRTMConfig",[yH],Object.getOwnPropertyDescriptor(Ye.prototype,"setRTMConfig"),Ye.prototype),Qe(Ye.prototype,"enableContentInspect",[EH],Object.getOwnPropertyDescriptor(Ye.prototype,"enableContentInspect"),Ye.prototype),Qe(Ye.prototype,"disableContentInspect",[SH],Object.getOwnPropertyDescriptor(Ye.prototype,"disableContentInspect"),Ye.prototype),Qe(Ye.prototype,"setImageModeration",[bH],Object.getOwnPropertyDescriptor(Ye.prototype,"setImageModeration"),Ye.prototype),Qe(Ye.prototype,"setP2PTransport",[TH],Object.getOwnPropertyDescriptor(Ye.prototype,"setP2PTransport"),Ye.prototype),Qe(Ye.prototype,"getJoinChannelServiceRecords",[wH],Object.getOwnPropertyDescriptor(Ye.prototype,"getJoinChannelServiceRecords"),Ye.prototype),Qe(Ye.prototype,"setPublishAudioFilterEnabled",[RH],Object.getOwnPropertyDescriptor(Ye.prototype,"setPublishAudioFilterEnabled"),Ye.prototype),Ye);class pS{constructor(t,r){H(this,"id",0),H(this,"element",void 0),H(this,"peerPair",void 0),H(this,"context",void 0),H(this,"audioPlayerElement",void 0),H(this,"audioTrack",void 0),pS.count+=1,this.id=pS.count,this.element=t,this.context=r}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const r=document.createElement("audio");r.srcObject=new MediaStream([t.track]),r.play(),this.audioPlayerElement=r}}async switchSdp(){if(!this.peerPair)return;const t=async(a,o)=>{const u=o==="offer"?await a.createOffer():await a.createAnswer();return await a.setLocalDescription(u),a.iceGatheringState==="complete"?a.localDescription:new Fe((h=>{a.onicegatheringstatechange=()=>{a.iceGatheringState==="complete"&&h(a.localDescription)}}))},r=async(a,o)=>await a.setRemoteDescription(o);try{const a=await t(this.peerPair[0],"offer");await r(this.peerPair[1],a);const o=await t(this.peerPair[1],"answer");await r(this.peerPair[0],o)}catch(a){throw new fe(q.LOCAL_AEC_ERROR,a.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let r;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),r=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(r)}catch(o){throw new fe(q.LOCAL_AEC_ERROR,o.toString()).print()}if(!r)throw new fe(q.LOCAL_AEC_ERROR,"no dest node when local aec").print();const a=r.stream.getAudioTracks()[0];return this.audioTrack=a,a}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,r=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(r),await this.switchSdp()}close(){k.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach((t=>{t.close()})),this.peerPair=void 0,this.audioPlayerElement=void 0}}var AH,NA;H(pS,"count",0);const ole=window.AudioContext||window.webkitAudioContext,cle=new(AH=lt({report:nt}),Qe((NA=class{constructor(){H(this,"units",[]),H(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return k.debug("the system does not need to process local aec"),-1;this.context||(this.context=new ole);let t=this.units.find((r=>r&&r.getElement()===e));return t||(t=new pS(e,this.context),this.units.push(t)),t.startEchoCancellation(),k.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return Lt().name!==Gt.SAFARI}}).prototype,"processExternalMediaAEC",[AH],Object.getOwnPropertyDescriptor(NA.prototype,"processExternalMediaAEC"),NA.prototype),NA);function OH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),r.push.apply(r,a)}return r}function IH(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?OH(Object(r),!0).forEach((function(a){H(e,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):OH(Object(r)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))}))}return e}const LP=window||document;function NH(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!LP)return;const r=or._cspEventHandlerPointer;if(r&&t)return void console.error(r,t);const a=o=>{if(!(o&&o.blockedURI&&(or.onSecurityPolicyViolation||or.getListeners(Ll.SECURITY_POLICY_VIOLATION).length>0)))return;const u=o.blockedURI;X("CSP_DETECTED_HOSTNAME_LIST").some((h=>je(u).call(u,h)))&&(or.onSecurityPolicyViolation&&typeof or.onSecurityPolicyViolation=="function"&&or.onSecurityPolicyViolation(o),or.getListeners(Ll.SECURITY_POLICY_VIOLATION).length>0&&or.safeEmit(Ll.SECURITY_POLICY_VIOLATION,o))};r&&LP.removeEventListener("securitypolicyviolation",r),(t||e&&typeof e=="function"||or.getListeners(Ll.SECURITY_POLICY_VIOLATION).length>0)&&LP.addEventListener("securitypolicyviolation",a),or._cspEventHandlerPointer=a}var lle=D,ule=dB,xH=RegExp.prototype,dle=function(e){return e===xH||lle(xH,e)?ule(e):e.flags},Ui=f(dle);function lv(e){let t=e.length;for(;--t>=0;)e[t]=0}const MP=256,DH=286,mS=30,gS=15,UP=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),xA=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),hle=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),PH=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),zu=new Array(576);lv(zu);const _S=new Array(60);lv(_S);const vS=new Array(512);lv(vS);const yS=new Array(256);lv(yS);const jP=new Array(29);lv(jP);const DA=new Array(mS);function VP(e,t,r,a,o){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=a,this.max_length=o,this.has_stree=e&&e.length}let kH,LH,MH;function BP(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}lv(DA);const UH=e=>e<256?vS[e]:vS[256+(e>>>7)],ES=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},As=(e,t,r)=>{e.bi_valid>16-r?(e.bi_buf|=t<<e.bi_valid&65535,ES(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=r-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)},jl=(e,t,r)=>{As(e,r[2*t],r[2*t+1])},jH=(e,t)=>{let r=0;do r|=1&e,e>>>=1,r<<=1;while(--t>0);return r>>>1},VH=(e,t,r)=>{const a=new Array(16);let o,u,h=0;for(o=1;o<=gS;o++)h=h+r[o-1]<<1,a[o]=h;for(u=0;u<=t;u++){let m=e[2*u+1];m!==0&&(e[2*u]=jH(a[m]++,m))}},BH=e=>{let t;for(t=0;t<DH;t++)e.dyn_ltree[2*t]=0;for(t=0;t<mS;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},FH=e=>{e.bi_valid>8?ES(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},GH=(e,t,r,a)=>{const o=2*t,u=2*r;return e[o]<e[u]||e[o]===e[u]&&a[t]<=a[r]},FP=(e,t,r)=>{const a=e.heap[r];let o=r<<1;for(;o<=e.heap_len&&(o<e.heap_len&&GH(t,e.heap[o+1],e.heap[o],e.depth)&&o++,!GH(t,a,e.heap[o],e.depth));)e.heap[r]=e.heap[o],r=o,o<<=1;e.heap[r]=a},HH=(e,t,r)=>{let a,o,u,h,m=0;if(e.sym_next!==0)do a=255&e.pending_buf[e.sym_buf+m++],a+=(255&e.pending_buf[e.sym_buf+m++])<<8,o=e.pending_buf[e.sym_buf+m++],a===0?jl(e,o,t):(u=yS[o],jl(e,u+MP+1,t),h=UP[u],h!==0&&(o-=jP[u],As(e,o,h)),a--,u=UH(a),jl(e,u,r),h=xA[u],h!==0&&(a-=DA[u],As(e,a,h)));while(m<e.sym_next);jl(e,256,t)},GP=(e,t)=>{const r=t.dyn_tree,a=t.stat_desc.static_tree,o=t.stat_desc.has_stree,u=t.stat_desc.elems;let h,m,g,y=-1;for(e.heap_len=0,e.heap_max=573,h=0;h<u;h++)r[2*h]!==0?(e.heap[++e.heap_len]=y=h,e.depth[h]=0):r[2*h+1]=0;for(;e.heap_len<2;)g=e.heap[++e.heap_len]=y<2?++y:0,r[2*g]=1,e.depth[g]=0,e.opt_len--,o&&(e.static_len-=a[2*g+1]);for(t.max_code=y,h=e.heap_len>>1;h>=1;h--)FP(e,r,h);g=u;do h=e.heap[1],e.heap[1]=e.heap[e.heap_len--],FP(e,r,1),m=e.heap[1],e.heap[--e.heap_max]=h,e.heap[--e.heap_max]=m,r[2*g]=r[2*h]+r[2*m],e.depth[g]=(e.depth[h]>=e.depth[m]?e.depth[h]:e.depth[m])+1,r[2*h+1]=r[2*m+1]=g,e.heap[1]=g++,FP(e,r,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((E,A)=>{const O=A.dyn_tree,N=A.max_code,B=A.stat_desc.static_tree,U=A.stat_desc.has_stree,V=A.stat_desc.extra_bits,K=A.stat_desc.extra_base,z=A.stat_desc.max_length;let J,ae,ie,ee,le,ye,we=0;for(ee=0;ee<=gS;ee++)E.bl_count[ee]=0;for(O[2*E.heap[E.heap_max]+1]=0,J=E.heap_max+1;J<573;J++)ae=E.heap[J],ee=O[2*O[2*ae+1]+1]+1,ee>z&&(ee=z,we++),O[2*ae+1]=ee,ae>N||(E.bl_count[ee]++,le=0,ae>=K&&(le=V[ae-K]),ye=O[2*ae],E.opt_len+=ye*(ee+le),U&&(E.static_len+=ye*(B[2*ae+1]+le)));if(we!==0){do{for(ee=z-1;E.bl_count[ee]===0;)ee--;E.bl_count[ee]--,E.bl_count[ee+1]+=2,E.bl_count[z]--,we-=2}while(we>0);for(ee=z;ee!==0;ee--)for(ae=E.bl_count[ee];ae!==0;)ie=E.heap[--J],ie>N||(O[2*ie+1]!==ee&&(E.opt_len+=(ee-O[2*ie+1])*O[2*ie],O[2*ie+1]=ee),ae--)}})(e,t),VH(r,y,e.bl_count)},WH=(e,t,r)=>{let a,o,u=-1,h=t[1],m=0,g=7,y=4;for(h===0&&(g=138,y=3),t[2*(r+1)+1]=65535,a=0;a<=r;a++)o=h,h=t[2*(a+1)+1],++m<g&&o===h||(m<y?e.bl_tree[2*o]+=m:o!==0?(o!==u&&e.bl_tree[2*o]++,e.bl_tree[32]++):m<=10?e.bl_tree[34]++:e.bl_tree[36]++,m=0,u=o,h===0?(g=138,y=3):o===h?(g=6,y=3):(g=7,y=4))},zH=(e,t,r)=>{let a,o,u=-1,h=t[1],m=0,g=7,y=4;for(h===0&&(g=138,y=3),a=0;a<=r;a++)if(o=h,h=t[2*(a+1)+1],!(++m<g&&o===h)){if(m<y)do jl(e,o,e.bl_tree);while(--m!=0);else o!==0?(o!==u&&(jl(e,o,e.bl_tree),m--),jl(e,16,e.bl_tree),As(e,m-3,2)):m<=10?(jl(e,17,e.bl_tree),As(e,m-3,3)):(jl(e,18,e.bl_tree),As(e,m-11,7));m=0,u=o,h===0?(g=138,y=3):o===h?(g=6,y=3):(g=7,y=4)}};let KH=!1;const YH=(e,t,r,a)=>{As(e,0+(a?1:0),3),FH(e),ES(e,r),ES(e,~r),r&&e.pending_buf.set(e.window.subarray(t,t+r),e.pending),e.pending+=r};var fle=e=>{KH||((()=>{let t,r,a,o,u;const h=new Array(16);for(a=0,o=0;o<28;o++)for(jP[o]=a,t=0;t<1<<UP[o];t++)yS[a++]=o;for(yS[a-1]=o,u=0,o=0;o<16;o++)for(DA[o]=u,t=0;t<1<<xA[o];t++)vS[u++]=o;for(u>>=7;o<mS;o++)for(DA[o]=u<<7,t=0;t<1<<xA[o]-7;t++)vS[256+u++]=o;for(r=0;r<=gS;r++)h[r]=0;for(t=0;t<=143;)zu[2*t+1]=8,t++,h[8]++;for(;t<=255;)zu[2*t+1]=9,t++,h[9]++;for(;t<=279;)zu[2*t+1]=7,t++,h[7]++;for(;t<=287;)zu[2*t+1]=8,t++,h[8]++;for(VH(zu,287,h),t=0;t<mS;t++)_S[2*t+1]=5,_S[2*t]=jH(t,5);kH=new VP(zu,UP,257,DH,gS),LH=new VP(_S,xA,0,mS,gS),MH=new VP(new Array(0),hle,0,19,7)})(),KH=!0),e.l_desc=new BP(e.dyn_ltree,kH),e.d_desc=new BP(e.dyn_dtree,LH),e.bl_desc=new BP(e.bl_tree,MH),e.bi_buf=0,e.bi_valid=0,BH(e)},ple=(e,t,r,a)=>{let o,u,h=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(m=>{let g,y=4093624447;for(g=0;g<=31;g++,y>>>=1)if(1&y&&m.dyn_ltree[2*g]!==0)return 0;if(m.dyn_ltree[18]!==0||m.dyn_ltree[20]!==0||m.dyn_ltree[26]!==0)return 1;for(g=32;g<MP;g++)if(m.dyn_ltree[2*g]!==0)return 1;return 0})(e)),GP(e,e.l_desc),GP(e,e.d_desc),h=(m=>{let g;for(WH(m,m.dyn_ltree,m.l_desc.max_code),WH(m,m.dyn_dtree,m.d_desc.max_code),GP(m,m.bl_desc),g=18;g>=3&&m.bl_tree[2*PH[g]+1]===0;g--);return m.opt_len+=3*(g+1)+5+5+4,g})(e),o=e.opt_len+3+7>>>3,u=e.static_len+3+7>>>3,u<=o&&(o=u)):o=u=r+5,r+4<=o&&t!==-1?YH(e,t,r,a):e.strategy===4||u===o?(As(e,2+(a?1:0),3),HH(e,zu,_S)):(As(e,4+(a?1:0),3),((m,g,y,E)=>{let A;for(As(m,g-257,5),As(m,y-1,5),As(m,E-4,4),A=0;A<E;A++)As(m,m.bl_tree[2*PH[A]+1],3);zH(m,m.dyn_ltree,g-1),zH(m,m.dyn_dtree,y-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,h+1),HH(e,e.dyn_ltree,e.dyn_dtree)),BH(e),a&&FH(e)},mle=(e,t,r)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=r,t===0?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(yS[r]+MP+1)]++,e.dyn_dtree[2*UH(t)]++),e.sym_next===e.sym_end),gle=e=>{As(e,2,3),jl(e,256,zu),(t=>{t.bi_valid===16?(ES(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},_le={_tr_init:fle,_tr_stored_block:YH,_tr_flush_block:ple,_tr_tally:mle,_tr_align:gle},SS=(e,t,r,a)=>{let o=65535&e|0,u=e>>>16&65535|0,h=0;for(;r!==0;){h=r>2e3?2e3:r,r-=h;do o=o+t[a++]|0,u=u+o|0;while(--h);o%=65521,u%=65521}return o|u<<16|0};const vle=new Uint32Array((()=>{let e,t=[];for(var r=0;r<256;r++){e=r;for(var a=0;a<8;a++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t})());var Zi=(e,t,r,a)=>{const o=vle,u=a+r;e^=-1;for(let h=a;h<u;h++)e=e>>>8^o[255&(e^t[h])];return-1^e},zp={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},PA={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:yle,_tr_stored_block:HP,_tr_flush_block:Ele,_tr_tally:Kh,_tr_align:Sle}=_le,{Z_NO_FLUSH:Yh,Z_PARTIAL_FLUSH:ble,Z_FULL_FLUSH:Tle,Z_FINISH:ko,Z_BLOCK:qH,Z_OK:da,Z_STREAM_END:XH,Z_STREAM_ERROR:Vl,Z_DATA_ERROR:wle,Z_BUF_ERROR:WP,Z_DEFAULT_COMPRESSION:Rle,Z_FILTERED:Cle,Z_HUFFMAN_ONLY:kA,Z_RLE:Ale,Z_FIXED:Ole,Z_DEFAULT_STRATEGY:Ile,Z_UNKNOWN:Nle,Z_DEFLATED:LA}=PA,zP=286,xle=30,Dle=19,Ple=2*zP+1,kle=15,Kp=258,Bl=262,uv=42,Yp=113,bS=666,qp=(e,t)=>(e.msg=zp[t],t),JH=e=>2*e-(e>4?9:0),qh=e=>{let t=e.length;for(;--t>=0;)e[t]=0},Lle=e=>{let t,r,a,o=e.w_size;t=e.hash_size,a=t;do r=e.head[--a],e.head[a]=r>=o?r-o:0;while(--t);t=o,a=t;do r=e.prev[--a],e.prev[a]=r>=o?r-o:0;while(--t)};let Xh=(e,t,r)=>(t<<e.hash_shift^r)&e.hash_mask;const Ys=e=>{const t=e.state;let r=t.pending;r>e.avail_out&&(r=e.avail_out),r!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+r),e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,t.pending===0&&(t.pending_out=0))},qs=(e,t)=>{Ele(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Ys(e.strm)},Jn=(e,t)=>{e.pending_buf[e.pending++]=t},TS=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},KP=(e,t,r,a)=>{let o=e.avail_in;return o>a&&(o=a),o===0?0:(e.avail_in-=o,t.set(e.input.subarray(e.next_in,e.next_in+o),r),e.state.wrap===1?e.adler=SS(e.adler,t,o,r):e.state.wrap===2&&(e.adler=Zi(e.adler,t,o,r)),e.next_in+=o,e.total_in+=o,o)},$H=(e,t)=>{let r,a,o=e.max_chain_length,u=e.strstart,h=e.prev_length,m=e.nice_match;const g=e.strstart>e.w_size-Bl?e.strstart-(e.w_size-Bl):0,y=e.window,E=e.w_mask,A=e.prev,O=e.strstart+Kp;let N=y[u+h-1],B=y[u+h];e.prev_length>=e.good_match&&(o>>=2),m>e.lookahead&&(m=e.lookahead);do if(r=t,y[r+h]===B&&y[r+h-1]===N&&y[r]===y[u]&&y[++r]===y[u+1]){u+=2,r++;do;while(y[++u]===y[++r]&&y[++u]===y[++r]&&y[++u]===y[++r]&&y[++u]===y[++r]&&y[++u]===y[++r]&&y[++u]===y[++r]&&y[++u]===y[++r]&&y[++u]===y[++r]&&u<O);if(a=Kp-(O-u),u=O-Kp,a>h){if(e.match_start=t,h=a,a>=m)break;N=y[u+h-1],B=y[u+h]}}while((t=A[t&E])>g&&--o!=0);return h<=e.lookahead?h:e.lookahead},dv=e=>{const t=e.w_size;let r,a,o;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Bl)&&(e.window.set(e.window.subarray(t,t+t-a),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),Lle(e),a+=t),e.strm.avail_in===0)break;if(r=KP(e.strm,e.window,e.strstart+e.lookahead,a),e.lookahead+=r,e.lookahead+e.insert>=3)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=Xh(e,e.ins_h,e.window[o+1]);e.insert&&(e.ins_h=Xh(e,e.ins_h,e.window[o+3-1]),e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Bl&&e.strm.avail_in!==0)},ZH=(e,t)=>{let r,a,o,u=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,h=0,m=e.strm.avail_in;do{if(r=65535,o=e.bi_valid+42>>3,e.strm.avail_out<o||(o=e.strm.avail_out-o,a=e.strstart-e.block_start,r>a+e.strm.avail_in&&(r=a+e.strm.avail_in),r>o&&(r=o),r<u&&(r===0&&t!==ko||t===Yh||r!==a+e.strm.avail_in)))break;h=t===ko&&r===a+e.strm.avail_in?1:0,HP(e,0,0,h),e.pending_buf[e.pending-4]=r,e.pending_buf[e.pending-3]=r>>8,e.pending_buf[e.pending-2]=~r,e.pending_buf[e.pending-1]=~r>>8,Ys(e.strm),a&&(a>r&&(a=r),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+a),e.strm.next_out),e.strm.next_out+=a,e.strm.avail_out-=a,e.strm.total_out+=a,e.block_start+=a,r-=a),r&&(KP(e.strm,e.strm.output,e.strm.next_out,r),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r)}while(h===0);return m-=e.strm.avail_in,m&&(m>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=m&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-m,e.strm.next_in),e.strstart),e.strstart+=m,e.insert+=m>e.w_size-e.insert?e.w_size-e.insert:m),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),h?4:t!==Yh&&t!==ko&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(o=e.window_size-e.strstart,e.strm.avail_in>o&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,o+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),o>e.strm.avail_in&&(o=e.strm.avail_in),o&&(KP(e.strm,e.window,e.strstart,o),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.high_water<e.strstart&&(e.high_water=e.strstart),o=e.bi_valid+42>>3,o=e.pending_buf_size-o>65535?65535:e.pending_buf_size-o,u=o>e.w_size?e.w_size:o,a=e.strstart-e.block_start,(a>=u||(a||t===ko)&&t!==Yh&&e.strm.avail_in===0&&a<=o)&&(r=a>o?o:a,h=t===ko&&e.strm.avail_in===0&&r===a?1:0,HP(e,e.block_start,r,h),e.block_start+=r,Ys(e.strm)),h?3:1)},YP=(e,t)=>{let r,a;for(;;){if(e.lookahead<Bl){if(dv(e),e.lookahead<Bl&&t===Yh)return 1;if(e.lookahead===0)break}if(r=0,e.lookahead>=3&&(e.ins_h=Xh(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),r!==0&&e.strstart-r<=e.w_size-Bl&&(e.match_length=$H(e,r)),e.match_length>=3)if(a=Kh(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=Xh(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Xh(e,e.ins_h,e.window[e.strstart+1]);else a=Kh(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(a&&(qs(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===ko?(qs(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(qs(e,!1),e.strm.avail_out===0)?1:2},hv=(e,t)=>{let r,a,o;for(;;){if(e.lookahead<Bl){if(dv(e),e.lookahead<Bl&&t===Yh)return 1;if(e.lookahead===0)break}if(r=0,e.lookahead>=3&&(e.ins_h=Xh(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,r!==0&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-Bl&&(e.match_length=$H(e,r),e.match_length<=5&&(e.strategy===Cle||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){o=e.strstart+e.lookahead-3,a=Kh(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=o&&(e.ins_h=Xh(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,a&&(qs(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(a=Kh(e,0,e.window[e.strstart-1]),a&&qs(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(a=Kh(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===ko?(qs(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(qs(e,!1),e.strm.avail_out===0)?1:2};function Fl(e,t,r,a,o){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=a,this.func=o}const wS=[new Fl(0,0,0,0,ZH),new Fl(4,4,8,4,YP),new Fl(4,5,16,8,YP),new Fl(4,6,32,32,YP),new Fl(4,4,16,16,hv),new Fl(8,16,32,32,hv),new Fl(8,16,128,128,hv),new Fl(8,32,128,256,hv),new Fl(32,128,258,1024,hv),new Fl(32,258,258,4096,hv)];function Mle(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=LA,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*Ple),this.dyn_dtree=new Uint16Array(2*(2*xle+1)),this.bl_tree=new Uint16Array(2*(2*Dle+1)),qh(this.dyn_ltree),qh(this.dyn_dtree),qh(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(kle+1),this.heap=new Uint16Array(2*zP+1),qh(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*zP+1),qh(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const RS=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==uv&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==Yp&&t.status!==bS?1:0},QH=e=>{if(RS(e))return qp(e,Vl);e.total_in=e.total_out=0,e.data_type=Nle;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?uv:Yp,e.adler=t.wrap===2?0:1,t.last_flush=-2,yle(t),da},eW=e=>{const t=QH(e);return t===da&&(r=>{r.window_size=2*r.w_size,qh(r.head),r.max_lazy_match=wS[r.level].max_lazy,r.good_match=wS[r.level].good_length,r.nice_match=wS[r.level].nice_length,r.max_chain_length=wS[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=2,r.match_available=0,r.ins_h=0})(e.state),t},tW=(e,t,r,a,o,u)=>{if(!e)return Vl;let h=1;if(t===Rle&&(t=6),a<0?(h=0,a=-a):a>15&&(h=2,a-=16),o<1||o>9||r!==LA||a<8||a>15||t<0||t>9||u<0||u>Ole||a===8&&h!==1)return qp(e,Vl);a===8&&(a=9);const m=new Mle;return e.state=m,m.strm=e,m.status=uv,m.wrap=h,m.gzhead=null,m.w_bits=a,m.w_size=1<<m.w_bits,m.w_mask=m.w_size-1,m.hash_bits=o+7,m.hash_size=1<<m.hash_bits,m.hash_mask=m.hash_size-1,m.hash_shift=~~((m.hash_bits+3-1)/3),m.window=new Uint8Array(2*m.w_size),m.head=new Uint16Array(m.hash_size),m.prev=new Uint16Array(m.w_size),m.lit_bufsize=1<<o+6,m.pending_buf_size=4*m.lit_bufsize,m.pending_buf=new Uint8Array(m.pending_buf_size),m.sym_buf=m.lit_bufsize,m.sym_end=3*(m.lit_bufsize-1),m.level=t,m.strategy=u,m.method=r,eW(e)};var Ule=(e,t)=>{if(RS(e)||t>qH||t<0)return e?qp(e,Vl):Vl;const r=e.state;if(!e.output||e.avail_in!==0&&!e.input||r.status===bS&&t!==ko)return qp(e,e.avail_out===0?WP:Vl);const a=r.last_flush;if(r.last_flush=t,r.pending!==0){if(Ys(e),e.avail_out===0)return r.last_flush=-1,da}else if(e.avail_in===0&&JH(t)<=JH(a)&&t!==ko)return qp(e,WP);if(r.status===bS&&e.avail_in!==0)return qp(e,WP);if(r.status===uv&&r.wrap===0&&(r.status=Yp),r.status===uv){let o=LA+(r.w_bits-8<<4)<<8,u=-1;if(u=r.strategy>=kA||r.level<2?0:r.level<6?1:r.level===6?2:3,o|=u<<6,r.strstart!==0&&(o|=32),o+=31-o%31,TS(r,o),r.strstart!==0&&(TS(r,e.adler>>>16),TS(r,65535&e.adler)),e.adler=1,r.status=Yp,Ys(e),r.pending!==0)return r.last_flush=-1,da}if(r.status===57){if(e.adler=0,Jn(r,31),Jn(r,139),Jn(r,8),r.gzhead)Jn(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),Jn(r,255&r.gzhead.time),Jn(r,r.gzhead.time>>8&255),Jn(r,r.gzhead.time>>16&255),Jn(r,r.gzhead.time>>24&255),Jn(r,r.level===9?2:r.strategy>=kA||r.level<2?4:0),Jn(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(Jn(r,255&r.gzhead.extra.length),Jn(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=Zi(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69;else if(Jn(r,0),Jn(r,0),Jn(r,0),Jn(r,0),Jn(r,0),Jn(r,r.level===9?2:r.strategy>=kA||r.level<2?4:0),Jn(r,3),r.status=Yp,Ys(e),r.pending!==0)return r.last_flush=-1,da}if(r.status===69){if(r.gzhead.extra){let o=r.pending,u=(65535&r.gzhead.extra.length)-r.gzindex;for(;r.pending+u>r.pending_buf_size;){let m=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+m),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>o&&(e.adler=Zi(e.adler,r.pending_buf,r.pending-o,o)),r.gzindex+=m,Ys(e),r.pending!==0)return r.last_flush=-1,da;o=0,u-=m}let h=new Uint8Array(r.gzhead.extra);r.pending_buf.set(h.subarray(r.gzindex,r.gzindex+u),r.pending),r.pending+=u,r.gzhead.hcrc&&r.pending>o&&(e.adler=Zi(e.adler,r.pending_buf,r.pending-o,o)),r.gzindex=0}r.status=73}if(r.status===73){if(r.gzhead.name){let o,u=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>u&&(e.adler=Zi(e.adler,r.pending_buf,r.pending-u,u)),Ys(e),r.pending!==0)return r.last_flush=-1,da;u=0}o=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,Jn(r,o)}while(o!==0);r.gzhead.hcrc&&r.pending>u&&(e.adler=Zi(e.adler,r.pending_buf,r.pending-u,u)),r.gzindex=0}r.status=91}if(r.status===91){if(r.gzhead.comment){let o,u=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>u&&(e.adler=Zi(e.adler,r.pending_buf,r.pending-u,u)),Ys(e),r.pending!==0)return r.last_flush=-1,da;u=0}o=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,Jn(r,o)}while(o!==0);r.gzhead.hcrc&&r.pending>u&&(e.adler=Zi(e.adler,r.pending_buf,r.pending-u,u))}r.status=103}if(r.status===103){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(Ys(e),r.pending!==0))return r.last_flush=-1,da;Jn(r,255&e.adler),Jn(r,e.adler>>8&255),e.adler=0}if(r.status=Yp,Ys(e),r.pending!==0)return r.last_flush=-1,da}if(e.avail_in!==0||r.lookahead!==0||t!==Yh&&r.status!==bS){let o=r.level===0?ZH(r,t):r.strategy===kA?((u,h)=>{let m;for(;;){if(u.lookahead===0&&(dv(u),u.lookahead===0)){if(h===Yh)return 1;break}if(u.match_length=0,m=Kh(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++,m&&(qs(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===ko?(qs(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(qs(u,!1),u.strm.avail_out===0)?1:2})(r,t):r.strategy===Ale?((u,h)=>{let m,g,y,E;const A=u.window;for(;;){if(u.lookahead<=Kp){if(dv(u),u.lookahead<=Kp&&h===Yh)return 1;if(u.lookahead===0)break}if(u.match_length=0,u.lookahead>=3&&u.strstart>0&&(y=u.strstart-1,g=A[y],g===A[++y]&&g===A[++y]&&g===A[++y])){E=u.strstart+Kp;do;while(g===A[++y]&&g===A[++y]&&g===A[++y]&&g===A[++y]&&g===A[++y]&&g===A[++y]&&g===A[++y]&&g===A[++y]&&y<E);u.match_length=Kp-(E-y),u.match_length>u.lookahead&&(u.match_length=u.lookahead)}if(u.match_length>=3?(m=Kh(u,1,u.match_length-3),u.lookahead-=u.match_length,u.strstart+=u.match_length,u.match_length=0):(m=Kh(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++),m&&(qs(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===ko?(qs(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(qs(u,!1),u.strm.avail_out===0)?1:2})(r,t):wS[r.level].func(r,t);if(o!==3&&o!==4||(r.status=bS),o===1||o===3)return e.avail_out===0&&(r.last_flush=-1),da;if(o===2&&(t===ble?Sle(r):t!==qH&&(HP(r,0,0,!1),t===Tle&&(qh(r.head),r.lookahead===0&&(r.strstart=0,r.block_start=0,r.insert=0))),Ys(e),e.avail_out===0))return r.last_flush=-1,da}return t!==ko?da:r.wrap<=0?XH:(r.wrap===2?(Jn(r,255&e.adler),Jn(r,e.adler>>8&255),Jn(r,e.adler>>16&255),Jn(r,e.adler>>24&255),Jn(r,255&e.total_in),Jn(r,e.total_in>>8&255),Jn(r,e.total_in>>16&255),Jn(r,e.total_in>>24&255)):(TS(r,e.adler>>>16),TS(r,65535&e.adler)),Ys(e),r.wrap>0&&(r.wrap=-r.wrap),r.pending!==0?da:XH)},jle=(e,t)=>{let r=t.length;if(RS(e))return Vl;const a=e.state,o=a.wrap;if(o===2||o===1&&a.status!==uv||a.lookahead)return Vl;if(o===1&&(e.adler=SS(e.adler,t,r,0)),a.wrap=0,r>=a.w_size){o===0&&(qh(a.head),a.strstart=0,a.block_start=0,a.insert=0);let g=new Uint8Array(a.w_size);g.set(t.subarray(r-a.w_size,r),0),t=g,r=a.w_size}const u=e.avail_in,h=e.next_in,m=e.input;for(e.avail_in=r,e.next_in=0,e.input=t,dv(a);a.lookahead>=3;){let g=a.strstart,y=a.lookahead-2;do a.ins_h=Xh(a,a.ins_h,a.window[g+3-1]),a.prev[g&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=g,g++;while(--y);a.strstart=g,a.lookahead=2,dv(a)}return a.strstart+=a.lookahead,a.block_start=a.strstart,a.insert=a.lookahead,a.lookahead=0,a.match_length=a.prev_length=2,a.match_available=0,e.next_in=h,e.input=m,e.avail_in=u,a.wrap=o,da},CS={deflateInit:(e,t)=>tW(e,t,LA,15,8,Ile),deflateInit2:tW,deflateReset:eW,deflateResetKeep:QH,deflateSetHeader:(e,t)=>RS(e)||e.state.wrap!==2?Vl:(e.state.gzhead=t,da),deflate:Ule,deflateEnd:e=>{if(RS(e))return Vl;const t=e.state.status;return e.state=null,t===Yp?qp(e,wle):da},deflateSetDictionary:jle,deflateInfo:"pako deflate (from Nodeca project)"};const Vle=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var MA={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const r=t.shift();if(r){if(typeof r!="object")throw new TypeError(r+"must be non-object");for(const a in r)Vle(r,a)&&(e[a]=r[a])}}return e},flattenChunks:e=>{let t=0;for(let a=0,o=e.length;a<o;a++)t+=e[a].length;const r=new Uint8Array(t);for(let a=0,o=0,u=e.length;a<u;a++){let h=e[a];r.set(h,o),o+=h.length}return r}};let nW=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{nW=!1}const AS=new Uint8Array(256);for(let e=0;e<256;e++)AS[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;AS[254]=AS[254]=1;var OS={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,r,a,o,u,h=e.length,m=0;for(o=0;o<h;o++)r=e.charCodeAt(o),(64512&r)==55296&&o+1<h&&(a=e.charCodeAt(o+1),(64512&a)==56320&&(r=65536+(r-55296<<10)+(a-56320),o++)),m+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(m),u=0,o=0;u<m;o++)r=e.charCodeAt(o),(64512&r)==55296&&o+1<h&&(a=e.charCodeAt(o+1),(64512&a)==56320&&(r=65536+(r-55296<<10)+(a-56320),o++)),r<128?t[u++]=r:r<2048?(t[u++]=192|r>>>6,t[u++]=128|63&r):r<65536?(t[u++]=224|r>>>12,t[u++]=128|r>>>6&63,t[u++]=128|63&r):(t[u++]=240|r>>>18,t[u++]=128|r>>>12&63,t[u++]=128|r>>>6&63,t[u++]=128|63&r);return t},buf2string:(e,t)=>{const r=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let a,o;const u=new Array(2*r);for(o=0,a=0;a<r;){let h=e[a++];if(h<128){u[o++]=h;continue}let m=AS[h];if(m>4)u[o++]=65533,a+=m-1;else{for(h&=m===2?31:m===3?15:7;m>1&&a<r;)h=h<<6|63&e[a++],m--;m>1?u[o++]=65533:h<65536?u[o++]=h:(h-=65536,u[o++]=55296|h>>10&1023,u[o++]=56320|1023&h)}}return((h,m)=>{if(m<65534&&h.subarray&&nW)return String.fromCharCode.apply(null,h.length===m?h:h.subarray(0,m));let g="";for(let y=0;y<m;y++)g+=String.fromCharCode(h[y]);return g})(u,o)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let r=t-1;for(;r>=0&&(192&e[r])==128;)r--;return r<0||r===0?t:r+AS[e[r]]>t?r:t}},rW=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const iW=Object.prototype.toString,{Z_NO_FLUSH:Ble,Z_SYNC_FLUSH:Fle,Z_FULL_FLUSH:Gle,Z_FINISH:Hle,Z_OK:UA,Z_STREAM_END:Wle,Z_DEFAULT_COMPRESSION:zle,Z_DEFAULT_STRATEGY:Kle,Z_DEFLATED:Yle}=PA;function jA(e){this.options=MA.assign({level:zle,method:Yle,chunkSize:16384,windowBits:15,memLevel:8,strategy:Kle},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new rW,this.strm.avail_out=0;let r=CS.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==UA)throw new Error(zp[r]);if(t.header&&CS.deflateSetHeader(this.strm,t.header),t.dictionary){let a;if(a=typeof t.dictionary=="string"?OS.string2buf(t.dictionary):iW.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,r=CS.deflateSetDictionary(this.strm,a),r!==UA)throw new Error(zp[r]);this._dict_set=!0}}function qle(e,t){const r=new jA(t);if(r.push(e,!0),r.err)throw r.msg||zp[r.err];return r.result}jA.prototype.push=function(e,t){const r=this.strm,a=this.options.chunkSize;let o,u;if(this.ended)return!1;for(u=t===~~t?t:t===!0?Hle:Ble,typeof e=="string"?r.input=OS.string2buf(e):iW.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;)if(r.avail_out===0&&(r.output=new Uint8Array(a),r.next_out=0,r.avail_out=a),(u===Fle||u===Gle)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if(o=CS.deflate(r,u),o===Wle)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),o=CS.deflateEnd(this.strm),this.onEnd(o),this.ended=!0,o===UA;if(r.avail_out!==0){if(u>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(r.avail_in===0)break}else this.onData(r.output)}return!0},jA.prototype.onData=function(e){this.chunks.push(e)},jA.prototype.onEnd=function(e){e===UA&&(this.result=MA.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Xle={deflate:qle};const VA=16209;var Jle=function(e,t){let r,a,o,u,h,m,g,y,E,A,O,N,B,U,V,K,z,J,ae,ie,ee,le,ye,we;const Ne=e.state;r=e.next_in,ye=e.input,a=r+(e.avail_in-5),o=e.next_out,we=e.output,u=o-(t-e.avail_out),h=o+(e.avail_out-257),m=Ne.dmax,g=Ne.wsize,y=Ne.whave,E=Ne.wnext,A=Ne.window,O=Ne.hold,N=Ne.bits,B=Ne.lencode,U=Ne.distcode,V=(1<<Ne.lenbits)-1,K=(1<<Ne.distbits)-1;e:do{N<15&&(O+=ye[r++]<<N,N+=8,O+=ye[r++]<<N,N+=8),z=B[O&V];t:for(;;){if(J=z>>>24,O>>>=J,N-=J,J=z>>>16&255,J===0)we[o++]=65535&z;else{if(!(16&J)){if((64&J)==0){z=B[(65535&z)+(O&(1<<J)-1)];continue t}if(32&J){Ne.mode=16191;break e}e.msg="invalid literal/length code",Ne.mode=VA;break e}ae=65535&z,J&=15,J&&(N<J&&(O+=ye[r++]<<N,N+=8),ae+=O&(1<<J)-1,O>>>=J,N-=J),N<15&&(O+=ye[r++]<<N,N+=8,O+=ye[r++]<<N,N+=8),z=U[O&K];n:for(;;){if(J=z>>>24,O>>>=J,N-=J,J=z>>>16&255,!(16&J)){if((64&J)==0){z=U[(65535&z)+(O&(1<<J)-1)];continue n}e.msg="invalid distance code",Ne.mode=VA;break e}if(ie=65535&z,J&=15,N<J&&(O+=ye[r++]<<N,N+=8,N<J&&(O+=ye[r++]<<N,N+=8)),ie+=O&(1<<J)-1,ie>m){e.msg="invalid distance too far back",Ne.mode=VA;break e}if(O>>>=J,N-=J,J=o-u,ie>J){if(J=ie-J,J>y&&Ne.sane){e.msg="invalid distance too far back",Ne.mode=VA;break e}if(ee=0,le=A,E===0){if(ee+=g-J,J<ae){ae-=J;do we[o++]=A[ee++];while(--J);ee=o-ie,le=we}}else if(E<J){if(ee+=g+E-J,J-=E,J<ae){ae-=J;do we[o++]=A[ee++];while(--J);if(ee=0,E<ae){J=E,ae-=J;do we[o++]=A[ee++];while(--J);ee=o-ie,le=we}}}else if(ee+=E-J,J<ae){ae-=J;do we[o++]=A[ee++];while(--J);ee=o-ie,le=we}for(;ae>2;)we[o++]=le[ee++],we[o++]=le[ee++],we[o++]=le[ee++],ae-=3;ae&&(we[o++]=le[ee++],ae>1&&(we[o++]=le[ee++]))}else{ee=o-ie;do we[o++]=we[ee++],we[o++]=we[ee++],we[o++]=we[ee++],ae-=3;while(ae>2);ae&&(we[o++]=we[ee++],ae>1&&(we[o++]=we[ee++]))}break}}break}}while(r<a&&o<h);ae=N>>3,r-=ae,N-=ae<<3,O&=(1<<N)-1,e.next_in=r,e.next_out=o,e.avail_in=r<a?a-r+5:5-(r-a),e.avail_out=o<h?h-o+257:257-(o-h),Ne.hold=O,Ne.bits=N};const BA=15,$le=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Zle=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Qle=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),eue=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var IS=(e,t,r,a,o,u,h,m)=>{const g=m.bits;let y,E,A,O,N,B,U=0,V=0,K=0,z=0,J=0,ae=0,ie=0,ee=0,le=0,ye=0,we=null;const Ne=new Uint16Array(16),bt=new Uint16Array(16);let Rt,ft,Xt,Wt=null;for(U=0;U<=BA;U++)Ne[U]=0;for(V=0;V<a;V++)Ne[t[r+V]]++;for(J=g,z=BA;z>=1&&Ne[z]===0;z--);if(J>z&&(J=z),z===0)return o[u++]=20971520,o[u++]=20971520,m.bits=1,0;for(K=1;K<z&&Ne[K]===0;K++);for(J<K&&(J=K),ee=1,U=1;U<=BA;U++)if(ee<<=1,ee-=Ne[U],ee<0)return-1;if(ee>0&&(e===0||z!==1))return-1;for(bt[1]=0,U=1;U<BA;U++)bt[U+1]=bt[U]+Ne[U];for(V=0;V<a;V++)t[r+V]!==0&&(h[bt[t[r+V]]++]=V);if(e===0?(we=Wt=h,B=20):e===1?(we=$le,Wt=Zle,B=257):(we=Qle,Wt=eue,B=0),ye=0,V=0,U=K,N=u,ae=J,ie=0,A=-1,le=1<<J,O=le-1,e===1&&le>852||e===2&&le>592)return 1;for(;;){Rt=U-ie,h[V]+1<B?(ft=0,Xt=h[V]):h[V]>=B?(ft=Wt[h[V]-B],Xt=we[h[V]-B]):(ft=96,Xt=0),y=1<<U-ie,E=1<<ae,K=E;do E-=y,o[N+(ye>>ie)+E]=Rt<<24|ft<<16|Xt|0;while(E!==0);for(y=1<<U-1;ye&y;)y>>=1;if(y!==0?(ye&=y-1,ye+=y):ye=0,V++,--Ne[U]==0){if(U===z)break;U=t[r+h[V]]}if(U>J&&(ye&O)!==A){for(ie===0&&(ie=J),N+=K,ae=U-ie,ee=1<<ae;ae+ie<z&&(ee-=Ne[ae+ie],!(ee<=0));)ae++,ee<<=1;if(le+=1<<ae,e===1&&le>852||e===2&&le>592)return 1;A=ye&O,o[A]=J<<24|ae<<16|N-u|0}}return ye!==0&&(o[N+ye]=U-ie<<24|64<<16|0),m.bits=J,0};const{Z_FINISH:aW,Z_BLOCK:tue,Z_TREES:FA,Z_OK:Xp,Z_STREAM_END:nue,Z_NEED_DICT:rue,Z_STREAM_ERROR:Lo,Z_DATA_ERROR:sW,Z_MEM_ERROR:oW,Z_BUF_ERROR:iue,Z_DEFLATED:cW}=PA,GA=16180,HA=16190,Ku=16191,qP=16192,XP=16194,WA=16199,zA=16200,JP=16206,kr=16209,lW=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function aue(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Jp=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<GA||t.mode>16211?1:0},uW=e=>{if(Jp(e))return Lo;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=GA,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Xp},dW=e=>{if(Jp(e))return Lo;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,uW(e)},hW=(e,t)=>{let r;if(Jp(e))return Lo;const a=e.state;return t<0?(r=0,t=-t):(r=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Lo:(a.window!==null&&a.wbits!==t&&(a.window=null),a.wrap=r,a.wbits=t,dW(e))},fW=(e,t)=>{if(!e)return Lo;const r=new aue;e.state=r,r.strm=e,r.window=null,r.mode=GA;const a=hW(e,t);return a!==Xp&&(e.state=null),a};let $P,ZP,pW=!0;const sue=e=>{if(pW){$P=new Int32Array(512),ZP=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(IS(1,e.lens,0,288,$P,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;IS(2,e.lens,0,32,ZP,0,e.work,{bits:5}),pW=!1}e.lencode=$P,e.lenbits=9,e.distcode=ZP,e.distbits=5},mW=(e,t,r,a)=>{let o;const u=e.state;return u.window===null&&(u.wsize=1<<u.wbits,u.wnext=0,u.whave=0,u.window=new Uint8Array(u.wsize)),a>=u.wsize?(u.window.set(t.subarray(r-u.wsize,r),0),u.wnext=0,u.whave=u.wsize):(o=u.wsize-u.wnext,o>a&&(o=a),u.window.set(t.subarray(r-a,r-a+o),u.wnext),(a-=o)?(u.window.set(t.subarray(r-a,r),0),u.wnext=a,u.whave=u.wsize):(u.wnext+=o,u.wnext===u.wsize&&(u.wnext=0),u.whave<u.wsize&&(u.whave+=o))),0};var oue=(e,t)=>{let r,a,o,u,h,m,g,y,E,A,O,N,B,U,V,K,z,J,ae,ie,ee,le,ye=0;const we=new Uint8Array(4);let Ne,bt;const Rt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Jp(e)||!e.output||!e.input&&e.avail_in!==0)return Lo;r=e.state,r.mode===Ku&&(r.mode=qP),h=e.next_out,o=e.output,g=e.avail_out,u=e.next_in,a=e.input,m=e.avail_in,y=r.hold,E=r.bits,A=m,O=g,le=Xp;e:for(;;)switch(r.mode){case GA:if(r.wrap===0){r.mode=qP;break}for(;E<16;){if(m===0)break e;m--,y+=a[u++]<<E,E+=8}if(2&r.wrap&&y===35615){r.wbits===0&&(r.wbits=15),r.check=0,we[0]=255&y,we[1]=y>>>8&255,r.check=Zi(r.check,we,2,0),y=0,E=0,r.mode=16181;break}if(r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&y)<<8)+(y>>8))%31){e.msg="incorrect header check",r.mode=kr;break}if((15&y)!==cW){e.msg="unknown compression method",r.mode=kr;break}if(y>>>=4,E-=4,ee=8+(15&y),r.wbits===0&&(r.wbits=ee),ee>15||ee>r.wbits){e.msg="invalid window size",r.mode=kr;break}r.dmax=1<<r.wbits,r.flags=0,e.adler=r.check=1,r.mode=512&y?16189:Ku,y=0,E=0;break;case 16181:for(;E<16;){if(m===0)break e;m--,y+=a[u++]<<E,E+=8}if(r.flags=y,(255&Ui(r))!==cW){e.msg="unknown compression method",r.mode=kr;break}if(57344&Ui(r)){e.msg="unknown header flags set",r.mode=kr;break}r.head&&(r.head.text=y>>8&1),512&Ui(r)&&4&r.wrap&&(we[0]=255&y,we[1]=y>>>8&255,r.check=Zi(r.check,we,2,0)),y=0,E=0,r.mode=16182;case 16182:for(;E<32;){if(m===0)break e;m--,y+=a[u++]<<E,E+=8}r.head&&(r.head.time=y),512&Ui(r)&&4&r.wrap&&(we[0]=255&y,we[1]=y>>>8&255,we[2]=y>>>16&255,we[3]=y>>>24&255,r.check=Zi(r.check,we,4,0)),y=0,E=0,r.mode=16183;case 16183:for(;E<16;){if(m===0)break e;m--,y+=a[u++]<<E,E+=8}r.head&&(r.head.xflags=255&y,r.head.os=y>>8),512&Ui(r)&&4&r.wrap&&(we[0]=255&y,we[1]=y>>>8&255,r.check=Zi(r.check,we,2,0)),y=0,E=0,r.mode=16184;case 16184:if(1024&Ui(r)){for(;E<16;){if(m===0)break e;m--,y+=a[u++]<<E,E+=8}r.length=y,r.head&&(r.head.extra_len=y),512&Ui(r)&&4&r.wrap&&(we[0]=255&y,we[1]=y>>>8&255,r.check=Zi(r.check,we,2,0)),y=0,E=0}else r.head&&(r.head.extra=null);r.mode=16185;case 16185:if(1024&Ui(r)&&(N=r.length,N>m&&(N=m),N&&(r.head&&(ee=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(a.subarray(u,u+N),ee)),512&Ui(r)&&4&r.wrap&&(r.check=Zi(r.check,a,N,u)),m-=N,u+=N,r.length-=N),r.length))break e;r.length=0,r.mode=16186;case 16186:if(2048&Ui(r)){if(m===0)break e;N=0;do ee=a[u+N++],r.head&&ee&&r.length<65536&&(r.head.name+=String.fromCharCode(ee));while(ee&&N<m);if(512&Ui(r)&&4&r.wrap&&(r.check=Zi(r.check,a,N,u)),m-=N,u+=N,ee)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=16187;case 16187:if(4096&Ui(r)){if(m===0)break e;N=0;do ee=a[u+N++],r.head&&ee&&r.length<65536&&(r.head.comment+=String.fromCharCode(ee));while(ee&&N<m);if(512&Ui(r)&&4&r.wrap&&(r.check=Zi(r.check,a,N,u)),m-=N,u+=N,ee)break e}else r.head&&(r.head.comment=null);r.mode=16188;case 16188:if(512&Ui(r)){for(;E<16;){if(m===0)break e;m--,y+=a[u++]<<E,E+=8}if(4&r.wrap&&y!==(65535&r.check)){e.msg="header crc mismatch",r.mode=kr;break}y=0,E=0}r.head&&(r.head.hcrc=Ui(r)>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=Ku;break;case 16189:for(;E<32;){if(m===0)break e;m--,y+=a[u++]<<E,E+=8}e.adler=r.check=lW(y),y=0,E=0,r.mode=HA;case HA:if(r.havedict===0)return e.next_out=h,e.avail_out=g,e.next_in=u,e.avail_in=m,r.hold=y,r.bits=E,rue;e.adler=r.check=1,r.mode=Ku;case Ku:if(t===tue||t===FA)break e;case qP:if(r.last){y>>>=7&E,E-=7&E,r.mode=JP;break}for(;E<3;){if(m===0)break e;m--,y+=a[u++]<<E,E+=8}switch(r.last=1&y,y>>>=1,E-=1,3&y){case 0:r.mode=16193;break;case 1:if(sue(r),r.mode=WA,t===FA){y>>>=2,E-=2;break e}break;case 2:r.mode=16196;break;case 3:e.msg="invalid block type",r.mode=kr}y>>>=2,E-=2;break;case 16193:for(y>>>=7&E,E-=7&E;E<32;){if(m===0)break e;m--,y+=a[u++]<<E,E+=8}if((65535&y)!=(y>>>16^65535)){e.msg="invalid stored block lengths",r.mode=kr;break}if(r.length=65535&y,y=0,E=0,r.mode=XP,t===FA)break e;case XP:r.mode=16195;case 16195:if(N=r.length,N){if(N>m&&(N=m),N>g&&(N=g),N===0)break e;o.set(a.subarray(u,u+N),h),m-=N,u+=N,g-=N,h+=N,r.length-=N;break}r.mode=Ku;break;case 16196:for(;E<14;){if(m===0)break e;m--,y+=a[u++]<<E,E+=8}if(r.nlen=257+(31&y),y>>>=5,E-=5,r.ndist=1+(31&y),y>>>=5,E-=5,r.ncode=4+(15&y),y>>>=4,E-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=kr;break}r.have=0,r.mode=16197;case 16197:for(;r.have<r.ncode;){for(;E<3;){if(m===0)break e;m--,y+=a[u++]<<E,E+=8}r.lens[Rt[r.have++]]=7&y,y>>>=3,E-=3}for(;r.have<19;)r.lens[Rt[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,Ne={bits:r.lenbits},le=IS(0,r.lens,0,19,r.lencode,0,r.work,Ne),r.lenbits=Ne.bits,le){e.msg="invalid code lengths set",r.mode=kr;break}r.have=0,r.mode=16198;case 16198:for(;r.have<r.nlen+r.ndist;){for(;ye=r.lencode[y&(1<<r.lenbits)-1],V=ye>>>24,K=ye>>>16&255,z=65535&ye,!(V<=E);){if(m===0)break e;m--,y+=a[u++]<<E,E+=8}if(z<16)y>>>=V,E-=V,r.lens[r.have++]=z;else{if(z===16){for(bt=V+2;E<bt;){if(m===0)break e;m--,y+=a[u++]<<E,E+=8}if(y>>>=V,E-=V,r.have===0){e.msg="invalid bit length repeat",r.mode=kr;break}ee=r.lens[r.have-1],N=3+(3&y),y>>>=2,E-=2}else if(z===17){for(bt=V+3;E<bt;){if(m===0)break e;m--,y+=a[u++]<<E,E+=8}y>>>=V,E-=V,ee=0,N=3+(7&y),y>>>=3,E-=3}else{for(bt=V+7;E<bt;){if(m===0)break e;m--,y+=a[u++]<<E,E+=8}y>>>=V,E-=V,ee=0,N=11+(127&y),y>>>=7,E-=7}if(r.have+N>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=kr;break}for(;N--;)r.lens[r.have++]=ee}}if(r.mode===kr)break;if(r.lens[256]===0){e.msg="invalid code -- missing end-of-block",r.mode=kr;break}if(r.lenbits=9,Ne={bits:r.lenbits},le=IS(1,r.lens,0,r.nlen,r.lencode,0,r.work,Ne),r.lenbits=Ne.bits,le){e.msg="invalid literal/lengths set",r.mode=kr;break}if(r.distbits=6,r.distcode=r.distdyn,Ne={bits:r.distbits},le=IS(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,Ne),r.distbits=Ne.bits,le){e.msg="invalid distances set",r.mode=kr;break}if(r.mode=WA,t===FA)break e;case WA:r.mode=zA;case zA:if(m>=6&&g>=258){e.next_out=h,e.avail_out=g,e.next_in=u,e.avail_in=m,r.hold=y,r.bits=E,Jle(e,O),h=e.next_out,o=e.output,g=e.avail_out,u=e.next_in,a=e.input,m=e.avail_in,y=r.hold,E=r.bits,r.mode===Ku&&(r.back=-1);break}for(r.back=0;ye=r.lencode[y&(1<<r.lenbits)-1],V=ye>>>24,K=ye>>>16&255,z=65535&ye,!(V<=E);){if(m===0)break e;m--,y+=a[u++]<<E,E+=8}if(K&&(240&K)==0){for(J=V,ae=K,ie=z;ye=r.lencode[ie+((y&(1<<J+ae)-1)>>J)],V=ye>>>24,K=ye>>>16&255,z=65535&ye,!(J+V<=E);){if(m===0)break e;m--,y+=a[u++]<<E,E+=8}y>>>=J,E-=J,r.back+=J}if(y>>>=V,E-=V,r.back+=V,r.length=z,K===0){r.mode=16205;break}if(32&K){r.back=-1,r.mode=Ku;break}if(64&K){e.msg="invalid literal/length code",r.mode=kr;break}r.extra=15&K,r.mode=16201;case 16201:if(r.extra){for(bt=r.extra;E<bt;){if(m===0)break e;m--,y+=a[u++]<<E,E+=8}r.length+=y&(1<<r.extra)-1,y>>>=r.extra,E-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=16202;case 16202:for(;ye=r.distcode[y&(1<<r.distbits)-1],V=ye>>>24,K=ye>>>16&255,z=65535&ye,!(V<=E);){if(m===0)break e;m--,y+=a[u++]<<E,E+=8}if((240&K)==0){for(J=V,ae=K,ie=z;ye=r.distcode[ie+((y&(1<<J+ae)-1)>>J)],V=ye>>>24,K=ye>>>16&255,z=65535&ye,!(J+V<=E);){if(m===0)break e;m--,y+=a[u++]<<E,E+=8}y>>>=J,E-=J,r.back+=J}if(y>>>=V,E-=V,r.back+=V,64&K){e.msg="invalid distance code",r.mode=kr;break}r.offset=z,r.extra=15&K,r.mode=16203;case 16203:if(r.extra){for(bt=r.extra;E<bt;){if(m===0)break e;m--,y+=a[u++]<<E,E+=8}r.offset+=y&(1<<r.extra)-1,y>>>=r.extra,E-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=kr;break}r.mode=16204;case 16204:if(g===0)break e;if(N=O-g,r.offset>N){if(N=r.offset-N,N>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=kr;break}N>r.wnext?(N-=r.wnext,B=r.wsize-N):B=r.wnext-N,N>r.length&&(N=r.length),U=r.window}else U=o,B=h-r.offset,N=r.length;N>g&&(N=g),g-=N,r.length-=N;do o[h++]=U[B++];while(--N);r.length===0&&(r.mode=zA);break;case 16205:if(g===0)break e;o[h++]=r.length,g--,r.mode=zA;break;case JP:if(r.wrap){for(;E<32;){if(m===0)break e;m--,y|=a[u++]<<E,E+=8}if(O-=g,e.total_out+=O,r.total+=O,4&r.wrap&&O&&(e.adler=r.check=Ui(r)?Zi(r.check,o,O,h-O):SS(r.check,o,O,h-O)),O=g,4&r.wrap&&(Ui(r)?y:lW(y))!==r.check){e.msg="incorrect data check",r.mode=kr;break}y=0,E=0}r.mode=16207;case 16207:if(r.wrap&&Ui(r)){for(;E<32;){if(m===0)break e;m--,y+=a[u++]<<E,E+=8}if(4&r.wrap&&y!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=kr;break}y=0,E=0}r.mode=16208;case 16208:le=nue;break e;case kr:le=sW;break e;case 16210:return oW;default:return Lo}return e.next_out=h,e.avail_out=g,e.next_in=u,e.avail_in=m,r.hold=y,r.bits=E,(r.wsize||O!==e.avail_out&&r.mode<kr&&(r.mode<JP||t!==aW))&&mW(e,e.output,e.next_out,O-e.avail_out),A-=e.avail_in,O-=e.avail_out,e.total_in+=A,e.total_out+=O,r.total+=O,4&r.wrap&&O&&(e.adler=r.check=Ui(r)?Zi(r.check,o,O,e.next_out-O):SS(r.check,o,O,e.next_out-O)),e.data_type=r.bits+(r.last?64:0)+(r.mode===Ku?128:0)+(r.mode===WA||r.mode===XP?256:0),(A===0&&O===0||t===aW)&&le===Xp&&(le=iue),le},Yu={inflateReset:dW,inflateReset2:hW,inflateResetKeep:uW,inflateInit:e=>fW(e,15),inflateInit2:fW,inflate:oue,inflateEnd:e=>{if(Jp(e))return Lo;let t=e.state;return t.window&&(t.window=null),e.state=null,Xp},inflateGetHeader:(e,t)=>{if(Jp(e))return Lo;const r=e.state;return(2&r.wrap)==0?Lo:(r.head=t,t.done=!1,Xp)},inflateSetDictionary:(e,t)=>{const r=t.length;let a,o,u;return Jp(e)?Lo:(a=e.state,a.wrap!==0&&a.mode!==HA?Lo:a.mode===HA&&(o=1,o=SS(o,t,r,0),o!==a.check)?sW:(u=mW(e,t,r,r),u?(a.mode=16210,oW):(a.havedict=1,Xp)))},inflateInfo:"pako inflate (from Nodeca project)"},cue=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const gW=Object.prototype.toString,{Z_NO_FLUSH:lue,Z_FINISH:uue,Z_OK:NS,Z_STREAM_END:QP,Z_NEED_DICT:ek,Z_STREAM_ERROR:due,Z_DATA_ERROR:_W,Z_MEM_ERROR:hue}=PA;function KA(e){this.options=MA.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits)==0&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new rW,this.strm.avail_out=0;let r=Yu.inflateInit2(this.strm,t.windowBits);if(r!==NS)throw new Error(zp[r]);if(this.header=new cue,Yu.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=OS.string2buf(t.dictionary):gW.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=Yu.inflateSetDictionary(this.strm,t.dictionary),r!==NS)))throw new Error(zp[r])}function fue(e,t){const r=new KA(t);if(r.push(e),r.err)throw r.msg||zp[r.err];return r.result}KA.prototype.push=function(e,t){const r=this.strm,a=this.options.chunkSize,o=this.options.dictionary;let u,h,m;if(this.ended)return!1;for(h=t===~~t?t:t===!0?uue:lue,gW.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){for(r.avail_out===0&&(r.output=new Uint8Array(a),r.next_out=0,r.avail_out=a),u=Yu.inflate(r,h),u===ek&&o&&(u=Yu.inflateSetDictionary(r,o),u===NS?u=Yu.inflate(r,h):u===_W&&(u=ek));r.avail_in>0&&u===QP&&r.state.wrap>0&&e[r.next_in]!==0;)Yu.inflateReset(r),u=Yu.inflate(r,h);switch(u){case due:case _W:case ek:case hue:return this.onEnd(u),this.ended=!0,!1}if(m=r.avail_out,r.next_out&&(r.avail_out===0||u===QP))if(this.options.to==="string"){let g=OS.utf8border(r.output,r.next_out),y=r.next_out-g,E=OS.buf2string(r.output,g);r.next_out=y,r.avail_out=a-y,y&&r.output.set(r.output.subarray(g,g+y),0),this.onData(E)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(u!==NS||m!==0){if(u===QP)return u=Yu.inflateEnd(this.strm),this.onEnd(u),this.ended=!0,!0;if(r.avail_in===0)break}}return!0},KA.prototype.onData=function(e){this.chunks.push(e)},KA.prototype.onEnd=function(e){e===NS&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=MA.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var pue={inflate:fue};const{deflate:mue}=Xle,{inflate:gue}=pue;var _ue=mue,vue=gue,vW=(function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e})(vW||{});class yue{constructor(){H(this,"_sequence",0),H(this,"_startTime",Date.now()),H(this,"isUseOneByte",!0)}get startTime(){const t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){const r={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){const m=new Uint8Array(4);m.set([1,0,0,0]);const g={id:0,length:4,data:m.buffer},y={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[g]};r.commonPacketHeader.extension=1,r.extension=y,r.payload=this.compress(t),r.commonPacketHeader.length=8+(r.extension.length+2)+r.payload.byteLength}else r.commonPacketHeader.length=8+r.payload.byteLength;X("SHOW_DATASTREAM2_LOG")&&k.debug("send data header: ".concat(JSON.stringify(r.commonPacketHeader)));const a=new ArrayBuffer(r.commonPacketHeader.length),o=new Uint8Array(a),u=new DataView(a);let h=0;if(u.setUint16(h,r.commonPacketHeader.extension<<15|r.commonPacketHeader.reserved<<14|r.commonPacketHeader.length,!0),h+=2,u.setUint32(h,r.commonPacketHeader.sequence,!0),h+=4,u.setUint16(h,r.commonStreamHeader,!0),h+=2,r.extension){const m=this.serializeExtension(r.extension);o.set(new Uint8Array(m),h),h+=m.byteLength}if(o.set(new Uint8Array(r.payload),h),h+=r.payload.byteLength,h!==r.commonPacketHeader.length)throw Error("serialize error!");return a}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);const r=new DataView(t);let a=0;const o=r.getUint16(a,!0);a+=2;const u={length:16383&o,reserved:(16384&o)>>14,extension:(32768&o)>>15,sequence:r.getUint16(a+2,!0)<<16|r.getUint16(a,!0)};let h,m;if(a+=4,X("SHOW_DATASTREAM2_LOG")&&k.debug("receive data header: ".concat(JSON.stringify(u))),r.getUint16(a,!0),a+=2,u.extension){m=this.deserializeExtension(t.slice(a)),a+=2+m.length,h=t.slice(a);let g=!1;if(m.datas.length>0){const y=m.datas.find((E=>E.id===0));y&&(g=(1&new DataView(y.data).getUint32(0,!0))==1)}h=g?this.decompress(h):h}else h=t.slice(8);return h}serializeExtension(t){const{profile:r,length:a,datas:o}=t,u=new ArrayBuffer(a+2),h=new Uint8Array(u),m=new DataView(u);let g=0;if(m.setUint8(g++,r),m.setUint8(g++,a),o.forEach((y=>{r?(m.setUint8(g++,y.id),m.setUint8(g++,y.length),h.set(new Uint8Array(y.data),g),g+=y.data.byteLength):(m.setUint8(g++,y.id|y.length<<4),h.set(new Uint8Array(y.data),g),g+=y.data.byteLength)})),g!==a+2)throw Error("serialize extension error, is ".concat(g,"!==").concat(a+2));return u}deserializeExtension(t){const r=new DataView(t);let a=0;const o=r.getUint8(a);a++;const u=r.getUint8(a);a++;const h=o===vW.TWO_BYTE,m=[],g=new DataView(t,2);let y=0;for(;y<u;){let E=0,A=0,O=new ArrayBuffer(0);h?(E=g.getUint8(y),y++,A=g.getUint8(y),y++):(E=15&g.getUint8(y),A=g.getUint8(y)>>4,y++),A>0&&(O=g.buffer.slice(y+2,y+2+A),y+=O.byteLength),m.push({id:E,length:A,data:O})}if(y!==u)throw Error("parse error");return{profile:o,length:u,datas:m}}decompress(t){return vue(new Uint8Array(t))}compress(t){return _ue(new Uint8Array(t))}}const Eue={name:"DataStream",create:(e,t)=>{const r=t?new Ooe(e):new Ioe(e);return r.useDataStream(new yue),r}};class Sue extends Mn{constructor(t,r,a){super(),H(this,"ws",void 0),H(this,"requestId",1),H(this,"heartBeatTimer",void 0),H(this,"joinInfo",void 0),H(this,"clientId",void 0),H(this,"onOpen",(()=>{this.emit("open"),this.startHeartBeatCheck()})),H(this,"onClose",(o=>{this.emit("close"),this.dispose()})),H(this,"onMessage",(o=>{const u=JSON.parse(o.data);if(!u||u.command!=="serverResponse"||!u.requestId)return u&&u.command==="serverStatus"&&u.serverStatus&&u.serverStatus.command?(this.emit("status",u.serverStatus),void this.emit(u.serverStatus.command,u.serverStatus)):void 0;this.emit("req_".concat(u.requestId),u)})),this.joinInfo=t,this.clientId=r,this.ws=new nS("cross-channel-".concat(this.clientId),a),this.ws.on(yt.RECONNECTING,(()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")})),this.ws.on(yt.CONNECTED,this.onOpen),this.ws.on(yt.ON_MESSAGE,this.onMessage),this.ws.on(yt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){const r=this.requestId++;return t.requestId=r,t.seq=r,this.ws.sendMessage(t),r}waitStatus(t){return new Fe(((r,a)=>{const o=window.setTimeout((()=>{a(new fe(q.TIMEOUT,"wait status timeout, status: ".concat(t)))}),5e3);this.once(t,(u=>{window.clearTimeout(o),u.state&&u.state!==0?a(new fe(q.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):r(void 0)})),this.once("dispose",(()=>{window.clearTimeout(o),a(new fe(q.WS_ABORT))}))}))}async request(t){if(this.ws.state==="closed")throw new fe(q.WS_DISCONNECT);const r=()=>new Fe(((h,m)=>{this.ws.once(yt.CLOSED,(()=>m(new fe(q.WS_ABORT)))),this.ws.once(yt.CONNECTED,h)}));this.ws.state!=="connected"&&await r();const a=this.sendMessage(t),o=new Fe(((h,m)=>{const g=()=>{m(new fe(q.WS_ABORT))};this.ws.once(yt.RECONNECTING,g),this.ws.once(yt.CLOSED,g),this.once("req_".concat(a),h),Hr(3e3).then((()=>{this.removeAllListeners("req_".concat(a)),this.ws.off(yt.RECONNECTING,g),this.ws.off(yt.CLOSED,g),m(new fe(q.TIMEOUT,"cross channel ws request timeout"))}))})),u=await o;if(!u||u.code!==200)throw new fe(q.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(u)));return u}async connect(t){this.ws.removeAllListeners(yt.REQUEST_NEW_URLS),this.ws.on(yt.REQUEST_NEW_URLS,(r=>{r(t)})),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const r=this.requestId++;return t.requestId=r,this.ws.sendMessage(t),r}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval((()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})}),3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class bue extends Mn{set state(t){t!==this._state&&(t!==Oa.RELAY_STATE_FAILURE&&(this.errorCode=J_.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,r,a,o,u){super(),H(this,"joinInfo",void 0),H(this,"sid",void 0),H(this,"clientId",void 0),H(this,"cancelToken",oa.CancelToken.source()),H(this,"workerToken",void 0),H(this,"requestId",0),H(this,"signal",void 0),H(this,"prevChannelMediaConfig",void 0),H(this,"httpRetryConfig",void 0),H(this,"_resolution",void 0),H(this,"_state",Oa.RELAY_STATE_IDLE),H(this,"errorCode",J_.RELAY_OK),H(this,"onStatus",(h=>{k.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(h))),h&&h.command&&(h.command==="onAudioPacketReceived"&&this.emit("event",Fu.PACKET_RECEIVED_AUDIO_FROM_SRC),h.command==="onVideoPacketReceived"&&this.emit("event",Fu.PACKET_RECEIVED_VIDEO_FROM_SRC),h.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=J_.SRC_TOKEN_EXPIRED,this.state=Oa.RELAY_STATE_FAILURE),h.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=J_.DEST_TOKEN_EXPIRED,this.state=Oa.RELAY_STATE_FAILURE))})),H(this,"onReconnect",(async()=>{k.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Fu.NETWORK_DISCONNECTED),this.state=Oa.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch((h=>{this.state!==Oa.RELAY_STATE_IDLE&&(k.error("auto restart channel media relay failed",h.toString()),this.errorCode=J_.SERVER_CONNECTION_LOST,this.state=Oa.RELAY_STATE_FAILURE)}))})),this.joinInfo=t,this.clientId=r,this.sid=xp(),this.signal=new Sue(this.joinInfo,this.clientId,a),this.httpRetryConfig=o,this._resolution=u}async startChannelMediaRelay(t){if(this.state!==Oa.RELAY_STATE_IDLE)throw new fe(q.INVALID_OPERATION);this.state=Oa.RELAY_STATE_CONNECTING,await this.connect(),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(r){throw r.data&&r.data.serverResponse&&r.data.serverResponse.command==="SetSourceChannel"?new fe(q.CROSS_CHANNEL_FAILED_JOIN_SRC):r.data&&r.data.serverResponse&&r.serverResponse.command==="SetDestChannelStatus"?new fe(q.CROSS_CHANNEL_FAILED_JOIN_DEST):r.data&&r.data.serverResponse&&r.serverResponse.command==="StartPacketTransfer"?new fe(q.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):r}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==Oa.RELAY_STATE_RUNNING)throw new fe(q.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==Oa.RELAY_STATE_RUNNING)throw new fe(q.INVALID_OPERATION);const r=this.genMessage($i.SetVideoProfile);await this.signal.request(r),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),k.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Oa.RELAY_STATE_IDLE,this.dispose()}dispose(){k.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=oa.CancelToken.source(),this.state=Oa.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await kce(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",Fu.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const r=this.genMessage($i.StopPacketTransfer);await this.signal.request(r),await this.signal.waitStatus("Normal Quit"),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const a=this.genMessage($i.SetSdkProfile,t);await this.signal.request(a),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const o=this.genMessage($i.SetSourceChannel,t);await this.signal.request(o),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Fu.PACKET_JOINED_SRC_CHANNEL),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const u=this.genMessage($i.SetSourceUserId,t);await this.signal.request(u),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const h=this.genMessage($i.SetDestChannel,t);await this.signal.request(h),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Fu.PACKET_JOINED_DEST_CHANNEL),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const m=this.genMessage($i.StartPacketTransfer,t);await this.signal.request(m),this.emit("event",Fu.PACKET_SENT_TO_DEST_CHANNEL),this.state=Oa.RELAY_STATE_RUNNING,k.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){const r=this.genMessage($i.UpdateDestChannel,t);await this.signal.request(r),this.emit("event",Fu.PACKET_UPDATE_DEST_CHANNEL),k.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage($i.StopPacketTransfer);await this.signal.request(t),k.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,r){const a=[],o=[],u=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Fs,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};h.sdkVersion==="4.24.0"&&(h.sdkVersion="0.0.1");let m=null,g=null;switch(t){case $i.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case $i.SetSourceChannel:if(g=r&&r.getSrcChannelMediaInfo(),!g)throw new fe(q.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:g.channelName,token:g.token||this.joinInfo.appId},h;case $i.SetSourceUserId:if(g=r&&r.getSrcChannelMediaInfo(),!g)throw new fe(q.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:g.uid+""},h;case $i.SetDestChannel:if(m=r&&r.getDestChannelMediaInfo(),!m)throw new fe(q.UNEXPECTED_ERROR,"can not find dest config");return m.forEach((y=>{a.push(y.channelName),o.push(y.uid+""),u.push(y.token||this.joinInfo.appId)})),h.clientRequest={command:"SetDestChannel",channelName:a,uid:o,token:u},h;case $i.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case $i.Reconnect:return h.clientRequest={command:"Reconnect"},h;case $i.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case $i.UpdateDestChannel:if(m=r&&r.getDestChannelMediaInfo(),!m)throw new fe(q.UNEXPECTED_ERROR,"can not find dest config");return m.forEach((y=>{a.push(y.channelName),o.push(y.uid+""),u.push(y.token||this.joinInfo.appId)})),h.clientRequest={command:"UpdateDestChannel",channelName:a,uid:o,token:u},h;case $i.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}const Tue={name:"ChannelMediaRelay",create:function(e){return new bue(e.joinInfo,e.clientId,e.websocketRetryConfig||sr,e.httpRetryConfig||sr,e.resolution)}};function yW(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),r.push.apply(r,a)}return r}function xS(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?yW(Object(r),!0).forEach((function(a){H(e,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yW(Object(r)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))}))}return e}class wue extends Mn{constructor(t,r,a,o){super(),H(this,"spec",void 0),H(this,"token",void 0),H(this,"websocket",void 0),H(this,"pingpongTimer",void 0),H(this,"reconnectMode","retry"),H(this,"serviceMode",void 0),H(this,"reqId",0),H(this,"commandReqId",0),H(this,"handleWebSocketOpen",(()=>{this.reconnectMode="retry",this.startPingPong()})),H(this,"handleWebSocketMessage",(u=>{if(!u.data)return;const h=JSON.parse(u.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):(nt.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===Bu.TRANSCODE?1:2}),this.emit(kh.PUBLISH_STREAM_STATUS,h))})),this.spec=r,this.token=t,this.serviceMode=o,this.websocket=new nS("live-streaming",a),this.websocket.on(yt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(yt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(yt.REQUEST_NEW_URLS,((u,h)=>{ei(this,kh.REQUEST_NEW_ADDRESS).then(u).catch(h)})),this.websocket.on(yt.RECONNECTING,(()=>{this.websocket.reconnectMode=this.reconnectMode}))}init(t){return this.websocket.init(t)}async request(t,r,a,o){this.reqId+=1,t==="request"&&(this.commandReqId+=1);const u=this.commandReqId,h=this.reqId;if(!h||!this.websocket)throw new fe(q.UNEXPECTED_ERROR);const m=xS({command:t,sdkVersion:Fs==="4.24.0"?"0.0.1":Fs,seq:h,requestId:h,allocate:a,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},r);if(this.websocket.state==="closed")throw new fe(q.WS_DISCONNECT);const g=()=>new Fe(((O,N)=>{this.websocket.once(yt.CLOSED,(()=>N(new fe(q.WS_ABORT)))),this.websocket.once(yt.CONNECTED,O)}));this.websocket.state!=="connected"&&await g(),m.clientRequest&&(m.clientRequest.workerToken=this.token);const y=new Fe(((O,N)=>{const B=()=>{N(new fe(q.WS_ABORT))};this.websocket.once(yt.RECONNECTING,B),this.websocket.once(yt.CLOSED,B),this.once("@".concat(h,"-").concat(this.spec.sid),(U=>{O(U)}))}));o&&nt.workerEvent(this.spec.sid,xS(xS({},o),{},{requestId:u,actionType:"request",payload:JSON.stringify(r.clientRequest),serverCode:0,code:0}));const E=Date.now();this.websocket.sendMessage(m);let A=null;try{A=await y}catch(O){if(this.websocket.state==="closed")throw O;return await g(),await this.request(t,r,a)}return o&&nt.workerEvent(this.spec.sid,xS(xS({},o),{},{requestId:u,actionType:"response",payload:JSON.stringify(A.serverResponse),serverCode:A.code,success:A.code===200,responseTime:Date.now()-E})),A.code!==200&&this.handleResponseError(A),A}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t=Fs==="4.24.0"?"0.0.1":Fs;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case hr.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void k.warning("live stream response already exists stream");case hr.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case hr.LIVE_STREAM_RESPONSE_BAD_STREAM:case hr.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new fe(q.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case hr.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream")return;throw new fe(q.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case hr.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new fe(q.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case hr.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const r=new fe(q.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(kh.WARNING,r,t.serverResponse.url)}case hr.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const r=new fe(q.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(kh.WARNING,r,t.serverResponse.url)}case hr.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new fe(q.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case hr.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new fe(q.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case hr.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const r=new fe(q.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(kh.WARNING,r,t.serverResponse.url)}case hr.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new fe(q.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case hr.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new fe(q.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case hr.LIVE_STREAM_RESPONSE_WORKER_LOST:case hr.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream")return;throw new fe(q.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case hr.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new fe(q.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new fe(q.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case hr.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case hr.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case hr.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case hr.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new fe(q.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval((()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(xC)}),6e3)}}function EW(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),r.push.apply(r,a)}return r}function Ia(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?EW(Object(r),!0).forEach((function(a){H(e,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):EW(Object(r)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))}))}return e}class Rue extends Mn{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:sr,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:sr;super(),H(this,"onLiveStreamWarning",void 0),H(this,"onLiveStreamError",void 0),H(this,"spec",void 0),H(this,"retryTimeout",1e4),H(this,"connection",void 0),H(this,"httpRetryConfig",void 0),H(this,"wsRetryConfig",void 0),H(this,"streamingTasks",new Map),H(this,"isStartingStreamingTask",!1),H(this,"taskMutex",new oi("live-streaming")),H(this,"cancelToken",oa.CancelToken.source()),H(this,"transcodingConfig",void 0),H(this,"uapResponse",void 0),H(this,"lastTaskId",1),H(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=a,this.wsRetryConfig=r}async setTranscodingConfig(t){const r=Ia(Ia({},hce),t);r.videoCodecProfile!==66&&r.videoCodecProfile!==77&&r.videoCodecProfile!==100&&(k.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(r.videoCodecProfile," -> 100")),r.videoCodecProfile=100),r.transcodingUsers||(r.transcodingUsers=r.userConfigs),r.transcodingUsers&&(r.transcodingUsers=r.transcodingUsers.map((h=>Ia(Ia(Ia({},dce),h),{},{zOrder:h.zOrder?h.zOrder+1:1})))),(function(h){Bn(h.width)||ln(h.width,"config.width",0,1e4),Bn(h.height)||ln(h.height,"config.height",0,1e4),Bn(h.videoBitrate)||ln(h.videoBitrate,"config.videoBitrate",1,1e6),Bn(h.videoFrameRate)||ln(h.videoFrameRate,"config.videoFrameRate"),Bn(h.lowLatency)||Uc(h.lowLatency,"config.lowLatency"),Bn(h.audioSampleRate)||vr(h.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Bn(h.audioBitrate)||ln(h.audioBitrate,"config.audioBitrate",1,128),Bn(h.audioChannels)||vr(h.audioChannels,"config.audioChannels",[1,2,3,4,5]),Bn(h.videoGop)||ln(h.videoGop,"config.videoGop"),Bn(h.videoCodecProfile)||vr(h.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Bn(h.userCount)||ln(h.userCount,"config.userCount",0,17),Bn(h.backgroundColor)||ln(h.backgroundColor,"config.backgroundColor",0,16777215),Bn(h.userConfigExtraInfo)||Gr(h.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),h.transcodingUsers&&!Bn(h.transcodingUsers)&&(Vu(h.transcodingUsers,"config.transcodingUsers"),h.transcodingUsers.forEach(((m,g)=>{tA(m.uid),Bn(m.x)||ln(m.x,"transcodingUser[".concat(g,"].x"),0,1e4),Bn(m.y)||ln(m.y,"transcodingUser[".concat(g,"].y"),0,1e4),Bn(m.width)||ln(m.width,"transcodingUser[".concat(g,"].width"),0,1e4),Bn(m.height)||ln(m.height,"transcodingUser[".concat(g,"].height"),0,1e4),Bn(m.zOrder)||ln(m.zOrder-1,"transcodingUser[".concat(g,"].zOrder"),0,100),Bn(m.alpha)||ln(m.alpha,"transcodingUser[".concat(g,"].alpha"),0,1,!1)}))),Bn(h.watermark)||QD(h.watermark,"watermark"),Bn(h.backgroundImage)||QD(h.backgroundImage,"backgroundImage"),h.images&&!Bn(h.images)&&(Vu(h.images,"config.images"),h.images.forEach(((m,g)=>{QD(m,"images[".concat(g,"]"))})))})(r);const a=[];r.images&&a.push(...r.images.map((h=>Ia(Ia(Ia({},ZD),h),{},{zOrder:255})))),r.backgroundImage&&(a.push(Ia(Ia(Ia({},ZD),r.backgroundImage),{},{zOrder:0})),delete r.backgroundImage),r.watermark&&(a.push(Ia(Ia(Ia({},ZD),r.watermark),{},{zOrder:255})),delete r.watermark),r.images=a,r.transcodingUsers&&(r.userConfigs=r.transcodingUsers.map((h=>Ia({},h))),r.userCount=r.transcodingUsers.length,delete r.transcodingUsers);const o=(r.userConfigs||[]).map((h=>typeof h.uid=="number"?Fe.resolve(h.uid):z8(h.uid,this.spec,this.cancelToken.token,this.httpRetryConfig)));if((await Fe.all(o)).forEach(((h,m)=>{r.userConfigs&&r.userConfigs[m]&&(r.userConfigs[m].uid=h)})),this.transcodingConfig=r,this.connection)try{var u;const h=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Pi(u=this.streamingTasks).call(u)).map((m=>m.taskId)).join("#")});k.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(h.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(h){if(!h.data||!h.data.retry)throw h;h.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach((m=>{k.warning("[".concat(this.spec.clientId,"] live streaming receive error"),h.toString(),"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,h).then((()=>{k.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(m.url," success"))})).catch((g=>{k.error("[".concat(this.spec.clientId,"] live streaming republish failed"),m.url,g.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,g)}))}))}}async startLiveStreamingTask(t,r,a){if(!this.transcodingConfig&&r===Bu.TRANSCODE)throw new fe(q.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const o={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};k.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(r));const u=await this.taskMutex.lock();if(!this.connection&&a)return void u();if(this.streamingTasks.get(t)&&!a)return u(),new fe(q.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(r))}catch(m){throw u(),m}switch(r){case Bu.TRANSCODE:o.transcodingConfig=Ia({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(o.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const h=this.lastTaskId++;try{const m=new Fe(((y,E)=>{Hr(this.retryTimeout).then((()=>{if(a)return E(a);const A=this.statusError.get(t);return A?(this.statusError.delete(t),E(A)):void 0}))})),g=await Fe.race([this.connection.request("request",{clientRequest:o},!0,{url:t,command:"PublishStream",workerType:r===Bu.TRANSCODE?1:2,requestByUser:!a,tid:h.toString()}),m]);this.isStartingStreamingTask=!1,k.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(g.code)),this.streamingTasks.set(t,{clientRequest:o,mode:r,url:t,taskId:h}),u()}catch(m){if(u(),this.isStartingStreamingTask=!1,!m.data||!m.data.retry||a)throw m;return m.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,r,m)):await this.startLiveStreamingTask(t,r,m)}}stopLiveStreamingTask(t){return new Fe(((r,a)=>{const o=this.streamingTasks.get(t);if(!o||!this.connection)return new fe(q.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const u=o.mode;o.abortTask=()=>{k.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),r()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:o.url}},!1,{url:t,command:"UnPublishStream",workerType:u===Bu.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then((h=>{k.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),r()})).catch(a)}))}resetAllTask(){var t;const r=Array.from(Pi(t=this.streamingTasks).call(t));this.terminate();for(const a of r)this.startLiveStreamingTask(a.url,a.mode).catch((o=>{this.onLiveStreamError&&this.onLiveStreamError(a.url,o)}))}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=oa.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new fe(q.UNEXPECTED_ERROR,"live streaming connection has already connected");const r=await ei(this,eP.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=r,this.connection=new wue(r.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(kh.WARNING,((a,o)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(o,a))),this.connection.on(kh.PUBLISH_STREAM_STATUS,(a=>this.handlePublishStreamServer(a))),this.connection.on(kh.REQUEST_NEW_ADDRESS,((a,o)=>{if(!this.connection)return o(new fe(q.UNEXPECTED_ERROR,"can not get new live streaming address list"));ei(this,eP.REQUEST_WORKER_MANAGER_LIST,t).then((u=>{this.uapResponse=u,a(u.addressList)})).catch(o)})),await this.connection.init(r.addressList),this.connection}handlePublishStreamServer(t){const r=t.serverStatus&&t.serverStatus.url||"empty_url",a=this.streamingTasks.get(r),o=t.reason;switch(t.code){case hr.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case hr.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case hr.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case hr.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new fe(q.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(a)return k.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(r,h);if(!this.isStartingStreamingTask)return;this.statusError.set(r,h)}case hr.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new fe(q.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,o);return this.onLiveStreamWarning&&this.onLiveStreamWarning(r,h)}case hr.LIVE_STREAM_RESPONSE_WORKER_LOST:case hr.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var u;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(Pi(u=this.streamingTasks).call(u));for(const m of h)m.abortTask?m.abortTask():(k.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,new fe(q.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then((()=>{k.debug("[".concat(this.spec.clientId,"] republish live stream success"),m.url)})).catch((g=>{k.error(g.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,g)})));return}}}hasUrl(t){return this.streamingTasks.has(t)}}const Cue={name:"LiveStreaming",create:function(e){return new Rue(e.joinInfo,e.websocketRetryConfig||sr,e.httpRetryConfig||sr)}};function Aue(e){let t=TW();return(function(r,a){let o=r.appId;o!==void 0&&(tn(a,10),Gl(a,o));let u=r.cid;u!==void 0&&(tn(a,16),tn(a,u));let h=r.cname;h!==void 0&&(tn(a,26),Gl(a,h));let m=r.deviceId;m!==void 0&&(tn(a,34),Gl(a,m));let g=r.elapse;g!==void 0&&(tn(a,40),Jh(a,g));let y=r.fileSize;y!==void 0&&(tn(a,48),Jh(a,fv(y)));let E=r.height;E!==void 0&&(tn(a,56),Jh(a,fv(E)));let A=r.jpg;A!==void 0&&(tn(a,66),tn(a,A.length),(function(hi,Te){let Ue=pv(hi,Te.length);hi.bytes.set(Te,Ue)})(a,A));let O=r.networkType;O!==void 0&&(tn(a,72),Jh(a,fv(O)));let N=r.osType;N!==void 0&&(tn(a,80),Jh(a,fv(N)));let B=r.requestId;B!==void 0&&(tn(a,90),Gl(a,B));let U=r.sdkVersion;U!==void 0&&(tn(a,98),Gl(a,U));let V=r.sequence;V!==void 0&&(tn(a,104),Jh(a,fv(V)));let K=r.sid;K!==void 0&&(tn(a,114),Gl(a,K));let z=r.timestamp;z!==void 0&&(tn(a,120),Jh(a,z));let J=r.uid;J!==void 0&&(tn(a,128),tn(a,J));let ae=r.vid;ae!==void 0&&(tn(a,136),tn(a,ae));let ie=r.width;ie!==void 0&&(tn(a,144),Jh(a,fv(ie)));let ee=r.service;ee!==void 0&&(tn(a,152),tn(a,ee));let le=r.callbackData;le!==void 0&&(tn(a,162),Gl(a,le));let ye=r.jpgEncryption;ye!==void 0&&(tn(a,168),tn(a,ye));let we=r.requestType;we!==void 0&&(tn(a,176),tn(a,we));let Ne=r.scorePorn;Ne!==void 0&&(tn(a,185),ak(a,Ne));let bt=r.scoreSexy;bt!==void 0&&(tn(a,193),ak(a,bt));let Rt=r.scoreNeutral;Rt!==void 0&&(tn(a,201),ak(a,Rt));let ft=r.scene;ft!==void 0&&(tn(a,208),tn(a,ft));let Xt=r.ossFilePrefix;Xt!==void 0&&(tn(a,218),Gl(a,Xt));let Wt=r.serviceVendor;if(Wt!==void 0)for(let hi of Wt){tn(a,226);let Te=TW();Nue(hi,Te),tn(a,Te.limit),kue(a,Te),Pue(Te)}})(e,t),(function(r){let a=r.bytes,o=r.limit;return a.length===o?a:a.subarray(0,o)})(t)}function Oue(e){return(function(r){let a={};e:for(;!wW(r);){let o=Hl(r);switch(o>>>3){case 0:break e;case 1:a.code=Hl(r);break;case 2:a.msg=RW(r,Hl(r));break;case 3:{let u=xue(r);a.data=Iue(r),r.limit=u;break}default:SW(r,7&o)}}return a})({bytes:t=e,offset:0,limit:t.length});var t}function Iue(e){let t={};e:for(;!wW(e);){let r=Hl(e);switch(r>>>3){case 0:break e;case 1:t.requestId=RW(e,Hl(e));break;case 2:t.requestType=Hl(e)>>>0;break;case 3:t.scorePorn=ik(e);break;case 4:t.scoreSexy=ik(e);break;case 5:t.scoreNeutral=ik(e);break;case 6:t.requestScene=Hl(e)>>>0;break;case 7:t.scene=Hl(e)>>>0;break;default:SW(e,7&r)}}return t}function Nue(e,t){let r=e.service;r!==void 0&&(tn(t,8),tn(t,r));let a=e.vendor;a!==void 0&&(tn(t,16),tn(t,a));let o=e.token;o!==void 0&&(tn(t,26),Gl(t,o));let u=e.callbackUrl;u!==void 0&&(tn(t,34),Gl(t,u))}function xue(e){let t=Hl(e),r=e.limit;return e.limit=e.offset+t,r}function SW(e,t){switch(t){case 0:for(;128&CW(e););break;case 2:nk(e,Hl(e));break;case 5:nk(e,4);break;case 1:nk(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let Due=new Float32Array(1);new Uint8Array(Due.buffer);let tk=new Float64Array(1),Na=new Uint8Array(tk.buffer);function fv(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let bW=[];function TW(){const e=bW.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function Pue(e){bW.push(e)}function nk(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function wW(e){return e.offset>=e.limit}function pv(e,t){let r=e.bytes,a=e.offset,o=e.limit,u=a+t;if(u>r.length){let h=new Uint8Array(2*u);h.set(r),e.bytes=h}return e.offset=u,u>o&&(e.limit=u),a}function rk(e,t){let r=e.offset;if(r+t>e.limit)throw new Error("Read past limit");return e.offset+=t,r}function RW(e,t){let r=rk(e,t),a=String.fromCharCode,o=e.bytes,u="",h="";for(let m=0;m<t;m++){let g,y,E,A,O=o[m+r];(128&O)==0?h+=a(O):(224&O)==192?m+1>=t?h+=u:(g=o[m+r+1],(192&g)!=128?h+=u:(A=(31&O)<<6|63&g,A<128?h+=u:(h+=a(A),m++))):(240&O)==224?m+2>=t?h+=u:(g=o[m+r+1],y=o[m+r+2],(49344&(g|y<<8))!=32896?h+=u:(A=(15&O)<<12|(63&g)<<6|63&y,A<2048||A>=55296&&A<=57343?h+=u:(h+=a(A),m+=2))):(248&O)==240?m+3>=t?h+=u:(g=o[m+r+1],y=o[m+r+2],E=o[m+r+3],(12632256&(g|y<<8|E<<16))!=8421504?h+=u:(A=(7&O)<<18|(63&g)<<12|(63&y)<<6|63&E,A<65536||A>1114111?h+=u:(A-=65536,h+=a(55296+(A>>10),56320+(1023&A)),m+=3))):h+=u}return h}function Gl(e,t){let r=t.length,a=0;for(let h=0;h<r;h++){let m=t.charCodeAt(h);m>=55296&&m<=56319&&h+1<r&&(m=(m<<10)+t.charCodeAt(++h)-56613888),a+=m<128?1:m<2048?2:m<65536?3:4}tn(e,a);let o=pv(e,a),u=e.bytes;for(let h=0;h<r;h++){let m=t.charCodeAt(h);m>=55296&&m<=56319&&h+1<r&&(m=(m<<10)+t.charCodeAt(++h)-56613888),m<128?u[o++]=m:(m<2048?u[o++]=m>>6&31|192:(m<65536?u[o++]=m>>12&15|224:(u[o++]=m>>18&7|240,u[o++]=m>>12&63|128),u[o++]=m>>6&63|128),u[o++]=63&m|128)}}function kue(e,t){let r=pv(e,t.limit),a=e.bytes,o=t.bytes;for(let u=0,h=t.limit;u<h;u++)a[u+r]=o[u]}function CW(e){return e.bytes[rk(e,1)]}function AW(e,t){let r=pv(e,1);e.bytes[r]=t}function ik(e){let t=rk(e,8),r=e.bytes;return Na[0]=r[t++],Na[1]=r[t++],Na[2]=r[t++],Na[3]=r[t++],Na[4]=r[t++],Na[5]=r[t++],Na[6]=r[t++],Na[7]=r[t++],tk[0]}function ak(e,t){let r=pv(e,8),a=e.bytes;tk[0]=t,a[r++]=Na[0],a[r++]=Na[1],a[r++]=Na[2],a[r++]=Na[3],a[r++]=Na[4],a[r++]=Na[5],a[r++]=Na[6],a[r++]=Na[7]}function Hl(e){let t,r=0,a=0;do t=CW(e),r<32&&(a|=(127&t)<<r),r+=7;while(128&t);return a}function tn(e,t){for(t>>>=0;t>=128;)AW(e,127&t|128),t>>>=7;AW(e,t)}function Jh(e,t){let r=t.low>>>0,a=(t.low>>>28|t.high<<4)>>>0,o=t.high>>>24,u=o===0?a===0?r<16384?r<128?1:2:r<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:o<128?9:10,h=pv(e,u),m=e.bytes;switch(u){case 10:m[h+9]=o>>>7&1;case 9:m[h+8]=u!==9?128|o:127&o;case 8:m[h+7]=u!==8?a>>>21|128:a>>>21&127;case 7:m[h+6]=u!==7?a>>>14|128:a>>>14&127;case 6:m[h+5]=u!==6?a>>>7|128:a>>>7&127;case 5:m[h+4]=u!==5?128|a:127&a;case 4:m[h+3]=u!==4?r>>>21|128:r>>>21&127;case 3:m[h+2]=u!==3?r>>>14|128:r>>>14&127;case 2:m[h+1]=u!==2?r>>>7|128:r>>>7&127;case 1:m[h]=u!==1?128|r:127&r}}function OW(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),r.push.apply(r,a)}return r}const Lue=new Map([["moderation",1],["supervise",2]]);class Mue extends Mn{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const r=this._connectionState;this._connectionState=t,this.emit(Pr.CONNECTION_STATE_CHANGE,r,t)}get inspectType(){return this._inspectType}set inspectType(t){var r;this._inspectMode=vi(r=t.map((a=>Lue.get(a)||0))).call(r,((a,o)=>a+o)),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout((()=>{this.quality=this._quality/this.qualityRatio}),6e4))}constructor(t){super(),H(this,"name","AgoraRTCVideoContentInspect"),H(this,"_connectionState",Io.CONNECTING),H(this,"_innerConnectionState",void 0),H(this,"sequence",0),H(this,"inspectStartTime",void 0),H(this,"workerManagerConnection",void 0),H(this,"workerConnection",void 0),H(this,"workerMessageLengthLimit",void 0),H(this,"inspectIntervalMinimum",void 0),H(this,"qualityRatio",void 0),H(this,"_connectInfo",void 0),H(this,"_cancelTokenSource",oa.CancelToken.source()),H(this,"_retryConfig",void 0),H(this,"wmSequence",0),H(this,"inspectInterval",void 0),H(this,"inspectTimer",null),H(this,"ossFilePrefix",void 0),H(this,"extraInfo",void 0),H(this,"_inspectType",void 0),H(this,"_inspectMode",void 0),H(this,"_quality",1),H(this,"qualityTimer",null),H(this,"_inspectId",void 0),H(this,"_needWorkUrlOnly",!1),H(this,"inspectImage",(()=>{if(this.connectionState!==Io.CONNECTED)throw new fe(q.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval((()=>{this.connectionState===Io.CONNECTED?this.requestToInspectImage():k.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)}),this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()})),this._inspectId=fn(5,"inspect-"),this.workerMessageLengthLimit=X("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=X("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=X("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new nS("worker-manager-"+this._inspectId,sr),this.on(Pr.STATE_CHANGE,((r,a)=>{this._innerConnectionState=r,k.debug("[".concat(this._inspectId,"] Inspect operation :").concat(No[r]," ").concat(a||""))})),this.handleWorkerManagerEvents(),this.workerConnection=new nS("worker-"+this._inspectId,sr),this.handleWorkerEvents()}async init(t,r){this.emit(Pr.STATE_CHANGE,No.CONNECT_AP),this._connectInfo=t;const a=this._cancelTokenSource.token;return this._retryConfig=r,new Fe(((o,u)=>{this.on(Pr.CONNECTION_STATE_CHANGE,((h,m)=>{m===Io.CONNECTED&&o()})),this.requestAP(t,a,r).then((h=>{this.connectWorkerManager(h)})).catch((h=>{u(h)}))}))}async requestAP(t,r,a){const o=X("WEBCS_DOMAIN").map((m=>"https://".concat(m,"/api/v1"))),u=await(function(m,g,y,E){let{appId:A,areaCode:O,cname:N,sid:B,token:U,uid:V}=g;rv++;const K="image_moderation_api",z={service_name:K,json_body:JSON.stringify({appId:A,areaCode:O,cname:N,command:"allocateEdge",requestId:rv,seq:rv,sid:B,token:U,ts:Date.now(),uid:V+""})};let J,ae,ie=m[0];return jc((async()=>{J=Date.now();const ee=await Hc(ie,{data:z,cancelToken:y,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(ae=Date.now()-J,ee.code!==0){const Ne=new fe(q.UNEXPECTED_RESPONSE,"image inspect ap error, code"+ee.code,{retry:!0,responseTime:ae});throw k.error(Ne.toString()),Ne}const le=JSON.parse(ee.json_body);if(le.code!==200){const Ne=new fe(q.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(le.code,", reason: ").concat(le.reason),{code:le.code,responseTime:ae});throw k.error(Ne.toString()),Ne}if(!le.servers||!Array.isArray(le.servers)||le.servers.length===0){const Ne=new fe(q.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:le.code,responseTime:ae});throw k.error(Ne.toString()),Ne}const ye=X("VIDEO_INSPECT_WORKER_MANAGER_HOST"),we=X("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:le.servers.map((Ne=>{let{address:bt,wss:Rt}=Ne;if(bt&&Rt)return"wss://".concat(bt.replace(/\./g,"-"),".").concat(ye,":").concat(we||Rt)})).filter((Ne=>!!Ne)),workerToken:le.workerToken,vid:le.vid,responseTime:ae}}),((ee,le)=>(nt.apworkerEvent(B,{success:!0,sc:200,serviceName:K,responseDetail:JSON.stringify(ee.addressList),firstSuccess:le===0,responseTime:ae,serverIp:m[le%m.length]}),!1)),((ee,le)=>(nt.apworkerEvent(B,{success:!1,sc:ee.data&&ee.data.code||200,serviceName:K,responseTime:ae,serverIp:m[le%m.length]}),!!(ee.code!==q.OPERATION_ABORTED&&ee.code!==q.UNEXPECTED_RESPONSE||ee.data&&ee.data.retry)&&(ie=m[(le+1)%m.length],!0))),E)})(o,t,r,a);this.emit(Pr.STATE_CHANGE,No.AP_CONNECTED);const{addressList:h}=u;return this.wmSequence++,h}async connectWorkerManager(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=r,this.emit(Pr.STATE_CHANGE,No.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(yt.CONNECTED,(async()=>{this.emit(Pr.STATE_CHANGE,No.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)})),this.workerManagerConnection.on(yt.CLOSED,(()=>{this._innerConnectionState<No.GET_WORKER_MANAGER_RESPONSE&&k.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))})),this.workerManagerConnection.on(yt.FAILED,(()=>{this._innerConnectionState<No.GET_WORKER_MANAGER_RESPONSE&&k.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))})),this.workerManagerConnection.on(yt.RECONNECTING,(()=>{this._innerConnectionState<No.GET_WORKER_MANAGER_RESPONSE&&k.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))})),this.workerManagerConnection.on(yt.ON_MESSAGE,(async t=>{this.emit(Pr.STATE_CHANGE,No.GET_WORKER_MANAGER_RESPONSE);const r=this.workerManagerConnection.url;this.workerManagerConnection.close();const a=JSON.parse(t.data);if(a.code!==200)throw k.error("[".concat(this._inspectId,"] Unexpected code ").concat(a.code," from worker manager")),new fe(q.UNEXPECTED_RESPONSE,"response code of worker is unexpected",a);if(!(a.serverResponse&&a.serverResponse.portWss&&r))throw k.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(a))),new fe(q.UNEXPECTED_RESPONSE,"response content of worker is unexpected",a);{const o=X("VIDEO_INSPECT_WORKER_PORT")||a.serverResponse.portWss,u=r.replace(/:\d+\/?$/,":".concat(o));this.emit(Pr.STATE_CHANGE,No.CONNECT_WORKER,u),this._needWorkUrlOnly?this.emit(Pr.REQUEST_NEW_WORKER_URL,u):await this.connectWorker(u)}})),this.workerManagerConnection.on(yt.WILL_RECONNECT,((t,r,a)=>{a(t)})),this.workerManagerConnection.on(yt.REQUEST_NEW_URLS,((t,r)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(r)}))}handleWorkerEvents(){this.workerConnection.on(yt.CONNECTED,(async()=>{this.emit(Pr.STATE_CHANGE,No.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Io.CONNECTED})),this.workerConnection.on(yt.ON_MESSAGE,(async t=>{if(t.data instanceof ArrayBuffer){const a=Oue(new Uint8Array(t.data));if(X("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&k.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(a)),a.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Pr.INSPECT_RESULT,void 0,void 0);if(a.data&&a.data.scorePorn&&a.data.scoreSexy&&a.data.scoreNeutral){var r;const o={porn:a.data.scorePorn,sexy:a.data.scoreSexy,neutral:a.data.scoreNeutral},u=vi(r=Object.keys(o)).call(r,((m,g)=>o[m]>o[g]?m:g),"porn"),h=Object.keys(o).find((m=>m===u));this.emit(Pr.INSPECT_RESULT,h)}else this.emit(Pr.INSPECT_RESULT,void 0,new fe(q.UNEXPECTED_RESPONSE,a.code+"","There is an unexpected data on message"))}else this.emit(Pr.INSPECT_RESULT,void 0,new fe(q.UNEXPECTED_RESPONSE,a.code+"",a.msg))}else k.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Pr.INSPECT_RESULT,void 0,new fe(q.UNEXPECTED_RESPONSE,"invalid worker message type"))})),this.workerConnection.on(yt.CLOSED,(()=>{this.connectionState=Io.CLOSED})),this.workerConnection.on(yt.FAILED,(()=>{this.connectionState=Io.CLOSED})),this.workerConnection.on(yt.RECONNECTING,(()=>{this.connectionState=this.connectionState===Io.CONNECTED?Io.RECONNECTING:Io.CONNECTING})),this.workerConnection.on(yt.WILL_RECONNECT,((t,r,a)=>{t==="recover"&&a(t),a("tryNext")})),this.workerConnection.on(yt.REQUEST_NEW_URLS,((t,r)=>{this.workerManagerConnection.close(),this.once(Pr.REQUEST_NEW_WORKER_URL,(a=>{t([a])})),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then((a=>{this.connectWorkerManager(a,!0)})).catch((a=>{r(a)}))}))}async requestToInspectImage(){this.sequence++;const t=_s(this,Pr.CLIENT_LOCAL_VIDEO_TRACK),r={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(Pr.INSPECT_RESULT,void 0,new fe(q.INVALID_OPERATION,"Only the track being played can be inspected"));const a=await this.generateRequestData(t,r);this.workerConnection.sendMessage(a,!0,!0)}else this.emit(Pr.INSPECT_RESULT,void 0,new fe(q.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,r){let{appId:a,cname:o,cid:u,vid:h,sid:m,uid:g}=r;const y=Date.now(),E=await t.getCurrentFrameImage("image/jpeg",this.quality),A=await cF(E,a,o),O=this.sequence+"-"+u+"-"+g+"-"+y+"-"+fn(12,""),N={appId:a,cid:u,cname:o,deviceId:"",elapse:(B=Number(y-this.inspectStartTime),{low:B|=0,high:B>>31,unsigned:B>=0}),fileSize:A.byteLength,jpgEncryption:2,height:E.height,width:E.width,jpg:A,networkType:6,osType:7,requestId:O,sdkVersion:"4.24.0",sequence:this.sequence,sid:m,timestamp:MG(y),uid:g,vid:h,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var B;this.extraInfo===void 0&&delete N.callbackData,this.ossFilePrefix===void 0&&delete N.ossFilePrefix;const U=Aue(N);if(U.byteLength<this.workerMessageLengthLimit){if(X("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const V=(function(K){for(var z=1;z<arguments.length;z++){var J=arguments[z]!=null?arguments[z]:{};z%2?OW(Object(J),!0).forEach((function(ae){H(K,ae,J[ae])})):Object.getOwnPropertyDescriptors?Object.defineProperties(K,Object.getOwnPropertyDescriptors(J)):OW(Object(J)).forEach((function(ae){Object.defineProperty(K,ae,Object.getOwnPropertyDescriptor(J,ae))}))}return K})({},N);delete V.jpg,k.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(V))}return U}{const V=this.quality*this.qualityRatio;return this.quality=V,await this.generateRequestData(t,{appId:a,cname:o,cid:u,vid:h,sid:m,uid:g})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=oa.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Io.CLOSED,this.emit(Pr.STATE_CHANGE,No.CLOSED)}}const Uue={name:"ContentInspect",create:function(e){let{config:t}=e;return(function(r){if(!r)throw new fe(q.INVALID_PARAMS,"inspectConfig is necessary.");if(!r.inspectType||!Array.isArray(r.inspectType))throw new fe(q.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const a=[...new Set(r.inspectType)];a.forEach((o=>{var u;if(!je(u=["supervise","moderation"]).call(u,o))throw new fe(q.INVALID_PARAMS,"".concat(o," is not a valid inspect type."))})),r.inspectType=a}if(r&&r.extraInfo&&r.extraInfo.length>1024)throw new fe(q.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")})(t),new Mue(t)}};var IW=f(ra.Object.getOwnPropertySymbols),jue=Jt,Vue=qm.indexOf,Bue=Ud,sk=ke([].indexOf),NW=!!sk&&1/sk([1],1,-0)<0;jue({target:"Array",proto:!0,forced:NW||!Bue("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return NW?sk(this,e,t)||0:Vue(this,e,t)}});var Fue=ia("Array","indexOf"),Gue=D,Hue=Fue,ok=Array.prototype,Wue=function(e){var t=e.indexOf;return e===ok||Gue(ok,e)&&t===ok.indexOf?Hue:t},xW=f(Wue);function zue(e,t){if(e==null)return{};var r,a,o=(function(h,m){if(h==null)return{};var g={};for(var y in h)if({}.hasOwnProperty.call(h,y)){if(xW(m).call(m,y)!==-1)continue;g[y]=h[y]}return g})(e,t);if(IW){var u=IW(e);for(a=0;a<u.length;a++)r=u[a],xW(t).call(t,r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}let DW=class{get localCapabilities(){return Pn(this._localCapabilities)}get rtpCapabilities(){return Pn(this._rtpCapabilities)}get candidates(){return Pn(this._candidates)}get iceParameters(){return Pn(this._iceParameters)}get dtlsParameters(){return Pn(this._dtlsParameters)}constructor(e){H(this,"sessionDesc",void 0),H(this,"_localCapabilities",void 0),H(this,"_rtpCapabilities",void 0),H(this,"_candidates",void 0),H(this,"_iceParameters",void 0),H(this,"_dtlsParameters",void 0),H(this,"setup",void 0),H(this,"currentMidIndex",void 0),H(this,"cname","o/i14u9pJrxRKAsu"),H(this,"firefoxSsrcMidMap",new Map),e=Pn(e);const{remoteIceParameters:t,remoteDtlsParameters:r,candidates:a,remoteRTPCapabilities:o,localCapabilities:u,direction:h,setup:m,videoCodec:g,audioCodec:y}=e;let E;this.setup=m,E=h===Ji.RECEIVE_ONLY?Ca(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Ca(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=o,this._candidates=a,this._iceParameters=t,this._dtlsParameters=r,this._localCapabilities=u;const A=h===Ji.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,O=h===Ji.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,N=h===Ji.RECEIVE_ONLY?o.send.videoCodecs:sS(Xe.VIDEO,A,O,g),B=h===Ji.RECEIVE_ONLY?o.send.audioCodecs:sS(Xe.AUDIO,A,O,y);for(const U of E.mediaDescriptions)U.attributes.iceUfrag=t.iceUfrag,U.attributes.icePwd=t.icePwd,U.attributes.fingerprints=r.fingerprints,U.attributes.candidates=a,U.attributes.setup=this.setup,U.media.mediaType==="application"&&(U.attributes.sctpPort="5000"),U.media.mediaType==="video"&&(U.media.fmts=N.map((V=>V.payloadType.toString(10))),U.attributes.payloads=N,U.attributes.extmaps=A.videoExtensions),U.media.mediaType==="audio"&&(U.media.fmts=B.map((V=>V.payloadType.toString(10))),U.attributes.payloads=B,U.attributes.extmaps=A.audioExtensions,nv(U));this.sessionDesc=E,this.currentMidIndex=E.mediaDescriptions.length-1}toString(){return Dh(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every((t=>this.hasMid(t))):this.sessionDesc.mediaDescriptions.some((t=>t.attributes.mid===e))}send(e,t,r,a,o){r=r.replace(/ /g,"-");const{ssrcs:u,ssrcGroups:h}=aS(t,this.cname,X("SYNC_GROUP")?r:void 0),m=this.findPreloadMediaDesc(u);if(m){if(Vn()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,m.attributes.mid),o&&(o.twcc||o.remb)){const g=this.sessionDesc.mediaDescriptions.indexOf(m);return this.sessionDesc.mediaDescriptions[g]=this.mungSendMediaDesc(m,o),{mid:m.attributes.mid,needExchangeSDP:!0}}return{mid:m.attributes.mid,needExchangeSDP:!1}}{const g=this.findAvailableMediaIndex(e,u,a);let y;return g===-1?(y=this.createOrRecycleSendMedia(e,u,h,"sendonly",a,o),this.updateBundleMids()):(y=Pn(this.sessionDesc.mediaDescriptions[g]),y.attributes.direction="sendonly",y.attributes.ssrcs=u,y.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[g]=this.mungSendMediaDesc(y,o)),Vn()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,y.attributes.mid),{needExchangeSDP:!0,mid:y.attributes.mid}}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter((r=>r.attributes.mid&&e.indexOf(r.attributes.mid)!==-1));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach((r=>{r.attributes.ssrcs=[]})),this.updateBundleMids()}receive(e,t,r){const a=[];return e.forEach((o=>{const u=o._mediaStreamTrack.kind,h=this.findAvailableRecvMediaIndex(u);let m,g=!1;h===-1?(g=!0,m=this.createOrRecycleRecvMedia(o,[],"recvonly",t,r),this.updateBundleMids()):(m=Pn(this.sessionDesc.mediaDescriptions[h]),m.attributes.direction="recvonly"),a.push({mid:m.attributes.mid,needCreateTransceiver:g})})),a}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter((r=>e.indexOf(r.attributes.mid)!==-1));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach((r=>{r.media.port="0",r.attributes.direction="inactive"})),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:t,protocol:r,address:a,port:o,type:u,relatedAddress:h,relatedPort:m,priority:g}=new RTCIceCandidate(e),y={foundation:t??"",componentId:"1",transport:r??"",priority:g?g+"":"",connectionAddress:a??"",port:o?o+"":"",type:u?u+"":"",relAddr:h??"",relPort:m?m+"":"",extension:{}};this.candidates.some((E=>E.priority===y.priority&&E.connectionAddress===y.connectionAddress&&E.port===y.port))||(this._candidates.push(y),this.sessionDesc.mediaDescriptions.forEach((E=>{E.attributes.candidates=this.candidates})))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,r,a,o){const u=e._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,m=sS(u,h,this.localCapabilities.send,u===Xe.AUDIO?o:a),g=u===Xe.VIDEO?h.videoExtensions:h.audioExtensions,y="".concat(++this.currentMidIndex);let E={media:{mediaType:u,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map((O=>O.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:g,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(y)}};E=this.mungRecvMediaDsec(E,e);const A=this.findFirstClosedMedia(u);if(A){const O=this.sessionDesc.mediaDescriptions.indexOf(A);this.sessionDesc.mediaDescriptions[O]=E}else this.sessionDesc.mediaDescriptions.push(E);return E}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter((r=>je(e).call(e,r.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((r=>{r.attributes.direction="inactive"}))}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter((r=>je(e).call(e,r.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((r=>{r.attributes.direction="recvonly"}))}findAvailableMediaIndex(e,t,r){return this.sessionDesc.mediaDescriptions.findIndex((a=>{const o=a.media.mediaType===e&&a.media.port!=="0"&&(a.attributes.direction==="sendonly"||a.attributes.direction==="sendrecv")&&a.attributes.ssrcs.length===0;if(Vn()){if(o){const u=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(u||a.attributes.mid!=="0"&&a.attributes.mid!=="1")||!(!u||u!==a.attributes.mid)}return!1}return o&&a.attributes.mid===r}))}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex((t=>{const r=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&r}))}predictReceivingMids(e){const t=[];for(let r=0;r<e;r++)t.push((this.currentMidIndex+r+1).toString(10));return t}restartICE(e){e=Pn(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))}createOrRecycleSendMedia(e,t,r,a,o,u){const h=this.rtpCapabilities.send,m=e===Xe.VIDEO?h.videoCodecs:h.audioCodecs,g=e===Xe.VIDEO?h.videoExtensions:h.audioExtensions;Vn()&&(o="".concat(++this.currentMidIndex));let y={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map((A=>A.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:g,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:r,rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:a,rtcpMux:!0,rtcpRsize:!0,mid:o}};y=this.mungSendMediaDesc(y,u);const E=this.findFirstClosedMedia(e);if(E){const A=this.sessionDesc.mediaDescriptions.indexOf(E);this.sessionDesc.mediaDescriptions[A]=y}else this.sessionDesc.mediaDescriptions.push(y);return y}mungRecvMediaDsec(e,t,r){const a=Pn(e);return sP(a),tv(a,t),oP(a,t),R8(a),lA(a,r,this.localCapabilities.send),a}mungSendMediaDesc(e,t){const r=Pn(e);return lA(r,t,this.localCapabilities.recv),nv(r),r}updateRecvMedia(e,t){const r=this.sessionDesc.mediaDescriptions.findIndex((a=>a.attributes.mid===e));if(r!==-1){const a=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],t);this.sessionDesc.mediaDescriptions[r]=a}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((e=>e.media.port!=="0")).map((e=>e.attributes.mid))}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find((t=>{var r;return((r=t.attributes)===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId)===e[0].ssrcId}))}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find((t=>Vn()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0"))}};const Kue=["sdp"];var Rn;function PW(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),r.push.apply(r,a)}return r}function $h(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?PW(Object(r),!0).forEach((function(a){H(e,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):PW(Object(r)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))}))}return e}let kW=(Rn=class vv extends o8{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,r;return(t=(r=this.peerConnection.getReceivers()[0])===null||r===void 0||(r=r.transport)===null||r===void 0?void 0:r.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,r,a){super(t,r),H(this,"direction",void 0),H(this,"name",void 0),H(this,"store",void 0),H(this,"spec",void 0),H(this,"peerConnection",void 0),H(this,"initialOffer",void 0),H(this,"transport",void 0),H(this,"statsFilter",void 0),H(this,"localCandidateCount",0),H(this,"_isInRestartIce",!1),H(this,"mutex",void 0),H(this,"onLocalCandidate",void 0),H(this,"remoteSDP",void 0),H(this,"pendingCandidates",[]),H(this,"localCapabilities",void 0),H(this,"isReady",!1),H(this,"restartCnt",0),H(this,"curTurnServerIndex",0),this.store=r,this.spec=t,this.mutex=new oi("P2PConnection-mutex",r.clientId),this.peerConnection=new RTCPeerConnection(vv.resolvePCConfiguration(t,r.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=a??Ji.SEND_ONLY,this.name=this.direction===Ji.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=mD(this.peerConnection,X("STATS_UPDATE_INTERVAL"),void 0,Vn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{const r=await A8();if(this.localCapabilities=uA(r),t){const{sdp:a}=t,o=zue(t,Kue),u=(function(){const E={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},A=iS(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),O={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},N={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},B={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(xo(A,E,"videoExtensions",O,N,B),xo(A,E,"videoCodecs",O,N,B),xo(A,E,"audioExtensions",O,N,B),xo(A,E,"audioCodecs",O,N,B),X("RAISE_H264_BASELINE_PRIORITY")){const U=B.videoCodecs.findIndex((V=>V.rtpMap&&V.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&V.fmtp&&V.fmtp.parameters["profile-level-id"]==="42001f"));if(U!==-1){const V=B.videoCodecs.findIndex((K=>K.rtpMap&&K.rtpMap.encodingName.toLocaleLowerCase()==="h264"));if(V<U){k.debug("raising H264 baseline profile priority");const K=B.videoCodecs[U];B.videoCodecs.splice(U,1),B.videoCodecs.splice(V,0,K)}V!==-1&&X("FILTER_SEND_H264_BASELINE")&&(O.videoCodecs=O.videoCodecs.filter((K=>!(K.rtpMap&&K.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&K.fmtp&&K.fmtp.parameters["profile-level-id"]!=="42001f"))))}}return{send:O,recv:N,sendrecv:B}})({},{},a);this.remoteSDP=new DW({remoteIceParameters:o.iceParameters,remoteDtlsParameters:o.dtlsParameters,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const h=await this.peerConnection.createAnswer();if(!h.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const m=jh(h.sdp);await this.peerConnection.setLocalDescription(h);const g=await O8({},{},h.sdp);this.localCapabilities=uA(g);const y=this.peerConnection.getTransceivers()[0];return y!=null&&y.receiver&&y.receiver.transport&&this.tryBindTransportEvents(y.receiver.transport),$h($h({},m),{},{sdp:h.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const a=await this.peerConnection.createOffer();if(!a.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const o=jh(a.sdp);return this.initialOffer=a,$h($h({},o),{},{sdp:a.sdp})}}catch(r){throw new ve(q.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:r,iceParameters:a,dtlsParameters:o}=t,u=await O8({},{},r);this.remoteSDP=new DW({remoteIceParameters:a,remoteDtlsParameters:o,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const h=this.peerConnection.getTransceivers()[0];h!=null&&h.sender&&h.sender.transport&&this.tryBindTransportEvents(h.sender.transport)}catch(r){throw new ve(q.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach((r=>{this.peerConnection.addIceCandidate(r)})),this.pendingCandidates=[])}catch(r){throw new ve(q.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(r.toString()))}}send(t,r,a){var o=this;return Bs((function*(){const u=yield jt(o.mutex.lock("From P2PConnection.send"));try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=o.remoteSDP.receive(t,r,a);t.forEach(((V,K)=>{if(m[K].needCreateTransceiver){const z=o.peerConnection.addTransceiver(V._mediaStreamTrack,{direction:"sendonly"});h.push(z),V._updateRtpTransceiver(z)}else{const z=o.peerConnection.getTransceivers().find((J=>J.mid===m[K].mid));if(!z)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(m[K].mid));h.push(z),V._updateRtpTransceiver(z)}})),Vn()&&X("SIMULCAST")===!0&&(yield jt(o.applySimulcastForFirefox(h,t)));const g=m.map((V=>V.mid)),y=yield jt(o.peerConnection.createOffer()),E=o.mungSendOfferSDP(y.sdp,t,g),A=Ca(E),O=g.map((V=>{const K=A.mediaDescriptions.find((z=>z.attributes.mid===V));if(!K)throw new Error("Cannot extract ssrc from mediaDescription.");return b8(K,X("USE_PUB_RTX"))})),N=h.map(((V,K)=>{const z=g[K];return{localSSRC:O[K],id:z}}));yield jt(o.peerConnection.setLocalDescription({type:"offer",sdp:E}));try{yield N}catch(V){const K=o.remoteSDP.toString();throw yield jt(o.peerConnection.setLocalDescription({type:"offer",sdp:E})),yield jt(o.peerConnection.setRemoteDescription({type:"answer",sdp:K})),yield jt(o.stopSending(g,!0)),V}yield jt(o.applySimulcastEncodings(h,t)),yield jt(o.applySendEncodings(h,t));const B=o.remoteSDP.toString(),U=o.logSDPExchange(E,"offer","local","send");return U?.(B),yield jt(o.setRemoteDescription({type:"answer",sdp:B})),h.map(((V,K)=>{const z=g[K];return{localSSRC:O[K],id:z}}))}catch(h){throw h instanceof ve?h:new ve(q.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}}))()}async stopSending(t,r){const a=r?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const o=this.peerConnection.getTransceivers().filter((g=>t.indexOf(g.mid)!==-1));if(o.length!==t.length)throw new Error("Transceivers' length (".concat(o.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));o.map((g=>{var y;g.direction="inactive",(y=g.stop)===null||y===void 0||y.call(g)}));const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(t);const m=this.remoteSDP.toString();h?.(m),await this.setRemoteDescription({type:"answer",sdp:m})}catch(o){throw new ve(q.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(o.toString()))}finally{a&&a()}}async receive(t,r,a,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(t,r,a,o);if(h){const g=this.remoteSDP.toString(),y=this.logSDPExchange(g,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:g});const E=await this.peerConnection.createAnswer(),A=this.mungReceiveAnswerSDP(E.sdp,u,t);y?.(A||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:A}),k.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else k.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const m=this.peerConnection.getTransceivers().find((g=>g.mid===u));if(!m||m.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,mid:m.mid,transceiver:m}}catch(u){throw new ve(q.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async mockReceive(t,r,a,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(t,r,a,o);if(h){const m=this.remoteSDP.toString(),g=this.logSDPExchange(m,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:m});const y=await this.peerConnection.createAnswer(),E=this.mungReceiveAnswerSDP(y.sdp,u,t);g?.(E||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:E}),k.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else k.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(u){throw new ve(q.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const r=this.remoteSDP.toString(),a=this.logSDPExchange(r,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:r});const o=await this.peerConnection.createAnswer();a?.(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(r){throw new ve(q.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===Dp.Auto&&(this.store.p2pTransport=Dp.SdRtn,Vt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(vv.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Vt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(vv.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;const r=await this.peerConnection.createOffer({iceRestart:!0});if(!r.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:a}=jh(r.sdp);return this.store.descriptionStart(),this.direction===Ji.SEND_ONLY&&await this.peerConnection.setLocalDescription(r),a}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===Ji.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const r=await this.peerConnection.createAnswer();if(!r.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:a}=jh(r.sdp);return await this.peerConnection.setLocalDescription(r),a}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(r){throw new ve(q.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const a=await this.peerConnection.createOffer(),o=this.mungSendOfferSDP(a.sdp,[r],[t]);this.remoteSDP.updateRecvMedia(t,r);const u=this.remoteSDP.toString(),h=this.logSDPExchange(o,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),h?.(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(a){throw new ve(q.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(t,r){const a=this.peerConnection.getTransceivers().filter((o=>o.mid===t));a.length===1&&(this.isVP8Simulcast(r)?Vn()||await this.applySimulcastEncodings(a,[r]):await this.applySendEncodings(a,[r]))}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){const a=this.peerConnection.getTransceivers().find((o=>o.mid===r));a&&await a.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const r=t[0].transport.iceTransport,{local:a,remote:o}=r.getSelectedCandidatePair();return{local:$h($h({},xl),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port}),remote:$h($h({},xl),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,r;je(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var r;t.candidate.candidate&&((r=this.onLocalCandidate)===null||r===void 0||r.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,r){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const o={iceServers:[]};var u;return t.iceServers?o.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(H0(t.turnServer.servers)?o.iceServers=t.turnServer.servers:(o.iceServers&&o.iceServers.push(...vv.turnServerConfigToIceServers(t.turnServer.servers,r,a)),X("USE_TURN_SERVER_OF_GATEWAY")&&o.iceServers&&t.turnServer.serversFromGateway&&o.iceServers.push(...vv.turnServerConfigToIceServers(t.turnServer.serversFromGateway,r,a)),je(u=[Dp.Relay,Dp.SdRtn]).call(u,r)&&(o.iceTransportPolicy="relay"),X("FORCE_TURN_TCP")?o.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((h=>{h.forceturn&&(o.iceTransportPolicy="relay")})))),X("ENABLE_ENCODED_TRANSFORM")&&Vt().supportWebRTCEncodedTransform&&(o.encodedInsertableStreams=!0),k.debug("P2PConnection p2pTransport is ".concat(r)),o}static turnServerConfigToIceServers(t,r){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const o=[],u=t.filter((m=>m.tcpport));k.debug("P2PConnection turnServers is ".concat(u,", current index is ").concat(a));const h=u.length>a?u[a]:u[0];switch(r){case Dp.SdRtn:const m=t.filter((y=>{var E;return je(E=y.username).call(E,"glb:")&&y.turnServerURL==y.turnServerURL})),g=m.length>a?m[a]:m[0];g&&(o.push({username:g.username,credential:g.password,credentialType:"password",urls:"turn:".concat(Mh(g.turnServerURL),":").concat(g.tcpport,"?transport=udp")}),o.push({username:g.username,credential:g.password,credentialType:"password",urls:"turns:".concat(Mh(g.turnServerURL),":").concat(g.tcpport,"?transport=tcp")}));break;case Dp.Relay:h&&(o.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),o.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Mh(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;default:h&&(o.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),o.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Mh(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}),o.push({username:h.username,credential:h.password,credentialType:"password",urls:"stun:".concat(h.turnServerURL,":").concat(h.tcpport)}))}return o}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var a;t!=null&&t.state&&((a=this.onDTLSTransportStateChange)===null||a===void 0||a.call(this,t.state))},t.onerror=a=>{var o;(o=this.onDTLSTransportError)===null||o===void 0||o.call(this,"error"in a?a.error:a)};const r=t.iceTransport;r&&(r.onstatechange=()=>{const a=t?.iceTransport.state;var o;a&&((o=this.onICETransportStateChange)===null||o===void 0||o.call(this,a))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){const{local:a,remote:o}=r.getSelectedCandidatePair()||{};if(a&&o){const u=a.address+":"+a.port,h=o.address+":"+o.port;k.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Bp(u)),", remote ").concat(JSON.stringify(Bp(h))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,r){var a;if(r||(r=this.peerConnection.getSenders().find((E=>E.track===t._mediaStreamTrack))),!r)return k.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return k.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Vt().supportSetRtpSenderParameters)return k.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const o={},u={};switch(t._optimizationMode){case"motion":o.degradationPreference="maintain-framerate";break;case"detail":o.degradationPreference="maintain-resolution";break;default:o.degradationPreference="balanced"}if(t._encoderConfig){var h;const{bitrateMax:E,frameRate:A,scaleResolutionDownBy:O}=t._encoderConfig;E&&(u.maxBitrate=1e3*E),je(h=t._hints).call(h,un.LOW_STREAM)&&(A&&(u.maxFramerate=Ja(A)),O&&O>=1&&(u.scaleResolutionDownBy=O))}if(X("DSCP_TYPE")&&ju()){var m;const E=X("DSCP_TYPE");je(m=["very-low","low","medium","high"]).call(m,E)&&(u.networkPriority=E)}const g=r.getParameters(),y=(a=g.encodings)===null||a===void 0?void 0:a[0];Vn()&&!y&&(o.encodings=[u]),y&&Object.assign(y,u),Object.assign(g,o),k.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(g.encodings))),await r.setParameters(g)}async applySendEncodings(t,r){try{if(!Vt().supportSetRtpSenderParameters||t.length!==r.length)return;for(let a=0;a<t.length;a++){const o=t[a],u=r[a];u instanceof wn&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,o.sender)}}catch{k.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,r,a){const o=Ca(t);return r.forEach(((u,h)=>{const m=a[h],g=o.mediaDescriptions.find((y=>y.attributes.mid===m));g&&(tv(g,u),C8(g,u,this.store.codec))})),Dh(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,a)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,t,r,a)},this.statsFilter.onSelectedLocalCandidateChanged=(t,r)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,t,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,r)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,t,r)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var r;(r=this.onFirstVideoDecodedTimeout)===null||r===void 0||r.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,r){if(t.length===r.length)for(let g=0;g<t.length;g++){var a,o,u,h,m;const y=t[g],E=r[g];if(E instanceof wn&&!je(a=E._hints).call(a,un.LOW_STREAM)&&(o=E._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((u=E._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=E._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=E._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const A={},O={high:1e3*(E._encoderConfig.bitrateMax-50),medium:5e4};A.encodings=[{rid:"m",active:!0,maxBitrate:O.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:O.high}];const N=y.sender.getParameters();await y.sender.setParameters(Object.assign(N,A))}}}async applySimulcastEncodings(t,r){if(!Vn()&&t.length===r.length)for(let a=0;a<t.length;a++){const o=r[a];if(o instanceof wn&&this.isVP8Simulcast(o)){const u=t[a],h={},m={high:1e3*(o._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const g=u.sender.getParameters();await u.sender.setParameters(Object.assign(g,h))}}}isVP8Simulcast(t){var r,a,o,u,h;return!!(t instanceof wn&&X("SIMULCAST")&&this.store.codec==="vp8"&&!je(r=t._hints).call(r,un.LOW_STREAM)&&(a=t._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((o=t._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(u=t._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=t._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(t,r,a,o){if(X("SDP_LOGGING"))return k.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(r," SDP during P2PConnection.").concat(o,`
`),t),r==="offer"?u=>{this.logSDPExchange(u,"answer",a==="local"?"remote":"local",o)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const r=this.peerConnection.getTransceivers().filter((h=>h.mid&&t.indexOf(h.mid)!==-1));if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map((h=>{h.direction="inactive"}));const a=await this.peerConnection.createOffer(),o=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.muteRemote(t);const u=this.remoteSDP.toString();o?.(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(r){throw new ve(q.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const r=this.peerConnection.getTransceivers().filter((h=>h.mid&&t.indexOf(h.mid)!==-1));if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map((async h=>{h.direction="sendonly"}));const a=await this.peerConnection.createOffer(),o=this.logSDPExchange(a.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.unmuteRemote(t);const u=this.remoteSDP.toString();o?.(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(r){throw new ve(q.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r.toString()))}}async getRemoteSSRC(t,r){var a;if(r=r??((a=this.currentRemoteDescription)===null||a===void 0?void 0:a.sdp)){var o;const u=(o=Ca(r).mediaDescriptions.find((h=>h.attributes.mid===t)))===null||o===void 0?void 0:o.attributes.ssrcs;return u?.[0].ssrcId}}async setRemoteDescription(t){var r;await this.peerConnection.setRemoteDescription(t),je(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,r,a){const o=Ca(t),u=o.mediaDescriptions.find((h=>h.attributes.mid===r));return u&&a===Xe.AUDIO&&u.media.mediaType==="audio"&&nv(u),Dh(o)}},Qe(Rn.prototype,"establish",[Mo],Object.getOwnPropertyDescriptor(Rn.prototype,"establish"),Rn.prototype),Qe(Rn.prototype,"connect",[Mo],Object.getOwnPropertyDescriptor(Rn.prototype,"connect"),Rn.prototype),Qe(Rn.prototype,"receive",[Mo],Object.getOwnPropertyDescriptor(Rn.prototype,"receive"),Rn.prototype),Qe(Rn.prototype,"mockReceive",[Mo],Object.getOwnPropertyDescriptor(Rn.prototype,"mockReceive"),Rn.prototype),Qe(Rn.prototype,"stopReceiving",[Mo],Object.getOwnPropertyDescriptor(Rn.prototype,"stopReceiving"),Rn.prototype),Qe(Rn.prototype,"restartICE",[Mo],Object.getOwnPropertyDescriptor(Rn.prototype,"restartICE"),Rn.prototype),Qe(Rn.prototype,"close",[Mo],Object.getOwnPropertyDescriptor(Rn.prototype,"close"),Rn.prototype),Qe(Rn.prototype,"updateEncoderConfig",[Mo],Object.getOwnPropertyDescriptor(Rn.prototype,"updateEncoderConfig"),Rn.prototype),Qe(Rn.prototype,"updateSendParameters",[Mo],Object.getOwnPropertyDescriptor(Rn.prototype,"updateSendParameters"),Rn.prototype),Qe(Rn.prototype,"replaceTrack",[Mo],Object.getOwnPropertyDescriptor(Rn.prototype,"replaceTrack"),Rn.prototype),Qe(Rn.prototype,"muteLocal",[Mo],Object.getOwnPropertyDescriptor(Rn.prototype,"muteLocal"),Rn.prototype),Qe(Rn.prototype,"unmuteLocal",[Mo],Object.getOwnPropertyDescriptor(Rn.prototype,"unmuteLocal"),Rn.prototype),Rn);function Mo(e,t,r){const a=e[t];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const o=this.mutex,u=await o.lock("From P2PConnection.".concat(t));try{for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];return await a.apply(this,m)}finally{u()}},r}let Kc=(function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e})({});var LW,MW,UW,jW,VW,BW,FW,GW,HW,WW,zW,kn;function KW(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),r.push.apply(r,a)}return r}function YA(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?KW(Object(r),!0).forEach((function(a){H(e,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):KW(Object(r)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))}))}return e}let Yue=(LW=Yc(Kc.SEND_ONLY),MW=Yc(Kc.SEND_ONLY),UW=Yc(),jW=Yc(Kc.RECEIVE_ONLY),VW=Yc(Kc.RECEIVE_ONLY),BW=Yc(Kc.RECEIVE_ONLY),FW=Yc(Kc.RECEIVE_ONLY),GW=Yc(Kc.RECEIVE_ONLY),HW=Yc(Kc.RECEIVE_ONLY),WW=Yc(),zW=Yc(Kc.RECEIVE_ONLY),kn=class extends Mn{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(at.StateChange,t,this._state)}constructor(e,t){super(),H(this,"isPlanB",!1),H(this,"store",void 0),H(this,"statsUploader",void 0),H(this,"sendConnection",void 0),H(this,"recvConnection",void 0),H(this,"localTrackMap",new Map),H(this,"remoteUserMap",new Map),H(this,"localDataChannels",[]),H(this,"pendingLocalTracks",[]),H(this,"pendingRemoteTracks",[]),H(this,"statsCollector",void 0),H(this,"dtlsFailedCount",0),H(this,"sendMutex",void 0),H(this,"recvMutex",void 0),H(this,"_state",Zt.Disconnected),H(this,"_restartStates",["disconnected","failed"]),H(this,"reconnectInterval",void 0),H(this,"uploadUnplinkStarted",!1),H(this,"uploadDownlinkStarted",!1),H(this,"uplinkStateUploadInterval",void 0),H(this,"downlinkStatsUploadInterval",void 0),H(this,"handleMuteLocalTrack",(async(r,a,o)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Zt.Connected)return void o(new ve(q.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const g=this.filterTobeMutedTracks(r);if(g.length===0)return void a();const y=g.find((N=>N[0]==="videoLowTrack"));y&&y[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(g.map((N=>{let[,{id:B}]=N;return B})));let E=!1;var h,m;r.trackMediaType==="video"?E=!((h=this.localTrackMap.get(Ie.LocalAudioTrack))===null||h===void 0||!h.track._muted):E=((m=this.localTrackMap.get(Ie.LocalVideoTrack))===null||m===void 0?void 0:m.id)===void 0;const A=this.createMuteMessage(g);await hn(this,at.RequestMuteLocal,A);const O=r.trackMediaType==="video"?Lh.MUTE_LOCAL_VIDEO:Lh.MUTE_LOCAL_AUDIO;await hn(this,at.RequestP2PMuteLocal,{action:O,message:A,isMuteAll:E}),a()}catch(g){o(g)}finally{u()}})),H(this,"handleUnmuteLocalTrack",(async(r,a,o)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Zt.Connected)return void o(new ve(q.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const h=this.filterTobeUnmutedTracks(r);if(h.length===0)return void a();await this.sendConnection.unmuteLocal(h.map((y=>{let[,{id:E}]=y;return E})));const m=this.createUnmuteMessage(h),g=r.trackMediaType==="video"?Lh.UNMUTE_LOCAL_VIDEO:Lh.UNMUTE_LOCAL_AUDIO;await hn(this,at.RequestP2PMuteLocal,{action:g,message:m}),a()}catch(h){o(h)}finally{u()}})),H(this,"handleUpdateVideoEncoder",(async(r,a,o,u)=>{let h;typeof u=="boolean"&&u||(h=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const g=this.localTrackMap.get(Ie.LocalVideoTrack);if(!this.sendConnection||!g||g.track!==r||this.state!==Zt.Connected)return void a();const{id:y,track:E}=g;y&&(await this.sendConnection.updateSendParameters(y,E),await this.sendConnection.updateEncoderConfig(y,E),this.emit(at.UpdateVideoEncoder,E)),a()}catch(g){o(g)}finally{var m;(m=h)===null||m===void 0||m()}})),H(this,"handleUpdateVideoSendParameters",(async(r,a,o)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(Ie.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==r||this.state!==Zt.Connected)return void a();const{id:m,track:g}=h;m&&await this.sendConnection.updateSendParameters(m,g),a()}catch(h){o(h)}finally{u()}})),H(this,"handleReplaceTrack",(async(r,a,o,u)=>{let h;k.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(r.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var m;const y=Array.from(this.localTrackMap.entries()).find((E=>{let[,{track:A}]=E;return r===A}));if(!this.sendConnection||!y||y[1].id===void 0||this.state!==Zt.Connected)return void a();if(await((m=this.sendConnection)===null||m===void 0?void 0:m.replaceTrack(r,y[1].id)),y[0]===Ie.LocalVideoTrack&&Vt().supportDualStreamEncoding){const E=this.localTrackMap.get(Ie.LocalVideoLowTrack);if(E){const A=r._mediaStreamTrack.clone();E.track._originMediaStreamTrack.stop(),E.track._mediaStreamTrack=A,E.track._originMediaStreamTrack=A,await new Fe(((O,N)=>{this.handleReplaceTrack(E.track,O,N,!0)}))}}a()}catch(y){o(y)}finally{var g;(g=h)===null||g===void 0||g()}})),H(this,"handleGetLocalVideoStats",(r=>{r(this.statsCollector.getLocalVideoTrackStats())})),H(this,"handleGetLocalAudioStats",(r=>{r(this.statsCollector.getLocalAudioTrackStats())})),H(this,"handleGetRemoteVideoStats",(r=>this.statsCollector.getRemoteVideoTrackStats(r.uid)[r.uid])),H(this,"handleGetRemoteAudioStats",(r=>this.statsCollector.getRemoteAudioTrackStats(r.uid)[r.uid])),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new lG(e),this.bindStatsUploaderEvents(),this.sendMutex=new oi("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new oi("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval((()=>{[this.sendConnection,this.recvConnection].forEach((r=>{r&&(r.iceConnectionState!=="disconnected"&&r.iceConnectionState!=="failed"||this.handleDisconnect(r.direction))}))}),X("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new ve(q.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new ve(q.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let r;try{if(t){this.recvConnection&&(k.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),r=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new kW(e,this.store,Ji.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const a=await this.recvConnection.establish(t);return{iceParameters:a.iceParameters,dtlsParameters:a.dtlsParameters,sdp:a.sdp}}{this.state=Zt.New,this.sendConnection&&(k.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),r=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new kW(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const a=await this.sendConnection.establish();return{iceParameters:a.iceParameters,dtlsParameters:a.dtlsParameters,sdp:a.sdp}}}finally{r&&r()}}async p2pConnect(e){if(!this.sendConnection)throw new ve(q.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Zt.Connected}async addRemoteCandidate(e,t){if(t===Ji.RECEIVE_ONLY){if(!this.sendConnection)throw new ve(q.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new ve(q.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,r){var a=this;return Bs((function*(){const o=yield jt(a.sendMutex.lock("From P2PChannel.publish"));try{if(!a.sendConnection||a.state!==Zt.Connected){a.throwIfTrackTypeNotMatch(e);const y=e.filter((E=>a.pendingLocalTracks.indexOf(E)===-1));return void(a.pendingLocalTracks=a.pendingLocalTracks.concat(y))}a.store.pubId=a.store.pubId+1,di.markPublishStart(a.store.clientId,a.store.pubId);const u=a.filterTobePublishedTracks(e,t,r);if(u.length===0)return void(yield jt(a.tryToUnmuteAudio(e)));u.forEach((y=>{let{track:E,type:A}=y;const O=Date.now();a.store.publish(E.getTrackId(),A===Ie.LocalAudioTrack?"audio":"video",O)})),a.bindLocalTrackEvents(u);const h=yield jt(a.sendConnection.send(u.map((y=>{let{track:E}=y;return E})),a.store.codec,a.store.audioCodec)),m=(yield jt(h.next())).value,g=a.createGatewayPublishMessage(u,m);try{yield g}catch(y){throw h.throw(y),y?.code===q.WS_ABORT&&u.forEach((E=>{let{track:A}=E;a.pendingLocalTracks.indexOf(A)===-1&&a.pendingLocalTracks.push(A)})),a.unbindLocalTrackEvents(u),y}yield jt(h.next()),u.forEach((y=>{let{type:E}=y;a.statsCollector.addLocalStats(E)})),a.statsUploader.startUploadOutboundStats(),a.assignLocalTracks(u,m),u.forEach((y=>{let{track:E,type:A}=y;const O=Date.now();a.store.publish(E.getTrackId(),A===Ie.LocalAudioTrack?"audio":"video",void 0,O)})),a.startUploadUplinkState()}finally{o()}}))()}async unpublish(e){if(!this.sendConnection||this.state!==Zt.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter((o=>!je(e).call(e,o))));const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const r=t.find((o=>o[0]==="videoLowTrack"));r&&r[1].track.close();const a=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map((o=>{let[,{id:u}]=o;return u}))),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map((o=>{let[u,{track:h}]=o;return{type:u,track:h}}))),t.forEach((o=>{let[u]=o;this.statsCollector.removeLocalStats(u)})),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Zt.Connected)return r&&r[1].track.close(),a;e.forEach((o=>{const u=this.pendingLocalTracks.indexOf(o);u!==-1&&this.pendingLocalTracks.splice(u,1)}))}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const t=[],r=[];Array.from(this.localTrackMap.entries()).forEach((a=>{let[o,{track:u,ssrcs:h}]=a;const m={stream_type:Vce(u,o),ssrcs:h};u._muted||!u._enabled?t.push(m):r.push(m)})),t.length>0&&t.forEach((a=>{hn(this,at.RequestMuteLocal,[a])})),r.length>0&&r.forEach((a=>{hn(this,at.RequestUnmuteLocal,[a])}))};e(),this.uplinkStateUploadInterval=window.setInterval((()=>{e()}),3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return Bs((function*(){throw new ve(q.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")}))()}async republish(){this.pendingLocalTracks.length>0&&(k.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ei(this,at.RequestRePublish,this.pendingLocalTracks),this.emit(at.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new ve(q.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,r,a){var o;if(!this.recvConnection)throw new ve(q.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((o=this.remoteUserMap.get(e))!==null&&o!==void 0&&o.has(t))return;const{track:u,mid:h,transceiver:m}=await this.recvConnection.receive(t,[{ssrcId:r}],String(e.uid),a);t===Xe.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(u):(e._audioTrack=new Y_(u,e.uid,e._uintid,this.store),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),m&&e._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=r,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(u):(e._videoTrack=new K_(u,e.uid,e._uintid,this.store),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),m&&e._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._videoTrack));const g=this.remoteUserMap.get(e);g?g.set(t,h):this.remoteUserMap.set(e,new Map([[t,h]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const y=this.pendingRemoteTracks.findIndex((E=>{let{user:A,kind:O}=E;return A.uid===e.uid&&t===O}));y!==-1&&(this.pendingRemoteTracks.splice(y,1),this.emit(at.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,r,a){if(!this.recvConnection)throw new ve(q.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:r}],String(e.uid),a)}async unsubscribe(e,t,r){const a=this.pendingRemoteTracks.filter((u=>{let{user:h,kind:m}=u;return t!==void 0?h.uid===e.uid&&t===m:h.uid===e.uid}));if(a.forEach((u=>{const h=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(h,1)})),this.recvConnection||r||a.forEach((u=>{let{kind:h}=u;var m;if(h===Xe.AUDIO)(m=e._audioTrack)===null||m===void 0||m._destroy(),e._audioTrack=void 0;else if(h===Xe.VIDEO){var g;(g=e._videoTrack)===null||g===void 0||g._destroy(),e._videoTrack=void 0}})),!this.recvConnection)return;const o=this.filterTobeUnSubscribedTracks(e,t);o.length!==0&&(await this.recvConnection.stopReceiving(o.map((u=>{let[,{id:h}]=u;return h}))),this.withdrawRemoteTracks(o),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),o.forEach((u=>{let[h,{kind:m}]=u;var g,y;if(m===Xe.VIDEO&&h._videoSSRC&&((g=this.recvConnection)===null||g===void 0||g.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),m===Xe.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),r||((y=h._videoTrack)===null||y===void 0||y._destroy(),h._videoTrack=void 0);else if(m===Xe.AUDIO){var E;this.unbindRemoteTrackEvents(h._audioTrack),!r&&((E=h._audioTrack)===null||E===void 0||E._destroy(),h._audioTrack=void 0)}})),o.forEach((u=>{let[,{kind:h}]=u;hn(this,at.RequestP2PMuteRemote,h)})))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach((t=>{let[,r]=t;[Xe.VIDEO,Xe.AUDIO].forEach((a=>{r.has(a)?hn(this,at.RequestP2PUnmuteRemote,a):hn(this,at.RequestP2PMuteRemote,a)}))}));e(),this.downlinkStatsUploadInterval=window.setInterval((()=>{e()}),3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new ve(q.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new ve(q.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new ve(q.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new ve(q.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const r=this.remoteUserMap.get(e);if(!r)return void k.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!r.get(t))return void k.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const a=t===Xe.VIDEO?e._videoSSRC:e._audioSSRC;a!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(a,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const r=this.remoteUserMap.get(e);if(!r)return void k.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));r.get(t)||k.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(Ie.LocalAudioTrack);if(t?.track instanceof dr){const r=t.track;return Array.from(this.localTrackMap.entries()).filter((a=>{let[o]=a;return o!==Ie.LocalAudioTrack})).filter((a=>{let[o]=a;return!(e&&o===Ie.LocalVideoLowTrack)})).map((a=>{let[,{track:o}]=a;return o})).concat(r.trackList)}return Array.from(this.localTrackMap.entries()).filter((r=>{let[a]=r;return!(e&&a===Ie.LocalVideoLowTrack)})).map((r=>{let[,{track:a}]=r;return a}))}reportPublishEvent(e,t,r,a,o){if(e){const h=this.localTrackMap.get(Ie.LocalAudioTrack),m=a?this.localTrackMap.get(Ie.LocalVideoLowTrack):this.localTrackMap.get(Ie.LocalVideoTrack);nt.publish(this.store.sessionId,{eventElapse:di.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:h?.track.getTrackLabel(),videoName:m?.track.getTrackLabel(),screenshare:m?.track._hints.indexOf(un.SCREEN_TRACK)!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:o})}else{var u;r||(r=[]);const h=r.find((g=>g instanceof zn)),m=a?(u=this.localTrackMap.get(Ie.LocalVideoTrack))===null||u===void 0?void 0:u.track:r.find((g=>g instanceof wn));nt.publish(this.store.sessionId,{eventElapse:di.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:h?.getTrackLabel(),videoName:m?.getTrackLabel(),screenshare:m?._hints.indexOf(un.SCREEN_TRACK)!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:o})}}reportSubscribeEvent(e,t,r,a){const o=a===Xe.VIDEO?r._videoSSRC:r._audioSSRC;o&&nt.subscribe(this.store.sessionId,{succ:e,ec:t,video:a===Xe.VIDEO,audio:a===Xe.AUDIO,peerid:r.uid,subscribeRequestid:a===Xe.VIDEO?r._videoSSRC:r._audioSSRC,p2pid:this.store.p2pId,eventElapse:di.measureFromSubscribeStart(this.store.clientId,o)})}reset(){k.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new oi("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new oi("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(Ie.LocalAudioTrack);if(e?.track instanceof dr){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach((r=>{t.removeAudioTrack(r)}))}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Zt.Disconnected}getStats(e){var t,r;return e?(r=this.recvConnection)===null||r===void 0?void 0:r.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(Ie.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(Ie.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof wn||t&&t.track instanceof zn?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}getRemoteMedia(e){var t;const r=Array.from(Aa(t=this.remoteUserMap).call(t)).find((a=>a.uid===e));return r?{audioTrack:r.audioTrack,audioSSRC:r._audioSSRC,videoTrack:r.videoTrack,videoSSRC:r._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map((r=>{let[a]=r;return{uid:a.uid,level:a.audioTrack?100*a.audioTrack._source.getAccurateVolumeLevel():0}}));const t=this.localTrackMap.get(Ie.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=_(e).call(e,((r,a)=>r.level-a.level)),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(k.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Zt.Reconnecting,X("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t]=e;var r;t._videoTrack&&t._videoTrack._player&&((r=t._videoTrack._player.getVideoElement())===null||r===void 0||r.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())})),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach((e=>{var t;let[r,{track:a}]=e;switch(r){case Ie.LocalVideoTrack:je(t=a._hints).call(t,un.LOW_STREAM)?a.close():this.pendingLocalTracks.push(a);break;case Ie.LocalAudioTrack:a instanceof dr?this.pendingLocalTracks=this.pendingLocalTracks.concat(a.trackList):this.pendingLocalTracks.push(a);case Ie.LocalVideoLowTrack:}})),this.emit(at.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,r]=e;Array.from(Aa(r).call(r)).forEach((a=>{this.setPendingRemoteMedia(t,a)})),this.emit(at.MediaReconnectStart,t.uid)})),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),k.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const r of this.pendingRemoteTracks){const{user:a,kind:o}=r;if((e instanceof Gh?e.uid:e)===a.uid&&t===o)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let r,a;if(e===Ji.SEND_ONLY){if(!this.sendConnection)throw new ve(q.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");r=await this.sendMutex.lock("From P2PChannel.restartICE"),a=this.sendConnection}else{if(!this.recvConnection)throw new ve(q.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");r=await this.recvMutex.lock("From P2PChannel.restartICE"),a=this.recvConnection}try{if(t){const o=await a.restartICE(t);return a.isInRestartIce=!1,o}{const o=await a.restartICE();if(o){const u=await ei(this,at.RequestP2PRestartICE,{direction:Ji.RECEIVE_ONLY,iceParameter:o});await a.restartICE(u),a.isInRestartIce=!1}}}finally{r()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(Ie.LocalVideoTrack),r=this.localTrackMap.get(Ie.LocalAudioTrack),a=e.videoSend.find((N=>{var B;return N.ssrc===(t==null||(B=t.ssrcs)===null||B===void 0?void 0:B[0].ssrcId)})),o=e.audioSend.find((N=>{var B;return N.ssrc===(r==null||(B=r.ssrcs)===null||B===void 0?void 0:B[0].ssrcId)}));if(!a||!o)return 1;const u=_s(this,at.NeedSignalRTT),h=a?a.rttMs:void 0,m=o?o.rttMs:void 0,g=h&&m?(h+m)/2:h||m,y=(g&&u?(g+u)/2:g||u)||0,E=100*e.sendPacketLossRate*.7/50+.3*y/1500,A=E<.17?1:E<.36?2:E<.59?3:E<.1?4:5,O=t?.track;if(O&&O._encoderConfig&&O._hints.indexOf(un.SCREEN_TRACK)===-1){const N=O._encoderConfig.bitrateMax,B=e.bitrate.actualEncoded;if(N&&B){const U=(1e3*N-B)/(1e3*N);return Q6[U<.15?0:U<.3?1:U<.45?2:U<.6?3:4][A]}}return A}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach((r=>{let[a]=r;const o=a._audioSSRC,u=a._videoSSRC,h=e.audioRecv.find((B=>B.ssrc===o)),m=e.videoRecv.find((B=>B.ssrc===u));if(!h&&!m)return void(t+=1);const g=_s(this,at.NeedSignalRTT),y=e.rtt,E=(y&&g?(y+g)/2:y||g)||0,A=h?h.jitterMs:void 0,O=e.recvPacketLossRate;let N=.7*O*100/50+.3*E/1500;A&&(N=.6*O*100/50+.2*E/1500+.2*A/400),t+=N<.1?1:N<.17?2:N<.36?3:N<.59?4:5})),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new Fe(((t,r)=>{this.handleMuteLocalTrack(e,t,r)}))}filterTobePublishedTracks(e,t,r){const a=[],o=Vt(),u=this.getAllTracks();e=P_(e=e.filter((g=>u.indexOf(g)===-1)));let h=!1,m=!1;for(const g of e){if(g instanceof wn&&(this.localTrackMap.has(Ie.LocalVideoTrack)||h?new ve(q.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(a.push({track:g,type:Ie.LocalVideoTrack}),h=!0),t)){const y=this.getLowVideoTrack(g,r);a.push({track:y,type:Ie.LocalVideoLowTrack})}if(g instanceof zn){const y=this.localTrackMap.get(Ie.LocalAudioTrack);if(y){if(!(y.track instanceof dr))throw new ve(q.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(g._bypassWebAudio)throw new ve(q.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");y.track.addAudioTrack(g),this.bindLocalAudioTrackEvents(g,!0)}else if(m){const E=a.find((A=>{let{type:O}=A;return O===Ie.LocalAudioTrack}));if(!(E.track instanceof dr))throw new ve(q.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(g._bypassWebAudio)throw new ve(q.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");E.track.addAudioTrack(g)}else{if(!o.webAudioMediaStreamDest||g instanceof dr||g._bypassWebAudio)a.push({track:g,type:Ie.LocalAudioTrack});else{const E=new dr;E.addAudioTrack(g),a.push({track:E,type:Ie.LocalAudioTrack})}m=!0}}}return a}filterTobeUnpublishedTracks(e){const t=[],r=this.getAllTracks();e=P_(e=e.filter((a=>r.indexOf(a)!==-1)));for(const a of e){if(a instanceof zn){const o=this.localTrackMap.get(Ie.LocalAudioTrack);if(!o)continue;o.track instanceof dr?(o.track.removeAudioTrack(a),this.unbindLocalAudioTrackEvents(a),o.track.trackList.length===0&&(t.push([Ie.LocalAudioTrack,o]),o.track.close())):t.push([Ie.LocalAudioTrack,o])}if(a instanceof wn){const o=this.localTrackMap.get(Ie.LocalVideoTrack);if(!o)continue;t.push([Ie.LocalVideoTrack,o]);const u=this.localTrackMap.get(Ie.LocalVideoLowTrack);u&&t.push([Ie.LocalVideoLowTrack,u])}}return t}bindLocalTrackEvents(e){e.forEach((t=>{let{track:r,type:a}=t;switch(a){case Ie.LocalVideoTrack:r.addListener($e.GET_STATS,this.handleGetLocalVideoStats),r.addListener($e.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener($e.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener($e.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.addListener($e.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.addListener($e.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.addListener($e.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener($e.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ie.LocalAudioTrack:this.bindLocalAudioTrackEvents(r);case Ie.LocalVideoLowTrack:}}))}bindLocalAudioTrackEvents(e,t){e instanceof dr?e.trackList.forEach((r=>{r.addListener($e.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener($e.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener($e.GET_STATS,this.handleGetLocalAudioStats),r.addListener($e.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener($e.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.addListener($e.GET_STATS,this.handleGetLocalAudioStats),e.addListener($e.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener($e.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener($e.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener($e.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener($e.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map((t=>{let[r,{track:a}]=t;return{track:a,type:r}}))),e.forEach((t=>{let{track:r,type:a}=t;switch(a){case Ie.LocalVideoTrack:r.off($e.GET_STATS,this.handleGetLocalVideoStats),r.off($e.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off($e.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off($e.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.off($e.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.off($e.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.off($e.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off($e.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ie.LocalAudioTrack:this.unbindLocalAudioTrackEvents(r);case Ie.LocalVideoLowTrack:}}))}unbindLocalAudioTrackEvents(e){e instanceof dr?e.trackList.forEach((t=>{t.off($e.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off($e.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off($e.GET_STATS,this.handleGetLocalAudioStats),t.off($e.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off($e.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.off($e.GET_STATS,this.handleGetLocalAudioStats),e.off($e.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off($e.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off($e.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off($e.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off($e.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof K_&&t.addListener($e.GET_STATS,(r=>{r(this.handleGetRemoteVideoStats(e))})),t instanceof Y_&&t.addListener($e.GET_STATS,(r=>{r(this.handleGetRemoteAudioStats(e))}))}unbindRemoteTrackEvents(e){e&&e.removeAllListeners($e.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,r]=e;r.has(Xe.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),r.has(Xe.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)}))}createGatewayPublishMessage(e,t){return e.map(((r,a)=>{var o;let u,{track:h,type:m}=r;switch(m){case Ie.LocalAudioTrack:u=Qt.Audio;break;case Ie.LocalVideoTrack:u=je(o=h._hints).call(o,un.SCREEN_TRACK)?Qt.Screen:Qt.High;break;case Ie.LocalVideoLowTrack:u=Qt.Low}return{kind:m===Ie.LocalAudioTrack?Xe.AUDIO:Xe.VIDEO,stream_type:u,mid:t[a].id,ssrcs:t[a].localSSRC,isMuted:h.muted||!h.enabled}}))}createGatewayUnpublishMessage(e){return e.map((t=>{var r;let a,[o,{track:u,ssrcs:h,id:m}]=t;switch(o){case Ie.LocalVideoTrack:a=je(r=u._hints).call(r,un.SCREEN_TRACK)?Qt.Screen:Qt.High;break;case Ie.LocalAudioTrack:a=Qt.Audio;break;case Ie.LocalVideoLowTrack:a=Qt.Low}return{stream_type:a,ssrcs:h,mid:m}}))}assignLocalTracks(e,t){e.forEach(((r,a)=>{let{track:o,type:u}=r;this.localTrackMap.set(u,{track:o,id:t[a].id,ssrcs:t[a].localSSRC})}))}withdrawLocalTracks(e){e.forEach((t=>{let[r]=t;this.localTrackMap.delete(r)}))}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var r;k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(at.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),je(r=this._restartStates).call(r,t)&&!e.isInRestartIce&&(t==="disconnected"&&await Hr(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),nt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Dn.TRACER}).onSuccess(),this.emit(at.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var r;const a=Array.from(Aa(r=this.remoteUserMap).call(r)).find((u=>u._audioSSRC===t));var o;a&&(this.store.subscribe(a.uid,"audio",void 0,void 0,void 0,Date.now()),(o=a.audioTrack)===null||o===void 0||o.emit(Hs.FIRST_FRAME_DECODED),nt.firstRemoteFrame(this.store.sessionId,yr.FIRST_AUDIO_DECODE,Nn.FIRST_AUDIO_DECODE,{peer:a._uintid,subscribeElapse:di.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var r;const a=Array.from(Aa(r=this.remoteUserMap).call(r)).find((o=>o._audioSSRC===t));a&&nt.firstRemoteFrame(this.store.sessionId,yr.FIRST_AUDIO_RECEIVED,Nn.FIRST_AUDIO_RECEIVED,{peer:a._uintid,subscribeElapse:di.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,r,a)=>{this.reportVideoFirstFrameDecoded(t,r,a)},e.onFirstVideoReceived=t=>{var r;const a=Array.from(Aa(r=this.remoteUserMap).call(r)).find((o=>o._videoSSRC===t));a&&nt.firstRemoteFrame(this.store.sessionId,yr.FIRST_VIDEO_RECEIVED,Nn.FIRST_VIDEO_RECEIVED,{peer:a._uintid,subscribeElapse:di.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,r)=>{const a=t.candidateType==="relay",o=r.candidateType==="relay";r.candidateType!=="unknown"&&a===o||this.emit(at.ConnectionTypeChange,a),k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Uh(r))," -> ").concat(JSON.stringify(Uh(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,r)=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Uh(r))," -> ").concat(JSON.stringify(Uh(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(at.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===Ji.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,k.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===Ji.SEND_ONLY?this.restartICE(e):ei(this,at.RequestP2PRestartICE,{direction:Ji.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const r=this.localTrackMap.get(Ie.LocalAudioTrack);if(e instanceof zn&&r?.track instanceof dr)return r.track.isActive||t.push([Ie.LocalAudioTrack,r]),t;const a=Array.from(this.localTrackMap.entries()).find((o=>{let[,{track:u}]=o;return e===u}));if(a&&(t.push(a),a[0]===Ie.LocalVideoTrack)){const o=this.localTrackMap.get(Ie.LocalVideoLowTrack);o&&t.push([Ie.LocalVideoLowTrack,o])}return t}filterTobeUnmutedTracks(e){const t=[],r=this.localTrackMap.get(Ie.LocalAudioTrack);if(e instanceof zn&&r?.track instanceof dr)return r.track.isActive&&t.push([Ie.LocalAudioTrack,r]),t;const a=Array.from(this.localTrackMap.entries()).find((o=>{let[,{track:u}]=o;return e===u}));if(a)if(a[0]===Ie.LocalVideoTrack){t.push(a);const o=this.localTrackMap.get(Ie.LocalVideoLowTrack);o&&t.push([Ie.LocalVideoLowTrack,o])}else t.push(a);return t}createMuteMessage(e){return e.map((t=>{var r;let a,[o,{track:u,ssrcs:h,id:m}]=t;switch(o){case Ie.LocalAudioTrack:a=Qt.Audio;break;case Ie.LocalVideoTrack:a=je(r=u._hints).call(r,un.SCREEN_TRACK)?Qt.Screen:Qt.High;break;case Ie.LocalVideoLowTrack:a=Qt.Low}return{stream_type:a,ssrcs:h,mid:m}}))}createUnmuteMessage(e){return e.map((t=>{var r;let a,[o,{track:u,ssrcs:h,id:m}]=t;switch(o){case Ie.LocalAudioTrack:a=Qt.Audio;break;case Ie.LocalVideoTrack:a=je(r=u._hints).call(r,un.SCREEN_TRACK)?Qt.Screen:Qt.High;break;case Ie.LocalVideoLowTrack:a=Qt.Low}return{stream_type:a,ssrcs:h,mid:m}}))}filterTobeUnSubscribedTracks(e,t){const r=[],a=this.remoteUserMap.get(e);if(!a)return r;if(t){const o=a.get(t);if(!o)return r;r.push([e,{kind:t,id:o}])}else Array.from(a.entries()).forEach((o=>{let[u,h]=o;r.push([e,{kind:u,id:h}])}));return r}createUnsubscribeMessage(e){const t=[];return e.forEach((r=>{let[a,{kind:o,id:u}]=r;switch(o){case Xe.VIDEO:return void(a._videoSSRC&&t.push({stream_type:Xe.VIDEO,ssrcId:a._videoSSRC}));case Xe.AUDIO:return void(a._audioSSRC&&t.push({stream_type:Xe.AUDIO,ssrcId:a._audioSSRC}))}})),t}withdrawRemoteTracks(e){e.forEach((t=>{let[r,{kind:a}]=t;const o=this.remoteUserMap.get(r);o&&(o.delete(a),Array.from(o.entries()).length===0&&this.remoteUserMap.delete(r))}))}async updateBitrateLimit(e){const t=this.localTrackMap.get(Ie.LocalVideoTrack),r=this.localTrackMap.get(Ie.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new Fe(((a,o)=>{this.handleUpdateVideoEncoder(t.track,a,o,!0)}))),r&&e.low_stream_uplink&&(await r.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new Fe(((a,o)=>{this.handleUpdateVideoEncoder(r.track,a,o,!0)})))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof zn){const r=this.filterTobeUnmutedTracks(e[t]);if(r.length===0)continue;const a=this.createUnmuteMessage(r);return void await hn(this,at.RequestUnmuteLocal,a)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter((e=>{let[,{ssrcs:t}]=e;return!!t})),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(at.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(at.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Hr(lD(this.dtlsFailedCount,sr)),this.emit(at.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Ie.LocalVideoTrack)||this.pendingLocalTracks.some((e=>e instanceof wn))}throwIfTrackTypeNotMatch(e){if(e.filter((t=>t instanceof wn)).length>1)throw new ve(q.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter((t=>t instanceof zn)).length>1&&(e.some((t=>t instanceof zn&&t._bypassWebAudio))||!Vt().webAudioMediaStreamDest))throw new ve(q.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof wn&&this.pendingLocalTracks.some((r=>r instanceof wn)))throw new ve(q.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof zn&&this.pendingLocalTracks.some((r=>r instanceof zn))&&(!Vt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some((r=>r instanceof zn&&r._bypassWebAudio))))throw new ve(q.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const r=!X("DISABLE_DUAL_STREAM_USE_ENCODING")&&Vt().supportDualStreamEncoding,a=YA(YA({},{width:160,height:120,framerate:15,bitrate:50}),t);let o;o=r?e._mediaStreamTrack.clone():RP(e,a);const u=fn(8,"track-low-"),h=new wn(o,YA(YA({},r&&{scaleResolutionDownBy:aP(a,e)}),{},{frameRate:a.framerate,bitrateMax:a.bitrate,bitrateMin:a.bitrate}),void 0,void 0,u);return h.on(Pp.TRANSCEIVER_UPDATED,(m=>{e._updateRtpTransceiver(m,B_.LOW_STREAM)})),h._hints.push(un.LOW_STREAM),e.addListener($e.NEED_CLOSE,(()=>{h.close()})),h}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,r,a){var o;const u=Array.from(Aa(o=this.remoteUserMap).call(o)).find((h=>h._videoSSRC===e));if(u){a||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find((g=>g.userId===u.uid&&g.type==="video"));nt.firstRemoteVideoDecode(this.store.sessionId,yr.FIRST_VIDEO_DECODE,Nn.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:t,videoheight:r,subscribeElapse:di.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:m?.subscribeEnd||0,subscriberStart:m?.subscribeStart||0,videoAddNotify:m?.streamAdded||0,state:a?1:0})}}async remoteMediaSsrcChanged(e,t,r){if(!this.recvConnection)return!1;const a=this.remoteUserMap.get(e);if(!a)return!1;const o=a.get(t);if(!o)return!1;const u=await this.recvConnection.getRemoteSSRC(o);return u!==void 0&&u!==r}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new ve(q.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new ve(q.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new ve(q.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new ve(q.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new ve(q.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new ve(q.NOT_SUPPORTED)}async preConnect(e){throw new ve(q.NOT_SUPPORTED)}getEstablishParams(){throw new ve(q.NOT_SUPPORTED)}async reSubscribe(e){throw new ve(q.NOT_SUPPORTED)}reportVideoFirstFrameRender(e){}async updateVideoStreamParameter(e,t){throw new ve(q.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach((e=>{let[t,{track:r}]=e;t===Ie.LocalVideoLowTrack?r._updateRtpTransceiver(void 0,B_.LOW_STREAM):r._updateRtpTransceiver(void 0)}))}},Qe(kn.prototype,"p2pConnect",[LW],Object.getOwnPropertyDescriptor(kn.prototype,"p2pConnect"),kn.prototype),Qe(kn.prototype,"unpublish",[MW],Object.getOwnPropertyDescriptor(kn.prototype,"unpublish"),kn.prototype),Qe(kn.prototype,"unpublishLowStream",[UW],Object.getOwnPropertyDescriptor(kn.prototype,"unpublishLowStream"),kn.prototype),Qe(kn.prototype,"subscribe",[jW],Object.getOwnPropertyDescriptor(kn.prototype,"subscribe"),kn.prototype),Qe(kn.prototype,"mockSubscribe",[VW],Object.getOwnPropertyDescriptor(kn.prototype,"mockSubscribe"),kn.prototype),Qe(kn.prototype,"unsubscribe",[BW],Object.getOwnPropertyDescriptor(kn.prototype,"unsubscribe"),kn.prototype),Qe(kn.prototype,"muteRemote",[FW],Object.getOwnPropertyDescriptor(kn.prototype,"muteRemote"),kn.prototype),Qe(kn.prototype,"unmuteRemote",[GW],Object.getOwnPropertyDescriptor(kn.prototype,"unmuteRemote"),kn.prototype),Qe(kn.prototype,"hasRemoteMediaWithLock",[HW],Object.getOwnPropertyDescriptor(kn.prototype,"hasRemoteMediaWithLock"),kn.prototype),Qe(kn.prototype,"disconnectForReconnect",[WW],Object.getOwnPropertyDescriptor(kn.prototype,"disconnectForReconnect"),kn.prototype),Qe(kn.prototype,"remoteMediaSsrcChanged",[zW],Object.getOwnPropertyDescriptor(kn.prototype,"remoteMediaSsrcChanged"),kn.prototype),kn);function Yc(e){return function(t,r,a){const o=t[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return a.value=async function(){for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];switch(e){case Kc.SEND_ONLY:{const g=await this.sendMutex.lock("From P2PChannel2.".concat(r));try{return await o.apply(this,h)}finally{g()}}case Kc.RECEIVE_ONLY:{const g=await this.recvMutex.lock("From P2PChannel2.".concat(r));try{return await o.apply(this,h)}finally{g()}}default:{const g=await this.sendMutex.lock("From P2PChannel2.".concat(r)),y=await this.recvMutex.lock("From P2PChannel2.".concat(r));try{return await o.apply(this,h)}finally{g(),y()}}}},a}}class $p extends Mn{constructor(t,r){super(),H(this,"signal",void 0),H(this,"token",void 0),H(this,"tokenTimeout",void 0),H(this,"tokenInterval",void 0),H(this,"_sequence",0),H(this,"userMap",new Map),H(this,"encoder",new TextEncoder),this.signal=t,this.token=r;const a=()=>{this.signal.connectionState===yn.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(a,1e3):this.tokenInterval=window.setTimeout(a,3*X("P2P_TOKEN_INTERVAL"))};a()}async send(t,r,a,o,u){var h;if(this.userMap.size===0)return;const m=Array.from(Pi(h=this.userMap).call(h))[0].token;typeof r!="string"&&(r=JSON.stringify(r)),o=o??fn(6,""),u=u??this._sequence++;const g={_id:o,_type:t,_seq:u,_message:r,token:"".concat(this.token,"_").concat(m)};X("SHOW_P2P_LOG")&&k.debug("send message",g,"noNeedResponse : ".concat(a)),this.splitMessage(JSON.stringify(g)).forEach((E=>{this.signal.request(ht.DATA_STREAM,{payload:xh(this.encoder.encode(E))})}));const y=new Fe(((E,A)=>{const O=window.setTimeout((()=>{this.off("res-@".concat(o,"_ack"),N),this.off("res-@".concat(o),U),this.off(Z_.ABORT,B),k.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(o)),this.userMap.size===0?A(new ve(q.INVALID_REMOTE_USER)):A(new ve(q.TIMEOUT))}),X("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),N=()=>{O&&window.clearTimeout(O),this.off(Z_.ABORT,B),a&&E()},B=()=>{O&&window.clearTimeout(O),this.off("res-@".concat(o,"_ack"),N),this.off("res-@".concat(o),U),A(new ve(q.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(o)))};this.once(Z_.ABORT,B),this.once("res-@".concat(o,"_ack"),N);const U=(K,z)=>{V=!0,O&&window.clearTimeout(O),this.off("res-@".concat(o,"_ack"),N),this.off(Z_.ABORT,B),K==="success"?E(z):A(new ve(q.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(o)))};let V=!1;a||(this.once("res-@".concat(o),U),Hr(X("SIGNAL_REQUEST_TIMEOUT")).then((()=>{V||k.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(o,", ").concat(g))})))}));try{return await y}catch(E){if(E.code===q.TIMEOUT)return await this.send(t,r,a,o,u);throw E}}onMessage(t){var r;const{_uid:a}=t;let o,u=this.userMap.get(a);if(u)o=u.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==er.CHECK)return;const{token:y}=t;o=new Map,u={uid:a,isStart:!0,token:y,splitMessageMap:o,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(a,u),this.signal.emit(Dt.ON_USER_ONLINE,{uid:a}),this.handleUserOnline()}if("id"in t&&"total"in t){var h;const{id:y,total:E}=t,A=(h=o.get(y))!==null&&h!==void 0?h:[];if(A.push(t),o.has(y)||o.set(y,A),A.length!==E)return;{const O=_(A).call(A,((N,B)=>N.index-B.index)).map((N=>N.payload)).join("");o.delete(y),(t=JSON.parse(O))._uid=a}}const{_type:m,token:g}=t;if(je(r=[er.ACK,er.CHECK]).call(r,m))return m===er.CHECK&&this.handleCheckToken(u,g),void this.receiveMessage(t);g==="".concat(u.token,"_").concat(this.token)?this.handleReceivedMessage(t):k.debug('Receive unexpected message", '.concat(g,", cur_token: ").concat(u.token,"_").concat(this.token),t)}check(){const t={_id:fn(6,""),token:this.token,_type:er.CHECK};X("SHOW_P2P_LOG")&&k.debug("send message",t),this.signal.request(ht.DATA_STREAM,{payload:xh(this.encoder.encode(JSON.stringify(t)))})}ack(t){const r={_id:t,_type:er.ACK,token:this.token};X("SHOW_P2P_LOG")&&k.debug("send message",r),this.signal.request(ht.DATA_STREAM,{payload:xh(this.encoder.encode(JSON.stringify(r)))})}response(t,r,a){this.send(er.RESPONSE,JSON.stringify({success:!a,message:r}),!0,t)}handleReceivedMessage(t){const r=()=>{this.userMap.forEach((y=>{const{receivedMessagesMap:E,nextExpectedSequenceNumber:A}=y;for(;E.has(A);){const O=E.get(A);E.delete(A),this.receiveMessage(O),y.nextExpectedSequenceNumber++}}))};if(!t)return void r();const{_uid:a,_seq:o}=t,u=this.userMap.get(a),{receivedMessagesMap:h,isStart:m,nextExpectedSequenceNumber:g}=u;if(o<g)return this.ack(t._id),void k.debug("[external-signal] receive old message, seq: ".concat(o,", ").concat(t._message));h.set(o,t),m&&o===g&&(this.receiveMessage(t),h.delete(g),u.nextExpectedSequenceNumber++,r())}receiveMessage(t){const{_id:r,_type:a,_message:o,_uid:u}=t;if(X("SHOW_P2P_LOG")&&k.debug("receive message",t),r){let h;switch(t._type!==er.ACK&&(o&&(h=JSON.parse(o)),this.ack(t._id)),t._type){case er.CANDIDATE:case er.CONTROL:this.signal.emit(a,h,u);break;case er.PUBLISH:case er.UNPUBLISH:case er.RESTART_ICE:case er.CALL:h.uid=u,ei(this.signal,a,h).then((m=>{this.response(t._id,m)})).catch((()=>{this.response(t._id,void 0,!0)}));break;case er.ACK:this.getListeners("res-@".concat(r,"_ack")).length>0&&this.emit("res-@".concat(r,"_ack"));break;case er.RESPONSE:{const{success:m,message:g}=h;this.emit("res-@".concat(r),m?"success":"failed",g);break}}}}splitMessage(t){if(t.length<$p.MAX_MESSAGE_SIZE)return[t];const r=[],{remoteToken:a}=JSON.parse(t),o=fn(6,"");let u=0,h=800;const m=Math.ceil(t.length/h);for(;t.length>0;){u++;const g={id:o,index:u,total:m,payload:t.slice(0,h),token:"".concat(this.token,"_").concat(a)};JSON.stringify(g).length>$p.MAX_MESSAGE_SIZE?h-=50:(r.push(g),t=t.slice(h))}return r.map((g=>JSON.stringify(g)))}handleCheckToken(t,r){return t.token!==r?(k.debug("token changed, from ".concat(t.token," to ").concat(r)),this.reset(t.uid,r),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout((()=>{k.debug("token timeout, ".concat(r)),this.reset(t.uid)}),X("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const t=await ei(this.signal,er.CALL,void 0),r=await this.send(er.CALL,t);this.signal.emit(pt.P2P_CONNECTION,r,!0)}async reset(t,r){const a=this.userMap.get(t);a&&(this.emit(Z_.ABORT),this.signal.emit(Dt.ON_USER_OFFLINE,{uid:a.uid,reason:fce.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),r||(k.debug("change local token from ".concat(r," to ").concat(r)),this.token=fn(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Z_.ABORT)}}H($p,"MAX_SIZE",1),H($p,"MAX_MESSAGE_SIZE",1024);class que extends Mn{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===yn.CONNECTED?this.emit(pt.WS_CONNECTED):t===yn.RECONNECTING?this.emit(pt.WS_RECONNECTING,this._websocketReconnectReason):t===yn.CLOSED&&this.emit(pt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,r){super(),H(this,"_disconnectedReason",void 0),H(this,"_websocketReconnectReason",void 0),H(this,"_connectionState",yn.CLOSED),H(this,"reconnectToken",void 0),H(this,"p2pToken",void 0),H(this,"websocket",void 0),H(this,"openConnectionTime",void 0),H(this,"clientId",void 0),H(this,"lastMsgTime",Date.now()),H(this,"uploadCache",[]),H(this,"uploadCacheInterval",void 0),H(this,"rttRolling",new S5(5)),H(this,"pingpongTimer",void 0),H(this,"pingpongTimeoutCount",0),H(this,"joinResponse",void 0),H(this,"multiIpOption",void 0),H(this,"initError",void 0),H(this,"spec",void 0),H(this,"store",void 0),H(this,"_external_signal",void 0),H(this,"onWebsocketMessage",(a=>{if(a.data instanceof ArrayBuffer)return void this.emit(pt.ON_BINARY_DATA,a.data);const o=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(o,"_id")){const u="res-@".concat(o._id);this.emit(u,o._result,o._message)}else if(Object.prototype.hasOwnProperty.call(o,"_type")){switch(o._type){case Dt.ON_DATA_STREAM:return void this.handleDataStream(o._message);case Dt.MUTE_AUDIO:case Dt.MUTE_VIDEO:case Dt.ON_P2P_LOST:case Dt.ON_USER_ONLINE:return;case Dt.ON_USER_OFFLINE:const{uid:u}=o._message;return k.debug("[".concat(this.clientId,"] user-offline uid: ").concat(u)),void this._external_signal.reset(u)}if(this.emit(o._type,o._message),o._type===Dt.ON_NOTIFICATION&&this.handleNotification(o._message),o._type===Dt.ON_USER_BANNED)switch(o._message.error_code){case 14:this.close($t.UID_BANNED);break;case 15:this.close($t.IP_BANNED);break;case 16:this.close($t.CHANNEL_BANNED)}if(o._type===Dt.ON_USER_LICENSE_BANNED)switch(o._message.error_code){case ot.ERR_LICENSE_MISSING:this.close($t.LICENSE_MISSING);break;case ot.ERR_LICENSE_EXPIRED:this.close($t.LICENSE_EXPIRED);break;case ot.ERR_LICENSE_MINUTES_EXCEEDED:this.close($t.LICENSE_MINUTES_EXCEEDED);break;case ot.ERR_LICENSE_PERIOD_INVALID:this.close($t.LICENSE_PERIOD_INVALID);break;case ot.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close($t.LICENSE_MULTIPLE_SDK_SERVICE);break;case ot.ERR_LICENSE_ILLEGAL:this.close($t.LICENSE_ILLEGAL);break;default:this.close()}}})),this.clientId=t.clientId,this.spec=t,this.store=r,this.websocket=new rP("gateway-".concat(this.clientId),this.spec.retryConfig,!0,X("JOIN_GATEWAY_USE_DUAL_DOMAIN"),X("JOIN_GATEWAY_USE_443PORT_ONLY"),r),this.handleWebsocketEvents(),window.addEventListener("offline",(()=>{this.connectionState===yn.CONNECTED&&this.reconnect("retry",Qr.OFFLINE)})),this.p2pToken=fn(6,""),this._external_signal=new $p(this,this.p2pToken)}async request(t,r,a,o){const u=fn(6,""),h={_id:u,_type:t,_message:r},m=this.websocket.connectionID,g=()=>new Fe(((B,U)=>{if(this.connectionState===yn.CONNECTED)return B();const V=()=>{this.off(pt.WS_CLOSED,K),B()},K=()=>{this.off(pt.WS_CONNECTED,V),U(new ve(q.WS_ABORT))};this.once(pt.WS_CONNECTED,V),this.once(pt.WS_CLOSED,K)}));if(this.connectionState!==yn.CONNECTING&&this.connectionState!==yn.RECONNECTING||t===ht.JOIN||t===ht.REJOIN||await g(),this.websocket.sendMessage(h,!0),o)return;const y=new Fe(((B,U)=>{let V=!1;const K=(J,ae)=>{V=!0,B({isSuccess:J==="success",message:ae||{}}),this.off(pt.WS_CLOSED,z),this.off(pt.WS_RECONNECTING,z),this.emit(pt.REQUEST_SUCCESS,t,r)};this.once("res-@".concat(u),K);const z=()=>{U(new ve(q.WS_ABORT,"type: ".concat(t))),this.off(pt.WS_CLOSED,z),this.off(pt.WS_RECONNECTING,z),this.off("res-@".concat(u),K)};this.once(pt.WS_CLOSED,z),this.once(pt.WS_RECONNECTING,z),Hr(X("SIGNAL_REQUEST_TIMEOUT")).then((()=>{this.websocket.connectionID!==m||V||(k.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(pt.REQUEST_TIMEOUT,t,r))}))}));let E=null;try{E=await y}catch(B){if(this.connectionState===yn.CLOSED||t===ht.LEAVE)throw new ve(q.WS_ABORT);return!this.spec.forceWaitGatewayResponse||a?B.throw():t===ht.JOIN||t===ht.REJOIN?null:(await g(),await this.request(t,r))}if(E.isSuccess)return E.message;const A=Number(E.message.error_code||E.message.code),O=tS(A),N=new ve(q.UNEXPECTED_RESPONSE,"".concat(O.desc,": ").concat(E.message.error_str),{code:A,data:E.message,desc:O.desc});return O.action==="success"?E.message:(k.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(A,", message: ").concat(O.desc,", action: ").concat(O.action)),A===ot.ERR_TOO_MANY_BROADCASTERS?((t===ht.JOIN||t===ht.REJOIN)&&(this.initError=N,this.close()),N.throw()):O.action==="failed"?N.throw():O.action==="quit"?(this.initError=N,this.close(),N.throw()):(A===ot.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=E.message.option,k.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Qr.MULTI_IP)):this.reconnect(O.action,Qr.SERVER_ERROR),t===ht.JOIN||t===ht.REJOIN?null:await this.request(t,r)))}waitMessage(t,r){return new Fe((a=>{const o=u=>{(!r||r(u))&&(this.off(t,o),a(u))};this.on(t,o)}))}uploadWRTCStats(t){if(!this.store.sessionId)return void k.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const r={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Q0.WRTC_STATS,r)}upload(t,r){const a={_type:t,_message:r};try{this.websocket.sendMessage(a)}catch{const u=X("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((()=>{if(this.connectionState!==yn.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)}),X("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,r){const a={_type:t,_message:r};this.websocket.sendMessage(a)}async sendExtensionMessage(t,r,a){return await this._external_signal.send(t,r,a)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Fe(((r,a)=>{this.once(pt.WS_CONNECTED,(()=>r(this.joinResponse))),this.once(pt.WS_CLOSED,(()=>a(this.initError||new ve(q.WS_ABORT)))),this.connectionState=yn.CONNECTING,this.websocket.init(t).catch(a)}))}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||$t.LEAVE,this.connectionState=yn.CLOSED,k.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=fn(6,""),this._external_signal.clear(),this._external_signal=new $p(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(pt.ABORT_P2P_EXECUTION);const t=await ei(this,pt.REQUEST_JOIN_INFO),r=await this.request(ht.JOIN,t);if(!r)return this.emit(pt.REPORT_JOIN_GATEWAY,q.TIMEOUT,this.url||""),!1;this.joinResponse=r,this.emit(pt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=yn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,r)}async downgradeCodec(t){return!1}handleDataStream(t){try{var r;const a=Np(t.payload),o=new TextDecoder().decode(a),u=JSON.parse(o);"total"in u&&"id"in u||je(r=Object.values(er)).call(r,u._type)?(u._uid=t.uid,this._external_signal.onMessage(u)):this.emit(Dt.ON_DATA_STREAM,t)}catch{this.emit(Dt.ON_DATA_STREAM,t)}}handleNotification(t){k.debug("[".concat(this.clientId,"] receive notification: "),t);const r=tS(t.code);if(r.action!=="success"){if(r.action!=="failed")return r.action==="quit"?(r.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close($t.UID_BANNED),void this.close()):void this.reconnect(r.action,Qr.SERVER_ERROR);k.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=X("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=t&&(k.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>X("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Qr.TIMEOUT):this.request(ht.PING,void 0,!0).then((()=>{this.pingpongTimeoutCount=0;const a=Date.now()-r;this.rttRolling.add(a),X("REPORT_STATS")&&this.send(ht.PING_BACK,{pingpongElapse:a})})).catch((a=>{}))}handleWebsocketEvents(){this.websocket.on(yt.RECONNECT_CREATE_CONNECTION,(t=>{this.emit(pt.WS_RECONNECT_CREATE_CONNECTION,t)})),this.websocket.on(yt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(yt.CLOSED,(()=>{this.connectionState=yn.CLOSED})),this.websocket.on(yt.FAILED,(()=>{this._disconnectedReason=$t.NETWORK_ERROR,this.connectionState=yn.CLOSED})),this.websocket.on(yt.RECONNECTING,(t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===yn.CONNECTED?this.connectionState=yn.RECONNECTING:this.connectionState=yn.CONNECTING})),this.websocket.on(yt.WILL_RECONNECT,((t,r,a)=>{t!=="retry"?(k.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0):k.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),a(t)})),this.websocket.on(yt.CONNECTED,(()=>{this.openConnectionTime=Date.now(),this.join().catch((t=>{if(this.emit(pt.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof ve&&t.code===q.UNEXPECTED_RESPONSE&&t.data.code===ot.ERR_NO_AUTHORIZED)return k.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Qr.SERVER_ERROR);k.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Qr.SERVER_ERROR):(this.initError=t,this.close())}))})),this.websocket.on(yt.REQUEST_NEW_URLS,((t,r)=>{ei(this,pt.REQUEST_RECOVER,this.multiIpOption).then(t).catch(r)})),this.websocket.on(yt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{this.emit(Dt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}))}}const Xue={name:"P2PChannel",create:function(e){let{store:t,statsCollector:r}=e;return new Yue(t,r)},createSubmodule:function(e){let{store:t,spec:r}=e;return new que(r,t)}};function YW(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),r.push.apply(r,a)}return r}function qW(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?YW(Object(r),!0).forEach((function(a){H(e,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):YW(Object(r)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))}))}return e}class Jue{constructor(t){H(this,"sessionDesc",void 0),H(this,"localCapabilities",void 0),H(this,"rtpCapabilities",void 0),H(this,"candidates",void 0),H(this,"_originCandidates",void 0),H(this,"iceParameters",void 0),H(this,"dtlsParameters",void 0),H(this,"setup",void 0),H(this,"currentMidIndex",void 0),H(this,"cname",void 0),t=Pn(t);const{iceParameters:r,dtlsParameters:a,candidates:o,rtpCapabilities:u,setup:h,localCapabilities:m,sdkCodec:g,cname:y}=t,E=Ca(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=u,this.candidates=o,this._originCandidates=Pn(o),this.iceParameters=r,this.dtlsParameters=a,this.setup=h,this.localCapabilities=m,this.cname=y;for(let A=0;A<E.mediaDescriptions.length;A++){const O=E.mediaDescriptions[A];if(O.attributes.iceUfrag=r.iceUfrag,O.attributes.icePwd=r.icePwd,O.attributes.fingerprints=a.fingerprints,O.attributes.candidates=o,O.attributes.setup=h,O.media.mediaType==="video"){O.media.fmts=u.videoCodecs.map((U=>U.payloadType.toString(10)));const N=u.videoCodecs.filter((U=>{var V,K;return(V=U.rtpMap)===null||V===void 0?void 0:je(K=V.encodingName.toLowerCase()).call(K,g)})),B=u.videoCodecs.filter((U=>!je(N).call(N,U)));O.attributes.payloads=[...N,...B],O.attributes.extmaps=u.videoExtensions}O.media.mediaType==="audio"&&(O.media.fmts=u.audioCodecs.map((N=>N.payloadType.toString(10))),O.attributes.payloads=u.audioCodecs,O.attributes.extmaps=u.audioExtensions),E.mediaDescriptions[A]=this.mungMediaDesc(O)}this.sessionDesc=E,this.currentMidIndex=E.mediaDescriptions.length-1}toString(){return Dh(this.sessionDesc)}send(t,r,a){const{ssrcs:o,ssrcGroups:u}=aS(r,this.cname),h=this.sessionDesc.mediaDescriptions.find((y=>t===Xe.VIDEO?y.media.mediaType==="video":y.media.mediaType==="audio")),m=o[0].attributes.label,g=o[0].attributes.mslabel;return h.attributes.ssrcs=h.attributes.ssrcs.concat(o),h.attributes.ssrcGroups=h.attributes.ssrcGroups.concat(u),{id:m,mslabel:g}}batchSend(t){return t.map((r=>{let{kind:a,ssrcMsg:o}=r;return this.send(a,o,void 0)}))}stopSending(t){this.sessionDesc.mediaDescriptions.forEach((r=>{const a=[],o=[],u=[];r.attributes.ssrcs.forEach((h=>{je(t).call(t,h.attributes.label||"")?u.push(h):a.push(h)})),r.attributes.ssrcGroups.forEach((h=>{var m;je(m=u.map((g=>g.ssrcId))).call(m,h.ssrcIds[0])||o.push(h)})),r.attributes.ssrcs=a,r.attributes.ssrcGroups=o}))}mute(t){const r=this.sessionDesc.mediaDescriptions.find((a=>a.attributes.mid===t));if(!r)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));r.attributes.direction="inactive"}unmute(t){const r=this.sessionDesc.mediaDescriptions.find((a=>a.attributes.mid===t));if(!r)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));r.attributes.direction="sendonly"}receive(t,r,a){t.forEach(((o,u)=>{const h=o._mediaStreamTrack,m=this.sessionDesc.mediaDescriptions.findIndex((y=>y.attributes.mid===h.kind)),g=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[m],o);this.sessionDesc.mediaDescriptions[m]=g}))}stopReceiving(t){}updateCandidates(t){const r=this._originCandidates.filter((o=>o.transport==="udp")),a=[];if(r.forEach((o=>{a.push(qW(qW({},o),{},{foundation:"tcpcandidate",priority:Number(o.priority)-1+"",transport:"tcp",port:Number(o.port)+90+""}))})),r.length!==0){switch(t){case ui.TCP_RELAY:this.candidates=a;break;case ui.UDP_TCP_RELAY:case ui.RELAY:this.candidates=[...r,...a];break;default:this.candidates=r}for(const o of this.sessionDesc.mediaDescriptions)o.attributes.candidates=this.candidates}}restartICE(t){t=Pn(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach((r=>{r.attributes.iceUfrag=t.iceUfrag,r.attributes.icePwd=t.icePwd}))}predictReceivingMids(t){const r=[];for(let a=0;a<t;a++)r.push((this.currentMidIndex+a+1).toString(10));return r}mungRecvMediaDsec(t,r){const a=Pn(t);return tv(a,r),oP(a,r),a}updateRecvMedia(t,r){const a=this.sessionDesc.mediaDescriptions.findIndex((o=>o.attributes.mid===t));if(a!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[a],r);this.sessionDesc.mediaDescriptions[a]=o}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,r,a){const o=this.sessionDesc.mediaDescriptions.find((h=>t===Xe.VIDEO?h.attributes.mid==="video":h.attributes.mid==="audio"));if(o){const h=o.attributes.ssrcs.find((m=>m.attributes.label===r));var u;h&&(h.attributes.label=a,(u=h.attributes.msid)===null||u===void 0||u.replace(r,a))}}mungMediaDesc(t){const r=Pn(t);return sP(r),(function(a){const o=a.attributes.extmaps.find((u=>cA(u.extensionName)));o&&a.attributes.extmaps.splice(a.attributes.extmaps.indexOf(o),1),a.attributes.payloads.forEach((u=>{const h=u.rtcpFeedbacks.findIndex((m=>m.type==="transport-cc"));h!==-1&&u.rtcpFeedbacks.splice(h,1)}))})(r),r}getSSRC(t){for(const r of this.sessionDesc.mediaDescriptions)for(const a of r.attributes.ssrcs)if(a.attributes.label===t)return[a]}}var pn;function XW(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),r.push.apply(r,a)}return r}function qA(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?XW(Object(r),!0).forEach((function(a){H(e,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):XW(Object(r)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))}))}return e}let $ue=(pn=class WS extends c8{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map((t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"")).filter((t=>{var r;return je(r=Object.keys(q0)).call(r,t)})))]}constructor(t,r){super(t,r),H(this,"store",void 0),H(this,"peerConnection",void 0),H(this,"remoteSDP",void 0),H(this,"initialOffer",void 0),H(this,"statsFilter",void 0),H(this,"useRTX",!1),H(this,"localCapabilities",void 0),H(this,"localCandidateCount",0),H(this,"allCandidatesReceived",!1),H(this,"establishPromise",void 0),H(this,"mutex",void 0),this.store=r,this.mutex=new oi("P2PConnection-mutex",r.clientId),this.peerConnection=new RTCPeerConnection(WS.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=mD(this.peerConnection,X("STATS_UPDATE_INTERVAL"),void 0,Vn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=jh(t.sdp),a=iS(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:X("FILTER_VIDEO_FEC"),filterAudioFec:X("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=a,this.initialOffer=t,qA(qA({},r),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:a},offerSDP:t.sdp})}catch(t){throw new ve(q.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async updateRemoteConnect(){}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new Jue(qA(qA({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const r=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(r){throw new ve(q.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}}async updateRemoteRTPCapabilities(t,r){throw new ve(q.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t){}send(t,r){var a=this;return Bs((function*(){const o=yield jt(a.mutex.lock());try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const u=t.map((O=>a.peerConnection.addTrack(O._mediaStreamTrack))),h=yield jt(a.peerConnection.createOffer()),m=Ca(h.sdp),g=t.map((O=>{const N=O._mediaStreamTrack,B=m.mediaDescriptions.find((U=>U.attributes.mid===N.kind));if(!B)throw new Error("Cannot extract ssrc from mediaDescription.");return(function(U,V,K){const z=U.attributes.ssrcs.filter((ae=>ae.attributes.label===V)),J=U.attributes.ssrcGroups;if(z.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(J&&z.length>1){const ae=J.find((ie=>ie.ssrcIds.indexOf(z[0].ssrcId)!==-1));return ae?[{ssrcId:ae.ssrcIds[0],rtx:K?ae.ssrcIds[1]:void 0}]:[{ssrcId:z[0].ssrcId}]}return[{ssrcId:z[0].ssrcId}]})(B,N.id,a.useRTX)}));let y;try{y=yield g}catch(O){throw u.forEach((N=>{Zr()&&N.replaceTrack(null),a.peerConnection.removeTrack(N)})),O}const E=a.mungSendOfferSDP(h.sdp,t);a.remoteSDP.receive(t,r,y);const A=a.remoteSDP.toString();return yield jt(a.peerConnection.setLocalDescription({type:"offer",sdp:E})),yield jt(a.applySendEncodings(u,t)),yield jt(a.peerConnection.setRemoteDescription({type:"answer",sdp:A})),t.map(((O,N)=>{const B=O._mediaStreamTrack.id;return{localSSRC:g[N],id:B}}))}catch(u){throw new ve(q.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(u.toString()))}finally{o()}}))()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const r=this.peerConnection.getSenders().filter((u=>{var h;return t.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1}));if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");r.map((u=>{Zr()&&u.replaceTrack(null),this.peerConnection.removeTrack(u)}));const a=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(t);const o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(r){throw new ve(q.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}}async receive(t,r,a,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:u,mslabel:h}=this.remoteSDP.send(t,r,o),m=new Fe(((E,A)=>{const O=setTimeout((()=>{A(new Error("Cannot receive track, id: ".concat(u)))}),1e4),N=B=>{const U=Lt();if((U.name==="Safari"&&Number(U.version)===11||Ti())&&B.track.id!==u&&B.streams[0].id===h){var V;const K=B.streams[0].getTracks()[0];return(V=this.remoteSDP)===null||V===void 0||V.updateTrackLabel(t,u,B.track.id),this.peerConnection.removeEventListener("track",N),clearTimeout(O),void E(K)}if(B.track.id===u)return this.peerConnection.removeEventListener("track",N),clearTimeout(O),void E(B.track)};this.peerConnection.addEventListener("track",N)})),g=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:g});const y=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(y),{track:await m,id:u}}catch(u){throw new ve(q.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const a=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(a)}catch(r){throw new ve(q.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const r=this.peerConnection.getSenders().filter((a=>{var o;return t.indexOf(((o=a.track)===null||o===void 0?void 0:o.id)||"")!==-1}));if(r.length!==t.length)throw new Error("sender' length doesn't match mids' length.");r.map((a=>{if(Zr()&&a.track)a.track.enabled=!1;else{const o=a.getParameters();o.encodings.forEach((u=>u.active=!1)),a.setParameters(o)}}))}catch(r){throw new ve(q.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const r=this.peerConnection.getSenders().filter((u=>{var h;return t.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1}));if(r.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");r.map((async u=>{if(Zr()&&u.track)u.track.enabled=!0;else{const h=u.getParameters();h.encodings.forEach((m=>m.active=!0)),await u.setParameters(h)}}));const a=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(a);const o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(r){throw new ve(q.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r.toString()))}}restartICE(t){var r=this;return Bs((function*(){const a=yield jt(r.mutex.lock("From P2PConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const o=Vt().supportPCSetConfiguration;if(t===ui.RELAY&&!o)return;if(o){const y=r.peerConnection.getConfiguration(),E=t===ui.RELAY?"relay":"all";y.iceTransportPolicy!==E&&(k.debug("[".concat(r.store.clientId,"] restartICE change iceTransportPolicy from [").concat(y.iceTransportPolicy,"] to [").concat(E,"]")),y.iceTransportPolicy=E,r.peerConnection.setConfiguration(y))}t!==ui.RELAY&&r.remoteSDP.updateCandidates(t);const u=yield jt(r.peerConnection.createOffer({iceRestart:!0}));if(!u.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=jh(u.sdp),{remoteIceParameters:m}=yield h.iceParameters;r.remoteSDP.restartICE(m);const g=r.remoteSDP.toString();yield jt(r.peerConnection.setLocalDescription(u)),yield jt(r.peerConnection.setRemoteDescription({type:"answer",sdp:g}))}catch(o){k.warning("[".concat(r.store.clientId,"] restart ICE failed, abort operation"),o)}finally{a()}}))()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const a=await this.peerConnection.createOffer(),o=this.mungSendOfferSDP(a.sdp,[r]);this.remoteSDP.updateRecvMedia(r._mediaStreamTrack.kind,r);const u=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(a){throw new ve(q.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(t,r){const a=this.peerConnection.getSenders().filter((o=>{var u;return((u=o.track)===null||u===void 0?void 0:u.id)===t}));a.length===1&&await this.applySendEncodings(a,[r])}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){const a=this.peerConnection.getSenders().find((o=>{var u;return((u=o.track)===null||u===void 0?void 0:u.id)===r}));a&&await a.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,r){throw new ve(q.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new ve(q.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),X("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const r={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?r.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(H0(t.turnServer.servers)?r.iceServers=t.turnServer.servers:(r.iceServers&&r.iceServers.push(...WS.turnServerConfigToIceServers(t.turnServer.servers)),X("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&t.turnServer.serversFromGateway&&r.iceServers.push(...WS.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((a=>{a.forceturn&&(r.iceTransportPolicy="relay")})))),r}static turnServerConfigToIceServers(t){const r=[];return t.forEach((a=>{a.security?a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))})),r}async updateRtpSenderEncodings(t,r){var a;if(r||(r=this.peerConnection.getSenders().find((y=>{var E;return((E=y.track)===null||E===void 0?void 0:E.id)===t._mediaStreamTrack.id}))),!r)return k.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!Vt().supportSetRtpSenderParameters)return k.warn("Browser not support set rtp-sender parameters");const o={},u={};if(t instanceof wn)switch(t._optimizationMode){case"motion":o.degradationPreference="maintain-framerate";break;case"detail":o.degradationPreference="maintain-resolution";break;default:o.degradationPreference="balanced"}if(X("DSCP_TYPE")&&ju()){var h;const y=X("DSCP_TYPE");je(h=["very-low","low","medium","high"]).call(h,y)&&(u.networkPriority=y)}const m=r.getParameters(),g=(a=m.encodings)===null||a===void 0?void 0:a[0];g&&Object.assign(g,u),Object.assign(m,o),k.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),await r.setParameters(m)}async applySendEncodings(t,r){try{if(!Vt().supportSetRtpSenderParameters||t.length!==r.length)return;for(let a=0;a<t.length;a++){const o=t[a],u=r[a];o&&u&&await this.updateRtpSenderEncodings(u,o)}}catch{k.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,r){const a=Ca(t);return r.forEach(((o,u)=>{const h=o._mediaStreamTrack,m=a.mediaDescriptions.find((g=>g.attributes.mid===h.kind));m&&tv(m,o)})),Dh(a)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,a)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,t,r,a)},this.statsFilter.onSelectedLocalCandidateChanged=(t,r)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,t,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,r)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,t,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const r=this.remoteSDP.batchSend(t).map(((u,h)=>{let{id:m,mslabel:g}=u;const{kind:y}=t[h];return new Fe(((E,A)=>{const O=setTimeout((()=>{A(new Error("Cannot receive track, id: ".concat(m)))}),1e4),N=B=>{const U=Lt();if(U.name==="Safari"&&Number(U.version)===11&&B.track.id!==m&&B.streams[0].id===g){var V;const K=B.streams[0].getTracks()[0];return(V=this.remoteSDP)===null||V===void 0||V.updateTrackLabel(y,m,B.track.id),this.peerConnection.removeEventListener("track",N),clearTimeout(O),void E({track:K,id:m})}if(B.track.id===m)return this.peerConnection.removeEventListener("track",N),clearTimeout(O),void E({track:B.track,id:m})};this.peerConnection.addEventListener("track",N)}))})),a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const o=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(o),await Fe.all(r)}catch(r){throw new ve(q.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(r.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;const r=this.remoteSDP.getSSRC(t);return r?.[0].ssrcId}setConfiguration(t){if(Vt().supportPCSetConfiguration){const r=WS.resolvePCConfiguration(t);this.peerConnection.setConfiguration(r)}}},Qe(pn.prototype,"connect",[Xs],Object.getOwnPropertyDescriptor(pn.prototype,"connect"),pn.prototype),Qe(pn.prototype,"stopSending",[Xs],Object.getOwnPropertyDescriptor(pn.prototype,"stopSending"),pn.prototype),Qe(pn.prototype,"receive",[Xs],Object.getOwnPropertyDescriptor(pn.prototype,"receive"),pn.prototype),Qe(pn.prototype,"stopReceiving",[Xs],Object.getOwnPropertyDescriptor(pn.prototype,"stopReceiving"),pn.prototype),Qe(pn.prototype,"muteRemote",[Xs],Object.getOwnPropertyDescriptor(pn.prototype,"muteRemote"),pn.prototype),Qe(pn.prototype,"unmuteRemote",[Xs],Object.getOwnPropertyDescriptor(pn.prototype,"unmuteRemote"),pn.prototype),Qe(pn.prototype,"muteLocal",[Xs],Object.getOwnPropertyDescriptor(pn.prototype,"muteLocal"),pn.prototype),Qe(pn.prototype,"unmuteLocal",[Xs],Object.getOwnPropertyDescriptor(pn.prototype,"unmuteLocal"),pn.prototype),Qe(pn.prototype,"close",[Xs],Object.getOwnPropertyDescriptor(pn.prototype,"close"),pn.prototype),Qe(pn.prototype,"updateEncoderConfig",[Xs],Object.getOwnPropertyDescriptor(pn.prototype,"updateEncoderConfig"),pn.prototype),Qe(pn.prototype,"updateSendParameters",[Xs],Object.getOwnPropertyDescriptor(pn.prototype,"updateSendParameters"),pn.prototype),Qe(pn.prototype,"replaceTrack",[Xs],Object.getOwnPropertyDescriptor(pn.prototype,"replaceTrack"),pn.prototype),Qe(pn.prototype,"getRemoteSSRC",[Xs],Object.getOwnPropertyDescriptor(pn.prototype,"getRemoteSSRC"),pn.prototype),pn);function Xs(e,t,r){const a=e[t];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const o=this.mutex,u=await o.lock("Locking from P2PConnection.".concat(t));try{for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];return await a.apply(this,m)}finally{u()}},r}const Zue={name:"PlanBConnection",create:function(e){let{store:t,spec:r}=e;return new $ue(r,t)}},Que={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Vt().supportWebRTCEncodedTransform)return void k.warning("browser not support audio encoded transform");if(zC.has(e)||!e.track)return;const r={track:e.track};if(Uu()){if(!e.createEncodedStreams)return void k.warning("browser not support createEncodedStreams() API");let o=null;try{o=e.createEncodedStreams()}catch(h){return void k.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){r.controller||(r.controller=m),e.track&&e.track.id!==r.track.id&&(k.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",a),r.track=e.track,r.track.addEventListener("ended",a));const g=t.metadata&&t.metadata();g?(function(y,E){const{chunk:A,controller:O}=E,N=Ph.METADATA;A.data=(function(B,U,V){const K=V.byteLength,z=K+BD+z6,J=jD+VD+z,ae=new ArrayBuffer(B.byteLength+J),ie=new DataView(ae);ie.setUint8(0,W6),ie.setUint16(1,z),ie.setUint8(3,U),ie.setUint16(4,K);for(let le=0;le<K;le++)ie.setUint8(6+le,V[le]);const ee=new Uint8Array(ie.buffer);return ee.set(new Uint8Array(B),J),ee.buffer})(A.data,N,y),O.enqueue(A)})(g,{chunk:h,controller:m}):m.enqueue(h)}});o.readable.pipeThrough(u).pipeTo(o.writable)}else if(Zr()){if(typeof RTCRtpScriptTransform>"u")return void k.warning("browser not support RTCRtpScriptTransform");const o=WC(),u=new MessageChannel;await new Fe((m=>o.onmessage=g=>{g.data==="registered"&&m(void 0)}));const h=new RTCRtpScriptTransform(o,{name:"audio-metadata-tx",port:u.port2},[u.port2]);e.transform=h,await new Fe((m=>o.onmessage=g=>{g.data==="started"&&m(void 0)})),u.port1.onmessage=m=>{var g;if(m.data.transformed&&e.track&&((g=e.track)===null||g===void 0?void 0:g.id)!==r.track.id)k.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",a),r.track=e.track,r.track.addEventListener("ended",a);else if(m.data.getMetadata){const y=t.metadata&&t.metadata();y&&u.port1.postMessage({metadata:y})}},r.worker=o}function a(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",a)}const o=zC.get(e);if(o){zC.delete(e);try{var u,h;(u=o.controller)===null||u===void 0||u.terminate(),(h=o.worker)===null||h===void 0||h.terminate()}catch(m){k.warning(m&&m.message)}}}zC.set(e,r),e.track.addEventListener("ended",a)},interceptRemoteAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Vt().supportWebRTCEncodedTransform)return void k.warning("browser not support audio encoded transform");if($C.has(e))return;const r={track:e.track,onMetadata:t.onMetadata,onPts:t.onPts};if(Uu()&&!Ti()){if(!e.createEncodedStreams)return void k.warning("browser not support createEncodedStreams() API");X1(Gt.CHROME,87,116)||(t.enableTopn=!1);let o=null;try{o=e.createEncodedStreams()}catch(h){return void k.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){r.controller||(r.controller=m),e.track&&e.track.id!==r.track.id&&(k.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",a),r.track=e.track,r.track.addEventListener("ended",a)),t.enableTopn?(function(g,y,E){var A;const O=FD(new DataView(y.data));if(!O)return E.enqueue(y);const N=g.track.id;koe.set(N,g.track);const B=(A=O.tlv.find((ae=>ae.tag===Ph.AUDIO_LEVEL)))===null||A===void 0?void 0:A.value;let U=0;typeof B=="number"&&(U=127-B);const V=Math.round(Math.pow(10,U/60)-1),{selected:K,speaker:z}=(function(ae,ie){let ee=q_.get(ae);if(ee||(ee=(function(le){const ye=new Y6;return q_.set(le,ye),Bc||(Bc=new Doe(X("TOPN_SILENCE_THRESHOLD")||500),Bc.on("ActiveSpeakerChanged",(we=>{we!=null&&(qC=we)}))),Bc.addSpeakers([ye]),ye})(ae)),q_.size<=q6)return{selected:!0,speaker:ee};if(!Bc)throw new Error("no active speaker detector");return Bc.levelChanged(ee.id,ie),Up=Bc.loudest.map((le=>le.id)),qC&&!je(Up).call(Up,qC)&&Up.length>=q6&&Up.pop(),{selected:je(Up).call(Up,ee.id)||ee.id===qC,speaker:ee}})(g,V),J=(function(ae,ie,ee){const le=Fc.get(ae)||new Poe(ae,ie);return le.score=ee,Fc.set(ae,le),(function(ye){if(XC.set(ye,!0),!JC)return void(JC=Date.now());const we=Date.now();we-JC>1e3&&(XC.get(ye)?XC.set(ye,!1):(X6(ye),XC.delete(ye)),JC=we)})(ae),le})(N,g.track,z.energyScore);J.addSample(K),J.active&&(y.data=O.frame.buffer,E.enqueue(y))})(e,h,m):t.enableMetadata||t.enablePts?(function(g,y,E,A){const O=new DataView(g.data),N=O.getUint8(0);let B;if((128&N)!=0&&N!==71){const K=(function(z){if(z.byteLength<=0)return[];const J=[];let ae=0;for(;ae<z.byteLength;){const ee=(128&z.getUint8(ae))>>7,le=127&z.getUint8(ae);if(!(ee&&ae+4<=z.byteLength)){ae++;break}{const ye=z.getUint32(ae,!1),we=(16776192&ye)>>10,Ne=1023&ye;J.push({pt:le,ts_offset:we,length:Ne,data:new Uint8Array}),ae+=4}}let ie=z.byteLength-ae;for(const ee of J){if(ee.length>ie)return console.warn("Broken red payload"),[];ee.length>0&&(ee.data=new Uint8Array(z.buffer,z.byteOffset+ae,ee.length),ae+=ee.length,ie-=ee.length)}if(ie>0){const ee={pt:J.length>0?J[J.length-1].pt:0,ts_offset:0,length:ie,data:new Uint8Array(z.buffer,z.byteOffset+ae,ie)};J.push(ee)}return J})(O);if(K.length>0){const z=(function(J){let ae=0;for(let le=0;le<J.length;le++)ae+=le<J.length-1?4:1,ae+=J[le].length;const ie=new Uint8Array(ae);let ee=0;for(let le=0;le<J.length;le++)if(le<J.length-1){const ye=(2147483648|(127&J[le].pt)<<24|(262143&J[le].ts_offset)<<10|1023&J[le].length)>>>0;ie[ee++]=ye>>24&255,ie[ee++]=ye>>16&255,ie[ee++]=ye>>8&255,ie[ee++]=255&ye}else ie[ee++]=127&J[le].pt;for(const le of J)ie.set(le.data,ee),ee+=le.length;return ie})(K.map((J=>{const ae=new Uint8Array(J.length);ae.set(J.data);const ie=FD(new DataView(ae.buffer));return ie!=null&&ie.frame&&(J.data=ie?.frame),B=ie,J})));g.data=z.buffer}}else B=FD(O),B&&(g.data=B.frame.buffer);if(y.enqueue(g),!B)return;const U=B.tlv.find((K=>K.tag===Ph.METADATA));U&&E&&U.value instanceof Uint8Array&&E(U.value);const V=B.tlv.find((K=>K.tag===Ph.AUDIO_64_BIT_PTS));V&&A&&V.value instanceof Uint8Array&&V.value.length==8&&A(new DataView(V.value.buffer).getBigUint64(0,!0))})(h,m,t.onMetadata,t.onPts):m.enqueue(h)}});o.readable.pipeThrough(u).pipeTo(o.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void k.warning("browser not support RTCRtpScriptTransform");const o=WC(),u=new MessageChannel;await new Fe((m=>o.onmessage=g=>{g.data==="registered"&&m(void 0)}));const h=new RTCRtpScriptTransform(o,{name:"audio-metadata-rx",port:u.port2},[u.port2]);e.transform=h,await new Fe((m=>o.onmessage=g=>{g.data==="started"&&m(void 0)})),u.port1.onmessage=m=>{var g;m.data.transformed&&e.track&&((g=e.track)===null||g===void 0?void 0:g.id)!==r.track.id?(k.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",a),r.track=e.track,r.track.addEventListener("ended",a)):m.data.metadata&&r.onMetadata?r.onMetadata(m.data.metadata):m.data.pts&&r.onPts&&r.onPts(m.data.pts)},r.worker=o}function a(){e.track.removeEventListener("ended",a),(function(o){const u=$C.get(o);if(u){(function(g){const y=q_.get(g);y&&(q_.delete(g),Bc&&(Bc.removeSpeakers([y]),q_.size===0&&(Bc.destroy(),Bc=null)))})(o),X6(o.track.id),$C.delete(o);try{var h,m;(h=u.controller)===null||h===void 0||h.terminate(),(m=u.worker)===null||m===void 0||m.terminate()}catch(g){k.warning(g&&g.message)}}})(e)}$C.set(e,r),e.track.addEventListener("ended",a)},interceptLocalVideoFrame:async function(e,t){if(!Vt().supportWebRTCEncodedTransform)return void k.warning("browser not support video encoded transform");if(ZC.has(e)||!e.track)return;const r={track:e.track};if(Uu()){if(!e.createEncodedStreams)return void k.warning("browser not support createEncodedStreams() API");let o=null;try{o=e.createEncodedStreams()}catch(m){return void k.error("create video-encoded-streams error",m&&m.message)}const u=[];t.on("sei-to-send",(m=>{u.push(m)}));const h=new TransformStream({transform(m,g){r.controller||(r.controller=g),e.track&&e.track.id!==r.track.id&&(k.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",a),r.track=e.track,r.track.addEventListener("ended",a));const y=Z6(new Uint8Array(m.data)),E=u.shift();if(E){const A=(function(O,N,B){switch(B){case zD:return(function(U,V){const K=$6(V),z=K.length,J=Math.floor(z/255),ae=z%255,ie=new Uint8Array(6+J+1+z+U.byteLength);ie[0]=0,ie[1]=0,ie[2]=0,ie[3]=1,ie[4]=6,ie[5]=101;let ee=0;for(;ee<J;)ie[6+ee]=255,ee++;return ie[6+ee]=ae,ee++,ie.set(K,6+ee),ie.set(new Uint8Array(U),6+ee+z),ie.buffer})(O,N);case KD:return(function(U,V){const K=$6(V),z=K.length,J=Math.floor(z/255),ae=z%255,ie=new Uint8Array(7+J+1+z+1+U.byteLength);ie[0]=0,ie[1]=0,ie[2]=0,ie[3]=1,ie[4]=78,ie[5]=1,ie[6]=101;let ee=0;for(;ee<J;)ie[7+ee]=255,ee++;return ie[7+ee]=ae,ee++,ie.set(K,7+ee),ee+=z,ie[7+ee]=128,ee++,ie.set(new Uint8Array(U),7+ee),ie.buffer})(O,N);default:return null}})(m.data,E,y);A&&(m.data=A)}g.enqueue(m)}});o.readable.pipeThrough(h).pipeTo(o.writable)}else{if(!Zr())return;{if(typeof RTCRtpScriptTransform>"u")return void k.warning("browser not support RTCRtpScriptTransform");const o=WC(),u=new MessageChannel;await new Fe((m=>o.onmessage=g=>{g.data==="registered"&&m(void 0)}));const h=new RTCRtpScriptTransform(o,{name:"sei-tx",port:u.port2},[u.port2]);e.transform=h,await new Fe((m=>o.onmessage=g=>{g.data==="started"&&m(void 0)})),t.on("sei-to-send",(m=>{u.port1.postMessage({sei:m})})),u.port1.onmessage=m=>{var g;m.data.transformed&&e.track&&((g=e.track)===null||g===void 0?void 0:g.id)!==r.track.id&&(k.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",a),r.track=e.track,r.track.addEventListener("ended",a))},r.worker=o}}function a(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",a)}const o=ZC.get(e);if(o){ZC.delete(e);try{var u,h;(u=o.controller)===null||u===void 0||u.terminate(),(h=o.worker)===null||h===void 0||h.terminate()}catch(m){k.warning(m&&m.message)}}}ZC.set(e,r),e.track.addEventListener("ended",a)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Vt().supportWebRTCEncodedTransform)return void k.warning("browser not support video encoded transform");if(!e.track)return;if(Z0.has(e)){const o=Z0.get(e);return void(o&&(o.onSei=t.onSei))}const r={track:e.track,onSei:t.onSei};if(Uu()){if(!e.createEncodedStreams)return void k.warning("browser not support createEncodedStreams() API");let o=null;try{o=e.createEncodedStreams()}catch(h){return void k.error("create video-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){r.controller||(r.controller=m),e.track&&e.track.id!==r.track.id&&(k.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",a),r.track=e.track,r.track.addEventListener("ended",a));const g=(function(y,E){switch(E){case zD:return(function(A){const O=new DataView(A.data);let N=0;for(;N+4<A.data.byteLength;){if(O.getUint8(N+0)===0&&O.getUint8(N+1)===0&&O.getUint8(N+2)===0&&O.getUint8(N+3)===1&&O.getUint8(N+4)===6){let B=N+6,U=0,V=0;for(;(V=O.getUint8(B++))===255;)U+=255;U+=V;const K=J6(A.data,B,U);return new Uint8Array(K)}N++}return null})(y);case KD:return(function(A){const O=new DataView(A.data);let N=0;for(;N+5<A.data.byteLength;){if(O.getUint8(N+0)===0&&O.getUint8(N+1)===0&&O.getUint8(N+2)===0&&O.getUint8(N+3)===1&&O.getUint8(N+4)===78&&O.getUint8(N+5)===1&&O.getUint8(N+6)===101){let B=N+7,U=0,V=0;for(;(V=O.getUint8(B++))===255;)U+=255;U+=V;const K=J6(A.data,B,U);return new Uint8Array(K)}N++}return null})(y);default:return null}})(h,Z6(new Uint8Array(h.data)));g&&r.onSei&&r.onSei(g),m.enqueue(h)}});o.readable.pipeThrough(u).pipeTo(o.writable)}else if(Zr()){if(typeof RTCRtpScriptTransform>"u")return void k.warning("browser not support RTCRtpScriptTransform");const o=WC(),u=new MessageChannel;await new Fe((m=>o.onmessage=g=>{g.data==="registered"&&m(void 0)}));const h=new RTCRtpScriptTransform(o,{name:"sei-rx",port:u.port2},[u.port2]);e.transform=h,await new Fe((m=>o.onmessage=g=>{g.data==="started"&&m(void 0)})),u.port1.onmessage=m=>{var g;m.data.transformed&&e.track&&((g=e.track)===null||g===void 0?void 0:g.id)!==r.track.id?(k.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",a),r.track=e.track,r.track.addEventListener("ended",a)):m.data.sei&&r.onSei&&r.onSei(m.data.sei)},r.worker=o}function a(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",a)}(function(o){const u=Z0.get(o);if(u){Z0.delete(o);try{var h,m;(h=u.controller)===null||h===void 0||h.terminate(),(m=u.worker)===null||m===void 0||m.terminate()}catch(g){k.warning(g&&g.message)}}})(e)}Z0.set(e,r),e.track.addEventListener("ended",a)}},ede={name:"InterceptFrame",create:()=>Que};gD(),sn("PROCESS_ID","process-".concat(fn(8,""),"-").concat(fn(4,""),"-").concat(fn(4,""),"-").concat(fn(4,""),"-").concat(fn(12,""))),(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void k.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),r=Date.now();k.debug("Loading global parameters from cache",t),Object.keys(t).forEach((a=>{if(Object.prototype.hasOwnProperty.call(In,a)){const{value:o,expires:u}=t[a];if(u&&u<=r)return;Vc[a]=o,In[a]=o}}))}catch(t){k.error("Error loading mutableParamsCache: ".concat(e),t.message)}})(),Array.isArray(Vc.AREAS)&&Vc.AREAS.length>0&&dP(Vc.AREAS,!0);const JW=(e,t,r)=>{k.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),sn(e,t,r)};Fh(Tue,!1),Fh(Cue,!1),Fh(ale,!1),Fh(Uue,!1),Fh(Eue,!1),Fh(Xue,!1),Fh(Zue,!1),Fh(ede,!1);const or=(function(e){const t=new Mn,r=e,a={getListeners:t.getListeners.bind(t),on:(o,u)=>((function(h,m){h===Ll.SECURITY_POLICY_VIOLATION&&NH(m,!0)})(o,u),t.on.bind(t)(o,u)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return IH(IH({},r),a)})({__TRACK_LIST__:V_,VERSION:Fs,BUILD:yD,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:JW,getParameter:X,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;const r=await(async function(a){let o;return Vt().supportUnifiedPlan?(a.addTransceiver("video",{direction:"recvonly"}),a.addTransceiver("audio",{direction:"recvonly"}),o=(await a.createOffer()).sdp):o=(await a.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,o})(t);if(!r)return e;t.close(),t=null,e=(function(a){const o={video:[],audio:[]};return a.match(/ VP8/i)&&o.video.push("VP8"),a.match(/ VP9/i)&&o.video.push("VP9"),a.match(/ AV1/i)&&o.video.push("AV1"),a.match(/ H264/i)&&o.video.push("H264"),a.match(/ H265/i)&&o.video.push("H265"),a.match(/ opus/i)&&o.audio.push("OPUS"),a.match(/ PCMU/i)&&o.audio.push("PCMU"),a.match(/ PCMA/i)&&o.audio.push("PCMA"),a.match(/ G722/i)&&o.audio.push("G722"),o})(r)}catch(t){throw new fe(q.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){const e=nt.reportApiInvoke(null,{name:Xn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Dn.TRACER});let t=!1;try{const u=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,m=window.WebSocket;t=!!(u&&h&&m),t&&tD()&&JB(75)&&new u().close()}catch(u){return k.error("check system requirement failed: ",u),!1}let r=!1;const a=Lt();a.name===Gt.CHROME&&Number(a.version)>=58&&(Mc.engine.name!=="WebKit"||(function(){const u=Lt();if(AC()){if(u.os===Cr.MAC_OS)return!0;if(u.os===Cr.IOS){const h=Mc.os.version&&Mc.os.version.split(".");if(h&&Number(h[0])===14&&h[1]&&Number(h[1])>=3||h&&Number(h[0])>14)return!0}}return!1})())&&(r=!0),(a.name===Gt.FIREFOX&&Number(a.version)>=56||a.name===Gt.OPERA&&Number(a.version)>=45||a.name===Gt.SAFARI&&Number(a.version)>=11||a.name==="WebKit"&&(Ti()||wo())&&a.osVersion&&Number(a.osVersion.split(".")[0])>=11||n5()||Lt().name===Gt.QQ)&&(r=!0),k.debug("checkSystemRequirements, api:",t,"browser",r);const o=t&&r;return e.onSuccess(o),o},getDevices:function(e){return Ts.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return Ts.getRecordingDevices(e)},getCameras:function(e){return Ts.getCamerasDevices(e)},getElectronScreenSources:J5,getPlaybackDevices:function(e){return Ts.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const r=fn(5,"client-"),a=nt.reportApiInvoke(null,{id:r,name:Xn.CREATE_CLIENT,options:[t],tag:Dn.TRACER});try{(function(o){vr(o.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),vr(o.mode,"config.mode",["rtc","live","p2p"]),o.audioCodec!==void 0&&vr(o.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),o.proxyServer!==void 0&&Gr(o.proxyServer,"config.proxyServer",1,1e4),o.turnServer!==void 0&&u5(o.turnServer),o.httpRetryConfig!==void 0&&l5(o.httpRetryConfig),o.websocketRetryConfig!==void 0&&l5(o.websocketRetryConfig)})(t)}catch(o){throw a.onError(o),o}return(QB(16,0)||Z1(16,0,!0))&&(t.codec==="vp9"&&(t.codec="vp8",k.debug("browser not support vp9, force use vp8")),sn("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),a.onSuccess(),new sle(Po(Po({forceWaitGatewayResponse:!0},t),{},{role:je(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),r)},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=X("CAMERA_CAPTURE_CONFIG"),r=fn(8,"track-cam-"),a=nt.reportApiInvoke(null,{id:r,tag:Dn.TRACER,name:Xn.CREATE_CAM_VIDEO_TRACK,options:[vn({},e),t]});t&&(e.encoderConfig=t);const o=GC(e);let u=null;k.info("start create camera video track with config",JSON.stringify(e),"trackId",r);try{u=(await bs({video:o},r)).getVideoTracks()[0]||null}catch(m){throw a.onError(m),m}if(!u){const m=new ve(q.UNEXPECTED_ERROR,"can not find track in media stream");return a.onError(m),m.throw(k)}if(e.optimizationMode&&UD(r,u,e,Ao(e.encoderConfig)),X("USE_STANDARD_BITRATE_DEFAULT")){const m=Ao(e.encoderConfig);e.encoderConfig=m,delete m.bitrateMax,delete m.bitrateMin}const h=new HC(u,e,o,e.scalabiltyMode?jC(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r);return a.onSuccess(h.getTrackId()),k.info("create camera video success, trackId:",r),h},createCustomVideoTrack:function(e){const t=fn(8,"track-cus-"),r=nt.reportApiInvoke(null,{id:t,tag:Dn.TRACER,name:Xn.CREATE_CUSTOM_VIDEO_TRACK,options:[e]});X("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin);const a=new wn(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?jC(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[un.CUSTOM_TRACK]);return r.onSuccess(a.getTrackId()),k.info("create custom video track success with config",e,"trackId",a.getTrackId()),a},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const r=typeof t=="object"?(function(O){return sF(O)})(t):void 0;r&&(t="auto");const a=fn(8,"track-scr-v-"),o=nt.reportApiInvoke(null,{id:a,tag:Dn.TRACER,name:Xn.CREATE_SCREEN_VIDEO_TRACK,options:[vn({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const u=(function(O){const N={};O.screenSourceType&&(N.mediaSource=O.screenSourceType),O.extensionId&&Uu()&&(N.extensionId=O.extensionId);const{displaySurface:B,selfBrowserSurface:U,surfaceSwitching:V,systemAudio:K,preferCurrentTab:z}=O;(N_(107)||J1(107)||Q1(93))&&(B&&(vr(B,"displaySurface",["browser","window","monitor"]),N.displaySurface=B),U?(vr(U,"selfBrowserSurface",["exclude","include"]),N.selfBrowserSurface=U):N.selfBrowserSurface="include",V&&(vr(V,"surfaceSwitching",["exclude","include"]),N.surfaceSwitching=V)),(N_(105)||J1(105)||Q1(91))&&K&&(vr(K,"systemAudio",["exclude","include"]),N.systemAudio=K),(N_(94)||J1(94)||Q1(80))&&z&&(N.preferCurrentTab=!0),O.electronScreenSourceId&&(N.sourceId=O.electronScreenSourceId);const J=O.encoderConfig?RD(O.encoderConfig):null;return N.mandatory={chromeMediaSource:"desktop",maxWidth:J?J.width:void 0,maxHeight:J?J.height:void 0},J&&(J.frameRate&&(typeof J.frameRate=="number"?(N.mandatory.maxFrameRate=J.frameRate,N.mandatory.minFrameRate=J.frameRate):(N.mandatory.maxFrameRate=J.frameRate.max||J.frameRate.ideal||J.frameRate.exact||void 0,N.mandatory.minFrameRate=J.frameRate.min||J.frameRate.ideal||J.frameRate.exact||void 0),N.frameRate=J.frameRate),J.width&&(N.width=J.width),J.height&&(N.height=J.height)),N})(e);let h=null,m=null;const g=Vt();if(!g.supportShareAudio&&t==="enable"){const O=new ve(q.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return o.onError(O),O.throw(k)}k.info("start create screen video track with config",e,"withAudio",t,"trackId",a);const y=g.supportShareAudio&&t!=="disable";try{const O=await bs({screen:u,screenAudio:y?r||!0:void 0},a);h=O.getVideoTracks()[0]||null,m=O.getAudioTracks()[0]||null}catch(O){throw o.onError(O),O}if(!h){const O=new ve(q.UNEXPECTED_ERROR,"can not find track in media stream");return o.onError(O),O.throw(k)}if(!m&&t==="enable"){h&&h.stop();const O=new ve(q.SHARE_AUDIO_NOT_ALLOWED);return o.onError(O),O.throw(k)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(UD(a,h,e,e.encoderConfig&&RD(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const E=new wn(h,e.encoderConfig?RD(e.encoderConfig):{},e.scalabiltyMode?jC(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,a,[un.SCREEN_TRACK]);if(!m)return o.onSuccess(E.getTrackId()),k.info("create screen video track success","video:",E.getTrackId()),E;const A=new zn(m,void 0,fn(8,"track-scr-a-"),!1);return o.onSuccess([E.getTrackId(),A.getTrackId()]),k.info("create screen video track success","video:",E.getTrackId(),"audio:",A.getTrackId()),[E,A]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=X("CAMERA_CAPTURE_CONFIG"),a=fn(8,"track-mic-"),o=fn(8,"track-cam-"),u=nt.reportApiInvoke(null,{id:"".concat(a,"-").concat(o),tag:Dn.TRACER,name:Xn.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,r]});r&&(t.encoderConfig=r);const h=GC(t),m=oF(e);let g=null,y=null;k.info("start create camera video track(".concat(o,") and microphone audio track(").concat(a,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const O=await bs({audio:m,video:h},"".concat(a,"-").concat(o));g=O.getAudioTracks()[0],y=O.getVideoTracks()[0]}catch(O){throw u.onError(O),O}if(!g||!y){const O=new ve(q.UNEXPECTED_ERROR,"can not find tracks in media stream");return u.onError(O),O.throw(k)}if(t.optimizationMode&&UD(o,y,t,Ao(t.encoderConfig)),X("USE_STANDARD_BITRATE_DEFAULT")){const O=Ao(t.encoderConfig);t.encoderConfig=O,delete O.bitrateMax,delete O.bitrateMin}const E=new $0(g,e,m,a),A=new HC(y,t,h,t.scalabiltyMode?jC(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,o);return u.onSuccess([E.getTrackId(),A.getTrackId()]),k.info("create camera video track(".concat(o,") and microphone audio track(").concat(a,") success")),[E,A]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=fn(8,"track-mic-"),r=nt.reportApiInvoke(null,{id:t,tag:Dn.TRACER,name:Xn.CREATE_MIC_AUDIO_TRACK,options:[e]}),a=oF(e);let o=null;k.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{o=(await bs({audio:a},t)).getAudioTracks()[0]||null}catch(h){throw r.onError(h),h}if(!o){const h=new ve(q.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(h),h.throw(k)}const u=new $0(o,e,a,t);return r.onSuccess(u.getTrackId()),k.info("create microphone audio track success, trackId:",t),u},createCustomAudioTrack:function(e){const t=fn(8,"track-cus-"),r=nt.reportApiInvoke(null,{id:t,tag:Dn.TRACER,name:Xn.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),a=new zn(e.mediaStreamTrack,e.encoderConfig?VC(e.encoderConfig):{},t,!1);return k.info("create custom audio track success with config",e,"trackId",a.getTrackId()),r.onSuccess(a.getTrackId()),a},createBufferSourceAudioTrack:async function(e){var t;const{cacheOnlineFile:r,encoderConfig:a}=e;let{source:o}=e;const u={source:o instanceof AudioBuffer?"AudioBuffer":o instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":o,cacheOnlineFile:r,encoderConfig:a},h=fn(8,"track-buf-"),m=nt.reportApiInvoke(null,{id:h,tag:Dn.TRACER,name:Xn.CREATE_BUFFER_AUDIO_TRACK,options:[u]});if(X("DISABLE_WEBAUDIO"))throw new ve(q.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");k.info("start create buffer source audio track with config",JSON.stringify(u),"trackId",h);const g=o;if(!(o instanceof AudioBuffer))try{o=await(async function(A,O){let N=null;if(typeof A=="string"){const U=YF.get(A);if(U)return k.debug("use cached audio resource: ",A),U;try{N=(await jc((()=>oa.get(A,{responseType:"arraybuffer"})),void 0,void 0,{maxRetryCount:3})).data}catch(V){throw new ve(q.FETCH_AUDIO_FILE_FAILED,V.toString())}}else N=await new Fe(((V,K)=>{const z=new FileReader;z.onload=J=>{J.target?V(J.target.result):K(new ve(q.READ_LOCAL_AUDIO_FILE_ERROR))},z.onerror=()=>{K(new ve(q.READ_LOCAL_AUDIO_FILE_ERROR))},z.readAsArrayBuffer(A)}));const B=await(function(U){const V=W_();return new Fe(((K,z)=>{V.decodeAudioData(U,(J=>{K(J)}),(J=>{z(new ve(q.DECODE_AUDIO_FILE_FAILED,J.toString()))}))}))})(N);return typeof A=="string"&&O&&YF.set(A,B),B})(o,r)}catch(A){return m.onError(A),A.throw(k)}const y=new Aoe(o),E=new Coe(g,y,a?VC(a):{},h);return k.info("create buffer source audio track success, trackId:",h),m.onSuccess(E.getTrackId()),E},setAppType:function(e){if(k.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw k.debug("Invalid appType"),new fe(q.INVALID_PARAMS,"invalid app type",e);sn("APP_TYPE",Math.floor(e))},setLogLevel:function(e){k.setLogLevel(e)},enableLogUpload:function(){X("USE_NEW_LOG")?sn("UPLOAD_LOG",!0):k.enableLogUpload()},disableLogUpload:function(){X("USE_NEW_LOG")?sn("UPLOAD_LOG",!1):k.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new J8},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const r=nt.reportApiInvoke(null,{tag:Dn.TRACER,name:Xn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof zn||e instanceof Y_)){const g=new fe(q.INVALID_TRACK,"the parameter is not a audio track");return r.onError(g),g.throw()}t&&t<1e3&&(t=1e3);const a=e instanceof zn?e.getTrackLabel():"remote_track",o=e.getVolumeLevel();let u=o,h=o;const m=Date.now();return new Fe((g=>{const y=setInterval((()=>{const E=e.getVolumeLevel();u=E>u?E:u,h=E<h?E:h;const A=u-h>1e-4,O=Date.now()-m;if(A||O>t){clearInterval(y);const N=A,B={duration:O,deviceLabel:a,maxVolumeLevel:u,result:N};k.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(B))),r.onSuccess(B),g(N)}}),200)}))},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const r=nt.reportApiInvoke(null,{tag:Dn.TRACER,name:Xn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof wn||e instanceof K_)){const A=new fe(q.INVALID_TRACK,"the parameter is not a video track");return r.onError(A),A.throw()}t&&t<1e3&&(t=1e3);const a=e instanceof wn?e.getTrackLabel():"remote_track",o=e.getMediaStreamTrack(!0),u=document.createElement("video");u.style.width="1px",u.style.height="1px",u.setAttribute("muted",""),u.muted=!0,u.setAttribute("playsinline",""),u.controls=!1,(Zr()||AC())&&(u.style.opacity="0.01",u.style.position="fixed",u.style.left="0",u.style.top="0",document.body.appendChild(u)),u.srcObject=new MediaStream([o]),u.play();const h=document.createElement("canvas");h.width=160,h.height=120;let m=0,g=0;try{const A=Date.now();m=await(function(O,N,B,U){let V,K=0,z=null;return new Fe(((J,ae)=>{function ie(){K>U&&V&&(V(),J(K));const ee=B.getContext("2d");if(!ee){const we=new fe(q.UNEXPECTED_ERROR,"can not get canvas 2d context.");return k.error(we.toString()),void ae(we)}ee.drawImage(O,0,0,160,120);const le=ee.getImageData(0,0,B.width,B.height),ye=Math.floor(le.data.length/3);if(z){for(let we=0;we<ye;we+=3)if(le.data[we]!==z[we])return K+=1,void(z=le.data);z=le.data}else z=le.data}setTimeout((()=>{V&&(V(),J(K))}),N),V=ND((()=>{ie()}),30)}))})(u,t,h,4),g=Date.now()-A}catch(A){throw r.onError(A),A}Kce===Gt.SAFARI&&(u.pause(),u.remove()),u.srcObject=null;const y=m>4,E={duration:g,changedPicNum:m,deviceLabel:a,result:y};return k.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(E))),r.onSuccess(E),y},setArea:dP,audioElementPlayCenter:ca,resumeAudioContext:function(){ca.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){cle.processExternalMediaAEC(e)},registerExtensions:function(e){const t=X("PLUGIN_INFO")||[];e.forEach((r=>{"name"in r&&!je(t).call(t,r.name)&&t.push(r.name);const a=r;a.__registered__=!0,a.logger.hookLog=k.extLog,a.reporter.hookApiInvoke=nt.extApiInvoke,a.parameters&&Object.keys(a.parameters).forEach((o=>{a.parameters[o]=X(o)}))})),JW("PLUGIN_INFO",t)},ChannelMediaRelayError:J_,ChannelMediaRelayEvent:Fu,ChannelMediaRelayState:Oa,RemoteStreamFallbackType:yoe,RemoteStreamType:voe,ConnectionDisconnectedReason:$t,AudienceLatencyLevelType:Xse,AREAS:Kt,preload:async function(e,t,r,a){return EG(e,t,r,a)}});return Object.defineProperties(or,{onAudioAutoplayFailed:{get:()=>ws.onAudioAutoplayFailed,set:e=>{ws.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>ws.onAutoplayFailed,set:e=>{ws.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>or._onSecurityPolicyViolation,set(e){or._onSecurityPolicyViolation=e,NH(e)}},__CLIENT_LIST__:{get:()=>X("SHOW_GLOBAL_CLIENT_LIST")?jp:[]}}),Ts.on(kp.CAMERA_DEVICE_CHANGED,(e=>{k.info("camera device changed",JSON.stringify(e)),or.onCameraChanged&&or.onCameraChanged(e),or.safeEmit(Ll.CAMERA_CHANGED,e)})),Ts.on(kp.RECORDING_DEVICE_CHANGED,(e=>{k.info("microphone device changed",JSON.stringify(e)),or.onMicrophoneChanged&&or.onMicrophoneChanged(e),or.safeEmit(Ll.MICROPHONE_CHANGED,e)})),Ts.on(kp.PLAYOUT_DEVICE_CHANGED,(e=>{k.debug("playout device changed",JSON.stringify(e)),or.onPlaybackDeviceChanged&&or.onPlaybackDeviceChanged(e),or.safeEmit(Ll.PLAYBACK_DEVICE_CHANGED,e)})),ca.onAutoplayFailed=()=>{k.info("detect audio element autoplay failed"),ws.onAudioAutoplayFailed&&ws.onAudioAutoplayFailed()},on.on("autoplay-failed",(()=>{k.info("detect webaudio autoplay failed"),ws.onAudioAutoplayFailed&&ws.onAudioAutoplayFailed(),or.safeEmit(Ll.AUTOPLAY_FAILED)})),on.on(zr.STATE_CHANGE,((e,t)=>{k.info("audio context state changed: ".concat(t," => ").concat(e)),or.onAudioContextStateChanged&&or.onAudioContextStateChanged(e,t),or.safeEmit(Ll.AUDIO_CONTEXT_STATE_CHANGED,e,t)})),nr.on(D_.NETWORK_STATE_CHANGE,((e,t)=>{k.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))})),window&&(window.__ARTC__=or),or}))})(TO)),TO.exports}var Hhe=Ghe();const eO=fd(Hhe),Whe="modulepreload",zhe=function(n){return"/"+n},fz={},Khe=function(i,s,c){let f=Promise.resolve();if(s&&s.length>0){let T=function(w){return Promise.all(w.map(C=>Promise.resolve(C).then(I=>({status:"fulfilled",value:I}),I=>({status:"rejected",reason:I}))))};document.getElementsByTagName("link");const v=document.querySelector("meta[property=csp-nonce]"),b=v?.nonce||v?.getAttribute("nonce");f=T(s.map(w=>{if(w=zhe(w),w in fz)return;fz[w]=!0;const C=w.endsWith(".css"),I=C?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${w}"]${I}`))return;const D=document.createElement("link");if(D.rel=C?"stylesheet":Whe,C||(D.as="script"),D.crossOrigin="",D.href=w,b&&D.setAttribute("nonce",b),document.head.appendChild(D),C)return new Promise((L,F)=>{D.addEventListener("load",L),D.addEventListener("error",()=>F(new Error(`Unable to preload CSS for ${w}`)))})}))}function p(v){const b=new Event("vite:preloadError",{cancelable:!0});if(b.payload=v,window.dispatchEvent(b),!b.defaultPrevented)throw v}return f.then(v=>{for(const b of v||[])b.status==="rejected"&&p(b.reason);return i().catch(p)})};/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yhe=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),qhe=n=>n.replace(/^([A-Z])|[\s-_]+(\w)/g,(i,s,c)=>c?c.toUpperCase():s.toLowerCase()),pz=n=>{const i=qhe(n);return i.charAt(0).toUpperCase()+i.slice(1)},Yq=(...n)=>n.filter((i,s,c)=>!!i&&i.trim()!==""&&c.indexOf(i)===s).join(" ").trim(),Xhe=n=>{for(const i in n)if(i.startsWith("aria-")||i==="role"||i==="title")return!0};/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Jhe={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $he=j.forwardRef(({color:n="currentColor",size:i=24,strokeWidth:s=2,absoluteStrokeWidth:c,className:f="",children:p,iconNode:v,...b},T)=>j.createElement("svg",{ref:T,...Jhe,width:i,height:i,stroke:n,strokeWidth:c?Number(s)*24/Number(i):s,className:Yq("lucide",f),...!p&&!Xhe(b)&&{"aria-hidden":"true"},...b},[...v.map(([w,C])=>j.createElement(w,C)),...Array.isArray(p)?p:[p]]));/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=(n,i)=>{const s=j.forwardRef(({className:c,...f},p)=>j.createElement($he,{ref:p,iconNode:i,className:Yq(`lucide-${Yhe(pz(n))}`,`lucide-${n}`,c),...f}));return s.displayName=pz(n),s};/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zhe=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],qq=At("activity",Zhe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qhe=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Xq=At("arrow-left",Qhe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const efe=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],Jq=At("arrow-right",efe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tfe=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],nfe=At("bell",tfe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rfe=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],$q=At("book-open",rfe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ife=[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]],mz=At("book",ife);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const afe=[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]],Zq=At("brain",afe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sfe=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],ofe=At("calendar",sfe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cfe=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],dM=At("check",cfe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lfe=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],ufe=At("chevron-down",lfe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dfe=[["path",{d:"m11 17-5-5 5-5",key:"13zhaf"}],["path",{d:"m18 17-5-5 5-5",key:"h8a8et"}]],hfe=At("chevrons-left",dfe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ffe=[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]],pfe=At("chevrons-right",ffe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mfe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],gfe=At("circle-check",mfe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _fe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],gz=At("circle-plus",_fe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vfe=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],yfe=At("clock",vfe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Efe=[["path",{d:"M12 13v8l-4-4",key:"1f5nwf"}],["path",{d:"m12 21 4-4",key:"1lfcce"}],["path",{d:"M4.393 15.269A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.436 8.284",key:"ui1hmy"}]],Sfe=At("cloud-download",Efe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bfe=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],_k=At("download",bfe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tfe=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],wfe=At("eye-off",Tfe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rfe=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Qq=At("eye",Rfe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cfe=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]],Afe=At("file-down",Cfe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ofe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M16 16s-1.5-2-4-2-4 2-4 2",key:"epbg0q"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]],Ife=At("frown",Ofe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nfe=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],eX=At("funnel",Nfe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xfe=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}],["path",{d:"M3.22 13H9.5l.5-1 2 4.5 2-7 1.5 3.5h5.27",key:"auskq0"}]],Dfe=At("heart-pulse",xfe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pfe=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],kfe=At("layout-dashboard",Pfe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lfe=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],Mfe=At("lock",Lfe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ufe=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],wO=At("log-out",Ufe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jfe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"8",x2:"16",y1:"15",y2:"15",key:"1xb1d9"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]],Vfe=At("meh",jfe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bfe=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],tX=At("menu",Bfe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ffe=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],nX=At("message-square",Ffe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gfe=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M16.95 16.95A7 7 0 0 1 5 12v-2",key:"cqa7eg"}],["path",{d:"M18.89 13.23A7 7 0 0 0 19 12v-2",key:"16hl24"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}]],Hfe=At("mic-off",Gfe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wfe=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],zfe=At("mic",Wfe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kfe=[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]],P2=At("moon",Kfe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yfe=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],qfe=At("pause",Yfe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xfe=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],_z=At("pen-line",Xfe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jfe=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],kO=At("play",Jfe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $fe=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],Zfe=At("refresh-cw",$fe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qfe=[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]],epe=At("repeat",Qfe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tpe=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],npe=At("save",tpe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rpe=[["path",{d:"M13 3H4a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-3",key:"i8wdob"}],["path",{d:"M8 21h8",key:"1ev6f3"}],["path",{d:"M12 17v4",key:"1riwvh"}],["path",{d:"m17 8 5-5",key:"fqif7o"}],["path",{d:"M17 3h5v5",key:"1o3tu8"}]],ipe=At("screen-share",rpe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ape=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],RI=At("search",ape);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const spe=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],ope=At("send",spe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cpe=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],LO=At("settings",cpe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lpe=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],upe=At("shield-check",lpe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dpe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]],hpe=At("smile",dpe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fpe=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],ppe=At("sparkles",fpe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mpe=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],vz=At("star",mpe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gpe=[["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M14.837 16.385a6 6 0 1 1-7.223-7.222c.624-.147.97.66.715 1.248a4 4 0 0 0 5.26 5.259c.589-.255 1.396.09 1.248.715",key:"xlf6rm"}],["path",{d:"M16 12a4 4 0 0 0-4-4",key:"6vsxu"}],["path",{d:"m19 5-1.256 1.256",key:"1yg6a6"}],["path",{d:"M20 12h2",key:"1q8mjw"}]],_pe=At("sun-moon",gpe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vpe=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],ype=At("sun",vpe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Epe=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],hM=At("trash-2",Epe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Spe=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],bpe=At("triangle-alert",Spe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tpe=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],wpe=At("user-minus",Tpe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rpe=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],Cpe=At("user-plus",Rpe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ape=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],Ope=At("user",Ape);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ipe=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],rX=At("users",Ipe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Npe=[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.5l5.248-3.062A.5.5 0 0 1 22 7.87v8.196",key:"w8jjjt"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2",key:"1xawa7"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],xpe=At("video-off",Npe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dpe=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],iX=At("video",Dpe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ppe=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],kpe=At("volume-2",Ppe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lpe=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]],Mpe=At("volume-x",Lpe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Upe=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],rb=At("x",Upe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jpe=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],af=At("zap",jpe),k2=j.createContext({});function Rb(n){const i=j.useRef(null);return i.current===null&&(i.current=n()),i.current}const L2=typeof window<"u",M2=L2?j.useLayoutEffect:j.useEffect,CI=j.createContext(null);function U2(n,i){n.indexOf(i)===-1&&n.push(i)}function j2(n,i){const s=n.indexOf(i);s>-1&&n.splice(s,1)}const ad=(n,i,s)=>s>i?i:s<n?n:s;let V2=()=>{};const sd={},aX=n=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(n);function sX(n){return typeof n=="object"&&n!==null}const oX=n=>/^0[^.\s]+$/u.test(n);function B2(n){let i;return()=>(i===void 0&&(i=n()),i)}const Ko=n=>n,Vpe=(n,i)=>s=>i(n(s)),Cb=(...n)=>n.reduce(Vpe),ib=(n,i,s)=>{const c=i-n;return c===0?1:(s-n)/c};class F2{constructor(){this.subscriptions=[]}add(i){return U2(this.subscriptions,i),()=>j2(this.subscriptions,i)}notify(i,s,c){const f=this.subscriptions.length;if(f)if(f===1)this.subscriptions[0](i,s,c);else for(let p=0;p<f;p++){const v=this.subscriptions[p];v&&v(i,s,c)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const Kl=n=>n*1e3,Ho=n=>n/1e3;function cX(n,i){return i?n*(1e3/i):0}const lX=(n,i,s)=>(((1-3*s+3*i)*n+(3*s-6*i))*n+3*i)*n,Bpe=1e-7,Fpe=12;function Gpe(n,i,s,c,f){let p,v,b=0;do v=i+(s-i)/2,p=lX(v,c,f)-n,p>0?s=v:i=v;while(Math.abs(p)>Bpe&&++b<Fpe);return v}function Ab(n,i,s,c){if(n===i&&s===c)return Ko;const f=p=>Gpe(p,0,1,n,s);return p=>p===0||p===1?p:lX(f(p),i,c)}const uX=n=>i=>i<=.5?n(2*i)/2:(2-n(2*(1-i)))/2,dX=n=>i=>1-n(1-i),hX=Ab(.33,1.53,.69,.99),G2=dX(hX),fX=uX(G2),pX=n=>(n*=2)<1?.5*G2(n):.5*(2-Math.pow(2,-10*(n-1))),H2=n=>1-Math.sin(Math.acos(n)),mX=dX(H2),gX=uX(H2),Hpe=Ab(.42,0,1,1),Wpe=Ab(0,0,.58,1),_X=Ab(.42,0,.58,1),zpe=n=>Array.isArray(n)&&typeof n[0]!="number",vX=n=>Array.isArray(n)&&typeof n[0]=="number",Kpe={linear:Ko,easeIn:Hpe,easeInOut:_X,easeOut:Wpe,circIn:H2,circInOut:gX,circOut:mX,backIn:G2,backInOut:fX,backOut:hX,anticipate:pX},Ype=n=>typeof n=="string",yz=n=>{if(vX(n)){V2(n.length===4);const[i,s,c,f]=n;return Ab(i,s,c,f)}else if(Ype(n))return Kpe[n];return n},tO=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function qpe(n,i){let s=new Set,c=new Set,f=!1,p=!1;const v=new WeakSet;let b={delta:0,timestamp:0,isProcessing:!1};function T(C){v.has(C)&&(w.schedule(C),n()),C(b)}const w={schedule:(C,I=!1,D=!1)=>{const F=D&&f?s:c;return I&&v.add(C),F.has(C)||F.add(C),C},cancel:C=>{c.delete(C),v.delete(C)},process:C=>{if(b=C,f){p=!0;return}f=!0,[s,c]=[c,s],s.forEach(T),s.clear(),f=!1,p&&(p=!1,w.process(C))}};return w}const Xpe=40;function yX(n,i){let s=!1,c=!0;const f={delta:0,timestamp:0,isProcessing:!1},p=()=>s=!0,v=tO.reduce((Z,ce)=>(Z[ce]=qpe(p),Z),{}),{setup:b,read:T,resolveKeyframes:w,preUpdate:C,update:I,preRender:D,render:L,postRender:F}=v,W=()=>{const Z=sd.useManualTiming?f.timestamp:performance.now();s=!1,sd.useManualTiming||(f.delta=c?1e3/60:Math.max(Math.min(Z-f.timestamp,Xpe),1)),f.timestamp=Z,f.isProcessing=!0,b.process(f),T.process(f),w.process(f),C.process(f),I.process(f),D.process(f),L.process(f),F.process(f),f.isProcessing=!1,s&&i&&(c=!1,n(W))},G=()=>{s=!0,c=!0,f.isProcessing||n(W)};return{schedule:tO.reduce((Z,ce)=>{const se=v[ce];return Z[ce]=(de,oe=!1,ge=!1)=>(s||G(),se.schedule(de,oe,ge)),Z},{}),cancel:Z=>{for(let ce=0;ce<tO.length;ce++)v[tO[ce]].cancel(Z)},state:f,steps:v}}const{schedule:Sr,cancel:od,state:fa,steps:vk}=yX(typeof requestAnimationFrame<"u"?requestAnimationFrame:Ko,!0);let RO;function Jpe(){RO=void 0}const Is={now:()=>(RO===void 0&&Is.set(fa.isProcessing||sd.useManualTiming?fa.timestamp:performance.now()),RO),set:n=>{RO=n,queueMicrotask(Jpe)}},EX=n=>i=>typeof i=="string"&&i.startsWith(n),W2=EX("--"),$pe=EX("var(--"),z2=n=>$pe(n)?Zpe.test(n.split("/*")[0].trim()):!1,Zpe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Hv={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},ab={...Hv,transform:n=>ad(0,1,n)},nO={...Hv,default:1},qS=n=>Math.round(n*1e5)/1e5,K2=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function Qpe(n){return n==null}const eme=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Y2=(n,i)=>s=>!!(typeof s=="string"&&eme.test(s)&&s.startsWith(n)||i&&!Qpe(s)&&Object.prototype.hasOwnProperty.call(s,i)),SX=(n,i,s)=>c=>{if(typeof c!="string")return c;const[f,p,v,b]=c.match(K2);return{[n]:parseFloat(f),[i]:parseFloat(p),[s]:parseFloat(v),alpha:b!==void 0?parseFloat(b):1}},tme=n=>ad(0,255,n),yk={...Hv,transform:n=>Math.round(tme(n))},om={test:Y2("rgb","red"),parse:SX("red","green","blue"),transform:({red:n,green:i,blue:s,alpha:c=1})=>"rgba("+yk.transform(n)+", "+yk.transform(i)+", "+yk.transform(s)+", "+qS(ab.transform(c))+")"};function nme(n){let i="",s="",c="",f="";return n.length>5?(i=n.substring(1,3),s=n.substring(3,5),c=n.substring(5,7),f=n.substring(7,9)):(i=n.substring(1,2),s=n.substring(2,3),c=n.substring(3,4),f=n.substring(4,5),i+=i,s+=s,c+=c,f+=f),{red:parseInt(i,16),green:parseInt(s,16),blue:parseInt(c,16),alpha:f?parseInt(f,16)/255:1}}const fM={test:Y2("#"),parse:nme,transform:om.transform},Ob=n=>({test:i=>typeof i=="string"&&i.endsWith(n)&&i.split(" ").length===1,parse:parseFloat,transform:i=>`${i}${n}`}),Qh=Ob("deg"),Yl=Ob("%"),Yt=Ob("px"),rme=Ob("vh"),ime=Ob("vw"),Ez={...Yl,parse:n=>Yl.parse(n)/100,transform:n=>Yl.transform(n*100)},Ev={test:Y2("hsl","hue"),parse:SX("hue","saturation","lightness"),transform:({hue:n,saturation:i,lightness:s,alpha:c=1})=>"hsla("+Math.round(n)+", "+Yl.transform(qS(i))+", "+Yl.transform(qS(s))+", "+qS(ab.transform(c))+")"},Ri={test:n=>om.test(n)||fM.test(n)||Ev.test(n),parse:n=>om.test(n)?om.parse(n):Ev.test(n)?Ev.parse(n):fM.parse(n),transform:n=>typeof n=="string"?n:n.hasOwnProperty("red")?om.transform(n):Ev.transform(n),getAnimatableNone:n=>{const i=Ri.parse(n);return i.alpha=0,Ri.transform(i)}},ame=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function sme(n){return isNaN(n)&&typeof n=="string"&&(n.match(K2)?.length||0)+(n.match(ame)?.length||0)>0}const bX="number",TX="color",ome="var",cme="var(",Sz="${}",lme=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function sb(n){const i=n.toString(),s=[],c={color:[],number:[],var:[]},f=[];let p=0;const b=i.replace(lme,T=>(Ri.test(T)?(c.color.push(p),f.push(TX),s.push(Ri.parse(T))):T.startsWith(cme)?(c.var.push(p),f.push(ome),s.push(T)):(c.number.push(p),f.push(bX),s.push(parseFloat(T))),++p,Sz)).split(Sz);return{values:s,split:b,indexes:c,types:f}}function wX(n){return sb(n).values}function RX(n){const{split:i,types:s}=sb(n),c=i.length;return f=>{let p="";for(let v=0;v<c;v++)if(p+=i[v],f[v]!==void 0){const b=s[v];b===bX?p+=qS(f[v]):b===TX?p+=Ri.transform(f[v]):p+=f[v]}return p}}const ume=n=>typeof n=="number"?0:Ri.test(n)?Ri.getAnimatableNone(n):n;function dme(n){const i=wX(n);return RX(n)(i.map(ume))}const of={test:sme,parse:wX,createTransformer:RX,getAnimatableNone:dme};function Ek(n,i,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?n+(i-n)*6*s:s<1/2?i:s<2/3?n+(i-n)*(2/3-s)*6:n}function hme({hue:n,saturation:i,lightness:s,alpha:c}){n/=360,i/=100,s/=100;let f=0,p=0,v=0;if(!i)f=p=v=s;else{const b=s<.5?s*(1+i):s+i-s*i,T=2*s-b;f=Ek(T,b,n+1/3),p=Ek(T,b,n),v=Ek(T,b,n-1/3)}return{red:Math.round(f*255),green:Math.round(p*255),blue:Math.round(v*255),alpha:c}}function MO(n,i){return s=>s>0?i:n}const Yr=(n,i,s)=>n+(i-n)*s,Sk=(n,i,s)=>{const c=n*n,f=s*(i*i-c)+c;return f<0?0:Math.sqrt(f)},fme=[fM,om,Ev],pme=n=>fme.find(i=>i.test(n));function bz(n){const i=pme(n);if(!i)return!1;let s=i.parse(n);return i===Ev&&(s=hme(s)),s}const Tz=(n,i)=>{const s=bz(n),c=bz(i);if(!s||!c)return MO(n,i);const f={...s};return p=>(f.red=Sk(s.red,c.red,p),f.green=Sk(s.green,c.green,p),f.blue=Sk(s.blue,c.blue,p),f.alpha=Yr(s.alpha,c.alpha,p),om.transform(f))},pM=new Set(["none","hidden"]);function mme(n,i){return pM.has(n)?s=>s<=0?n:i:s=>s>=1?i:n}function gme(n,i){return s=>Yr(n,i,s)}function q2(n){return typeof n=="number"?gme:typeof n=="string"?z2(n)?MO:Ri.test(n)?Tz:yme:Array.isArray(n)?CX:typeof n=="object"?Ri.test(n)?Tz:_me:MO}function CX(n,i){const s=[...n],c=s.length,f=n.map((p,v)=>q2(p)(p,i[v]));return p=>{for(let v=0;v<c;v++)s[v]=f[v](p);return s}}function _me(n,i){const s={...n,...i},c={};for(const f in s)n[f]!==void 0&&i[f]!==void 0&&(c[f]=q2(n[f])(n[f],i[f]));return f=>{for(const p in c)s[p]=c[p](f);return s}}function vme(n,i){const s=[],c={color:0,var:0,number:0};for(let f=0;f<i.values.length;f++){const p=i.types[f],v=n.indexes[p][c[p]],b=n.values[v]??0;s[f]=b,c[p]++}return s}const yme=(n,i)=>{const s=of.createTransformer(i),c=sb(n),f=sb(i);return c.indexes.var.length===f.indexes.var.length&&c.indexes.color.length===f.indexes.color.length&&c.indexes.number.length>=f.indexes.number.length?pM.has(n)&&!f.values.length||pM.has(i)&&!c.values.length?mme(n,i):Cb(CX(vme(c,f),f.values),s):MO(n,i)};function AX(n,i,s){return typeof n=="number"&&typeof i=="number"&&typeof s=="number"?Yr(n,i,s):q2(n)(n,i)}const Eme=n=>{const i=({timestamp:s})=>n(s);return{start:(s=!0)=>Sr.update(i,s),stop:()=>od(i),now:()=>fa.isProcessing?fa.timestamp:Is.now()}},OX=(n,i,s=10)=>{let c="";const f=Math.max(Math.round(i/s),2);for(let p=0;p<f;p++)c+=Math.round(n(p/(f-1))*1e4)/1e4+", ";return`linear(${c.substring(0,c.length-2)})`},UO=2e4;function X2(n){let i=0;const s=50;let c=n.next(i);for(;!c.done&&i<UO;)i+=s,c=n.next(i);return i>=UO?1/0:i}function Sme(n,i=100,s){const c=s({...n,keyframes:[0,i]}),f=Math.min(X2(c),UO);return{type:"keyframes",ease:p=>c.next(f*p).value/i,duration:Ho(f)}}const bme=5;function IX(n,i,s){const c=Math.max(i-bme,0);return cX(s-n(c),i-c)}const ii={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},bk=.001;function Tme({duration:n=ii.duration,bounce:i=ii.bounce,velocity:s=ii.velocity,mass:c=ii.mass}){let f,p,v=1-i;v=ad(ii.minDamping,ii.maxDamping,v),n=ad(ii.minDuration,ii.maxDuration,Ho(n)),v<1?(f=w=>{const C=w*v,I=C*n,D=C-s,L=mM(w,v),F=Math.exp(-I);return bk-D/L*F},p=w=>{const I=w*v*n,D=I*s+s,L=Math.pow(v,2)*Math.pow(w,2)*n,F=Math.exp(-I),W=mM(Math.pow(w,2),v);return(-f(w)+bk>0?-1:1)*((D-L)*F)/W}):(f=w=>{const C=Math.exp(-w*n),I=(w-s)*n+1;return-bk+C*I},p=w=>{const C=Math.exp(-w*n),I=(s-w)*(n*n);return C*I});const b=5/n,T=Rme(f,p,b);if(n=Kl(n),isNaN(T))return{stiffness:ii.stiffness,damping:ii.damping,duration:n};{const w=Math.pow(T,2)*c;return{stiffness:w,damping:v*2*Math.sqrt(c*w),duration:n}}}const wme=12;function Rme(n,i,s){let c=s;for(let f=1;f<wme;f++)c=c-n(c)/i(c);return c}function mM(n,i){return n*Math.sqrt(1-i*i)}const Cme=["duration","bounce"],Ame=["stiffness","damping","mass"];function wz(n,i){return i.some(s=>n[s]!==void 0)}function Ome(n){let i={velocity:ii.velocity,stiffness:ii.stiffness,damping:ii.damping,mass:ii.mass,isResolvedFromDuration:!1,...n};if(!wz(n,Ame)&&wz(n,Cme))if(n.visualDuration){const s=n.visualDuration,c=2*Math.PI/(s*1.2),f=c*c,p=2*ad(.05,1,1-(n.bounce||0))*Math.sqrt(f);i={...i,mass:ii.mass,stiffness:f,damping:p}}else{const s=Tme(n);i={...i,...s,mass:ii.mass},i.isResolvedFromDuration=!0}return i}function jO(n=ii.visualDuration,i=ii.bounce){const s=typeof n!="object"?{visualDuration:n,keyframes:[0,1],bounce:i}:n;let{restSpeed:c,restDelta:f}=s;const p=s.keyframes[0],v=s.keyframes[s.keyframes.length-1],b={done:!1,value:p},{stiffness:T,damping:w,mass:C,duration:I,velocity:D,isResolvedFromDuration:L}=Ome({...s,velocity:-Ho(s.velocity||0)}),F=D||0,W=w/(2*Math.sqrt(T*C)),G=v-p,$=Ho(Math.sqrt(T/C)),te=Math.abs(G)<5;c||(c=te?ii.restSpeed.granular:ii.restSpeed.default),f||(f=te?ii.restDelta.granular:ii.restDelta.default);let Z;if(W<1){const se=mM($,W);Z=de=>{const oe=Math.exp(-W*$*de);return v-oe*((F+W*$*G)/se*Math.sin(se*de)+G*Math.cos(se*de))}}else if(W===1)Z=se=>v-Math.exp(-$*se)*(G+(F+$*G)*se);else{const se=$*Math.sqrt(W*W-1);Z=de=>{const oe=Math.exp(-W*$*de),ge=Math.min(se*de,300);return v-oe*((F+W*$*G)*Math.sinh(ge)+se*G*Math.cosh(ge))/se}}const ce={calculatedDuration:L&&I||null,next:se=>{const de=Z(se);if(L)b.done=se>=I;else{let oe=se===0?F:0;W<1&&(oe=se===0?Kl(F):IX(Z,se,de));const ge=Math.abs(oe)<=c,Ae=Math.abs(v-de)<=f;b.done=ge&&Ae}return b.value=b.done?v:de,b},toString:()=>{const se=Math.min(X2(ce),UO),de=OX(oe=>ce.next(se*oe).value,se,30);return se+"ms "+de},toTransition:()=>{}};return ce}jO.applyToOptions=n=>{const i=Sme(n,100,jO);return n.ease=i.ease,n.duration=Kl(i.duration),n.type="keyframes",n};function gM({keyframes:n,velocity:i=0,power:s=.8,timeConstant:c=325,bounceDamping:f=10,bounceStiffness:p=500,modifyTarget:v,min:b,max:T,restDelta:w=.5,restSpeed:C}){const I=n[0],D={done:!1,value:I},L=ge=>b!==void 0&&ge<b||T!==void 0&&ge>T,F=ge=>b===void 0?T:T===void 0||Math.abs(b-ge)<Math.abs(T-ge)?b:T;let W=s*i;const G=I+W,$=v===void 0?G:v(G);$!==G&&(W=$-I);const te=ge=>-W*Math.exp(-ge/c),Z=ge=>$+te(ge),ce=ge=>{const Ae=te(ge),ke=Z(ge);D.done=Math.abs(Ae)<=w,D.value=D.done?$:ke};let se,de;const oe=ge=>{L(D.value)&&(se=ge,de=jO({keyframes:[D.value,F(D.value)],velocity:IX(Z,ge,D.value),damping:f,stiffness:p,restDelta:w,restSpeed:C}))};return oe(0),{calculatedDuration:null,next:ge=>{let Ae=!1;return!de&&se===void 0&&(Ae=!0,ce(ge),oe(ge)),se!==void 0&&ge>=se?de.next(ge-se):(!Ae&&ce(ge),D)}}}function Ime(n,i,s){const c=[],f=s||sd.mix||AX,p=n.length-1;for(let v=0;v<p;v++){let b=f(n[v],n[v+1]);if(i){const T=Array.isArray(i)?i[v]||Ko:i;b=Cb(T,b)}c.push(b)}return c}function NX(n,i,{clamp:s=!0,ease:c,mixer:f}={}){const p=n.length;if(V2(p===i.length),p===1)return()=>i[0];if(p===2&&i[0]===i[1])return()=>i[1];const v=n[0]===n[1];n[0]>n[p-1]&&(n=[...n].reverse(),i=[...i].reverse());const b=Ime(i,c,f),T=b.length,w=C=>{if(v&&C<n[0])return i[0];let I=0;if(T>1)for(;I<n.length-2&&!(C<n[I+1]);I++);const D=ib(n[I],n[I+1],C);return b[I](D)};return s?C=>w(ad(n[0],n[p-1],C)):w}function Nme(n,i){const s=n[n.length-1];for(let c=1;c<=i;c++){const f=ib(0,i,c);n.push(Yr(s,1,f))}}function xme(n){const i=[0];return Nme(i,n.length-1),i}function Dme(n,i){return n.map(s=>s*i)}function Pme(n,i){return n.map(()=>i||_X).splice(0,n.length-1)}function XS({duration:n=300,keyframes:i,times:s,ease:c="easeInOut"}){const f=zpe(c)?c.map(yz):yz(c),p={done:!1,value:i[0]},v=Dme(s&&s.length===i.length?s:xme(i),n),b=NX(v,i,{ease:Array.isArray(f)?f:Pme(i,f)});return{calculatedDuration:n,next:T=>(p.value=b(T),p.done=T>=n,p)}}const kme=n=>n!==null;function J2(n,{repeat:i,repeatType:s="loop"},c,f=1){const p=n.filter(kme),b=f<0||i&&s!=="loop"&&i%2===1?0:p.length-1;return!b||c===void 0?p[b]:c}const Lme={decay:gM,inertia:gM,tween:XS,keyframes:XS,spring:jO};function xX(n){typeof n.type=="string"&&(n.type=Lme[n.type])}class $2{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(i=>{this.resolve=i})}notifyFinished(){this.resolve()}then(i,s){return this.finished.then(i,s)}}const Mme=n=>n/100;class AI extends $2{constructor(i){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:s}=this.options;s&&s.updatedAt!==Is.now()&&this.tick(Is.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=i,this.initAnimation(),this.play(),i.autoplay===!1&&this.pause()}initAnimation(){const{options:i}=this;xX(i);const{type:s=XS,repeat:c=0,repeatDelay:f=0,repeatType:p,velocity:v=0}=i;let{keyframes:b}=i;const T=s||XS;T!==XS&&typeof b[0]!="number"&&(this.mixKeyframes=Cb(Mme,AX(b[0],b[1])),b=[0,100]);const w=T({...i,keyframes:b});p==="mirror"&&(this.mirroredGenerator=T({...i,keyframes:[...b].reverse(),velocity:-v})),w.calculatedDuration===null&&(w.calculatedDuration=X2(w));const{calculatedDuration:C}=w;this.calculatedDuration=C,this.resolvedDuration=C+f,this.totalDuration=this.resolvedDuration*(c+1)-f,this.generator=w}updateTime(i){const s=Math.round(i-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=s}tick(i,s=!1){const{generator:c,totalDuration:f,mixKeyframes:p,mirroredGenerator:v,resolvedDuration:b,calculatedDuration:T}=this;if(this.startTime===null)return c.next(0);const{delay:w=0,keyframes:C,repeat:I,repeatType:D,repeatDelay:L,type:F,onUpdate:W,finalKeyframe:G}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,i):this.speed<0&&(this.startTime=Math.min(i-f/this.speed,this.startTime)),s?this.currentTime=i:this.updateTime(i);const $=this.currentTime-w*(this.playbackSpeed>=0?1:-1),te=this.playbackSpeed>=0?$<0:$>f;this.currentTime=Math.max($,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=f);let Z=this.currentTime,ce=c;if(I){const ge=Math.min(this.currentTime,f)/b;let Ae=Math.floor(ge),ke=ge%1;!ke&&ge>=1&&(ke=1),ke===1&&Ae--,Ae=Math.min(Ae,I+1),!!(Ae%2)&&(D==="reverse"?(ke=1-ke,L&&(ke-=L/b)):D==="mirror"&&(ce=v)),Z=ad(0,1,ke)*b}const se=te?{done:!1,value:C[0]}:ce.next(Z);p&&(se.value=p(se.value));let{done:de}=se;!te&&T!==null&&(de=this.playbackSpeed>=0?this.currentTime>=f:this.currentTime<=0);const oe=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&de);return oe&&F!==gM&&(se.value=J2(C,this.options,G,this.speed)),W&&W(se.value),oe&&this.finish(),se}then(i,s){return this.finished.then(i,s)}get duration(){return Ho(this.calculatedDuration)}get iterationDuration(){const{delay:i=0}=this.options||{};return this.duration+Ho(i)}get time(){return Ho(this.currentTime)}set time(i){i=Kl(i),this.currentTime=i,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=i:this.driver&&(this.startTime=this.driver.now()-i/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(i){this.updateTime(Is.now());const s=this.playbackSpeed!==i;this.playbackSpeed=i,s&&(this.time=Ho(this.currentTime))}play(){if(this.isStopped)return;const{driver:i=Eme,startTime:s}=this.options;this.driver||(this.driver=i(f=>this.tick(f))),this.options.onPlay?.();const c=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=c):this.holdTime!==null?this.startTime=c-this.holdTime:this.startTime||(this.startTime=s??c),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Is.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(i){return this.startTime=0,this.tick(i,!0)}attachTimeline(i){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),i.observe(this)}}function Ume(n){for(let i=1;i<n.length;i++)n[i]??(n[i]=n[i-1])}const cm=n=>n*180/Math.PI,_M=n=>{const i=cm(Math.atan2(n[1],n[0]));return vM(i)},jme={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:n=>(Math.abs(n[0])+Math.abs(n[3]))/2,rotate:_M,rotateZ:_M,skewX:n=>cm(Math.atan(n[1])),skewY:n=>cm(Math.atan(n[2])),skew:n=>(Math.abs(n[1])+Math.abs(n[2]))/2},vM=n=>(n=n%360,n<0&&(n+=360),n),Rz=_M,Cz=n=>Math.sqrt(n[0]*n[0]+n[1]*n[1]),Az=n=>Math.sqrt(n[4]*n[4]+n[5]*n[5]),Vme={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:Cz,scaleY:Az,scale:n=>(Cz(n)+Az(n))/2,rotateX:n=>vM(cm(Math.atan2(n[6],n[5]))),rotateY:n=>vM(cm(Math.atan2(-n[2],n[0]))),rotateZ:Rz,rotate:Rz,skewX:n=>cm(Math.atan(n[4])),skewY:n=>cm(Math.atan(n[1])),skew:n=>(Math.abs(n[1])+Math.abs(n[4]))/2};function yM(n){return n.includes("scale")?1:0}function EM(n,i){if(!n||n==="none")return yM(i);const s=n.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let c,f;if(s)c=Vme,f=s;else{const b=n.match(/^matrix\(([-\d.e\s,]+)\)$/u);c=jme,f=b}if(!f)return yM(i);const p=c[i],v=f[1].split(",").map(Fme);return typeof p=="function"?p(v):v[p]}const Bme=(n,i)=>{const{transform:s="none"}=getComputedStyle(n);return EM(s,i)};function Fme(n){return parseFloat(n.trim())}const Wv=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],zv=new Set(Wv),Oz=n=>n===Hv||n===Yt,Gme=new Set(["x","y","z"]),Hme=Wv.filter(n=>!Gme.has(n));function Wme(n){const i=[];return Hme.forEach(s=>{const c=n.getValue(s);c!==void 0&&(i.push([s,c.get()]),c.set(s.startsWith("scale")?1:0))}),i}const hm={width:({x:n},{paddingLeft:i="0",paddingRight:s="0"})=>n.max-n.min-parseFloat(i)-parseFloat(s),height:({y:n},{paddingTop:i="0",paddingBottom:s="0"})=>n.max-n.min-parseFloat(i)-parseFloat(s),top:(n,{top:i})=>parseFloat(i),left:(n,{left:i})=>parseFloat(i),bottom:({y:n},{top:i})=>parseFloat(i)+(n.max-n.min),right:({x:n},{left:i})=>parseFloat(i)+(n.max-n.min),x:(n,{transform:i})=>EM(i,"x"),y:(n,{transform:i})=>EM(i,"y")};hm.translateX=hm.x;hm.translateY=hm.y;const fm=new Set;let SM=!1,bM=!1,TM=!1;function DX(){if(bM){const n=Array.from(fm).filter(c=>c.needsMeasurement),i=new Set(n.map(c=>c.element)),s=new Map;i.forEach(c=>{const f=Wme(c);f.length&&(s.set(c,f),c.render())}),n.forEach(c=>c.measureInitialState()),i.forEach(c=>{c.render();const f=s.get(c);f&&f.forEach(([p,v])=>{c.getValue(p)?.set(v)})}),n.forEach(c=>c.measureEndState()),n.forEach(c=>{c.suspendedScrollY!==void 0&&window.scrollTo(0,c.suspendedScrollY)})}bM=!1,SM=!1,fm.forEach(n=>n.complete(TM)),fm.clear()}function PX(){fm.forEach(n=>{n.readKeyframes(),n.needsMeasurement&&(bM=!0)})}function zme(){TM=!0,PX(),DX(),TM=!1}class Z2{constructor(i,s,c,f,p,v=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...i],this.onComplete=s,this.name=c,this.motionValue=f,this.element=p,this.isAsync=v}scheduleResolve(){this.state="scheduled",this.isAsync?(fm.add(this),SM||(SM=!0,Sr.read(PX),Sr.resolveKeyframes(DX))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:i,name:s,element:c,motionValue:f}=this;if(i[0]===null){const p=f?.get(),v=i[i.length-1];if(p!==void 0)i[0]=p;else if(c&&s){const b=c.readValue(s,v);b!=null&&(i[0]=b)}i[0]===void 0&&(i[0]=v),f&&p===void 0&&f.set(i[0])}Ume(i)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(i=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,i),fm.delete(this)}cancel(){this.state==="scheduled"&&(fm.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const Kme=n=>n.startsWith("--");function Yme(n,i,s){Kme(i)?n.style.setProperty(i,s):n.style[i]=s}const qme=B2(()=>window.ScrollTimeline!==void 0),Xme={};function Jme(n,i){const s=B2(n);return()=>Xme[i]??s()}const kX=Jme(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),zS=([n,i,s,c])=>`cubic-bezier(${n}, ${i}, ${s}, ${c})`,Iz={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:zS([0,.65,.55,1]),circOut:zS([.55,0,1,.45]),backIn:zS([.31,.01,.66,-.59]),backOut:zS([.33,1.53,.69,.99])};function LX(n,i){if(n)return typeof n=="function"?kX()?OX(n,i):"ease-out":vX(n)?zS(n):Array.isArray(n)?n.map(s=>LX(s,i)||Iz.easeOut):Iz[n]}function $me(n,i,s,{delay:c=0,duration:f=300,repeat:p=0,repeatType:v="loop",ease:b="easeOut",times:T}={},w=void 0){const C={[i]:s};T&&(C.offset=T);const I=LX(b,f);Array.isArray(I)&&(C.easing=I);const D={delay:c,duration:f,easing:Array.isArray(I)?"linear":I,fill:"both",iterations:p+1,direction:v==="reverse"?"alternate":"normal"};return w&&(D.pseudoElement=w),n.animate(C,D)}function MX(n){return typeof n=="function"&&"applyToOptions"in n}function Zme({type:n,...i}){return MX(n)&&kX()?n.applyToOptions(i):(i.duration??(i.duration=300),i.ease??(i.ease="easeOut"),i)}class Qme extends $2{constructor(i){if(super(),this.finishedTime=null,this.isStopped=!1,!i)return;const{element:s,name:c,keyframes:f,pseudoElement:p,allowFlatten:v=!1,finalKeyframe:b,onComplete:T}=i;this.isPseudoElement=!!p,this.allowFlatten=v,this.options=i,V2(typeof i.type!="string");const w=Zme(i);this.animation=$me(s,c,f,w,p),w.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!p){const C=J2(f,this.options,b,this.speed);this.updateMotionValue?this.updateMotionValue(C):Yme(s,c,C),this.animation.cancel()}T?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:i}=this;i==="idle"||i==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const i=this.animation.effect?.getComputedTiming?.().duration||0;return Ho(Number(i))}get iterationDuration(){const{delay:i=0}=this.options||{};return this.duration+Ho(i)}get time(){return Ho(Number(this.animation.currentTime)||0)}set time(i){this.finishedTime=null,this.animation.currentTime=Kl(i)}get speed(){return this.animation.playbackRate}set speed(i){i<0&&(this.finishedTime=null),this.animation.playbackRate=i}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(i){this.animation.startTime=i}attachTimeline({timeline:i,observe:s}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,i&&qme()?(this.animation.timeline=i,Ko):s(this)}}const UX={anticipate:pX,backInOut:fX,circInOut:gX};function ege(n){return n in UX}function tge(n){typeof n.ease=="string"&&ege(n.ease)&&(n.ease=UX[n.ease])}const Nz=10;class nge extends Qme{constructor(i){tge(i),xX(i),super(i),i.startTime&&(this.startTime=i.startTime),this.options=i}updateMotionValue(i){const{motionValue:s,onUpdate:c,onComplete:f,element:p,...v}=this.options;if(!s)return;if(i!==void 0){s.set(i);return}const b=new AI({...v,autoplay:!1}),T=Kl(this.finishedTime??this.time);s.setWithVelocity(b.sample(T-Nz).value,b.sample(T).value,Nz),b.stop()}}const xz=(n,i)=>i==="zIndex"?!1:!!(typeof n=="number"||Array.isArray(n)||typeof n=="string"&&(of.test(n)||n==="0")&&!n.startsWith("url("));function rge(n){const i=n[0];if(n.length===1)return!0;for(let s=0;s<n.length;s++)if(n[s]!==i)return!0}function ige(n,i,s,c){const f=n[0];if(f===null)return!1;if(i==="display"||i==="visibility")return!0;const p=n[n.length-1],v=xz(f,i),b=xz(p,i);return!v||!b?!1:rge(n)||(s==="spring"||MX(s))&&c}function wM(n){n.duration=0,n.type="keyframes"}const age=new Set(["opacity","clipPath","filter","transform"]),sge=B2(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function oge(n){const{motionValue:i,name:s,repeatDelay:c,repeatType:f,damping:p,type:v}=n;if(!(i?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:T,transformTemplate:w}=i.owner.getProps();return sge()&&s&&age.has(s)&&(s!=="transform"||!w)&&!T&&!c&&f!=="mirror"&&p!==0&&v!=="inertia"}const cge=40;class lge extends $2{constructor({autoplay:i=!0,delay:s=0,type:c="keyframes",repeat:f=0,repeatDelay:p=0,repeatType:v="loop",keyframes:b,name:T,motionValue:w,element:C,...I}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=Is.now();const D={autoplay:i,delay:s,type:c,repeat:f,repeatDelay:p,repeatType:v,name:T,motionValue:w,element:C,...I},L=C?.KeyframeResolver||Z2;this.keyframeResolver=new L(b,(F,W,G)=>this.onKeyframesResolved(F,W,D,!G),T,w,C),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(i,s,c,f){this.keyframeResolver=void 0;const{name:p,type:v,velocity:b,delay:T,isHandoff:w,onUpdate:C}=c;this.resolvedAt=Is.now(),ige(i,p,v,b)||((sd.instantAnimations||!T)&&C?.(J2(i,c,s)),i[0]=i[i.length-1],wM(c),c.repeat=0);const D={startTime:f?this.resolvedAt?this.resolvedAt-this.createdAt>cge?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:s,...c,keyframes:i},L=!w&&oge(D)?new nge({...D,element:D.motionValue.owner.current}):new AI(D);L.finished.then(()=>this.notifyFinished()).catch(Ko),this.pendingTimeline&&(this.stopTimeline=L.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=L}get finished(){return this._animation?this.animation.finished:this._finished}then(i,s){return this.finished.finally(i).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),zme()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(i){this.animation.time=i}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(i){this.animation.speed=i}get startTime(){return this.animation.startTime}attachTimeline(i){return this._animation?this.stopTimeline=this.animation.attachTimeline(i):this.pendingTimeline=i,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const uge=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function dge(n){const i=uge.exec(n);if(!i)return[,];const[,s,c,f]=i;return[`--${s??c}`,f]}function jX(n,i,s=1){const[c,f]=dge(n);if(!c)return;const p=window.getComputedStyle(i).getPropertyValue(c);if(p){const v=p.trim();return aX(v)?parseFloat(v):v}return z2(f)?jX(f,i,s+1):f}function Q2(n,i){return n?.[i]??n?.default??n}const VX=new Set(["width","height","top","left","right","bottom",...Wv]),hge={test:n=>n==="auto",parse:n=>n},BX=n=>i=>i.test(n),FX=[Hv,Yt,Yl,Qh,ime,rme,hge],Dz=n=>FX.find(BX(n));function fge(n){return typeof n=="number"?n===0:n!==null?n==="none"||n==="0"||oX(n):!0}const pge=new Set(["brightness","contrast","saturate","opacity"]);function mge(n){const[i,s]=n.slice(0,-1).split("(");if(i==="drop-shadow")return n;const[c]=s.match(K2)||[];if(!c)return n;const f=s.replace(c,"");let p=pge.has(i)?1:0;return c!==s&&(p*=100),i+"("+p+f+")"}const gge=/\b([a-z-]*)\(.*?\)/gu,RM={...of,getAnimatableNone:n=>{const i=n.match(gge);return i?i.map(mge).join(" "):n}},Pz={...Hv,transform:Math.round},_ge={rotate:Qh,rotateX:Qh,rotateY:Qh,rotateZ:Qh,scale:nO,scaleX:nO,scaleY:nO,scaleZ:nO,skew:Qh,skewX:Qh,skewY:Qh,distance:Yt,translateX:Yt,translateY:Yt,translateZ:Yt,x:Yt,y:Yt,z:Yt,perspective:Yt,transformPerspective:Yt,opacity:ab,originX:Ez,originY:Ez,originZ:Yt},eU={borderWidth:Yt,borderTopWidth:Yt,borderRightWidth:Yt,borderBottomWidth:Yt,borderLeftWidth:Yt,borderRadius:Yt,radius:Yt,borderTopLeftRadius:Yt,borderTopRightRadius:Yt,borderBottomRightRadius:Yt,borderBottomLeftRadius:Yt,width:Yt,maxWidth:Yt,height:Yt,maxHeight:Yt,top:Yt,right:Yt,bottom:Yt,left:Yt,padding:Yt,paddingTop:Yt,paddingRight:Yt,paddingBottom:Yt,paddingLeft:Yt,margin:Yt,marginTop:Yt,marginRight:Yt,marginBottom:Yt,marginLeft:Yt,backgroundPositionX:Yt,backgroundPositionY:Yt,..._ge,zIndex:Pz,fillOpacity:ab,strokeOpacity:ab,numOctaves:Pz},vge={...eU,color:Ri,backgroundColor:Ri,outlineColor:Ri,fill:Ri,stroke:Ri,borderColor:Ri,borderTopColor:Ri,borderRightColor:Ri,borderBottomColor:Ri,borderLeftColor:Ri,filter:RM,WebkitFilter:RM},GX=n=>vge[n];function HX(n,i){let s=GX(n);return s!==RM&&(s=of),s.getAnimatableNone?s.getAnimatableNone(i):void 0}const yge=new Set(["auto","none","0"]);function Ege(n,i,s){let c=0,f;for(;c<n.length&&!f;){const p=n[c];typeof p=="string"&&!yge.has(p)&&sb(p).values.length&&(f=n[c]),c++}if(f&&s)for(const p of i)n[p]=HX(s,f)}class Sge extends Z2{constructor(i,s,c,f,p){super(i,s,c,f,p,!0)}readKeyframes(){const{unresolvedKeyframes:i,element:s,name:c}=this;if(!s||!s.current)return;super.readKeyframes();for(let T=0;T<i.length;T++){let w=i[T];if(typeof w=="string"&&(w=w.trim(),z2(w))){const C=jX(w,s.current);C!==void 0&&(i[T]=C),T===i.length-1&&(this.finalKeyframe=w)}}if(this.resolveNoneKeyframes(),!VX.has(c)||i.length!==2)return;const[f,p]=i,v=Dz(f),b=Dz(p);if(v!==b)if(Oz(v)&&Oz(b))for(let T=0;T<i.length;T++){const w=i[T];typeof w=="string"&&(i[T]=parseFloat(w))}else hm[c]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:i,name:s}=this,c=[];for(let f=0;f<i.length;f++)(i[f]===null||fge(i[f]))&&c.push(f);c.length&&Ege(i,c,s)}measureInitialState(){const{element:i,unresolvedKeyframes:s,name:c}=this;if(!i||!i.current)return;c==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=hm[c](i.measureViewportBox(),window.getComputedStyle(i.current)),s[0]=this.measuredOrigin;const f=s[s.length-1];f!==void 0&&i.getValue(c,f).jump(f,!1)}measureEndState(){const{element:i,name:s,unresolvedKeyframes:c}=this;if(!i||!i.current)return;const f=i.getValue(s);f&&f.jump(this.measuredOrigin,!1);const p=c.length-1,v=c[p];c[p]=hm[s](i.measureViewportBox(),window.getComputedStyle(i.current)),v!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=v),this.removedTransforms?.length&&this.removedTransforms.forEach(([b,T])=>{i.getValue(b).set(T)}),this.resolveNoneKeyframes()}}function bge(n,i,s){if(n instanceof EventTarget)return[n];if(typeof n=="string"){let c=document;const f=s?.[n]??c.querySelectorAll(n);return f?Array.from(f):[]}return Array.from(n)}const WX=(n,i)=>i&&typeof n=="number"?i.transform(n):n;function zX(n){return sX(n)&&"offsetHeight"in n}const kz=30,Tge=n=>!isNaN(parseFloat(n)),JS={current:void 0};class wge{constructor(i,s={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=c=>{const f=Is.now();if(this.updatedAt!==f&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(c),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const p of this.dependents)p.dirty()},this.hasAnimated=!1,this.setCurrent(i),this.owner=s.owner}setCurrent(i){this.current=i,this.updatedAt=Is.now(),this.canTrackVelocity===null&&i!==void 0&&(this.canTrackVelocity=Tge(this.current))}setPrevFrameValue(i=this.current){this.prevFrameValue=i,this.prevUpdatedAt=this.updatedAt}onChange(i){return this.on("change",i)}on(i,s){this.events[i]||(this.events[i]=new F2);const c=this.events[i].add(s);return i==="change"?()=>{c(),Sr.read(()=>{this.events.change.getSize()||this.stop()})}:c}clearListeners(){for(const i in this.events)this.events[i].clear()}attach(i,s){this.passiveEffect=i,this.stopPassiveEffect=s}set(i){this.passiveEffect?this.passiveEffect(i,this.updateAndNotify):this.updateAndNotify(i)}setWithVelocity(i,s,c){this.set(s),this.prev=void 0,this.prevFrameValue=i,this.prevUpdatedAt=this.updatedAt-c}jump(i,s=!0){this.updateAndNotify(i),this.prev=i,this.prevUpdatedAt=this.prevFrameValue=void 0,s&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(i){this.dependents||(this.dependents=new Set),this.dependents.add(i)}removeDependent(i){this.dependents&&this.dependents.delete(i)}get(){return JS.current&&JS.current.push(this),this.current}getPrevious(){return this.prev}getVelocity(){const i=Is.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||i-this.updatedAt>kz)return 0;const s=Math.min(this.updatedAt-this.prevUpdatedAt,kz);return cX(parseFloat(this.current)-parseFloat(this.prevFrameValue),s)}start(i){return this.stop(),new Promise(s=>{this.hasAnimated=!0,this.animation=i(s),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function vm(n,i){return new wge(n,i)}const{schedule:tU}=yX(queueMicrotask,!1),Jc={x:!1,y:!1};function KX(){return Jc.x||Jc.y}function Rge(n){return n==="x"||n==="y"?Jc[n]?null:(Jc[n]=!0,()=>{Jc[n]=!1}):Jc.x||Jc.y?null:(Jc.x=Jc.y=!0,()=>{Jc.x=Jc.y=!1})}function YX(n,i){const s=bge(n),c=new AbortController,f={passive:!0,...i,signal:c.signal};return[s,f,()=>c.abort()]}function Lz(n){return!(n.pointerType==="touch"||KX())}function Cge(n,i,s={}){const[c,f,p]=YX(n,s),v=b=>{if(!Lz(b))return;const{target:T}=b,w=i(T,b);if(typeof w!="function"||!T)return;const C=I=>{Lz(I)&&(w(I),T.removeEventListener("pointerleave",C))};T.addEventListener("pointerleave",C,f)};return c.forEach(b=>{b.addEventListener("pointerenter",v,f)}),p}const qX=(n,i)=>i?n===i?!0:qX(n,i.parentElement):!1,nU=n=>n.pointerType==="mouse"?typeof n.button!="number"||n.button<=0:n.isPrimary!==!1,Age=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function Oge(n){return Age.has(n.tagName)||n.tabIndex!==-1}const CO=new WeakSet;function Mz(n){return i=>{i.key==="Enter"&&n(i)}}function Tk(n,i){n.dispatchEvent(new PointerEvent("pointer"+i,{isPrimary:!0,bubbles:!0}))}const Ige=(n,i)=>{const s=n.currentTarget;if(!s)return;const c=Mz(()=>{if(CO.has(s))return;Tk(s,"down");const f=Mz(()=>{Tk(s,"up")}),p=()=>Tk(s,"cancel");s.addEventListener("keyup",f,i),s.addEventListener("blur",p,i)});s.addEventListener("keydown",c,i),s.addEventListener("blur",()=>s.removeEventListener("keydown",c),i)};function Uz(n){return nU(n)&&!KX()}function Nge(n,i,s={}){const[c,f,p]=YX(n,s),v=b=>{const T=b.currentTarget;if(!Uz(b))return;CO.add(T);const w=i(T,b),C=(L,F)=>{window.removeEventListener("pointerup",I),window.removeEventListener("pointercancel",D),CO.has(T)&&CO.delete(T),Uz(L)&&typeof w=="function"&&w(L,{success:F})},I=L=>{C(L,T===window||T===document||s.useGlobalTarget||qX(T,L.target))},D=L=>{C(L,!1)};window.addEventListener("pointerup",I,f),window.addEventListener("pointercancel",D,f)};return c.forEach(b=>{(s.useGlobalTarget?window:b).addEventListener("pointerdown",v,f),zX(b)&&(b.addEventListener("focus",w=>Ige(w,f)),!Oge(b)&&!b.hasAttribute("tabindex")&&(b.tabIndex=0))}),p}function XX(n){return sX(n)&&"ownerSVGElement"in n}function xge(n){return XX(n)&&n.tagName==="svg"}function Dge(...n){const i=!Array.isArray(n[0]),s=i?0:-1,c=n[0+s],f=n[1+s],p=n[2+s],v=n[3+s],b=NX(f,p,v);return i?b(c):b}const ea=n=>!!(n&&n.getVelocity);function Pge(n,i,s){const c=n.get();let f=null,p=c,v;const b=typeof c=="string"?c.replace(/[\d.-]/g,""):void 0,T=()=>{f&&(f.stop(),f=null)},w=()=>{T(),f=new AI({keyframes:[Vz(n.get()),Vz(p)],velocity:n.getVelocity(),type:"spring",restDelta:.001,restSpeed:.01,...s,onUpdate:v})};if(n.attach((C,I)=>{p=C,v=D=>I(jz(D,b)),Sr.postRender(w)},T),ea(i)){const C=i.on("change",D=>n.set(jz(D,b))),I=n.on("destroy",C);return()=>{C(),I()}}return T}function jz(n,i){return i?n+i:n}function Vz(n){return typeof n=="number"?n:parseFloat(n)}const kge=[...FX,Ri,of],Lge=n=>kge.find(BX(n)),Ib=j.createContext({transformPagePoint:n=>n,isStatic:!1,reducedMotion:"never"});function Bz(n,i){if(typeof n=="function")return n(i);n!=null&&(n.current=i)}function Mge(...n){return i=>{let s=!1;const c=n.map(f=>{const p=Bz(f,i);return!s&&typeof p=="function"&&(s=!0),p});if(s)return()=>{for(let f=0;f<c.length;f++){const p=c[f];typeof p=="function"?p():Bz(n[f],null)}}}}function Uge(...n){return j.useCallback(Mge(...n),n)}class jge extends j.Component{getSnapshotBeforeUpdate(i){const s=this.props.childRef.current;if(s&&i.isPresent&&!this.props.isPresent){const c=s.offsetParent,f=zX(c)&&c.offsetWidth||0,p=this.props.sizeRef.current;p.height=s.offsetHeight||0,p.width=s.offsetWidth||0,p.top=s.offsetTop,p.left=s.offsetLeft,p.right=f-p.width-p.left}return null}componentDidUpdate(){}render(){return this.props.children}}function Vge({children:n,isPresent:i,anchorX:s,root:c}){const f=j.useId(),p=j.useRef(null),v=j.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:b}=j.useContext(Ib),T=Uge(p,n?.ref);return j.useInsertionEffect(()=>{const{width:w,height:C,top:I,left:D,right:L}=v.current;if(i||!p.current||!w||!C)return;const F=s==="left"?`left: ${D}`:`right: ${L}`;p.current.dataset.motionPopId=f;const W=document.createElement("style");b&&(W.nonce=b);const G=c??document.head;return G.appendChild(W),W.sheet&&W.sheet.insertRule(`
          [data-motion-pop-id="${f}"] {
            position: absolute !important;
            width: ${w}px !important;
            height: ${C}px !important;
            ${F}px !important;
            top: ${I}px !important;
          }
        `),()=>{G.contains(W)&&G.removeChild(W)}},[i]),R.jsx(jge,{isPresent:i,childRef:p,sizeRef:v,children:j.cloneElement(n,{ref:T})})}const Bge=({children:n,initial:i,isPresent:s,onExitComplete:c,custom:f,presenceAffectsLayout:p,mode:v,anchorX:b,root:T})=>{const w=Rb(Fge),C=j.useId();let I=!0,D=j.useMemo(()=>(I=!1,{id:C,initial:i,isPresent:s,custom:f,onExitComplete:L=>{w.set(L,!0);for(const F of w.values())if(!F)return;c&&c()},register:L=>(w.set(L,!1),()=>w.delete(L))}),[s,w,c]);return p&&I&&(D={...D}),j.useMemo(()=>{w.forEach((L,F)=>w.set(F,!1))},[s]),j.useEffect(()=>{!s&&!w.size&&c&&c()},[s]),v==="popLayout"&&(n=R.jsx(Vge,{isPresent:s,anchorX:b,root:T,children:n})),R.jsx(CI.Provider,{value:D,children:n})};function Fge(){return new Map}function JX(n=!0){const i=j.useContext(CI);if(i===null)return[!0,null];const{isPresent:s,onExitComplete:c,register:f}=i,p=j.useId();j.useEffect(()=>{if(n)return f(p)},[n]);const v=j.useCallback(()=>n&&c&&c(p),[p,c,n]);return!s&&c?[!1,v]:[!0]}const rO=n=>n.key||"";function Fz(n){const i=[];return j.Children.forEach(n,s=>{j.isValidElement(s)&&i.push(s)}),i}const Yo=({children:n,custom:i,initial:s=!0,onExitComplete:c,presenceAffectsLayout:f=!0,mode:p="sync",propagate:v=!1,anchorX:b="left",root:T})=>{const[w,C]=JX(v),I=j.useMemo(()=>Fz(n),[n]),D=v&&!w?[]:I.map(rO),L=j.useRef(!0),F=j.useRef(I),W=Rb(()=>new Map),[G,$]=j.useState(I),[te,Z]=j.useState(I);M2(()=>{L.current=!1,F.current=I;for(let de=0;de<te.length;de++){const oe=rO(te[de]);D.includes(oe)?W.delete(oe):W.get(oe)!==!0&&W.set(oe,!1)}},[te,D.length,D.join("-")]);const ce=[];if(I!==G){let de=[...I];for(let oe=0;oe<te.length;oe++){const ge=te[oe],Ae=rO(ge);D.includes(Ae)||(de.splice(oe,0,ge),ce.push(ge))}return p==="wait"&&ce.length&&(de=ce),Z(Fz(de)),$(I),null}const{forceRender:se}=j.useContext(k2);return R.jsx(R.Fragment,{children:te.map(de=>{const oe=rO(de),ge=v&&!w?!1:I===te||D.includes(oe),Ae=()=>{if(W.has(oe))W.set(oe,!0);else return;let ke=!0;W.forEach(Ee=>{Ee||(ke=!1)}),ke&&(se?.(),Z(F.current),v&&C?.(),c&&c())};return R.jsx(Bge,{isPresent:ge,initial:!L.current||s?void 0:!1,custom:i,presenceAffectsLayout:f,mode:p,root:T,onExitComplete:ge?void 0:Ae,anchorX:b,children:de},oe)})})},$X=j.createContext({strict:!1}),Gz={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Dv={};for(const n in Gz)Dv[n]={isEnabled:i=>Gz[n].some(s=>!!i[s])};function Gge(n){for(const i in n)Dv[i]={...Dv[i],...n[i]}}const Hge=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function VO(n){return n.startsWith("while")||n.startsWith("drag")&&n!=="draggable"||n.startsWith("layout")||n.startsWith("onTap")||n.startsWith("onPan")||n.startsWith("onLayout")||Hge.has(n)}let ZX=n=>!VO(n);function Wge(n){typeof n=="function"&&(ZX=i=>i.startsWith("on")?!VO(i):n(i))}try{Wge(require("@emotion/is-prop-valid").default)}catch{}function zge(n,i,s){const c={};for(const f in n)f==="values"&&typeof n.values=="object"||(ZX(f)||s===!0&&VO(f)||!i&&!VO(f)||n.draggable&&f.startsWith("onDrag"))&&(c[f]=n[f]);return c}const OI=j.createContext({});function II(n){return n!==null&&typeof n=="object"&&typeof n.start=="function"}function ob(n){return typeof n=="string"||Array.isArray(n)}const rU=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],iU=["initial",...rU];function NI(n){return II(n.animate)||iU.some(i=>ob(n[i]))}function QX(n){return!!(NI(n)||n.variants)}function Kge(n,i){if(NI(n)){const{initial:s,animate:c}=n;return{initial:s===!1||ob(s)?s:void 0,animate:ob(c)?c:void 0}}return n.inherit!==!1?i:{}}function Yge(n){const{initial:i,animate:s}=Kge(n,j.useContext(OI));return j.useMemo(()=>({initial:i,animate:s}),[Hz(i),Hz(s)])}function Hz(n){return Array.isArray(n)?n.join(" "):n}const cb={};function qge(n){for(const i in n)cb[i]=n[i],W2(i)&&(cb[i].isCSSVariable=!0)}function eJ(n,{layout:i,layoutId:s}){return zv.has(n)||n.startsWith("origin")||(i||s!==void 0)&&(!!cb[n]||n==="opacity")}const Xge={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Jge=Wv.length;function $ge(n,i,s){let c="",f=!0;for(let p=0;p<Jge;p++){const v=Wv[p],b=n[v];if(b===void 0)continue;let T=!0;if(typeof b=="number"?T=b===(v.startsWith("scale")?1:0):T=parseFloat(b)===0,!T||s){const w=WX(b,eU[v]);if(!T){f=!1;const C=Xge[v]||v;c+=`${C}(${w}) `}s&&(i[v]=w)}}return c=c.trim(),s?c=s(i,f?"":c):f&&(c="none"),c}function aU(n,i,s){const{style:c,vars:f,transformOrigin:p}=n;let v=!1,b=!1;for(const T in i){const w=i[T];if(zv.has(T)){v=!0;continue}else if(W2(T)){f[T]=w;continue}else{const C=WX(w,eU[T]);T.startsWith("origin")?(b=!0,p[T]=C):c[T]=C}}if(i.transform||(v||s?c.transform=$ge(i,n.transform,s):c.transform&&(c.transform="none")),b){const{originX:T="50%",originY:w="50%",originZ:C=0}=p;c.transformOrigin=`${T} ${w} ${C}`}}const sU=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function tJ(n,i,s){for(const c in i)!ea(i[c])&&!eJ(c,s)&&(n[c]=i[c])}function Zge({transformTemplate:n},i){return j.useMemo(()=>{const s=sU();return aU(s,i,n),Object.assign({},s.vars,s.style)},[i])}function Qge(n,i){const s=n.style||{},c={};return tJ(c,s,n),Object.assign(c,Zge(n,i)),c}function e_e(n,i){const s={},c=Qge(n,i);return n.drag&&n.dragListener!==!1&&(s.draggable=!1,c.userSelect=c.WebkitUserSelect=c.WebkitTouchCallout="none",c.touchAction=n.drag===!0?"none":`pan-${n.drag==="x"?"y":"x"}`),n.tabIndex===void 0&&(n.onTap||n.onTapStart||n.whileTap)&&(s.tabIndex=0),s.style=c,s}const t_e={offset:"stroke-dashoffset",array:"stroke-dasharray"},n_e={offset:"strokeDashoffset",array:"strokeDasharray"};function r_e(n,i,s=1,c=0,f=!0){n.pathLength=1;const p=f?t_e:n_e;n[p.offset]=Yt.transform(-c);const v=Yt.transform(i),b=Yt.transform(s);n[p.array]=`${v} ${b}`}function nJ(n,{attrX:i,attrY:s,attrScale:c,pathLength:f,pathSpacing:p=1,pathOffset:v=0,...b},T,w,C){if(aU(n,b,w),T){n.style.viewBox&&(n.attrs.viewBox=n.style.viewBox);return}n.attrs=n.style,n.style={};const{attrs:I,style:D}=n;I.transform&&(D.transform=I.transform,delete I.transform),(D.transform||I.transformOrigin)&&(D.transformOrigin=I.transformOrigin??"50% 50%",delete I.transformOrigin),D.transform&&(D.transformBox=C?.transformBox??"fill-box",delete I.transformBox),i!==void 0&&(I.x=i),s!==void 0&&(I.y=s),c!==void 0&&(I.scale=c),f!==void 0&&r_e(I,f,p,v,!1)}const rJ=()=>({...sU(),attrs:{}}),iJ=n=>typeof n=="string"&&n.toLowerCase()==="svg";function i_e(n,i,s,c){const f=j.useMemo(()=>{const p=rJ();return nJ(p,i,iJ(c),n.transformTemplate,n.style),{...p.attrs,style:{...p.style}}},[i]);if(n.style){const p={};tJ(p,n.style,n),f.style={...p,...f.style}}return f}const a_e=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function oU(n){return typeof n!="string"||n.includes("-")?!1:!!(a_e.indexOf(n)>-1||/[A-Z]/u.test(n))}function s_e(n,i,s,{latestValues:c},f,p=!1){const b=(oU(n)?i_e:e_e)(i,c,f,n),T=zge(i,typeof n=="string",p),w=n!==j.Fragment?{...T,...b,ref:s}:{},{children:C}=i,I=j.useMemo(()=>ea(C)?C.get():C,[C]);return j.createElement(n,{...w,children:I})}function Wz(n){const i=[{},{}];return n?.values.forEach((s,c)=>{i[0][c]=s.get(),i[1][c]=s.getVelocity()}),i}function cU(n,i,s,c){if(typeof i=="function"){const[f,p]=Wz(c);i=i(s!==void 0?s:n.custom,f,p)}if(typeof i=="string"&&(i=n.variants&&n.variants[i]),typeof i=="function"){const[f,p]=Wz(c);i=i(s!==void 0?s:n.custom,f,p)}return i}function AO(n){return ea(n)?n.get():n}function o_e({scrapeMotionValuesFromProps:n,createRenderState:i},s,c,f){return{latestValues:c_e(s,c,f,n),renderState:i()}}function c_e(n,i,s,c){const f={},p=c(n,{});for(const D in p)f[D]=AO(p[D]);let{initial:v,animate:b}=n;const T=NI(n),w=QX(n);i&&w&&!T&&n.inherit!==!1&&(v===void 0&&(v=i.initial),b===void 0&&(b=i.animate));let C=s?s.initial===!1:!1;C=C||v===!1;const I=C?b:v;if(I&&typeof I!="boolean"&&!II(I)){const D=Array.isArray(I)?I:[I];for(let L=0;L<D.length;L++){const F=cU(n,D[L]);if(F){const{transitionEnd:W,transition:G,...$}=F;for(const te in $){let Z=$[te];if(Array.isArray(Z)){const ce=C?Z.length-1:0;Z=Z[ce]}Z!==null&&(f[te]=Z)}for(const te in W)f[te]=W[te]}}}return f}const aJ=n=>(i,s)=>{const c=j.useContext(OI),f=j.useContext(CI),p=()=>o_e(n,i,c,f);return s?p():Rb(p)};function lU(n,i,s){const{style:c}=n,f={};for(const p in c)(ea(c[p])||i.style&&ea(i.style[p])||eJ(p,n)||s?.getValue(p)?.liveStyle!==void 0)&&(f[p]=c[p]);return f}const l_e=aJ({scrapeMotionValuesFromProps:lU,createRenderState:sU});function sJ(n,i,s){const c=lU(n,i,s);for(const f in n)if(ea(n[f])||ea(i[f])){const p=Wv.indexOf(f)!==-1?"attr"+f.charAt(0).toUpperCase()+f.substring(1):f;c[p]=n[f]}return c}const u_e=aJ({scrapeMotionValuesFromProps:sJ,createRenderState:rJ}),d_e=Symbol.for("motionComponentSymbol");function Sv(n){return n&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}function h_e(n,i,s){return j.useCallback(c=>{c&&n.onMount&&n.onMount(c),i&&(c?i.mount(c):i.unmount()),s&&(typeof s=="function"?s(c):Sv(s)&&(s.current=c))},[i])}const uU=n=>n.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),f_e="framerAppearId",oJ="data-"+uU(f_e),cJ=j.createContext({});function p_e(n,i,s,c,f){const{visualElement:p}=j.useContext(OI),v=j.useContext($X),b=j.useContext(CI),T=j.useContext(Ib).reducedMotion,w=j.useRef(null);c=c||v.renderer,!w.current&&c&&(w.current=c(n,{visualState:i,parent:p,props:s,presenceContext:b,blockInitialAnimation:b?b.initial===!1:!1,reducedMotionConfig:T}));const C=w.current,I=j.useContext(cJ);C&&!C.projection&&f&&(C.type==="html"||C.type==="svg")&&m_e(w.current,s,f,I);const D=j.useRef(!1);j.useInsertionEffect(()=>{C&&D.current&&C.update(s,b)});const L=s[oJ],F=j.useRef(!!L&&!window.MotionHandoffIsComplete?.(L)&&window.MotionHasOptimisedAnimation?.(L));return M2(()=>{C&&(D.current=!0,window.MotionIsMounted=!0,C.updateFeatures(),C.scheduleRenderMicrotask(),F.current&&C.animationState&&C.animationState.animateChanges())}),j.useEffect(()=>{C&&(!F.current&&C.animationState&&C.animationState.animateChanges(),F.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(L)}),F.current=!1),C.enteringChildren=void 0)}),C}function m_e(n,i,s,c){const{layoutId:f,layout:p,drag:v,dragConstraints:b,layoutScroll:T,layoutRoot:w,layoutCrossfade:C}=i;n.projection=new s(n.latestValues,i["data-framer-portal-id"]?void 0:lJ(n.parent)),n.projection.setOptions({layoutId:f,layout:p,alwaysMeasureLayout:!!v||b&&Sv(b),visualElement:n,animationType:typeof p=="string"?p:"both",initialPromotionConfig:c,crossfade:C,layoutScroll:T,layoutRoot:w})}function lJ(n){if(n)return n.options.allowProjection!==!1?n.projection:lJ(n.parent)}function wk(n,{forwardMotionProps:i=!1}={},s,c){s&&Gge(s);const f=oU(n)?u_e:l_e;function p(b,T){let w;const C={...j.useContext(Ib),...b,layoutId:g_e(b)},{isStatic:I}=C,D=Yge(b),L=f(b,I);if(!I&&L2){__e();const F=v_e(C);w=F.MeasureLayout,D.visualElement=p_e(n,L,C,c,F.ProjectionNode)}return R.jsxs(OI.Provider,{value:D,children:[w&&D.visualElement?R.jsx(w,{visualElement:D.visualElement,...C}):null,s_e(n,b,h_e(L,D.visualElement,T),L,I,i)]})}p.displayName=`motion.${typeof n=="string"?n:`create(${n.displayName??n.name??""})`}`;const v=j.forwardRef(p);return v[d_e]=n,v}function g_e({layoutId:n}){const i=j.useContext(k2).id;return i&&n!==void 0?i+"-"+n:n}function __e(n,i){j.useContext($X).strict}function v_e(n){const{drag:i,layout:s}=Dv;if(!i&&!s)return{};const c={...i,...s};return{MeasureLayout:i?.isEnabled(n)||s?.isEnabled(n)?c.MeasureLayout:void 0,ProjectionNode:c.ProjectionNode}}function y_e(n,i){if(typeof Proxy>"u")return wk;const s=new Map,c=(p,v)=>wk(p,v,n,i),f=(p,v)=>c(p,v);return new Proxy(f,{get:(p,v)=>v==="create"?c:(s.has(v)||s.set(v,wk(v,void 0,n,i)),s.get(v))})}function uJ({top:n,left:i,right:s,bottom:c}){return{x:{min:i,max:s},y:{min:n,max:c}}}function E_e({x:n,y:i}){return{top:i.min,right:n.max,bottom:i.max,left:n.min}}function S_e(n,i){if(!i)return n;const s=i({x:n.left,y:n.top}),c=i({x:n.right,y:n.bottom});return{top:s.y,left:s.x,bottom:c.y,right:c.x}}function Rk(n){return n===void 0||n===1}function CM({scale:n,scaleX:i,scaleY:s}){return!Rk(n)||!Rk(i)||!Rk(s)}function nm(n){return CM(n)||dJ(n)||n.z||n.rotate||n.rotateX||n.rotateY||n.skewX||n.skewY}function dJ(n){return zz(n.x)||zz(n.y)}function zz(n){return n&&n!=="0%"}function BO(n,i,s){const c=n-s,f=i*c;return s+f}function Kz(n,i,s,c,f){return f!==void 0&&(n=BO(n,f,c)),BO(n,s,c)+i}function AM(n,i=0,s=1,c,f){n.min=Kz(n.min,i,s,c,f),n.max=Kz(n.max,i,s,c,f)}function hJ(n,{x:i,y:s}){AM(n.x,i.translate,i.scale,i.originPoint),AM(n.y,s.translate,s.scale,s.originPoint)}const Yz=.999999999999,qz=1.0000000000001;function b_e(n,i,s,c=!1){const f=s.length;if(!f)return;i.x=i.y=1;let p,v;for(let b=0;b<f;b++){p=s[b],v=p.projectionDelta;const{visualElement:T}=p.options;T&&T.props.style&&T.props.style.display==="contents"||(c&&p.options.layoutScroll&&p.scroll&&p!==p.root&&Tv(n,{x:-p.scroll.offset.x,y:-p.scroll.offset.y}),v&&(i.x*=v.x.scale,i.y*=v.y.scale,hJ(n,v)),c&&nm(p.latestValues)&&Tv(n,p.latestValues))}i.x<qz&&i.x>Yz&&(i.x=1),i.y<qz&&i.y>Yz&&(i.y=1)}function bv(n,i){n.min=n.min+i,n.max=n.max+i}function Xz(n,i,s,c,f=.5){const p=Yr(n.min,n.max,f);AM(n,i,s,p,c)}function Tv(n,i){Xz(n.x,i.x,i.scaleX,i.scale,i.originX),Xz(n.y,i.y,i.scaleY,i.scale,i.originY)}function fJ(n,i){return uJ(S_e(n.getBoundingClientRect(),i))}function T_e(n,i,s){const c=fJ(n,s),{scroll:f}=i;return f&&(bv(c.x,f.offset.x),bv(c.y,f.offset.y)),c}const Jz=()=>({translate:0,scale:1,origin:0,originPoint:0}),wv=()=>({x:Jz(),y:Jz()}),$z=()=>({min:0,max:0}),pi=()=>({x:$z(),y:$z()}),OM={current:null},pJ={current:!1};function w_e(){if(pJ.current=!0,!!L2)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),i=()=>OM.current=n.matches;n.addEventListener("change",i),i()}else OM.current=!1}const R_e=new WeakMap;function C_e(n,i,s){for(const c in i){const f=i[c],p=s[c];if(ea(f))n.addValue(c,f);else if(ea(p))n.addValue(c,vm(f,{owner:n}));else if(p!==f)if(n.hasValue(c)){const v=n.getValue(c);v.liveStyle===!0?v.jump(f):v.hasAnimated||v.set(f)}else{const v=n.getStaticValue(c);n.addValue(c,vm(v!==void 0?v:f,{owner:n}))}}for(const c in s)i[c]===void 0&&n.removeValue(c);return i}const Zz=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class A_e{scrapeMotionValuesFromProps(i,s,c){return{}}constructor({parent:i,props:s,presenceContext:c,reducedMotionConfig:f,blockInitialAnimation:p,visualState:v},b={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Z2,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const D=Is.now();this.renderScheduledAt<D&&(this.renderScheduledAt=D,Sr.render(this.render,!1,!0))};const{latestValues:T,renderState:w}=v;this.latestValues=T,this.baseTarget={...T},this.initialValues=s.initial?{...T}:{},this.renderState=w,this.parent=i,this.props=s,this.presenceContext=c,this.depth=i?i.depth+1:0,this.reducedMotionConfig=f,this.options=b,this.blockInitialAnimation=!!p,this.isControllingVariants=NI(s),this.isVariantNode=QX(s),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(i&&i.current);const{willChange:C,...I}=this.scrapeMotionValuesFromProps(s,{},this);for(const D in I){const L=I[D];T[D]!==void 0&&ea(L)&&L.set(T[D])}}mount(i){this.current=i,R_e.set(i,this),this.projection&&!this.projection.instance&&this.projection.mount(i),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((s,c)=>this.bindToMotionValue(c,s)),pJ.current||w_e(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:OM.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),od(this.notifyUpdate),od(this.render),this.valueSubscriptions.forEach(i=>i()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const i in this.events)this.events[i].clear();for(const i in this.features){const s=this.features[i];s&&(s.unmount(),s.isMounted=!1)}this.current=null}addChild(i){this.children.add(i),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(i)}removeChild(i){this.children.delete(i),this.enteringChildren&&this.enteringChildren.delete(i)}bindToMotionValue(i,s){this.valueSubscriptions.has(i)&&this.valueSubscriptions.get(i)();const c=zv.has(i);c&&this.onBindTransform&&this.onBindTransform();const f=s.on("change",v=>{this.latestValues[i]=v,this.props.onUpdate&&Sr.preRender(this.notifyUpdate),c&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let p;window.MotionCheckAppearSync&&(p=window.MotionCheckAppearSync(this,i,s)),this.valueSubscriptions.set(i,()=>{f(),p&&p(),s.owner&&s.stop()})}sortNodePosition(i){return!this.current||!this.sortInstanceNodePosition||this.type!==i.type?0:this.sortInstanceNodePosition(this.current,i.current)}updateFeatures(){let i="animation";for(i in Dv){const s=Dv[i];if(!s)continue;const{isEnabled:c,Feature:f}=s;if(!this.features[i]&&f&&c(this.props)&&(this.features[i]=new f(this)),this.features[i]){const p=this.features[i];p.isMounted?p.update():(p.mount(),p.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):pi()}getStaticValue(i){return this.latestValues[i]}setStaticValue(i,s){this.latestValues[i]=s}update(i,s){(i.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=i,this.prevPresenceContext=this.presenceContext,this.presenceContext=s;for(let c=0;c<Zz.length;c++){const f=Zz[c];this.propEventSubscriptions[f]&&(this.propEventSubscriptions[f](),delete this.propEventSubscriptions[f]);const p="on"+f,v=i[p];v&&(this.propEventSubscriptions[f]=this.on(f,v))}this.prevMotionValues=C_e(this,this.scrapeMotionValuesFromProps(i,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(i){return this.props.variants?this.props.variants[i]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(i){const s=this.getClosestVariantNode();if(s)return s.variantChildren&&s.variantChildren.add(i),()=>s.variantChildren.delete(i)}addValue(i,s){const c=this.values.get(i);s!==c&&(c&&this.removeValue(i),this.bindToMotionValue(i,s),this.values.set(i,s),this.latestValues[i]=s.get())}removeValue(i){this.values.delete(i);const s=this.valueSubscriptions.get(i);s&&(s(),this.valueSubscriptions.delete(i)),delete this.latestValues[i],this.removeValueFromRenderState(i,this.renderState)}hasValue(i){return this.values.has(i)}getValue(i,s){if(this.props.values&&this.props.values[i])return this.props.values[i];let c=this.values.get(i);return c===void 0&&s!==void 0&&(c=vm(s===null?void 0:s,{owner:this}),this.addValue(i,c)),c}readValue(i,s){let c=this.latestValues[i]!==void 0||!this.current?this.latestValues[i]:this.getBaseTargetFromProps(this.props,i)??this.readValueFromInstance(this.current,i,this.options);return c!=null&&(typeof c=="string"&&(aX(c)||oX(c))?c=parseFloat(c):!Lge(c)&&of.test(s)&&(c=HX(i,s)),this.setBaseTarget(i,ea(c)?c.get():c)),ea(c)?c.get():c}setBaseTarget(i,s){this.baseTarget[i]=s}getBaseTarget(i){const{initial:s}=this.props;let c;if(typeof s=="string"||typeof s=="object"){const p=cU(this.props,s,this.presenceContext?.custom);p&&(c=p[i])}if(s&&c!==void 0)return c;const f=this.getBaseTargetFromProps(this.props,i);return f!==void 0&&!ea(f)?f:this.initialValues[i]!==void 0&&c===void 0?void 0:this.baseTarget[i]}on(i,s){return this.events[i]||(this.events[i]=new F2),this.events[i].add(s)}notify(i,...s){this.events[i]&&this.events[i].notify(...s)}scheduleRenderMicrotask(){tU.render(this.render)}}class mJ extends A_e{constructor(){super(...arguments),this.KeyframeResolver=Sge}sortInstanceNodePosition(i,s){return i.compareDocumentPosition(s)&2?1:-1}getBaseTargetFromProps(i,s){return i.style?i.style[s]:void 0}removeValueFromRenderState(i,{vars:s,style:c}){delete s[i],delete c[i]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:i}=this.props;ea(i)&&(this.childSubscription=i.on("change",s=>{this.current&&(this.current.textContent=`${s}`)}))}}function gJ(n,{style:i,vars:s},c,f){const p=n.style;let v;for(v in i)p[v]=i[v];f?.applyProjectionStyles(p,c);for(v in s)p.setProperty(v,s[v])}function O_e(n){return window.getComputedStyle(n)}class I_e extends mJ{constructor(){super(...arguments),this.type="html",this.renderInstance=gJ}readValueFromInstance(i,s){if(zv.has(s))return this.projection?.isProjecting?yM(s):Bme(i,s);{const c=O_e(i),f=(W2(s)?c.getPropertyValue(s):c[s])||0;return typeof f=="string"?f.trim():f}}measureInstanceViewportBox(i,{transformPagePoint:s}){return fJ(i,s)}build(i,s,c){aU(i,s,c.transformTemplate)}scrapeMotionValuesFromProps(i,s,c){return lU(i,s,c)}}const _J=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function N_e(n,i,s,c){gJ(n,i,void 0,c);for(const f in i.attrs)n.setAttribute(_J.has(f)?f:uU(f),i.attrs[f])}class x_e extends mJ{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=pi}getBaseTargetFromProps(i,s){return i[s]}readValueFromInstance(i,s){if(zv.has(s)){const c=GX(s);return c&&c.default||0}return s=_J.has(s)?s:uU(s),i.getAttribute(s)}scrapeMotionValuesFromProps(i,s,c){return sJ(i,s,c)}build(i,s,c){nJ(i,s,this.isSVGTag,c.transformTemplate,c.style)}renderInstance(i,s,c,f){N_e(i,s,c,f)}mount(i){this.isSVGTag=iJ(i.tagName),super.mount(i)}}const D_e=(n,i)=>oU(n)?new x_e(i):new I_e(i,{allowProjection:n!==j.Fragment});function Av(n,i,s){const c=n.getProps();return cU(c,i,s!==void 0?s:c.custom,n)}const IM=n=>Array.isArray(n);function P_e(n,i,s){n.hasValue(i)?n.getValue(i).set(s):n.addValue(i,vm(s))}function k_e(n){return IM(n)?n[n.length-1]||0:n}function L_e(n,i){const s=Av(n,i);let{transitionEnd:c={},transition:f={},...p}=s||{};p={...p,...c};for(const v in p){const b=k_e(p[v]);P_e(n,v,b)}}function M_e(n){return!!(ea(n)&&n.add)}function NM(n,i){const s=n.getValue("willChange");if(M_e(s))return s.add(i);if(!s&&sd.WillChange){const c=new sd.WillChange("auto");n.addValue("willChange",c),c.add(i)}}function vJ(n){return n.props[oJ]}const U_e=n=>n!==null;function j_e(n,{repeat:i,repeatType:s="loop"},c){const f=n.filter(U_e),p=i&&s!=="loop"&&i%2===1?0:f.length-1;return f[p]}const V_e={type:"spring",stiffness:500,damping:25,restSpeed:10},B_e=n=>({type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}),F_e={type:"keyframes",duration:.8},G_e={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},H_e=(n,{keyframes:i})=>i.length>2?F_e:zv.has(n)?n.startsWith("scale")?B_e(i[1]):V_e:G_e;function W_e({when:n,delay:i,delayChildren:s,staggerChildren:c,staggerDirection:f,repeat:p,repeatType:v,repeatDelay:b,from:T,elapsed:w,...C}){return!!Object.keys(C).length}const dU=(n,i,s,c={},f,p)=>v=>{const b=Q2(c,n)||{},T=b.delay||c.delay||0;let{elapsed:w=0}=c;w=w-Kl(T);const C={keyframes:Array.isArray(s)?s:[null,s],ease:"easeOut",velocity:i.getVelocity(),...b,delay:-w,onUpdate:D=>{i.set(D),b.onUpdate&&b.onUpdate(D)},onComplete:()=>{v(),b.onComplete&&b.onComplete()},name:n,motionValue:i,element:p?void 0:f};W_e(b)||Object.assign(C,H_e(n,C)),C.duration&&(C.duration=Kl(C.duration)),C.repeatDelay&&(C.repeatDelay=Kl(C.repeatDelay)),C.from!==void 0&&(C.keyframes[0]=C.from);let I=!1;if((C.type===!1||C.duration===0&&!C.repeatDelay)&&(wM(C),C.delay===0&&(I=!0)),(sd.instantAnimations||sd.skipAnimations)&&(I=!0,wM(C),C.delay=0),C.allowFlatten=!b.type&&!b.ease,I&&!p&&i.get()!==void 0){const D=j_e(C.keyframes,b);if(D!==void 0){Sr.update(()=>{C.onUpdate(D),C.onComplete()});return}}return b.isSync?new AI(C):new lge(C)};function z_e({protectedKeys:n,needsAnimating:i},s){const c=n.hasOwnProperty(s)&&i[s]!==!0;return i[s]=!1,c}function yJ(n,i,{delay:s=0,transitionOverride:c,type:f}={}){let{transition:p=n.getDefaultTransition(),transitionEnd:v,...b}=i;c&&(p=c);const T=[],w=f&&n.animationState&&n.animationState.getState()[f];for(const C in b){const I=n.getValue(C,n.latestValues[C]??null),D=b[C];if(D===void 0||w&&z_e(w,C))continue;const L={delay:s,...Q2(p||{},C)},F=I.get();if(F!==void 0&&!I.isAnimating&&!Array.isArray(D)&&D===F&&!L.velocity)continue;let W=!1;if(window.MotionHandoffAnimation){const $=vJ(n);if($){const te=window.MotionHandoffAnimation($,C,Sr);te!==null&&(L.startTime=te,W=!0)}}NM(n,C),I.start(dU(C,I,D,n.shouldReduceMotion&&VX.has(C)?{type:!1}:L,n,W));const G=I.animation;G&&T.push(G)}return v&&Promise.all(T).then(()=>{Sr.update(()=>{v&&L_e(n,v)})}),T}function EJ(n,i,s,c=0,f=1){const p=Array.from(n).sort((w,C)=>w.sortNodePosition(C)).indexOf(i),v=n.size,b=(v-1)*c;return typeof s=="function"?s(p,v):f===1?p*c:b-p*c}function xM(n,i,s={}){const c=Av(n,i,s.type==="exit"?n.presenceContext?.custom:void 0);let{transition:f=n.getDefaultTransition()||{}}=c||{};s.transitionOverride&&(f=s.transitionOverride);const p=c?()=>Promise.all(yJ(n,c,s)):()=>Promise.resolve(),v=n.variantChildren&&n.variantChildren.size?(T=0)=>{const{delayChildren:w=0,staggerChildren:C,staggerDirection:I}=f;return K_e(n,i,T,w,C,I,s)}:()=>Promise.resolve(),{when:b}=f;if(b){const[T,w]=b==="beforeChildren"?[p,v]:[v,p];return T().then(()=>w())}else return Promise.all([p(),v(s.delay)])}function K_e(n,i,s=0,c=0,f=0,p=1,v){const b=[];for(const T of n.variantChildren)T.notify("AnimationStart",i),b.push(xM(T,i,{...v,delay:s+(typeof c=="function"?0:c)+EJ(n.variantChildren,T,c,f,p)}).then(()=>T.notify("AnimationComplete",i)));return Promise.all(b)}function Y_e(n,i,s={}){n.notify("AnimationStart",i);let c;if(Array.isArray(i)){const f=i.map(p=>xM(n,p,s));c=Promise.all(f)}else if(typeof i=="string")c=xM(n,i,s);else{const f=typeof i=="function"?Av(n,i,s.custom):i;c=Promise.all(yJ(n,f,s))}return c.then(()=>{n.notify("AnimationComplete",i)})}function SJ(n,i){if(!Array.isArray(i))return!1;const s=i.length;if(s!==n.length)return!1;for(let c=0;c<s;c++)if(i[c]!==n[c])return!1;return!0}const q_e=iU.length;function bJ(n){if(!n)return;if(!n.isControllingVariants){const s=n.parent?bJ(n.parent)||{}:{};return n.props.initial!==void 0&&(s.initial=n.props.initial),s}const i={};for(let s=0;s<q_e;s++){const c=iU[s],f=n.props[c];(ob(f)||f===!1)&&(i[c]=f)}return i}const X_e=[...rU].reverse(),J_e=rU.length;function $_e(n){return i=>Promise.all(i.map(({animation:s,options:c})=>Y_e(n,s,c)))}function Z_e(n){let i=$_e(n),s=Qz(),c=!0;const f=T=>(w,C)=>{const I=Av(n,C,T==="exit"?n.presenceContext?.custom:void 0);if(I){const{transition:D,transitionEnd:L,...F}=I;w={...w,...F,...L}}return w};function p(T){i=T(n)}function v(T){const{props:w}=n,C=bJ(n.parent)||{},I=[],D=new Set;let L={},F=1/0;for(let G=0;G<J_e;G++){const $=X_e[G],te=s[$],Z=w[$]!==void 0?w[$]:C[$],ce=ob(Z),se=$===T?te.isActive:null;se===!1&&(F=G);let de=Z===C[$]&&Z!==w[$]&&ce;if(de&&c&&n.manuallyAnimateOnMount&&(de=!1),te.protectedKeys={...L},!te.isActive&&se===null||!Z&&!te.prevProp||II(Z)||typeof Z=="boolean")continue;const oe=Q_e(te.prevProp,Z);let ge=oe||$===T&&te.isActive&&!de&&ce||G>F&&ce,Ae=!1;const ke=Array.isArray(Z)?Z:[Z];let Ee=ke.reduce(f($),{});se===!1&&(Ee={});const{prevResolvedValues:be={}}=te,Le={...be,...Ee},et=_e=>{ge=!0,D.has(_e)&&(Ae=!0,D.delete(_e)),te.needsAnimating[_e]=!0;const ze=n.getValue(_e);ze&&(ze.liveStyle=!1)};for(const _e in Le){const ze=Ee[_e],tt=be[_e];if(L.hasOwnProperty(_e))continue;let ut=!1;IM(ze)&&IM(tt)?ut=!SJ(ze,tt):ut=ze!==tt,ut?ze!=null?et(_e):D.add(_e):ze!==void 0&&D.has(_e)?et(_e):te.protectedKeys[_e]=!0}te.prevProp=Z,te.prevResolvedValues=Ee,te.isActive&&(L={...L,...Ee}),c&&n.blockInitialAnimation&&(ge=!1);const rt=de&&oe;ge&&(!rt||Ae)&&I.push(...ke.map(_e=>{const ze={type:$};if(typeof _e=="string"&&c&&!rt&&n.manuallyAnimateOnMount&&n.parent){const{parent:tt}=n,ut=Av(tt,_e);if(tt.enteringChildren&&ut){const{delayChildren:me}=ut.transition||{};ze.delay=EJ(tt.enteringChildren,n,me)}}return{animation:_e,options:ze}}))}if(D.size){const G={};if(typeof w.initial!="boolean"){const $=Av(n,Array.isArray(w.initial)?w.initial[0]:w.initial);$&&$.transition&&(G.transition=$.transition)}D.forEach($=>{const te=n.getBaseTarget($),Z=n.getValue($);Z&&(Z.liveStyle=!0),G[$]=te??null}),I.push({animation:G})}let W=!!I.length;return c&&(w.initial===!1||w.initial===w.animate)&&!n.manuallyAnimateOnMount&&(W=!1),c=!1,W?i(I):Promise.resolve()}function b(T,w){if(s[T].isActive===w)return Promise.resolve();n.variantChildren?.forEach(I=>I.animationState?.setActive(T,w)),s[T].isActive=w;const C=v(T);for(const I in s)s[I].protectedKeys={};return C}return{animateChanges:v,setActive:b,setAnimateFunction:p,getState:()=>s,reset:()=>{s=Qz()}}}function Q_e(n,i){return typeof i=="string"?i!==n:Array.isArray(i)?!SJ(i,n):!1}function em(n=!1){return{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function Qz(){return{animate:em(!0),whileInView:em(),whileHover:em(),whileTap:em(),whileDrag:em(),whileFocus:em(),exit:em()}}class uf{constructor(i){this.isMounted=!1,this.node=i}update(){}}class eve extends uf{constructor(i){super(i),i.animationState||(i.animationState=Z_e(i))}updateAnimationControlsSubscription(){const{animate:i}=this.node.getProps();II(i)&&(this.unmountControls=i.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:i}=this.node.getProps(),{animate:s}=this.node.prevProps||{};i!==s&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let tve=0;class nve extends uf{constructor(){super(...arguments),this.id=tve++}update(){if(!this.node.presenceContext)return;const{isPresent:i,onExitComplete:s}=this.node.presenceContext,{isPresent:c}=this.node.prevPresenceContext||{};if(!this.node.animationState||i===c)return;const f=this.node.animationState.setActive("exit",!i);s&&!i&&f.then(()=>{s(this.id)})}mount(){const{register:i,onExitComplete:s}=this.node.presenceContext||{};s&&s(this.id),i&&(this.unmount=i(this.id))}unmount(){}}const rve={animation:{Feature:eve},exit:{Feature:nve}};function lb(n,i,s,c={passive:!0}){return n.addEventListener(i,s,c),()=>n.removeEventListener(i,s)}function Nb(n){return{point:{x:n.pageX,y:n.pageY}}}const ive=n=>i=>nU(i)&&n(i,Nb(i));function $S(n,i,s,c){return lb(n,i,ive(s),c)}const TJ=1e-4,ave=1-TJ,sve=1+TJ,wJ=.01,ove=0-wJ,cve=0+wJ;function Qa(n){return n.max-n.min}function lve(n,i,s){return Math.abs(n-i)<=s}function eK(n,i,s,c=.5){n.origin=c,n.originPoint=Yr(i.min,i.max,n.origin),n.scale=Qa(s)/Qa(i),n.translate=Yr(s.min,s.max,n.origin)-n.originPoint,(n.scale>=ave&&n.scale<=sve||isNaN(n.scale))&&(n.scale=1),(n.translate>=ove&&n.translate<=cve||isNaN(n.translate))&&(n.translate=0)}function ZS(n,i,s,c){eK(n.x,i.x,s.x,c?c.originX:void 0),eK(n.y,i.y,s.y,c?c.originY:void 0)}function tK(n,i,s){n.min=s.min+i.min,n.max=n.min+Qa(i)}function uve(n,i,s){tK(n.x,i.x,s.x),tK(n.y,i.y,s.y)}function nK(n,i,s){n.min=i.min-s.min,n.max=n.min+Qa(i)}function QS(n,i,s){nK(n.x,i.x,s.x),nK(n.y,i.y,s.y)}function Fo(n){return[n("x"),n("y")]}const RJ=({current:n})=>n?n.ownerDocument.defaultView:null,rK=(n,i)=>Math.abs(n-i);function dve(n,i){const s=rK(n.x,i.x),c=rK(n.y,i.y);return Math.sqrt(s**2+c**2)}class CJ{constructor(i,s,{transformPagePoint:c,contextWindow:f=window,dragSnapToOrigin:p=!1,distanceThreshold:v=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const D=Ak(this.lastMoveEventInfo,this.history),L=this.startEvent!==null,F=dve(D.offset,{x:0,y:0})>=this.distanceThreshold;if(!L&&!F)return;const{point:W}=D,{timestamp:G}=fa;this.history.push({...W,timestamp:G});const{onStart:$,onMove:te}=this.handlers;L||($&&$(this.lastMoveEvent,D),this.startEvent=this.lastMoveEvent),te&&te(this.lastMoveEvent,D)},this.handlePointerMove=(D,L)=>{this.lastMoveEvent=D,this.lastMoveEventInfo=Ck(L,this.transformPagePoint),Sr.update(this.updatePoint,!0)},this.handlePointerUp=(D,L)=>{this.end();const{onEnd:F,onSessionEnd:W,resumeAnimation:G}=this.handlers;if(this.dragSnapToOrigin&&G&&G(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const $=Ak(D.type==="pointercancel"?this.lastMoveEventInfo:Ck(L,this.transformPagePoint),this.history);this.startEvent&&F&&F(D,$),W&&W(D,$)},!nU(i))return;this.dragSnapToOrigin=p,this.handlers=s,this.transformPagePoint=c,this.distanceThreshold=v,this.contextWindow=f||window;const b=Nb(i),T=Ck(b,this.transformPagePoint),{point:w}=T,{timestamp:C}=fa;this.history=[{...w,timestamp:C}];const{onSessionStart:I}=s;I&&I(i,Ak(T,this.history)),this.removeListeners=Cb($S(this.contextWindow,"pointermove",this.handlePointerMove),$S(this.contextWindow,"pointerup",this.handlePointerUp),$S(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(i){this.handlers=i}end(){this.removeListeners&&this.removeListeners(),od(this.updatePoint)}}function Ck(n,i){return i?{point:i(n.point)}:n}function iK(n,i){return{x:n.x-i.x,y:n.y-i.y}}function Ak({point:n},i){return{point:n,delta:iK(n,AJ(i)),offset:iK(n,hve(i)),velocity:fve(i,.1)}}function hve(n){return n[0]}function AJ(n){return n[n.length-1]}function fve(n,i){if(n.length<2)return{x:0,y:0};let s=n.length-1,c=null;const f=AJ(n);for(;s>=0&&(c=n[s],!(f.timestamp-c.timestamp>Kl(i)));)s--;if(!c)return{x:0,y:0};const p=Ho(f.timestamp-c.timestamp);if(p===0)return{x:0,y:0};const v={x:(f.x-c.x)/p,y:(f.y-c.y)/p};return v.x===1/0&&(v.x=0),v.y===1/0&&(v.y=0),v}function pve(n,{min:i,max:s},c){return i!==void 0&&n<i?n=c?Yr(i,n,c.min):Math.max(n,i):s!==void 0&&n>s&&(n=c?Yr(s,n,c.max):Math.min(n,s)),n}function aK(n,i,s){return{min:i!==void 0?n.min+i:void 0,max:s!==void 0?n.max+s-(n.max-n.min):void 0}}function mve(n,{top:i,left:s,bottom:c,right:f}){return{x:aK(n.x,s,f),y:aK(n.y,i,c)}}function sK(n,i){let s=i.min-n.min,c=i.max-n.max;return i.max-i.min<n.max-n.min&&([s,c]=[c,s]),{min:s,max:c}}function gve(n,i){return{x:sK(n.x,i.x),y:sK(n.y,i.y)}}function _ve(n,i){let s=.5;const c=Qa(n),f=Qa(i);return f>c?s=ib(i.min,i.max-c,n.min):c>f&&(s=ib(n.min,n.max-f,i.min)),ad(0,1,s)}function vve(n,i){const s={};return i.min!==void 0&&(s.min=i.min-n.min),i.max!==void 0&&(s.max=i.max-n.min),s}const DM=.35;function yve(n=DM){return n===!1?n=0:n===!0&&(n=DM),{x:oK(n,"left","right"),y:oK(n,"top","bottom")}}function oK(n,i,s){return{min:cK(n,i),max:cK(n,s)}}function cK(n,i){return typeof n=="number"?n:n[i]||0}const Eve=new WeakMap;class Sve{constructor(i){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=pi(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=i}start(i,{snapToCursor:s=!1,distanceThreshold:c}={}){const{presenceContext:f}=this.visualElement;if(f&&f.isPresent===!1)return;const p=I=>{const{dragSnapToOrigin:D}=this.getProps();D?this.pauseAnimation():this.stopAnimation(),s&&this.snapToCursor(Nb(I).point)},v=(I,D)=>{const{drag:L,dragPropagation:F,onDragStart:W}=this.getProps();if(L&&!F&&(this.openDragLock&&this.openDragLock(),this.openDragLock=Rge(L),!this.openDragLock))return;this.latestPointerEvent=I,this.latestPanInfo=D,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Fo($=>{let te=this.getAxisMotionValue($).get()||0;if(Yl.test(te)){const{projection:Z}=this.visualElement;if(Z&&Z.layout){const ce=Z.layout.layoutBox[$];ce&&(te=Qa(ce)*(parseFloat(te)/100))}}this.originPoint[$]=te}),W&&Sr.postRender(()=>W(I,D)),NM(this.visualElement,"transform");const{animationState:G}=this.visualElement;G&&G.setActive("whileDrag",!0)},b=(I,D)=>{this.latestPointerEvent=I,this.latestPanInfo=D;const{dragPropagation:L,dragDirectionLock:F,onDirectionLock:W,onDrag:G}=this.getProps();if(!L&&!this.openDragLock)return;const{offset:$}=D;if(F&&this.currentDirection===null){this.currentDirection=bve($),this.currentDirection!==null&&W&&W(this.currentDirection);return}this.updateAxis("x",D.point,$),this.updateAxis("y",D.point,$),this.visualElement.render(),G&&G(I,D)},T=(I,D)=>{this.latestPointerEvent=I,this.latestPanInfo=D,this.stop(I,D),this.latestPointerEvent=null,this.latestPanInfo=null},w=()=>Fo(I=>this.getAnimationState(I)==="paused"&&this.getAxisMotionValue(I).animation?.play()),{dragSnapToOrigin:C}=this.getProps();this.panSession=new CJ(i,{onSessionStart:p,onStart:v,onMove:b,onSessionEnd:T,resumeAnimation:w},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:C,distanceThreshold:c,contextWindow:RJ(this.visualElement)})}stop(i,s){const c=i||this.latestPointerEvent,f=s||this.latestPanInfo,p=this.isDragging;if(this.cancel(),!p||!f||!c)return;const{velocity:v}=f;this.startAnimation(v);const{onDragEnd:b}=this.getProps();b&&Sr.postRender(()=>b(c,f))}cancel(){this.isDragging=!1;const{projection:i,animationState:s}=this.visualElement;i&&(i.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:c}=this.getProps();!c&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),s&&s.setActive("whileDrag",!1)}updateAxis(i,s,c){const{drag:f}=this.getProps();if(!c||!iO(i,f,this.currentDirection))return;const p=this.getAxisMotionValue(i);let v=this.originPoint[i]+c[i];this.constraints&&this.constraints[i]&&(v=pve(v,this.constraints[i],this.elastic[i])),p.set(v)}resolveConstraints(){const{dragConstraints:i,dragElastic:s}=this.getProps(),c=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,f=this.constraints;i&&Sv(i)?this.constraints||(this.constraints=this.resolveRefConstraints()):i&&c?this.constraints=mve(c.layoutBox,i):this.constraints=!1,this.elastic=yve(s),f!==this.constraints&&c&&this.constraints&&!this.hasMutatedConstraints&&Fo(p=>{this.constraints!==!1&&this.getAxisMotionValue(p)&&(this.constraints[p]=vve(c.layoutBox[p],this.constraints[p]))})}resolveRefConstraints(){const{dragConstraints:i,onMeasureDragConstraints:s}=this.getProps();if(!i||!Sv(i))return!1;const c=i.current,{projection:f}=this.visualElement;if(!f||!f.layout)return!1;const p=T_e(c,f.root,this.visualElement.getTransformPagePoint());let v=gve(f.layout.layoutBox,p);if(s){const b=s(E_e(v));this.hasMutatedConstraints=!!b,b&&(v=uJ(b))}return v}startAnimation(i){const{drag:s,dragMomentum:c,dragElastic:f,dragTransition:p,dragSnapToOrigin:v,onDragTransitionEnd:b}=this.getProps(),T=this.constraints||{},w=Fo(C=>{if(!iO(C,s,this.currentDirection))return;let I=T&&T[C]||{};v&&(I={min:0,max:0});const D=f?200:1e6,L=f?40:1e7,F={type:"inertia",velocity:c?i[C]:0,bounceStiffness:D,bounceDamping:L,timeConstant:750,restDelta:1,restSpeed:10,...p,...I};return this.startAxisValueAnimation(C,F)});return Promise.all(w).then(b)}startAxisValueAnimation(i,s){const c=this.getAxisMotionValue(i);return NM(this.visualElement,i),c.start(dU(i,c,0,s,this.visualElement,!1))}stopAnimation(){Fo(i=>this.getAxisMotionValue(i).stop())}pauseAnimation(){Fo(i=>this.getAxisMotionValue(i).animation?.pause())}getAnimationState(i){return this.getAxisMotionValue(i).animation?.state}getAxisMotionValue(i){const s=`_drag${i.toUpperCase()}`,c=this.visualElement.getProps(),f=c[s];return f||this.visualElement.getValue(i,(c.initial?c.initial[i]:void 0)||0)}snapToCursor(i){Fo(s=>{const{drag:c}=this.getProps();if(!iO(s,c,this.currentDirection))return;const{projection:f}=this.visualElement,p=this.getAxisMotionValue(s);if(f&&f.layout){const{min:v,max:b}=f.layout.layoutBox[s];p.set(i[s]-Yr(v,b,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:i,dragConstraints:s}=this.getProps(),{projection:c}=this.visualElement;if(!Sv(s)||!c||!this.constraints)return;this.stopAnimation();const f={x:0,y:0};Fo(v=>{const b=this.getAxisMotionValue(v);if(b&&this.constraints!==!1){const T=b.get();f[v]=_ve({min:T,max:T},this.constraints[v])}});const{transformTemplate:p}=this.visualElement.getProps();this.visualElement.current.style.transform=p?p({},""):"none",c.root&&c.root.updateScroll(),c.updateLayout(),this.resolveConstraints(),Fo(v=>{if(!iO(v,i,null))return;const b=this.getAxisMotionValue(v),{min:T,max:w}=this.constraints[v];b.set(Yr(T,w,f[v]))})}addListeners(){if(!this.visualElement.current)return;Eve.set(this.visualElement,this);const i=this.visualElement.current,s=$S(i,"pointerdown",T=>{const{drag:w,dragListener:C=!0}=this.getProps();w&&C&&this.start(T)}),c=()=>{const{dragConstraints:T}=this.getProps();Sv(T)&&T.current&&(this.constraints=this.resolveRefConstraints())},{projection:f}=this.visualElement,p=f.addEventListener("measure",c);f&&!f.layout&&(f.root&&f.root.updateScroll(),f.updateLayout()),Sr.read(c);const v=lb(window,"resize",()=>this.scalePositionWithinConstraints()),b=f.addEventListener("didUpdate",(({delta:T,hasLayoutChanged:w})=>{this.isDragging&&w&&(Fo(C=>{const I=this.getAxisMotionValue(C);I&&(this.originPoint[C]+=T[C].translate,I.set(I.get()+T[C].translate))}),this.visualElement.render())}));return()=>{v(),s(),p(),b&&b()}}getProps(){const i=this.visualElement.getProps(),{drag:s=!1,dragDirectionLock:c=!1,dragPropagation:f=!1,dragConstraints:p=!1,dragElastic:v=DM,dragMomentum:b=!0}=i;return{...i,drag:s,dragDirectionLock:c,dragPropagation:f,dragConstraints:p,dragElastic:v,dragMomentum:b}}}function iO(n,i,s){return(i===!0||i===n)&&(s===null||s===n)}function bve(n,i=10){let s=null;return Math.abs(n.y)>i?s="y":Math.abs(n.x)>i&&(s="x"),s}class Tve extends uf{constructor(i){super(i),this.removeGroupControls=Ko,this.removeListeners=Ko,this.controls=new Sve(i)}mount(){const{dragControls:i}=this.node.getProps();i&&(this.removeGroupControls=i.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Ko}unmount(){this.removeGroupControls(),this.removeListeners()}}const lK=n=>(i,s)=>{n&&Sr.postRender(()=>n(i,s))};class wve extends uf{constructor(){super(...arguments),this.removePointerDownListener=Ko}onPointerDown(i){this.session=new CJ(i,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:RJ(this.node)})}createPanHandlers(){const{onPanSessionStart:i,onPanStart:s,onPan:c,onPanEnd:f}=this.node.getProps();return{onSessionStart:lK(i),onStart:lK(s),onMove:c,onEnd:(p,v)=>{delete this.session,f&&Sr.postRender(()=>f(p,v))}}}mount(){this.removePointerDownListener=$S(this.node.current,"pointerdown",i=>this.onPointerDown(i))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const OO={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function uK(n,i){return i.max===i.min?0:n/(i.max-i.min)*100}const MS={correct:(n,i)=>{if(!i.target)return n;if(typeof n=="string")if(Yt.test(n))n=parseFloat(n);else return n;const s=uK(n,i.target.x),c=uK(n,i.target.y);return`${s}% ${c}%`}},Rve={correct:(n,{treeScale:i,projectionDelta:s})=>{const c=n,f=of.parse(n);if(f.length>5)return c;const p=of.createTransformer(n),v=typeof f[0]!="number"?1:0,b=s.x.scale*i.x,T=s.y.scale*i.y;f[0+v]/=b,f[1+v]/=T;const w=Yr(b,T,.5);return typeof f[2+v]=="number"&&(f[2+v]/=w),typeof f[3+v]=="number"&&(f[3+v]/=w),p(f)}};let Ok=!1;class Cve extends j.Component{componentDidMount(){const{visualElement:i,layoutGroup:s,switchLayoutGroup:c,layoutId:f}=this.props,{projection:p}=i;qge(Ave),p&&(s.group&&s.group.add(p),c&&c.register&&f&&c.register(p),Ok&&p.root.didUpdate(),p.addEventListener("animationComplete",()=>{this.safeToRemove()}),p.setOptions({...p.options,onExitComplete:()=>this.safeToRemove()})),OO.hasEverUpdated=!0}getSnapshotBeforeUpdate(i){const{layoutDependency:s,visualElement:c,drag:f,isPresent:p}=this.props,{projection:v}=c;return v&&(v.isPresent=p,Ok=!0,f||i.layoutDependency!==s||s===void 0||i.isPresent!==p?v.willUpdate():this.safeToRemove(),i.isPresent!==p&&(p?v.promote():v.relegate()||Sr.postRender(()=>{const b=v.getStack();(!b||!b.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:i}=this.props.visualElement;i&&(i.root.didUpdate(),tU.postRender(()=>{!i.currentAnimation&&i.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:i,layoutGroup:s,switchLayoutGroup:c}=this.props,{projection:f}=i;Ok=!0,f&&(f.scheduleCheckAfterUnmount(),s&&s.group&&s.group.remove(f),c&&c.deregister&&c.deregister(f))}safeToRemove(){const{safeToRemove:i}=this.props;i&&i()}render(){return null}}function OJ(n){const[i,s]=JX(),c=j.useContext(k2);return R.jsx(Cve,{...n,layoutGroup:c,switchLayoutGroup:j.useContext(cJ),isPresent:i,safeToRemove:s})}const Ave={borderRadius:{...MS,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:MS,borderTopRightRadius:MS,borderBottomLeftRadius:MS,borderBottomRightRadius:MS,boxShadow:Rve};function Ove(n,i,s){const c=ea(n)?n:vm(n);return c.start(dU("",c,i,s)),c.animation}const Ive=(n,i)=>n.depth-i.depth;class Nve{constructor(){this.children=[],this.isDirty=!1}add(i){U2(this.children,i),this.isDirty=!0}remove(i){j2(this.children,i),this.isDirty=!0}forEach(i){this.isDirty&&this.children.sort(Ive),this.isDirty=!1,this.children.forEach(i)}}function xve(n,i){const s=Is.now(),c=({timestamp:f})=>{const p=f-s;p>=i&&(od(c),n(p-i))};return Sr.setup(c,!0),()=>od(c)}const IJ=["TopLeft","TopRight","BottomLeft","BottomRight"],Dve=IJ.length,dK=n=>typeof n=="string"?parseFloat(n):n,hK=n=>typeof n=="number"||Yt.test(n);function Pve(n,i,s,c,f,p){f?(n.opacity=Yr(0,s.opacity??1,kve(c)),n.opacityExit=Yr(i.opacity??1,0,Lve(c))):p&&(n.opacity=Yr(i.opacity??1,s.opacity??1,c));for(let v=0;v<Dve;v++){const b=`border${IJ[v]}Radius`;let T=fK(i,b),w=fK(s,b);if(T===void 0&&w===void 0)continue;T||(T=0),w||(w=0),T===0||w===0||hK(T)===hK(w)?(n[b]=Math.max(Yr(dK(T),dK(w),c),0),(Yl.test(w)||Yl.test(T))&&(n[b]+="%")):n[b]=w}(i.rotate||s.rotate)&&(n.rotate=Yr(i.rotate||0,s.rotate||0,c))}function fK(n,i){return n[i]!==void 0?n[i]:n.borderRadius}const kve=NJ(0,.5,mX),Lve=NJ(.5,.95,Ko);function NJ(n,i,s){return c=>c<n?0:c>i?1:s(ib(n,i,c))}function pK(n,i){n.min=i.min,n.max=i.max}function jo(n,i){pK(n.x,i.x),pK(n.y,i.y)}function mK(n,i){n.translate=i.translate,n.scale=i.scale,n.originPoint=i.originPoint,n.origin=i.origin}function gK(n,i,s,c,f){return n-=i,n=BO(n,1/s,c),f!==void 0&&(n=BO(n,1/f,c)),n}function Mve(n,i=0,s=1,c=.5,f,p=n,v=n){if(Yl.test(i)&&(i=parseFloat(i),i=Yr(v.min,v.max,i/100)-v.min),typeof i!="number")return;let b=Yr(p.min,p.max,c);n===p&&(b-=i),n.min=gK(n.min,i,s,b,f),n.max=gK(n.max,i,s,b,f)}function _K(n,i,[s,c,f],p,v){Mve(n,i[s],i[c],i[f],i.scale,p,v)}const Uve=["x","scaleX","originX"],jve=["y","scaleY","originY"];function vK(n,i,s,c){_K(n.x,i,Uve,s?s.x:void 0,c?c.x:void 0),_K(n.y,i,jve,s?s.y:void 0,c?c.y:void 0)}function yK(n){return n.translate===0&&n.scale===1}function xJ(n){return yK(n.x)&&yK(n.y)}function EK(n,i){return n.min===i.min&&n.max===i.max}function Vve(n,i){return EK(n.x,i.x)&&EK(n.y,i.y)}function SK(n,i){return Math.round(n.min)===Math.round(i.min)&&Math.round(n.max)===Math.round(i.max)}function DJ(n,i){return SK(n.x,i.x)&&SK(n.y,i.y)}function bK(n){return Qa(n.x)/Qa(n.y)}function TK(n,i){return n.translate===i.translate&&n.scale===i.scale&&n.originPoint===i.originPoint}class Bve{constructor(){this.members=[]}add(i){U2(this.members,i),i.scheduleRender()}remove(i){if(j2(this.members,i),i===this.prevLead&&(this.prevLead=void 0),i===this.lead){const s=this.members[this.members.length-1];s&&this.promote(s)}}relegate(i){const s=this.members.findIndex(f=>i===f);if(s===0)return!1;let c;for(let f=s;f>=0;f--){const p=this.members[f];if(p.isPresent!==!1){c=p;break}}return c?(this.promote(c),!0):!1}promote(i,s){const c=this.lead;if(i!==c&&(this.prevLead=c,this.lead=i,i.show(),c)){c.instance&&c.scheduleRender(),i.scheduleRender(),i.resumeFrom=c,s&&(i.resumeFrom.preserveOpacity=!0),c.snapshot&&(i.snapshot=c.snapshot,i.snapshot.latestValues=c.animationValues||c.latestValues),i.root&&i.root.isUpdating&&(i.isLayoutDirty=!0);const{crossfade:f}=i.options;f===!1&&c.hide()}}exitAnimationComplete(){this.members.forEach(i=>{const{options:s,resumingFrom:c}=i;s.onExitComplete&&s.onExitComplete(),c&&c.options.onExitComplete&&c.options.onExitComplete()})}scheduleRender(){this.members.forEach(i=>{i.instance&&i.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function Fve(n,i,s){let c="";const f=n.x.translate/i.x,p=n.y.translate/i.y,v=s?.z||0;if((f||p||v)&&(c=`translate3d(${f}px, ${p}px, ${v}px) `),(i.x!==1||i.y!==1)&&(c+=`scale(${1/i.x}, ${1/i.y}) `),s){const{transformPerspective:w,rotate:C,rotateX:I,rotateY:D,skewX:L,skewY:F}=s;w&&(c=`perspective(${w}px) ${c}`),C&&(c+=`rotate(${C}deg) `),I&&(c+=`rotateX(${I}deg) `),D&&(c+=`rotateY(${D}deg) `),L&&(c+=`skewX(${L}deg) `),F&&(c+=`skewY(${F}deg) `)}const b=n.x.scale*i.x,T=n.y.scale*i.y;return(b!==1||T!==1)&&(c+=`scale(${b}, ${T})`),c||"none"}const Ik=["","X","Y","Z"],Gve=1e3;let Hve=0;function Nk(n,i,s,c){const{latestValues:f}=i;f[n]&&(s[n]=f[n],i.setStaticValue(n,0),c&&(c[n]=0))}function PJ(n){if(n.hasCheckedOptimisedAppear=!0,n.root===n)return;const{visualElement:i}=n.options;if(!i)return;const s=vJ(i);if(window.MotionHasOptimisedAnimation(s,"transform")){const{layout:f,layoutId:p}=n.options;window.MotionCancelOptimisedAnimation(s,"transform",Sr,!(f||p))}const{parent:c}=n;c&&!c.hasCheckedOptimisedAppear&&PJ(c)}function kJ({attachResizeListener:n,defaultParent:i,measureScroll:s,checkIsScrollRoot:c,resetTransform:f}){return class{constructor(v={},b=i?.()){this.id=Hve++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(Kve),this.nodes.forEach(Jve),this.nodes.forEach($ve),this.nodes.forEach(Yve)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=v,this.root=b?b.root||b:this,this.path=b?[...b.path,b]:[],this.parent=b,this.depth=b?b.depth+1:0;for(let T=0;T<this.path.length;T++)this.path[T].shouldResetTransform=!0;this.root===this&&(this.nodes=new Nve)}addEventListener(v,b){return this.eventHandlers.has(v)||this.eventHandlers.set(v,new F2),this.eventHandlers.get(v).add(b)}notifyListeners(v,...b){const T=this.eventHandlers.get(v);T&&T.notify(...b)}hasListeners(v){return this.eventHandlers.has(v)}mount(v){if(this.instance)return;this.isSVG=XX(v)&&!xge(v),this.instance=v;const{layoutId:b,layout:T,visualElement:w}=this.options;if(w&&!w.current&&w.mount(v),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(T||b)&&(this.isLayoutDirty=!0),n){let C,I=0;const D=()=>this.root.updateBlockedByResize=!1;Sr.read(()=>{I=window.innerWidth}),n(v,()=>{const L=window.innerWidth;L!==I&&(I=L,this.root.updateBlockedByResize=!0,C&&C(),C=xve(D,250),OO.hasAnimatedSinceResize&&(OO.hasAnimatedSinceResize=!1,this.nodes.forEach(CK)))})}b&&this.root.registerSharedNode(b,this),this.options.animate!==!1&&w&&(b||T)&&this.addEventListener("didUpdate",({delta:C,hasLayoutChanged:I,hasRelativeLayoutChanged:D,layout:L})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const F=this.options.transition||w.getDefaultTransition()||nye,{onLayoutAnimationStart:W,onLayoutAnimationComplete:G}=w.getProps(),$=!this.targetLayout||!DJ(this.targetLayout,L),te=!I&&D;if(this.options.layoutRoot||this.resumeFrom||te||I&&($||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const Z={...Q2(F,"layout"),onPlay:W,onComplete:G};(w.shouldReduceMotion||this.options.layoutRoot)&&(Z.delay=0,Z.type=!1),this.startAnimation(Z),this.setAnimationOrigin(C,te)}else I||CK(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=L})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const v=this.getStack();v&&v.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),od(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(Zve),this.animationId++)}getTransformTemplate(){const{visualElement:v}=this.options;return v&&v.getProps().transformTemplate}willUpdate(v=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&PJ(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let C=0;C<this.path.length;C++){const I=this.path[C];I.shouldResetTransform=!0,I.updateScroll("snapshot"),I.options.layoutRoot&&I.willUpdate(!1)}const{layoutId:b,layout:T}=this.options;if(b===void 0&&!T)return;const w=this.getTransformTemplate();this.prevTransformTemplateValue=w?w(this.latestValues,""):void 0,this.updateSnapshot(),v&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(wK);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(RK);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(Xve),this.nodes.forEach(Wve),this.nodes.forEach(zve)):this.nodes.forEach(RK),this.clearAllSnapshots();const b=Is.now();fa.delta=ad(0,1e3/60,b-fa.timestamp),fa.timestamp=b,fa.isProcessing=!0,vk.update.process(fa),vk.preRender.process(fa),vk.render.process(fa),fa.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,tU.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(qve),this.sharedNodes.forEach(Qve)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Sr.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Sr.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!Qa(this.snapshot.measuredBox.x)&&!Qa(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let T=0;T<this.path.length;T++)this.path[T].updateScroll();const v=this.layout;this.layout=this.measure(!1),this.layoutCorrected=pi(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:b}=this.options;b&&b.notify("LayoutMeasure",this.layout.layoutBox,v?v.layoutBox:void 0)}updateScroll(v="measure"){let b=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===v&&(b=!1),b&&this.instance){const T=c(this.instance);this.scroll={animationId:this.root.animationId,phase:v,isRoot:T,offset:s(this.instance),wasRoot:this.scroll?this.scroll.isRoot:T}}}resetTransform(){if(!f)return;const v=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,b=this.projectionDelta&&!xJ(this.projectionDelta),T=this.getTransformTemplate(),w=T?T(this.latestValues,""):void 0,C=w!==this.prevTransformTemplateValue;v&&this.instance&&(b||nm(this.latestValues)||C)&&(f(this.instance,w),this.shouldResetTransform=!1,this.scheduleRender())}measure(v=!0){const b=this.measurePageBox();let T=this.removeElementScroll(b);return v&&(T=this.removeTransform(T)),rye(T),{animationId:this.root.animationId,measuredBox:b,layoutBox:T,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:v}=this.options;if(!v)return pi();const b=v.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(iye))){const{scroll:w}=this.root;w&&(bv(b.x,w.offset.x),bv(b.y,w.offset.y))}return b}removeElementScroll(v){const b=pi();if(jo(b,v),this.scroll?.wasRoot)return b;for(let T=0;T<this.path.length;T++){const w=this.path[T],{scroll:C,options:I}=w;w!==this.root&&C&&I.layoutScroll&&(C.wasRoot&&jo(b,v),bv(b.x,C.offset.x),bv(b.y,C.offset.y))}return b}applyTransform(v,b=!1){const T=pi();jo(T,v);for(let w=0;w<this.path.length;w++){const C=this.path[w];!b&&C.options.layoutScroll&&C.scroll&&C!==C.root&&Tv(T,{x:-C.scroll.offset.x,y:-C.scroll.offset.y}),nm(C.latestValues)&&Tv(T,C.latestValues)}return nm(this.latestValues)&&Tv(T,this.latestValues),T}removeTransform(v){const b=pi();jo(b,v);for(let T=0;T<this.path.length;T++){const w=this.path[T];if(!w.instance||!nm(w.latestValues))continue;CM(w.latestValues)&&w.updateSnapshot();const C=pi(),I=w.measurePageBox();jo(C,I),vK(b,w.latestValues,w.snapshot?w.snapshot.layoutBox:void 0,C)}return nm(this.latestValues)&&vK(b,this.latestValues),b}setTargetDelta(v){this.targetDelta=v,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(v){this.options={...this.options,...v,crossfade:v.crossfade!==void 0?v.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==fa.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(v=!1){const b=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=b.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=b.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=b.isSharedProjectionDirty);const T=!!this.resumingFrom||this!==b;if(!(v||T&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:C,layoutId:I}=this.options;if(!(!this.layout||!(C||I))){if(this.resolvedRelativeTargetAt=fa.timestamp,!this.targetDelta&&!this.relativeTarget){const D=this.getClosestProjectingParent();D&&D.layout&&this.animationProgress!==1?(this.relativeParent=D,this.forceRelativeParentToResolveTarget(),this.relativeTarget=pi(),this.relativeTargetOrigin=pi(),QS(this.relativeTargetOrigin,this.layout.layoutBox,D.layout.layoutBox),jo(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=pi(),this.targetWithTransforms=pi()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),uve(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):jo(this.target,this.layout.layoutBox),hJ(this.target,this.targetDelta)):jo(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const D=this.getClosestProjectingParent();D&&!!D.resumingFrom==!!this.resumingFrom&&!D.options.layoutScroll&&D.target&&this.animationProgress!==1?(this.relativeParent=D,this.forceRelativeParentToResolveTarget(),this.relativeTarget=pi(),this.relativeTargetOrigin=pi(),QS(this.relativeTargetOrigin,this.target,D.target),jo(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||CM(this.parent.latestValues)||dJ(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){const v=this.getLead(),b=!!this.resumingFrom||this!==v;let T=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(T=!1),b&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(T=!1),this.resolvedRelativeTargetAt===fa.timestamp&&(T=!1),T)return;const{layout:w,layoutId:C}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(w||C))return;jo(this.layoutCorrected,this.layout.layoutBox);const I=this.treeScale.x,D=this.treeScale.y;b_e(this.layoutCorrected,this.treeScale,this.path,b),v.layout&&!v.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(v.target=v.layout.layoutBox,v.targetWithTransforms=pi());const{target:L}=v;if(!L){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(mK(this.prevProjectionDelta.x,this.projectionDelta.x),mK(this.prevProjectionDelta.y,this.projectionDelta.y)),ZS(this.projectionDelta,this.layoutCorrected,L,this.latestValues),(this.treeScale.x!==I||this.treeScale.y!==D||!TK(this.projectionDelta.x,this.prevProjectionDelta.x)||!TK(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",L))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(v=!0){if(this.options.visualElement?.scheduleRender(),v){const b=this.getStack();b&&b.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=wv(),this.projectionDelta=wv(),this.projectionDeltaWithTransform=wv()}setAnimationOrigin(v,b=!1){const T=this.snapshot,w=T?T.latestValues:{},C={...this.latestValues},I=wv();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!b;const D=pi(),L=T?T.source:void 0,F=this.layout?this.layout.source:void 0,W=L!==F,G=this.getStack(),$=!G||G.members.length<=1,te=!!(W&&!$&&this.options.crossfade===!0&&!this.path.some(tye));this.animationProgress=0;let Z;this.mixTargetDelta=ce=>{const se=ce/1e3;AK(I.x,v.x,se),AK(I.y,v.y,se),this.setTargetDelta(I),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(QS(D,this.layout.layoutBox,this.relativeParent.layout.layoutBox),eye(this.relativeTarget,this.relativeTargetOrigin,D,se),Z&&Vve(this.relativeTarget,Z)&&(this.isProjectionDirty=!1),Z||(Z=pi()),jo(Z,this.relativeTarget)),W&&(this.animationValues=C,Pve(C,w,this.latestValues,se,te,$)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=se},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(v){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(od(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Sr.update(()=>{OO.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=vm(0)),this.currentAnimation=Ove(this.motionValue,[0,1e3],{...v,velocity:0,isSync:!0,onUpdate:b=>{this.mixTargetDelta(b),v.onUpdate&&v.onUpdate(b)},onStop:()=>{},onComplete:()=>{v.onComplete&&v.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const v=this.getStack();v&&v.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(Gve),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const v=this.getLead();let{targetWithTransforms:b,target:T,layout:w,latestValues:C}=v;if(!(!b||!T||!w)){if(this!==v&&this.layout&&w&&LJ(this.options.animationType,this.layout.layoutBox,w.layoutBox)){T=this.target||pi();const I=Qa(this.layout.layoutBox.x);T.x.min=v.target.x.min,T.x.max=T.x.min+I;const D=Qa(this.layout.layoutBox.y);T.y.min=v.target.y.min,T.y.max=T.y.min+D}jo(b,T),Tv(b,C),ZS(this.projectionDeltaWithTransform,this.layoutCorrected,b,C)}}registerSharedNode(v,b){this.sharedNodes.has(v)||this.sharedNodes.set(v,new Bve),this.sharedNodes.get(v).add(b);const w=b.options.initialPromotionConfig;b.promote({transition:w?w.transition:void 0,preserveFollowOpacity:w&&w.shouldPreserveFollowOpacity?w.shouldPreserveFollowOpacity(b):void 0})}isLead(){const v=this.getStack();return v?v.lead===this:!0}getLead(){const{layoutId:v}=this.options;return v?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:v}=this.options;return v?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:v}=this.options;if(v)return this.root.sharedNodes.get(v)}promote({needsReset:v,transition:b,preserveFollowOpacity:T}={}){const w=this.getStack();w&&w.promote(this,T),v&&(this.projectionDelta=void 0,this.needsReset=!0),b&&this.setOptions({transition:b})}relegate(){const v=this.getStack();return v?v.relegate(this):!1}resetSkewAndRotation(){const{visualElement:v}=this.options;if(!v)return;let b=!1;const{latestValues:T}=v;if((T.z||T.rotate||T.rotateX||T.rotateY||T.rotateZ||T.skewX||T.skewY)&&(b=!0),!b)return;const w={};T.z&&Nk("z",v,w,this.animationValues);for(let C=0;C<Ik.length;C++)Nk(`rotate${Ik[C]}`,v,w,this.animationValues),Nk(`skew${Ik[C]}`,v,w,this.animationValues);v.render();for(const C in w)v.setStaticValue(C,w[C]),this.animationValues&&(this.animationValues[C]=w[C]);v.scheduleRender()}applyProjectionStyles(v,b){if(!this.instance||this.isSVG)return;if(!this.isVisible){v.visibility="hidden";return}const T=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,v.visibility="",v.opacity="",v.pointerEvents=AO(b?.pointerEvents)||"",v.transform=T?T(this.latestValues,""):"none";return}const w=this.getLead();if(!this.projectionDelta||!this.layout||!w.target){this.options.layoutId&&(v.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,v.pointerEvents=AO(b?.pointerEvents)||""),this.hasProjected&&!nm(this.latestValues)&&(v.transform=T?T({},""):"none",this.hasProjected=!1);return}v.visibility="";const C=w.animationValues||w.latestValues;this.applyTransformsToTarget();let I=Fve(this.projectionDeltaWithTransform,this.treeScale,C);T&&(I=T(C,I)),v.transform=I;const{x:D,y:L}=this.projectionDelta;v.transformOrigin=`${D.origin*100}% ${L.origin*100}% 0`,w.animationValues?v.opacity=w===this?C.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:C.opacityExit:v.opacity=w===this?C.opacity!==void 0?C.opacity:"":C.opacityExit!==void 0?C.opacityExit:0;for(const F in cb){if(C[F]===void 0)continue;const{correct:W,applyTo:G,isCSSVariable:$}=cb[F],te=I==="none"?C[F]:W(C[F],w);if(G){const Z=G.length;for(let ce=0;ce<Z;ce++)v[G[ce]]=te}else $?this.options.visualElement.renderState.vars[F]=te:v[F]=te}this.options.layoutId&&(v.pointerEvents=w===this?AO(b?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(v=>v.currentAnimation?.stop()),this.root.nodes.forEach(wK),this.root.sharedNodes.clear()}}}function Wve(n){n.updateLayout()}function zve(n){const i=n.resumeFrom?.snapshot||n.snapshot;if(n.isLead()&&n.layout&&i&&n.hasListeners("didUpdate")){const{layoutBox:s,measuredBox:c}=n.layout,{animationType:f}=n.options,p=i.source!==n.layout.source;f==="size"?Fo(C=>{const I=p?i.measuredBox[C]:i.layoutBox[C],D=Qa(I);I.min=s[C].min,I.max=I.min+D}):LJ(f,i.layoutBox,s)&&Fo(C=>{const I=p?i.measuredBox[C]:i.layoutBox[C],D=Qa(s[C]);I.max=I.min+D,n.relativeTarget&&!n.currentAnimation&&(n.isProjectionDirty=!0,n.relativeTarget[C].max=n.relativeTarget[C].min+D)});const v=wv();ZS(v,s,i.layoutBox);const b=wv();p?ZS(b,n.applyTransform(c,!0),i.measuredBox):ZS(b,s,i.layoutBox);const T=!xJ(v);let w=!1;if(!n.resumeFrom){const C=n.getClosestProjectingParent();if(C&&!C.resumeFrom){const{snapshot:I,layout:D}=C;if(I&&D){const L=pi();QS(L,i.layoutBox,I.layoutBox);const F=pi();QS(F,s,D.layoutBox),DJ(L,F)||(w=!0),C.options.layoutRoot&&(n.relativeTarget=F,n.relativeTargetOrigin=L,n.relativeParent=C)}}}n.notifyListeners("didUpdate",{layout:s,snapshot:i,delta:b,layoutDelta:v,hasLayoutChanged:T,hasRelativeLayoutChanged:w})}else if(n.isLead()){const{onExitComplete:s}=n.options;s&&s()}n.options.transition=void 0}function Kve(n){n.parent&&(n.isProjecting()||(n.isProjectionDirty=n.parent.isProjectionDirty),n.isSharedProjectionDirty||(n.isSharedProjectionDirty=!!(n.isProjectionDirty||n.parent.isProjectionDirty||n.parent.isSharedProjectionDirty)),n.isTransformDirty||(n.isTransformDirty=n.parent.isTransformDirty))}function Yve(n){n.isProjectionDirty=n.isSharedProjectionDirty=n.isTransformDirty=!1}function qve(n){n.clearSnapshot()}function wK(n){n.clearMeasurements()}function RK(n){n.isLayoutDirty=!1}function Xve(n){const{visualElement:i}=n.options;i&&i.getProps().onBeforeLayoutMeasure&&i.notify("BeforeLayoutMeasure"),n.resetTransform()}function CK(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0,n.isProjectionDirty=!0}function Jve(n){n.resolveTargetDelta()}function $ve(n){n.calcProjection()}function Zve(n){n.resetSkewAndRotation()}function Qve(n){n.removeLeadSnapshot()}function AK(n,i,s){n.translate=Yr(i.translate,0,s),n.scale=Yr(i.scale,1,s),n.origin=i.origin,n.originPoint=i.originPoint}function OK(n,i,s,c){n.min=Yr(i.min,s.min,c),n.max=Yr(i.max,s.max,c)}function eye(n,i,s,c){OK(n.x,i.x,s.x,c),OK(n.y,i.y,s.y,c)}function tye(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}const nye={duration:.45,ease:[.4,0,.1,1]},IK=n=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(n),NK=IK("applewebkit/")&&!IK("chrome/")?Math.round:Ko;function xK(n){n.min=NK(n.min),n.max=NK(n.max)}function rye(n){xK(n.x),xK(n.y)}function LJ(n,i,s){return n==="position"||n==="preserve-aspect"&&!lve(bK(i),bK(s),.2)}function iye(n){return n!==n.root&&n.scroll?.wasRoot}const aye=kJ({attachResizeListener:(n,i)=>lb(n,"resize",i),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),xk={current:void 0},MJ=kJ({measureScroll:n=>({x:n.scrollLeft,y:n.scrollTop}),defaultParent:()=>{if(!xk.current){const n=new aye({});n.mount(window),n.setOptions({layoutScroll:!0}),xk.current=n}return xk.current},resetTransform:(n,i)=>{n.style.transform=i!==void 0?i:"none"},checkIsScrollRoot:n=>window.getComputedStyle(n).position==="fixed"}),sye={pan:{Feature:wve},drag:{Feature:Tve,ProjectionNode:MJ,MeasureLayout:OJ}};function DK(n,i,s){const{props:c}=n;n.animationState&&c.whileHover&&n.animationState.setActive("whileHover",s==="Start");const f="onHover"+s,p=c[f];p&&Sr.postRender(()=>p(i,Nb(i)))}class oye extends uf{mount(){const{current:i}=this.node;i&&(this.unmount=Cge(i,(s,c)=>(DK(this.node,c,"Start"),f=>DK(this.node,f,"End"))))}unmount(){}}class cye extends uf{constructor(){super(...arguments),this.isActive=!1}onFocus(){let i=!1;try{i=this.node.current.matches(":focus-visible")}catch{i=!0}!i||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Cb(lb(this.node.current,"focus",()=>this.onFocus()),lb(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function PK(n,i,s){const{props:c}=n;if(n.current instanceof HTMLButtonElement&&n.current.disabled)return;n.animationState&&c.whileTap&&n.animationState.setActive("whileTap",s==="Start");const f="onTap"+(s==="End"?"":s),p=c[f];p&&Sr.postRender(()=>p(i,Nb(i)))}class lye extends uf{mount(){const{current:i}=this.node;i&&(this.unmount=Nge(i,(s,c)=>(PK(this.node,c,"Start"),(f,{success:p})=>PK(this.node,f,p?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const PM=new WeakMap,Dk=new WeakMap,uye=n=>{const i=PM.get(n.target);i&&i(n)},dye=n=>{n.forEach(uye)};function hye({root:n,...i}){const s=n||document;Dk.has(s)||Dk.set(s,{});const c=Dk.get(s),f=JSON.stringify(i);return c[f]||(c[f]=new IntersectionObserver(dye,{root:n,...i})),c[f]}function fye(n,i,s){const c=hye(i);return PM.set(n,s),c.observe(n),()=>{PM.delete(n),c.unobserve(n)}}const pye={some:0,all:1};class mye extends uf{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:i={}}=this.node.getProps(),{root:s,margin:c,amount:f="some",once:p}=i,v={root:s?s.current:void 0,rootMargin:c,threshold:typeof f=="number"?f:pye[f]},b=T=>{const{isIntersecting:w}=T;if(this.isInView===w||(this.isInView=w,p&&!w&&this.hasEnteredView))return;w&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",w);const{onViewportEnter:C,onViewportLeave:I}=this.node.getProps(),D=w?C:I;D&&D(T)};return fye(this.node.current,v,b)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:i,prevProps:s}=this.node;["amount","margin","root"].some(gye(i,s))&&this.startObserver()}unmount(){}}function gye({viewport:n={}},{viewport:i={}}={}){return s=>n[s]!==i[s]}const _ye={inView:{Feature:mye},tap:{Feature:lye},focus:{Feature:cye},hover:{Feature:oye}},vye={layout:{ProjectionNode:MJ,MeasureLayout:OJ}},yye={...rve,..._ye,...sye,...vye},Ht=y_e(yye,D_e);function hU(n){const i=Rb(()=>vm(n)),{isStatic:s}=j.useContext(Ib);if(s){const[,c]=j.useState(n);j.useEffect(()=>i.on("change",c),[])}return i}function UJ(n,i){const s=hU(i()),c=()=>s.set(i());return c(),M2(()=>{const f=()=>Sr.preRender(c,!1,!0),p=n.map(v=>v.on("change",f));return()=>{p.forEach(v=>v()),od(c)}}),s}function Eye(n){JS.current=[],n();const i=UJ(JS.current,n);return JS.current=void 0,i}function jJ(n,i,s,c){if(typeof n=="function")return Eye(n);const f=typeof i=="function"?i:Dge(i,s,c);return Array.isArray(n)?kK(n,f):kK([n],([p])=>f(p))}function kK(n,i){const s=Rb(()=>[]);return UJ(n,()=>{s.length=0;const c=n.length;for(let f=0;f<c;f++)s[f]=n[f].get();return i(s)})}function Sye(n,i={}){const{isStatic:s}=j.useContext(Ib),c=()=>ea(n)?n.get():n;if(s)return jJ(c);const f=hU(c());return j.useInsertionEffect(()=>Pge(f,n,i),[f,JSON.stringify(i)]),f}const LK="mindecho_sidebar_collapsed_v1";j.lazy(()=>Khe(()=>import("./VideoCallDock-C2WPVd4G.js"),[]).catch(()=>({default:()=>null})));function bye({label:n}){return R.jsx("span",{role:"tooltip","aria-hidden":"true",className:"absolute z-50 pointer-events-none whitespace-nowrap px-3 py-1 rounded-md text-xs font-medium bg-gray-800 text-gray-100 shadow-lg -translate-y-1/2 left-full ml-3 top-1/2",children:n})}function Ql(){const{user:n,logout:i}=ao(),{addToast:s}=Wq(),c=Zl(),f=lf(),[p,v]=j.useState(()=>{try{return localStorage.getItem(LK)==="1"}catch{return!1}}),[b,T]=j.useState(!1),[w,C]=j.useState(null),I=j.useRef(null);j.useEffect(()=>{try{localStorage.setItem(LK,p?"1":"0")}catch{}},[p]),j.useEffect(()=>(window.showMindEchoMobileMenu=()=>T(!0),()=>{try{delete window.showMindEchoMobileMenu}catch{}}),[]),j.useEffect(()=>{const G=document.body.style.overflow;return b?document.body.style.overflow="hidden":document.body.style.overflow=G||"",()=>{try{document.body.style.overflow=G||""}catch{}}},[b]),j.useEffect(()=>{b&&I.current&&setTimeout(()=>I.current.focus(),80)},[b]),j.useEffect(()=>{const G=$=>{$.key==="Escape"&&b&&T(!1)};return document.addEventListener("keydown",G),()=>document.removeEventListener("keydown",G)},[b]);const D=[{to:"/dashboard",label:"Dashboard",icon:kfe},{to:"/call",label:"Therapy Session",icon:iX},{to:"/mood",label:"My Mood",icon:Dfe},{to:"/meditation",label:"Meditation",icon:kO},{to:"/journal",label:"My Journal",icon:$q},{to:"/community",label:"Community",icon:rX},{to:"/history",label:"History",icon:epe},{to:`/profile/${n?.profile?.id||""}`,label:"Profile",icon:mz,showForGuest:!!n?.profile},{to:"/settings",label:"Settings",icon:LO}],L=G=>G?c.pathname===G||c.pathname.startsWith(G+"/"):!1,F=async()=>{try{await i(),s({title:"Signed out",description:"You have been logged out.",tone:"success"}),f("/login")}catch(G){s({title:"Logout failed",description:G?.message||"Try again",tone:"error"})}},W={idle:{opacity:1,y:0},hover:{scale:1.04,y:-2}};return R.jsxs(R.Fragment,{children:[R.jsxs("div",{className:"lg:hidden flex items-center justify-between p-3 border-b bg-gray-900 border-gray-800 sticky top-0 z-40",children:[R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsx("button",{onClick:()=>T(!0),"aria-label":"Open menu",className:"lg:hidden p-2 rounded hover:bg-gray-800",children:R.jsx(tX,{className:"text-gray-200 w-5 h-5"})}),R.jsx("div",{className:"inline-flex items-center justify-center w-8 h-8 bg-gradient-to-br from-purple-600 to-indigo-600 rounded-lg",children:R.jsx(af,{className:"w-5 h-5 text-white"})}),R.jsx("div",{className:"font-semibold text-white truncate",children:"MindEcho"})]}),R.jsx("div",{className:"flex items-center gap-2",children:R.jsx("button",{onClick:()=>f("/profile/"+(n?.profile?.id||"")),"aria-label":"Open profile",className:"p-2 rounded hover:bg-gray-800/40",children:R.jsx("img",{src:n?.profile?.avatarUrl||"https://placehold.co/40/444/CCC?text=?",alt:"avatar",className:"w-8 h-8 rounded-full border"})})})]}),R.jsxs("aside",{className:`hidden lg:flex flex-col bg-gray-900 text-gray-300 border-r border-gray-800 shadow-xl transition-all duration-200 ${p?"w-20":"w-72"}`,"aria-label":"Main navigation",children:[R.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-800",children:[R.jsxs("div",{className:"flex items-center gap-3",children:[R.jsx("div",{className:"inline-flex items-center justify-center w-10 h-10 bg-gradient-to-br from-purple-600 to-indigo-600 rounded-xl shadow-sm",children:R.jsx(af,{className:"w-5 h-5 text-white"})}),!p&&R.jsxs("div",{children:[R.jsx("div",{className:"text-lg font-bold text-white",children:"MindEcho"}),R.jsx("div",{className:"text-xs text-gray-400",children:"Wellbeing companion"})]})]}),R.jsx("button",{"aria-label":p?"Expand sidebar":"Collapse sidebar",onClick:()=>v(G=>!G),className:"p-2 rounded hover:bg-gray-800/40 focus:outline-none focus:ring-2 focus:ring-purple-600",title:p?"Expand":"Collapse",children:p?R.jsx(pfe,{className:"w-5 h-5 text-gray-300"}):R.jsx(hfe,{className:"w-5 h-5 text-gray-300"})})]}),R.jsx("nav",{className:"flex-1 overflow-auto py-3 px-2",children:R.jsx("ul",{className:"space-y-1",children:D.map(G=>{if(G.to.startsWith("/profile")&&!n?.profile)return null;const $=L(G.to),te=G.icon;return R.jsx("li",{className:"relative",children:R.jsx(Ht.div,{initial:"idle",whileHover:"hover",variants:W,onMouseEnter:()=>C(G.label),onMouseLeave:()=>C(null),children:R.jsxs(PO,{to:G.to,className:`group flex items-center gap-3 px-3 py-2 rounded-lg transition-colors text-sm ${$?"bg-gradient-to-r from-purple-700/20 to-indigo-700/10 text-white":"text-gray-300 hover:bg-gray-800/40 hover:text-white"} ${p?"justify-center":""}`,"aria-current":$?"page":void 0,onFocus:()=>C(G.label),onBlur:()=>C(null),children:[R.jsx("span",{className:`absolute left-0 top-1/2 -translate-y-1/2 h-8 w-1 rounded-r transition-all ${$?"bg-gradient-to-b from-purple-400 to-indigo-400 shadow-[0_0_12px] from-purple-400/40":"opacity-0"}`,"aria-hidden":!0}),R.jsx(te,{className:"w-5 h-5 z-10"}),!p&&R.jsx("span",{className:"truncate z-10",children:G.label}),p&&w===G.label&&R.jsx("div",{className:"absolute left-full ml-3 top-1/2 -translate-y-1/2",children:R.jsx(bye,{label:G.label})})]})})},G.to)})})}),R.jsxs("div",{className:"p-3 border-t border-gray-800",children:[R.jsxs("div",{className:`flex items-center gap-3 ${p?"justify-center":""}`,children:[R.jsx("img",{src:n?.profile?.avatarUrl||"https://placehold.co/40/444/CCC?text=?",alt:"avatar",className:"w-9 h-9 rounded-full border"}),!p&&R.jsxs("div",{className:"flex-1 min-w-0",children:[R.jsx("div",{className:"text-sm font-medium text-gray-100 truncate",children:n?.profile?.displayName||n?.name||"Guest"}),R.jsx("div",{className:"text-xs text-gray-400 truncate",children:n?.email||""})]}),R.jsx("button",{onClick:F,title:"Log out",className:"p-2 rounded hover:bg-red-600/10","aria-label":"Log out",children:R.jsx(wO,{className:"w-5 h-5 text-gray-300 hover:text-red-400"})})]}),R.jsx("div",{className:"mt-3",children:R.jsx(j.Suspense,{fallback:R.jsx("div",{className:"text-sm text-gray-400 p-2",children:"Loading call..."})})}),!p&&R.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[R.jsx("button",{onClick:()=>{s({title:"Profile",description:"Opening profile...",tone:"info"}),f(`/profile/${n?.profile?.id||""}`)},className:"p-2 rounded-md hover:bg-gray-800/30 focus:outline-none",title:"Profile",children:R.jsx(mz,{className:"w-4 h-4 text-gray-300"})}),R.jsx("button",{onClick:F,className:"p-2 rounded-md hover:bg-red-800/10 text-red-400",title:"Sign out",children:R.jsx(wO,{className:"w-4 h-4"})})]})]})]}),R.jsx(Yo,{children:b&&R.jsxs("div",{className:"lg:hidden",role:"dialog","aria-modal":"true","aria-label":"Main navigation",children:[R.jsx(Ht.div,{initial:{opacity:0},animate:{opacity:.6},exit:{opacity:0},className:"fixed inset-0 z-40 bg-black",onClick:()=>T(!1)}),R.jsxs(Ht.div,{ref:I,initial:{x:"-100%"},animate:{x:0},exit:{x:"-100%"},transition:{type:"spring",stiffness:220,damping:26},className:"fixed left-0 top-0 bottom-0 z-50 w-full sm:w-80 max-w-[420px] bg-gray-900 border-r border-gray-800 shadow-2xl focus:outline-none",tabIndex:-1,children:[R.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-800",children:[R.jsxs("div",{className:"flex items-center gap-3",children:[R.jsx("div",{className:"inline-flex items-center justify-center w-10 h-10 bg-gradient-to-br from-purple-600 to-indigo-600 rounded-xl",children:R.jsx(af,{className:"w-5 h-5 text-white"})}),R.jsx("div",{className:"text-lg font-bold text-white truncate",children:"MindEcho"})]}),R.jsx("div",{className:"flex items-center gap-2",children:R.jsx("button",{onClick:()=>T(!1),"aria-label":"Close menu",className:"p-2 rounded hover:bg-gray-800",children:R.jsx(rb,{className:"w-5 h-5 text-gray-300"})})})]}),R.jsxs("nav",{className:"p-4 overflow-auto h-[calc(100vh-200px)]",children:[R.jsx("ul",{className:"space-y-1",children:D.map(G=>{if(G.to.startsWith("/profile")&&!n?.profile)return null;const $=L(G.to),te=G.icon;return R.jsx("li",{children:R.jsxs(PO,{to:G.to,onClick:()=>T(!1),className:`flex items-center gap-3 px-3 py-2 rounded-md transition-colors ${$?"bg-purple-700/20 text-white":"text-gray-300 hover:bg-gray-800"}`,children:[R.jsx(te,{className:"w-5 h-5"}),R.jsx("span",{className:"truncate",children:G.label})]})},G.to)})}),R.jsxs("div",{className:"mt-6 border-t border-gray-800 pt-4",children:[R.jsxs("div",{className:"flex items-center gap-3 px-3",children:[R.jsx("img",{src:n?.profile?.avatarUrl||"https://placehold.co/40/444/CCC?text=?",alt:"avatar",className:"w-10 h-10 rounded-full"}),R.jsxs("div",{className:"min-w-0",children:[R.jsx("div",{className:"font-medium text-white truncate",children:n?.profile?.displayName||n?.name||"Guest"}),R.jsx("div",{className:"text-xs text-gray-400 truncate",children:n?.email||""})]})]}),R.jsx("div",{className:"mt-4 px-3 space-y-2",children:R.jsx("button",{onClick:F,className:"w-full px-3 py-2 rounded-md bg-red-600/20 text-red-400 hover:bg-red-600/30",children:R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsx(wO,{className:"w-4 h-4"})," Sign out"]})})})]})]})]})]})})]})}function Tye(n=""){return n?n.split(" ").map(i=>i?`${i[0].toUpperCase()}${i.slice(1)}`:"").join(" "):""}const wye=[{id:"ex-1",type:"Exercise",title:"4-4-4 Breathing",subtitle:"Short breathing exercise",url:"/exercises/breathing",tags:["breath","calm"]},{id:"ex-2",type:"Exercise",title:"Micro Focus Drill",subtitle:"30s focus training",url:"/exercises/focus-drill",tags:["focus","attention"]},{id:"sess-1",type:"Session",title:"Morning Reset",subtitle:"10-minute routine",url:"/sessions/morning-reset",tags:["morning","energy"]},{id:"tip-1",type:"Tip",title:"Hydration Tip",subtitle:"Drink water to improve focus",url:"/tips/hydration",tags:["health","focus"]},{id:"tip-2",type:"Tip",title:"Screen Breaks",subtitle:"Short breaks reduce strain",url:"/tips/screen-breaks",tags:["productivity","rest"]}];function eu(){const{user:n,logout:i}=ao(),{addToast:s}=Wq(),c=j.useCallback(()=>{try{window.dispatchEvent(new CustomEvent("mobile-sidebar-toggle",{detail:!0})),window.dispatchEvent(new CustomEvent("mobile-sidebar-open",{detail:!0})),typeof window.showMindEchoMobileMenu=="function"&&window.showMindEchoMobileMenu()}catch(Ae){console.error("[Header] failed to open mobile menu",Ae)}},[]),f=(Ae={})=>s({title:Ae.title||"Tip",description:Ae.description||"Quick actions are available in your profile menu.",tone:Ae.tone||"info",duration:Ae.duration??2500}),p=async()=>{try{await i(),s({title:"Signed out",description:"You have been logged out.",tone:"success"})}catch(Ae){s({title:"Logout failed",description:Ae?.message||"Try again",tone:"error"})}},[v,b]=j.useState(!1),T=j.useRef(null);j.useEffect(()=>{const Ae=Ee=>{T.current&&(T.current.contains(Ee.target)||b(!1))},ke=Ee=>{Ee.key==="Escape"&&b(!1)};return document.addEventListener("pointerdown",Ae),document.addEventListener("keydown",ke),()=>{document.removeEventListener("pointerdown",Ae),document.removeEventListener("keydown",ke)}},[]);const[w,C]=j.useState(""),[I,D]=j.useState([]),[L,F]=j.useState(!1),[W,G]=j.useState(-1),$=j.useRef(null),te=j.useRef(null),Z=j.useCallback(Ae=>{const ke=(Ae||"").trim().toLowerCase();if(!ke)return[];const Ee=ke.split(/\s+/).filter(Boolean);return wye.map(Le=>{let et=0;const rt=`${Le.title} ${Le.subtitle||""} ${Le.tags?.join(" ")||""}`.toLowerCase();for(const he of Ee)rt.includes(he)&&(et+=10);for(const he of Ee)Le.title.toLowerCase().startsWith(he)&&(et+=4);return{item:Le,score:et}}).filter(Le=>Le.score>0).sort((Le,et)=>et.score-Le.score).map(Le=>Le.item)},[]);j.useEffect(()=>{if(!w){D([]),F(!1),G(-1);return}const Ae=setTimeout(()=>{const ke=Z(w);D(ke),F(!0),G(ke.length?0:-1)},160);return()=>clearTimeout(Ae)},[w,Z]),j.useEffect(()=>{const Ae=ke=>{if(L)if(ke.key==="ArrowDown")ke.preventDefault(),G(Ee=>Math.min(I.length-1,Ee+1));else if(ke.key==="ArrowUp")ke.preventDefault(),G(Ee=>Math.max(0,Ee-1));else if(ke.key==="Enter"){if(W>=0&&I[W]){const Ee=I[W];window.location.href=Ee.url||"#",F(!1)}}else ke.key==="Escape"&&F(!1)};return window.addEventListener("keydown",Ae),()=>window.removeEventListener("keydown",Ae)},[L,I,W]),j.useEffect(()=>{const Ae=ke=>{te.current&&!te.current.contains(ke.target)&&!$.current?.contains(ke.target)&&F(!1)};return document.addEventListener("pointerdown",Ae),()=>document.removeEventListener("pointerdown",Ae)},[]);const[ce,se]=j.useState(2),de=Tye(n?.profile?.displayName||n?.name||"Guest"),oe=n?.profile?.avatarUrl||"/default-avatar.png";j.useEffect(()=>{const Ae=ke=>{ke.key==="/"&&document.activeElement!==$.current&&(ke.preventDefault(),$.current?.focus())};return window.addEventListener("keydown",Ae),()=>window.removeEventListener("keydown",Ae)},[]);const ge=Ae=>{const ke=I[Ae];ke&&(window.location.href=ke.url,F(!1))};return R.jsxs("header",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3 p-4 md:p-6 mb-6   text-gray-200",children:[R.jsxs("div",{className:"flex items-center gap-4 min-w-0",children:[R.jsx("button",{onClick:c,className:"p-2 rounded-md hover:bg-gray-800 md:hidden focus:outline-none focus:ring-2 focus:ring-purple-600",children:R.jsx(tX,{className:"w-5 h-5 text-gray-200"})}),R.jsxs("div",{className:"min-w-0",children:[R.jsxs("h1",{className:"text-lg md:text-2xl font-semibold text-white truncate",children:["Hello, ",R.jsx("span",{className:"text-purple-400",children:de})," "]}),R.jsx("p",{className:"text-xs md:text-sm text-gray-400",children:"Your minds reflection  private & actionable."})]})]}),R.jsxs("div",{className:"flex-1 max-w-2xl w-full relative",children:[R.jsxs("div",{className:"hidden md:flex items-center bg-gray-800 border border-gray-700 rounded-full px-3 py-2",children:[R.jsx(RI,{className:"w-4 h-4 text-gray-400 mr-2"}),R.jsx("input",{ref:$,value:w,onChange:Ae=>C(Ae.target.value),placeholder:"Search exercises, sessions, tips... (/ to focus)",className:"flex-1 bg-transparent text-sm outline-none text-gray-200",onFocus:()=>I.length&&F(!0)}),R.jsx("button",{onClick:()=>{if(!w)return f({description:"Type something to search"});const Ae=Z(w);D(Ae),F(!0),G(Ae.length?0:-1)},className:"ml-3 px-3 py-1 rounded-full bg-purple-600 hover:bg-purple-500 text-white text-sm",children:"Search"})]}),R.jsx(Yo,{children:L&&R.jsx(Ht.ul,{ref:te,initial:{opacity:0,y:-6},animate:{opacity:1,y:0},exit:{opacity:0,y:-6},className:"absolute left-0 right-0 mt-2 z-50 max-h-72 overflow-auto bg-gray-900 border border-gray-800 rounded-xl shadow-xl",children:I.length===0?R.jsx("li",{className:"px-4 py-3 text-xs text-gray-400",children:"No results."}):I.map((Ae,ke)=>R.jsxs("li",{onClick:()=>ge(ke),onMouseEnter:()=>G(ke),className:`flex items-start gap-3 px-4 py-3 cursor-pointer hover:bg-gray-800 ${W===ke?"bg-gray-800":""}`,children:[R.jsx("div",{className:"w-9 h-9 bg-gray-700 rounded-md flex items-center justify-center text-xs font-semibold",children:Ae.type[0]}),R.jsxs("div",{className:"min-w-0",children:[R.jsx("div",{className:"text-sm text-gray-100",children:Ae.title}),R.jsx("div",{className:"text-xs text-gray-400",children:Ae.subtitle})]})]},Ae.id))})})]}),R.jsxs("div",{className:"flex items-center gap-3",children:[R.jsxs(Ht.button,{whileHover:{y:-2},whileTap:{scale:.96},onClick:()=>{window.location.href="http://127.0.0.1:5500/public/index.html"},className:`px-4 py-2 rounded-full bg-gradient-to-r from-purple-600 to-indigo-600 
                     hover:from-purple-500 hover:to-indigo-500 text-white text-sm font-medium
                     shadow-md hover:shadow-lg focus:outline-none focus:ring-2 
                     focus:ring-purple-600 flex items-center gap-2`,children:[R.jsx(nX,{className:"w-4 h-4"}),"Talk to AI"]}),R.jsxs(Ht.button,{whileTap:{scale:.96},onClick:()=>se(0),className:"p-2 rounded-full hover:bg-gray-800 relative",children:[R.jsx(nfe,{className:"w-5 h-5 text-gray-200"}),ce>0&&R.jsx("span",{className:"absolute -top-0.5 -right-0.5 bg-red-500 text-white text-xs px-1.5 rounded-full",children:ce})]}),R.jsx(Ht.button,{whileHover:{y:-2},onClick:()=>f({description:"Open settings from profile menu."}),className:"p-2 rounded-full hover:bg-gray-800",children:R.jsx(LO,{className:"w-5 h-5 text-gray-200"})}),R.jsx(Ht.button,{whileTap:{scale:.98},onClick:()=>f({title:"Theme",description:"Toggle theme (demo)."}),className:"p-2 rounded-full hover:bg-gray-800",children:R.jsx(_pe,{className:"w-5 h-5 text-gray-200"})}),R.jsxs("div",{className:"relative",ref:T,children:[R.jsxs(Ht.button,{onClick:()=>b(Ae=>!Ae),whileTap:{scale:.98},className:"flex items-center gap-3 px-3 py-1 rounded-full bg-gradient-to-r from-gray-800 to-gray-900 border border-gray-700 shadow-sm",children:[R.jsxs("div",{className:"relative",children:[R.jsx("img",{src:oe,className:"w-10 h-10 rounded-full border-2 border-gray-700"}),R.jsx("span",{className:"absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-emerald-400 rounded-full ring-2 ring-gray-900"})]}),R.jsxs("div",{className:"hidden md:flex flex-col",children:[R.jsx("span",{className:"text-sm text-gray-100 font-medium",children:de.split(" ")[0]}),R.jsx("span",{className:"text-xs text-gray-400",children:"Profile"})]}),R.jsx(ufe,{className:"w-4 h-4 text-gray-400"})]}),R.jsx(Yo,{children:v&&R.jsxs(Ht.ul,{initial:{opacity:0,y:-8},animate:{opacity:1,y:0},exit:{opacity:0,y:-6},className:"absolute right-0 mt-2 w-48 bg-gray-900 border border-gray-800 rounded-lg shadow-lg py-2",children:[R.jsx("li",{children:R.jsxs("button",{onClick:()=>window.location.href=`/profile/${n?.profile?.id||""}`,className:"w-full text-left px-4 py-2 text-sm hover:bg-gray-800 flex gap-2",children:[R.jsx(Ope,{className:"w-4 h-4 text-gray-400"})," Profile"]})}),R.jsx("li",{children:R.jsxs("button",{onClick:()=>window.location.href="/settings",className:"w-full text-left px-4 py-2 text-sm hover:bg-gray-800 flex gap-2",children:[R.jsx(LO,{className:"w-4 h-4 text-gray-400"})," Settings"]})}),R.jsx("li",{children:R.jsxs("button",{onClick:p,className:"w-full text-left px-4 py-2 text-sm hover:bg-gray-800 flex gap-2 text-red-400",children:[R.jsx(wO,{className:"w-4 h-4 text-red-500"})," Sign out"]})})]})})]})]})]})}const MK="http://localhost:4000",Rye=[n=>`${MK.replace(/\/$/,"")}/api/agora/token?channel=${encodeURIComponent(n)}`,n=>`${MK.replace(/\/$/,"")}/token?channel=${encodeURIComponent(n)}`,n=>`/api/agora/token?channel=${encodeURIComponent(n)}`,n=>`/token?channel=${encodeURIComponent(n)}`];function Cye(n){return n<=1?"grid-cols-1":n===2?"grid-cols-1 sm:grid-cols-2":n<=4?"grid-cols-2 sm:grid-cols-2 lg:grid-cols-4":n<=6?"grid-cols-2 sm:grid-cols-3 lg:grid-cols-3 xl:grid-cols-4":"grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5"}function VJ(){const[n,i]=j.useState(()=>`room-${new Date().toISOString().slice(11,19).replace(/:/g,"")}`),[s,c]=j.useState(!1),[f,p]=j.useState([]),[v,b]=j.useState(!0),[T,w]=j.useState(!0),[C,I]=j.useState(!1),[D,L]=j.useState(null),F=j.useRef(null),W=j.useRef(null),G=j.useRef(null),$=j.useRef(null),te=(be,Le)=>{try{const et=document.getElementById(Le);if(!et)return;et.innerHTML="",be.play(et)}catch(et){console.warn("attach play failed",et)}},Z=async be=>{let Le=null;for(const et of Rye){const rt=et(be);try{const _e=await(await fetch(rt,{credentials:"include"})).text();if(!_e){Le=new Error(`Empty token response from ${rt}`);continue}if(_e.trim().startsWith("<")){Le=new Error(`Token endpoint returned HTML (not JSON). Preview: ${_e.slice(0,200)}`);continue}const ze=JSON.parse(_e);if(!ze||!ze.token&&!ze.appId){Le=new Error(`Token endpoint JSON invalid at ${rt}  got ${JSON.stringify(ze).slice(0,200)}`);continue}return ze}catch(he){Le=he}}throw Le||new Error("No token endpoint succeeded")},ce=async()=>{if(s)return;let be=null;try{const Le=await Z(n),et=Le.appId||Le.appID||Le.appid||Le.app_id||Le.appId,rt=Le.token;if(!et||!rt)throw new Error("Token response missing appId or token");be=eO.createClient({mode:"rtc",codec:"vp8"}),F.current=be,be.on("user-published",async(tt,ut)=>{try{await be.subscribe(tt,ut);const me=String(tt.uid);p(Ve=>Ve.some(dt=>dt.uid===me)?Ve.map(dt=>dt.uid===me?{...dt,[ut==="video"?"hasVideo":"hasAudio"]:!0}:dt):[{uid:me,local:!1,hasVideo:ut==="video",hasAudio:ut==="audio"},...Ve]),ut==="video"&&tt.videoTrack&&setTimeout(()=>te(tt.videoTrack,`player-${me}`),60),ut==="audio"&&tt.audioTrack&&tt.audioTrack.play()}catch(me){console.warn("subscribe error",me)}}),be.on("user-unpublished",(tt,ut)=>{const me=String(tt.uid);p(Ve=>Ve.map(it=>it.uid===me?{...it,[ut==="video"?"hasVideo":"hasAudio"]:!1}:it)),setTimeout(()=>{p(Ve=>Ve.filter(it=>it.uid!==me||it.hasVideo||it.hasAudio||it.local))},600)}),be.on("user-left",tt=>{const ut=String(tt.uid);p(me=>me.filter(Ve=>Ve.uid!==ut)),D===ut&&L(null)}),await be.join(et,n,rt,void 0);const[he,_e]=await Promise.all([eO.createMicrophoneAudioTrack(),eO.createCameraVideoTrack({encoderConfig:"480p"})]);W.current=he,G.current=_e,await be.publish([he,_e]);const ze=String(be.uid||"local");p(tt=>[{uid:ze,local:!0,hasVideo:!0,hasAudio:!0},...tt]),setTimeout(()=>te(_e,`player-${ze}`),80),c(!0)}catch(Le){console.error("Join failed",Le),alert("Join failed: "+(Le.message||Le));try{F.current&&F.current.leave()}catch{}}},se=async()=>{try{if(!F.current)return;const be=F.current;try{W.current?.close?.()}catch{}try{G.current?.close?.()}catch{}try{$.current?.close?.()}catch{}await be.leave()}catch(be){console.warn("leave error",be)}finally{F.current=null,W.current=null,G.current=null,$.current=null,p([]),c(!1),b(!0),w(!0),I(!1),L(null)}},de=async()=>{try{if(!W.current)return;const be=!v;await W.current.setEnabled(be),b(be)}catch(be){console.warn("toggleAudio",be)}},oe=async()=>{try{if(!G.current)return;const be=!T;await G.current.setEnabled(be),w(be)}catch(be){console.warn("toggleVideo",be)}},ge=async()=>{if(F.current)try{if(C){await F.current.unpublish([$.current]),$.current&&$.current.close(),$.current=null,await F.current.publish([G.current]);const be=String(F.current.uid||"local");setTimeout(()=>te(G.current,`player-${be}`),100),I(!1)}else{const be=await eO.createScreenVideoTrack({encoderConfig:"1080p"});$.current=be,await F.current.unpublish([G.current]),await F.current.publish([be]);const Le=String(F.current.uid||"local");setTimeout(()=>te(be,`player-${Le}`),100),I(!0)}}catch(be){console.warn("screen share error",be),alert("Screen share failed: "+(be&&be.message?be.message:be))}},Ae=be=>L(Le=>Le===be?null:be);j.useEffect(()=>()=>{try{se()}catch{}},[]);const ke=Cye(f.length||1),Ee=({p:be})=>{const Le=be.uid,et=D&&D!==Le;return R.jsxs("div",{className:`relative bg-black rounded-lg overflow-hidden shadow-lg ${et?"opacity-60":"opacity-100"} flex items-center justify-center`,children:[R.jsx("div",{id:`player-${Le}`,className:"absolute inset-0 w-full h-full"}),R.jsxs("div",{className:"absolute left-2 top-2 bg-black/40 px-2 py-1 rounded text-xs flex items-center gap-2",children:[be.local?R.jsx("span",{className:"text-emerald-300",children:"You"}):R.jsxs("span",{children:["UID ",Le]}),be.hasAudio?R.jsx("span",{className:"ml-1 text-xs text-emerald-300",children:""}):R.jsx("span",{className:"ml-1 text-xs text-red-400",children:""})]}),R.jsxs("div",{className:"absolute left-2 right-2 bottom-2 flex items-center justify-between text-xs",children:[R.jsx("div",{className:"bg-black/40 rounded-md px-2 py-1",children:be.hasVideo?"Video":"No Video"}),R.jsx("div",{className:"flex items-center gap-2",children:R.jsx("button",{onClick:()=>Ae(Le),title:"Pin",className:"p-1 rounded bg-black/40",children:R.jsx(vz,{className:"w-3 h-3"})})})]})]},Le)};return R.jsxs("div",{className:"flex min-h-screen bg-gradient-to-b from-gray-900 to-black text-gray-100",children:[R.jsx(Ql,{}),R.jsxs("main",{className:"flex-1 p-4 md:p-8 overflow-y-auto",children:[R.jsx(eu,{}),R.jsxs("div",{className:"max-w-7xl mx-auto",children:[R.jsxs("div",{className:"mb-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[R.jsxs("div",{children:[R.jsx("h2",{className:"text-2xl font-semibold",children:"Video Room"}),R.jsx("p",{className:"text-sm text-gray-400",children:"Secure video rooms via Agora."})]}),R.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[R.jsx("input",{"aria-label":"Channel name",value:n,onChange:be=>i(be.target.value),className:"px-3 py-2 rounded-md text-white bg-white/5 placeholder-gray-400"}),s?R.jsx("button",{onClick:se,className:"px-4 py-2 bg-red-600 rounded-md text-white shadow",children:"Leave"}):R.jsx("button",{onClick:ce,className:"px-4 py-2 bg-indigo-600 rounded-md text-white shadow",children:"Join"}),R.jsxs("div",{className:"flex items-center gap-2 ml-2",children:[R.jsx("button",{onClick:de,className:"inline-flex items-center gap-2 px-3 py-2 rounded-md bg-white/5",children:v?R.jsxs(R.Fragment,{children:[R.jsx(zfe,{className:"w-4 h-4"}),"Mute"]}):R.jsxs(R.Fragment,{children:[R.jsx(Hfe,{className:"w-4 h-4"}),"Unmute"]})}),R.jsx("button",{onClick:oe,className:"inline-flex items-center gap-2 px-3 py-2 rounded-md bg-white/5",children:T?R.jsxs(R.Fragment,{children:[R.jsx(iX,{className:"w-4 h-4"}),"Stop"]}):R.jsxs(R.Fragment,{children:[R.jsx(xpe,{className:"w-4 h-4"}),"Start"]})}),R.jsxs("button",{onClick:ge,className:`inline-flex items-center gap-2 px-3 py-2 rounded-md ${C?"bg-yellow-600 text-black":"bg-white/5"}`,children:[R.jsx(ipe,{className:"w-4 h-4"}),C?"Sharing":"Share"]})]})]})]}),R.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4",children:[R.jsxs("div",{className:"lg:col-span-3 space-y-3",children:[R.jsx("div",{className:"rounded-2xl bg-gradient-to-b from-gray-800 to-gray-900 p-3 border border-gray-800",children:D?R.jsx("div",{className:"w-full aspect-video rounded-lg overflow-hidden",children:R.jsx("div",{id:`player-${D}`,className:"w-full h-full"})}):R.jsxs("div",{className:`grid ${ke} gap-3`,children:[f.map(be=>R.jsx("div",{className:"aspect-video rounded-lg overflow-hidden",children:R.jsx(Ee,{p:be})},be.uid)),f.length===0&&R.jsx("div",{className:"text-center text-sm text-gray-400 p-10",children:"No participants. Join the room to start camera & mic."})]})}),R.jsxs("div",{className:"flex items-center justify-between gap-3",children:[R.jsxs("div",{className:"text-sm text-gray-400",children:["Channel: ",R.jsx("span",{className:"text-gray-100 font-medium",children:n})]}),R.jsxs("div",{className:"text-sm text-gray-400",children:["Participants: ",R.jsx("span",{className:"text-gray-100 font-medium",children:f.length})]})]})]}),R.jsxs("aside",{className:"lg:col-span-1",children:[R.jsxs("div",{className:"rounded-2xl p-3 space-y-3",children:[R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsx("div",{className:"text-sm font-semibold",children:"Participants"}),R.jsx("div",{className:"text-xs text-gray-400",children:f.length})]}),R.jsxs("div",{className:"max-h-64 overflow-auto space-y-2",children:[f.map(be=>R.jsxs("div",{className:"flex items-center justify-between bg-black/30 px-2 py-2 rounded-md",children:[R.jsxs("div",{className:"truncate text-sm",children:[R.jsx("div",{className:"font-medium",children:be.local?"You":`UID ${be.uid}`}),R.jsxs("div",{className:"text-xs text-gray-400",children:[be.hasVideo?"Video":"No Video","  ",be.hasAudio?"Audio":"No Audio"]})]}),R.jsx("div",{className:"flex items-center gap-2",children:R.jsx("button",{onClick:()=>Ae(be.uid),className:"p-1 rounded bg-white/5",children:R.jsx(vz,{className:"w-4 h-4"})})})]},be.uid)),f.length===0&&R.jsx("div",{className:"text-sm text-gray-500",children:"No participants yet."})]}),R.jsx("div",{className:"pt-2",children:R.jsx("button",{onClick:()=>{navigator.clipboard?.writeText(window.location.href),alert("Room link copied")},className:"w-full px-3 py-2 rounded-md bg-indigo-600 text-black font-semibold",children:"Copy Link"})})]}),R.jsxs("div",{className:"mt-3 rounded-2xl p-3",children:[R.jsx("div",{className:"text-sm font-semibold mb-2",children:"Room Controls"}),R.jsx("div",{className:"flex gap-2",children:R.jsx("button",{onClick:()=>p([]),className:"flex-1 px-3 py-2 bg-white/5 rounded-md",children:"Clear"})})]})]})]})]})]})]})}const OPe=Object.freeze(Object.defineProperty({__proto__:null,default:VJ},Symbol.toStringTag,{value:"Module"}));function Aye(){const n=lf();return R.jsxs("div",{className:"min-h-screen flex flex-col",children:[R.jsxs("nav",{className:"flex justify-between items-center p-6",children:[R.jsxs("div",{className:"flex items-center",children:[R.jsx("div",{className:"inline-flex items-center justify-center w-10 h-10 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-lg mr-3",children:R.jsx(af,{className:"w-6 h-6 text-white"})}),R.jsx("span",{className:"text-2xl font-bold text-gray-800",children:"MindEcho"})]}),R.jsxs("div",{children:[R.jsx("button",{onClick:()=>n("/login"),className:"text-gray-600 font-medium mr-4",children:"Login"}),R.jsx("button",{onClick:()=>n("/signup"),className:"bg-purple-600 text-white font-semibold py-2 px-5 rounded-lg hover:bg-purple-700",children:"Sign Up"})]})]}),R.jsxs("main",{className:"flex-1 flex flex-col items-center justify-center text-center p-6 bg-gradient-to-br from-purple-50 to-blue-50",children:[R.jsx("div",{className:"inline-flex items-center justify-center w-24 h-24 bg-white rounded-full shadow-lg mb-8",children:R.jsx(Zq,{className:"w-12 h-12 text-purple-500"})}),R.jsxs("h1",{className:"text-5xl font-bold text-gray-800 mb-4",children:["Meet your responsive",R.jsx("br",{}),R.jsx("span",{className:"text-purple-600",children:"Emotional Mirror"})]}),R.jsx("p",{className:"text-xl text-gray-600 max-w-2xl mb-8",children:"MindEcho reads your body's real-time signals to provide adaptive feedback, helping you regulate and retrain your emotional reflexes."}),R.jsxs("div",{className:"space-x-3",children:[R.jsx("button",{onClick:()=>n("/signup"),className:"bg-purple-600 text-white font-semibold py-3 px-8 rounded-lg shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-300",children:"Begin Your Journey"}),R.jsx("button",{onClick:()=>n("/login"),className:"bg-white text-gray-800 font-semibold py-3 px-6 rounded-lg shadow-md hover:shadow-lg",children:"I already have an account"})]})]})]})}function Oye(){const n=lf(),{login:i}=ao(),[s,c]=j.useState(""),[f,p]=j.useState("password"),[v,b]=j.useState(!1),[T,w]=j.useState(!0),[C,I]=j.useState(""),[D,L]=j.useState({}),[F,W]=j.useState(!1),G=j.useRef(null);j.useEffect(()=>{G.current?.focus()},[]);const $=()=>{const Z={};return(!s||!/^\S+@\S+\.\S+$/.test(s.trim()))&&(Z.email="Please enter a valid email address"),(!f||f.length<6)&&(Z.password="Password must be at least 6 characters"),L(Z),Object.keys(Z).length===0},te=async Z=>{if(Z.preventDefault(),I(""),!!$()){W(!0);try{await i(s.trim(),f,{remember:T}),n("/dashboard")}catch(ce){const se=ce?.message||ce?.toString()||"Login failed";se.toLowerCase().includes("invalid")||se.toLowerCase().includes("credentials")?I("Invalid email or password."):se.toLowerCase().includes("network")?I("Network error  check your connection."):I(se)}finally{W(!1)}}};return R.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-purple-50 to-blue-50 p-6",children:R.jsxs("div",{className:"w-full max-w-md",children:[R.jsxs("div",{className:"flex justify-center items-center mb-6",children:[R.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 bg-white rounded-lg shadow-md mr-3",children:R.jsx(af,{className:"w-6 h-6 text-purple-500"})}),R.jsx("span",{className:"text-2xl font-bold text-gray-800",children:"MindEcho"})]}),R.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[R.jsx("h2",{className:"text-2xl font-semibold text-center mb-6",children:"Welcome Back"}),C&&R.jsx("div",{role:"alert",className:"text-red-600 text-sm text-center mb-4",children:C}),R.jsxs("form",{onSubmit:te,noValidate:!0,children:[R.jsxs("div",{className:"mb-4",children:[R.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),R.jsx("input",{id:"email",ref:G,type:"email",value:s,onChange:Z=>c(Z.target.value),autoComplete:"email","aria-invalid":!!D.email,"aria-describedby":D.email?"email-error":void 0,className:`w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 ${D.email?"border-red-300":"border-gray-300"}`,required:!0}),D.email&&R.jsx("p",{id:"email-error",className:"text-xs text-red-500 mt-1",children:D.email})]}),R.jsxs("div",{className:"mb-4",children:[R.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),R.jsxs("div",{className:"relative",children:[R.jsx("input",{id:"password",type:v?"text":"password",value:f,onChange:Z=>p(Z.target.value),autoComplete:"current-password","aria-invalid":!!D.password,"aria-describedby":D.password?"password-error":void 0,className:`w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 ${D.password?"border-red-300":"border-gray-300"}`,required:!0}),R.jsx("button",{type:"button","aria-label":v?"Hide password":"Show password",onClick:()=>b(Z=>!Z),className:"absolute right-2 top-1/2 -translate-y-1/2 p-1 rounded text-gray-500 hover:bg-gray-100",children:v?R.jsx(wfe,{className:"w-5 h-5"}):R.jsx(Qq,{className:"w-5 h-5"})})]}),D.password&&R.jsx("p",{id:"password-error",className:"text-xs text-red-500 mt-1",children:D.password})]}),R.jsxs("div",{className:"flex items-center justify-between mb-6",children:[R.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[R.jsx("input",{type:"checkbox",checked:T,onChange:Z=>w(Z.target.checked),className:"w-4 h-4"}),R.jsx("span",{className:"text-gray-600",children:"Remember me"})]}),R.jsx("button",{type:"button",onClick:()=>n("/forgot-password"),className:"text-sm text-purple-600 hover:underline",children:"Forgot password?"})]}),R.jsx("button",{type:"submit",disabled:F,className:"w-full bg-purple-600 text-white font-semibold py-3 px-6 rounded-lg shadow-lg hover:bg-purple-700 transition-colors duration-300 disabled:opacity-60 disabled:cursor-not-allowed flex items-center justify-center",children:F?R.jsxs("svg",{className:"w-5 h-5 animate-spin text-white",viewBox:"0 0 24 24",fill:"none",children:[R.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",strokeOpacity:"0.25"}),R.jsx("path",{d:"M4 12a8 8 0 018-8",stroke:"currentColor",strokeWidth:"4",strokeLinecap:"round"})]}):"Login"})]}),R.jsxs("p",{className:"text-sm text-center text-gray-600 mt-6",children:["Don't have an account?"," ",R.jsx("button",{onClick:()=>n("/signup"),className:"font-medium text-purple-600 hover:underline",children:"Sign Up"})]})]})]})})}function Iye(n){return/^\S+@\S+\.\S+$/.test(n)}function Nye(){const n=lf(),{updateUser:i}=ao(),[s,c]=j.useState(1),[f,p]=j.useState({name:"",email:"",password:"",displayName:"",bio:"",location:"",avatarUrl:"",tags:[],baselineMetrics:{calm:.5,anxiety:.5,focus:.5},consent:{neurofeedback:!0,camera:!0,audio:!0}}),[v,b]=j.useState(""),T=j.useRef(null),[w,C]=j.useState({}),[I,D]=j.useState(!1),[L,F]=j.useState(""),W=(oe,ge)=>{p(Ae=>{const ke={...Ae};if(oe.includes(".")){const[Ee,be]=oe.split(".");ke[Ee]={...ke[Ee],[be]:ge}}else ke[oe]=ge;return ke})},G=(oe=s)=>{const ge={};if(oe===1)f.name.trim()||(ge.name="Full name is required"),Iye(f.email)||(ge.email="Valid email is required"),(!f.password||f.password.length<6)&&(ge.password="Password (min 6 chars) is required");else if(oe===2)f.displayName.trim()||(ge.displayName="Display name is required"),(f.bio===void 0||f.bio.trim()==="")&&(ge.bio="A short bio is required"),f.location.trim()||(ge.location="Location is required"),Array.isArray(f.tags)||(ge.tags="Tags must be an array");else if(oe===3){const{calm:Ae,anxiety:ke,focus:Ee}=f.baselineMetrics||{};(typeof Ae!="number"||Ae<0||Ae>1)&&(ge.baselineMetrics="Calm must be between 0 and 1"),(typeof ke!="number"||ke<0||ke>1)&&(ge.baselineMetrics="Anxiety must be between 0 and 1"),(typeof Ee!="number"||Ee<0||Ee>1)&&(ge.baselineMetrics="Focus must be between 0 and 1");const{neurofeedback:be,camera:Le,audio:et}=f.consent||{};(typeof be!="boolean"||typeof Le!="boolean"||typeof et!="boolean")&&(ge.consent="Consent toggles are required")}return C(ge),Object.keys(ge).length===0},$=()=>{G(s)&&c(oe=>Math.min(3,oe+1))},te=()=>{C({}),c(oe=>Math.max(1,oe-1))},Z=oe=>{const ge=oe.trim();ge&&(f.tags.includes(ge)||W("tags",[...f.tags,ge]),b(""),T.current?.focus())},ce=oe=>{W("tags",f.tags.filter(ge=>ge!==oe))},se=oe=>{oe.key==="Enter"||oe.key===","?(oe.preventDefault(),Z(v)):oe.key==="Backspace"&&v===""&&W("tags",f.tags.slice(0,-1))},de=async oe=>{oe.preventDefault(),F("");const ge=G(1),Ae=G(2),ke=G(3);if(!ge||!Ae||!ke){c(ge?Ae?3:2:1);return}D(!0);try{const Ee={name:f.name.trim(),email:f.email.trim().toLowerCase(),password:f.password,displayName:f.displayName.trim(),bio:f.bio,location:f.location.trim(),tags:f.tags,baselineMetrics:{calm:Number(f.baselineMetrics.calm),anxiety:Number(f.baselineMetrics.anxiety),focus:Number(f.baselineMetrics.focus)},consent:{neurofeedback:!!f.consent.neurofeedback,camera:!!f.consent.camera,audio:!!f.consent.audio},avatarUrl:f.avatarUrl?f.avatarUrl.trim():void 0},be=await sm.post("/auth/register",Ee,{auth:!1});if(!be)throw new Error("Empty response from server");if(be.token?nf(be.token):console.warn("No token returned from register response"),i&&be.user)try{i(be.user)}catch{}n("/dashboard")}catch(Ee){console.error("Registration error",Ee),F(Ee?.message||"Registration failed. Try again.")}finally{D(!1)}};return R.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-50 to-blue-50 p-6",children:R.jsx("div",{className:"w-full max-w-3xl bg-white rounded-2xl shadow-xl overflow-hidden",children:R.jsxs("div",{className:"md:flex",children:[R.jsxs("div",{className:"hidden md:block md:w-1/3 bg-purple-600 text-white p-8",children:[R.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[R.jsx("div",{className:"w-10 h-10 rounded-lg bg-white/20 flex items-center justify-center font-semibold",children:"ME"}),R.jsxs("div",{children:[R.jsx("h3",{className:"text-lg font-semibold",children:"MindEcho"}),R.jsx("p",{className:"text-xs opacity-80",children:"Emotional mirror & adaptive guidance"})]})]}),R.jsx("p",{className:"text-sm leading-relaxed",children:"Create your account and provide a few details so MindEcho can personalize feedback and training."})]}),R.jsxs("form",{className:"w-full md:w-2/3 p-6 md:p-8",onSubmit:de,noValidate:!0,children:[R.jsx("h2",{className:"text-2xl font-bold mb-1",children:"Create your account"}),R.jsx("p",{className:"text-sm text-gray-500 mb-6",children:"All fields are required to complete signup."}),R.jsx("div",{className:"flex items-center gap-2 mb-6",children:[1,2,3].map(oe=>R.jsxs("div",{className:`flex-1 text-center py-1 rounded-md ${s===oe?"bg-purple-50 text-purple-700 font-semibold":"bg-gray-100 text-gray-500"}`,children:["Step ",oe]},oe))}),s===1&&R.jsxs("div",{className:"space-y-4",children:[R.jsxs("label",{className:"block",children:[R.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Full name"}),R.jsx("input",{value:f.name,onChange:oe=>W("name",oe.target.value),className:"mt-1 w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-400"}),w.name&&R.jsx("div",{className:"text-xs text-red-500 mt-1",children:w.name})]}),R.jsxs("label",{className:"block",children:[R.jsx("div",{className:"flex justify-between items-center",children:R.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Email"})}),R.jsx("input",{value:f.email,onChange:oe=>W("email",oe.target.value),type:"email",className:"mt-1 w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-400"}),w.email&&R.jsx("div",{className:"text-xs text-red-500 mt-1",children:w.email})]}),R.jsxs("label",{className:"block",children:[R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Password"}),R.jsx("div",{className:"text-xs text-gray-400",children:"min 6 characters"})]}),R.jsxs("div",{className:"mt-1 relative",children:[R.jsx("input",{value:f.password,onChange:oe=>W("password",oe.target.value),type:"password",className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-400"}),R.jsx("div",{className:"absolute right-3 top-3 text-gray-400",children:R.jsx(Mfe,{className:"w-4 h-4"})})]}),w.password&&R.jsx("div",{className:"text-xs text-red-500 mt-1",children:w.password})]})]}),s===2&&R.jsxs("div",{className:"space-y-4",children:[R.jsxs("label",{className:"block",children:[R.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Display name"}),R.jsx("input",{value:f.displayName,onChange:oe=>W("displayName",oe.target.value),className:"mt-1 w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-400"}),w.displayName&&R.jsx("div",{className:"text-xs text-red-500 mt-1",children:w.displayName})]}),R.jsxs("label",{className:"block",children:[R.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Short bio"}),R.jsx("textarea",{value:f.bio,onChange:oe=>W("bio",oe.target.value),rows:3,className:"mt-1 w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-400"}),w.bio&&R.jsx("div",{className:"text-xs text-red-500 mt-1",children:w.bio})]}),R.jsxs("label",{className:"block",children:[R.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Location"}),R.jsx("input",{value:f.location,onChange:oe=>W("location",oe.target.value),className:"mt-1 w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-400"}),w.location&&R.jsx("div",{className:"text-xs text-red-500 mt-1",children:w.location})]}),R.jsxs("label",{className:"block",children:[R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Avatar URL (optional)"}),R.jsx("div",{className:"text-xs text-gray-400",children:"image link"})]}),R.jsx("input",{value:f.avatarUrl,onChange:oe=>W("avatarUrl",oe.target.value),className:"mt-1 w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-400"})]}),R.jsxs("label",{className:"block",children:[R.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Tags (press Enter or comma to add)"}),R.jsxs("div",{className:"flex flex-wrap gap-2",children:[f.tags.map(oe=>R.jsxs("div",{className:"flex items-center bg-purple-50 text-purple-700 px-3 py-1 rounded-full text-sm",children:[R.jsx("span",{className:"mr-2",children:oe}),R.jsx("button",{type:"button",onClick:()=>ce(oe),className:"p-1 rounded hover:bg-purple-100",children:R.jsx(dM,{className:"w-3 h-3"})})]},oe)),R.jsx("input",{ref:T,value:v,onChange:oe=>b(oe.target.value),onKeyDown:se,onBlur:()=>Z(v),placeholder:"Add a tag...",className:"px-3 py-1 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-400",style:{minWidth:140}})]}),w.tags&&R.jsx("div",{className:"text-xs text-red-500 mt-1",children:w.tags})]})]}),s===3&&R.jsxs("div",{className:"space-y-4",children:[R.jsxs("div",{children:[R.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Baseline metrics (0.0  1.0)"}),R.jsx("div",{className:"space-y-3",children:["calm","anxiety","focus"].map(oe=>R.jsxs("div",{className:"flex items-center gap-4",children:[R.jsx("div",{className:"w-28 text-sm capitalize",children:oe}),R.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:f.baselineMetrics[oe],onChange:ge=>W(`baselineMetrics.${oe}`,parseFloat(ge.target.value)),className:"flex-1"}),R.jsx("div",{className:"w-12 text-right text-sm font-medium",children:Number(f.baselineMetrics[oe]).toFixed(2)})]},oe))}),w.baselineMetrics&&R.jsx("div",{className:"text-xs text-red-500 mt-1",children:w.baselineMetrics})]}),R.jsxs("div",{children:[R.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Sensor consent"}),R.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[R.jsxs("label",{className:"flex items-center p-3 border rounded-lg",children:[R.jsx("input",{type:"checkbox",checked:f.consent.neurofeedback,onChange:oe=>W("consent.neurofeedback",oe.target.checked)}),R.jsxs("div",{className:"ml-3",children:[R.jsx("div",{className:"text-sm font-semibold",children:"Neurofeedback"}),R.jsx("div",{className:"text-xs text-gray-500",children:"EEG-derived focus/calm"})]})]}),R.jsxs("label",{className:"flex items-center p-3 border rounded-lg",children:[R.jsx("input",{type:"checkbox",checked:f.consent.camera,onChange:oe=>W("consent.camera",oe.target.checked)}),R.jsxs("div",{className:"ml-3",children:[R.jsx("div",{className:"text-sm font-semibold",children:"Micro-emotion (camera)"}),R.jsx("div",{className:"text-xs text-gray-500",children:"Facial micro-expression"})]})]}),R.jsxs("label",{className:"flex items-center p-3 border rounded-lg",children:[R.jsx("input",{type:"checkbox",checked:f.consent.audio,onChange:oe=>W("consent.audio",oe.target.checked)}),R.jsxs("div",{className:"ml-3",children:[R.jsx("div",{className:"text-sm font-semibold",children:"Acoustic sentiment"}),R.jsx("div",{className:"text-xs text-gray-500",children:"Voice pitch & variance"})]})]})]}),w.consent&&R.jsx("div",{className:"text-xs text-red-500 mt-1",children:w.consent})]})]}),L&&R.jsx("div",{className:"mt-4 text-sm text-red-600",children:L}),R.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[R.jsx("div",{children:s>1&&R.jsxs("button",{type:"button",onClick:te,className:"inline-flex items-center gap-2 px-4 py-2 rounded-md border text-sm",children:[R.jsx(Xq,{className:"w-4 h-4"})," Back"]})}),R.jsxs("div",{className:"flex items-center gap-3",children:[s<3&&R.jsxs("button",{type:"button",onClick:$,className:"inline-flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700",children:["Next ",R.jsx(Jq,{className:"w-4 h-4"})]}),s===3&&R.jsxs("button",{type:"submit",disabled:I,className:"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-500 to-indigo-600 text-white rounded-md hover:opacity-95",children:[I?"Creating...":"Create account",R.jsx(dM,{className:"w-4 h-4"})]})]})]})]})]})})})}const UK={anxious:{icon:Ife,color:"text-red-500",bg:"bg-red-50",label:"Anxious"},calm:{icon:hpe,color:"text-green-500",bg:"bg-green-50",label:"Calm"},focused:{icon:Zq,color:"text-blue-500",bg:"bg-blue-50",label:"Focused"},neutral:{icon:Vfe,color:"text-gray-500",bg:"bg-gray-50",label:"Neutral"}};function xye({emotion:n}){const{primary:i,scores:s}=n||{},c=UK[i]||UK.neutral,f=c.icon;return R.jsxs("div",{className:`py-2 px-4 rounded-2xl shadow-sm border ${c.bg} h-full flex flex-col justify-between`,children:[R.jsxs("div",{children:[R.jsxs("div",{className:"flex items-center mb-2",children:[R.jsx("h3",{className:"text-md font-bold text-gray-800",children:"Current Emotion:"}),R.jsxs("div",{className:`flex items-center font-semibold ${c.color}`,children:[R.jsx(f,{className:"w-5 h-5 mr-1.5"})," ",c.label]})]}),R.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Real-time inference from neuro, facial, and acoustic signals."})]}),R.jsxs("div",{className:"space-y-3 mb-2",children:[R.jsx(Pk,{label:"Anxiety",value:s?.anxiety||0}),R.jsx(Pk,{label:"Calm",value:s?.calm||0}),R.jsx(Pk,{label:"Focus",value:s?.focus||0})]})]})}function Pk({label:n,value:i}){const s=Math.round(i*100);return R.jsxs("div",{children:[R.jsxs("div",{className:"flex justify-between text-sm mb-1 font-medium text-gray-700",children:[R.jsx("span",{children:n}),R.jsxs("span",{children:[s,"%"]})]}),R.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5 overflow-hidden",children:R.jsx("div",{className:"h-2.5 rounded-full bg-gradient-to-r from-orange-400 to-purple-600 transition-all",style:{width:`${s}%`}})})]})}function jK({data:n=[],compact:i=!1}){const c=i?60:120,f=n.map(I=>I.value??0),p=Math.max(1,...f),v=Math.min(0,...f),b=Math.max(1e-6,p-v),T=f.map((I,D)=>{const L=D/Math.max(1,f.length-1)*400,F=c-(I-v)/b*c;return`${L},${F}`}).join(" "),w=f.length?`M0,${c} L${T} L400,${c} Z`:"",C=f.length?`M${T}`:"";return R.jsxs("svg",{viewBox:`0 0 400 ${c}`,width:"100%",height:c,className:"rounded",children:[R.jsx("defs",{children:R.jsxs("linearGradient",{id:"g",x1:"0",x2:"0",y1:"0",y2:"1",children:[R.jsx("stop",{offset:"0%",stopColor:"rgba(99,102,241,0.6)"}),R.jsx("stop",{offset:"100%",stopColor:"rgba(79,70,229,0.1)"})]})}),R.jsx("path",{d:w,fill:"url(#g)"}),R.jsx("path",{d:C,fill:"none",stroke:"rgba(99,102,241,0.9)",strokeWidth:"1.6",strokeLinejoin:"round",strokeLinecap:"round"})]})}function Dye({title:n,value:i,trend:s,note:c}){return R.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100 flex flex-col justify-between",children:[R.jsx("h4",{className:"text-gray-600 text-sm font-medium mb-2",children:n}),R.jsx("div",{className:"text-3xl font-bold text-gray-800 mb-2",children:i}),R.jsxs("p",{className:"text-sm text-gray-500",children:[s&&R.jsx("span",{className:"font-semibold text-green-500 mr-1",children:s}),c]})]})}let Pye=class{constructor(){this.callbacks={}}on(i,s){return this.callbacks[i]||(this.callbacks[i]=[]),this.callbacks[i].push(s),()=>this.callbacks[i]=this.callbacks[i].filter(c=>c!==s)}emit(i,s){(this.callbacks[i]||[]).forEach(c=>c(s))}};class kye extends Pye{constructor(){super(),this.interval=null,this.baseAnxiety=.5}start(i){this.interval&&this.stop(),this.interval=setInterval(()=>{this.baseAnxiety+=(Math.random()-.5)*.08,this.baseAnxiety=Math.max(0,Math.min(1,this.baseAnxiety));const s={};if(i.neurofeedback){const c=(1-this.baseAnxiety)*70+Math.random()*30,f=this.baseAnxiety*70+Math.random()*30;s.neuro={alpha:c.toFixed(2),beta:f.toFixed(2)}}if(i.camera){const c=(1-this.baseAnxiety)*.6+Math.random()*.4,f=this.baseAnxiety*.6+Math.random()*.4;s.emotion={smile:c.toFixed(3),frown:f.toFixed(3)}}if(i.audio){const c=100+this.baseAnxiety*100+(Math.random()-.5)*20,f=this.baseAnxiety*5+Math.random();s.acoustic={pitch:c.toFixed(2),variance:f.toFixed(2)}}this.emit("signals",s)},1500)}stop(){this.interval&&(clearInterval(this.interval),this.interval=null)}}const kk=new kye,yv={signalBuffer:[],inferEmotion:(n={},i={neurofeedback:!1,camera:!1,audio:!1})=>{try{yv.signalBuffer.push(n||{}),yv.signalBuffer.length>6&&yv.signalBuffer.shift();let s=0,c=0,f=0,p=0;if(yv.signalBuffer.forEach(I=>{if(I){if(i.neurofeedback&&I.neuro){const D=parseFloat(I.neuro.alpha)||0,L=parseFloat(I.neuro.beta)||0;s+=L,c+=D,f+=(D+L)/2,p++}if(i.camera&&I.emotion){const D=parseFloat(I.emotion.smile)||0,L=parseFloat(I.emotion.frown)||0;s+=L*100,c+=D*100,p++}if(i.audio&&I.acoustic){const D=parseFloat(I.acoustic.variance)||0;s+=D*10,c+=Math.max(0,10-D*10),p++}}}),p===0)return{primary:"neutral",scores:{anxiety:0,calm:0,focus:0}};const v=s/p/100,b=c/p/100,T=f/p/100;let w="neutral";v>.6&&v>b?w="anxious":b>.6&&b>v?w="calm":T>.6?w="focused":w="neutral";const C={anxiety:Math.max(0,Math.min(1,v*1.5)),calm:Math.max(0,Math.min(1,b*1.5)),focus:Math.max(0,Math.min(1,T*1.2))};return{primary:w,scores:C}}catch(s){return console.error("inferenceService.inferEmotion error:",s),{primary:"neutral",scores:{anxiety:0,calm:0,focus:0}}}},clearBuffer:()=>{yv.signalBuffer.length=0}},Er={users:[{id:"u1",email:"sarah@example.com",passwordHash:"hashed_password",name:"Sarah Connor",consent:{neurofeedback:!0,camera:!0,audio:!0}}],profiles:[{id:"p1",userId:"u1",displayName:"Sarah",bio:"Just trying to be more mindful.",location:"San Francisco, CA",avatarUrl:"https://placehold.co/100x100/A78BFA/FFFFFF?text=SC",tags:["Mindfulness","Music"],baselineMetrics:{calm:.6,anxiety:.3,focus:.7}}],sessions:[{id:"s1",userId:"u1",timestamp:new Date(Date.now()-864e5).toISOString(),type:"Breathing Exercise",duration:300,startEmotion:"anxious",endEmotion:"calm",summary:"Felt better after breathing."}]};function Lye(){const n={};return{on(i,s){return n[i]||(n[i]=[]),n[i].push(s),()=>{n[i]=n[i].filter(c=>c!==s)}},off(i,s){n[i]&&(n[i]=n[i].filter(c=>c!==s))},emit(i,s){n[i]&&n[i].forEach(c=>{try{c(s)}catch(f){console.error("mockApi emitter cb error",f)}})}}}const Lk=Lye(),Ov={login(n,i){return new Promise((s,c)=>{setTimeout(()=>{const f=Er.users.find(p=>p.email===n);if(f&&i==="password"){const p=Er.profiles.find(v=>v.userId===f.id);s({...f,profile:p})}else c(new Error('Invalid email or password. (Hint: use "password")'))},350)})},register(n,i,s,c={neurofeedback:!0,camera:!0,audio:!0}){return new Promise((f,p)=>{setTimeout(()=>{if(Er.users.find(w=>w.email===i))return p(new Error("Email already in use."));const v=`u${Er.users.length+1}`,b={id:v,email:i,passwordHash:"hashed_password",name:n,consent:c};Er.users.push(b);const T={id:`p${Er.profiles.length+1}`,userId:v,displayName:n.split(" ")[0],bio:"",location:"",avatarUrl:`https://placehold.co/100x100/A78BFA/FFFFFF?text=${n.charAt(0)}`,tags:[],baselineMetrics:{calm:.5,anxiety:.5,focus:.5}};Er.profiles.push(T),f({...b,profile:T})},450)})},logout(){return new Promise(n=>setTimeout(n,200))},getMe(n){return new Promise((i,s)=>{setTimeout(()=>{const c=Er.users.find(p=>p.id===n);if(!c)return s(new Error("User not found."));const f=Er.profiles.find(p=>p.userId===c.id);i({...c,profile:f})},200)})},getProfiles(){return new Promise(n=>setTimeout(()=>n(Er.profiles.slice()),250))},getProfile(n){return new Promise((i,s)=>{setTimeout(()=>{const c=Er.profiles.find(f=>f.id===n);if(!c)return s(new Error("Profile not found."));i(c)},250)})},updateProfile(n,i){return new Promise((s,c)=>{setTimeout(()=>{const f=Er.profiles.findIndex(p=>p.id===n);if(f===-1)return c(new Error("Profile not found."));Er.profiles[f]={...Er.profiles[f],...i},s(Er.profiles[f])},300)})},updateConsent(n,i){return new Promise((s,c)=>{setTimeout(()=>{const f=Er.users.find(p=>p.id===n);if(!f)return c(new Error("User not found."));f.consent={...f.consent,...i},s(f)},300)})},getHistory(n){return new Promise(i=>{setTimeout(()=>{i(Er.sessions.filter(s=>s.userId===n))},300)})},exportData(n){return new Promise(i=>{setTimeout(()=>{const s=Er.users.find(p=>p.id===n),c=Er.profiles.find(p=>p.userId===n),f=Er.sessions.filter(p=>p.userId===n);i({user:s,profile:c,sessions:f})},400)})},deleteData(n){return new Promise(i=>{setTimeout(()=>{Er.users=Er.users.filter(s=>s.id!==n),Er.profiles=Er.profiles.filter(s=>s.userId!==n),Er.sessions=Er.sessions.filter(s=>s.userId!==n),i({message:"User data deleted."})},500)})},on(n,i){return Lk.on(n,i)},off(n,i){return Lk.off(n,i)},pushLiveSignal(n){const s={timestamp:new Date().toISOString(),...n};return Lk.emit("signals",s),s},startAutoSignals(n=1500){this._autoInterval||(this._autoInterval=setInterval(()=>{const i=Math.random(),s=Math.round((1-i)*70+Math.random()*30),c=Math.round(i*70+Math.random()*30),f=Math.max(0,Math.min(1,(1-i)*.6+Math.random()*.4)),p=Math.max(0,Math.min(1,i*.6+Math.random()*.4)),v=(100+i*100+(Math.random()-.5)*20).toFixed(2),b=(i*5+Math.random()).toFixed(2);this.pushLiveSignal({neuro:{alpha:s.toString(),beta:c.toString()},emotion:{smile:f.toFixed(3),frown:p.toFixed(3),neutral:(Math.random()*.5).toFixed(3)},acoustic:{pitch:String(v),variance:String(b)}})},n))},stopAutoSignals(){this._autoInterval&&(clearInterval(this._autoInterval),this._autoInterval=null)}};function aO(n,i){Ov.pushLiveSignal(n,i)}function Mye({onSignal:n=()=>{},sampleIntervalMs:i=700,autoStart:s=!1}){const c=j.useRef(null),f=j.useRef(!1),p=j.useRef(null),[v,b]=j.useState(s),[T,w]=j.useState(!0),[C,I]=j.useState(null);return j.useEffect(()=>{let D=!0;return(async()=>{try{window.faceapi||await new Promise((F,W)=>{const G=document.createElement("script");G.src="https://unpkg.com/face-api.js@0.22.2/dist/face-api.min.js",G.crossOrigin="anonymous",G.onload=F,G.onerror=W,document.head.appendChild(G)});const L="/models";await Promise.all([window.faceapi.nets.tinyFaceDetector.loadFromUri(L),window.faceapi.nets.faceExpressionNet.loadFromUri(L),window.faceapi.nets.faceLandmark68Net.loadFromUri(L)]),D&&w(!1)}catch(L){console.error("model load err",L),D&&(I("Failed to load models. Place models in /public/models and ensure they are accessible."),w(!1))}})(),()=>{D=!1}},[]),j.useEffect(()=>{let D=!0;return v?((async()=>{try{const F=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:360,height:270},audio:!1});if(!D)return;c.current.srcObject=F,await c.current.play(),f.current=!0,p.current=setInterval(async()=>{if(f.current)try{const W=new window.faceapi.TinyFaceDetectorOptions({inputSize:224,scoreThreshold:.5}),G=await window.faceapi.detectSingleFace(c.current,W).withFaceExpressions().withFaceLandmarks();if(!G){n({timestamp:Date.now(),calm:.5,anxious:0,focus:.4,rawExpressions:null});return}const $=G.expressions||{},te=$.happy??0,Z=$.neutral??0,ce=$.sad??0,se=$.angry??0,de=$.fearful??0,oe=$.surprised??0,ge=Math.min(1,te*.7+Z*.6-de*.3),Ae=Math.min(1,de*.7+oe*.5+se*.4),ke=Math.min(1,Z*.6+(1-oe)*.3+te*.1),Ee=G.landmarks;let be=0;try{const _e=Ee.getMouth(),ze=_e[13],tt=_e[19];if(ze&&tt){const ut=Math.hypot(ze.x-tt.x,ze.y-tt.y),me=Ee.getNose()[3],Ve=Ee.getJawOutline()[8];if(me&&Ve){const it=Math.hypot(me.x-Ve.x,me.y-Ve.y)||1;be=Math.min(1,ut/it)}}}catch{}const Le=Math.max(0,ke-be*.6),et=Math.max(0,Math.min(1,ge)),rt=Math.max(0,Math.min(1,Ae)),he=Math.max(0,Math.min(1,Le));n({timestamp:Date.now(),calm:et,anxious:rt,focus:he,rawExpressions:$})}catch(W){console.warn("frame detect err",W)}},i)}catch(F){console.error("camera err",F),I("Unable to access camera. Check permissions.")}})(),()=>{D=!1,f.current=!1,clearInterval(p.current);const F=c.current?.srcObject;F&&F.getTracks&&F.getTracks().forEach(W=>W.stop())}):void 0},[v,i,n]),R.jsx("div",{className:"space-y-2",children:T?R.jsx("div",{className:"text-xs text-gray-400",children:"Loading models (place face-api models in /models)"}):R.jsx(R.Fragment,{children:v?R.jsxs("div",{children:[R.jsx("video",{ref:c,className:"rounded-md bg-black w-full",style:{width:320,height:240},muted:!0,playsInline:!0}),R.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Local detection  frames stay in your browser."}),C&&R.jsx("div",{className:"text-xs text-red-400",children:C})]}):R.jsxs("div",{className:"text-sm",children:[R.jsx("div",{className:"text-xs text-gray-400",children:"Run local camera-based emotion estimation (models loaded in browser). Consent to continue?"}),R.jsxs("div",{className:"mt-2 flex gap-2",children:[R.jsx("button",{onClick:()=>b(!0),className:"px-3 py-2 rounded bg-indigo-600 text-white",children:"Yes, start"}),R.jsx("button",{onClick:()=>b(!1),className:"px-3 py-2 rounded bg-gray-700 text-white",children:"No"})]})]})})})}const Uye=[{q:"How can I calm anxiety quickly?",a:"Try box breathing: inhale 4s, hold 4s, exhale 4s. Ground yourself by noticing 5 things you see.",tags:["anxiety","breathing","calm"]},{q:"How do I sleep better?",a:"Keep a consistent bedtime, avoid screens 60 minutes before bed, and try a short wind-down routine like reading.",tags:["sleep","rest","bedtime"]},{q:"I'm overwhelmed",a:"Break tasks into tiny steps and try a 2-minute breathing break. Reach out to a friend if you can.",tags:["overwhelm","coping","breakdown"]},{q:"Immediate help",a:"If you're in immediate danger, call your local emergency services. If thinking about self-harm, contact local crisis lines now.",tags:["crisis","help","emergency"]}];function fU(n=""){return(n||"").toLowerCase().replace(/[^\w\s]/g," ").replace(/\s+/g," ").trim()}function FO(n=""){return fU(n).split(" ").filter(Boolean)}function Rv(n){return n[Math.floor(Math.random()*n.length)]}function jye(n=""){const i=["suicide","kill myself","end my life","hurt myself","i want to die","self harm","self-harm","i'll kill myself"],s=fU(n);return i.some(c=>s.includes(c))}function kM(n=[],i=""){if(!n.length)return 0;const s=new Set(FO(i));let c=0;for(const f of n)s.has(f)&&c++;return c/n.length}const VK={try:["try","consider","you might try","experiment with"],help:["help","support","assist","be useful"],breathe:["breathe","take a breath","do breathing"],sleep:["sleep","rest","get rest"],calm:["calm","settle","soothe"],ground:["ground","anchor","bring attention to the present"],short:["short","brief","quick"]};function BJ(n){return n.replace(/\b(try|help|breathe|sleep|calm|ground|short)\b/gi,i=>{const s=i.toLowerCase();if(!VK[s])return i;const c=VK[s];return Rv(c)})}function Vye(n){const i=FO(n);let s=null,c=0;for(const f of Uye){const p=kM(i,f.q+" "+(f.tags||[]).join(" "));p>c&&(c=p,s=f)}return c>=.35?s:null}const eb={sleep:{tags:["sleep","insomnia","tired","rest","bedtime","nap"],openers:["Good place to start.","That makes sense.","Here's a suggestion.","A few simple habits can help."],cores:["Keep a consistent bedtime and wake time.","Avoid screens and bright lights for 60 minutes before bed.","Wind down with a low-stimulation routine (reading, warm shower, light stretching).","Limit caffeine late in the day and avoid heavy meals before sleep."],followups:["Do you have trouble falling asleep or staying asleep?","Roughly how many hours of sleep do you usually get?"],closers:["Small, consistent changes compound over time.","Start small  a 15 minute shift can make a difference."]},anxiety:{tags:["anxiety","panic","panic attack","anxious","worry","stress"],openers:["Im sorry youre feeling that.","I hear you  anxiety can be intense.","This is manageable with small steps."],cores:["Try grounding: name 5 things you see, 4 things you can touch, 3 things you hear.","Do slow breathing: inhale 4s  hold 4s  exhale 4s for several rounds.","Shift attention to the body: notice sensations without judgment."],followups:["Would you like me to guide a short breathing exercise now?","Is this a one-off spike or something ongoing?"],closers:["If it feels severe or persistent, consider reaching out to a professional."]},coping:{tags:["help","cope","support","overwhelmed","overwhelm","stressed"],openers:["A helpful trick:","One useful habit:","A small suggestion:"],cores:["Break tasks down into 2-minute steps and start with the smallest piece.","Use a timer: work for 10 minutes, then take a 3 minute break.","Try a short breathing break, then return to the task with a tiny next action."],followups:["Tell me one task youre facing and Ill help break it down."],closers:["You dont need to do everything at once."]},breathing:{tags:["breathe","breathing","box breathing","inhale","exhale","breath"],openers:["Lets breathe together.","A short guided breath:","Try this: "],cores:["Inhale for 4 seconds, hold for 4 seconds, exhale for 4 seconds  repeat 5 times.","Longer exhale helps the nervous system  make your exhale a little longer than the inhale.","Belly breathing (diaphragmatic) rather than shallow chest breathing is more calming."],followups:["Want a 30s guided loop now?"],closers:["I can count it out for you if you want."]},default:{tags:[],openers:["Okay.","Alright.","Thanks for sharing."],cores:["I can offer breathing exercises, sleep tips, grounding, and small practical steps.","Tell me a bit more about what's happening and Ill suggest a concrete next step.","Sometimes a short 2-minute practice reduces intensity; would you like one?"],followups:["Can you tell me more about what you mean?","Is this about sleep, anxiety, or something else?"],closers:["Im here to help however I can."]}};function BK(n,i={}){const s=eb[n]||eb.default,c=[];Math.random()>.15&&c.push(Rv(s.openers));const f=Math.random()>.6?2:1;for(let v=0;v<f;v++)c.push(Rv(s.cores));if(n==="sleep"&&i.sleepHours!=null){const v=Number(i.sleepHours);Number.isFinite(v)&&(v<5.5?c.push("Noting your sleep hours are low  small gradual changes (1530 minutes) can add up."):v<7?c.push("You're close to a healthy range  consistency is the next step."):c.push("Nice  your sleep looks decent. Keep the routine."))}if(i.recentUser&&Math.random()>.4){const v=i.recentUser.length>80?i.recentUser.slice(0,77)+"":i.recentUser;c.push(`(Thanks for sharing: "${v}")`)}Math.random()>.4&&s.followups&&s.followups.length&&c.push(Rv(s.followups)),Math.random()>.5&&c.push(Rv(s.closers||[]));let p=c.join(" ");return p=BJ(p),p=p.replace(/\s{2,}/g," ").trim(),p||(p="Im here to help  tell me more."),p}function Bye(n,i=null,s=[]){const c=String(n||"").trim();if(!c)return{type:"empty",reply:"Say anything you'd like  I can help with sleep tips, breathing, or coping strategies."};if(jye(c))return{type:"crisis",reply:"I'm really sorry you're feeling this way. If you're in immediate danger, call local emergency services now. If you have thoughts of harming yourself, contact your local crisis line immediately."};const f=Vye(c);if(f)return{type:"faq",reply:BJ(Rv([f.a,f.a+" Would you like more details or a short exercise?"]))};const p=FO(c),v={};for(const I of Object.keys(eb)){const D=eb[I],L=kM(p,(D.tags||[]).join(" ")+" "+(D.cores||[]).join(" ")),F=(D.tags||[]).reduce((W,G)=>W+(fU(c).includes(G)?.35:0),0);v[I]=L+F}if(s&&s.length){const I=s.slice(-6).map(L=>L.role==="user"?L.text:"").join(" "),D=FO(I);for(const L of Object.keys(v)){const F=kM(D,(eb[L].tags||[]).join(" "));v[L]+=F*.6}}let b="default",T=0;for(const[I,D]of Object.entries(v))D>T&&(b=I,T=D);if(T<.12)return{type:"clarify",reply:BK("default",{recentUser:s.slice().reverse().find(D=>D.role==="user")?.text||"",sleepHours:i})};const w=s.slice().reverse().find(I=>I.role==="user"&&I.text&&I.text.length>20)?.text||"",C=BK(b,{sleepHours:i,recentUser:w});return{type:b,reply:C}}function Fye({open:n=!1,onClose:i=()=>{},apiUrl:s=null,sleepHours:c=null}){const[f,p]=j.useState([{id:"sys",role:"system",text:"You are MindEcho  a supportive mental health assistant. Not a substitute for professional care."},{id:"intro",role:"assistant",text:"Hi  I'm MindEcho. I can offer breathing exercises, grounding, sleep tips, and supportive suggestions. How can I help?"}]),[v,b]=j.useState(""),[T,w]=j.useState(!1),C=j.useRef(null);j.useEffect(()=>{C.current&&(C.current.scrollTop=C.current.scrollHeight)},[f,n]);async function I(){const L=(v||"").trim();if(!L)return;const F={id:`u-${Date.now()}`,role:"user",text:L};p(W=>[...W,F]),b(""),w(!0);try{if(s){const W=[...f,F].map(Z=>({role:Z.role,content:Z.text})),G=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:W})});if(!G.ok){const Z=await G.text();throw p(ce=>[...ce,{id:`err-${Date.now()}`,role:"assistant",text:`Server error ${G.status}: ${Z}`}]),new Error(`Server ${G.status}: ${Z}`)}const te=(await G.json())?.reply||"Sorry  no reply from server.";p(Z=>[...Z,{id:`a-${Date.now()}`,role:"assistant",text:te}])}else{const W=Bye(L,c,f);await new Promise(G=>setTimeout(G,300+Math.random()*450)),p(G=>[...G,{id:`a-${Date.now()}`,role:"assistant",text:W.reply}])}}catch(W){console.error("Chatbot error:",W),p(G=>[...G,{id:`err-${Date.now()}`,role:"assistant",text:`Error: ${W.message||W}`}])}finally{w(!1)}}function D(L){L.key==="Enter"&&!L.shiftKey&&(L.preventDefault(),I())}return n?R.jsxs("div",{className:"fixed right-6 bottom-6 z-[1200] w-[360px] md:w-[520px] bg-gradient-to-b from-gray-900/95 to-gray-800/95 border border-gray-800 rounded-2xl shadow-2xl p-3",children:[R.jsxs("div",{className:"flex items-center justify-between mb-3",children:[R.jsxs("div",{className:"flex items-center gap-3",children:[R.jsx(nX,{className:"w-5 h-5 text-emerald-300"}),R.jsxs("div",{children:[R.jsx("div",{className:"text-sm font-semibold",children:"MindEcho  Chat"}),R.jsx("div",{className:"text-xs text-gray-400",children:"Friendly guidance (not a replacement for clinicians)"})]})]}),R.jsx("button",{onClick:i,className:"p-1 rounded bg-gray-800 hover:bg-gray-700",children:R.jsx(rb,{className:"w-4 h-4 text-gray-200"})})]}),R.jsxs("div",{ref:C,className:"max-h-64 overflow-auto space-y-2 mb-3",children:[f.map(L=>R.jsxs("div",{className:`p-2 rounded-lg ${L.role==="user"?"bg-gray-800 text-gray-100 ml-auto w-fit":"bg-gray-700/60 text-gray-100"}`,children:[R.jsx("div",{className:"text-xs text-gray-300 mb-1",children:L.role==="user"?"You":L.role==="system"?"System":"MindCare"}),R.jsx("div",{className:"text-sm whitespace-pre-wrap",children:L.text})]},L.id)),T&&R.jsx("div",{className:"text-sm text-gray-400",children:"MindCare is typing"})]}),R.jsxs("div",{className:"flex gap-2",children:[R.jsx("textarea",{value:v,onChange:L=>b(L.target.value),onKeyDown:D,placeholder:"Ask about anxiety, sleep, coping...",className:"flex-1 min-h-[44px] max-h-28 resize-none px-3 py-2 rounded bg-gray-900 border border-gray-800 text-gray-100 text-sm outline-none"}),R.jsx("button",{onClick:I,disabled:!v.trim()||T,className:"px-3 py-2 rounded bg-emerald-400 text-black font-semibold",children:R.jsx(ope,{className:"w-4 h-4"})})]}),R.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:[R.jsx("strong",{children:"Important:"})," This assistant provides general information. If you're in crisis, contact local emergency services immediately."]})]}):null}const Gye=(n,i=-10,s=10)=>Math.max(i,Math.min(s,n)),FK=(n,i=2)=>Number.isFinite(n)?Number(n).toFixed(i):"";function Hye({calm:n=0,focus:i=0}){const s=i*1.25+n*.9;return Gye(s,-3,3)}const Mk="mindcare_sleep_timing";function Wye(){const{user:n}=ao(),[i,s]=j.useState(!1),[c,f]=j.useState(()=>{try{return localStorage.getItem(Mk)||""}catch{return""}}),[p,v]=j.useState({primary:"neutral",scores:{calm:0,focus:0}}),[b,T]=j.useState(!0),[w,C]=j.useState(!1),[I,D]=j.useState(!1),[L,F]=j.useState("Waiting for signals..."),[W,G]=j.useState(!1),$=j.useRef([]),te=j.useRef(null),[Z,ce]=j.useState([]),se=hU(0),de=Sye(se,{stiffness:250,damping:30});jJ(de,he=>Number(he).toFixed(2));const oe=j.useCallback(he=>he?he==="calm"?"Calm  keep gentle breathing.":he==="tense"?"Tension detected  try 4 slow breaths.":he==="focused"?"Focused  short breaks extend flow.":"Stable  hydrate and blink.":"Waiting for signals...",[]);j.useEffect(()=>{if(!n)return;let he=()=>{};try{he=kk.on("signals",_e=>{if(!b||w)return;try{const ut=yv.inferEmotion(_e,n.consent);if(ut){const me={primary:ut.primary||"neutral",scores:{calm:ut.scores?.calm??0,focus:ut.scores?.focus??0}};v(Ve=>me||Ve),F(oe(me.primary))}}catch{}const ze=_e?.neuro,tt=ze&&ze.alpha!=null&&ze.beta!=null?parseFloat(ze.alpha)-parseFloat(ze.beta):0;$.current.push({ts:Date.now(),value:Number(tt),time:new Date().toLocaleTimeString()});try{aO(n.id,{v:tt,ts:Date.now()})}catch{}}),kk.start(n.consent)}catch(_e){console.warn("sensor start error",_e)}return()=>{try{he(),kk.stop()}catch{}}},[n,b,w,oe]);const ge=j.useCallback(he=>{if(!he)return;const{calm:_e=0,focus:ze=0}=he;let tt="neutral";_e>.6&&_e>ze?tt="calm":ze>.55&&ze>_e?tt="focused":_e<.35&&ze<.4&&(tt="tense"),v({primary:tt,scores:{calm:Number(_e),focus:Number(ze)}}),F(oe(tt));const ut=Hye({calm:_e,focus:ze});$.current.push({ts:Date.now(),value:Number(ut),time:new Date().toLocaleTimeString(),source:"camera"});try{aO(n?.id,{faceSignal:!0,ts:Date.now(),calm:_e,focus:ze})}catch{}},[oe,n?.id]);j.useEffect(()=>{const he=()=>{if($.current.length){const _e=$.current.splice(0,4);ce(ze=>{const tt=[...ze,..._e].slice(-160),ut=tt.length?tt[tt.length-1].value:0;return se.set(ut),tt})}te.current=requestAnimationFrame(he)};return te.current=requestAnimationFrame(he),()=>cancelAnimationFrame(te.current)},[]),j.useEffect(()=>{const he=_e=>{_e.key&&_e.key.toLowerCase()==="b"&&(D(!0),setTimeout(()=>D(!1),1300))};return window.addEventListener("keydown",he),()=>window.removeEventListener("keydown",he)},[]);const Ae=()=>{try{aO(n?.id,{snapshot:!0,at:Date.now(),preview:Z.slice(-8)})}catch{}},ke=()=>T(he=>!he),Ee=()=>C(he=>!he),be=j.useMemo(()=>[{title:"Wellbeing",value:"78%",trend:"+9%",note:"vs last week",Icon:qq},{title:"Energy",value:"82%",trend:"Stable",note:"Slight improvement",Icon:af},{title:"Sleep",value:"6.5h",trend:"",note:"Keep bedtime",Icon:P2}],[]);j.useMemo(()=>{const he=Z.slice(-18).map(ut=>ut.value);if(!he.length)return[];const _e=Math.max(...he),ze=Math.min(...he),tt=Math.max(1e-6,_e-ze);return he.map(ut=>(ut-ze)/tt)},[Z]),j.useEffect(()=>{const he=()=>s(!0),_e=()=>s(!1);return window.addEventListener("open-chat-panel",he),window.addEventListener("close-chat-panel",_e),()=>{window.removeEventListener("open-chat-panel",he),window.removeEventListener("close-chat-panel",_e)}},[]);const Le=he=>{try{he?(localStorage.setItem(Mk,he),f(he)):(localStorage.removeItem(Mk),f(""))}catch{}},et=()=>{const he="Examples: `23:00-07:00`, `11pm-7am`, `23:30-06:30`",_e=c||"",ze=window.prompt(`Enter your sleep timing range.
${he}

Leave empty to cancel.`,_e);if(ze===null)return;const tt=ze.trim();if(tt){Le(tt);try{const ut=new CustomEvent("toast",{detail:{title:"Sleep timing saved",description:tt,tone:"success",duration:2200}});window.dispatchEvent(ut)}catch{}}},rt=()=>{if(c&&window.confirm("Clear saved sleep timing?")){Le("");try{const he=new CustomEvent("toast",{detail:{title:"Cleared",description:"Sleep timing removed",tone:"info",duration:1600}});window.dispatchEvent(he)}catch{}}};return R.jsxs("div",{className:"flex min-h-screen bg-gradient-to-b from-gray-900 via-gray-950 to-black text-gray-100",children:[R.jsx(Ql,{}),R.jsxs("main",{className:"flex-1 p-4 md:p-8 overflow-y-auto",children:[R.jsx(eu,{}),R.jsxs(Ht.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.35},className:"max-w-7xl mx-auto",children:[R.jsxs("div",{className:"mb-6 grid grid-cols-1 md:grid-cols-3 gap-4 items-start",children:[R.jsxs("div",{className:"md:col-span-2",children:[R.jsx("h1",{className:"text-2xl md:text-3xl font-extrabold",children:"Dashboard"}),R.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Real-time neurofeedback  local & private."})]}),R.jsxs("div",{className:"flex gap-3 justify-start md:justify-end items-center",children:[R.jsxs("button",{onClick:()=>{D(!0),setTimeout(()=>D(!1),1400)},className:`inline-flex items-center gap-2 px-4 py-2 rounded-xl font-semibold ${I?"bg-gradient-to-r from-yellow-400 to-red-400 text-black":"bg-gradient-to-r from-indigo-600 to-purple-600 text-white"}`,children:[R.jsx(ppe,{className:"w-4 h-4"})," ",I?"Boosting":"Boost (B)"]}),R.jsxs("div",{className:"hidden md:flex items-center bg-white/5 text-gray-300 text-xs px-3 py-2 rounded-2xl border border-white/6",children:[R.jsx("span",{className:"mr-2",children:"Live"}),R.jsx("span",{className:"font-mono",children:new Date().toLocaleTimeString()})]}),R.jsx("button",{onClick:()=>G(he=>!he),className:`px-3 py-2 rounded-xl text-sm ${W?"bg-gray-800/60":"bg-gray-800/30"}`,title:"Toggle camera emotion tracker",children:W?"Camera On":"Camera"}),R.jsx("button",{onClick:()=>s(he=>!he),className:"px-3 py-2 rounded-xl text-sm bg-emerald-700/80 hover:bg-emerald-700/100",title:"Open MindCare Chat",children:"Chat"}),R.jsx("button",{onClick:et,className:"px-3 py-2 rounded-xl text-sm bg-violet-700/90 hover:bg-violet-700/100",title:"Set sleep timing",children:c?`Sleep: ${c}`:"Set Sleep Time"})]})]}),R.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-12 gap-6",children:[R.jsxs(Ht.section,{className:"xl:col-span-8 bg-gradient-to-b from-gray-850 to-gray-900 rounded-2xl p-5 border border-gray-800 shadow-lg",children:[R.jsxs("div",{className:"flex items-start justify-between mb-4",children:[R.jsxs("div",{children:[R.jsx("h2",{className:"text-lg font-semibold",children:"Neuro Mirror  Live"}),R.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Low-latency, local processing"})]}),R.jsxs("div",{className:"flex items-center gap-3",children:[R.jsxs("div",{className:"text-xs text-gray-400",children:["Points: ",R.jsx("span",{className:"font-medium text-gray-100",children:Z.length})]}),R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsx("button",{onClick:ke,className:"px-3 py-2 rounded-md bg-gray-800 border border-gray-700 text-sm",children:b?"Stop":"Start"}),R.jsx("button",{onClick:Ee,className:"px-3 py-2 rounded-md bg-gray-800 border border-gray-700 text-sm",children:w?"Resume":"Pause"})]})]})]}),R.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[R.jsxs("div",{className:"md:col-span-2 bg-gradient-to-b from-gray-800/60 to-gray-900/40 rounded-xl p-3 border border-gray-800 overflow-hidden",children:[R.jsxs("div",{className:"flex items-center justify-between mb-2",children:[R.jsx("div",{className:"text-sm text-gray-300",children:"EEG Trend (or mapped camera value)"}),R.jsx("div",{className:"text-xs text-gray-500",children:"Recent"})]}),R.jsx("div",{className:"w-full h-44 md:h-56 lg:h-64",children:R.jsx(jK,{data:Z,dark:!0,compact:!0})}),R.jsxs("div",{className:"mt-3 flex items-center justify-between text-xs text-gray-400",children:[R.jsxs("div",{children:["Last value: ",R.jsx("span",{className:"font-medium text-gray-100",children:Z.length?FK(Z.at(-1).value):""})]}),R.jsxs("div",{children:["Buffered: ",R.jsx("span",{className:"font-medium",children:Z.length})]})]})]}),R.jsxs("div",{className:"rounded-xl p-3 bg-gradient-to-br from-gray-850 to-gray-900 border border-gray-800 flex flex-col justify-between",children:[R.jsxs("div",{className:"mb-4",children:["  ",R.jsx(xye,{emotion:p,compact:!0})]}),R.jsxs("div",{children:[R.jsx("div",{className:"text-sm text-gray-300",children:"Primary State"}),R.jsx("div",{className:"mt-3 flex items-center gap-3",children:R.jsxs("div",{children:[R.jsx("div",{className:"text-lg font-semibold capitalize",children:p.primary}),R.jsx("div",{className:"text-xs text-gray-400 mt-1",children:L}),R.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Calm: ",p.scores.calm?.toFixed(2),"  Focus: ",p.scores.focus?.toFixed(2)]})]})})]}),R.jsxs("div",{className:"mt-4",children:[R.jsx("div",{className:"text-xs text-gray-400 mb-2",children:"Actions"}),R.jsxs("div",{className:"flex gap-2",children:[R.jsx("button",{onClick:()=>Ae(),className:"flex-1 px-3 py-2 rounded-lg bg-gray-800 border border-gray-700 text-sm",children:"Snapshot"}),R.jsx("button",{onClick:()=>{try{aO(n?.id,{demo:!0})}catch{}},className:"px-3 py-2 rounded-lg bg-indigo-600 text-black font-medium",children:"Boost"})]})]})]})]}),R.jsxs("div",{className:"mt-5",children:[R.jsx("h3",{className:"text-sm text-gray-300 mb-2",children:"Recent Signals"}),R.jsx("div",{className:"space-y-2 max-h-44 overflow-auto pr-2",children:R.jsx(Yo,{initial:!1,children:Z.slice().reverse().slice(0,40).map((he,_e)=>R.jsxs(Ht.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:-6},transition:{duration:.14},className:"flex items-center justify-between px-3 py-2 rounded-lg bg-gray-800/60 border border-gray-800",children:[R.jsxs("div",{className:"text-xs text-gray-400",children:[he.time," ",he.source==="camera"&&R.jsx("span",{className:"ml-2 text-xs text-emerald-400",children:"cam"})]}),R.jsx("div",{className:"text-sm font-mono text-gray-100",children:FK(he.value)})]},`${he.ts}-${_e}`))})})]})]}),R.jsxs(Ht.aside,{className:"xl:col-span-4 flex flex-col gap-6",children:[R.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:be.map(he=>R.jsx(Ht.div,{whileHover:{y:-4},children:R.jsx(Dye,{title:he.title,value:he.value,trend:he.trend,note:he.note,Icon:he.Icon||he.icon})},he.title))}),R.jsxs("div",{className:"bg-gradient-to-b from-gray-850 to-gray-900 rounded-2xl p-4 border border-gray-800",children:[R.jsx("h4",{className:"text-sm font-semibold text-gray-200",children:"Activity Snapshot"}),R.jsx("p",{className:"text-xs text-gray-400 mb-3",children:"Short-term trend from recent signals."}),R.jsx("div",{className:"h-28",children:R.jsx(jK,{data:Z,compact:!0,dark:!0})})]}),R.jsx("div",{className:"bg-gradient-to-br from-indigo-700 to-purple-700 text-white rounded-2xl p-4 shadow-lg",children:R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsxs("div",{children:[R.jsx("div",{className:"text-sm font-medium",children:"Mindful Minute"}),R.jsx("div",{className:"text-xs opacity-90 mt-1",children:"A tiny exercise to reset attention"})]}),R.jsx("button",{onClick:()=>{alert("Start a 60s breathing session  inhale 4s, hold 4s, exhale 4s.")},className:"bg-white/12 px-3 py-2 rounded-md text-white font-semibold",children:"Start"})]})}),R.jsxs("div",{className:"bg-gradient-to-b from-gray-850 to-gray-900 rounded-2xl p-4 border border-gray-800 text-center",children:[R.jsx("div",{className:"text-sm text-gray-300 font-semibold",children:"Mindfulness Summary"}),R.jsx("div",{className:"mt-2 text-xs text-gray-400",children:"Consistency matters  small daily practices compound."}),R.jsxs("div",{className:"mt-3 flex justify-center gap-2 items-center",children:[R.jsx("div",{className:"bg-purple-800 px-3 py-2 rounded-lg text-purple-100 text-sm",children:" 4 Sessions"}),R.jsx("div",{className:"bg-blue-800 px-3 py-2 rounded-lg text-blue-100 text-sm",children:" 3 Focus Wins"})]}),R.jsx("div",{className:"mt-4",children:c?R.jsxs("div",{className:"flex items-center justify-center gap-3",children:[R.jsx("div",{className:"text-xs text-gray-200",children:"Saved sleep timing:"}),R.jsx("div",{className:"px-3 py-1 rounded-lg bg-white/6 text-sm text-gray-100 font-medium",children:c}),R.jsx("button",{onClick:rt,className:"text-xs px-2 py-1 rounded bg-gray-800/40",children:"Clear"})]}):R.jsxs("div",{className:"text-xs text-gray-400",children:["No sleep timing set  click ",R.jsx("span",{className:"font-medium text-gray-200",children:"Set Sleep Time"})," above."]})})]})]})]})]})]}),R.jsx(Yo,{children:W&&R.jsxs(Ht.aside,{initial:{x:360,opacity:0},animate:{x:0,opacity:1},exit:{x:360,opacity:0},transition:{type:"spring",stiffness:260,damping:28},className:"fixed right-4 bottom-6 z-[1200] w-[360px] md:w-[420px] bg-gradient-to-b from-gray-900/95 to-gray-800/95 border border-gray-800 rounded-2xl shadow-2xl p-4",children:[R.jsxs("div",{className:"flex items-center justify-between mb-3",children:[R.jsxs("div",{children:[R.jsx("div",{className:"text-sm font-semibold",children:"Camera Emotion Tracker"}),R.jsx("div",{className:"text-xs text-gray-400",children:"Runs locally in your browser  no frames uploaded by default"})]}),R.jsx("div",{className:"flex items-center gap-2",children:R.jsx("button",{onClick:()=>G(!1),className:"text-xs px-2 py-1 rounded bg-gray-800/40",children:"Close"})})]}),R.jsx("div",{children:R.jsx(Mye,{onSignal:ge,autoStart:!1,sampleIntervalMs:600})})]})}),R.jsx(Fye,{open:i,onClose:()=>s(!1)})]})}const GK=[6,12,24];function HK(n){try{return new Date(n).toLocaleString()}catch{return n}}function zye(){return R.jsxs("div",{className:"animate-pulse p-4 rounded-lg bg-gray-800/50 border border-gray-800",children:[R.jsxs("div",{className:"flex justify-between items-start gap-4",children:[R.jsxs("div",{className:"flex-1 space-y-2",children:[R.jsx("div",{className:"h-4 bg-gray-700 rounded w-2/5"}),R.jsx("div",{className:"h-3 bg-gray-700 rounded w-1/3 mt-2"})]}),R.jsx("div",{className:"w-20 h-8 bg-gray-700 rounded"})]}),R.jsx("div",{className:"mt-3 h-3 bg-gray-700 rounded w-full"})]})}function Kye(){const{user:n}=ao(),[i,s]=j.useState([]),[c,f]=j.useState([]),[p,v]=j.useState(!0),[b,T]=j.useState(""),[w,C]=j.useState(""),[I,D]=j.useState("all"),[L,F]=j.useState("30d"),[W,G]=j.useState(1),[$,te]=j.useState(GK[0]),[Z,ce]=j.useState(null),[se,de]=j.useState(!1);j.useEffect(()=>{n&&(v(!0),T(""),Ov.getHistory(n.id).then(Ee=>{const be=Array.isArray(Ee)?Ee.map(Le=>({id:Le.id||Le._id||`${Le.type}-${Le.timestamp||Date.now()}`,type:Le.type||"session",timestamp:Le.timestamp||Le.createdAt||Date.now(),duration:Le.duration||(Le.seconds?Le.seconds:0),startEmotion:Le.startEmotion||Le.from||"unknown",endEmotion:Le.endEmotion||Le.to||"unknown",summary:Le.summary||Le.note||"",meta:Le.meta||{}})):[];be.sort((Le,et)=>new Date(et.timestamp)-new Date(Le.timestamp)),s(be)}).catch(Ee=>{console.error("getHistory failed",Ee),T("Failed to load history. Try again later."),s([])}).finally(()=>v(!1)))},[n]);const oe=j.useMemo(()=>{const Ee=Date.now(),be=et=>Ee-et*24*60*60*1e3,Le=L==="today"?be(1):L==="7d"?be(7):L==="30d"?be(30):0;return i.filter(et=>{if(I!=="all"&&(et.type||"session").toLowerCase()!==I||Le&&new Date(et.timestamp).getTime()<Le)return!1;if(w){const rt=w.toLowerCase();if(!`${et.type} ${et.summary} ${et.startEmotion} ${et.endEmotion}`.toLowerCase().includes(rt))return!1}return!0})},[i,w,I,L]);j.useEffect(()=>{G(1)},[w,I,L,$]),j.useEffect(()=>{const Ee=(W-1)*$;f(oe.slice(Ee,Ee+$))},[oe,W,$]);const ge=Math.max(1,Math.ceil(oe.length/$)),Ae=()=>{de(!0);try{const Ee=oe,be=new Blob([JSON.stringify(Ee,null,2)],{type:"application/json"}),Le=URL.createObjectURL(be),et=document.createElement("a");et.href=Le,et.download=`mindecho_history_${new Date().toISOString().slice(0,10)}.json`,et.click(),URL.revokeObjectURL(Le)}catch(Ee){console.error("export failed",Ee),alert("Export failed")}finally{de(!1)}},ke=j.useMemo(()=>{const Ee=new Set(i.map(be=>(be.type||"session").toLowerCase()));return["all",...Array.from(Ee)]},[i]);return R.jsxs("div",{className:"flex min-h-screen bg-gradient-to-b from-gray-900 via-gray-950 to-black text-gray-100",children:[R.jsx(Ql,{}),R.jsxs("main",{className:"flex-1 p-4 md:p-8",children:[R.jsx(eu,{}),R.jsxs("div",{className:"max-w-6xl mx-auto",children:[R.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6",children:[R.jsxs("div",{children:[R.jsx("h2",{className:"text-2xl font-extrabold",children:"Activity History"}),R.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"All your practice sessions  searchable, filterable, and exportable."})]}),R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsxs("div",{className:"relative",children:[R.jsx("input",{value:w,onChange:Ee=>C(Ee.target.value),placeholder:"Search by type, note, emotion...",className:"pl-10 pr-3 py-2 rounded-lg bg-gray-800 border border-gray-700 text-sm w-64 focus:outline-none focus:ring-2 focus:ring-indigo-500","aria-label":"Search sessions"}),R.jsx(RI,{className:"absolute left-3 top-2.5 w-5 h-5 text-gray-400"})]}),R.jsxs("div",{className:"hidden sm:flex items-center gap-2 bg-gray-800 rounded-lg px-2 py-1 border border-gray-700",children:[R.jsx(eX,{className:"w-4 h-4 text-gray-300"}),R.jsx("select",{value:I,onChange:Ee=>D(Ee.target.value),className:"bg-transparent text-sm text-gray-200 focus:outline-none","aria-label":"Filter by type",children:ke.map(Ee=>R.jsx("option",{value:Ee,children:Ee==="all"?"All types":Ee},Ee))})]}),R.jsxs("div",{className:"flex items-center gap-2 bg-gray-800 rounded-lg px-2 py-1 border border-gray-700",children:[R.jsx(ofe,{className:"w-4 h-4 text-gray-300"}),R.jsxs("select",{value:L,onChange:Ee=>F(Ee.target.value),className:"bg-transparent text-sm text-gray-200 focus:outline-none","aria-label":"Filter by date",children:[R.jsx("option",{value:"today",children:"Today"}),R.jsx("option",{value:"7d",children:"Last 7 days"}),R.jsx("option",{value:"30d",children:"Last 30 days"}),R.jsx("option",{value:"all",children:"All"})]})]}),R.jsxs("button",{onClick:Ae,disabled:se,className:"ml-2 inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-gradient-to-r from-indigo-600 to-purple-600 text-black text-sm shadow","aria-label":"Export sessions",children:[R.jsx(Afe,{className:"w-4 h-4"})," ",se?"Exporting...":"Export"]})]})]}),R.jsxs("div",{className:"space-y-4",children:[R.jsxs("div",{className:"hidden md:flex items-center justify-between text-xs text-gray-400 px-2",children:[R.jsx("div",{className:"w-2/5",children:"Session"}),R.jsx("div",{className:"w-1/5 text-right",children:"Duration"}),R.jsx("div",{className:"w-1/5 text-right",children:"Start  End"}),R.jsx("div",{className:"w-1/5 text-right",children:"When"})]}),p?R.jsx("div",{className:"space-y-3",children:Array.from({length:4}).map((Ee,be)=>R.jsx(zye,{},be))}):b?R.jsx("div",{className:"p-6 bg-gray-800/60 rounded-lg border border-red-700 text-red-300",children:b}):oe.length===0?R.jsx("div",{className:"p-6 bg-gray-800/50 rounded-lg border border-dashed border-gray-700 text-gray-400",children:"No sessions match your filters. Try widening the date range or clearing the search."}):R.jsx("div",{className:"space-y-3",children:R.jsx(Yo,{children:c.map(Ee=>R.jsxs(Ht.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},exit:{opacity:0,y:-6},layout:!0,className:"p-4 rounded-lg bg-gradient-to-b from-gray-800/40 to-gray-900/40 border border-gray-800 flex flex-col md:flex-row md:items-center md:justify-between gap-3",children:[R.jsx("div",{className:"flex-1 min-w-0 md:w-2/5",children:R.jsxs("div",{className:"flex items-start gap-3",children:[R.jsx("div",{className:"w-10 h-10 rounded-md bg-gradient-to-tr from-indigo-600 to-purple-600 flex items-center justify-center text-white font-semibold",children:String(Ee.type||"S").charAt(0).toUpperCase()}),R.jsxs("div",{className:"min-w-0",children:[R.jsx("div",{className:"text-sm font-semibold truncate",children:Ee.type||"Session"}),R.jsx("div",{className:"text-xs text-gray-400 truncate mt-1",children:Ee.summary||"No notes"})]})]})}),R.jsxs("div",{className:"md:w-1/5 text-right md:text-right text-sm text-gray-300",children:[Math.round((Ee.duration||0)/60)," min"]}),R.jsx("div",{className:"md:w-1/5 text-right text-sm text-gray-300",children:R.jsxs("div",{className:"capitalize",children:[Ee.startEmotion||"","  ",Ee.endEmotion||""]})}),R.jsx("div",{className:"md:w-1/5 text-right text-xs text-gray-400",children:HK(Ee.timestamp)}),R.jsx("div",{className:"flex-shrink-0 md:ml-4 flex items-center gap-2",children:R.jsx("button",{onClick:()=>ce(Ee),className:"px-3 py-1 rounded-md bg-white/6 text-sm hover:bg-white/10",children:"Details"})})]},Ee.id))})})]}),!p&&oe.length>0&&R.jsxs("div",{className:"mt-6 flex flex-col md:flex-row items-center justify-between gap-3",children:[R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsxs("button",{onClick:()=>G(Ee=>Math.max(1,Ee-1)),disabled:W===1,className:"px-3 py-2 rounded-lg bg-gray-800/60 hover:bg-gray-800 disabled:opacity-40 flex items-center gap-2","aria-label":"Prev page",children:[R.jsx(Xq,{className:"w-4 h-4"})," Prev"]}),R.jsxs("div",{className:"text-sm text-gray-300 px-2",children:["Page ",W," of ",ge]}),R.jsxs("button",{onClick:()=>G(Ee=>Math.min(ge,Ee+1)),disabled:W===ge,className:"px-3 py-2 rounded-lg bg-gray-800/60 hover:bg-gray-800 disabled:opacity-40 flex items-center gap-2","aria-label":"Next page",children:["Next ",R.jsx(Jq,{className:"w-4 h-4"})]})]}),R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsx("div",{className:"text-sm text-gray-400",children:"Per page"}),R.jsx("select",{value:$,onChange:Ee=>te(Number(Ee.target.value)),className:"bg-gray-800/60 border border-gray-700 px-2 py-1 rounded-lg text-sm",children:GK.map(Ee=>R.jsx("option",{value:Ee,children:Ee},Ee))})]})]})]})]}),R.jsx(Yo,{children:Z&&R.jsxs(R.Fragment,{children:[R.jsx(Ht.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black/50",onClick:()=>ce(null)}),R.jsx(Ht.div,{initial:{scale:.95,y:20,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.97,y:20,opacity:0},transition:{type:"spring",stiffness:320,damping:28},className:"fixed z-60 left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 max-w-2xl w-full p-4",children:R.jsxs("div",{className:"bg-gray-900 rounded-2xl p-6 border border-gray-800 shadow-2xl",children:[R.jsxs("div",{className:"flex items-start justify-between gap-4",children:[R.jsxs("div",{children:[R.jsx("h3",{className:"text-lg font-semibold",children:Z.type}),R.jsx("div",{className:"text-xs text-gray-400 mt-1",children:HK(Z.timestamp)})]}),R.jsx("button",{onClick:()=>ce(null),className:"p-2 rounded hover:bg-gray-800",children:R.jsx(rb,{className:"w-5 h-5 text-gray-300"})})]}),R.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4",children:[R.jsxs("div",{className:"bg-gray-800/50 p-3 rounded border border-gray-800",children:[R.jsx("div",{className:"text-xs text-gray-400",children:"Duration"}),R.jsxs("div",{className:"text-sm font-semibold mt-1",children:[Math.round((Z.duration||0)/60)," minutes"]})]}),R.jsxs("div",{className:"bg-gray-800/50 p-3 rounded border border-gray-800",children:[R.jsx("div",{className:"text-xs text-gray-400",children:"Start  End"}),R.jsxs("div",{className:"text-sm font-semibold mt-1 capitalize",children:[Z.startEmotion,"  ",Z.endEmotion]})]}),R.jsxs("div",{className:"md:col-span-2 bg-gray-800/50 p-3 rounded border border-gray-800",children:[R.jsx("div",{className:"text-xs text-gray-400",children:"Summary"}),R.jsx("div",{className:"text-sm mt-1 whitespace-pre-wrap",children:Z.summary||"No summary provided."})]}),R.jsxs("div",{className:"md:col-span-2 flex gap-2 justify-end",children:[R.jsx("button",{onClick:()=>{const Ee=new Blob([JSON.stringify(Z,null,2)],{type:"application/json"}),be=URL.createObjectURL(Ee),Le=document.createElement("a");Le.href=be,Le.download=`session_${Z.id||"session"}.json`,Le.click(),URL.revokeObjectURL(be)},className:"px-3 py-2 rounded bg-indigo-600 text-black",children:"Export session"}),R.jsx("button",{onClick:()=>ce(null),className:"px-3 py-2 rounded border",children:"Close"})]})]})]})})]})})]})}function WK({values:n=[],color:i="#7c3aed"}){if(!n.length)return R.jsx("div",{className:"h-8"});const s=Math.max(...n),c=Math.min(...n),f=Math.max(1e-6,s-c),p=n.map((v,b)=>{const T=b/(n.length-1)*100,w=20-(v-c)/f*20;return`${T},${w}`}).join(" ");return R.jsxs("svg",{viewBox:"0 0 100 20",className:"w-28 h-8",preserveAspectRatio:"none","aria-hidden":!0,children:[R.jsx("polyline",{fill:"none",stroke:i,strokeWidth:"1.5",points:p,strokeLinecap:"round",strokeLinejoin:"round"}),R.jsx("circle",{cx:"100",cy:20-(n.at(-1)-c)/f*20,r:"1.6",fill:i})]})}function Uk({checked:n,onChange:i,id:s,label:c}){return R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsx("label",{htmlFor:s,className:"text-sm font-medium text-gray-800 dark:text-gray-200",children:c}),R.jsx("button",{id:s,role:"switch","aria-checked":!!n,onClick:()=>i(!n),className:`relative inline-flex items-center h-6 w-11 rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 ${n?"bg-indigo-600":"bg-gray-300 dark:bg-gray-700"}`,children:R.jsx(Ht.span,{layout:!0,transition:{type:"spring",stiffness:700,damping:30},className:"block h-5 w-5 rounded-full bg-white shadow transform",style:{marginLeft:n?19:2}})})]})}function Yye({status:n}){const i=!!n&&/saved|export|success|exported/i.test(n),s=!!n&&/error|fail|failed|delete/i.test(n),c="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-medium",f=i?"bg-green-50 text-green-800 border border-green-100":s?"bg-red-50 text-red-800 border border-red-100":"bg-yellow-50 text-yellow-800 border border-yellow-100";return R.jsxs(Ht.div,{initial:{scale:.96,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.18},className:`${c} ${f}`,children:[i&&R.jsx(gfe,{className:"w-4 h-4 text-green-500"}),R.jsx("span",{children:n||"Unsaved changes"})]})}function qye(){const{user:n,updateUser:i,logout:s}=ao(),c=n?.consent??{neurofeedback:!0,camera:!0,audio:!0},[f,p]=j.useState(c),[v,b]=j.useState(""),[T,w]=j.useState(()=>{try{const te=localStorage.getItem("mindecho_theme");return te?te==="dark":!0}catch{return!0}}),[C,I]=j.useState(!1),[D,L]=j.useState(!1),F=j.useMemo(()=>Array.from({length:12},(Z,ce)=>Math.sin(ce/2)*10+30+Math.random()*4).map(Z=>Math.max(0,Z)),[]);j.useEffect(()=>{try{localStorage.setItem("mindecho_theme",T?"dark":"light");const te=document.documentElement;T?te.classList.add("dark"):te.classList.remove("dark")}catch{}},[T]),j.useEffect(()=>{if(!v)return;const te=setTimeout(()=>b(""),3e3);return()=>clearTimeout(te)},[v]);const W=async()=>{b("Saving settings...");try{const te=await Ov.updateConsent(n.id,f);i&&i(te),b("Settings saved")}catch(te){console.error(te),b("Error saving settings")}},G=async()=>{b("Preparing export...");try{const te=await Ov.exportData(n.id),Z=new Blob([JSON.stringify(te,null,2)],{type:"application/json"}),ce=URL.createObjectURL(Z),se=document.createElement("a");se.href=ce,se.download=`mindecho_export_${new Date().toISOString().slice(0,10)}.json`,se.click(),URL.revokeObjectURL(ce),b("Exported")}catch(te){console.error(te),b("Export failed")}},$=async()=>{L(!0),b("Deleting account...");try{await Ov.deleteData(n.id),await s()}catch(te){console.error(te),b("Delete failed")}finally{L(!1)}};return R.jsxs("div",{className:`flex min-h-screen bg-gradient-to-b ${T?"from-gray-900 to-black text-gray-100":"from-slate-50 to-white text-gray-900"}`,children:[R.jsx(Ql,{}),R.jsxs("main",{className:"flex-1 p-4 md:p-8",children:[R.jsx(eu,{}),R.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[R.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[R.jsxs("div",{children:[R.jsx("h1",{className:"text-2xl md:text-3xl font-extrabold",children:"Settings"}),R.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Manage permissions, privacy, and app appearance."})]}),R.jsxs("div",{className:"flex items-center gap-3",children:[R.jsx(Yye,{status:v}),R.jsx("button",{onClick:()=>w(te=>!te),className:"p-2 rounded-lg bg-white/6 hover:bg-white/10 focus:outline-none","aria-label":"Toggle theme",title:"Toggle theme",children:T?R.jsx(ype,{className:"w-5 h-5 text-yellow-400"}):R.jsx(P2,{className:"w-5 h-5 text-gray-600"})})]})]}),R.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[R.jsxs(Ht.section,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},className:`lg:col-span-2 rounded-2xl p-6 ${T?"bg-gray-850 border border-gray-800":"bg-white border border-gray-100"} shadow-lg`,children:[R.jsxs("div",{className:"flex items-start justify-between",children:[R.jsxs("div",{children:[R.jsx("h2",{className:"text-lg font-semibold",children:"Sensor Consent"}),R.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"MindEcho processes on-device signals  toggle what you're comfortable sharing."})]}),R.jsxs("div",{className:"text-xs text-gray-400",children:["Account: ",R.jsx("span",{className:"font-medium",children:n?.email||n?.name||"Guest"})]})]}),R.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-3 gap-4",children:[R.jsxs("div",{className:"p-4 rounded-xl border dark:border-gray-800 bg-white/6",children:[R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsxs("div",{children:[R.jsx("div",{className:"text-sm font-medium",children:"Neurofeedback"}),R.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Simulated EEG for focus & calm metrics"})]}),R.jsx(Uk,{id:"t-neuro",checked:!!f.neurofeedback,onChange:te=>p(Z=>({...Z,neurofeedback:te}))})]}),R.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[R.jsx("div",{className:"text-xs text-gray-400",children:"Recent"}),R.jsx(WK,{values:F.map(te=>te/2),color:T?"#7c3aed":"#6d28d9"})]})]}),R.jsxs("div",{className:"p-4 rounded-xl border dark:border-gray-800 bg-white/6",children:[R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsxs("div",{children:[R.jsx("div",{className:"text-sm font-medium",children:"Micro-emotion (Camera)"}),R.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"On-device face expression analysis"})]}),R.jsx(Uk,{id:"t-camera",checked:!!f.camera,onChange:te=>p(Z=>({...Z,camera:te}))})]}),R.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[R.jsx("div",{className:"text-xs text-gray-400",children:"Privacy"}),R.jsx("div",{className:"text-xs font-medium text-indigo-300",children:"On-device"})]})]}),R.jsxs("div",{className:"p-4 rounded-xl border dark:border-gray-800 bg-white/6",children:[R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsxs("div",{children:[R.jsx("div",{className:"text-sm font-medium",children:"Acoustic Sentiment"}),R.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Voice-based wellbeing signals"})]}),R.jsx(Uk,{id:"t-audio",checked:!!f.audio,onChange:te=>p(Z=>({...Z,audio:te}))})]}),R.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[R.jsx("div",{className:"text-xs text-gray-400",children:"Last run"}),R.jsx("div",{className:"text-xs font-medium",children:new Date().toLocaleTimeString()})]})]})]}),R.jsxs("div",{className:"mt-6 flex items-center gap-3",children:[R.jsx(Ht.button,{onClick:W,whileTap:{scale:.98},className:"inline-flex items-center gap-2 bg-gradient-to-r from-indigo-600 to-purple-600 px-4 py-2 rounded-lg text-white shadow",children:"Save Settings"}),R.jsx("button",{onClick:()=>p(c),className:"px-3 py-2 rounded-lg border text-sm",children:"Reset"}),R.jsxs("div",{className:"ml-auto text-xs text-gray-400",children:["Tip: press ",R.jsx("kbd",{className:"px-2 py-1 rounded bg-black/10 text-xs",children:"S"})," to Save"]})]}),R.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-3",children:[R.jsx(Ht.div,{whileHover:{y:-3},className:`p-4 rounded-xl border ${T?"border-gray-800":"border-gray-100"} bg-white/5`,children:R.jsxs("div",{className:"flex items-center gap-3",children:[R.jsx(upe,{className:"w-6 h-6 text-green-400"}),R.jsxs("div",{children:[R.jsx("div",{className:"text-sm font-semibold",children:"Privacy-first"}),R.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"All face processing stays on your device unless explicitly uploaded."})]})]})}),R.jsx(Ht.div,{whileHover:{y:-3},className:`p-4 rounded-xl border ${T?"border-gray-800":"border-gray-100"} bg-white/5`,children:R.jsxs("div",{className:"flex items-center gap-3",children:[R.jsx(af,{className:"w-6 h-6 text-yellow-400"}),R.jsxs("div",{children:[R.jsx("div",{className:"text-sm font-semibold",children:"Local Inference"}),R.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Fast, offline-capable inference for quick feedback loops."})]})]})})]})]}),R.jsxs(Ht.aside,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},className:`rounded-2xl p-6 ${T?"bg-gray-850 border border-gray-800":"bg-white border border-gray-100"} shadow-lg space-y-4`,children:[R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsxs("div",{children:[R.jsx("div",{className:"text-sm font-medium",children:"Theme preview"}),R.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Live preview of the current theme"})]}),R.jsx("div",{className:"text-xs text-gray-400",children:"Mode"})]}),R.jsxs("div",{className:"rounded-xl overflow-hidden border border-gray-700",children:[R.jsxs("div",{className:"p-3 flex items-center gap-3 bg-gradient-to-b from-gray-800 to-gray-900",children:[R.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center text-white text-lg font-bold",children:"ME"}),R.jsxs("div",{className:"flex-1",children:[R.jsx("div",{className:"text-sm font-semibold",children:"MindEcho"}),R.jsx("div",{className:"text-xs text-gray-300 mt-0.5",children:"Dark theme  contrast optimized"})]}),R.jsx("div",{className:"flex items-center gap-2",children:R.jsx(WK,{values:F.map(te=>te/3),color:"#a78bfa"})})]}),R.jsxs("div",{className:"p-3 bg-gradient-to-b from-white/6 to-white/2 flex items-center justify-between",children:[R.jsx("div",{className:"text-xs text-gray-300",children:"Accent"}),R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsx("div",{className:"w-3 h-3 rounded-full bg-indigo-500"}),R.jsx("div",{className:"w-3 h-3 rounded-full bg-purple-600"}),R.jsx("div",{className:"w-3 h-3 rounded-full bg-yellow-400"})]})]})]}),R.jsxs("div",{className:"grid gap-3",children:[R.jsxs("button",{onClick:G,className:"flex items-center gap-3 px-3 py-2 rounded-lg bg-white/6 hover:bg-white/10",children:[R.jsx(Sfe,{className:"w-5 h-5 text-indigo-400"}),R.jsxs("div",{className:"text-left",children:[R.jsx("div",{className:"text-sm font-medium",children:"Export my data"}),R.jsx("div",{className:"text-xs text-gray-400",children:"Download profile, sessions & signals"})]})]}),R.jsxs("button",{onClick:()=>I(!0),className:"flex items-center gap-3 px-3 py-2 rounded-lg bg-red-600/10 hover:bg-red-600/20 text-red-400",children:[R.jsx(hM,{className:"w-5 h-5"}),R.jsxs("div",{className:"text-left",children:[R.jsx("div",{className:"text-sm font-medium",children:"Delete my account"}),R.jsx("div",{className:"text-xs text-red-300",children:"This action is permanent"})]})]})]}),R.jsxs("div",{className:"pt-2 border-t border-gray-700/40",children:[R.jsx("div",{className:"text-xs text-gray-400",children:"Account"}),R.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[R.jsxs("div",{children:[R.jsx("div",{className:"text-sm font-medium",children:n?.profile?.displayName||n?.name||"Guest"}),R.jsx("div",{className:"text-xs text-gray-400",children:n?.email})]}),R.jsxs("div",{className:"text-xs text-gray-400",children:["ID: ",R.jsx("span",{className:"font-mono ml-2 text-xs",children:String(n?.id).slice(0,8)})]})]})]})]})]}),R.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[R.jsxs(Ht.div,{whileHover:{y:-6},className:`p-4 rounded-2xl ${T?"bg-gray-850 border border-gray-800":"bg-white border border-gray-100"} shadow`,children:[R.jsxs("div",{className:"flex items-center gap-3",children:[R.jsx(LO,{className:"w-6 h-6 text-indigo-400"}),R.jsxs("div",{children:[R.jsx("div",{className:"text-sm font-semibold",children:"Integrations"}),R.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Connect third-party analytics or video call services."})]})]}),R.jsxs("div",{className:"mt-3 flex gap-2",children:[R.jsx("button",{className:"px-3 py-2 rounded-lg bg-white/6 text-sm",children:"Manage"}),R.jsx("button",{className:"px-3 py-2 rounded-lg bg-white/6 text-sm",children:"Add token"})]})]}),R.jsxs(Ht.div,{whileHover:{y:-6},className:`p-4 rounded-2xl ${T?"bg-gray-850 border border-gray-800":"bg-white border border-gray-100"} shadow`,children:[R.jsxs("div",{className:"flex items-center gap-3",children:[R.jsx(qq,{className:"w-6 h-6 text-green-400"}),R.jsxs("div",{children:[R.jsx("div",{className:"text-sm font-semibold",children:"Usage"}),R.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Sessions & recent events"})]})]}),R.jsxs("div",{className:"mt-3 grid grid-cols-3 gap-2 text-center",children:[R.jsxs("div",{children:[R.jsx("div",{className:"text-xs text-gray-400",children:"Sessions"}),R.jsxs("div",{className:"font-medium",children:[" ",n?.stats?.sessions??0," "]})]}),R.jsxs("div",{children:[R.jsx("div",{className:"text-xs text-gray-400",children:"Notes"}),R.jsxs("div",{className:"font-medium",children:[" ",n?.stats?.notes??0," "]})]}),R.jsxs("div",{children:[R.jsx("div",{className:"text-xs text-gray-400",children:"Last"}),R.jsx("div",{className:"font-medium",children:n?.lastActive?new Date(n.lastActive).toLocaleDateString():""})]})]})]}),R.jsxs(Ht.div,{whileHover:{y:-6},className:`p-4 rounded-2xl ${T?"bg-gray-850 border border-gray-800":"bg-white border border-gray-100"} shadow`,children:[R.jsxs("div",{className:"flex items-center gap-3",children:[R.jsx(af,{className:"w-6 h-6 text-yellow-400"}),R.jsxs("div",{children:[R.jsx("div",{className:"text-sm font-semibold",children:"Quick actions"}),R.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Shortcuts for common tasks"})]})]}),R.jsxs("div",{className:"mt-3 flex gap-2",children:[R.jsx("button",{className:"px-3 py-2 rounded-lg bg-white/6",children:"Take snapshot"}),R.jsx("button",{className:"px-3 py-2 rounded-lg bg-white/6",children:"Start quick session"})]})]})]})]})]}),R.jsx(Yo,{children:C&&R.jsxs(Ht.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center",children:[R.jsxs(Ht.div,{initial:{scale:.98},animate:{scale:1},className:"max-w-md w-full p-6 rounded-2xl bg-white dark:bg-gray-900 shadow-2xl",children:[R.jsxs("div",{className:"flex items-start gap-3",children:[R.jsx("div",{className:"p-2 rounded-full bg-red-50",children:R.jsx(hM,{className:"w-6 h-6 text-red-600"})}),R.jsxs("div",{className:"flex-1",children:[R.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"Delete account?"}),R.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-300 mt-1",children:"This action is permanent. All your data will be removed and you will be logged out."})]})]}),R.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[R.jsx("button",{onClick:()=>I(!1),className:"px-4 py-2 rounded-lg border",children:"Cancel"}),R.jsx("button",{onClick:$,disabled:D,className:"px-4 py-2 rounded-lg bg-red-600 text-white",children:D?"Deleting":"Delete account"})]})]}),R.jsx(Ht.div,{onClick:()=>I(!1),className:"absolute inset-0 bg-black/40",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0}})]})})]})}function Xye(){const{id:n}=Fde(),i=lf(),{user:s}=ao(),[c,f]=j.useState(null),[p,v]=j.useState(!0),[b,T]=j.useState([]),[w,C]=j.useState("");return j.useEffect(()=>{s&&(async()=>{v(!0),C("");try{const D=n||s?.profile?._id||s?.profile?.id;if(!D){C("No profile ID found."),v(!1);return}const L=await sm.get(`/profile/${D}`);f(L.profile||L)}catch(D){console.error("Profile fetch error:",D),C("Failed to load profile data.")}finally{v(!1)}})()},[n,s]),j.useEffect(()=>{const I=async()=>{if(c?.userId)try{const D=await sm.get(`/sessions/user/${c.userId}`);T(D?.sessions||[])}catch{console.warn("No session data found or backend route not ready."),T([])}};c?.userId&&I()},[c]),p?R.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:R.jsx("div",{className:"w-12 h-12 border-4 border-purple-500 border-t-transparent rounded-full animate-spin"})}):w||!c?R.jsxs("div",{className:"min-h-screen p-6 flex flex-col items-center justify-center text-center",children:[R.jsx("p",{className:"text-gray-700 mb-4",children:w||"Profile not found."}),R.jsx("button",{onClick:()=>i("/dashboard"),className:"px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700",children:"Back to Dashboard"})]}):R.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[R.jsx(Ql,{}),R.jsxs("main",{className:"flex-1 p-6 md:p-10",children:[R.jsx(eu,{}),R.jsxs("div",{className:"max-w-4xl mx-auto bg-white rounded-2xl shadow-xl p-6 md:p-8",children:[R.jsxs("div",{className:"flex flex-col md:flex-row items-center md:items-start gap-6",children:[R.jsx("img",{src:c.avatarUrl||"/default-avatar.png",alt:c.displayName,className:"w-24 h-24 rounded-full object-cover border border-gray-200"}),R.jsxs("div",{className:"flex-1 text-center md:text-left",children:[R.jsx("h2",{className:"text-3xl font-bold text-purple-600",children:c.displayName}),R.jsx("p",{className:"text-gray-600 mt-1",children:c.bio}),R.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:[" ",c.location||"Location not set"]}),R.jsx("div",{className:"flex flex-wrap gap-2 mt-4",children:c.tags?.length>0?c.tags.map(I=>R.jsxs("span",{className:"text-xs bg-purple-100 text-purple-700 px-3 py-1 rounded-full",children:["#",I]},I)):R.jsx("span",{className:"text-sm text-gray-400",children:"No tags yet"})}),R.jsx("div",{className:"mt-4 text-sm text-gray-700",children:R.jsxs("p",{children:[R.jsx("strong",{children:"Baseline Metrics"}),"  Calm: ",c.baselineMetrics?.calm??"N/A","  Anxiety: ",c.baselineMetrics?.anxiety??"N/A","  Focus: ",c.baselineMetrics?.focus??"N/A"]})})]})]}),R.jsxs("div",{className:"mt-10",children:[R.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Recent Sessions"}),b.length>0?R.jsx("div",{className:"space-y-3",children:b.map(I=>R.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition",children:[R.jsxs("div",{className:"flex justify-between text-sm",children:[R.jsx("span",{className:"font-medium text-purple-700",children:new Date(I.timestamp).toLocaleString()}),R.jsxs("span",{className:"text-gray-600",children:["Mood: ",I.mood||""]})]}),I.notes&&R.jsx("p",{className:"text-gray-600 text-sm mt-1",children:I.notes})]},I._id))}):R.jsx("p",{className:"text-sm text-gray-500 mt-3",children:"No recorded sessions yet."})]})]})]})]})}function FJ(n){var i,s,c="";if(typeof n=="string"||typeof n=="number")c+=n;else if(typeof n=="object")if(Array.isArray(n)){var f=n.length;for(i=0;i<f;i++)n[i]&&(s=FJ(n[i]))&&(c&&(c+=" "),c+=s)}else for(s in n)n[s]&&(c&&(c+=" "),c+=s);return c}function Ir(){for(var n,i,s=0,c="",f=arguments.length;s<f;s++)(n=arguments[s])&&(i=FJ(n))&&(c&&(c+=" "),c+=i);return c}var Jye=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"];function pU(n){if(typeof n!="string")return!1;var i=Jye;return i.includes(n)}var $ye=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"];function GJ(n){if(typeof n!="string")return!1;var i=$ye;return i.includes(n)}function HJ(n){return typeof n=="string"&&n.startsWith("data-")}function Xl(n){var i=Object.entries(n).filter(s=>{var[c]=s;return GJ(c)||HJ(c)});return Object.fromEntries(i)}function xI(n){if(n==null)return null;if(j.isValidElement(n)&&typeof n.props=="object"&&n.props!==null){var i=n.props;return Xl(i)}return typeof n=="object"&&!Array.isArray(n)?Xl(n):null}function qo(n){var i=Object.entries(n).filter(s=>{var[c]=s;return GJ(c)||HJ(c)||pU(c)});return Object.fromEntries(i)}function Zye(n){return n==null?null:j.isValidElement(n)?qo(n.props):typeof n=="object"&&!Array.isArray(n)?qo(n):null}var Qye=["children","width","height","viewBox","className","style","title","desc"];function LM(){return LM=Object.assign?Object.assign.bind():function(n){for(var i=1;i<arguments.length;i++){var s=arguments[i];for(var c in s)({}).hasOwnProperty.call(s,c)&&(n[c]=s[c])}return n},LM.apply(null,arguments)}function eEe(n,i){if(n==null)return{};var s,c,f=tEe(n,i);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);for(c=0;c<p.length;c++)s=p[c],i.indexOf(s)===-1&&{}.propertyIsEnumerable.call(n,s)&&(f[s]=n[s])}return f}function tEe(n,i){if(n==null)return{};var s={};for(var c in n)if({}.hasOwnProperty.call(n,c)){if(i.indexOf(c)!==-1)continue;s[c]=n[c]}return s}var WJ=j.forwardRef((n,i)=>{var{children:s,width:c,height:f,viewBox:p,className:v,style:b,title:T,desc:w}=n,C=eEe(n,Qye),I=p||{width:c,height:f,x:0,y:0},D=Ir("recharts-surface",v);return j.createElement("svg",LM({},qo(C),{className:D,width:c,height:f,style:b,viewBox:"".concat(I.x," ").concat(I.y," ").concat(I.width," ").concat(I.height),ref:i}),j.createElement("title",null,T),j.createElement("desc",null,w),s)}),nEe=["children","className"];function MM(){return MM=Object.assign?Object.assign.bind():function(n){for(var i=1;i<arguments.length;i++){var s=arguments[i];for(var c in s)({}).hasOwnProperty.call(s,c)&&(n[c]=s[c])}return n},MM.apply(null,arguments)}function rEe(n,i){if(n==null)return{};var s,c,f=iEe(n,i);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);for(c=0;c<p.length;c++)s=p[c],i.indexOf(s)===-1&&{}.propertyIsEnumerable.call(n,s)&&(f[s]=n[s])}return f}function iEe(n,i){if(n==null)return{};var s={};for(var c in n)if({}.hasOwnProperty.call(n,c)){if(i.indexOf(c)!==-1)continue;s[c]=n[c]}return s}var Kv=j.forwardRef((n,i)=>{var{children:s,className:c}=n,f=rEe(n,nEe),p=Ir("recharts-layer",c);return j.createElement("g",MM({className:p},qo(f),{ref:i}),s)}),aEe=j.createContext(null);function ri(n){return function(){return n}}const UM=Math.PI,jM=2*UM,rm=1e-6,sEe=jM-rm;function zJ(n){this._+=n[0];for(let i=1,s=n.length;i<s;++i)this._+=arguments[i]+n[i]}function oEe(n){let i=Math.floor(n);if(!(i>=0))throw new Error(`invalid digits: ${n}`);if(i>15)return zJ;const s=10**i;return function(c){this._+=c[0];for(let f=1,p=c.length;f<p;++f)this._+=Math.round(arguments[f]*s)/s+c[f]}}class cEe{constructor(i){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=i==null?zJ:oEe(i)}moveTo(i,s){this._append`M${this._x0=this._x1=+i},${this._y0=this._y1=+s}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(i,s){this._append`L${this._x1=+i},${this._y1=+s}`}quadraticCurveTo(i,s,c,f){this._append`Q${+i},${+s},${this._x1=+c},${this._y1=+f}`}bezierCurveTo(i,s,c,f,p,v){this._append`C${+i},${+s},${+c},${+f},${this._x1=+p},${this._y1=+v}`}arcTo(i,s,c,f,p){if(i=+i,s=+s,c=+c,f=+f,p=+p,p<0)throw new Error(`negative radius: ${p}`);let v=this._x1,b=this._y1,T=c-i,w=f-s,C=v-i,I=b-s,D=C*C+I*I;if(this._x1===null)this._append`M${this._x1=i},${this._y1=s}`;else if(D>rm)if(!(Math.abs(I*T-w*C)>rm)||!p)this._append`L${this._x1=i},${this._y1=s}`;else{let L=c-v,F=f-b,W=T*T+w*w,G=L*L+F*F,$=Math.sqrt(W),te=Math.sqrt(D),Z=p*Math.tan((UM-Math.acos((W+D-G)/(2*$*te)))/2),ce=Z/te,se=Z/$;Math.abs(ce-1)>rm&&this._append`L${i+ce*C},${s+ce*I}`,this._append`A${p},${p},0,0,${+(I*L>C*F)},${this._x1=i+se*T},${this._y1=s+se*w}`}}arc(i,s,c,f,p,v){if(i=+i,s=+s,c=+c,v=!!v,c<0)throw new Error(`negative radius: ${c}`);let b=c*Math.cos(f),T=c*Math.sin(f),w=i+b,C=s+T,I=1^v,D=v?f-p:p-f;this._x1===null?this._append`M${w},${C}`:(Math.abs(this._x1-w)>rm||Math.abs(this._y1-C)>rm)&&this._append`L${w},${C}`,c&&(D<0&&(D=D%jM+jM),D>sEe?this._append`A${c},${c},0,1,${I},${i-b},${s-T}A${c},${c},0,1,${I},${this._x1=w},${this._y1=C}`:D>rm&&this._append`A${c},${c},0,${+(D>=UM)},${I},${this._x1=i+c*Math.cos(p)},${this._y1=s+c*Math.sin(p)}`)}rect(i,s,c,f){this._append`M${this._x0=this._x1=+i},${this._y0=this._y1=+s}h${c=+c}v${+f}h${-c}Z`}toString(){return this._}}function KJ(n){let i=3;return n.digits=function(s){if(!arguments.length)return i;if(s==null)i=null;else{const c=Math.floor(s);if(!(c>=0))throw new RangeError(`invalid digits: ${s}`);i=c}return n},()=>new cEe(i)}function mU(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function YJ(n){this._context=n}YJ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(n,i){switch(n=+n,i=+i,this._point){case 0:this._point=1,this._line?this._context.lineTo(n,i):this._context.moveTo(n,i);break;case 1:this._point=2;default:this._context.lineTo(n,i);break}}};function DI(n){return new YJ(n)}function qJ(n){return n[0]}function XJ(n){return n[1]}function JJ(n,i){var s=ri(!0),c=null,f=DI,p=null,v=KJ(b);n=typeof n=="function"?n:n===void 0?qJ:ri(n),i=typeof i=="function"?i:i===void 0?XJ:ri(i);function b(T){var w,C=(T=mU(T)).length,I,D=!1,L;for(c==null&&(p=f(L=v())),w=0;w<=C;++w)!(w<C&&s(I=T[w],w,T))===D&&((D=!D)?p.lineStart():p.lineEnd()),D&&p.point(+n(I,w,T),+i(I,w,T));if(L)return p=null,L+""||null}return b.x=function(T){return arguments.length?(n=typeof T=="function"?T:ri(+T),b):n},b.y=function(T){return arguments.length?(i=typeof T=="function"?T:ri(+T),b):i},b.defined=function(T){return arguments.length?(s=typeof T=="function"?T:ri(!!T),b):s},b.curve=function(T){return arguments.length?(f=T,c!=null&&(p=f(c)),b):f},b.context=function(T){return arguments.length?(T==null?c=p=null:p=f(c=T),b):c},b}function sO(n,i,s){var c=null,f=ri(!0),p=null,v=DI,b=null,T=KJ(w);n=typeof n=="function"?n:n===void 0?qJ:ri(+n),i=typeof i=="function"?i:ri(i===void 0?0:+i),s=typeof s=="function"?s:s===void 0?XJ:ri(+s);function w(I){var D,L,F,W=(I=mU(I)).length,G,$=!1,te,Z=new Array(W),ce=new Array(W);for(p==null&&(b=v(te=T())),D=0;D<=W;++D){if(!(D<W&&f(G=I[D],D,I))===$)if($=!$)L=D,b.areaStart(),b.lineStart();else{for(b.lineEnd(),b.lineStart(),F=D-1;F>=L;--F)b.point(Z[F],ce[F]);b.lineEnd(),b.areaEnd()}$&&(Z[D]=+n(G,D,I),ce[D]=+i(G,D,I),b.point(c?+c(G,D,I):Z[D],s?+s(G,D,I):ce[D]))}if(te)return b=null,te+""||null}function C(){return JJ().defined(f).curve(v).context(p)}return w.x=function(I){return arguments.length?(n=typeof I=="function"?I:ri(+I),c=null,w):n},w.x0=function(I){return arguments.length?(n=typeof I=="function"?I:ri(+I),w):n},w.x1=function(I){return arguments.length?(c=I==null?null:typeof I=="function"?I:ri(+I),w):c},w.y=function(I){return arguments.length?(i=typeof I=="function"?I:ri(+I),s=null,w):i},w.y0=function(I){return arguments.length?(i=typeof I=="function"?I:ri(+I),w):i},w.y1=function(I){return arguments.length?(s=I==null?null:typeof I=="function"?I:ri(+I),w):s},w.lineX0=w.lineY0=function(){return C().x(n).y(i)},w.lineY1=function(){return C().x(n).y(s)},w.lineX1=function(){return C().x(c).y(i)},w.defined=function(I){return arguments.length?(f=typeof I=="function"?I:ri(!!I),w):f},w.curve=function(I){return arguments.length?(v=I,p!=null&&(b=v(p)),w):v},w.context=function(I){return arguments.length?(I==null?p=b=null:b=v(p=I),w):p},w}class $J{constructor(i,s){this._context=i,this._x=s}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(i,s){switch(i=+i,s=+s,this._point){case 0:{this._point=1,this._line?this._context.lineTo(i,s):this._context.moveTo(i,s);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+i)/2,this._y0,this._x0,s,i,s):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+s)/2,i,this._y0,i,s);break}}this._x0=i,this._y0=s}}function lEe(n){return new $J(n,!0)}function uEe(n){return new $J(n,!1)}function GO(){}function HO(n,i,s){n._context.bezierCurveTo((2*n._x0+n._x1)/3,(2*n._y0+n._y1)/3,(n._x0+2*n._x1)/3,(n._y0+2*n._y1)/3,(n._x0+4*n._x1+i)/6,(n._y0+4*n._y1+s)/6)}function ZJ(n){this._context=n}ZJ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:HO(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(n,i){switch(n=+n,i=+i,this._point){case 0:this._point=1,this._line?this._context.lineTo(n,i):this._context.moveTo(n,i);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:HO(this,n,i);break}this._x0=this._x1,this._x1=n,this._y0=this._y1,this._y1=i}};function dEe(n){return new ZJ(n)}function QJ(n){this._context=n}QJ.prototype={areaStart:GO,areaEnd:GO,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(n,i){switch(n=+n,i=+i,this._point){case 0:this._point=1,this._x2=n,this._y2=i;break;case 1:this._point=2,this._x3=n,this._y3=i;break;case 2:this._point=3,this._x4=n,this._y4=i,this._context.moveTo((this._x0+4*this._x1+n)/6,(this._y0+4*this._y1+i)/6);break;default:HO(this,n,i);break}this._x0=this._x1,this._x1=n,this._y0=this._y1,this._y1=i}};function hEe(n){return new QJ(n)}function e$(n){this._context=n}e$.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(n,i){switch(n=+n,i=+i,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var s=(this._x0+4*this._x1+n)/6,c=(this._y0+4*this._y1+i)/6;this._line?this._context.lineTo(s,c):this._context.moveTo(s,c);break;case 3:this._point=4;default:HO(this,n,i);break}this._x0=this._x1,this._x1=n,this._y0=this._y1,this._y1=i}};function fEe(n){return new e$(n)}function t$(n){this._context=n}t$.prototype={areaStart:GO,areaEnd:GO,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(n,i){n=+n,i=+i,this._point?this._context.lineTo(n,i):(this._point=1,this._context.moveTo(n,i))}};function pEe(n){return new t$(n)}function zK(n){return n<0?-1:1}function KK(n,i,s){var c=n._x1-n._x0,f=i-n._x1,p=(n._y1-n._y0)/(c||f<0&&-0),v=(s-n._y1)/(f||c<0&&-0),b=(p*f+v*c)/(c+f);return(zK(p)+zK(v))*Math.min(Math.abs(p),Math.abs(v),.5*Math.abs(b))||0}function YK(n,i){var s=n._x1-n._x0;return s?(3*(n._y1-n._y0)/s-i)/2:i}function jk(n,i,s){var c=n._x0,f=n._y0,p=n._x1,v=n._y1,b=(p-c)/3;n._context.bezierCurveTo(c+b,f+b*i,p-b,v-b*s,p,v)}function WO(n){this._context=n}WO.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:jk(this,this._t0,YK(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(n,i){var s=NaN;if(n=+n,i=+i,!(n===this._x1&&i===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(n,i):this._context.moveTo(n,i);break;case 1:this._point=2;break;case 2:this._point=3,jk(this,YK(this,s=KK(this,n,i)),s);break;default:jk(this,this._t0,s=KK(this,n,i));break}this._x0=this._x1,this._x1=n,this._y0=this._y1,this._y1=i,this._t0=s}}};function n$(n){this._context=new r$(n)}(n$.prototype=Object.create(WO.prototype)).point=function(n,i){WO.prototype.point.call(this,i,n)};function r$(n){this._context=n}r$.prototype={moveTo:function(n,i){this._context.moveTo(i,n)},closePath:function(){this._context.closePath()},lineTo:function(n,i){this._context.lineTo(i,n)},bezierCurveTo:function(n,i,s,c,f,p){this._context.bezierCurveTo(i,n,c,s,p,f)}};function mEe(n){return new WO(n)}function gEe(n){return new n$(n)}function i$(n){this._context=n}i$.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var n=this._x,i=this._y,s=n.length;if(s)if(this._line?this._context.lineTo(n[0],i[0]):this._context.moveTo(n[0],i[0]),s===2)this._context.lineTo(n[1],i[1]);else for(var c=qK(n),f=qK(i),p=0,v=1;v<s;++p,++v)this._context.bezierCurveTo(c[0][p],f[0][p],c[1][p],f[1][p],n[v],i[v]);(this._line||this._line!==0&&s===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(n,i){this._x.push(+n),this._y.push(+i)}};function qK(n){var i,s=n.length-1,c,f=new Array(s),p=new Array(s),v=new Array(s);for(f[0]=0,p[0]=2,v[0]=n[0]+2*n[1],i=1;i<s-1;++i)f[i]=1,p[i]=4,v[i]=4*n[i]+2*n[i+1];for(f[s-1]=2,p[s-1]=7,v[s-1]=8*n[s-1]+n[s],i=1;i<s;++i)c=f[i]/p[i-1],p[i]-=c,v[i]-=c*v[i-1];for(f[s-1]=v[s-1]/p[s-1],i=s-2;i>=0;--i)f[i]=(v[i]-f[i+1])/p[i];for(p[s-1]=(n[s]+f[s-1])/2,i=0;i<s-1;++i)p[i]=2*n[i+1]-f[i+1];return[f,p]}function _Ee(n){return new i$(n)}function PI(n,i){this._context=n,this._t=i}PI.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(n,i){switch(n=+n,i=+i,this._point){case 0:this._point=1,this._line?this._context.lineTo(n,i):this._context.moveTo(n,i);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,i),this._context.lineTo(n,i);else{var s=this._x*(1-this._t)+n*this._t;this._context.lineTo(s,this._y),this._context.lineTo(s,i)}break}}this._x=n,this._y=i}};function vEe(n){return new PI(n,.5)}function yEe(n){return new PI(n,0)}function EEe(n){return new PI(n,1)}function Pv(n,i){if((v=n.length)>1)for(var s=1,c,f,p=n[i[0]],v,b=p.length;s<v;++s)for(f=p,p=n[i[s]],c=0;c<b;++c)p[c][1]+=p[c][0]=isNaN(f[c][1])?f[c][0]:f[c][1]}function VM(n){for(var i=n.length,s=new Array(i);--i>=0;)s[i]=i;return s}function SEe(n,i){return n[i]}function bEe(n){const i=[];return i.key=n,i}function TEe(){var n=ri([]),i=VM,s=Pv,c=SEe;function f(p){var v=Array.from(n.apply(this,arguments),bEe),b,T=v.length,w=-1,C;for(const I of p)for(b=0,++w;b<T;++b)(v[b][w]=[0,+c(I,v[b].key,w,p)]).data=I;for(b=0,C=mU(i(v));b<T;++b)v[C[b]].index=b;return s(v,C),v}return f.keys=function(p){return arguments.length?(n=typeof p=="function"?p:ri(Array.from(p)),f):n},f.value=function(p){return arguments.length?(c=typeof p=="function"?p:ri(+p),f):c},f.order=function(p){return arguments.length?(i=p==null?VM:typeof p=="function"?p:ri(Array.from(p)),f):i},f.offset=function(p){return arguments.length?(s=p??Pv,f):s},f}function wEe(n,i){if((c=n.length)>0){for(var s,c,f=0,p=n[0].length,v;f<p;++f){for(v=s=0;s<c;++s)v+=n[s][f][1]||0;if(v)for(s=0;s<c;++s)n[s][f][1]/=v}Pv(n,i)}}function REe(n,i){if((f=n.length)>0){for(var s=0,c=n[i[0]],f,p=c.length;s<p;++s){for(var v=0,b=0;v<f;++v)b+=n[v][s][1]||0;c[s][1]+=c[s][0]=-b/2}Pv(n,i)}}function CEe(n,i){if(!(!((v=n.length)>0)||!((p=(f=n[i[0]]).length)>0))){for(var s=0,c=1,f,p,v;c<p;++c){for(var b=0,T=0,w=0;b<v;++b){for(var C=n[i[b]],I=C[c][1]||0,D=C[c-1][1]||0,L=(I-D)/2,F=0;F<b;++F){var W=n[i[F]],G=W[c][1]||0,$=W[c-1][1]||0;L+=G-$}T+=I,w+=L*I}f[c-1][1]+=f[c-1][0]=s,T&&(s-=w/T)}f[c-1][1]+=f[c-1][0]=s,Pv(n,i)}}var Vk={},Bk={},XK;function AEe(){return XK||(XK=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});function i(s){return s==="__proto__"}n.isUnsafeProperty=i})(Bk)),Bk}var Fk={},JK;function a$(){return JK||(JK=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});function i(s){switch(typeof s){case"number":case"symbol":return!1;case"string":return s.includes(".")||s.includes("[")||s.includes("]")}}n.isDeepKey=i})(Fk)),Fk}var Gk={},$K;function gU(){return $K||($K=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});function i(s){return typeof s=="string"||typeof s=="symbol"?s:Object.is(s?.valueOf?.(),-0)?"-0":String(s)}n.toKey=i})(Gk)),Gk}var Hk={},Wk={},ZK;function OEe(){return ZK||(ZK=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});function i(s){if(s==null)return"";if(typeof s=="string")return s;if(Array.isArray(s))return s.map(i).join(",");const c=String(s);return c==="0"&&Object.is(Number(s),-0)?"-0":c}n.toString=i})(Wk)),Wk}var QK;function _U(){return QK||(QK=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const i=OEe(),s=gU();function c(f){if(Array.isArray(f))return f.map(s.toKey);if(typeof f=="symbol")return[f];f=i.toString(f);const p=[],v=f.length;if(v===0)return p;let b=0,T="",w="",C=!1;for(f.charCodeAt(0)===46&&(p.push(""),b++);b<v;){const I=f[b];w?I==="\\"&&b+1<v?(b++,T+=f[b]):I===w?w="":T+=I:C?I==='"'||I==="'"?w=I:I==="]"?(C=!1,p.push(T),T=""):T+=I:I==="["?(C=!0,T&&(p.push(T),T="")):I==="."?T&&(p.push(T),T=""):T+=I,b++}return T&&p.push(T),p}n.toPath=c})(Hk)),Hk}var e9;function vU(){return e9||(e9=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const i=AEe(),s=a$(),c=gU(),f=_U();function p(b,T,w){if(b==null)return w;switch(typeof T){case"string":{if(i.isUnsafeProperty(T))return w;const C=b[T];return C===void 0?s.isDeepKey(T)?p(b,f.toPath(T),w):w:C}case"number":case"symbol":{typeof T=="number"&&(T=c.toKey(T));const C=b[T];return C===void 0?w:C}default:{if(Array.isArray(T))return v(b,T,w);if(Object.is(T?.valueOf(),-0)?T="-0":T=String(T),i.isUnsafeProperty(T))return w;const C=b[T];return C===void 0?w:C}}}function v(b,T,w){if(T.length===0)return w;let C=b;for(let I=0;I<T.length;I++){if(C==null||i.isUnsafeProperty(T[I]))return w;C=C[T[I]]}return C===void 0?w:C}n.get=p})(Vk)),Vk}var zk,t9;function IEe(){return t9||(t9=1,zk=vU().get),zk}var NEe=IEe();const kI=fd(NEe);var Wo=n=>n===0?0:n>0?1:-1,el=n=>typeof n=="number"&&n!=+n,cd=n=>typeof n=="string"&&n.indexOf("%")===n.length-1,zt=n=>(typeof n=="number"||n instanceof Number)&&!el(n),Jl=n=>zt(n)||typeof n=="string",xEe=0,ub=n=>{var i=++xEe;return"".concat(n||"").concat(i)},cf=function(i,s){var c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,f=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!zt(i)&&typeof i!="string")return c;var p;if(cd(i)){if(s==null)return c;var v=i.indexOf("%");p=s*parseFloat(i.slice(0,v))/100}else p=+i;return el(p)&&(p=c),f&&s!=null&&p>s&&(p=s),p},s$=n=>{if(!Array.isArray(n))return!1;for(var i=n.length,s={},c=0;c<i;c++)if(!s[n[c]])s[n[c]]=!0;else return!0;return!1};function Ju(n,i,s){return zt(n)&&zt(i)?n+s*(i-n):i}function o$(n,i,s){if(!(!n||!n.length))return n.find(c=>c&&(typeof i=="function"?i(c):kI(c,i))===s)}var ta=n=>n===null||typeof n>"u",yU=n=>ta(n)?n:"".concat(n.charAt(0).toUpperCase()).concat(n.slice(1)),EU=(n,i)=>{if(!n||typeof n=="function"||typeof n=="boolean")return null;var s=n;if(j.isValidElement(n)&&(s=n.props),typeof s!="object"&&typeof s!="function")return null;var c={};return Object.keys(s).forEach(f=>{pU(f)&&(c[f]=(p=>s[f](s,p)))}),c},DEe=(n,i,s)=>c=>(n(i,s,c),null),PEe=(n,i,s)=>{if(n===null||typeof n!="object"&&typeof n!="function")return null;var c=null;return Object.keys(n).forEach(f=>{var p=n[f];pU(f)&&typeof p=="function"&&(c||(c={}),c[f]=DEe(p,i,s))}),c},Kk={},Yk={},n9;function kEe(){return n9||(n9=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});function i(s,c){const f=new Map;for(let p=0;p<s.length;p++){const v=s[p],b=c(v);f.has(b)||f.set(b,v)}return Array.from(f.values())}n.uniqBy=i})(Yk)),Yk}var qk={},r9;function c$(){return r9||(r9=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});function i(s){return s}n.identity=i})(qk)),qk}var Xk={},Jk={},$k={},i9;function LEe(){return i9||(i9=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});function i(s){return Number.isSafeInteger(s)&&s>=0}n.isLength=i})($k)),$k}var a9;function SU(){return a9||(a9=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const i=LEe();function s(c){return c!=null&&typeof c!="function"&&i.isLength(c.length)}n.isArrayLike=s})(Jk)),Jk}var Zk={},s9;function MEe(){return s9||(s9=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});function i(s){return typeof s=="object"&&s!==null}n.isObjectLike=i})(Zk)),Zk}var o9;function UEe(){return o9||(o9=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const i=SU(),s=MEe();function c(f){return s.isObjectLike(f)&&i.isArrayLike(f)}n.isArrayLikeObject=c})(Xk)),Xk}var Qk={},eL={},c9;function jEe(){return c9||(c9=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const i=vU();function s(c){return function(f){return i.get(f,c)}}n.property=s})(eL)),eL}var tL={},nL={},rL={},iL={},l9;function l$(){return l9||(l9=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});function i(s){return s!==null&&(typeof s=="object"||typeof s=="function")}n.isObject=i})(iL)),iL}var aL={},u9;function u$(){return u9||(u9=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});function i(s){return s==null||typeof s!="object"&&typeof s!="function"}n.isPrimitive=i})(aL)),aL}var sL={},d9;function d$(){return d9||(d9=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});function i(s,c){return s===c||Number.isNaN(s)&&Number.isNaN(c)}n.eq=i})(sL)),sL}var h9;function VEe(){return h9||(h9=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const i=l$(),s=u$(),c=d$();function f(C,I,D){return typeof D!="function"?f(C,I,()=>{}):p(C,I,function L(F,W,G,$,te,Z){const ce=D(F,W,G,$,te,Z);return ce!==void 0?!!ce:p(F,W,L,Z)},new Map)}function p(C,I,D,L){if(I===C)return!0;switch(typeof I){case"object":return v(C,I,D,L);case"function":return Object.keys(I).length>0?p(C,{...I},D,L):c.eq(C,I);default:return i.isObject(C)?typeof I=="string"?I==="":!0:c.eq(C,I)}}function v(C,I,D,L){if(I==null)return!0;if(Array.isArray(I))return T(C,I,D,L);if(I instanceof Map)return b(C,I,D,L);if(I instanceof Set)return w(C,I,D,L);const F=Object.keys(I);if(C==null)return F.length===0;if(F.length===0)return!0;if(L?.has(I))return L.get(I)===C;L?.set(I,C);try{for(let W=0;W<F.length;W++){const G=F[W];if(!s.isPrimitive(C)&&!(G in C)||I[G]===void 0&&C[G]!==void 0||I[G]===null&&C[G]!==null||!D(C[G],I[G],G,C,I,L))return!1}return!0}finally{L?.delete(I)}}function b(C,I,D,L){if(I.size===0)return!0;if(!(C instanceof Map))return!1;for(const[F,W]of I.entries()){const G=C.get(F);if(D(G,W,F,C,I,L)===!1)return!1}return!0}function T(C,I,D,L){if(I.length===0)return!0;if(!Array.isArray(C))return!1;const F=new Set;for(let W=0;W<I.length;W++){const G=I[W];let $=!1;for(let te=0;te<C.length;te++){if(F.has(te))continue;const Z=C[te];let ce=!1;if(D(Z,G,W,C,I,L)&&(ce=!0),ce){F.add(te),$=!0;break}}if(!$)return!1}return!0}function w(C,I,D,L){return I.size===0?!0:C instanceof Set?T([...C],[...I],D,L):!1}n.isMatchWith=f,n.isSetMatch=w})(rL)),rL}var f9;function h$(){return f9||(f9=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const i=VEe();function s(c,f){return i.isMatchWith(c,f,()=>{})}n.isMatch=s})(nL)),nL}var oL={},cL={},lL={},p9;function BEe(){return p9||(p9=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});function i(s){return Object.getOwnPropertySymbols(s).filter(c=>Object.prototype.propertyIsEnumerable.call(s,c))}n.getSymbols=i})(lL)),lL}var uL={},m9;function f$(){return m9||(m9=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});function i(s){return s==null?s===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(s)}n.getTag=i})(uL)),uL}var dL={},g9;function p$(){return g9||(g9=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const i="[object RegExp]",s="[object String]",c="[object Number]",f="[object Boolean]",p="[object Arguments]",v="[object Symbol]",b="[object Date]",T="[object Map]",w="[object Set]",C="[object Array]",I="[object Function]",D="[object ArrayBuffer]",L="[object Object]",F="[object Error]",W="[object DataView]",G="[object Uint8Array]",$="[object Uint8ClampedArray]",te="[object Uint16Array]",Z="[object Uint32Array]",ce="[object BigUint64Array]",se="[object Int8Array]",de="[object Int16Array]",oe="[object Int32Array]",ge="[object BigInt64Array]",Ae="[object Float32Array]",ke="[object Float64Array]";n.argumentsTag=p,n.arrayBufferTag=D,n.arrayTag=C,n.bigInt64ArrayTag=ge,n.bigUint64ArrayTag=ce,n.booleanTag=f,n.dataViewTag=W,n.dateTag=b,n.errorTag=F,n.float32ArrayTag=Ae,n.float64ArrayTag=ke,n.functionTag=I,n.int16ArrayTag=de,n.int32ArrayTag=oe,n.int8ArrayTag=se,n.mapTag=T,n.numberTag=c,n.objectTag=L,n.regexpTag=i,n.setTag=w,n.stringTag=s,n.symbolTag=v,n.uint16ArrayTag=te,n.uint32ArrayTag=Z,n.uint8ArrayTag=G,n.uint8ClampedArrayTag=$})(dL)),dL}var hL={},_9;function FEe(){return _9||(_9=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});function i(s){return ArrayBuffer.isView(s)&&!(s instanceof DataView)}n.isTypedArray=i})(hL)),hL}var v9;function m$(){return v9||(v9=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const i=BEe(),s=f$(),c=p$(),f=u$(),p=FEe();function v(C,I){return b(C,void 0,C,new Map,I)}function b(C,I,D,L=new Map,F=void 0){const W=F?.(C,I,D,L);if(W!==void 0)return W;if(f.isPrimitive(C))return C;if(L.has(C))return L.get(C);if(Array.isArray(C)){const G=new Array(C.length);L.set(C,G);for(let $=0;$<C.length;$++)G[$]=b(C[$],$,D,L,F);return Object.hasOwn(C,"index")&&(G.index=C.index),Object.hasOwn(C,"input")&&(G.input=C.input),G}if(C instanceof Date)return new Date(C.getTime());if(C instanceof RegExp){const G=new RegExp(C.source,C.flags);return G.lastIndex=C.lastIndex,G}if(C instanceof Map){const G=new Map;L.set(C,G);for(const[$,te]of C)G.set($,b(te,$,D,L,F));return G}if(C instanceof Set){const G=new Set;L.set(C,G);for(const $ of C)G.add(b($,void 0,D,L,F));return G}if(typeof Buffer<"u"&&Buffer.isBuffer(C))return C.subarray();if(p.isTypedArray(C)){const G=new(Object.getPrototypeOf(C)).constructor(C.length);L.set(C,G);for(let $=0;$<C.length;$++)G[$]=b(C[$],$,D,L,F);return G}if(C instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&C instanceof SharedArrayBuffer)return C.slice(0);if(C instanceof DataView){const G=new DataView(C.buffer.slice(0),C.byteOffset,C.byteLength);return L.set(C,G),T(G,C,D,L,F),G}if(typeof File<"u"&&C instanceof File){const G=new File([C],C.name,{type:C.type});return L.set(C,G),T(G,C,D,L,F),G}if(typeof Blob<"u"&&C instanceof Blob){const G=new Blob([C],{type:C.type});return L.set(C,G),T(G,C,D,L,F),G}if(C instanceof Error){const G=new C.constructor;return L.set(C,G),G.message=C.message,G.name=C.name,G.stack=C.stack,G.cause=C.cause,T(G,C,D,L,F),G}if(C instanceof Boolean){const G=new Boolean(C.valueOf());return L.set(C,G),T(G,C,D,L,F),G}if(C instanceof Number){const G=new Number(C.valueOf());return L.set(C,G),T(G,C,D,L,F),G}if(C instanceof String){const G=new String(C.valueOf());return L.set(C,G),T(G,C,D,L,F),G}if(typeof C=="object"&&w(C)){const G=Object.create(Object.getPrototypeOf(C));return L.set(C,G),T(G,C,D,L,F),G}return C}function T(C,I,D=C,L,F){const W=[...Object.keys(I),...i.getSymbols(I)];for(let G=0;G<W.length;G++){const $=W[G],te=Object.getOwnPropertyDescriptor(C,$);(te==null||te.writable)&&(C[$]=b(I[$],$,D,L,F))}}function w(C){switch(s.getTag(C)){case c.argumentsTag:case c.arrayTag:case c.arrayBufferTag:case c.dataViewTag:case c.booleanTag:case c.dateTag:case c.float32ArrayTag:case c.float64ArrayTag:case c.int8ArrayTag:case c.int16ArrayTag:case c.int32ArrayTag:case c.mapTag:case c.numberTag:case c.objectTag:case c.regexpTag:case c.setTag:case c.stringTag:case c.symbolTag:case c.uint8ArrayTag:case c.uint8ClampedArrayTag:case c.uint16ArrayTag:case c.uint32ArrayTag:return!0;default:return!1}}n.cloneDeepWith=v,n.cloneDeepWithImpl=b,n.copyProperties=T})(cL)),cL}var y9;function GEe(){return y9||(y9=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const i=m$();function s(c){return i.cloneDeepWithImpl(c,void 0,c,new Map,void 0)}n.cloneDeep=s})(oL)),oL}var E9;function HEe(){return E9||(E9=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const i=h$(),s=GEe();function c(f){return f=s.cloneDeep(f),p=>i.isMatch(p,f)}n.matches=c})(tL)),tL}var fL={},pL={},mL={},S9;function WEe(){return S9||(S9=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const i=m$(),s=p$();function c(f,p){return i.cloneDeepWith(f,(v,b,T,w)=>{const C=p?.(v,b,T,w);if(C!==void 0)return C;if(typeof f=="object")switch(Object.prototype.toString.call(f)){case s.numberTag:case s.stringTag:case s.booleanTag:{const I=new f.constructor(f?.valueOf());return i.copyProperties(I,f),I}case s.argumentsTag:{const I={};return i.copyProperties(I,f),I.length=f.length,I[Symbol.iterator]=f[Symbol.iterator],I}default:return}})}n.cloneDeepWith=c})(mL)),mL}var b9;function zEe(){return b9||(b9=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const i=WEe();function s(c){return i.cloneDeepWith(c)}n.cloneDeep=s})(pL)),pL}var gL={},_L={},T9;function g$(){return T9||(T9=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const i=/^(?:0|[1-9]\d*)$/;function s(c,f=Number.MAX_SAFE_INTEGER){switch(typeof c){case"number":return Number.isInteger(c)&&c>=0&&c<f;case"symbol":return!1;case"string":return i.test(c)}}n.isIndex=s})(_L)),_L}var vL={},w9;function KEe(){return w9||(w9=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const i=f$();function s(c){return c!==null&&typeof c=="object"&&i.getTag(c)==="[object Arguments]"}n.isArguments=s})(vL)),vL}var R9;function YEe(){return R9||(R9=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const i=a$(),s=g$(),c=KEe(),f=_U();function p(v,b){let T;if(Array.isArray(b)?T=b:typeof b=="string"&&i.isDeepKey(b)&&v?.[b]==null?T=f.toPath(b):T=[b],T.length===0)return!1;let w=v;for(let C=0;C<T.length;C++){const I=T[C];if((w==null||!Object.hasOwn(w,I))&&!((Array.isArray(w)||c.isArguments(w))&&s.isIndex(I)&&I<w.length))return!1;w=w[I]}return!0}n.has=p})(gL)),gL}var C9;function qEe(){return C9||(C9=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const i=h$(),s=gU(),c=zEe(),f=vU(),p=YEe();function v(b,T){switch(typeof b){case"object":{Object.is(b?.valueOf(),-0)&&(b="-0");break}case"number":{b=s.toKey(b);break}}return T=c.cloneDeep(T),function(w){const C=f.get(w,b);return C===void 0?p.has(w,b):T===void 0?C===void 0:i.isMatch(C,T)}}n.matchesProperty=v})(fL)),fL}var A9;function XEe(){return A9||(A9=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const i=c$(),s=jEe(),c=HEe(),f=qEe();function p(v){if(v==null)return i.identity;switch(typeof v){case"function":return v;case"object":return Array.isArray(v)&&v.length===2?f.matchesProperty(v[0],v[1]):c.matches(v);case"string":case"symbol":case"number":return s.property(v)}}n.iteratee=p})(Qk)),Qk}var O9;function JEe(){return O9||(O9=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const i=kEe(),s=c$(),c=UEe(),f=XEe();function p(v,b=s.identity){return c.isArrayLikeObject(v)?i.uniqBy(Array.from(v),f.iteratee(b)):[]}n.uniqBy=p})(Kk)),Kk}var yL,I9;function $Ee(){return I9||(I9=1,yL=JEe().uniqBy),yL}var ZEe=$Ee();const N9=fd(ZEe);function QEe(n,i,s){return i===!0?N9(n,s):typeof i=="function"?N9(n,i):n}var EL={exports:{}},SL={},bL={exports:{}},TL={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var x9;function e0e(){if(x9)return TL;x9=1;var n=Vv();function i(I,D){return I===D&&(I!==0||1/I===1/D)||I!==I&&D!==D}var s=typeof Object.is=="function"?Object.is:i,c=n.useState,f=n.useEffect,p=n.useLayoutEffect,v=n.useDebugValue;function b(I,D){var L=D(),F=c({inst:{value:L,getSnapshot:D}}),W=F[0].inst,G=F[1];return p(function(){W.value=L,W.getSnapshot=D,T(W)&&G({inst:W})},[I,L,D]),f(function(){return T(W)&&G({inst:W}),I(function(){T(W)&&G({inst:W})})},[I]),v(L),L}function T(I){var D=I.getSnapshot;I=I.value;try{var L=D();return!s(I,L)}catch{return!0}}function w(I,D){return D()}var C=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?w:b;return TL.useSyncExternalStore=n.useSyncExternalStore!==void 0?n.useSyncExternalStore:C,TL}var D9;function t0e(){return D9||(D9=1,bL.exports=e0e()),bL.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var P9;function n0e(){if(P9)return SL;P9=1;var n=Vv(),i=t0e();function s(w,C){return w===C&&(w!==0||1/w===1/C)||w!==w&&C!==C}var c=typeof Object.is=="function"?Object.is:s,f=i.useSyncExternalStore,p=n.useRef,v=n.useEffect,b=n.useMemo,T=n.useDebugValue;return SL.useSyncExternalStoreWithSelector=function(w,C,I,D,L){var F=p(null);if(F.current===null){var W={hasValue:!1,value:null};F.current=W}else W=F.current;F=b(function(){function $(de){if(!te){if(te=!0,Z=de,de=D(de),L!==void 0&&W.hasValue){var oe=W.value;if(L(oe,de))return ce=oe}return ce=de}if(oe=ce,c(Z,de))return oe;var ge=D(de);return L!==void 0&&L(oe,ge)?(Z=de,oe):(Z=de,ce=ge)}var te=!1,Z,ce,se=I===void 0?null:I;return[function(){return $(C())},se===null?void 0:function(){return $(se())}]},[C,I,D,L]);var G=f(w,F[0],F[1]);return v(function(){W.hasValue=!0,W.value=G},[G]),T(G),G},SL}var k9;function r0e(){return k9||(k9=1,EL.exports=n0e()),EL.exports}var i0e=r0e(),bU=j.createContext(null),a0e=n=>n,La=()=>{var n=j.useContext(bU);return n?n.store.dispatch:a0e},IO=()=>{},s0e=()=>IO,o0e=(n,i)=>n===i;function Ft(n){var i=j.useContext(bU);return i0e.useSyncExternalStoreWithSelector(i?i.subscription.addNestedSub:s0e,i?i.store.getState:IO,i?i.store.getState:IO,i?n:IO,o0e)}function c0e(n,i=`expected a function, instead received ${typeof n}`){if(typeof n!="function")throw new TypeError(i)}function l0e(n,i=`expected an object, instead received ${typeof n}`){if(typeof n!="object")throw new TypeError(i)}function u0e(n,i="expected all items to be functions, instead received the following types: "){if(!n.every(s=>typeof s=="function")){const s=n.map(c=>typeof c=="function"?`function ${c.name||"unnamed"}()`:typeof c).join(", ");throw new TypeError(`${i}[${s}]`)}}var L9=n=>Array.isArray(n)?n:[n];function d0e(n){const i=Array.isArray(n[0])?n[0]:n;return u0e(i,"createSelector expects all input-selectors to be functions, but received the following types: "),i}function h0e(n,i){const s=[],{length:c}=n;for(let f=0;f<c;f++)s.push(n[f].apply(null,i));return s}var f0e=class{constructor(n){this.value=n}deref(){return this.value}},p0e=typeof WeakRef<"u"?WeakRef:f0e,m0e=0,M9=1;function oO(){return{s:m0e,v:void 0,o:null,p:null}}function _$(n,i={}){let s=oO();const{resultEqualityCheck:c}=i;let f,p=0;function v(){let b=s;const{length:T}=arguments;for(let I=0,D=T;I<D;I++){const L=arguments[I];if(typeof L=="function"||typeof L=="object"&&L!==null){let F=b.o;F===null&&(b.o=F=new WeakMap);const W=F.get(L);W===void 0?(b=oO(),F.set(L,b)):b=W}else{let F=b.p;F===null&&(b.p=F=new Map);const W=F.get(L);W===void 0?(b=oO(),F.set(L,b)):b=W}}const w=b;let C;if(b.s===M9)C=b.v;else if(C=n.apply(null,arguments),p++,c){const I=f?.deref?.()??f;I!=null&&c(I,C)&&(C=I,p!==0&&p--),f=typeof C=="object"&&C!==null||typeof C=="function"?new p0e(C):C}return w.s=M9,w.v=C,C}return v.clearCache=()=>{s=oO(),v.resetResultsCount()},v.resultsCount=()=>p,v.resetResultsCount=()=>{p=0},v}function g0e(n,...i){const s=typeof n=="function"?{memoize:n,memoizeOptions:i}:n,c=(...f)=>{let p=0,v=0,b,T={},w=f.pop();typeof w=="object"&&(T=w,w=f.pop()),c0e(w,`createSelector expects an output function after the inputs, but received: [${typeof w}]`);const C={...s,...T},{memoize:I,memoizeOptions:D=[],argsMemoize:L=_$,argsMemoizeOptions:F=[]}=C,W=L9(D),G=L9(F),$=d0e(f),te=I(function(){return p++,w.apply(null,arguments)},...W),Z=L(function(){v++;const se=h0e($,arguments);return b=te.apply(null,se),b},...G);return Object.assign(Z,{resultFunc:w,memoizedResultFunc:te,dependencies:$,dependencyRecomputations:()=>v,resetDependencyRecomputations:()=>{v=0},lastResult:()=>b,recomputations:()=>p,resetRecomputations:()=>{p=0},memoize:I,argsMemoize:L})};return Object.assign(c,{withTypes:()=>c}),c}var He=g0e(_$),_0e=Object.assign((n,i=He)=>{l0e(n,`createStructuredSelector expects first argument to be an object where each property is a selector, instead received a ${typeof n}`);const s=Object.keys(n),c=s.map(p=>n[p]);return i(c,(...p)=>p.reduce((v,b,T)=>(v[s[T]]=b,v),{}))},{withTypes:()=>_0e}),wL={},RL={},CL={},U9;function v0e(){return U9||(U9=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});function i(c){return typeof c=="symbol"?1:c===null?2:c===void 0?3:c!==c?4:0}const s=(c,f,p)=>{if(c!==f){const v=i(c),b=i(f);if(v===b&&v===0){if(c<f)return p==="desc"?1:-1;if(c>f)return p==="desc"?-1:1}return p==="desc"?b-v:v-b}return 0};n.compareValues=s})(CL)),CL}var AL={},OL={},j9;function v$(){return j9||(j9=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});function i(s){return typeof s=="symbol"||s instanceof Symbol}n.isSymbol=i})(OL)),OL}var V9;function y0e(){return V9||(V9=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const i=v$(),s=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,c=/^\w*$/;function f(p,v){return Array.isArray(p)?!1:typeof p=="number"||typeof p=="boolean"||p==null||i.isSymbol(p)?!0:typeof p=="string"&&(c.test(p)||!s.test(p))||v!=null&&Object.hasOwn(v,p)}n.isKey=f})(AL)),AL}var B9;function E0e(){return B9||(B9=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const i=v0e(),s=y0e(),c=_U();function f(p,v,b,T){if(p==null)return[];b=T?void 0:b,Array.isArray(p)||(p=Object.values(p)),Array.isArray(v)||(v=v==null?[null]:[v]),v.length===0&&(v=[null]),Array.isArray(b)||(b=b==null?[]:[b]),b=b.map(L=>String(L));const w=(L,F)=>{let W=L;for(let G=0;G<F.length&&W!=null;++G)W=W[F[G]];return W},C=(L,F)=>F==null||L==null?F:typeof L=="object"&&"key"in L?Object.hasOwn(F,L.key)?F[L.key]:w(F,L.path):typeof L=="function"?L(F):Array.isArray(L)?w(F,L):typeof F=="object"?F[L]:F,I=v.map(L=>(Array.isArray(L)&&L.length===1&&(L=L[0]),L==null||typeof L=="function"||Array.isArray(L)||s.isKey(L)?L:{key:L,path:c.toPath(L)}));return p.map(L=>({original:L,criteria:I.map(F=>C(F,L))})).slice().sort((L,F)=>{for(let W=0;W<I.length;W++){const G=i.compareValues(L.criteria[W],F.criteria[W],b[W]);if(G!==0)return G}return 0}).map(L=>L.original)}n.orderBy=f})(RL)),RL}var IL={},F9;function S0e(){return F9||(F9=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});function i(s,c=1){const f=[],p=Math.floor(c),v=(b,T)=>{for(let w=0;w<b.length;w++){const C=b[w];Array.isArray(C)&&T<p?v(C,T+1):f.push(C)}};return v(s,0),f}n.flatten=i})(IL)),IL}var NL={},G9;function y$(){return G9||(G9=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const i=g$(),s=SU(),c=l$(),f=d$();function p(v,b,T){return c.isObject(T)&&(typeof b=="number"&&s.isArrayLike(T)&&i.isIndex(b)&&b<T.length||typeof b=="string"&&b in T)?f.eq(T[b],v):!1}n.isIterateeCall=p})(NL)),NL}var H9;function b0e(){return H9||(H9=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const i=E0e(),s=S0e(),c=y$();function f(p,...v){const b=v.length;return b>1&&c.isIterateeCall(p,v[0],v[1])?v=[]:b>2&&c.isIterateeCall(v[0],v[1],v[2])&&(v=[v[0]]),i.orderBy(p,s.flatten(v),["asc"])}n.sortBy=f})(wL)),wL}var xL,W9;function T0e(){return W9||(W9=1,xL=b0e().sortBy),xL}var w0e=T0e();const LI=fd(w0e);var E$=n=>n.legend.settings,R0e=n=>n.legend.size,C0e=n=>n.legend.payload;He([C0e,E$],(n,i)=>{var{itemSorter:s}=i,c=n.flat(1);return s?LI(c,s):c});var cO=1;function A0e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],[i,s]=j.useState({height:0,left:0,top:0,width:0}),c=j.useCallback(f=>{if(f!=null){var p=f.getBoundingClientRect(),v={height:p.height,left:p.left,top:p.top,width:p.width};(Math.abs(v.height-i.height)>cO||Math.abs(v.left-i.left)>cO||Math.abs(v.top-i.top)>cO||Math.abs(v.width-i.width)>cO)&&s({height:v.height,left:v.left,top:v.top,width:v.width})}},[i.width,i.height,i.top,i.left,...n]);return[i,c]}function ha(n){return`Minified Redux error #${n}; visit https://redux.js.org/Errors?code=${n} for the full message or use the non-minified dev environment for full errors. `}var O0e=typeof Symbol=="function"&&Symbol.observable||"@@observable",z9=O0e,DL=()=>Math.random().toString(36).substring(7).split("").join("."),I0e={INIT:`@@redux/INIT${DL()}`,REPLACE:`@@redux/REPLACE${DL()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${DL()}`},zO=I0e;function TU(n){if(typeof n!="object"||n===null)return!1;let i=n;for(;Object.getPrototypeOf(i)!==null;)i=Object.getPrototypeOf(i);return Object.getPrototypeOf(n)===i||Object.getPrototypeOf(n)===null}function S$(n,i,s){if(typeof n!="function")throw new Error(ha(2));if(typeof i=="function"&&typeof s=="function"||typeof s=="function"&&typeof arguments[3]=="function")throw new Error(ha(0));if(typeof i=="function"&&typeof s>"u"&&(s=i,i=void 0),typeof s<"u"){if(typeof s!="function")throw new Error(ha(1));return s(S$)(n,i)}let c=n,f=i,p=new Map,v=p,b=0,T=!1;function w(){v===p&&(v=new Map,p.forEach((G,$)=>{v.set($,G)}))}function C(){if(T)throw new Error(ha(3));return f}function I(G){if(typeof G!="function")throw new Error(ha(4));if(T)throw new Error(ha(5));let $=!0;w();const te=b++;return v.set(te,G),function(){if($){if(T)throw new Error(ha(6));$=!1,w(),v.delete(te),p=null}}}function D(G){if(!TU(G))throw new Error(ha(7));if(typeof G.type>"u")throw new Error(ha(8));if(typeof G.type!="string")throw new Error(ha(17));if(T)throw new Error(ha(9));try{T=!0,f=c(f,G)}finally{T=!1}return(p=v).forEach(te=>{te()}),G}function L(G){if(typeof G!="function")throw new Error(ha(10));c=G,D({type:zO.REPLACE})}function F(){const G=I;return{subscribe($){if(typeof $!="object"||$===null)throw new Error(ha(11));function te(){const ce=$;ce.next&&ce.next(C())}return te(),{unsubscribe:G(te)}},[z9](){return this}}}return D({type:zO.INIT}),{dispatch:D,subscribe:I,getState:C,replaceReducer:L,[z9]:F}}function N0e(n){Object.keys(n).forEach(i=>{const s=n[i];if(typeof s(void 0,{type:zO.INIT})>"u")throw new Error(ha(12));if(typeof s(void 0,{type:zO.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(ha(13))})}function b$(n){const i=Object.keys(n),s={};for(let p=0;p<i.length;p++){const v=i[p];typeof n[v]=="function"&&(s[v]=n[v])}const c=Object.keys(s);let f;try{N0e(s)}catch(p){f=p}return function(v={},b){if(f)throw f;let T=!1;const w={};for(let C=0;C<c.length;C++){const I=c[C],D=s[I],L=v[I],F=D(L,b);if(typeof F>"u")throw b&&b.type,new Error(ha(14));w[I]=F,T=T||F!==L}return T=T||c.length!==Object.keys(v).length,T?w:v}}function KO(...n){return n.length===0?i=>i:n.length===1?n[0]:n.reduce((i,s)=>(...c)=>i(s(...c)))}function x0e(...n){return i=>(s,c)=>{const f=i(s,c);let p=()=>{throw new Error(ha(15))};const v={getState:f.getState,dispatch:(T,...w)=>p(T,...w)},b=n.map(T=>T(v));return p=KO(...b)(f.dispatch),{...f,dispatch:p}}}function T$(n){return TU(n)&&"type"in n&&typeof n.type=="string"}var w$=Symbol.for("immer-nothing"),K9=Symbol.for("immer-draftable"),io=Symbol.for("immer-state");function $c(n,...i){throw new Error(`[Immer] minified error nr: ${n}. Full error at: https://bit.ly/3cXEKWf`)}var db=Object.getPrototypeOf;function ym(n){return!!n&&!!n[io]}function ld(n){return n?R$(n)||Array.isArray(n)||!!n[K9]||!!n.constructor?.[K9]||xb(n)||UI(n):!1}var D0e=Object.prototype.constructor.toString(),Y9=new WeakMap;function R$(n){if(!n||typeof n!="object")return!1;const i=Object.getPrototypeOf(n);if(i===null||i===Object.prototype)return!0;const s=Object.hasOwnProperty.call(i,"constructor")&&i.constructor;if(s===Object)return!0;if(typeof s!="function")return!1;let c=Y9.get(s);return c===void 0&&(c=Function.toString.call(s),Y9.set(s,c)),c===D0e}function YO(n,i,s=!0){MI(n)===0?(s?Reflect.ownKeys(n):Object.keys(n)).forEach(f=>{i(f,n[f],n)}):n.forEach((c,f)=>i(f,c,n))}function MI(n){const i=n[io];return i?i.type_:Array.isArray(n)?1:xb(n)?2:UI(n)?3:0}function BM(n,i){return MI(n)===2?n.has(i):Object.prototype.hasOwnProperty.call(n,i)}function C$(n,i,s){const c=MI(n);c===2?n.set(i,s):c===3?n.add(s):n[i]=s}function P0e(n,i){return n===i?n!==0||1/n===1/i:n!==n&&i!==i}function xb(n){return n instanceof Map}function UI(n){return n instanceof Set}function im(n){return n.copy_||n.base_}function FM(n,i){if(xb(n))return new Map(n);if(UI(n))return new Set(n);if(Array.isArray(n))return Array.prototype.slice.call(n);const s=R$(n);if(i===!0||i==="class_only"&&!s){const c=Object.getOwnPropertyDescriptors(n);delete c[io];let f=Reflect.ownKeys(c);for(let p=0;p<f.length;p++){const v=f[p],b=c[v];b.writable===!1&&(b.writable=!0,b.configurable=!0),(b.get||b.set)&&(c[v]={configurable:!0,writable:!0,enumerable:b.enumerable,value:n[v]})}return Object.create(db(n),c)}else{const c=db(n);if(c!==null&&s)return{...n};const f=Object.create(c);return Object.assign(f,n)}}function wU(n,i=!1){return jI(n)||ym(n)||!ld(n)||(MI(n)>1&&Object.defineProperties(n,{set:lO,add:lO,clear:lO,delete:lO}),Object.freeze(n),i&&Object.values(n).forEach(s=>wU(s,!0))),n}function k0e(){$c(2)}var lO={value:k0e};function jI(n){return n===null||typeof n!="object"?!0:Object.isFrozen(n)}var L0e={};function Em(n){const i=L0e[n];return i||$c(0,n),i}var hb;function A$(){return hb}function M0e(n,i){return{drafts_:[],parent_:n,immer_:i,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function q9(n,i){i&&(Em("Patches"),n.patches_=[],n.inversePatches_=[],n.patchListener_=i)}function GM(n){HM(n),n.drafts_.forEach(U0e),n.drafts_=null}function HM(n){n===hb&&(hb=n.parent_)}function X9(n){return hb=M0e(hb,n)}function U0e(n){const i=n[io];i.type_===0||i.type_===1?i.revoke_():i.revoked_=!0}function J9(n,i){i.unfinalizedDrafts_=i.drafts_.length;const s=i.drafts_[0];return n!==void 0&&n!==s?(s[io].modified_&&(GM(i),$c(4)),ld(n)&&(n=qO(i,n),i.parent_||XO(i,n)),i.patches_&&Em("Patches").generateReplacementPatches_(s[io].base_,n,i.patches_,i.inversePatches_)):n=qO(i,s,[]),GM(i),i.patches_&&i.patchListener_(i.patches_,i.inversePatches_),n!==w$?n:void 0}function qO(n,i,s){if(jI(i))return i;const c=n.immer_.shouldUseStrictIteration(),f=i[io];if(!f)return YO(i,(p,v)=>$9(n,f,i,p,v,s),c),i;if(f.scope_!==n)return i;if(!f.modified_)return XO(n,f.base_,!0),f.base_;if(!f.finalized_){f.finalized_=!0,f.scope_.unfinalizedDrafts_--;const p=f.copy_;let v=p,b=!1;f.type_===3&&(v=new Set(p),p.clear(),b=!0),YO(v,(T,w)=>$9(n,f,p,T,w,s,b),c),XO(n,p,!1),s&&n.patches_&&Em("Patches").generatePatches_(f,s,n.patches_,n.inversePatches_)}return f.copy_}function $9(n,i,s,c,f,p,v){if(f==null||typeof f!="object"&&!v)return;const b=jI(f);if(!(b&&!v)){if(ym(f)){const T=p&&i&&i.type_!==3&&!BM(i.assigned_,c)?p.concat(c):void 0,w=qO(n,f,T);if(C$(s,c,w),ym(w))n.canAutoFreeze_=!1;else return}else v&&s.add(f);if(ld(f)&&!b){if(!n.immer_.autoFreeze_&&n.unfinalizedDrafts_<1||i&&i.base_&&i.base_[c]===f&&b)return;qO(n,f),(!i||!i.scope_.parent_)&&typeof c!="symbol"&&(xb(s)?s.has(c):Object.prototype.propertyIsEnumerable.call(s,c))&&XO(n,f)}}}function XO(n,i,s=!1){!n.parent_&&n.immer_.autoFreeze_&&n.canAutoFreeze_&&wU(i,s)}function j0e(n,i){const s=Array.isArray(n),c={type_:s?1:0,scope_:i?i.scope_:A$(),modified_:!1,finalized_:!1,assigned_:{},parent_:i,base_:n,draft_:null,copy_:null,revoke_:null,isManual_:!1};let f=c,p=RU;s&&(f=[c],p=fb);const{revoke:v,proxy:b}=Proxy.revocable(f,p);return c.draft_=b,c.revoke_=v,b}var RU={get(n,i){if(i===io)return n;const s=im(n);if(!BM(s,i))return V0e(n,s,i);const c=s[i];return n.finalized_||!ld(c)?c:c===PL(n.base_,i)?(kL(n),n.copy_[i]=zM(c,n)):c},has(n,i){return i in im(n)},ownKeys(n){return Reflect.ownKeys(im(n))},set(n,i,s){const c=O$(im(n),i);if(c?.set)return c.set.call(n.draft_,s),!0;if(!n.modified_){const f=PL(im(n),i),p=f?.[io];if(p&&p.base_===s)return n.copy_[i]=s,n.assigned_[i]=!1,!0;if(P0e(s,f)&&(s!==void 0||BM(n.base_,i)))return!0;kL(n),WM(n)}return n.copy_[i]===s&&(s!==void 0||i in n.copy_)||Number.isNaN(s)&&Number.isNaN(n.copy_[i])||(n.copy_[i]=s,n.assigned_[i]=!0),!0},deleteProperty(n,i){return PL(n.base_,i)!==void 0||i in n.base_?(n.assigned_[i]=!1,kL(n),WM(n)):delete n.assigned_[i],n.copy_&&delete n.copy_[i],!0},getOwnPropertyDescriptor(n,i){const s=im(n),c=Reflect.getOwnPropertyDescriptor(s,i);return c&&{writable:!0,configurable:n.type_!==1||i!=="length",enumerable:c.enumerable,value:s[i]}},defineProperty(){$c(11)},getPrototypeOf(n){return db(n.base_)},setPrototypeOf(){$c(12)}},fb={};YO(RU,(n,i)=>{fb[n]=function(){return arguments[0]=arguments[0][0],i.apply(this,arguments)}});fb.deleteProperty=function(n,i){return fb.set.call(this,n,i,void 0)};fb.set=function(n,i,s){return RU.set.call(this,n[0],i,s,n[0])};function PL(n,i){const s=n[io];return(s?im(s):n)[i]}function V0e(n,i,s){const c=O$(i,s);return c?"value"in c?c.value:c.get?.call(n.draft_):void 0}function O$(n,i){if(!(i in n))return;let s=db(n);for(;s;){const c=Object.getOwnPropertyDescriptor(s,i);if(c)return c;s=db(s)}}function WM(n){n.modified_||(n.modified_=!0,n.parent_&&WM(n.parent_))}function kL(n){n.copy_||(n.copy_=FM(n.base_,n.scope_.immer_.useStrictShallowCopy_))}var B0e=class{constructor(n){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.useStrictIteration_=!0,this.produce=(i,s,c)=>{if(typeof i=="function"&&typeof s!="function"){const p=s;s=i;const v=this;return function(T=p,...w){return v.produce(T,C=>s.call(this,C,...w))}}typeof s!="function"&&$c(6),c!==void 0&&typeof c!="function"&&$c(7);let f;if(ld(i)){const p=X9(this),v=zM(i,void 0);let b=!0;try{f=s(v),b=!1}finally{b?GM(p):HM(p)}return q9(p,c),J9(f,p)}else if(!i||typeof i!="object"){if(f=s(i),f===void 0&&(f=i),f===w$&&(f=void 0),this.autoFreeze_&&wU(f,!0),c){const p=[],v=[];Em("Patches").generateReplacementPatches_(i,f,p,v),c(p,v)}return f}else $c(1,i)},this.produceWithPatches=(i,s)=>{if(typeof i=="function")return(v,...b)=>this.produceWithPatches(v,T=>i(T,...b));let c,f;return[this.produce(i,s,(v,b)=>{c=v,f=b}),c,f]},typeof n?.autoFreeze=="boolean"&&this.setAutoFreeze(n.autoFreeze),typeof n?.useStrictShallowCopy=="boolean"&&this.setUseStrictShallowCopy(n.useStrictShallowCopy),typeof n?.useStrictIteration=="boolean"&&this.setUseStrictIteration(n.useStrictIteration)}createDraft(n){ld(n)||$c(8),ym(n)&&(n=nd(n));const i=X9(this),s=zM(n,void 0);return s[io].isManual_=!0,HM(i),s}finishDraft(n,i){const s=n&&n[io];(!s||!s.isManual_)&&$c(9);const{scope_:c}=s;return q9(c,i),J9(void 0,c)}setAutoFreeze(n){this.autoFreeze_=n}setUseStrictShallowCopy(n){this.useStrictShallowCopy_=n}setUseStrictIteration(n){this.useStrictIteration_=n}shouldUseStrictIteration(){return this.useStrictIteration_}applyPatches(n,i){let s;for(s=i.length-1;s>=0;s--){const f=i[s];if(f.path.length===0&&f.op==="replace"){n=f.value;break}}s>-1&&(i=i.slice(s+1));const c=Em("Patches").applyPatches_;return ym(n)?c(n,i):this.produce(n,f=>c(f,i))}};function zM(n,i){const s=xb(n)?Em("MapSet").proxyMap_(n,i):UI(n)?Em("MapSet").proxySet_(n,i):j0e(n,i);return(i?i.scope_:A$()).drafts_.push(s),s}function nd(n){return ym(n)||$c(10,n),I$(n)}function I$(n){if(!ld(n)||jI(n))return n;const i=n[io];let s,c=!0;if(i){if(!i.modified_)return i.base_;i.finalized_=!0,s=FM(n,i.scope_.immer_.useStrictShallowCopy_),c=i.scope_.immer_.shouldUseStrictIteration()}else s=FM(n,!0);return YO(s,(f,p)=>{C$(s,f,I$(p))},c),i&&(i.finalized_=!1),s}var KM=new B0e,N$=KM.produce,F0e=KM.setUseStrictIteration.bind(KM);function x$(n){return({dispatch:s,getState:c})=>f=>p=>typeof p=="function"?p(s,c,n):f(p)}var G0e=x$(),H0e=x$,W0e=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?KO:KO.apply(null,arguments)};function Xo(n,i){function s(...c){if(i){let f=i(...c);if(!f)throw new Error(ro(0));return{type:n,payload:f.payload,..."meta"in f&&{meta:f.meta},..."error"in f&&{error:f.error}}}return{type:n,payload:c[0]}}return s.toString=()=>`${n}`,s.type=n,s.match=c=>T$(c)&&c.type===n,s}var D$=class KS extends Array{constructor(...i){super(...i),Object.setPrototypeOf(this,KS.prototype)}static get[Symbol.species](){return KS}concat(...i){return super.concat.apply(this,i)}prepend(...i){return i.length===1&&Array.isArray(i[0])?new KS(...i[0].concat(this)):new KS(...i.concat(this))}};function Z9(n){return ld(n)?N$(n,()=>{}):n}function uO(n,i,s){return n.has(i)?n.get(i):n.set(i,s(i)).get(i)}function z0e(n){return typeof n=="boolean"}var K0e=()=>function(i){const{thunk:s=!0,immutableCheck:c=!0,serializableCheck:f=!0,actionCreatorCheck:p=!0}=i??{};let v=new D$;return s&&(z0e(s)?v.push(G0e):v.push(H0e(s.extraArgument))),v},P$="RTK_autoBatch",Za=()=>n=>({payload:n,meta:{[P$]:!0}}),Q9=n=>i=>{setTimeout(i,n)},k$=(n={type:"raf"})=>i=>(...s)=>{const c=i(...s);let f=!0,p=!1,v=!1;const b=new Set,T=n.type==="tick"?queueMicrotask:n.type==="raf"?typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:Q9(10):n.type==="callback"?n.queueNotification:Q9(n.timeout),w=()=>{v=!1,p&&(p=!1,b.forEach(C=>C()))};return Object.assign({},c,{subscribe(C){const I=()=>f&&C(),D=c.subscribe(I);return b.add(C),()=>{D(),b.delete(C)}},dispatch(C){try{return f=!C?.meta?.[P$],p=!f,p&&(v||(v=!0,T(w))),c.dispatch(C)}finally{f=!0}}})},Y0e=n=>function(s){const{autoBatch:c=!0}=s??{};let f=new D$(n);return c&&f.push(k$(typeof c=="object"?c:void 0)),f};function q0e(n){const i=K0e(),{reducer:s=void 0,middleware:c,devTools:f=!0,preloadedState:p=void 0,enhancers:v=void 0}=n||{};let b;if(typeof s=="function")b=s;else if(TU(s))b=b$(s);else throw new Error(ro(1));let T;typeof c=="function"?T=c(i):T=i();let w=KO;f&&(w=W0e({trace:!1,...typeof f=="object"&&f}));const C=x0e(...T),I=Y0e(C);let D=typeof v=="function"?v(I):I();const L=w(...D);return S$(b,p,L)}function L$(n){const i={},s=[];let c;const f={addCase(p,v){const b=typeof p=="string"?p:p.type;if(!b)throw new Error(ro(28));if(b in i)throw new Error(ro(29));return i[b]=v,f},addAsyncThunk(p,v){return v.pending&&(i[p.pending.type]=v.pending),v.rejected&&(i[p.rejected.type]=v.rejected),v.fulfilled&&(i[p.fulfilled.type]=v.fulfilled),v.settled&&s.push({matcher:p.settled,reducer:v.settled}),f},addMatcher(p,v){return s.push({matcher:p,reducer:v}),f},addDefaultCase(p){return c=p,f}};return n(f),[i,s,c]}F0e(!1);function X0e(n){return typeof n=="function"}function J0e(n,i){let[s,c,f]=L$(i),p;if(X0e(n))p=()=>Z9(n());else{const b=Z9(n);p=()=>b}function v(b=p(),T){let w=[s[T.type],...c.filter(({matcher:C})=>C(T)).map(({reducer:C})=>C)];return w.filter(C=>!!C).length===0&&(w=[f]),w.reduce((C,I)=>{if(I)if(ym(C)){const L=I(C,T);return L===void 0?C:L}else{if(ld(C))return N$(C,D=>I(D,T));{const D=I(C,T);if(D===void 0){if(C===null)return C;throw Error("A case reducer on a non-draftable value must not return undefined")}return D}}return C},b)}return v.getInitialState=p,v}var $0e="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",Z0e=(n=21)=>{let i="",s=n;for(;s--;)i+=$0e[Math.random()*64|0];return i},Q0e=Symbol.for("rtk-slice-createasyncthunk");function eSe(n,i){return`${n}/${i}`}function tSe({creators:n}={}){const i=n?.asyncThunk?.[Q0e];return function(c){const{name:f,reducerPath:p=f}=c;if(!f)throw new Error(ro(11));const v=(typeof c.reducers=="function"?c.reducers(rSe()):c.reducers)||{},b=Object.keys(v),T={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},w={addCase(Z,ce){const se=typeof Z=="string"?Z:Z.type;if(!se)throw new Error(ro(12));if(se in T.sliceCaseReducersByType)throw new Error(ro(13));return T.sliceCaseReducersByType[se]=ce,w},addMatcher(Z,ce){return T.sliceMatchers.push({matcher:Z,reducer:ce}),w},exposeAction(Z,ce){return T.actionCreators[Z]=ce,w},exposeCaseReducer(Z,ce){return T.sliceCaseReducersByName[Z]=ce,w}};b.forEach(Z=>{const ce=v[Z],se={reducerName:Z,type:eSe(f,Z),createNotation:typeof c.reducers=="function"};aSe(ce)?oSe(se,ce,w,i):iSe(se,ce,w)});function C(){const[Z={},ce=[],se=void 0]=typeof c.extraReducers=="function"?L$(c.extraReducers):[c.extraReducers],de={...Z,...T.sliceCaseReducersByType};return J0e(c.initialState,oe=>{for(let ge in de)oe.addCase(ge,de[ge]);for(let ge of T.sliceMatchers)oe.addMatcher(ge.matcher,ge.reducer);for(let ge of ce)oe.addMatcher(ge.matcher,ge.reducer);se&&oe.addDefaultCase(se)})}const I=Z=>Z,D=new Map,L=new WeakMap;let F;function W(Z,ce){return F||(F=C()),F(Z,ce)}function G(){return F||(F=C()),F.getInitialState()}function $(Z,ce=!1){function se(oe){let ge=oe[Z];return typeof ge>"u"&&ce&&(ge=uO(L,se,G)),ge}function de(oe=I){const ge=uO(D,ce,()=>new WeakMap);return uO(ge,oe,()=>{const Ae={};for(const[ke,Ee]of Object.entries(c.selectors??{}))Ae[ke]=nSe(Ee,oe,()=>uO(L,oe,G),ce);return Ae})}return{reducerPath:Z,getSelectors:de,get selectors(){return de(se)},selectSlice:se}}const te={name:f,reducer:W,actions:T.actionCreators,caseReducers:T.sliceCaseReducersByName,getInitialState:G,...$(p),injectInto(Z,{reducerPath:ce,...se}={}){const de=ce??p;return Z.inject({reducerPath:de,reducer:W},se),{...te,...$(de,!0)}}};return te}}function nSe(n,i,s,c){function f(p,...v){let b=i(p);return typeof b>"u"&&c&&(b=s()),n(b,...v)}return f.unwrapped=n,f}var so=tSe();function rSe(){function n(i,s){return{_reducerDefinitionType:"asyncThunk",payloadCreator:i,...s}}return n.withTypes=()=>n,{reducer(i){return Object.assign({[i.name](...s){return i(...s)}}[i.name],{_reducerDefinitionType:"reducer"})},preparedReducer(i,s){return{_reducerDefinitionType:"reducerWithPrepare",prepare:i,reducer:s}},asyncThunk:n}}function iSe({type:n,reducerName:i,createNotation:s},c,f){let p,v;if("reducer"in c){if(s&&!sSe(c))throw new Error(ro(17));p=c.reducer,v=c.prepare}else p=c;f.addCase(n,p).exposeCaseReducer(i,p).exposeAction(i,v?Xo(n,v):Xo(n))}function aSe(n){return n._reducerDefinitionType==="asyncThunk"}function sSe(n){return n._reducerDefinitionType==="reducerWithPrepare"}function oSe({type:n,reducerName:i},s,c,f){if(!f)throw new Error(ro(18));const{payloadCreator:p,fulfilled:v,pending:b,rejected:T,settled:w,options:C}=s,I=f(n,p,C);c.exposeAction(i,I),v&&c.addCase(I.fulfilled,v),b&&c.addCase(I.pending,b),T&&c.addCase(I.rejected,T),w&&c.addMatcher(I.settled,w),c.exposeCaseReducer(i,{fulfilled:v||dO,pending:b||dO,rejected:T||dO,settled:w||dO})}function dO(){}var cSe="task",M$="listener",U$="completed",CU="cancelled",lSe=`task-${CU}`,uSe=`task-${U$}`,YM=`${M$}-${CU}`,dSe=`${M$}-${U$}`,VI=class{constructor(n){this.code=n,this.message=`${cSe} ${CU} (reason: ${n})`}name="TaskAbortError";message},AU=(n,i)=>{if(typeof n!="function")throw new TypeError(ro(32))},JO=()=>{},j$=(n,i=JO)=>(n.catch(i),n),V$=(n,i)=>(n.addEventListener("abort",i,{once:!0}),()=>n.removeEventListener("abort",i)),pm=(n,i)=>{const s=n.signal;s.aborted||("reason"in s||Object.defineProperty(s,"reason",{enumerable:!0,value:i,configurable:!0,writable:!0}),n.abort(i))},mm=n=>{if(n.aborted){const{reason:i}=n;throw new VI(i)}};function B$(n,i){let s=JO;return new Promise((c,f)=>{const p=()=>f(new VI(n.reason));if(n.aborted){p();return}s=V$(n,p),i.finally(()=>s()).then(c,f)}).finally(()=>{s=JO})}var hSe=async(n,i)=>{try{return await Promise.resolve(),{status:"ok",value:await n()}}catch(s){return{status:s instanceof VI?"cancelled":"rejected",error:s}}finally{i?.()}},$O=n=>i=>j$(B$(n,i).then(s=>(mm(n),s))),F$=n=>{const i=$O(n);return s=>i(new Promise(c=>setTimeout(c,s)))},{assign:Iv}=Object,e7={},BI="listenerMiddleware",fSe=(n,i)=>{const s=c=>V$(n,()=>pm(c,n.reason));return(c,f)=>{AU(c);const p=new AbortController;s(p);const v=hSe(async()=>{mm(n),mm(p.signal);const b=await c({pause:$O(p.signal),delay:F$(p.signal),signal:p.signal});return mm(p.signal),b},()=>pm(p,uSe));return f?.autoJoin&&i.push(v.catch(JO)),{result:$O(n)(v),cancel(){pm(p,lSe)}}}},pSe=(n,i)=>{const s=async(c,f)=>{mm(i);let p=()=>{};const b=[new Promise((T,w)=>{let C=n({predicate:c,effect:(I,D)=>{D.unsubscribe(),T([I,D.getState(),D.getOriginalState()])}});p=()=>{C(),w()}})];f!=null&&b.push(new Promise(T=>setTimeout(T,f,null)));try{const T=await B$(i,Promise.race(b));return mm(i),T}finally{p()}};return(c,f)=>j$(s(c,f))},G$=n=>{let{type:i,actionCreator:s,matcher:c,predicate:f,effect:p}=n;if(i)f=Xo(i).match;else if(s)i=s.type,f=s.match;else if(c)f=c;else if(!f)throw new Error(ro(21));return AU(p),{predicate:f,type:i,effect:p}},H$=Iv(n=>{const{type:i,predicate:s,effect:c}=G$(n);return{id:Z0e(),effect:c,type:i,predicate:s,pending:new Set,unsubscribe:()=>{throw new Error(ro(22))}}},{withTypes:()=>H$}),t7=(n,i)=>{const{type:s,effect:c,predicate:f}=G$(i);return Array.from(n.values()).find(p=>(typeof s=="string"?p.type===s:p.predicate===f)&&p.effect===c)},qM=n=>{n.pending.forEach(i=>{pm(i,YM)})},mSe=(n,i)=>()=>{for(const s of i.keys())qM(s);n.clear()},n7=(n,i,s)=>{try{n(i,s)}catch(c){setTimeout(()=>{throw c},0)}},W$=Iv(Xo(`${BI}/add`),{withTypes:()=>W$}),gSe=Xo(`${BI}/removeAll`),z$=Iv(Xo(`${BI}/remove`),{withTypes:()=>z$}),_Se=(...n)=>{console.error(`${BI}/error`,...n)},Db=(n={})=>{const i=new Map,s=new Map,c=L=>{const F=s.get(L)??0;s.set(L,F+1)},f=L=>{const F=s.get(L)??1;F===1?s.delete(L):s.set(L,F-1)},{extra:p,onError:v=_Se}=n;AU(v);const b=L=>(L.unsubscribe=()=>i.delete(L.id),i.set(L.id,L),F=>{L.unsubscribe(),F?.cancelActive&&qM(L)}),T=L=>{const F=t7(i,L)??H$(L);return b(F)};Iv(T,{withTypes:()=>T});const w=L=>{const F=t7(i,L);return F&&(F.unsubscribe(),L.cancelActive&&qM(F)),!!F};Iv(w,{withTypes:()=>w});const C=async(L,F,W,G)=>{const $=new AbortController,te=pSe(T,$.signal),Z=[];try{L.pending.add($),c(L),await Promise.resolve(L.effect(F,Iv({},W,{getOriginalState:G,condition:(ce,se)=>te(ce,se).then(Boolean),take:te,delay:F$($.signal),pause:$O($.signal),extra:p,signal:$.signal,fork:fSe($.signal,Z),unsubscribe:L.unsubscribe,subscribe:()=>{i.set(L.id,L)},cancelActiveListeners:()=>{L.pending.forEach((ce,se,de)=>{ce!==$&&(pm(ce,YM),de.delete(ce))})},cancel:()=>{pm($,YM),L.pending.delete($)},throwIfCancelled:()=>{mm($.signal)}})))}catch(ce){ce instanceof VI||n7(v,ce,{raisedBy:"effect"})}finally{await Promise.all(Z),pm($,dSe),f(L),L.pending.delete($)}},I=mSe(i,s);return{middleware:L=>F=>W=>{if(!T$(W))return F(W);if(W$.match(W))return T(W.payload);if(gSe.match(W)){I();return}if(z$.match(W))return w(W.payload);let G=L.getState();const $=()=>{if(G===e7)throw new Error(ro(23));return G};let te;try{if(te=F(W),i.size>0){const Z=L.getState(),ce=Array.from(i.values());for(const se of ce){let de=!1;try{de=se.predicate(W,Z,G)}catch(oe){de=!1,n7(v,oe,{raisedBy:"predicate"})}de&&C(se,W,L,$)}}}finally{G=e7}return te},startListening:T,stopListening:w,clearListeners:I}};function ro(n){return`Minified Redux Toolkit error #${n}; visit https://redux-toolkit.js.org/Errors?code=${n} for the full message or use the non-minified dev environment for full errors. `}var vSe={layoutType:"horizontal",width:0,height:0,margin:{top:5,right:5,bottom:5,left:5},scale:1},K$=so({name:"chartLayout",initialState:vSe,reducers:{setLayout(n,i){n.layoutType=i.payload},setChartSize(n,i){n.width=i.payload.width,n.height=i.payload.height},setMargin(n,i){var s,c,f,p;n.margin.top=(s=i.payload.top)!==null&&s!==void 0?s:0,n.margin.right=(c=i.payload.right)!==null&&c!==void 0?c:0,n.margin.bottom=(f=i.payload.bottom)!==null&&f!==void 0?f:0,n.margin.left=(p=i.payload.left)!==null&&p!==void 0?p:0},setScale(n,i){n.scale=i.payload}}}),{setMargin:ySe,setLayout:ESe,setChartSize:SSe,setScale:bSe}=K$.actions,TSe=K$.reducer;function r7(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(f){return Object.getOwnPropertyDescriptor(n,f).enumerable})),s.push.apply(s,c)}return s}function i7(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?r7(Object(s),!0).forEach(function(c){wSe(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):r7(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}function wSe(n,i,s){return(i=RSe(i))in n?Object.defineProperty(n,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[i]=s,n}function RSe(n){var i=CSe(n,"string");return typeof i=="symbol"?i:i+""}function CSe(n,i){if(typeof n!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var c=s.call(n,i);if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}var ZO=Math.PI/180,ASe=n=>n*180/Math.PI,ma=(n,i,s,c)=>({x:n+Math.cos(-ZO*c)*s,y:i+Math.sin(-ZO*c)*s}),OSe=function(i,s){var c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{top:0,right:0,bottom:0,left:0};return Math.min(Math.abs(i-(c.left||0)-(c.right||0)),Math.abs(s-(c.top||0)-(c.bottom||0)))/2},ISe=(n,i)=>{var{x:s,y:c}=n,{x:f,y:p}=i;return Math.sqrt((s-f)**2+(c-p)**2)},NSe=(n,i)=>{var{x:s,y:c}=n,{cx:f,cy:p}=i,v=ISe({x:s,y:c},{x:f,y:p});if(v<=0)return{radius:v,angle:0};var b=(s-f)/v,T=Math.acos(b);return c>p&&(T=2*Math.PI-T),{radius:v,angle:ASe(T),angleInRadian:T}},xSe=n=>{var{startAngle:i,endAngle:s}=n,c=Math.floor(i/360),f=Math.floor(s/360),p=Math.min(c,f);return{startAngle:i-p*360,endAngle:s-p*360}},DSe=(n,i)=>{var{startAngle:s,endAngle:c}=i,f=Math.floor(s/360),p=Math.floor(c/360),v=Math.min(f,p);return n+v*360},PSe=(n,i)=>{var{x:s,y:c}=n,{radius:f,angle:p}=NSe({x:s,y:c},i),{innerRadius:v,outerRadius:b}=i;if(f<v||f>b||f===0)return null;var{startAngle:T,endAngle:w}=xSe(i),C=p,I;if(T<=w){for(;C>w;)C-=360;for(;C<T;)C+=360;I=C>=T&&C<=w}else{for(;C>T;)C-=360;for(;C<w;)C+=360;I=C>=w&&C<=T}return I?i7(i7({},i),{},{radius:f,angle:DSe(C,i)}):null};function Y$(n,i,s){return Array.isArray(n)&&n&&i+s!==0?n.slice(i,s+1):n}function a7(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(f){return Object.getOwnPropertyDescriptor(n,f).enumerable})),s.push.apply(s,c)}return s}function Go(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?a7(Object(s),!0).forEach(function(c){kSe(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):a7(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}function kSe(n,i,s){return(i=LSe(i))in n?Object.defineProperty(n,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[i]=s,n}function LSe(n){var i=MSe(n,"string");return typeof i=="symbol"?i:i+""}function MSe(n,i){if(typeof n!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var c=s.call(n,i);if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}function ts(n,i,s){return ta(n)||ta(i)?s:Jl(i)?kI(n,i,s):typeof i=="function"?i(n):s}var USe=(n,i,s,c,f)=>{var p,v=-1,b=(p=i?.length)!==null&&p!==void 0?p:0;if(b<=1||n==null)return 0;if(c==="angleAxis"&&f!=null&&Math.abs(Math.abs(f[1]-f[0])-360)<=1e-6)for(var T=0;T<b;T++){var w=T>0?s[T-1].coordinate:s[b-1].coordinate,C=s[T].coordinate,I=T>=b-1?s[0].coordinate:s[T+1].coordinate,D=void 0;if(Wo(C-w)!==Wo(I-C)){var L=[];if(Wo(I-C)===Wo(f[1]-f[0])){D=I;var F=C+f[1]-f[0];L[0]=Math.min(F,(F+w)/2),L[1]=Math.max(F,(F+w)/2)}else{D=w;var W=I+f[1]-f[0];L[0]=Math.min(C,(W+C)/2),L[1]=Math.max(C,(W+C)/2)}var G=[Math.min(C,(D+C)/2),Math.max(C,(D+C)/2)];if(n>G[0]&&n<=G[1]||n>=L[0]&&n<=L[1]){({index:v}=s[T]);break}}else{var $=Math.min(w,I),te=Math.max(w,I);if(n>($+C)/2&&n<=(te+C)/2){({index:v}=s[T]);break}}}else if(i){for(var Z=0;Z<b;Z++)if(Z===0&&n<=(i[Z].coordinate+i[Z+1].coordinate)/2||Z>0&&Z<b-1&&n>(i[Z].coordinate+i[Z-1].coordinate)/2&&n<=(i[Z].coordinate+i[Z+1].coordinate)/2||Z===b-1&&n>(i[Z].coordinate+i[Z-1].coordinate)/2){({index:v}=i[Z]);break}}return v},jSe=(n,i,s)=>{if(i&&s){var{width:c,height:f}=s,{align:p,verticalAlign:v,layout:b}=i;if((b==="vertical"||b==="horizontal"&&v==="middle")&&p!=="center"&&zt(n[p]))return Go(Go({},n),{},{[p]:n[p]+(c||0)});if((b==="horizontal"||b==="vertical"&&p==="center")&&v!=="middle"&&zt(n[v]))return Go(Go({},n),{},{[v]:n[v]+(f||0)})}return n},df=(n,i)=>n==="horizontal"&&i==="xAxis"||n==="vertical"&&i==="yAxis"||n==="centric"&&i==="angleAxis"||n==="radial"&&i==="radiusAxis",q$=(n,i,s,c)=>{if(c)return n.map(b=>b.coordinate);var f,p,v=n.map(b=>(b.coordinate===i&&(f=!0),b.coordinate===s&&(p=!0),b.coordinate));return f||v.push(i),p||v.push(s),v},X$=(n,i,s)=>{if(!n)return null;var{duplicateDomain:c,type:f,range:p,scale:v,realScaleType:b,isCategorical:T,categoricalDomain:w,tickCount:C,ticks:I,niceTicks:D,axisType:L}=n;if(!v)return null;var F=b==="scaleBand"&&v.bandwidth?v.bandwidth()/2:2,W=f==="category"&&v.bandwidth?v.bandwidth()/F:0;if(W=L==="angleAxis"&&p&&p.length>=2?Wo(p[0]-p[1])*2*W:W,I||D){var G=(I||D||[]).map(($,te)=>{var Z=c?c.indexOf($):$;return{coordinate:v(Z)+W,value:$,offset:W,index:te}});return G.filter($=>!el($.coordinate))}return T&&w?w.map(($,te)=>({coordinate:v($)+W,value:$,index:te,offset:W})):v.ticks&&C!=null?v.ticks(C).map(($,te)=>({coordinate:v($)+W,value:$,offset:W,index:te})):v.domain().map(($,te)=>({coordinate:v($)+W,value:c?c[$]:$,index:te,offset:W}))},s7=1e-4,VSe=n=>{var i=n.domain();if(!(!i||i.length<=2)){var s=i.length,c=n.range(),f=Math.min(c[0],c[1])-s7,p=Math.max(c[0],c[1])+s7,v=n(i[0]),b=n(i[s-1]);(v<f||v>p||b<f||b>p)&&n.domain([i[0],i[s-1]])}},BSe=n=>{var i=n.length;if(!(i<=0))for(var s=0,c=n[0].length;s<c;++s)for(var f=0,p=0,v=0;v<i;++v){var b=el(n[v][s][1])?n[v][s][0]:n[v][s][1];b>=0?(n[v][s][0]=f,n[v][s][1]=f+b,f=n[v][s][1]):(n[v][s][0]=p,n[v][s][1]=p+b,p=n[v][s][1])}},FSe=n=>{var i=n.length;if(!(i<=0))for(var s=0,c=n[0].length;s<c;++s)for(var f=0,p=0;p<i;++p){var v=el(n[p][s][1])?n[p][s][0]:n[p][s][1];v>=0?(n[p][s][0]=f,n[p][s][1]=f+v,f=n[p][s][1]):(n[p][s][0]=0,n[p][s][1]=0)}},GSe={sign:BSe,expand:wEe,none:Pv,silhouette:REe,wiggle:CEe,positive:FSe},HSe=(n,i,s)=>{var c=GSe[s],f=TEe().keys(i).value((p,v)=>+ts(p,v,0)).order(VM).offset(c);return f(n)};function o7(n){var{axis:i,ticks:s,bandSize:c,entry:f,index:p,dataKey:v}=n;if(i.type==="category"){if(!i.allowDuplicatedCategory&&i.dataKey&&!ta(f[i.dataKey])){var b=o$(s,"value",f[i.dataKey]);if(b)return b.coordinate+c/2}return s[p]?s[p].coordinate+c/2:null}var T=ts(f,ta(v)?i.dataKey:v);return ta(T)?null:i.scale(T)}var WSe=n=>{var i=n.flat(2).filter(zt);return[Math.min(...i),Math.max(...i)]},zSe=n=>[n[0]===1/0?0:n[0],n[1]===-1/0?0:n[1]],KSe=(n,i,s)=>{if(n!=null)return zSe(Object.keys(n).reduce((c,f)=>{var p=n[f],{stackedData:v}=p,b=v.reduce((T,w)=>{var C=Y$(w,i,s),I=WSe(C);return[Math.min(T[0],I[0]),Math.max(T[1],I[1])]},[1/0,-1/0]);return[Math.min(b[0],c[0]),Math.max(b[1],c[1])]},[1/0,-1/0]))},c7=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,l7=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,XM=(n,i,s)=>{if(n&&n.scale&&n.scale.bandwidth){var c=n.scale.bandwidth();if(!s||c>0)return c}if(n&&i&&i.length>=2){for(var f=LI(i,C=>C.coordinate),p=1/0,v=1,b=f.length;v<b;v++){var T=f[v],w=f[v-1];p=Math.min((T.coordinate||0)-(w.coordinate||0),p)}return p===1/0?0:p}return s?void 0:0};function u7(n){var{tooltipEntrySettings:i,dataKey:s,payload:c,value:f,name:p}=n;return Go(Go({},i),{},{dataKey:s,payload:c,value:f,name:p})}function J$(n,i){if(n)return String(n);if(typeof i=="string")return i}function YSe(n,i,s,c,f){if(s==="horizontal"||s==="vertical"){var p=n>=f.left&&n<=f.left+f.width&&i>=f.top&&i<=f.top+f.height;return p?{x:n,y:i}:null}return c?PSe({x:n,y:i},c):null}var qSe=(n,i,s,c)=>{var f=i.find(w=>w&&w.index===s);if(f){if(n==="horizontal")return{x:f.coordinate,y:c.y};if(n==="vertical")return{x:c.x,y:f.coordinate};if(n==="centric"){var p=f.coordinate,{radius:v}=c;return Go(Go(Go({},c),ma(c.cx,c.cy,v,p)),{},{angle:p,radius:v})}var b=f.coordinate,{angle:T}=c;return Go(Go(Go({},c),ma(c.cx,c.cy,b,T)),{},{angle:T,radius:b})}return{x:0,y:0}},XSe=(n,i)=>i==="horizontal"?n.x:i==="vertical"?n.y:i==="centric"?n.angle:n.radius,pd=n=>n.layout.width,md=n=>n.layout.height,JSe=n=>n.layout.scale,$$=n=>n.layout.margin,FI=He(n=>n.cartesianAxis.xAxis,n=>Object.values(n)),GI=He(n=>n.cartesianAxis.yAxis,n=>Object.values(n)),$Se="data-recharts-item-index",ZSe="data-recharts-item-data-key",Pb=60;function d7(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(f){return Object.getOwnPropertyDescriptor(n,f).enumerable})),s.push.apply(s,c)}return s}function hO(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?d7(Object(s),!0).forEach(function(c){QSe(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):d7(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}function QSe(n,i,s){return(i=ebe(i))in n?Object.defineProperty(n,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[i]=s,n}function ebe(n){var i=tbe(n,"string");return typeof i=="symbol"?i:i+""}function tbe(n,i){if(typeof n!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var c=s.call(n,i);if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}var nbe=n=>n.brush.height;function rbe(n){var i=GI(n);return i.reduce((s,c)=>{if(c.orientation==="left"&&!c.mirror&&!c.hide){var f=typeof c.width=="number"?c.width:Pb;return s+f}return s},0)}function ibe(n){var i=GI(n);return i.reduce((s,c)=>{if(c.orientation==="right"&&!c.mirror&&!c.hide){var f=typeof c.width=="number"?c.width:Pb;return s+f}return s},0)}function abe(n){var i=FI(n);return i.reduce((s,c)=>c.orientation==="top"&&!c.mirror&&!c.hide?s+c.height:s,0)}function sbe(n){var i=FI(n);return i.reduce((s,c)=>c.orientation==="bottom"&&!c.mirror&&!c.hide?s+c.height:s,0)}var ga=He([pd,md,$$,nbe,rbe,ibe,abe,sbe,E$,R0e],(n,i,s,c,f,p,v,b,T,w)=>{var C={left:(s.left||0)+f,right:(s.right||0)+p},I={top:(s.top||0)+v,bottom:(s.bottom||0)+b},D=hO(hO({},I),C),L=D.bottom;D.bottom+=c,D=jSe(D,T,w);var F=n-D.left-D.right,W=i-D.top-D.bottom;return hO(hO({brushBottom:L},D),{},{width:Math.max(F,0),height:Math.max(W,0)})}),obe=He(ga,n=>({x:n.left,y:n.top,width:n.width,height:n.height})),Z$=He(pd,md,(n,i)=>({x:0,y:0,width:n,height:i})),cbe=j.createContext(null),oo=()=>j.useContext(cbe)!=null,HI=n=>n.brush,WI=He([HI,ga,$$],(n,i,s)=>({height:n.height,x:zt(n.x)?n.x:i.left,y:zt(n.y)?n.y:i.top+i.height+i.brushBottom-(s?.bottom||0),width:zt(n.width)?n.width:i.width})),LL={},ML={},UL={},h7;function lbe(){return h7||(h7=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});function i(s,c,{signal:f,edges:p}={}){let v,b=null;const T=p!=null&&p.includes("leading"),w=p==null||p.includes("trailing"),C=()=>{b!==null&&(s.apply(v,b),v=void 0,b=null)},I=()=>{w&&C(),W()};let D=null;const L=()=>{D!=null&&clearTimeout(D),D=setTimeout(()=>{D=null,I()},c)},F=()=>{D!==null&&(clearTimeout(D),D=null)},W=()=>{F(),v=void 0,b=null},G=()=>{C()},$=function(...te){if(f?.aborted)return;v=this,b=te;const Z=D==null;L(),T&&Z&&C()};return $.schedule=L,$.cancel=W,$.flush=G,f?.addEventListener("abort",W,{once:!0}),$}n.debounce=i})(UL)),UL}var f7;function ube(){return f7||(f7=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const i=lbe();function s(c,f=0,p={}){typeof p!="object"&&(p={});const{leading:v=!1,trailing:b=!0,maxWait:T}=p,w=Array(2);v&&(w[0]="leading"),b&&(w[1]="trailing");let C,I=null;const D=i.debounce(function(...W){C=c.apply(this,W),I=null},f,{edges:w}),L=function(...W){return T!=null&&(I===null&&(I=Date.now()),Date.now()-I>=T)?(C=c.apply(this,W),I=Date.now(),D.cancel(),D.schedule(),C):(D.apply(this,W),C)},F=()=>(D.flush(),C);return L.cancel=D.cancel,L.flush=F,L}n.debounce=s})(ML)),ML}var p7;function dbe(){return p7||(p7=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const i=ube();function s(c,f=0,p={}){const{leading:v=!0,trailing:b=!0}=p;return i.debounce(c,f,{leading:v,maxWait:f,trailing:b})}n.throttle=s})(LL)),LL}var jL,m7;function hbe(){return m7||(m7=1,jL=dbe().throttle),jL}var fbe=hbe();const pbe=fd(fbe);var QO=function(i,s){for(var c=arguments.length,f=new Array(c>2?c-2:0),p=2;p<c;p++)f[p-2]=arguments[p]},Q$=(n,i,s)=>{var{width:c="100%",height:f="100%",aspect:p,maxHeight:v}=s,b=cd(c)?n:Number(c),T=cd(f)?i:Number(f);return p&&p>0&&(b?T=b/p:T&&(b=T*p),v&&T>v&&(T=v)),{calculatedWidth:b,calculatedHeight:T}},mbe={width:0,height:0,overflow:"visible"},gbe={width:0,overflowX:"visible"},_be={height:0,overflowY:"visible"},vbe={},ybe=n=>{var{width:i,height:s}=n,c=cd(i),f=cd(s);return c&&f?mbe:c?gbe:f?_be:vbe};function Ebe(n){var{width:i,height:s,aspect:c}=n,f=i,p=s;return f===void 0&&p===void 0?(f="100%",p="100%"):f===void 0?f=c&&c>0?void 0:"100%":p===void 0&&(p=c&&c>0?void 0:"100%"),{width:f,height:p}}function xs(n){return Number.isFinite(n)}function kv(n){return typeof n=="number"&&n>0&&Number.isFinite(n)}function JM(){return JM=Object.assign?Object.assign.bind():function(n){for(var i=1;i<arguments.length;i++){var s=arguments[i];for(var c in s)({}).hasOwnProperty.call(s,c)&&(n[c]=s[c])}return n},JM.apply(null,arguments)}function g7(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(f){return Object.getOwnPropertyDescriptor(n,f).enumerable})),s.push.apply(s,c)}return s}function _7(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?g7(Object(s),!0).forEach(function(c){Sbe(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):g7(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}function Sbe(n,i,s){return(i=bbe(i))in n?Object.defineProperty(n,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[i]=s,n}function bbe(n){var i=Tbe(n,"string");return typeof i=="symbol"?i:i+""}function Tbe(n,i){if(typeof n!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var c=s.call(n,i);if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}var eZ=j.createContext({width:-1,height:-1});function tZ(n){var{children:i,width:s,height:c}=n,f=j.useMemo(()=>({width:s,height:c}),[s,c]);return s<=0||c<=0?null:j.createElement(eZ.Provider,{value:f},i)}var OU=()=>j.useContext(eZ),wbe=j.forwardRef((n,i)=>{var{aspect:s,initialDimension:c={width:-1,height:-1},width:f,height:p,minWidth:v=0,minHeight:b,maxHeight:T,children:w,debounce:C=0,id:I,className:D,onResize:L,style:F={}}=n,W=j.useRef(null),G=j.useRef();G.current=L,j.useImperativeHandle(i,()=>W.current);var[$,te]=j.useState({containerWidth:c.width,containerHeight:c.height}),Z=j.useCallback((ge,Ae)=>{te(ke=>{var Ee=Math.round(ge),be=Math.round(Ae);return ke.containerWidth===Ee&&ke.containerHeight===be?ke:{containerWidth:Ee,containerHeight:be}})},[]);j.useEffect(()=>{var ge=be=>{var Le,{width:et,height:rt}=be[0].contentRect;Z(et,rt),(Le=G.current)===null||Le===void 0||Le.call(G,et,rt)};C>0&&(ge=pbe(ge,C,{trailing:!0,leading:!1}));var Ae=new ResizeObserver(ge),{width:ke,height:Ee}=W.current.getBoundingClientRect();return Z(ke,Ee),Ae.observe(W.current),()=>{Ae.disconnect()}},[Z,C]);var{containerWidth:ce,containerHeight:se}=$;QO(!s||s>0,"The aspect(%s) must be greater than zero.",s);var{calculatedWidth:de,calculatedHeight:oe}=Q$(ce,se,{width:f,height:p,aspect:s,maxHeight:T});return QO(de>0||oe>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,de,oe,f,p,v,b,s),j.createElement("div",{id:I?"".concat(I):void 0,className:Ir("recharts-responsive-container",D),style:_7(_7({},F),{},{width:f,height:p,minWidth:v,minHeight:b,maxHeight:T}),ref:W},j.createElement("div",{style:ybe({width:f,height:p})},j.createElement(tZ,{width:de,height:oe},w)))}),Rbe=j.forwardRef((n,i)=>{var s=OU();if(kv(s.width)&&kv(s.height))return n.children;var{width:c,height:f}=Ebe({width:n.width,height:n.height,aspect:n.aspect}),{calculatedWidth:p,calculatedHeight:v}=Q$(void 0,void 0,{width:c,height:f,aspect:n.aspect,maxHeight:n.maxHeight});return zt(p)&&zt(v)?j.createElement(tZ,{width:p,height:v},n.children):j.createElement(wbe,JM({},n,{width:c,height:f,ref:i}))}),zI=()=>{var n,i=oo(),s=Ft(obe),c=Ft(WI),f=(n=Ft(HI))===null||n===void 0?void 0:n.padding;return!i||!c||!f?s:{width:c.width-f.left-f.right,height:c.height-f.top-f.bottom,x:f.left,y:f.top}},Cbe={top:0,bottom:0,left:0,right:0,width:0,height:0,brushBottom:0},nZ=()=>{var n;return(n=Ft(ga))!==null&&n!==void 0?n:Cbe},rZ=()=>Ft(pd),iZ=()=>Ft(md),Nr=n=>n.layout.layoutType,IU=()=>Ft(Nr),KI=n=>{var i=La(),s=oo(),{width:c,height:f}=n,p=OU(),v=c,b=f;return p&&(v=p.width>0?p.width:c,b=p.height>0?p.height:f),j.useEffect(()=>{!s&&kv(v)&&kv(b)&&i(SSe({width:v,height:b}))},[i,s,v,b]),null},Abe={settings:{layout:"horizontal",align:"center",verticalAlign:"middle",itemSorter:"value"},size:{width:0,height:0},payload:[]},aZ=so({name:"legend",initialState:Abe,reducers:{setLegendSize(n,i){n.size.width=i.payload.width,n.size.height=i.payload.height},setLegendSettings(n,i){n.settings.align=i.payload.align,n.settings.layout=i.payload.layout,n.settings.verticalAlign=i.payload.verticalAlign,n.settings.itemSorter=i.payload.itemSorter},addLegendPayload:{reducer(n,i){n.payload.push(i.payload)},prepare:Za()},removeLegendPayload:{reducer(n,i){var s=nd(n).payload.indexOf(i.payload);s>-1&&n.payload.splice(s,1)},prepare:Za()}}}),{setLegendSize:NPe,setLegendSettings:xPe,addLegendPayload:Obe,removeLegendPayload:Ibe}=aZ.actions,Nbe=aZ.reducer;function $M(){return $M=Object.assign?Object.assign.bind():function(n){for(var i=1;i<arguments.length;i++){var s=arguments[i];for(var c in s)({}).hasOwnProperty.call(s,c)&&(n[c]=s[c])}return n},$M.apply(null,arguments)}function v7(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(f){return Object.getOwnPropertyDescriptor(n,f).enumerable})),s.push.apply(s,c)}return s}function VL(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?v7(Object(s),!0).forEach(function(c){xbe(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):v7(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}function xbe(n,i,s){return(i=Dbe(i))in n?Object.defineProperty(n,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[i]=s,n}function Dbe(n){var i=Pbe(n,"string");return typeof i=="symbol"?i:i+""}function Pbe(n,i){if(typeof n!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var c=s.call(n,i);if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}function kbe(n){return Array.isArray(n)&&Jl(n[0])&&Jl(n[1])?n.join(" ~ "):n}var Lbe=n=>{var{separator:i=" : ",contentStyle:s={},itemStyle:c={},labelStyle:f={},payload:p,formatter:v,itemSorter:b,wrapperClassName:T,labelClassName:w,label:C,labelFormatter:I,accessibilityLayer:D=!1}=n,L=()=>{if(p&&p.length){var se={padding:0,margin:0},de=(b?LI(p,b):p).map((oe,ge)=>{if(oe.type==="none")return null;var Ae=oe.formatter||v||kbe,{value:ke,name:Ee}=oe,be=ke,Le=Ee;if(Ae){var et=Ae(ke,Ee,oe,ge,p);if(Array.isArray(et))[be,Le]=et;else if(et!=null)be=et;else return null}var rt=VL({display:"block",paddingTop:4,paddingBottom:4,color:oe.color||"#000"},c);return j.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(ge),style:rt},Jl(Le)?j.createElement("span",{className:"recharts-tooltip-item-name"},Le):null,Jl(Le)?j.createElement("span",{className:"recharts-tooltip-item-separator"},i):null,j.createElement("span",{className:"recharts-tooltip-item-value"},be),j.createElement("span",{className:"recharts-tooltip-item-unit"},oe.unit||""))});return j.createElement("ul",{className:"recharts-tooltip-item-list",style:se},de)}return null},F=VL({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},s),W=VL({margin:0},f),G=!ta(C),$=G?C:"",te=Ir("recharts-default-tooltip",T),Z=Ir("recharts-tooltip-label",w);G&&I&&p!==void 0&&p!==null&&($=I(C,p));var ce=D?{role:"status","aria-live":"assertive"}:{};return j.createElement("div",$M({className:te,style:F},ce),j.createElement("p",{className:Z,style:W},j.isValidElement($)?$:"".concat($)),L())},US="recharts-tooltip-wrapper",Mbe={visibility:"hidden"};function Ube(n){var{coordinate:i,translateX:s,translateY:c}=n;return Ir(US,{["".concat(US,"-right")]:zt(s)&&i&&zt(i.x)&&s>=i.x,["".concat(US,"-left")]:zt(s)&&i&&zt(i.x)&&s<i.x,["".concat(US,"-bottom")]:zt(c)&&i&&zt(i.y)&&c>=i.y,["".concat(US,"-top")]:zt(c)&&i&&zt(i.y)&&c<i.y})}function y7(n){var{allowEscapeViewBox:i,coordinate:s,key:c,offsetTopLeft:f,position:p,reverseDirection:v,tooltipDimension:b,viewBox:T,viewBoxDimension:w}=n;if(p&&zt(p[c]))return p[c];var C=s[c]-b-(f>0?f:0),I=s[c]+f;if(i[c])return v[c]?C:I;var D=T[c];if(D==null)return 0;if(v[c]){var L=C,F=D;return L<F?Math.max(I,D):Math.max(C,D)}if(w==null)return 0;var W=I+b,G=D+w;return W>G?Math.max(C,D):Math.max(I,D)}function jbe(n){var{translateX:i,translateY:s,useTranslate3d:c}=n;return{transform:c?"translate3d(".concat(i,"px, ").concat(s,"px, 0)"):"translate(".concat(i,"px, ").concat(s,"px)")}}function Vbe(n){var{allowEscapeViewBox:i,coordinate:s,offsetTopLeft:c,position:f,reverseDirection:p,tooltipBox:v,useTranslate3d:b,viewBox:T}=n,w,C,I;return v.height>0&&v.width>0&&s?(C=y7({allowEscapeViewBox:i,coordinate:s,key:"x",offsetTopLeft:c,position:f,reverseDirection:p,tooltipDimension:v.width,viewBox:T,viewBoxDimension:T.width}),I=y7({allowEscapeViewBox:i,coordinate:s,key:"y",offsetTopLeft:c,position:f,reverseDirection:p,tooltipDimension:v.height,viewBox:T,viewBoxDimension:T.height}),w=jbe({translateX:C,translateY:I,useTranslate3d:b})):w=Mbe,{cssProperties:w,cssClasses:Ube({translateX:C,translateY:I,coordinate:s})}}function E7(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(f){return Object.getOwnPropertyDescriptor(n,f).enumerable})),s.push.apply(s,c)}return s}function fO(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?E7(Object(s),!0).forEach(function(c){ZM(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):E7(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}function ZM(n,i,s){return(i=Bbe(i))in n?Object.defineProperty(n,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[i]=s,n}function Bbe(n){var i=Fbe(n,"string");return typeof i=="symbol"?i:i+""}function Fbe(n,i){if(typeof n!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var c=s.call(n,i);if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}class Gbe extends j.PureComponent{constructor(){super(...arguments),ZM(this,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0}}),ZM(this,"handleKeyDown",i=>{if(i.key==="Escape"){var s,c,f,p;this.setState({dismissed:!0,dismissedAtCoordinate:{x:(s=(c=this.props.coordinate)===null||c===void 0?void 0:c.x)!==null&&s!==void 0?s:0,y:(f=(p=this.props.coordinate)===null||p===void 0?void 0:p.y)!==null&&f!==void 0?f:0}})}})}componentDidMount(){document.addEventListener("keydown",this.handleKeyDown)}componentWillUnmount(){document.removeEventListener("keydown",this.handleKeyDown)}componentDidUpdate(){var i,s;this.state.dismissed&&(((i=this.props.coordinate)===null||i===void 0?void 0:i.x)!==this.state.dismissedAtCoordinate.x||((s=this.props.coordinate)===null||s===void 0?void 0:s.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}render(){var{active:i,allowEscapeViewBox:s,animationDuration:c,animationEasing:f,children:p,coordinate:v,hasPayload:b,isAnimationActive:T,offset:w,position:C,reverseDirection:I,useTranslate3d:D,viewBox:L,wrapperStyle:F,lastBoundingBox:W,innerRef:G,hasPortalFromProps:$}=this.props,{cssClasses:te,cssProperties:Z}=Vbe({allowEscapeViewBox:s,coordinate:v,offsetTopLeft:w,position:C,reverseDirection:I,tooltipBox:{height:W.height,width:W.width},useTranslate3d:D,viewBox:L}),ce=$?{}:fO(fO({transition:T&&i?"transform ".concat(c,"ms ").concat(f):void 0},Z),{},{pointerEvents:"none",visibility:!this.state.dismissed&&i&&b?"visible":"hidden",position:"absolute",top:0,left:0}),se=fO(fO({},ce),{},{visibility:!this.state.dismissed&&i&&b?"visible":"hidden"},F);return j.createElement("div",{xmlns:"http://www.w3.org/1999/xhtml",tabIndex:-1,className:te,style:se,ref:G},p)}}var Hbe=()=>!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout),Yv={devToolsEnabled:!1,isSsr:Hbe()},sZ=()=>Ft(n=>n.rootProps.accessibilityLayer);function QM(){return QM=Object.assign?Object.assign.bind():function(n){for(var i=1;i<arguments.length;i++){var s=arguments[i];for(var c in s)({}).hasOwnProperty.call(s,c)&&(n[c]=s[c])}return n},QM.apply(null,arguments)}function S7(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(f){return Object.getOwnPropertyDescriptor(n,f).enumerable})),s.push.apply(s,c)}return s}function b7(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?S7(Object(s),!0).forEach(function(c){Wbe(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):S7(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}function Wbe(n,i,s){return(i=zbe(i))in n?Object.defineProperty(n,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[i]=s,n}function zbe(n){var i=Kbe(n,"string");return typeof i=="symbol"?i:i+""}function Kbe(n,i){if(typeof n!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var c=s.call(n,i);if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}var T7={curveBasisClosed:hEe,curveBasisOpen:fEe,curveBasis:dEe,curveBumpX:lEe,curveBumpY:uEe,curveLinearClosed:pEe,curveLinear:DI,curveMonotoneX:mEe,curveMonotoneY:gEe,curveNatural:_Ee,curveStep:vEe,curveStepAfter:EEe,curveStepBefore:yEe},pO=n=>xs(n.x)&&xs(n.y),jS=n=>n.x,VS=n=>n.y,Ybe=(n,i)=>{if(typeof n=="function")return n;var s="curve".concat(yU(n));return(s==="curveMonotone"||s==="curveBump")&&i?T7["".concat(s).concat(i==="vertical"?"Y":"X")]:T7[s]||DI},qbe=n=>{var{type:i="linear",points:s=[],baseLine:c,layout:f,connectNulls:p=!1}=n,v=Ybe(i,f),b=p?s.filter(pO):s,T;if(Array.isArray(c)){var w=p?c.filter(I=>pO(I)):c,C=b.map((I,D)=>b7(b7({},I),{},{base:w[D]}));return f==="vertical"?T=sO().y(VS).x1(jS).x0(I=>I.base.x):T=sO().x(jS).y1(VS).y0(I=>I.base.y),T.defined(pO).curve(v),T(C)}return f==="vertical"&&zt(c)?T=sO().y(VS).x1(jS).x0(c):zt(c)?T=sO().x(jS).y1(VS).y0(c):T=JJ().x(jS).y(VS),T.defined(pO).curve(v),T(b)},oZ=n=>{var{className:i,points:s,path:c,pathRef:f}=n;if((!s||!s.length)&&!c)return null;var p=s&&s.length?qbe(n):c;return j.createElement("path",QM({},Xl(n),EU(n),{className:Ir("recharts-curve",i),d:p===null?void 0:p,ref:f}))},Xbe=["x","y","top","left","width","height","className"];function e2(){return e2=Object.assign?Object.assign.bind():function(n){for(var i=1;i<arguments.length;i++){var s=arguments[i];for(var c in s)({}).hasOwnProperty.call(s,c)&&(n[c]=s[c])}return n},e2.apply(null,arguments)}function w7(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(f){return Object.getOwnPropertyDescriptor(n,f).enumerable})),s.push.apply(s,c)}return s}function Jbe(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?w7(Object(s),!0).forEach(function(c){$be(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):w7(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}function $be(n,i,s){return(i=Zbe(i))in n?Object.defineProperty(n,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[i]=s,n}function Zbe(n){var i=Qbe(n,"string");return typeof i=="symbol"?i:i+""}function Qbe(n,i){if(typeof n!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var c=s.call(n,i);if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}function eTe(n,i){if(n==null)return{};var s,c,f=tTe(n,i);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);for(c=0;c<p.length;c++)s=p[c],i.indexOf(s)===-1&&{}.propertyIsEnumerable.call(n,s)&&(f[s]=n[s])}return f}function tTe(n,i){if(n==null)return{};var s={};for(var c in n)if({}.hasOwnProperty.call(n,c)){if(i.indexOf(c)!==-1)continue;s[c]=n[c]}return s}var nTe=(n,i,s,c,f,p)=>"M".concat(n,",").concat(f,"v").concat(c,"M").concat(p,",").concat(i,"h").concat(s),rTe=n=>{var{x:i=0,y:s=0,top:c=0,left:f=0,width:p=0,height:v=0,className:b}=n,T=eTe(n,Xbe),w=Jbe({x:i,y:s,top:c,left:f,width:p,height:v},T);return!zt(i)||!zt(s)||!zt(p)||!zt(v)||!zt(c)||!zt(f)?null:j.createElement("path",e2({},qo(w),{className:Ir("recharts-cross",b),d:nTe(i,s,p,v,c,f)}))};function iTe(n,i,s,c){var f=c/2;return{stroke:"none",fill:"#ccc",x:n==="horizontal"?i.x-f:s.left+.5,y:n==="horizontal"?s.top+.5:i.y-f,width:n==="horizontal"?c:s.width-1,height:n==="horizontal"?s.height-1:c}}function R7(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(f){return Object.getOwnPropertyDescriptor(n,f).enumerable})),s.push.apply(s,c)}return s}function aTe(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?R7(Object(s),!0).forEach(function(c){sTe(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):R7(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}function sTe(n,i,s){return(i=oTe(i))in n?Object.defineProperty(n,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[i]=s,n}function oTe(n){var i=cTe(n,"string");return typeof i=="symbol"?i:i+""}function cTe(n,i){if(typeof n!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var c=s.call(n,i);if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}function $o(n,i){var s=aTe({},n),c=i,f=Object.keys(i),p=f.reduce((v,b)=>(v[b]===void 0&&c[b]!==void 0&&(v[b]=c[b]),v),s);return p}function lTe(){}function uTe(n){return n!=null}function C7(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(f){return Object.getOwnPropertyDescriptor(n,f).enumerable})),s.push.apply(s,c)}return s}function A7(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?C7(Object(s),!0).forEach(function(c){dTe(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):C7(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}function dTe(n,i,s){return(i=hTe(i))in n?Object.defineProperty(n,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[i]=s,n}function hTe(n){var i=fTe(n,"string");return typeof i=="symbol"?i:i+""}function fTe(n,i){if(typeof n!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var c=s.call(n,i);if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}var pTe=n=>n.replace(/([A-Z])/g,i=>"-".concat(i.toLowerCase())),mTe=(n,i,s)=>n.map(c=>"".concat(pTe(c)," ").concat(i,"ms ").concat(s)).join(","),gTe=(n,i)=>[Object.keys(n),Object.keys(i)].reduce((s,c)=>s.filter(f=>c.includes(f))),pb=(n,i)=>Object.keys(i).reduce((s,c)=>A7(A7({},s),{},{[c]:n(c,i[c])}),{});function O7(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(f){return Object.getOwnPropertyDescriptor(n,f).enumerable})),s.push.apply(s,c)}return s}function pa(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?O7(Object(s),!0).forEach(function(c){_Te(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):O7(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}function _Te(n,i,s){return(i=vTe(i))in n?Object.defineProperty(n,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[i]=s,n}function vTe(n){var i=yTe(n,"string");return typeof i=="symbol"?i:i+""}function yTe(n,i){if(typeof n!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var c=s.call(n,i);if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}var eI=(n,i,s)=>n+(i-n)*s,t2=n=>{var{from:i,to:s}=n;return i!==s},cZ=(n,i,s)=>{var c=pb((f,p)=>{if(t2(p)){var[v,b]=n(p.from,p.to,p.velocity);return pa(pa({},p),{},{from:v,velocity:b})}return p},i);return s<1?pb((f,p)=>t2(p)?pa(pa({},p),{},{velocity:eI(p.velocity,c[f].velocity,s),from:eI(p.from,c[f].from,s)}):p,i):cZ(n,c,s-1)};function ETe(n,i,s,c,f,p){var v,b=c.reduce((D,L)=>pa(pa({},D),{},{[L]:{from:n[L],velocity:0,to:i[L]}}),{}),T=()=>pb((D,L)=>L.from,b),w=()=>!Object.values(b).filter(t2).length,C=null,I=D=>{v||(v=D);var L=D-v,F=L/s.dt;b=cZ(s,b,F),f(pa(pa(pa({},n),i),T())),v=D,w()||(C=p.setTimeout(I))};return()=>(C=p.setTimeout(I),()=>{C()})}function STe(n,i,s,c,f,p,v){var b=null,T=f.reduce((I,D)=>pa(pa({},I),{},{[D]:[n[D],i[D]]}),{}),w,C=I=>{w||(w=I);var D=(I-w)/c,L=pb((W,G)=>eI(...G,s(D)),T);if(p(pa(pa(pa({},n),i),L)),D<1)b=v.setTimeout(C);else{var F=pb((W,G)=>eI(...G,s(1)),T);p(pa(pa(pa({},n),i),F))}};return()=>(b=v.setTimeout(C),()=>{b()})}const bTe=(n,i,s,c,f,p)=>{var v=gTe(n,i);return s.isStepper===!0?ETe(n,i,s,v,f,p):STe(n,i,s,c,v,f,p)};var tI=1e-4,lZ=(n,i)=>[0,3*n,3*i-6*n,3*n-3*i+1],uZ=(n,i)=>n.map((s,c)=>s*i**c).reduce((s,c)=>s+c),I7=(n,i)=>s=>{var c=lZ(n,i);return uZ(c,s)},TTe=(n,i)=>s=>{var c=lZ(n,i),f=[...c.map((p,v)=>p*v).slice(1),0];return uZ(f,s)},N7=function(){for(var i,s,c,f,p=arguments.length,v=new Array(p),b=0;b<p;b++)v[b]=arguments[b];if(v.length===1)switch(v[0]){case"linear":[i,c,s,f]=[0,0,1,1];break;case"ease":[i,c,s,f]=[.25,.1,.25,1];break;case"ease-in":[i,c,s,f]=[.42,0,1,1];break;case"ease-out":[i,c,s,f]=[.42,0,.58,1];break;case"ease-in-out":[i,c,s,f]=[0,0,.58,1];break;default:{var T=v[0].split("(");T[0]==="cubic-bezier"&&T[1].split(")")[0].split(",").length===4&&([i,c,s,f]=T[1].split(")")[0].split(",").map(F=>parseFloat(F)))}}else v.length===4&&([i,c,s,f]=v);var w=I7(i,s),C=I7(c,f),I=TTe(i,s),D=F=>F>1?1:F<0?0:F,L=F=>{for(var W=F>1?1:F,G=W,$=0;$<8;++$){var te=w(G)-W,Z=I(G);if(Math.abs(te-W)<tI||Z<tI)return C(G);G=D(G-te/Z)}return C(G)};return L.isStepper=!1,L},wTe=function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{stiff:s=100,damping:c=8,dt:f=17}=i,p=(v,b,T)=>{var w=-(v-b)*s,C=T*c,I=T+(w-C)*f/1e3,D=T*f/1e3+v;return Math.abs(D-b)<tI&&Math.abs(I)<tI?[b,0]:[D,I]};return p.isStepper=!0,p.dt=f,p},RTe=n=>{if(typeof n=="string")switch(n){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return N7(n);case"spring":return wTe();default:if(n.split("(")[0]==="cubic-bezier")return N7(n)}return typeof n=="function"?n:null};function CTe(n){var i,s=()=>null,c=!1,f=null,p=v=>{if(!c){if(Array.isArray(v)){if(!v.length)return;var b=v,[T,...w]=b;if(typeof T=="number"){f=n.setTimeout(p.bind(null,w),T);return}p(T),f=n.setTimeout(p.bind(null,w));return}typeof v=="string"&&(i=v,s(i)),typeof v=="object"&&(i=v,s(i)),typeof v=="function"&&v()}};return{stop:()=>{c=!0},start:v=>{c=!1,f&&(f(),f=null),p(v)},subscribe:v=>(s=v,()=>{s=()=>null}),getTimeoutController:()=>n}}class ATe{setTimeout(i){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,c=performance.now(),f=null,p=v=>{v-c>=s?i(v):typeof requestAnimationFrame=="function"&&(f=requestAnimationFrame(p))};return f=requestAnimationFrame(p),()=>{cancelAnimationFrame(f)}}}function OTe(){return CTe(new ATe)}var ITe=j.createContext(OTe);function NTe(n,i){var s=j.useContext(ITe);return j.useMemo(()=>i??s(n),[n,i,s])}var xTe={begin:0,duration:1e3,easing:"ease",isActive:!0,canBegin:!0,onAnimationEnd:()=>{},onAnimationStart:()=>{}},x7={t:0},BL={t:1};function dZ(n){var i=$o(n,xTe),{isActive:s,canBegin:c,duration:f,easing:p,begin:v,onAnimationEnd:b,onAnimationStart:T,children:w}=i,C=NTe(i.animationId,i.animationManager),[I,D]=j.useState(s?x7:BL),L=j.useRef(null);return j.useEffect(()=>{s||D(BL)},[s]),j.useEffect(()=>{if(!s||!c)return lTe;var F=bTe(x7,BL,RTe(p),f,D,C.getTimeoutController()),W=()=>{L.current=F()};return C.start([T,v,W,f,b]),()=>{C.stop(),L.current&&L.current(),b()}},[s,c,f,p,v,T,b,C]),w(I.t)}function hZ(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"animation-",s=j.useRef(ub(i)),c=j.useRef(n);return c.current!==n&&(s.current=ub(i),c.current=n),s.current}var DTe=["radius"],PTe=["radius"];function D7(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(f){return Object.getOwnPropertyDescriptor(n,f).enumerable})),s.push.apply(s,c)}return s}function P7(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?D7(Object(s),!0).forEach(function(c){kTe(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):D7(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}function kTe(n,i,s){return(i=LTe(i))in n?Object.defineProperty(n,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[i]=s,n}function LTe(n){var i=MTe(n,"string");return typeof i=="symbol"?i:i+""}function MTe(n,i){if(typeof n!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var c=s.call(n,i);if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}function nI(){return nI=Object.assign?Object.assign.bind():function(n){for(var i=1;i<arguments.length;i++){var s=arguments[i];for(var c in s)({}).hasOwnProperty.call(s,c)&&(n[c]=s[c])}return n},nI.apply(null,arguments)}function k7(n,i){if(n==null)return{};var s,c,f=UTe(n,i);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);for(c=0;c<p.length;c++)s=p[c],i.indexOf(s)===-1&&{}.propertyIsEnumerable.call(n,s)&&(f[s]=n[s])}return f}function UTe(n,i){if(n==null)return{};var s={};for(var c in n)if({}.hasOwnProperty.call(n,c)){if(i.indexOf(c)!==-1)continue;s[c]=n[c]}return s}var L7=(n,i,s,c,f)=>{var p=Math.min(Math.abs(s)/2,Math.abs(c)/2),v=c>=0?1:-1,b=s>=0?1:-1,T=c>=0&&s>=0||c<0&&s<0?1:0,w;if(p>0&&f instanceof Array){for(var C=[0,0,0,0],I=0,D=4;I<D;I++)C[I]=f[I]>p?p:f[I];w="M".concat(n,",").concat(i+v*C[0]),C[0]>0&&(w+="A ".concat(C[0],",").concat(C[0],",0,0,").concat(T,",").concat(n+b*C[0],",").concat(i)),w+="L ".concat(n+s-b*C[1],",").concat(i),C[1]>0&&(w+="A ".concat(C[1],",").concat(C[1],",0,0,").concat(T,`,
        `).concat(n+s,",").concat(i+v*C[1])),w+="L ".concat(n+s,",").concat(i+c-v*C[2]),C[2]>0&&(w+="A ".concat(C[2],",").concat(C[2],",0,0,").concat(T,`,
        `).concat(n+s-b*C[2],",").concat(i+c)),w+="L ".concat(n+b*C[3],",").concat(i+c),C[3]>0&&(w+="A ".concat(C[3],",").concat(C[3],",0,0,").concat(T,`,
        `).concat(n,",").concat(i+c-v*C[3])),w+="Z"}else if(p>0&&f===+f&&f>0){var L=Math.min(p,f);w="M ".concat(n,",").concat(i+v*L,`
            A `).concat(L,",").concat(L,",0,0,").concat(T,",").concat(n+b*L,",").concat(i,`
            L `).concat(n+s-b*L,",").concat(i,`
            A `).concat(L,",").concat(L,",0,0,").concat(T,",").concat(n+s,",").concat(i+v*L,`
            L `).concat(n+s,",").concat(i+c-v*L,`
            A `).concat(L,",").concat(L,",0,0,").concat(T,",").concat(n+s-b*L,",").concat(i+c,`
            L `).concat(n+b*L,",").concat(i+c,`
            A `).concat(L,",").concat(L,",0,0,").concat(T,",").concat(n,",").concat(i+c-v*L," Z")}else w="M ".concat(n,",").concat(i," h ").concat(s," v ").concat(c," h ").concat(-s," Z");return w},jTe={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},VTe=n=>{var i=$o(n,jTe),s=j.useRef(null),[c,f]=j.useState(-1);j.useEffect(()=>{if(s.current&&s.current.getTotalLength)try{var _e=s.current.getTotalLength();_e&&f(_e)}catch{}},[]);var{x:p,y:v,width:b,height:T,radius:w,className:C}=i,{animationEasing:I,animationDuration:D,animationBegin:L,isAnimationActive:F,isUpdateAnimationActive:W}=i,G=j.useRef(b),$=j.useRef(T),te=j.useRef(p),Z=j.useRef(v),ce=j.useMemo(()=>({x:p,y:v,width:b,height:T,radius:w}),[p,v,b,T,w]),se=hZ(ce,"rectangle-");if(p!==+p||v!==+v||b!==+b||T!==+T||b===0||T===0)return null;var de=Ir("recharts-rectangle",C);if(!W){var oe=qo(i),{radius:ge}=oe,Ae=k7(oe,DTe);return j.createElement("path",nI({},Ae,{radius:typeof w=="number"?w:void 0,className:de,d:L7(p,v,b,T,w)}))}var ke=G.current,Ee=$.current,be=te.current,Le=Z.current,et="0px ".concat(c===-1?1:c,"px"),rt="".concat(c,"px 0px"),he=mTe(["strokeDasharray"],D,typeof I=="string"?I:void 0);return j.createElement(dZ,{animationId:se,key:se,canBegin:c>0,duration:D,easing:I,isActive:W,begin:L},_e=>{var ze=Ju(ke,b,_e),tt=Ju(Ee,T,_e),ut=Ju(be,p,_e),me=Ju(Le,v,_e);s.current&&(G.current=ze,$.current=tt,te.current=ut,Z.current=me);var Ve;F?_e>0?Ve={transition:he,strokeDasharray:rt}:Ve={strokeDasharray:et}:Ve={strokeDasharray:rt};var it=qo(i),{radius:dt}=it,Ct=k7(it,PTe);return j.createElement("path",nI({},Ct,{radius:typeof w=="number"?w:void 0,className:de,d:L7(ut,me,ze,tt,w),ref:s,style:P7(P7({},Ve),i.style)}))})};function fZ(n){var{cx:i,cy:s,radius:c,startAngle:f,endAngle:p}=n,v=ma(i,s,c,f),b=ma(i,s,c,p);return{points:[v,b],cx:i,cy:s,radius:c,startAngle:f,endAngle:p}}function n2(){return n2=Object.assign?Object.assign.bind():function(n){for(var i=1;i<arguments.length;i++){var s=arguments[i];for(var c in s)({}).hasOwnProperty.call(s,c)&&(n[c]=s[c])}return n},n2.apply(null,arguments)}var BTe=(n,i)=>{var s=Wo(i-n),c=Math.min(Math.abs(i-n),359.999);return s*c},mO=n=>{var{cx:i,cy:s,radius:c,angle:f,sign:p,isExternal:v,cornerRadius:b,cornerIsExternal:T}=n,w=b*(v?1:-1)+c,C=Math.asin(b/w)/ZO,I=T?f:f+p*C,D=ma(i,s,w,I),L=ma(i,s,c,I),F=T?f-p*C:f,W=ma(i,s,w*Math.cos(C*ZO),F);return{center:D,circleTangency:L,lineTangency:W,theta:C}},pZ=n=>{var{cx:i,cy:s,innerRadius:c,outerRadius:f,startAngle:p,endAngle:v}=n,b=BTe(p,v),T=p+b,w=ma(i,s,f,p),C=ma(i,s,f,T),I="M ".concat(w.x,",").concat(w.y,`
    A `).concat(f,",").concat(f,`,0,
    `).concat(+(Math.abs(b)>180),",").concat(+(p>T),`,
    `).concat(C.x,",").concat(C.y,`
  `);if(c>0){var D=ma(i,s,c,p),L=ma(i,s,c,T);I+="L ".concat(L.x,",").concat(L.y,`
            A `).concat(c,",").concat(c,`,0,
            `).concat(+(Math.abs(b)>180),",").concat(+(p<=T),`,
            `).concat(D.x,",").concat(D.y," Z")}else I+="L ".concat(i,",").concat(s," Z");return I},FTe=n=>{var{cx:i,cy:s,innerRadius:c,outerRadius:f,cornerRadius:p,forceCornerRadius:v,cornerIsExternal:b,startAngle:T,endAngle:w}=n,C=Wo(w-T),{circleTangency:I,lineTangency:D,theta:L}=mO({cx:i,cy:s,radius:f,angle:T,sign:C,cornerRadius:p,cornerIsExternal:b}),{circleTangency:F,lineTangency:W,theta:G}=mO({cx:i,cy:s,radius:f,angle:w,sign:-C,cornerRadius:p,cornerIsExternal:b}),$=b?Math.abs(T-w):Math.abs(T-w)-L-G;if($<0)return v?"M ".concat(D.x,",").concat(D.y,`
        a`).concat(p,",").concat(p,",0,0,1,").concat(p*2,`,0
        a`).concat(p,",").concat(p,",0,0,1,").concat(-p*2,`,0
      `):pZ({cx:i,cy:s,innerRadius:c,outerRadius:f,startAngle:T,endAngle:w});var te="M ".concat(D.x,",").concat(D.y,`
    A`).concat(p,",").concat(p,",0,0,").concat(+(C<0),",").concat(I.x,",").concat(I.y,`
    A`).concat(f,",").concat(f,",0,").concat(+($>180),",").concat(+(C<0),",").concat(F.x,",").concat(F.y,`
    A`).concat(p,",").concat(p,",0,0,").concat(+(C<0),",").concat(W.x,",").concat(W.y,`
  `);if(c>0){var{circleTangency:Z,lineTangency:ce,theta:se}=mO({cx:i,cy:s,radius:c,angle:T,sign:C,isExternal:!0,cornerRadius:p,cornerIsExternal:b}),{circleTangency:de,lineTangency:oe,theta:ge}=mO({cx:i,cy:s,radius:c,angle:w,sign:-C,isExternal:!0,cornerRadius:p,cornerIsExternal:b}),Ae=b?Math.abs(T-w):Math.abs(T-w)-se-ge;if(Ae<0&&p===0)return"".concat(te,"L").concat(i,",").concat(s,"Z");te+="L".concat(oe.x,",").concat(oe.y,`
      A`).concat(p,",").concat(p,",0,0,").concat(+(C<0),",").concat(de.x,",").concat(de.y,`
      A`).concat(c,",").concat(c,",0,").concat(+(Ae>180),",").concat(+(C>0),",").concat(Z.x,",").concat(Z.y,`
      A`).concat(p,",").concat(p,",0,0,").concat(+(C<0),",").concat(ce.x,",").concat(ce.y,"Z")}else te+="L".concat(i,",").concat(s,"Z");return te},GTe={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},HTe=n=>{var i=$o(n,GTe),{cx:s,cy:c,innerRadius:f,outerRadius:p,cornerRadius:v,forceCornerRadius:b,cornerIsExternal:T,startAngle:w,endAngle:C,className:I}=i;if(p<f||w===C)return null;var D=Ir("recharts-sector",I),L=p-f,F=cf(v,L,0,!0),W;return F>0&&Math.abs(w-C)<360?W=FTe({cx:s,cy:c,innerRadius:f,outerRadius:p,cornerRadius:Math.min(F,L/2),forceCornerRadius:b,cornerIsExternal:T,startAngle:w,endAngle:C}):W=pZ({cx:s,cy:c,innerRadius:f,outerRadius:p,startAngle:w,endAngle:C}),j.createElement("path",n2({},qo(i),{className:D,d:W}))};function WTe(n,i,s){var c,f,p,v;if(n==="horizontal")c=i.x,p=c,f=s.top,v=s.top+s.height;else if(n==="vertical")f=i.y,v=f,c=s.left,p=s.left+s.width;else if(i.cx!=null&&i.cy!=null)if(n==="centric"){var{cx:b,cy:T,innerRadius:w,outerRadius:C,angle:I}=i,D=ma(b,T,w,I),L=ma(b,T,C,I);c=D.x,f=D.y,p=L.x,v=L.y}else return fZ(i);return[{x:c,y:f},{x:p,y:v}]}var FL={},GL={},HL={},M7;function zTe(){return M7||(M7=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const i=v$();function s(c){return i.isSymbol(c)?NaN:Number(c)}n.toNumber=s})(HL)),HL}var U7;function KTe(){return U7||(U7=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const i=zTe();function s(c){return c?(c=i.toNumber(c),c===1/0||c===-1/0?(c<0?-1:1)*Number.MAX_VALUE:c===c?c:0):c===0?c:0}n.toFinite=s})(GL)),GL}var j7;function YTe(){return j7||(j7=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const i=y$(),s=KTe();function c(f,p,v){v&&typeof v!="number"&&i.isIterateeCall(f,p,v)&&(p=v=void 0),f=s.toFinite(f),p===void 0?(p=f,f=0):p=s.toFinite(p),v=v===void 0?f<p?1:-1:s.toFinite(v);const b=Math.max(Math.ceil((p-f)/(v||1)),0),T=new Array(b);for(let w=0;w<b;w++)T[w]=f,f+=v;return T}n.range=c})(FL)),FL}var WL,V7;function qTe(){return V7||(V7=1,WL=YTe().range),WL}var XTe=qTe();const mZ=fd(XTe);function sf(n,i){return n==null||i==null?NaN:n<i?-1:n>i?1:n>=i?0:NaN}function JTe(n,i){return n==null||i==null?NaN:i<n?-1:i>n?1:i>=n?0:NaN}function NU(n){let i,s,c;n.length!==2?(i=sf,s=(b,T)=>sf(n(b),T),c=(b,T)=>n(b)-T):(i=n===sf||n===JTe?n:$Te,s=n,c=n);function f(b,T,w=0,C=b.length){if(w<C){if(i(T,T)!==0)return C;do{const I=w+C>>>1;s(b[I],T)<0?w=I+1:C=I}while(w<C)}return w}function p(b,T,w=0,C=b.length){if(w<C){if(i(T,T)!==0)return C;do{const I=w+C>>>1;s(b[I],T)<=0?w=I+1:C=I}while(w<C)}return w}function v(b,T,w=0,C=b.length){const I=f(b,T,w,C-1);return I>w&&c(b[I-1],T)>-c(b[I],T)?I-1:I}return{left:f,center:v,right:p}}function $Te(){return 0}function gZ(n){return n===null?NaN:+n}function*ZTe(n,i){for(let s of n)s!=null&&(s=+s)>=s&&(yield s)}const QTe=NU(sf),kb=QTe.right;NU(gZ).center;class B7 extends Map{constructor(i,s=nwe){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:s}}),i!=null)for(const[c,f]of i)this.set(c,f)}get(i){return super.get(F7(this,i))}has(i){return super.has(F7(this,i))}set(i,s){return super.set(ewe(this,i),s)}delete(i){return super.delete(twe(this,i))}}function F7({_intern:n,_key:i},s){const c=i(s);return n.has(c)?n.get(c):s}function ewe({_intern:n,_key:i},s){const c=i(s);return n.has(c)?n.get(c):(n.set(c,s),s)}function twe({_intern:n,_key:i},s){const c=i(s);return n.has(c)&&(s=n.get(c),n.delete(c)),s}function nwe(n){return n!==null&&typeof n=="object"?n.valueOf():n}function rwe(n=sf){if(n===sf)return _Z;if(typeof n!="function")throw new TypeError("compare is not a function");return(i,s)=>{const c=n(i,s);return c||c===0?c:(n(s,s)===0)-(n(i,i)===0)}}function _Z(n,i){return(n==null||!(n>=n))-(i==null||!(i>=i))||(n<i?-1:n>i?1:0)}const iwe=Math.sqrt(50),awe=Math.sqrt(10),swe=Math.sqrt(2);function rI(n,i,s){const c=(i-n)/Math.max(0,s),f=Math.floor(Math.log10(c)),p=c/Math.pow(10,f),v=p>=iwe?10:p>=awe?5:p>=swe?2:1;let b,T,w;return f<0?(w=Math.pow(10,-f)/v,b=Math.round(n*w),T=Math.round(i*w),b/w<n&&++b,T/w>i&&--T,w=-w):(w=Math.pow(10,f)*v,b=Math.round(n/w),T=Math.round(i/w),b*w<n&&++b,T*w>i&&--T),T<b&&.5<=s&&s<2?rI(n,i,s*2):[b,T,w]}function r2(n,i,s){if(i=+i,n=+n,s=+s,!(s>0))return[];if(n===i)return[n];const c=i<n,[f,p,v]=c?rI(i,n,s):rI(n,i,s);if(!(p>=f))return[];const b=p-f+1,T=new Array(b);if(c)if(v<0)for(let w=0;w<b;++w)T[w]=(p-w)/-v;else for(let w=0;w<b;++w)T[w]=(p-w)*v;else if(v<0)for(let w=0;w<b;++w)T[w]=(f+w)/-v;else for(let w=0;w<b;++w)T[w]=(f+w)*v;return T}function i2(n,i,s){return i=+i,n=+n,s=+s,rI(n,i,s)[2]}function a2(n,i,s){i=+i,n=+n,s=+s;const c=i<n,f=c?i2(i,n,s):i2(n,i,s);return(c?-1:1)*(f<0?1/-f:f)}function G7(n,i){let s;for(const c of n)c!=null&&(s<c||s===void 0&&c>=c)&&(s=c);return s}function H7(n,i){let s;for(const c of n)c!=null&&(s>c||s===void 0&&c>=c)&&(s=c);return s}function vZ(n,i,s=0,c=1/0,f){if(i=Math.floor(i),s=Math.floor(Math.max(0,s)),c=Math.floor(Math.min(n.length-1,c)),!(s<=i&&i<=c))return n;for(f=f===void 0?_Z:rwe(f);c>s;){if(c-s>600){const T=c-s+1,w=i-s+1,C=Math.log(T),I=.5*Math.exp(2*C/3),D=.5*Math.sqrt(C*I*(T-I)/T)*(w-T/2<0?-1:1),L=Math.max(s,Math.floor(i-w*I/T+D)),F=Math.min(c,Math.floor(i+(T-w)*I/T+D));vZ(n,i,L,F,f)}const p=n[i];let v=s,b=c;for(BS(n,s,i),f(n[c],p)>0&&BS(n,s,c);v<b;){for(BS(n,v,b),++v,--b;f(n[v],p)<0;)++v;for(;f(n[b],p)>0;)--b}f(n[s],p)===0?BS(n,s,b):(++b,BS(n,b,c)),b<=i&&(s=b+1),i<=b&&(c=b-1)}return n}function BS(n,i,s){const c=n[i];n[i]=n[s],n[s]=c}function owe(n,i,s){if(n=Float64Array.from(ZTe(n)),!(!(c=n.length)||isNaN(i=+i))){if(i<=0||c<2)return H7(n);if(i>=1)return G7(n);var c,f=(c-1)*i,p=Math.floor(f),v=G7(vZ(n,p).subarray(0,p+1)),b=H7(n.subarray(p+1));return v+(b-v)*(f-p)}}function cwe(n,i,s=gZ){if(!(!(c=n.length)||isNaN(i=+i))){if(i<=0||c<2)return+s(n[0],0,n);if(i>=1)return+s(n[c-1],c-1,n);var c,f=(c-1)*i,p=Math.floor(f),v=+s(n[p],p,n),b=+s(n[p+1],p+1,n);return v+(b-v)*(f-p)}}function lwe(n,i,s){n=+n,i=+i,s=(f=arguments.length)<2?(i=n,n=0,1):f<3?1:+s;for(var c=-1,f=Math.max(0,Math.ceil((i-n)/s))|0,p=new Array(f);++c<f;)p[c]=n+c*s;return p}function Zo(n,i){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(i).domain(n);break}return this}function gd(n,i){switch(arguments.length){case 0:break;case 1:{typeof n=="function"?this.interpolator(n):this.range(n);break}default:{this.domain(n),typeof i=="function"?this.interpolator(i):this.range(i);break}}return this}const s2=Symbol("implicit");function xU(){var n=new B7,i=[],s=[],c=s2;function f(p){let v=n.get(p);if(v===void 0){if(c!==s2)return c;n.set(p,v=i.push(p)-1)}return s[v%s.length]}return f.domain=function(p){if(!arguments.length)return i.slice();i=[],n=new B7;for(const v of p)n.has(v)||n.set(v,i.push(v)-1);return f},f.range=function(p){return arguments.length?(s=Array.from(p),f):s.slice()},f.unknown=function(p){return arguments.length?(c=p,f):c},f.copy=function(){return xU(i,s).unknown(c)},Zo.apply(f,arguments),f}function DU(){var n=xU().unknown(void 0),i=n.domain,s=n.range,c=0,f=1,p,v,b=!1,T=0,w=0,C=.5;delete n.unknown;function I(){var D=i().length,L=f<c,F=L?f:c,W=L?c:f;p=(W-F)/Math.max(1,D-T+w*2),b&&(p=Math.floor(p)),F+=(W-F-p*(D-T))*C,v=p*(1-T),b&&(F=Math.round(F),v=Math.round(v));var G=lwe(D).map(function($){return F+p*$});return s(L?G.reverse():G)}return n.domain=function(D){return arguments.length?(i(D),I()):i()},n.range=function(D){return arguments.length?([c,f]=D,c=+c,f=+f,I()):[c,f]},n.rangeRound=function(D){return[c,f]=D,c=+c,f=+f,b=!0,I()},n.bandwidth=function(){return v},n.step=function(){return p},n.round=function(D){return arguments.length?(b=!!D,I()):b},n.padding=function(D){return arguments.length?(T=Math.min(1,w=+D),I()):T},n.paddingInner=function(D){return arguments.length?(T=Math.min(1,D),I()):T},n.paddingOuter=function(D){return arguments.length?(w=+D,I()):w},n.align=function(D){return arguments.length?(C=Math.max(0,Math.min(1,D)),I()):C},n.copy=function(){return DU(i(),[c,f]).round(b).paddingInner(T).paddingOuter(w).align(C)},Zo.apply(I(),arguments)}function yZ(n){var i=n.copy;return n.padding=n.paddingOuter,delete n.paddingInner,delete n.paddingOuter,n.copy=function(){return yZ(i())},n}function uwe(){return yZ(DU.apply(null,arguments).paddingInner(1))}function PU(n,i,s){n.prototype=i.prototype=s,s.constructor=n}function EZ(n,i){var s=Object.create(n.prototype);for(var c in i)s[c]=i[c];return s}function Lb(){}var mb=.7,iI=1/mb,Nv="\\s*([+-]?\\d+)\\s*",gb="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ql="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",dwe=/^#([0-9a-f]{3,8})$/,hwe=new RegExp(`^rgb\\(${Nv},${Nv},${Nv}\\)$`),fwe=new RegExp(`^rgb\\(${ql},${ql},${ql}\\)$`),pwe=new RegExp(`^rgba\\(${Nv},${Nv},${Nv},${gb}\\)$`),mwe=new RegExp(`^rgba\\(${ql},${ql},${ql},${gb}\\)$`),gwe=new RegExp(`^hsl\\(${gb},${ql},${ql}\\)$`),_we=new RegExp(`^hsla\\(${gb},${ql},${ql},${gb}\\)$`),W7={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};PU(Lb,_b,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:z7,formatHex:z7,formatHex8:vwe,formatHsl:ywe,formatRgb:K7,toString:K7});function z7(){return this.rgb().formatHex()}function vwe(){return this.rgb().formatHex8()}function ywe(){return SZ(this).formatHsl()}function K7(){return this.rgb().formatRgb()}function _b(n){var i,s;return n=(n+"").trim().toLowerCase(),(i=dwe.exec(n))?(s=i[1].length,i=parseInt(i[1],16),s===6?Y7(i):s===3?new Ns(i>>8&15|i>>4&240,i>>4&15|i&240,(i&15)<<4|i&15,1):s===8?gO(i>>24&255,i>>16&255,i>>8&255,(i&255)/255):s===4?gO(i>>12&15|i>>8&240,i>>8&15|i>>4&240,i>>4&15|i&240,((i&15)<<4|i&15)/255):null):(i=hwe.exec(n))?new Ns(i[1],i[2],i[3],1):(i=fwe.exec(n))?new Ns(i[1]*255/100,i[2]*255/100,i[3]*255/100,1):(i=pwe.exec(n))?gO(i[1],i[2],i[3],i[4]):(i=mwe.exec(n))?gO(i[1]*255/100,i[2]*255/100,i[3]*255/100,i[4]):(i=gwe.exec(n))?J7(i[1],i[2]/100,i[3]/100,1):(i=_we.exec(n))?J7(i[1],i[2]/100,i[3]/100,i[4]):W7.hasOwnProperty(n)?Y7(W7[n]):n==="transparent"?new Ns(NaN,NaN,NaN,0):null}function Y7(n){return new Ns(n>>16&255,n>>8&255,n&255,1)}function gO(n,i,s,c){return c<=0&&(n=i=s=NaN),new Ns(n,i,s,c)}function Ewe(n){return n instanceof Lb||(n=_b(n)),n?(n=n.rgb(),new Ns(n.r,n.g,n.b,n.opacity)):new Ns}function o2(n,i,s,c){return arguments.length===1?Ewe(n):new Ns(n,i,s,c??1)}function Ns(n,i,s,c){this.r=+n,this.g=+i,this.b=+s,this.opacity=+c}PU(Ns,o2,EZ(Lb,{brighter(n){return n=n==null?iI:Math.pow(iI,n),new Ns(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?mb:Math.pow(mb,n),new Ns(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new Ns(gm(this.r),gm(this.g),gm(this.b),aI(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:q7,formatHex:q7,formatHex8:Swe,formatRgb:X7,toString:X7}));function q7(){return`#${lm(this.r)}${lm(this.g)}${lm(this.b)}`}function Swe(){return`#${lm(this.r)}${lm(this.g)}${lm(this.b)}${lm((isNaN(this.opacity)?1:this.opacity)*255)}`}function X7(){const n=aI(this.opacity);return`${n===1?"rgb(":"rgba("}${gm(this.r)}, ${gm(this.g)}, ${gm(this.b)}${n===1?")":`, ${n})`}`}function aI(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function gm(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function lm(n){return n=gm(n),(n<16?"0":"")+n.toString(16)}function J7(n,i,s,c){return c<=0?n=i=s=NaN:s<=0||s>=1?n=i=NaN:i<=0&&(n=NaN),new Zc(n,i,s,c)}function SZ(n){if(n instanceof Zc)return new Zc(n.h,n.s,n.l,n.opacity);if(n instanceof Lb||(n=_b(n)),!n)return new Zc;if(n instanceof Zc)return n;n=n.rgb();var i=n.r/255,s=n.g/255,c=n.b/255,f=Math.min(i,s,c),p=Math.max(i,s,c),v=NaN,b=p-f,T=(p+f)/2;return b?(i===p?v=(s-c)/b+(s<c)*6:s===p?v=(c-i)/b+2:v=(i-s)/b+4,b/=T<.5?p+f:2-p-f,v*=60):b=T>0&&T<1?0:v,new Zc(v,b,T,n.opacity)}function bwe(n,i,s,c){return arguments.length===1?SZ(n):new Zc(n,i,s,c??1)}function Zc(n,i,s,c){this.h=+n,this.s=+i,this.l=+s,this.opacity=+c}PU(Zc,bwe,EZ(Lb,{brighter(n){return n=n==null?iI:Math.pow(iI,n),new Zc(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?mb:Math.pow(mb,n),new Zc(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,i=isNaN(n)||isNaN(this.s)?0:this.s,s=this.l,c=s+(s<.5?s:1-s)*i,f=2*s-c;return new Ns(zL(n>=240?n-240:n+120,f,c),zL(n,f,c),zL(n<120?n+240:n-120,f,c),this.opacity)},clamp(){return new Zc($7(this.h),_O(this.s),_O(this.l),aI(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const n=aI(this.opacity);return`${n===1?"hsl(":"hsla("}${$7(this.h)}, ${_O(this.s)*100}%, ${_O(this.l)*100}%${n===1?")":`, ${n})`}`}}));function $7(n){return n=(n||0)%360,n<0?n+360:n}function _O(n){return Math.max(0,Math.min(1,n||0))}function zL(n,i,s){return(n<60?i+(s-i)*n/60:n<180?s:n<240?i+(s-i)*(240-n)/60:i)*255}const kU=n=>()=>n;function Twe(n,i){return function(s){return n+s*i}}function wwe(n,i,s){return n=Math.pow(n,s),i=Math.pow(i,s)-n,s=1/s,function(c){return Math.pow(n+c*i,s)}}function Rwe(n){return(n=+n)==1?bZ:function(i,s){return s-i?wwe(i,s,n):kU(isNaN(i)?s:i)}}function bZ(n,i){var s=i-n;return s?Twe(n,s):kU(isNaN(n)?i:n)}const Z7=(function n(i){var s=Rwe(i);function c(f,p){var v=s((f=o2(f)).r,(p=o2(p)).r),b=s(f.g,p.g),T=s(f.b,p.b),w=bZ(f.opacity,p.opacity);return function(C){return f.r=v(C),f.g=b(C),f.b=T(C),f.opacity=w(C),f+""}}return c.gamma=n,c})(1);function Cwe(n,i){i||(i=[]);var s=n?Math.min(i.length,n.length):0,c=i.slice(),f;return function(p){for(f=0;f<s;++f)c[f]=n[f]*(1-p)+i[f]*p;return c}}function Awe(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function Owe(n,i){var s=i?i.length:0,c=n?Math.min(s,n.length):0,f=new Array(c),p=new Array(s),v;for(v=0;v<c;++v)f[v]=qv(n[v],i[v]);for(;v<s;++v)p[v]=i[v];return function(b){for(v=0;v<c;++v)p[v]=f[v](b);return p}}function Iwe(n,i){var s=new Date;return n=+n,i=+i,function(c){return s.setTime(n*(1-c)+i*c),s}}function sI(n,i){return n=+n,i=+i,function(s){return n*(1-s)+i*s}}function Nwe(n,i){var s={},c={},f;(n===null||typeof n!="object")&&(n={}),(i===null||typeof i!="object")&&(i={});for(f in i)f in n?s[f]=qv(n[f],i[f]):c[f]=i[f];return function(p){for(f in s)c[f]=s[f](p);return c}}var c2=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,KL=new RegExp(c2.source,"g");function xwe(n){return function(){return n}}function Dwe(n){return function(i){return n(i)+""}}function Pwe(n,i){var s=c2.lastIndex=KL.lastIndex=0,c,f,p,v=-1,b=[],T=[];for(n=n+"",i=i+"";(c=c2.exec(n))&&(f=KL.exec(i));)(p=f.index)>s&&(p=i.slice(s,p),b[v]?b[v]+=p:b[++v]=p),(c=c[0])===(f=f[0])?b[v]?b[v]+=f:b[++v]=f:(b[++v]=null,T.push({i:v,x:sI(c,f)})),s=KL.lastIndex;return s<i.length&&(p=i.slice(s),b[v]?b[v]+=p:b[++v]=p),b.length<2?T[0]?Dwe(T[0].x):xwe(i):(i=T.length,function(w){for(var C=0,I;C<i;++C)b[(I=T[C]).i]=I.x(w);return b.join("")})}function qv(n,i){var s=typeof i,c;return i==null||s==="boolean"?kU(i):(s==="number"?sI:s==="string"?(c=_b(i))?(i=c,Z7):Pwe:i instanceof _b?Z7:i instanceof Date?Iwe:Awe(i)?Cwe:Array.isArray(i)?Owe:typeof i.valueOf!="function"&&typeof i.toString!="function"||isNaN(i)?Nwe:sI)(n,i)}function LU(n,i){return n=+n,i=+i,function(s){return Math.round(n*(1-s)+i*s)}}function kwe(n,i){i===void 0&&(i=n,n=qv);for(var s=0,c=i.length-1,f=i[0],p=new Array(c<0?0:c);s<c;)p[s]=n(f,f=i[++s]);return function(v){var b=Math.max(0,Math.min(c-1,Math.floor(v*=c)));return p[b](v-b)}}function Lwe(n){return function(){return n}}function oI(n){return+n}var Q7=[0,1];function es(n){return n}function l2(n,i){return(i-=n=+n)?function(s){return(s-n)/i}:Lwe(isNaN(i)?NaN:.5)}function Mwe(n,i){var s;return n>i&&(s=n,n=i,i=s),function(c){return Math.max(n,Math.min(i,c))}}function Uwe(n,i,s){var c=n[0],f=n[1],p=i[0],v=i[1];return f<c?(c=l2(f,c),p=s(v,p)):(c=l2(c,f),p=s(p,v)),function(b){return p(c(b))}}function jwe(n,i,s){var c=Math.min(n.length,i.length)-1,f=new Array(c),p=new Array(c),v=-1;for(n[c]<n[0]&&(n=n.slice().reverse(),i=i.slice().reverse());++v<c;)f[v]=l2(n[v],n[v+1]),p[v]=s(i[v],i[v+1]);return function(b){var T=kb(n,b,1,c)-1;return p[T](f[T](b))}}function Mb(n,i){return i.domain(n.domain()).range(n.range()).interpolate(n.interpolate()).clamp(n.clamp()).unknown(n.unknown())}function YI(){var n=Q7,i=Q7,s=qv,c,f,p,v=es,b,T,w;function C(){var D=Math.min(n.length,i.length);return v!==es&&(v=Mwe(n[0],n[D-1])),b=D>2?jwe:Uwe,T=w=null,I}function I(D){return D==null||isNaN(D=+D)?p:(T||(T=b(n.map(c),i,s)))(c(v(D)))}return I.invert=function(D){return v(f((w||(w=b(i,n.map(c),sI)))(D)))},I.domain=function(D){return arguments.length?(n=Array.from(D,oI),C()):n.slice()},I.range=function(D){return arguments.length?(i=Array.from(D),C()):i.slice()},I.rangeRound=function(D){return i=Array.from(D),s=LU,C()},I.clamp=function(D){return arguments.length?(v=D?!0:es,C()):v!==es},I.interpolate=function(D){return arguments.length?(s=D,C()):s},I.unknown=function(D){return arguments.length?(p=D,I):p},function(D,L){return c=D,f=L,C()}}function MU(){return YI()(es,es)}function Vwe(n){return Math.abs(n=Math.round(n))>=1e21?n.toLocaleString("en").replace(/,/g,""):n.toString(10)}function cI(n,i){if((s=(n=i?n.toExponential(i-1):n.toExponential()).indexOf("e"))<0)return null;var s,c=n.slice(0,s);return[c.length>1?c[0]+c.slice(2):c,+n.slice(s+1)]}function Lv(n){return n=cI(Math.abs(n)),n?n[1]:NaN}function Bwe(n,i){return function(s,c){for(var f=s.length,p=[],v=0,b=n[0],T=0;f>0&&b>0&&(T+b+1>c&&(b=Math.max(1,c-T)),p.push(s.substring(f-=b,f+b)),!((T+=b+1)>c));)b=n[v=(v+1)%n.length];return p.reverse().join(i)}}function Fwe(n){return function(i){return i.replace(/[0-9]/g,function(s){return n[+s]})}}var Gwe=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function vb(n){if(!(i=Gwe.exec(n)))throw new Error("invalid format: "+n);var i;return new UU({fill:i[1],align:i[2],sign:i[3],symbol:i[4],zero:i[5],width:i[6],comma:i[7],precision:i[8]&&i[8].slice(1),trim:i[9],type:i[10]})}vb.prototype=UU.prototype;function UU(n){this.fill=n.fill===void 0?" ":n.fill+"",this.align=n.align===void 0?">":n.align+"",this.sign=n.sign===void 0?"-":n.sign+"",this.symbol=n.symbol===void 0?"":n.symbol+"",this.zero=!!n.zero,this.width=n.width===void 0?void 0:+n.width,this.comma=!!n.comma,this.precision=n.precision===void 0?void 0:+n.precision,this.trim=!!n.trim,this.type=n.type===void 0?"":n.type+""}UU.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Hwe(n){e:for(var i=n.length,s=1,c=-1,f;s<i;++s)switch(n[s]){case".":c=f=s;break;case"0":c===0&&(c=s),f=s;break;default:if(!+n[s])break e;c>0&&(c=0);break}return c>0?n.slice(0,c)+n.slice(f+1):n}var TZ;function Wwe(n,i){var s=cI(n,i);if(!s)return n+"";var c=s[0],f=s[1],p=f-(TZ=Math.max(-8,Math.min(8,Math.floor(f/3)))*3)+1,v=c.length;return p===v?c:p>v?c+new Array(p-v+1).join("0"):p>0?c.slice(0,p)+"."+c.slice(p):"0."+new Array(1-p).join("0")+cI(n,Math.max(0,i+p-1))[0]}function eY(n,i){var s=cI(n,i);if(!s)return n+"";var c=s[0],f=s[1];return f<0?"0."+new Array(-f).join("0")+c:c.length>f+1?c.slice(0,f+1)+"."+c.slice(f+1):c+new Array(f-c.length+2).join("0")}const tY={"%":(n,i)=>(n*100).toFixed(i),b:n=>Math.round(n).toString(2),c:n=>n+"",d:Vwe,e:(n,i)=>n.toExponential(i),f:(n,i)=>n.toFixed(i),g:(n,i)=>n.toPrecision(i),o:n=>Math.round(n).toString(8),p:(n,i)=>eY(n*100,i),r:eY,s:Wwe,X:n=>Math.round(n).toString(16).toUpperCase(),x:n=>Math.round(n).toString(16)};function nY(n){return n}var rY=Array.prototype.map,iY=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function zwe(n){var i=n.grouping===void 0||n.thousands===void 0?nY:Bwe(rY.call(n.grouping,Number),n.thousands+""),s=n.currency===void 0?"":n.currency[0]+"",c=n.currency===void 0?"":n.currency[1]+"",f=n.decimal===void 0?".":n.decimal+"",p=n.numerals===void 0?nY:Fwe(rY.call(n.numerals,String)),v=n.percent===void 0?"%":n.percent+"",b=n.minus===void 0?"":n.minus+"",T=n.nan===void 0?"NaN":n.nan+"";function w(I){I=vb(I);var D=I.fill,L=I.align,F=I.sign,W=I.symbol,G=I.zero,$=I.width,te=I.comma,Z=I.precision,ce=I.trim,se=I.type;se==="n"?(te=!0,se="g"):tY[se]||(Z===void 0&&(Z=12),ce=!0,se="g"),(G||D==="0"&&L==="=")&&(G=!0,D="0",L="=");var de=W==="$"?s:W==="#"&&/[boxX]/.test(se)?"0"+se.toLowerCase():"",oe=W==="$"?c:/[%p]/.test(se)?v:"",ge=tY[se],Ae=/[defgprs%]/.test(se);Z=Z===void 0?6:/[gprs]/.test(se)?Math.max(1,Math.min(21,Z)):Math.max(0,Math.min(20,Z));function ke(Ee){var be=de,Le=oe,et,rt,he;if(se==="c")Le=ge(Ee)+Le,Ee="";else{Ee=+Ee;var _e=Ee<0||1/Ee<0;if(Ee=isNaN(Ee)?T:ge(Math.abs(Ee),Z),ce&&(Ee=Hwe(Ee)),_e&&+Ee==0&&F!=="+"&&(_e=!1),be=(_e?F==="("?F:b:F==="-"||F==="("?"":F)+be,Le=(se==="s"?iY[8+TZ/3]:"")+Le+(_e&&F==="("?")":""),Ae){for(et=-1,rt=Ee.length;++et<rt;)if(he=Ee.charCodeAt(et),48>he||he>57){Le=(he===46?f+Ee.slice(et+1):Ee.slice(et))+Le,Ee=Ee.slice(0,et);break}}}te&&!G&&(Ee=i(Ee,1/0));var ze=be.length+Ee.length+Le.length,tt=ze<$?new Array($-ze+1).join(D):"";switch(te&&G&&(Ee=i(tt+Ee,tt.length?$-Le.length:1/0),tt=""),L){case"<":Ee=be+Ee+Le+tt;break;case"=":Ee=be+tt+Ee+Le;break;case"^":Ee=tt.slice(0,ze=tt.length>>1)+be+Ee+Le+tt.slice(ze);break;default:Ee=tt+be+Ee+Le;break}return p(Ee)}return ke.toString=function(){return I+""},ke}function C(I,D){var L=w((I=vb(I),I.type="f",I)),F=Math.max(-8,Math.min(8,Math.floor(Lv(D)/3)))*3,W=Math.pow(10,-F),G=iY[8+F/3];return function($){return L(W*$)+G}}return{format:w,formatPrefix:C}}var vO,jU,wZ;Kwe({thousands:",",grouping:[3],currency:["$",""]});function Kwe(n){return vO=zwe(n),jU=vO.format,wZ=vO.formatPrefix,vO}function Ywe(n){return Math.max(0,-Lv(Math.abs(n)))}function qwe(n,i){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Lv(i)/3)))*3-Lv(Math.abs(n)))}function Xwe(n,i){return n=Math.abs(n),i=Math.abs(i)-n,Math.max(0,Lv(i)-Lv(n))+1}function RZ(n,i,s,c){var f=a2(n,i,s),p;switch(c=vb(c??",f"),c.type){case"s":{var v=Math.max(Math.abs(n),Math.abs(i));return c.precision==null&&!isNaN(p=qwe(f,v))&&(c.precision=p),wZ(c,v)}case"":case"e":case"g":case"p":case"r":{c.precision==null&&!isNaN(p=Xwe(f,Math.max(Math.abs(n),Math.abs(i))))&&(c.precision=p-(c.type==="e"));break}case"f":case"%":{c.precision==null&&!isNaN(p=Ywe(f))&&(c.precision=p-(c.type==="%")*2);break}}return jU(c)}function hf(n){var i=n.domain;return n.ticks=function(s){var c=i();return r2(c[0],c[c.length-1],s??10)},n.tickFormat=function(s,c){var f=i();return RZ(f[0],f[f.length-1],s??10,c)},n.nice=function(s){s==null&&(s=10);var c=i(),f=0,p=c.length-1,v=c[f],b=c[p],T,w,C=10;for(b<v&&(w=v,v=b,b=w,w=f,f=p,p=w);C-- >0;){if(w=i2(v,b,s),w===T)return c[f]=v,c[p]=b,i(c);if(w>0)v=Math.floor(v/w)*w,b=Math.ceil(b/w)*w;else if(w<0)v=Math.ceil(v*w)/w,b=Math.floor(b*w)/w;else break;T=w}return n},n}function CZ(){var n=MU();return n.copy=function(){return Mb(n,CZ())},Zo.apply(n,arguments),hf(n)}function AZ(n){var i;function s(c){return c==null||isNaN(c=+c)?i:c}return s.invert=s,s.domain=s.range=function(c){return arguments.length?(n=Array.from(c,oI),s):n.slice()},s.unknown=function(c){return arguments.length?(i=c,s):i},s.copy=function(){return AZ(n).unknown(i)},n=arguments.length?Array.from(n,oI):[0,1],hf(s)}function OZ(n,i){n=n.slice();var s=0,c=n.length-1,f=n[s],p=n[c],v;return p<f&&(v=s,s=c,c=v,v=f,f=p,p=v),n[s]=i.floor(f),n[c]=i.ceil(p),n}function aY(n){return Math.log(n)}function sY(n){return Math.exp(n)}function Jwe(n){return-Math.log(-n)}function $we(n){return-Math.exp(-n)}function Zwe(n){return isFinite(n)?+("1e"+n):n<0?0:n}function Qwe(n){return n===10?Zwe:n===Math.E?Math.exp:i=>Math.pow(n,i)}function eRe(n){return n===Math.E?Math.log:n===10&&Math.log10||n===2&&Math.log2||(n=Math.log(n),i=>Math.log(i)/n)}function oY(n){return(i,s)=>-n(-i,s)}function VU(n){const i=n(aY,sY),s=i.domain;let c=10,f,p;function v(){return f=eRe(c),p=Qwe(c),s()[0]<0?(f=oY(f),p=oY(p),n(Jwe,$we)):n(aY,sY),i}return i.base=function(b){return arguments.length?(c=+b,v()):c},i.domain=function(b){return arguments.length?(s(b),v()):s()},i.ticks=b=>{const T=s();let w=T[0],C=T[T.length-1];const I=C<w;I&&([w,C]=[C,w]);let D=f(w),L=f(C),F,W;const G=b==null?10:+b;let $=[];if(!(c%1)&&L-D<G){if(D=Math.floor(D),L=Math.ceil(L),w>0){for(;D<=L;++D)for(F=1;F<c;++F)if(W=D<0?F/p(-D):F*p(D),!(W<w)){if(W>C)break;$.push(W)}}else for(;D<=L;++D)for(F=c-1;F>=1;--F)if(W=D>0?F/p(-D):F*p(D),!(W<w)){if(W>C)break;$.push(W)}$.length*2<G&&($=r2(w,C,G))}else $=r2(D,L,Math.min(L-D,G)).map(p);return I?$.reverse():$},i.tickFormat=(b,T)=>{if(b==null&&(b=10),T==null&&(T=c===10?"s":","),typeof T!="function"&&(!(c%1)&&(T=vb(T)).precision==null&&(T.trim=!0),T=jU(T)),b===1/0)return T;const w=Math.max(1,c*b/i.ticks().length);return C=>{let I=C/p(Math.round(f(C)));return I*c<c-.5&&(I*=c),I<=w?T(C):""}},i.nice=()=>s(OZ(s(),{floor:b=>p(Math.floor(f(b))),ceil:b=>p(Math.ceil(f(b)))})),i}function IZ(){const n=VU(YI()).domain([1,10]);return n.copy=()=>Mb(n,IZ()).base(n.base()),Zo.apply(n,arguments),n}function cY(n){return function(i){return Math.sign(i)*Math.log1p(Math.abs(i/n))}}function lY(n){return function(i){return Math.sign(i)*Math.expm1(Math.abs(i))*n}}function BU(n){var i=1,s=n(cY(i),lY(i));return s.constant=function(c){return arguments.length?n(cY(i=+c),lY(i)):i},hf(s)}function NZ(){var n=BU(YI());return n.copy=function(){return Mb(n,NZ()).constant(n.constant())},Zo.apply(n,arguments)}function uY(n){return function(i){return i<0?-Math.pow(-i,n):Math.pow(i,n)}}function tRe(n){return n<0?-Math.sqrt(-n):Math.sqrt(n)}function nRe(n){return n<0?-n*n:n*n}function FU(n){var i=n(es,es),s=1;function c(){return s===1?n(es,es):s===.5?n(tRe,nRe):n(uY(s),uY(1/s))}return i.exponent=function(f){return arguments.length?(s=+f,c()):s},hf(i)}function GU(){var n=FU(YI());return n.copy=function(){return Mb(n,GU()).exponent(n.exponent())},Zo.apply(n,arguments),n}function rRe(){return GU.apply(null,arguments).exponent(.5)}function dY(n){return Math.sign(n)*n*n}function iRe(n){return Math.sign(n)*Math.sqrt(Math.abs(n))}function xZ(){var n=MU(),i=[0,1],s=!1,c;function f(p){var v=iRe(n(p));return isNaN(v)?c:s?Math.round(v):v}return f.invert=function(p){return n.invert(dY(p))},f.domain=function(p){return arguments.length?(n.domain(p),f):n.domain()},f.range=function(p){return arguments.length?(n.range((i=Array.from(p,oI)).map(dY)),f):i.slice()},f.rangeRound=function(p){return f.range(p).round(!0)},f.round=function(p){return arguments.length?(s=!!p,f):s},f.clamp=function(p){return arguments.length?(n.clamp(p),f):n.clamp()},f.unknown=function(p){return arguments.length?(c=p,f):c},f.copy=function(){return xZ(n.domain(),i).round(s).clamp(n.clamp()).unknown(c)},Zo.apply(f,arguments),hf(f)}function DZ(){var n=[],i=[],s=[],c;function f(){var v=0,b=Math.max(1,i.length);for(s=new Array(b-1);++v<b;)s[v-1]=cwe(n,v/b);return p}function p(v){return v==null||isNaN(v=+v)?c:i[kb(s,v)]}return p.invertExtent=function(v){var b=i.indexOf(v);return b<0?[NaN,NaN]:[b>0?s[b-1]:n[0],b<s.length?s[b]:n[n.length-1]]},p.domain=function(v){if(!arguments.length)return n.slice();n=[];for(let b of v)b!=null&&!isNaN(b=+b)&&n.push(b);return n.sort(sf),f()},p.range=function(v){return arguments.length?(i=Array.from(v),f()):i.slice()},p.unknown=function(v){return arguments.length?(c=v,p):c},p.quantiles=function(){return s.slice()},p.copy=function(){return DZ().domain(n).range(i).unknown(c)},Zo.apply(p,arguments)}function PZ(){var n=0,i=1,s=1,c=[.5],f=[0,1],p;function v(T){return T!=null&&T<=T?f[kb(c,T,0,s)]:p}function b(){var T=-1;for(c=new Array(s);++T<s;)c[T]=((T+1)*i-(T-s)*n)/(s+1);return v}return v.domain=function(T){return arguments.length?([n,i]=T,n=+n,i=+i,b()):[n,i]},v.range=function(T){return arguments.length?(s=(f=Array.from(T)).length-1,b()):f.slice()},v.invertExtent=function(T){var w=f.indexOf(T);return w<0?[NaN,NaN]:w<1?[n,c[0]]:w>=s?[c[s-1],i]:[c[w-1],c[w]]},v.unknown=function(T){return arguments.length&&(p=T),v},v.thresholds=function(){return c.slice()},v.copy=function(){return PZ().domain([n,i]).range(f).unknown(p)},Zo.apply(hf(v),arguments)}function kZ(){var n=[.5],i=[0,1],s,c=1;function f(p){return p!=null&&p<=p?i[kb(n,p,0,c)]:s}return f.domain=function(p){return arguments.length?(n=Array.from(p),c=Math.min(n.length,i.length-1),f):n.slice()},f.range=function(p){return arguments.length?(i=Array.from(p),c=Math.min(n.length,i.length-1),f):i.slice()},f.invertExtent=function(p){var v=i.indexOf(p);return[n[v-1],n[v]]},f.unknown=function(p){return arguments.length?(s=p,f):s},f.copy=function(){return kZ().domain(n).range(i).unknown(s)},Zo.apply(f,arguments)}const YL=new Date,qL=new Date;function Vi(n,i,s,c){function f(p){return n(p=arguments.length===0?new Date:new Date(+p)),p}return f.floor=p=>(n(p=new Date(+p)),p),f.ceil=p=>(n(p=new Date(p-1)),i(p,1),n(p),p),f.round=p=>{const v=f(p),b=f.ceil(p);return p-v<b-p?v:b},f.offset=(p,v)=>(i(p=new Date(+p),v==null?1:Math.floor(v)),p),f.range=(p,v,b)=>{const T=[];if(p=f.ceil(p),b=b==null?1:Math.floor(b),!(p<v)||!(b>0))return T;let w;do T.push(w=new Date(+p)),i(p,b),n(p);while(w<p&&p<v);return T},f.filter=p=>Vi(v=>{if(v>=v)for(;n(v),!p(v);)v.setTime(v-1)},(v,b)=>{if(v>=v)if(b<0)for(;++b<=0;)for(;i(v,-1),!p(v););else for(;--b>=0;)for(;i(v,1),!p(v););}),s&&(f.count=(p,v)=>(YL.setTime(+p),qL.setTime(+v),n(YL),n(qL),Math.floor(s(YL,qL))),f.every=p=>(p=Math.floor(p),!isFinite(p)||!(p>0)?null:p>1?f.filter(c?v=>c(v)%p===0:v=>f.count(0,v)%p===0):f)),f}const lI=Vi(()=>{},(n,i)=>{n.setTime(+n+i)},(n,i)=>i-n);lI.every=n=>(n=Math.floor(n),!isFinite(n)||!(n>0)?null:n>1?Vi(i=>{i.setTime(Math.floor(i/n)*n)},(i,s)=>{i.setTime(+i+s*n)},(i,s)=>(s-i)/n):lI);lI.range;const Qu=1e3,zo=Qu*60,ed=zo*60,ud=ed*24,HU=ud*7,hY=ud*30,XL=ud*365,um=Vi(n=>{n.setTime(n-n.getMilliseconds())},(n,i)=>{n.setTime(+n+i*Qu)},(n,i)=>(i-n)/Qu,n=>n.getUTCSeconds());um.range;const WU=Vi(n=>{n.setTime(n-n.getMilliseconds()-n.getSeconds()*Qu)},(n,i)=>{n.setTime(+n+i*zo)},(n,i)=>(i-n)/zo,n=>n.getMinutes());WU.range;const zU=Vi(n=>{n.setUTCSeconds(0,0)},(n,i)=>{n.setTime(+n+i*zo)},(n,i)=>(i-n)/zo,n=>n.getUTCMinutes());zU.range;const KU=Vi(n=>{n.setTime(n-n.getMilliseconds()-n.getSeconds()*Qu-n.getMinutes()*zo)},(n,i)=>{n.setTime(+n+i*ed)},(n,i)=>(i-n)/ed,n=>n.getHours());KU.range;const YU=Vi(n=>{n.setUTCMinutes(0,0,0)},(n,i)=>{n.setTime(+n+i*ed)},(n,i)=>(i-n)/ed,n=>n.getUTCHours());YU.range;const Ub=Vi(n=>n.setHours(0,0,0,0),(n,i)=>n.setDate(n.getDate()+i),(n,i)=>(i-n-(i.getTimezoneOffset()-n.getTimezoneOffset())*zo)/ud,n=>n.getDate()-1);Ub.range;const qI=Vi(n=>{n.setUTCHours(0,0,0,0)},(n,i)=>{n.setUTCDate(n.getUTCDate()+i)},(n,i)=>(i-n)/ud,n=>n.getUTCDate()-1);qI.range;const LZ=Vi(n=>{n.setUTCHours(0,0,0,0)},(n,i)=>{n.setUTCDate(n.getUTCDate()+i)},(n,i)=>(i-n)/ud,n=>Math.floor(n/ud));LZ.range;function Cm(n){return Vi(i=>{i.setDate(i.getDate()-(i.getDay()+7-n)%7),i.setHours(0,0,0,0)},(i,s)=>{i.setDate(i.getDate()+s*7)},(i,s)=>(s-i-(s.getTimezoneOffset()-i.getTimezoneOffset())*zo)/HU)}const XI=Cm(0),uI=Cm(1),aRe=Cm(2),sRe=Cm(3),Mv=Cm(4),oRe=Cm(5),cRe=Cm(6);XI.range;uI.range;aRe.range;sRe.range;Mv.range;oRe.range;cRe.range;function Am(n){return Vi(i=>{i.setUTCDate(i.getUTCDate()-(i.getUTCDay()+7-n)%7),i.setUTCHours(0,0,0,0)},(i,s)=>{i.setUTCDate(i.getUTCDate()+s*7)},(i,s)=>(s-i)/HU)}const JI=Am(0),dI=Am(1),lRe=Am(2),uRe=Am(3),Uv=Am(4),dRe=Am(5),hRe=Am(6);JI.range;dI.range;lRe.range;uRe.range;Uv.range;dRe.range;hRe.range;const qU=Vi(n=>{n.setDate(1),n.setHours(0,0,0,0)},(n,i)=>{n.setMonth(n.getMonth()+i)},(n,i)=>i.getMonth()-n.getMonth()+(i.getFullYear()-n.getFullYear())*12,n=>n.getMonth());qU.range;const XU=Vi(n=>{n.setUTCDate(1),n.setUTCHours(0,0,0,0)},(n,i)=>{n.setUTCMonth(n.getUTCMonth()+i)},(n,i)=>i.getUTCMonth()-n.getUTCMonth()+(i.getUTCFullYear()-n.getUTCFullYear())*12,n=>n.getUTCMonth());XU.range;const dd=Vi(n=>{n.setMonth(0,1),n.setHours(0,0,0,0)},(n,i)=>{n.setFullYear(n.getFullYear()+i)},(n,i)=>i.getFullYear()-n.getFullYear(),n=>n.getFullYear());dd.every=n=>!isFinite(n=Math.floor(n))||!(n>0)?null:Vi(i=>{i.setFullYear(Math.floor(i.getFullYear()/n)*n),i.setMonth(0,1),i.setHours(0,0,0,0)},(i,s)=>{i.setFullYear(i.getFullYear()+s*n)});dd.range;const hd=Vi(n=>{n.setUTCMonth(0,1),n.setUTCHours(0,0,0,0)},(n,i)=>{n.setUTCFullYear(n.getUTCFullYear()+i)},(n,i)=>i.getUTCFullYear()-n.getUTCFullYear(),n=>n.getUTCFullYear());hd.every=n=>!isFinite(n=Math.floor(n))||!(n>0)?null:Vi(i=>{i.setUTCFullYear(Math.floor(i.getUTCFullYear()/n)*n),i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},(i,s)=>{i.setUTCFullYear(i.getUTCFullYear()+s*n)});hd.range;function MZ(n,i,s,c,f,p){const v=[[um,1,Qu],[um,5,5*Qu],[um,15,15*Qu],[um,30,30*Qu],[p,1,zo],[p,5,5*zo],[p,15,15*zo],[p,30,30*zo],[f,1,ed],[f,3,3*ed],[f,6,6*ed],[f,12,12*ed],[c,1,ud],[c,2,2*ud],[s,1,HU],[i,1,hY],[i,3,3*hY],[n,1,XL]];function b(w,C,I){const D=C<w;D&&([w,C]=[C,w]);const L=I&&typeof I.range=="function"?I:T(w,C,I),F=L?L.range(w,+C+1):[];return D?F.reverse():F}function T(w,C,I){const D=Math.abs(C-w)/I,L=NU(([,,G])=>G).right(v,D);if(L===v.length)return n.every(a2(w/XL,C/XL,I));if(L===0)return lI.every(Math.max(a2(w,C,I),1));const[F,W]=v[D/v[L-1][2]<v[L][2]/D?L-1:L];return F.every(W)}return[b,T]}const[fRe,pRe]=MZ(hd,XU,JI,LZ,YU,zU),[mRe,gRe]=MZ(dd,qU,XI,Ub,KU,WU);function JL(n){if(0<=n.y&&n.y<100){var i=new Date(-1,n.m,n.d,n.H,n.M,n.S,n.L);return i.setFullYear(n.y),i}return new Date(n.y,n.m,n.d,n.H,n.M,n.S,n.L)}function $L(n){if(0<=n.y&&n.y<100){var i=new Date(Date.UTC(-1,n.m,n.d,n.H,n.M,n.S,n.L));return i.setUTCFullYear(n.y),i}return new Date(Date.UTC(n.y,n.m,n.d,n.H,n.M,n.S,n.L))}function FS(n,i,s){return{y:n,m:i,d:s,H:0,M:0,S:0,L:0}}function _Re(n){var i=n.dateTime,s=n.date,c=n.time,f=n.periods,p=n.days,v=n.shortDays,b=n.months,T=n.shortMonths,w=GS(f),C=HS(f),I=GS(p),D=HS(p),L=GS(v),F=HS(v),W=GS(b),G=HS(b),$=GS(T),te=HS(T),Z={a:_e,A:ze,b:tt,B:ut,c:null,d:vY,e:vY,f:BRe,g:JRe,G:ZRe,H:URe,I:jRe,j:VRe,L:UZ,m:FRe,M:GRe,p:me,q:Ve,Q:SY,s:bY,S:HRe,u:WRe,U:zRe,V:KRe,w:YRe,W:qRe,x:null,X:null,y:XRe,Y:$Re,Z:QRe,"%":EY},ce={a:it,A:dt,b:Ct,B:rn,c:null,d:yY,e:yY,f:rCe,g:fCe,G:mCe,H:eCe,I:tCe,j:nCe,L:VZ,m:iCe,M:aCe,p:En,q:ai,Q:SY,s:bY,S:sCe,u:oCe,U:cCe,V:lCe,w:uCe,W:dCe,x:null,X:null,y:hCe,Y:pCe,Z:gCe,"%":EY},se={a:ke,A:Ee,b:be,B:Le,c:et,d:gY,e:gY,f:PRe,g:mY,G:pY,H:_Y,I:_Y,j:IRe,L:DRe,m:ORe,M:NRe,p:Ae,q:ARe,Q:LRe,s:MRe,S:xRe,u:bRe,U:TRe,V:wRe,w:SRe,W:RRe,x:rt,X:he,y:mY,Y:pY,Z:CRe,"%":kRe};Z.x=de(s,Z),Z.X=de(c,Z),Z.c=de(i,Z),ce.x=de(s,ce),ce.X=de(c,ce),ce.c=de(i,ce);function de(qe,qt){return function(gn){var st=[],br=-1,An=0,Ai=qe.length,gr,Qo,Ur;for(gn instanceof Date||(gn=new Date(+gn));++br<Ai;)qe.charCodeAt(br)===37&&(st.push(qe.slice(An,br)),(Qo=fY[gr=qe.charAt(++br)])!=null?gr=qe.charAt(++br):Qo=gr==="e"?" ":"0",(Ur=qt[gr])&&(gr=Ur(gn,Qo)),st.push(gr),An=br+1);return st.push(qe.slice(An,br)),st.join("")}}function oe(qe,qt){return function(gn){var st=FS(1900,void 0,1),br=ge(st,qe,gn+="",0),An,Ai;if(br!=gn.length)return null;if("Q"in st)return new Date(st.Q);if("s"in st)return new Date(st.s*1e3+("L"in st?st.L:0));if(qt&&!("Z"in st)&&(st.Z=0),"p"in st&&(st.H=st.H%12+st.p*12),st.m===void 0&&(st.m="q"in st?st.q:0),"V"in st){if(st.V<1||st.V>53)return null;"w"in st||(st.w=1),"Z"in st?(An=$L(FS(st.y,0,1)),Ai=An.getUTCDay(),An=Ai>4||Ai===0?dI.ceil(An):dI(An),An=qI.offset(An,(st.V-1)*7),st.y=An.getUTCFullYear(),st.m=An.getUTCMonth(),st.d=An.getUTCDate()+(st.w+6)%7):(An=JL(FS(st.y,0,1)),Ai=An.getDay(),An=Ai>4||Ai===0?uI.ceil(An):uI(An),An=Ub.offset(An,(st.V-1)*7),st.y=An.getFullYear(),st.m=An.getMonth(),st.d=An.getDate()+(st.w+6)%7)}else("W"in st||"U"in st)&&("w"in st||(st.w="u"in st?st.u%7:"W"in st?1:0),Ai="Z"in st?$L(FS(st.y,0,1)).getUTCDay():JL(FS(st.y,0,1)).getDay(),st.m=0,st.d="W"in st?(st.w+6)%7+st.W*7-(Ai+5)%7:st.w+st.U*7-(Ai+6)%7);return"Z"in st?(st.H+=st.Z/100|0,st.M+=st.Z%100,$L(st)):JL(st)}}function ge(qe,qt,gn,st){for(var br=0,An=qt.length,Ai=gn.length,gr,Qo;br<An;){if(st>=Ai)return-1;if(gr=qt.charCodeAt(br++),gr===37){if(gr=qt.charAt(br++),Qo=se[gr in fY?qt.charAt(br++):gr],!Qo||(st=Qo(qe,gn,st))<0)return-1}else if(gr!=gn.charCodeAt(st++))return-1}return st}function Ae(qe,qt,gn){var st=w.exec(qt.slice(gn));return st?(qe.p=C.get(st[0].toLowerCase()),gn+st[0].length):-1}function ke(qe,qt,gn){var st=L.exec(qt.slice(gn));return st?(qe.w=F.get(st[0].toLowerCase()),gn+st[0].length):-1}function Ee(qe,qt,gn){var st=I.exec(qt.slice(gn));return st?(qe.w=D.get(st[0].toLowerCase()),gn+st[0].length):-1}function be(qe,qt,gn){var st=$.exec(qt.slice(gn));return st?(qe.m=te.get(st[0].toLowerCase()),gn+st[0].length):-1}function Le(qe,qt,gn){var st=W.exec(qt.slice(gn));return st?(qe.m=G.get(st[0].toLowerCase()),gn+st[0].length):-1}function et(qe,qt,gn){return ge(qe,i,qt,gn)}function rt(qe,qt,gn){return ge(qe,s,qt,gn)}function he(qe,qt,gn){return ge(qe,c,qt,gn)}function _e(qe){return v[qe.getDay()]}function ze(qe){return p[qe.getDay()]}function tt(qe){return T[qe.getMonth()]}function ut(qe){return b[qe.getMonth()]}function me(qe){return f[+(qe.getHours()>=12)]}function Ve(qe){return 1+~~(qe.getMonth()/3)}function it(qe){return v[qe.getUTCDay()]}function dt(qe){return p[qe.getUTCDay()]}function Ct(qe){return T[qe.getUTCMonth()]}function rn(qe){return b[qe.getUTCMonth()]}function En(qe){return f[+(qe.getUTCHours()>=12)]}function ai(qe){return 1+~~(qe.getUTCMonth()/3)}return{format:function(qe){var qt=de(qe+="",Z);return qt.toString=function(){return qe},qt},parse:function(qe){var qt=oe(qe+="",!1);return qt.toString=function(){return qe},qt},utcFormat:function(qe){var qt=de(qe+="",ce);return qt.toString=function(){return qe},qt},utcParse:function(qe){var qt=oe(qe+="",!0);return qt.toString=function(){return qe},qt}}}var fY={"-":"",_:" ",0:"0"},na=/^\s*\d+/,vRe=/^%/,yRe=/[\\^$*+?|[\]().{}]/g;function Kn(n,i,s){var c=n<0?"-":"",f=(c?-n:n)+"",p=f.length;return c+(p<s?new Array(s-p+1).join(i)+f:f)}function ERe(n){return n.replace(yRe,"\\$&")}function GS(n){return new RegExp("^(?:"+n.map(ERe).join("|")+")","i")}function HS(n){return new Map(n.map((i,s)=>[i.toLowerCase(),s]))}function SRe(n,i,s){var c=na.exec(i.slice(s,s+1));return c?(n.w=+c[0],s+c[0].length):-1}function bRe(n,i,s){var c=na.exec(i.slice(s,s+1));return c?(n.u=+c[0],s+c[0].length):-1}function TRe(n,i,s){var c=na.exec(i.slice(s,s+2));return c?(n.U=+c[0],s+c[0].length):-1}function wRe(n,i,s){var c=na.exec(i.slice(s,s+2));return c?(n.V=+c[0],s+c[0].length):-1}function RRe(n,i,s){var c=na.exec(i.slice(s,s+2));return c?(n.W=+c[0],s+c[0].length):-1}function pY(n,i,s){var c=na.exec(i.slice(s,s+4));return c?(n.y=+c[0],s+c[0].length):-1}function mY(n,i,s){var c=na.exec(i.slice(s,s+2));return c?(n.y=+c[0]+(+c[0]>68?1900:2e3),s+c[0].length):-1}function CRe(n,i,s){var c=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(i.slice(s,s+6));return c?(n.Z=c[1]?0:-(c[2]+(c[3]||"00")),s+c[0].length):-1}function ARe(n,i,s){var c=na.exec(i.slice(s,s+1));return c?(n.q=c[0]*3-3,s+c[0].length):-1}function ORe(n,i,s){var c=na.exec(i.slice(s,s+2));return c?(n.m=c[0]-1,s+c[0].length):-1}function gY(n,i,s){var c=na.exec(i.slice(s,s+2));return c?(n.d=+c[0],s+c[0].length):-1}function IRe(n,i,s){var c=na.exec(i.slice(s,s+3));return c?(n.m=0,n.d=+c[0],s+c[0].length):-1}function _Y(n,i,s){var c=na.exec(i.slice(s,s+2));return c?(n.H=+c[0],s+c[0].length):-1}function NRe(n,i,s){var c=na.exec(i.slice(s,s+2));return c?(n.M=+c[0],s+c[0].length):-1}function xRe(n,i,s){var c=na.exec(i.slice(s,s+2));return c?(n.S=+c[0],s+c[0].length):-1}function DRe(n,i,s){var c=na.exec(i.slice(s,s+3));return c?(n.L=+c[0],s+c[0].length):-1}function PRe(n,i,s){var c=na.exec(i.slice(s,s+6));return c?(n.L=Math.floor(c[0]/1e3),s+c[0].length):-1}function kRe(n,i,s){var c=vRe.exec(i.slice(s,s+1));return c?s+c[0].length:-1}function LRe(n,i,s){var c=na.exec(i.slice(s));return c?(n.Q=+c[0],s+c[0].length):-1}function MRe(n,i,s){var c=na.exec(i.slice(s));return c?(n.s=+c[0],s+c[0].length):-1}function vY(n,i){return Kn(n.getDate(),i,2)}function URe(n,i){return Kn(n.getHours(),i,2)}function jRe(n,i){return Kn(n.getHours()%12||12,i,2)}function VRe(n,i){return Kn(1+Ub.count(dd(n),n),i,3)}function UZ(n,i){return Kn(n.getMilliseconds(),i,3)}function BRe(n,i){return UZ(n,i)+"000"}function FRe(n,i){return Kn(n.getMonth()+1,i,2)}function GRe(n,i){return Kn(n.getMinutes(),i,2)}function HRe(n,i){return Kn(n.getSeconds(),i,2)}function WRe(n){var i=n.getDay();return i===0?7:i}function zRe(n,i){return Kn(XI.count(dd(n)-1,n),i,2)}function jZ(n){var i=n.getDay();return i>=4||i===0?Mv(n):Mv.ceil(n)}function KRe(n,i){return n=jZ(n),Kn(Mv.count(dd(n),n)+(dd(n).getDay()===4),i,2)}function YRe(n){return n.getDay()}function qRe(n,i){return Kn(uI.count(dd(n)-1,n),i,2)}function XRe(n,i){return Kn(n.getFullYear()%100,i,2)}function JRe(n,i){return n=jZ(n),Kn(n.getFullYear()%100,i,2)}function $Re(n,i){return Kn(n.getFullYear()%1e4,i,4)}function ZRe(n,i){var s=n.getDay();return n=s>=4||s===0?Mv(n):Mv.ceil(n),Kn(n.getFullYear()%1e4,i,4)}function QRe(n){var i=n.getTimezoneOffset();return(i>0?"-":(i*=-1,"+"))+Kn(i/60|0,"0",2)+Kn(i%60,"0",2)}function yY(n,i){return Kn(n.getUTCDate(),i,2)}function eCe(n,i){return Kn(n.getUTCHours(),i,2)}function tCe(n,i){return Kn(n.getUTCHours()%12||12,i,2)}function nCe(n,i){return Kn(1+qI.count(hd(n),n),i,3)}function VZ(n,i){return Kn(n.getUTCMilliseconds(),i,3)}function rCe(n,i){return VZ(n,i)+"000"}function iCe(n,i){return Kn(n.getUTCMonth()+1,i,2)}function aCe(n,i){return Kn(n.getUTCMinutes(),i,2)}function sCe(n,i){return Kn(n.getUTCSeconds(),i,2)}function oCe(n){var i=n.getUTCDay();return i===0?7:i}function cCe(n,i){return Kn(JI.count(hd(n)-1,n),i,2)}function BZ(n){var i=n.getUTCDay();return i>=4||i===0?Uv(n):Uv.ceil(n)}function lCe(n,i){return n=BZ(n),Kn(Uv.count(hd(n),n)+(hd(n).getUTCDay()===4),i,2)}function uCe(n){return n.getUTCDay()}function dCe(n,i){return Kn(dI.count(hd(n)-1,n),i,2)}function hCe(n,i){return Kn(n.getUTCFullYear()%100,i,2)}function fCe(n,i){return n=BZ(n),Kn(n.getUTCFullYear()%100,i,2)}function pCe(n,i){return Kn(n.getUTCFullYear()%1e4,i,4)}function mCe(n,i){var s=n.getUTCDay();return n=s>=4||s===0?Uv(n):Uv.ceil(n),Kn(n.getUTCFullYear()%1e4,i,4)}function gCe(){return"+0000"}function EY(){return"%"}function SY(n){return+n}function bY(n){return Math.floor(+n/1e3)}var gv,FZ,GZ;_Ce({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function _Ce(n){return gv=_Re(n),FZ=gv.format,gv.parse,GZ=gv.utcFormat,gv.utcParse,gv}function vCe(n){return new Date(n)}function yCe(n){return n instanceof Date?+n:+new Date(+n)}function JU(n,i,s,c,f,p,v,b,T,w){var C=MU(),I=C.invert,D=C.domain,L=w(".%L"),F=w(":%S"),W=w("%I:%M"),G=w("%I %p"),$=w("%a %d"),te=w("%b %d"),Z=w("%B"),ce=w("%Y");function se(de){return(T(de)<de?L:b(de)<de?F:v(de)<de?W:p(de)<de?G:c(de)<de?f(de)<de?$:te:s(de)<de?Z:ce)(de)}return C.invert=function(de){return new Date(I(de))},C.domain=function(de){return arguments.length?D(Array.from(de,yCe)):D().map(vCe)},C.ticks=function(de){var oe=D();return n(oe[0],oe[oe.length-1],de??10)},C.tickFormat=function(de,oe){return oe==null?se:w(oe)},C.nice=function(de){var oe=D();return(!de||typeof de.range!="function")&&(de=i(oe[0],oe[oe.length-1],de??10)),de?D(OZ(oe,de)):C},C.copy=function(){return Mb(C,JU(n,i,s,c,f,p,v,b,T,w))},C}function ECe(){return Zo.apply(JU(mRe,gRe,dd,qU,XI,Ub,KU,WU,um,FZ).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function SCe(){return Zo.apply(JU(fRe,pRe,hd,XU,JI,qI,YU,zU,um,GZ).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function $I(){var n=0,i=1,s,c,f,p,v=es,b=!1,T;function w(I){return I==null||isNaN(I=+I)?T:v(f===0?.5:(I=(p(I)-s)*f,b?Math.max(0,Math.min(1,I)):I))}w.domain=function(I){return arguments.length?([n,i]=I,s=p(n=+n),c=p(i=+i),f=s===c?0:1/(c-s),w):[n,i]},w.clamp=function(I){return arguments.length?(b=!!I,w):b},w.interpolator=function(I){return arguments.length?(v=I,w):v};function C(I){return function(D){var L,F;return arguments.length?([L,F]=D,v=I(L,F),w):[v(0),v(1)]}}return w.range=C(qv),w.rangeRound=C(LU),w.unknown=function(I){return arguments.length?(T=I,w):T},function(I){return p=I,s=I(n),c=I(i),f=s===c?0:1/(c-s),w}}function ff(n,i){return i.domain(n.domain()).interpolator(n.interpolator()).clamp(n.clamp()).unknown(n.unknown())}function HZ(){var n=hf($I()(es));return n.copy=function(){return ff(n,HZ())},gd.apply(n,arguments)}function WZ(){var n=VU($I()).domain([1,10]);return n.copy=function(){return ff(n,WZ()).base(n.base())},gd.apply(n,arguments)}function zZ(){var n=BU($I());return n.copy=function(){return ff(n,zZ()).constant(n.constant())},gd.apply(n,arguments)}function $U(){var n=FU($I());return n.copy=function(){return ff(n,$U()).exponent(n.exponent())},gd.apply(n,arguments)}function bCe(){return $U.apply(null,arguments).exponent(.5)}function KZ(){var n=[],i=es;function s(c){if(c!=null&&!isNaN(c=+c))return i((kb(n,c,1)-1)/(n.length-1))}return s.domain=function(c){if(!arguments.length)return n.slice();n=[];for(let f of c)f!=null&&!isNaN(f=+f)&&n.push(f);return n.sort(sf),s},s.interpolator=function(c){return arguments.length?(i=c,s):i},s.range=function(){return n.map((c,f)=>i(f/(n.length-1)))},s.quantiles=function(c){return Array.from({length:c+1},(f,p)=>owe(n,p/c))},s.copy=function(){return KZ(i).domain(n)},gd.apply(s,arguments)}function ZI(){var n=0,i=.5,s=1,c=1,f,p,v,b,T,w=es,C,I=!1,D;function L(W){return isNaN(W=+W)?D:(W=.5+((W=+C(W))-p)*(c*W<c*p?b:T),w(I?Math.max(0,Math.min(1,W)):W))}L.domain=function(W){return arguments.length?([n,i,s]=W,f=C(n=+n),p=C(i=+i),v=C(s=+s),b=f===p?0:.5/(p-f),T=p===v?0:.5/(v-p),c=p<f?-1:1,L):[n,i,s]},L.clamp=function(W){return arguments.length?(I=!!W,L):I},L.interpolator=function(W){return arguments.length?(w=W,L):w};function F(W){return function(G){var $,te,Z;return arguments.length?([$,te,Z]=G,w=kwe(W,[$,te,Z]),L):[w(0),w(.5),w(1)]}}return L.range=F(qv),L.rangeRound=F(LU),L.unknown=function(W){return arguments.length?(D=W,L):D},function(W){return C=W,f=W(n),p=W(i),v=W(s),b=f===p?0:.5/(p-f),T=p===v?0:.5/(v-p),c=p<f?-1:1,L}}function YZ(){var n=hf(ZI()(es));return n.copy=function(){return ff(n,YZ())},gd.apply(n,arguments)}function qZ(){var n=VU(ZI()).domain([.1,1,10]);return n.copy=function(){return ff(n,qZ()).base(n.base())},gd.apply(n,arguments)}function XZ(){var n=BU(ZI());return n.copy=function(){return ff(n,XZ()).constant(n.constant())},gd.apply(n,arguments)}function ZU(){var n=FU(ZI());return n.copy=function(){return ff(n,ZU()).exponent(n.exponent())},gd.apply(n,arguments)}function TCe(){return ZU.apply(null,arguments).exponent(.5)}const YS=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:DU,scaleDiverging:YZ,scaleDivergingLog:qZ,scaleDivergingPow:ZU,scaleDivergingSqrt:TCe,scaleDivergingSymlog:XZ,scaleIdentity:AZ,scaleImplicit:s2,scaleLinear:CZ,scaleLog:IZ,scaleOrdinal:xU,scalePoint:uwe,scalePow:GU,scaleQuantile:DZ,scaleQuantize:PZ,scaleRadial:xZ,scaleSequential:HZ,scaleSequentialLog:WZ,scaleSequentialPow:$U,scaleSequentialQuantile:KZ,scaleSequentialSqrt:bCe,scaleSequentialSymlog:zZ,scaleSqrt:rRe,scaleSymlog:NZ,scaleThreshold:kZ,scaleTime:ECe,scaleUtc:SCe,tickFormat:RZ},Symbol.toStringTag,{value:"Module"}));var pf=n=>n.chartData,wCe=He([pf],n=>{var i=n.chartData!=null?n.chartData.length-1:0;return{chartData:n.chartData,computedData:n.computedData,dataEndIndex:i,dataStartIndex:0}}),QU=(n,i,s,c)=>c?wCe(n):pf(n);function Sm(n){if(Array.isArray(n)&&n.length===2){var[i,s]=n;if(xs(i)&&xs(s))return!0}return!1}function TY(n,i,s){return s?n:[Math.min(n[0],i[0]),Math.max(n[1],i[1])]}function JZ(n,i){if(i&&typeof n!="function"&&Array.isArray(n)&&n.length===2){var[s,c]=n,f,p;if(xs(s))f=s;else if(typeof s=="function")return;if(xs(c))p=c;else if(typeof c=="function")return;var v=[f,p];if(Sm(v))return v}}function RCe(n,i,s){if(!(!s&&i==null)){if(typeof n=="function"&&i!=null)try{var c=n(i,s);if(Sm(c))return TY(c,i,s)}catch{}if(Array.isArray(n)&&n.length===2){var[f,p]=n,v,b;if(f==="auto")i!=null&&(v=Math.min(...i));else if(zt(f))v=f;else if(typeof f=="function")try{i!=null&&(v=f(i?.[0]))}catch{}else if(typeof f=="string"&&c7.test(f)){var T=c7.exec(f);if(T==null||i==null)v=void 0;else{var w=+T[1];v=i[0]-w}}else v=i?.[0];if(p==="auto")i!=null&&(b=Math.max(...i));else if(zt(p))b=p;else if(typeof p=="function")try{i!=null&&(b=p(i?.[1]))}catch{}else if(typeof p=="string"&&l7.test(p)){var C=l7.exec(p);if(C==null||i==null)b=void 0;else{var I=+C[1];b=i[1]+I}}else b=i?.[1];var D=[v,b];if(Sm(D))return i==null?D:TY(D,i,s)}}}var Xv=1e9,CCe={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},tj,Lr=!0,Jo="[DecimalError] ",_m=Jo+"Invalid argument: ",ej=Jo+"Exponent out of range: ",Jv=Math.floor,am=Math.pow,ACe=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,no,Qi=1e7,Or=7,$Z=9007199254740991,hI=Jv($Z/Or),Tt={};Tt.absoluteValue=Tt.abs=function(){var n=new this.constructor(this);return n.s&&(n.s=1),n};Tt.comparedTo=Tt.cmp=function(n){var i,s,c,f,p=this;if(n=new p.constructor(n),p.s!==n.s)return p.s||-n.s;if(p.e!==n.e)return p.e>n.e^p.s<0?1:-1;for(c=p.d.length,f=n.d.length,i=0,s=c<f?c:f;i<s;++i)if(p.d[i]!==n.d[i])return p.d[i]>n.d[i]^p.s<0?1:-1;return c===f?0:c>f^p.s<0?1:-1};Tt.decimalPlaces=Tt.dp=function(){var n=this,i=n.d.length-1,s=(i-n.e)*Or;if(i=n.d[i],i)for(;i%10==0;i/=10)s--;return s<0?0:s};Tt.dividedBy=Tt.div=function(n){return rd(this,new this.constructor(n))};Tt.dividedToIntegerBy=Tt.idiv=function(n){var i=this,s=i.constructor;return mr(rd(i,new s(n),0,1),s.precision)};Tt.equals=Tt.eq=function(n){return!this.cmp(n)};Tt.exponent=function(){return Ci(this)};Tt.greaterThan=Tt.gt=function(n){return this.cmp(n)>0};Tt.greaterThanOrEqualTo=Tt.gte=function(n){return this.cmp(n)>=0};Tt.isInteger=Tt.isint=function(){return this.e>this.d.length-2};Tt.isNegative=Tt.isneg=function(){return this.s<0};Tt.isPositive=Tt.ispos=function(){return this.s>0};Tt.isZero=function(){return this.s===0};Tt.lessThan=Tt.lt=function(n){return this.cmp(n)<0};Tt.lessThanOrEqualTo=Tt.lte=function(n){return this.cmp(n)<1};Tt.logarithm=Tt.log=function(n){var i,s=this,c=s.constructor,f=c.precision,p=f+5;if(n===void 0)n=new c(10);else if(n=new c(n),n.s<1||n.eq(no))throw Error(Jo+"NaN");if(s.s<1)throw Error(Jo+(s.s?"NaN":"-Infinity"));return s.eq(no)?new c(0):(Lr=!1,i=rd(yb(s,p),yb(n,p),p),Lr=!0,mr(i,f))};Tt.minus=Tt.sub=function(n){var i=this;return n=new i.constructor(n),i.s==n.s?eQ(i,n):ZZ(i,(n.s=-n.s,n))};Tt.modulo=Tt.mod=function(n){var i,s=this,c=s.constructor,f=c.precision;if(n=new c(n),!n.s)throw Error(Jo+"NaN");return s.s?(Lr=!1,i=rd(s,n,0,1).times(n),Lr=!0,s.minus(i)):mr(new c(s),f)};Tt.naturalExponential=Tt.exp=function(){return QZ(this)};Tt.naturalLogarithm=Tt.ln=function(){return yb(this)};Tt.negated=Tt.neg=function(){var n=new this.constructor(this);return n.s=-n.s||0,n};Tt.plus=Tt.add=function(n){var i=this;return n=new i.constructor(n),i.s==n.s?ZZ(i,n):eQ(i,(n.s=-n.s,n))};Tt.precision=Tt.sd=function(n){var i,s,c,f=this;if(n!==void 0&&n!==!!n&&n!==1&&n!==0)throw Error(_m+n);if(i=Ci(f)+1,c=f.d.length-1,s=c*Or+1,c=f.d[c],c){for(;c%10==0;c/=10)s--;for(c=f.d[0];c>=10;c/=10)s++}return n&&i>s?i:s};Tt.squareRoot=Tt.sqrt=function(){var n,i,s,c,f,p,v,b=this,T=b.constructor;if(b.s<1){if(!b.s)return new T(0);throw Error(Jo+"NaN")}for(n=Ci(b),Lr=!1,f=Math.sqrt(+b),f==0||f==1/0?(i=zl(b.d),(i.length+n)%2==0&&(i+="0"),f=Math.sqrt(i),n=Jv((n+1)/2)-(n<0||n%2),f==1/0?i="5e"+n:(i=f.toExponential(),i=i.slice(0,i.indexOf("e")+1)+n),c=new T(i)):c=new T(f.toString()),s=T.precision,f=v=s+3;;)if(p=c,c=p.plus(rd(b,p,v+2)).times(.5),zl(p.d).slice(0,v)===(i=zl(c.d)).slice(0,v)){if(i=i.slice(v-3,v+1),f==v&&i=="4999"){if(mr(p,s+1,0),p.times(p).eq(b)){c=p;break}}else if(i!="9999")break;v+=4}return Lr=!0,mr(c,s)};Tt.times=Tt.mul=function(n){var i,s,c,f,p,v,b,T,w,C=this,I=C.constructor,D=C.d,L=(n=new I(n)).d;if(!C.s||!n.s)return new I(0);for(n.s*=C.s,s=C.e+n.e,T=D.length,w=L.length,T<w&&(p=D,D=L,L=p,v=T,T=w,w=v),p=[],v=T+w,c=v;c--;)p.push(0);for(c=w;--c>=0;){for(i=0,f=T+c;f>c;)b=p[f]+L[c]*D[f-c-1]+i,p[f--]=b%Qi|0,i=b/Qi|0;p[f]=(p[f]+i)%Qi|0}for(;!p[--v];)p.pop();return i?++s:p.shift(),n.d=p,n.e=s,Lr?mr(n,I.precision):n};Tt.toDecimalPlaces=Tt.todp=function(n,i){var s=this,c=s.constructor;return s=new c(s),n===void 0?s:($l(n,0,Xv),i===void 0?i=c.rounding:$l(i,0,8),mr(s,n+Ci(s)+1,i))};Tt.toExponential=function(n,i){var s,c=this,f=c.constructor;return n===void 0?s=bm(c,!0):($l(n,0,Xv),i===void 0?i=f.rounding:$l(i,0,8),c=mr(new f(c),n+1,i),s=bm(c,!0,n+1)),s};Tt.toFixed=function(n,i){var s,c,f=this,p=f.constructor;return n===void 0?bm(f):($l(n,0,Xv),i===void 0?i=p.rounding:$l(i,0,8),c=mr(new p(f),n+Ci(f)+1,i),s=bm(c.abs(),!1,n+Ci(c)+1),f.isneg()&&!f.isZero()?"-"+s:s)};Tt.toInteger=Tt.toint=function(){var n=this,i=n.constructor;return mr(new i(n),Ci(n)+1,i.rounding)};Tt.toNumber=function(){return+this};Tt.toPower=Tt.pow=function(n){var i,s,c,f,p,v,b=this,T=b.constructor,w=12,C=+(n=new T(n));if(!n.s)return new T(no);if(b=new T(b),!b.s){if(n.s<1)throw Error(Jo+"Infinity");return b}if(b.eq(no))return b;if(c=T.precision,n.eq(no))return mr(b,c);if(i=n.e,s=n.d.length-1,v=i>=s,p=b.s,v){if((s=C<0?-C:C)<=$Z){for(f=new T(no),i=Math.ceil(c/Or+4),Lr=!1;s%2&&(f=f.times(b),RY(f.d,i)),s=Jv(s/2),s!==0;)b=b.times(b),RY(b.d,i);return Lr=!0,n.s<0?new T(no).div(f):mr(f,c)}}else if(p<0)throw Error(Jo+"NaN");return p=p<0&&n.d[Math.max(i,s)]&1?-1:1,b.s=1,Lr=!1,f=n.times(yb(b,c+w)),Lr=!0,f=QZ(f),f.s=p,f};Tt.toPrecision=function(n,i){var s,c,f=this,p=f.constructor;return n===void 0?(s=Ci(f),c=bm(f,s<=p.toExpNeg||s>=p.toExpPos)):($l(n,1,Xv),i===void 0?i=p.rounding:$l(i,0,8),f=mr(new p(f),n,i),s=Ci(f),c=bm(f,n<=s||s<=p.toExpNeg,n)),c};Tt.toSignificantDigits=Tt.tosd=function(n,i){var s=this,c=s.constructor;return n===void 0?(n=c.precision,i=c.rounding):($l(n,1,Xv),i===void 0?i=c.rounding:$l(i,0,8)),mr(new c(s),n,i)};Tt.toString=Tt.valueOf=Tt.val=Tt.toJSON=Tt[Symbol.for("nodejs.util.inspect.custom")]=function(){var n=this,i=Ci(n),s=n.constructor;return bm(n,i<=s.toExpNeg||i>=s.toExpPos)};function ZZ(n,i){var s,c,f,p,v,b,T,w,C=n.constructor,I=C.precision;if(!n.s||!i.s)return i.s||(i=new C(n)),Lr?mr(i,I):i;if(T=n.d,w=i.d,v=n.e,f=i.e,T=T.slice(),p=v-f,p){for(p<0?(c=T,p=-p,b=w.length):(c=w,f=v,b=T.length),v=Math.ceil(I/Or),b=v>b?v+1:b+1,p>b&&(p=b,c.length=1),c.reverse();p--;)c.push(0);c.reverse()}for(b=T.length,p=w.length,b-p<0&&(p=b,c=w,w=T,T=c),s=0;p;)s=(T[--p]=T[p]+w[p]+s)/Qi|0,T[p]%=Qi;for(s&&(T.unshift(s),++f),b=T.length;T[--b]==0;)T.pop();return i.d=T,i.e=f,Lr?mr(i,I):i}function $l(n,i,s){if(n!==~~n||n<i||n>s)throw Error(_m+n)}function zl(n){var i,s,c,f=n.length-1,p="",v=n[0];if(f>0){for(p+=v,i=1;i<f;i++)c=n[i]+"",s=Or-c.length,s&&(p+=ef(s)),p+=c;v=n[i],c=v+"",s=Or-c.length,s&&(p+=ef(s))}else if(v===0)return"0";for(;v%10===0;)v/=10;return p+v}var rd=(function(){function n(c,f){var p,v=0,b=c.length;for(c=c.slice();b--;)p=c[b]*f+v,c[b]=p%Qi|0,v=p/Qi|0;return v&&c.unshift(v),c}function i(c,f,p,v){var b,T;if(p!=v)T=p>v?1:-1;else for(b=T=0;b<p;b++)if(c[b]!=f[b]){T=c[b]>f[b]?1:-1;break}return T}function s(c,f,p){for(var v=0;p--;)c[p]-=v,v=c[p]<f[p]?1:0,c[p]=v*Qi+c[p]-f[p];for(;!c[0]&&c.length>1;)c.shift()}return function(c,f,p,v){var b,T,w,C,I,D,L,F,W,G,$,te,Z,ce,se,de,oe,ge,Ae=c.constructor,ke=c.s==f.s?1:-1,Ee=c.d,be=f.d;if(!c.s)return new Ae(c);if(!f.s)throw Error(Jo+"Division by zero");for(T=c.e-f.e,oe=be.length,se=Ee.length,L=new Ae(ke),F=L.d=[],w=0;be[w]==(Ee[w]||0);)++w;if(be[w]>(Ee[w]||0)&&--T,p==null?te=p=Ae.precision:v?te=p+(Ci(c)-Ci(f))+1:te=p,te<0)return new Ae(0);if(te=te/Or+2|0,w=0,oe==1)for(C=0,be=be[0],te++;(w<se||C)&&te--;w++)Z=C*Qi+(Ee[w]||0),F[w]=Z/be|0,C=Z%be|0;else{for(C=Qi/(be[0]+1)|0,C>1&&(be=n(be,C),Ee=n(Ee,C),oe=be.length,se=Ee.length),ce=oe,W=Ee.slice(0,oe),G=W.length;G<oe;)W[G++]=0;ge=be.slice(),ge.unshift(0),de=be[0],be[1]>=Qi/2&&++de;do C=0,b=i(be,W,oe,G),b<0?($=W[0],oe!=G&&($=$*Qi+(W[1]||0)),C=$/de|0,C>1?(C>=Qi&&(C=Qi-1),I=n(be,C),D=I.length,G=W.length,b=i(I,W,D,G),b==1&&(C--,s(I,oe<D?ge:be,D))):(C==0&&(b=C=1),I=be.slice()),D=I.length,D<G&&I.unshift(0),s(W,I,G),b==-1&&(G=W.length,b=i(be,W,oe,G),b<1&&(C++,s(W,oe<G?ge:be,G))),G=W.length):b===0&&(C++,W=[0]),F[w++]=C,b&&W[0]?W[G++]=Ee[ce]||0:(W=[Ee[ce]],G=1);while((ce++<se||W[0]!==void 0)&&te--)}return F[0]||F.shift(),L.e=T,mr(L,v?p+Ci(L)+1:p)}})();function QZ(n,i){var s,c,f,p,v,b,T=0,w=0,C=n.constructor,I=C.precision;if(Ci(n)>16)throw Error(ej+Ci(n));if(!n.s)return new C(no);for(Lr=!1,b=I,v=new C(.03125);n.abs().gte(.1);)n=n.times(v),w+=5;for(c=Math.log(am(2,w))/Math.LN10*2+5|0,b+=c,s=f=p=new C(no),C.precision=b;;){if(f=mr(f.times(n),b),s=s.times(++T),v=p.plus(rd(f,s,b)),zl(v.d).slice(0,b)===zl(p.d).slice(0,b)){for(;w--;)p=mr(p.times(p),b);return C.precision=I,i==null?(Lr=!0,mr(p,I)):p}p=v}}function Ci(n){for(var i=n.e*Or,s=n.d[0];s>=10;s/=10)i++;return i}function ZL(n,i,s){if(i>n.LN10.sd())throw Lr=!0,s&&(n.precision=s),Error(Jo+"LN10 precision limit exceeded");return mr(new n(n.LN10),i)}function ef(n){for(var i="";n--;)i+="0";return i}function yb(n,i){var s,c,f,p,v,b,T,w,C,I=1,D=10,L=n,F=L.d,W=L.constructor,G=W.precision;if(L.s<1)throw Error(Jo+(L.s?"NaN":"-Infinity"));if(L.eq(no))return new W(0);if(i==null?(Lr=!1,w=G):w=i,L.eq(10))return i==null&&(Lr=!0),ZL(W,w);if(w+=D,W.precision=w,s=zl(F),c=s.charAt(0),p=Ci(L),Math.abs(p)<15e14){for(;c<7&&c!=1||c==1&&s.charAt(1)>3;)L=L.times(n),s=zl(L.d),c=s.charAt(0),I++;p=Ci(L),c>1?(L=new W("0."+s),p++):L=new W(c+"."+s.slice(1))}else return T=ZL(W,w+2,G).times(p+""),L=yb(new W(c+"."+s.slice(1)),w-D).plus(T),W.precision=G,i==null?(Lr=!0,mr(L,G)):L;for(b=v=L=rd(L.minus(no),L.plus(no),w),C=mr(L.times(L),w),f=3;;){if(v=mr(v.times(C),w),T=b.plus(rd(v,new W(f),w)),zl(T.d).slice(0,w)===zl(b.d).slice(0,w))return b=b.times(2),p!==0&&(b=b.plus(ZL(W,w+2,G).times(p+""))),b=rd(b,new W(I),w),W.precision=G,i==null?(Lr=!0,mr(b,G)):b;b=T,f+=2}}function wY(n,i){var s,c,f;for((s=i.indexOf("."))>-1&&(i=i.replace(".","")),(c=i.search(/e/i))>0?(s<0&&(s=c),s+=+i.slice(c+1),i=i.substring(0,c)):s<0&&(s=i.length),c=0;i.charCodeAt(c)===48;)++c;for(f=i.length;i.charCodeAt(f-1)===48;)--f;if(i=i.slice(c,f),i){if(f-=c,s=s-c-1,n.e=Jv(s/Or),n.d=[],c=(s+1)%Or,s<0&&(c+=Or),c<f){for(c&&n.d.push(+i.slice(0,c)),f-=Or;c<f;)n.d.push(+i.slice(c,c+=Or));i=i.slice(c),c=Or-i.length}else c-=f;for(;c--;)i+="0";if(n.d.push(+i),Lr&&(n.e>hI||n.e<-hI))throw Error(ej+s)}else n.s=0,n.e=0,n.d=[0];return n}function mr(n,i,s){var c,f,p,v,b,T,w,C,I=n.d;for(v=1,p=I[0];p>=10;p/=10)v++;if(c=i-v,c<0)c+=Or,f=i,w=I[C=0];else{if(C=Math.ceil((c+1)/Or),p=I.length,C>=p)return n;for(w=p=I[C],v=1;p>=10;p/=10)v++;c%=Or,f=c-Or+v}if(s!==void 0&&(p=am(10,v-f-1),b=w/p%10|0,T=i<0||I[C+1]!==void 0||w%p,T=s<4?(b||T)&&(s==0||s==(n.s<0?3:2)):b>5||b==5&&(s==4||T||s==6&&(c>0?f>0?w/am(10,v-f):0:I[C-1])%10&1||s==(n.s<0?8:7))),i<1||!I[0])return T?(p=Ci(n),I.length=1,i=i-p-1,I[0]=am(10,(Or-i%Or)%Or),n.e=Jv(-i/Or)||0):(I.length=1,I[0]=n.e=n.s=0),n;if(c==0?(I.length=C,p=1,C--):(I.length=C+1,p=am(10,Or-c),I[C]=f>0?(w/am(10,v-f)%am(10,f)|0)*p:0),T)for(;;)if(C==0){(I[0]+=p)==Qi&&(I[0]=1,++n.e);break}else{if(I[C]+=p,I[C]!=Qi)break;I[C--]=0,p=1}for(c=I.length;I[--c]===0;)I.pop();if(Lr&&(n.e>hI||n.e<-hI))throw Error(ej+Ci(n));return n}function eQ(n,i){var s,c,f,p,v,b,T,w,C,I,D=n.constructor,L=D.precision;if(!n.s||!i.s)return i.s?i.s=-i.s:i=new D(n),Lr?mr(i,L):i;if(T=n.d,I=i.d,c=i.e,w=n.e,T=T.slice(),v=w-c,v){for(C=v<0,C?(s=T,v=-v,b=I.length):(s=I,c=w,b=T.length),f=Math.max(Math.ceil(L/Or),b)+2,v>f&&(v=f,s.length=1),s.reverse(),f=v;f--;)s.push(0);s.reverse()}else{for(f=T.length,b=I.length,C=f<b,C&&(b=f),f=0;f<b;f++)if(T[f]!=I[f]){C=T[f]<I[f];break}v=0}for(C&&(s=T,T=I,I=s,i.s=-i.s),b=T.length,f=I.length-b;f>0;--f)T[b++]=0;for(f=I.length;f>v;){if(T[--f]<I[f]){for(p=f;p&&T[--p]===0;)T[p]=Qi-1;--T[p],T[f]+=Qi}T[f]-=I[f]}for(;T[--b]===0;)T.pop();for(;T[0]===0;T.shift())--c;return T[0]?(i.d=T,i.e=c,Lr?mr(i,L):i):new D(0)}function bm(n,i,s){var c,f=Ci(n),p=zl(n.d),v=p.length;return i?(s&&(c=s-v)>0?p=p.charAt(0)+"."+p.slice(1)+ef(c):v>1&&(p=p.charAt(0)+"."+p.slice(1)),p=p+(f<0?"e":"e+")+f):f<0?(p="0."+ef(-f-1)+p,s&&(c=s-v)>0&&(p+=ef(c))):f>=v?(p+=ef(f+1-v),s&&(c=s-f-1)>0&&(p=p+"."+ef(c))):((c=f+1)<v&&(p=p.slice(0,c)+"."+p.slice(c)),s&&(c=s-v)>0&&(f+1===v&&(p+="."),p+=ef(c))),n.s<0?"-"+p:p}function RY(n,i){if(n.length>i)return n.length=i,!0}function tQ(n){var i,s,c;function f(p){var v=this;if(!(v instanceof f))return new f(p);if(v.constructor=f,p instanceof f){v.s=p.s,v.e=p.e,v.d=(p=p.d)?p.slice():p;return}if(typeof p=="number"){if(p*0!==0)throw Error(_m+p);if(p>0)v.s=1;else if(p<0)p=-p,v.s=-1;else{v.s=0,v.e=0,v.d=[0];return}if(p===~~p&&p<1e7){v.e=0,v.d=[p];return}return wY(v,p.toString())}else if(typeof p!="string")throw Error(_m+p);if(p.charCodeAt(0)===45?(p=p.slice(1),v.s=-1):v.s=1,ACe.test(p))wY(v,p);else throw Error(_m+p)}if(f.prototype=Tt,f.ROUND_UP=0,f.ROUND_DOWN=1,f.ROUND_CEIL=2,f.ROUND_FLOOR=3,f.ROUND_HALF_UP=4,f.ROUND_HALF_DOWN=5,f.ROUND_HALF_EVEN=6,f.ROUND_HALF_CEIL=7,f.ROUND_HALF_FLOOR=8,f.clone=tQ,f.config=f.set=OCe,n===void 0&&(n={}),n)for(c=["precision","rounding","toExpNeg","toExpPos","LN10"],i=0;i<c.length;)n.hasOwnProperty(s=c[i++])||(n[s]=this[s]);return f.config(n),f}function OCe(n){if(!n||typeof n!="object")throw Error(Jo+"Object expected");var i,s,c,f=["precision",1,Xv,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(i=0;i<f.length;i+=3)if((c=n[s=f[i]])!==void 0)if(Jv(c)===c&&c>=f[i+1]&&c<=f[i+2])this[s]=c;else throw Error(_m+s+": "+c);if((c=n[s="LN10"])!==void 0)if(c==Math.LN10)this[s]=new this(c);else throw Error(_m+s+": "+c);return this}var tj=tQ(CCe);no=new tj(1);const ar=tj;var ICe=n=>n,nQ={},rQ=n=>n===nQ,CY=n=>function i(){return arguments.length===0||arguments.length===1&&rQ(arguments.length<=0?void 0:arguments[0])?i:n(...arguments)},iQ=(n,i)=>n===1?i:CY(function(){for(var s=arguments.length,c=new Array(s),f=0;f<s;f++)c[f]=arguments[f];var p=c.filter(v=>v!==nQ).length;return p>=n?i(...c):iQ(n-p,CY(function(){for(var v=arguments.length,b=new Array(v),T=0;T<v;T++)b[T]=arguments[T];var w=c.map(C=>rQ(C)?b.shift():C);return i(...w,...b)}))}),QI=n=>iQ(n.length,n),u2=(n,i)=>{for(var s=[],c=n;c<i;++c)s[c-n]=c;return s},NCe=QI((n,i)=>Array.isArray(i)?i.map(n):Object.keys(i).map(s=>i[s]).map(n)),xCe=function(){for(var i=arguments.length,s=new Array(i),c=0;c<i;c++)s[c]=arguments[c];if(!s.length)return ICe;var f=s.reverse(),p=f[0],v=f.slice(1);return function(){return v.reduce((b,T)=>T(b),p(...arguments))}},d2=n=>Array.isArray(n)?n.reverse():n.split("").reverse().join(""),aQ=n=>{var i=null,s=null;return function(){for(var c=arguments.length,f=new Array(c),p=0;p<c;p++)f[p]=arguments[p];return i&&f.every((v,b)=>{var T;return v===((T=i)===null||T===void 0?void 0:T[b])})||(i=f,s=n(...f)),s}};function sQ(n){var i;return n===0?i=1:i=Math.floor(new ar(n).abs().log(10).toNumber())+1,i}function oQ(n,i,s){for(var c=new ar(n),f=0,p=[];c.lt(i)&&f<1e5;)p.push(c.toNumber()),c=c.add(s),f++;return p}QI((n,i,s)=>{var c=+n,f=+i;return c+s*(f-c)});QI((n,i,s)=>{var c=i-+n;return c=c||1/0,(s-n)/c});QI((n,i,s)=>{var c=i-+n;return c=c||1/0,Math.max(0,Math.min(1,(s-n)/c))});var cQ=n=>{var[i,s]=n,[c,f]=[i,s];return i>s&&([c,f]=[s,i]),[c,f]},lQ=(n,i,s)=>{if(n.lte(0))return new ar(0);var c=sQ(n.toNumber()),f=new ar(10).pow(c),p=n.div(f),v=c!==1?.05:.1,b=new ar(Math.ceil(p.div(v).toNumber())).add(s).mul(v),T=b.mul(f);return i?new ar(T.toNumber()):new ar(Math.ceil(T.toNumber()))},DCe=(n,i,s)=>{var c=new ar(1),f=new ar(n);if(!f.isint()&&s){var p=Math.abs(n);p<1?(c=new ar(10).pow(sQ(n)-1),f=new ar(Math.floor(f.div(c).toNumber())).mul(c)):p>1&&(f=new ar(Math.floor(n)))}else n===0?f=new ar(Math.floor((i-1)/2)):s||(f=new ar(Math.floor(n)));var v=Math.floor((i-1)/2),b=xCe(NCe(T=>f.add(new ar(T-v).mul(c)).toNumber()),u2);return b(0,i)},uQ=function(i,s,c,f){var p=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((s-i)/(c-1)))return{step:new ar(0),tickMin:new ar(0),tickMax:new ar(0)};var v=lQ(new ar(s).sub(i).div(c-1),f,p),b;i<=0&&s>=0?b=new ar(0):(b=new ar(i).add(s).div(2),b=b.sub(new ar(b).mod(v)));var T=Math.ceil(b.sub(i).div(v).toNumber()),w=Math.ceil(new ar(s).sub(b).div(v).toNumber()),C=T+w+1;return C>c?uQ(i,s,c,f,p+1):(C<c&&(w=s>0?w+(c-C):w,T=s>0?T:T+(c-C)),{step:v,tickMin:b.sub(new ar(T).mul(v)),tickMax:b.add(new ar(w).mul(v))})};function PCe(n){var[i,s]=n,c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,p=Math.max(c,2),[v,b]=cQ([i,s]);if(v===-1/0||b===1/0){var T=b===1/0?[v,...u2(0,c-1).map(()=>1/0)]:[...u2(0,c-1).map(()=>-1/0),b];return i>s?d2(T):T}if(v===b)return DCe(v,c,f);var{step:w,tickMin:C,tickMax:I}=uQ(v,b,p,f,0),D=oQ(C,I.add(new ar(.1).mul(w)),w);return i>s?d2(D):D}function kCe(n,i){var[s,c]=n,f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,[p,v]=cQ([s,c]);if(p===-1/0||v===1/0)return[s,c];if(p===v)return[p];var b=Math.max(i,2),T=lQ(new ar(v).sub(p).div(b-1),f,0),w=[...oQ(new ar(p),new ar(v),T),v];return f===!1&&(w=w.map(C=>Math.round(C))),s>c?d2(w):w}var LCe=aQ(PCe),MCe=aQ(kCe),UCe=n=>n.rootProps.barCategoryGap,eN=n=>n.rootProps.stackOffset,nj=n=>n.options.chartName,rj=n=>n.rootProps.syncId,dQ=n=>n.rootProps.syncMethod,ij=n=>n.options.eventEmitter,$u={allowDuplicatedCategory:!0,angleAxisId:0,reversed:!1,scale:"auto",tick:!0,type:"category"},eo={allowDataOverflow:!1,allowDuplicatedCategory:!0,radiusAxisId:0,scale:"auto",tick:!0,tickCount:5,type:"number"},tN=(n,i)=>{if(!(!n||!i))return n!=null&&n.reversed?[i[1],i[0]]:i},jCe={allowDataOverflow:!1,allowDecimals:!1,allowDuplicatedCategory:!1,dataKey:void 0,domain:void 0,id:$u.angleAxisId,includeHidden:!1,name:void 0,reversed:$u.reversed,scale:$u.scale,tick:$u.tick,tickCount:void 0,ticks:void 0,type:$u.type,unit:void 0},VCe={allowDataOverflow:eo.allowDataOverflow,allowDecimals:!1,allowDuplicatedCategory:eo.allowDuplicatedCategory,dataKey:void 0,domain:void 0,id:eo.radiusAxisId,includeHidden:!1,name:void 0,reversed:!1,scale:eo.scale,tick:eo.tick,tickCount:eo.tickCount,ticks:void 0,type:eo.type,unit:void 0},BCe={allowDataOverflow:!1,allowDecimals:!1,allowDuplicatedCategory:$u.allowDuplicatedCategory,dataKey:void 0,domain:void 0,id:$u.angleAxisId,includeHidden:!1,name:void 0,reversed:!1,scale:$u.scale,tick:$u.tick,tickCount:void 0,ticks:void 0,type:"number",unit:void 0},FCe={allowDataOverflow:eo.allowDataOverflow,allowDecimals:!1,allowDuplicatedCategory:eo.allowDuplicatedCategory,dataKey:void 0,domain:void 0,id:eo.radiusAxisId,includeHidden:!1,name:void 0,reversed:!1,scale:eo.scale,tick:eo.tick,tickCount:eo.tickCount,ticks:void 0,type:"category",unit:void 0},aj=(n,i)=>n.polarAxis.angleAxis[i]!=null?n.polarAxis.angleAxis[i]:n.layout.layoutType==="radial"?BCe:jCe,sj=(n,i)=>n.polarAxis.radiusAxis[i]!=null?n.polarAxis.radiusAxis[i]:n.layout.layoutType==="radial"?FCe:VCe,nN=n=>n.polarOptions,oj=He([pd,md,ga],OSe),hQ=He([nN,oj],(n,i)=>{if(n!=null)return cf(n.innerRadius,i,0)}),fQ=He([nN,oj],(n,i)=>{if(n!=null)return cf(n.outerRadius,i,i*.8)}),GCe=n=>{if(n==null)return[0,0];var{startAngle:i,endAngle:s}=n;return[i,s]},pQ=He([nN],GCe);He([aj,pQ],tN);var mQ=He([oj,hQ,fQ],(n,i,s)=>{if(!(n==null||i==null||s==null))return[i,s]});He([sj,mQ],tN);var gQ=He([Nr,nN,hQ,fQ,pd,md],(n,i,s,c,f,p)=>{if(!(n!=="centric"&&n!=="radial"||i==null||s==null||c==null)){var{cx:v,cy:b,startAngle:T,endAngle:w}=i;return{cx:cf(v,f,f/2),cy:cf(b,p,p/2),innerRadius:s,outerRadius:c,startAngle:T,endAngle:w,clockWise:!1}}}),Bi=(n,i)=>i,rN=(n,i,s)=>s;function _Q(n){return n?.id}var Fi=n=>{var i=Nr(n);return i==="horizontal"?"xAxis":i==="vertical"?"yAxis":i==="centric"?"angleAxis":"radiusAxis"},$v=n=>n.tooltip.settings.axisId,Gi=n=>{var i=Fi(n),s=$v(n);return jb(n,i,s)},vQ=He([Gi],n=>n?.dataKey);function yQ(n,i,s){var{chartData:c=[]}=i,{allowDuplicatedCategory:f,dataKey:p}=s,v=new Map;return n.forEach(b=>{var T,w=(T=b.data)!==null&&T!==void 0?T:c;if(!(w==null||w.length===0)){var C=_Q(b);w.forEach((I,D)=>{var L=p==null||f?D:String(ts(I,p,null)),F=ts(I,b.dataKey,0),W;v.has(L)?W=v.get(L):W={},Object.assign(W,{[C]:F}),v.set(L,W)})}}),Array.from(v.values())}function cj(n){return n.stackId!=null&&n.dataKey!=null}var iN=(n,i)=>n===i?!0:n==null||i==null?!1:n[0]===i[0]&&n[1]===i[1];function aN(n,i){return Array.isArray(n)&&Array.isArray(i)&&n.length===0&&i.length===0?!0:n===i}function AY(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(f){return Object.getOwnPropertyDescriptor(n,f).enumerable})),s.push.apply(s,c)}return s}function fI(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?AY(Object(s),!0).forEach(function(c){HCe(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):AY(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}function HCe(n,i,s){return(i=WCe(i))in n?Object.defineProperty(n,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[i]=s,n}function WCe(n){var i=zCe(n,"string");return typeof i=="symbol"?i:i+""}function zCe(n,i){if(typeof n!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var c=s.call(n,i);if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}var h2=[0,"auto"],Zs={allowDataOverflow:!1,allowDecimals:!0,allowDuplicatedCategory:!0,angle:0,dataKey:void 0,domain:void 0,height:30,hide:!0,id:0,includeHidden:!1,interval:"preserveEnd",minTickGap:5,mirror:!1,name:void 0,orientation:"bottom",padding:{left:0,right:0},reversed:!1,scale:"auto",tick:!0,tickCount:5,tickFormatter:void 0,ticks:void 0,type:"category",unit:void 0},EQ=(n,i)=>n.cartesianAxis.xAxis[i],_d=(n,i)=>{var s=EQ(n,i);return s??Zs},Qs={allowDataOverflow:!1,allowDecimals:!0,allowDuplicatedCategory:!0,angle:0,dataKey:void 0,domain:h2,hide:!0,id:0,includeHidden:!1,interval:"preserveEnd",minTickGap:5,mirror:!1,name:void 0,orientation:"left",padding:{top:0,bottom:0},reversed:!1,scale:"auto",tick:!0,tickCount:5,tickFormatter:void 0,ticks:void 0,type:"number",unit:void 0,width:Pb},SQ=(n,i)=>n.cartesianAxis.yAxis[i],vd=(n,i)=>{var s=SQ(n,i);return s??Qs},KCe={domain:[0,"auto"],includeHidden:!1,reversed:!1,allowDataOverflow:!1,allowDuplicatedCategory:!1,dataKey:void 0,id:0,name:"",range:[64,64],scale:"auto",type:"number",unit:""},lj=(n,i)=>{var s=n.cartesianAxis.zAxis[i];return s??KCe},ns=(n,i,s)=>{switch(i){case"xAxis":return _d(n,s);case"yAxis":return vd(n,s);case"zAxis":return lj(n,s);case"angleAxis":return aj(n,s);case"radiusAxis":return sj(n,s);default:throw new Error("Unexpected axis type: ".concat(i))}},YCe=(n,i,s)=>{switch(i){case"xAxis":return _d(n,s);case"yAxis":return vd(n,s);default:throw new Error("Unexpected axis type: ".concat(i))}},jb=(n,i,s)=>{switch(i){case"xAxis":return _d(n,s);case"yAxis":return vd(n,s);case"angleAxis":return aj(n,s);case"radiusAxis":return sj(n,s);default:throw new Error("Unexpected axis type: ".concat(i))}},bQ=n=>n.graphicalItems.cartesianItems.some(i=>i.type==="bar")||n.graphicalItems.polarItems.some(i=>i.type==="radialBar");function TQ(n,i){return s=>{switch(n){case"xAxis":return"xAxisId"in s&&s.xAxisId===i;case"yAxis":return"yAxisId"in s&&s.yAxisId===i;case"zAxis":return"zAxisId"in s&&s.zAxisId===i;case"angleAxis":return"angleAxisId"in s&&s.angleAxisId===i;case"radiusAxis":return"radiusAxisId"in s&&s.radiusAxisId===i;default:return!1}}}var wQ=n=>n.graphicalItems.cartesianItems,qCe=He([Bi,rN],TQ),RQ=(n,i,s)=>n.filter(s).filter(c=>i?.includeHidden===!0?!0:!c.hide),Vb=He([wQ,ns,qCe],RQ,{memoizeOptions:{resultEqualityCheck:aN}}),CQ=He([Vb],n=>n.filter(i=>i.type==="area"||i.type==="bar").filter(cj)),AQ=n=>n.filter(i=>!("stackId"in i)||i.stackId===void 0),XCe=He([Vb],AQ),OQ=n=>n.map(i=>i.data).filter(Boolean).flat(1),JCe=He([Vb],OQ,{memoizeOptions:{resultEqualityCheck:aN}}),IQ=(n,i)=>{var{chartData:s=[],dataStartIndex:c,dataEndIndex:f}=i;return n.length>0?n:s.slice(c,f+1)},uj=He([JCe,QU],IQ),NQ=(n,i,s)=>i?.dataKey!=null?n.map(c=>({value:ts(c,i.dataKey)})):s.length>0?s.map(c=>c.dataKey).flatMap(c=>n.map(f=>({value:ts(f,c)}))):n.map(c=>({value:c})),sN=He([uj,ns,Vb],NQ);function xQ(n,i){switch(n){case"xAxis":return i.direction==="x";case"yAxis":return i.direction==="y";default:return!1}}function NO(n){if(Jl(n)||n instanceof Date){var i=Number(n);if(xs(i))return i}}function OY(n){if(Array.isArray(n)){var i=[NO(n[0]),NO(n[1])];return Sm(i)?i:void 0}var s=NO(n);if(s!=null)return[s,s]}function Zv(n){return n.map(NO).filter(uTe)}function $Ce(n,i,s){return!s||typeof i!="number"||el(i)?[]:s.length?Zv(s.flatMap(c=>{var f=ts(n,c.dataKey),p,v;if(Array.isArray(f)?[p,v]=f:p=v=f,!(!xs(p)||!xs(v)))return[i-p,i+v]})):[]}var ZCe=He([CQ,QU,Gi],yQ),DQ=(n,i,s)=>{var c={},f=i.reduce((p,v)=>(v.stackId==null||(p[v.stackId]==null&&(p[v.stackId]=[]),p[v.stackId].push(v)),p),c);return Object.fromEntries(Object.entries(f).map(p=>{var[v,b]=p,T=b.map(_Q);return[v,{stackedData:HSe(n,T,s),graphicalItems:b}]}))},QCe=He([ZCe,CQ,eN],DQ),PQ=(n,i,s,c)=>{var{dataStartIndex:f,dataEndIndex:p}=i;if(c==null&&s!=="zAxis"){var v=KSe(n,f,p);if(!(v!=null&&v[0]===0&&v[1]===0))return v}},eAe=He([ns],n=>n.allowDataOverflow),dj=n=>{var i;if(n==null||!("domain"in n))return h2;if(n.domain!=null)return n.domain;if(n.ticks!=null){if(n.type==="number"){var s=Zv(n.ticks);return[Math.min(...s),Math.max(...s)]}if(n.type==="category")return n.ticks.map(String)}return(i=n?.domain)!==null&&i!==void 0?i:h2},kQ=He([ns],dj),LQ=He([kQ,eAe],JZ),tAe=He([QCe,pf,Bi,LQ],PQ,{memoizeOptions:{resultEqualityCheck:iN}}),hj=n=>n.errorBars,nAe=(n,i,s)=>n.flatMap(c=>i[c.id]).filter(Boolean).filter(c=>xQ(s,c)),pI=function(){for(var i=arguments.length,s=new Array(i),c=0;c<i;c++)s[c]=arguments[c];var f=s.filter(Boolean);if(f.length!==0){var p=f.flat(),v=Math.min(...p),b=Math.max(...p);return[v,b]}},MQ=(n,i,s,c,f)=>{var p,v;if(s.length>0&&n.forEach(b=>{s.forEach(T=>{var w,C,I=(w=c[T.id])===null||w===void 0?void 0:w.filter($=>xQ(f,$)),D=ts(b,(C=i.dataKey)!==null&&C!==void 0?C:T.dataKey),L=$Ce(b,D,I);if(L.length>=2){var F=Math.min(...L),W=Math.max(...L);(p==null||F<p)&&(p=F),(v==null||W>v)&&(v=W)}var G=OY(D);G!=null&&(p=p==null?G[0]:Math.min(p,G[0]),v=v==null?G[1]:Math.max(v,G[1]))})}),i?.dataKey!=null&&n.forEach(b=>{var T=OY(ts(b,i.dataKey));T!=null&&(p=p==null?T[0]:Math.min(p,T[0]),v=v==null?T[1]:Math.max(v,T[1]))}),xs(p)&&xs(v))return[p,v]},rAe=He([uj,ns,XCe,hj,Bi],MQ,{memoizeOptions:{resultEqualityCheck:iN}});function iAe(n){var{value:i}=n;if(Jl(i)||i instanceof Date)return i}var aAe=(n,i,s)=>{var c=n.map(iAe).filter(f=>f!=null);return s&&(i.dataKey==null||i.allowDuplicatedCategory&&s$(c))?mZ(0,n.length):i.allowDuplicatedCategory?c:Array.from(new Set(c))},UQ=n=>n.referenceElements.dots,Qv=(n,i,s)=>n.filter(c=>c.ifOverflow==="extendDomain").filter(c=>i==="xAxis"?c.xAxisId===s:c.yAxisId===s),sAe=He([UQ,Bi,rN],Qv),jQ=n=>n.referenceElements.areas,oAe=He([jQ,Bi,rN],Qv),VQ=n=>n.referenceElements.lines,cAe=He([VQ,Bi,rN],Qv),BQ=(n,i)=>{var s=Zv(n.map(c=>i==="xAxis"?c.x:c.y));if(s.length!==0)return[Math.min(...s),Math.max(...s)]},lAe=He(sAe,Bi,BQ),FQ=(n,i)=>{var s=Zv(n.flatMap(c=>[i==="xAxis"?c.x1:c.y1,i==="xAxis"?c.x2:c.y2]));if(s.length!==0)return[Math.min(...s),Math.max(...s)]},uAe=He([oAe,Bi],FQ),GQ=(n,i)=>{var s=Zv(n.map(c=>i==="xAxis"?c.x:c.y));if(s.length!==0)return[Math.min(...s),Math.max(...s)]},dAe=He(cAe,Bi,GQ),hAe=He(lAe,dAe,uAe,(n,i,s)=>pI(n,s,i)),HQ=(n,i,s,c,f,p,v,b)=>{if(s!=null)return s;var T=v==="vertical"&&b==="xAxis"||v==="horizontal"&&b==="yAxis",w=T?pI(c,p,f):pI(p,f);return RCe(i,w,n.allowDataOverflow)},fAe=He([ns,kQ,LQ,tAe,rAe,hAe,Nr,Bi],HQ,{memoizeOptions:{resultEqualityCheck:iN}}),pAe=[0,1],WQ=(n,i,s,c,f,p,v)=>{if(!((n==null||s==null||s.length===0)&&v===void 0)){var{dataKey:b,type:T}=n,w=df(i,p);return w&&b==null?mZ(0,s.length):T==="category"?aAe(c,n,w):f==="expand"?pAe:v}},fj=He([ns,Nr,uj,sN,eN,Bi,fAe],WQ),zQ=(n,i,s,c,f)=>{if(n!=null){var{scale:p,type:v}=n;if(p==="auto")return i==="radial"&&f==="radiusAxis"?"band":i==="radial"&&f==="angleAxis"?"linear":v==="category"&&c&&(c.indexOf("LineChart")>=0||c.indexOf("AreaChart")>=0||c.indexOf("ComposedChart")>=0&&!s)?"point":v==="category"?"band":"linear";if(typeof p=="string"){var b="scale".concat(yU(p));return b in YS?b:"point"}}},Bb=He([ns,Nr,bQ,nj,Bi],zQ);function mAe(n){if(n!=null){if(n in YS)return YS[n]();var i="scale".concat(yU(n));if(i in YS)return YS[i]()}}function pj(n,i,s,c){if(!(s==null||c==null)){if(typeof n.scale=="function")return n.scale.copy().domain(s).range(c);var f=mAe(i);if(f!=null){var p=f.domain(s).range(c);return VSe(p),p}}}var KQ=(n,i,s)=>{var c=dj(i);if(!(s!=="auto"&&s!=="linear")){if(i!=null&&i.tickCount&&Array.isArray(c)&&(c[0]==="auto"||c[1]==="auto")&&Sm(n))return LCe(n,i.tickCount,i.allowDecimals);if(i!=null&&i.tickCount&&i.type==="number"&&Sm(n))return MCe(n,i.tickCount,i.allowDecimals)}},mj=He([fj,jb,Bb],KQ),YQ=(n,i,s,c)=>{if(c!=="angleAxis"&&n?.type==="number"&&Sm(i)&&Array.isArray(s)&&s.length>0){var f=i[0],p=s[0],v=i[1],b=s[s.length-1];return[Math.min(f,p),Math.max(v,b)]}return i},gAe=He([ns,fj,mj,Bi],YQ),_Ae=He(sN,ns,(n,i)=>{if(!(!i||i.type!=="number")){var s=1/0,c=Array.from(Zv(n.map(b=>b.value))).sort((b,T)=>b-T);if(c.length<2)return 1/0;var f=c[c.length-1]-c[0];if(f===0)return 1/0;for(var p=0;p<c.length-1;p++){var v=c[p+1]-c[p];s=Math.min(s,v)}return s/f}}),qQ=He(_Ae,Nr,UCe,ga,(n,i,s,c)=>c,(n,i,s,c,f)=>{if(!xs(n))return 0;var p=i==="vertical"?c.height:c.width;if(f==="gap")return n*p/2;if(f==="no-gap"){var v=cf(s,n*p),b=n*p/2;return b-v-(b-v)/p*v}return 0}),vAe=(n,i)=>{var s=_d(n,i);return s==null||typeof s.padding!="string"?0:qQ(n,"xAxis",i,s.padding)},yAe=(n,i)=>{var s=vd(n,i);return s==null||typeof s.padding!="string"?0:qQ(n,"yAxis",i,s.padding)},EAe=He(_d,vAe,(n,i)=>{var s,c;if(n==null)return{left:0,right:0};var{padding:f}=n;return typeof f=="string"?{left:i,right:i}:{left:((s=f.left)!==null&&s!==void 0?s:0)+i,right:((c=f.right)!==null&&c!==void 0?c:0)+i}}),SAe=He(vd,yAe,(n,i)=>{var s,c;if(n==null)return{top:0,bottom:0};var{padding:f}=n;return typeof f=="string"?{top:i,bottom:i}:{top:((s=f.top)!==null&&s!==void 0?s:0)+i,bottom:((c=f.bottom)!==null&&c!==void 0?c:0)+i}}),bAe=He([ga,EAe,WI,HI,(n,i,s)=>s],(n,i,s,c,f)=>{var{padding:p}=c;return f?[p.left,s.width-p.right]:[n.left+i.left,n.left+n.width-i.right]}),TAe=He([ga,Nr,SAe,WI,HI,(n,i,s)=>s],(n,i,s,c,f,p)=>{var{padding:v}=f;return p?[c.height-v.bottom,v.top]:i==="horizontal"?[n.top+n.height-s.bottom,n.top+s.top]:[n.top+s.top,n.top+n.height-s.bottom]}),Fb=(n,i,s,c)=>{var f;switch(i){case"xAxis":return bAe(n,s,c);case"yAxis":return TAe(n,s,c);case"zAxis":return(f=lj(n,s))===null||f===void 0?void 0:f.range;case"angleAxis":return pQ(n);case"radiusAxis":return mQ(n,s);default:return}},XQ=He([ns,Fb],tN),ey=He([ns,Bb,gAe,XQ],pj);He([Vb,hj,Bi],nAe);function JQ(n,i){return n.id<i.id?-1:n.id>i.id?1:0}var oN=(n,i)=>i,cN=(n,i,s)=>s,wAe=He(FI,oN,cN,(n,i,s)=>n.filter(c=>c.orientation===i).filter(c=>c.mirror===s).sort(JQ)),RAe=He(GI,oN,cN,(n,i,s)=>n.filter(c=>c.orientation===i).filter(c=>c.mirror===s).sort(JQ)),$Q=(n,i)=>({width:n.width,height:i.height}),CAe=(n,i)=>{var s=typeof i.width=="number"?i.width:Pb;return{width:s,height:n.height}},AAe=He(ga,_d,$Q),OAe=(n,i,s)=>{switch(i){case"top":return n.top;case"bottom":return s-n.bottom;default:return 0}},IAe=(n,i,s)=>{switch(i){case"left":return n.left;case"right":return s-n.right;default:return 0}},NAe=He(md,ga,wAe,oN,cN,(n,i,s,c,f)=>{var p={},v;return s.forEach(b=>{var T=$Q(i,b);v==null&&(v=OAe(i,c,n));var w=c==="top"&&!f||c==="bottom"&&f;p[b.id]=v-Number(w)*T.height,v+=(w?-1:1)*T.height}),p}),xAe=He(pd,ga,RAe,oN,cN,(n,i,s,c,f)=>{var p={},v;return s.forEach(b=>{var T=CAe(i,b);v==null&&(v=IAe(i,c,n));var w=c==="left"&&!f||c==="right"&&f;p[b.id]=v-Number(w)*T.width,v+=(w?-1:1)*T.width}),p}),DAe=(n,i)=>{var s=_d(n,i);if(s!=null)return NAe(n,s.orientation,s.mirror)},PAe=He([ga,_d,DAe,(n,i)=>i],(n,i,s,c)=>{if(i!=null){var f=s?.[c];return f==null?{x:n.left,y:0}:{x:n.left,y:f}}}),kAe=(n,i)=>{var s=vd(n,i);if(s!=null)return xAe(n,s.orientation,s.mirror)},LAe=He([ga,vd,kAe,(n,i)=>i],(n,i,s,c)=>{if(i!=null){var f=s?.[c];return f==null?{x:0,y:n.top}:{x:f,y:n.top}}}),MAe=He(ga,vd,(n,i)=>{var s=typeof i.width=="number"?i.width:Pb;return{width:s,height:n.height}}),ZQ=(n,i,s,c)=>{if(s!=null){var{allowDuplicatedCategory:f,type:p,dataKey:v}=s,b=df(n,c),T=i.map(w=>w.value);if(v&&b&&p==="category"&&f&&s$(T))return T}},gj=He([Nr,sN,ns,Bi],ZQ),QQ=(n,i,s,c)=>{if(!(s==null||s.dataKey==null)){var{type:f,scale:p}=s,v=df(n,c);if(v&&(f==="number"||p!=="auto"))return i.map(b=>b.value)}},_j=He([Nr,sN,jb,Bi],QQ),IY=He([Nr,YCe,Bb,ey,gj,_j,Fb,mj,Bi],(n,i,s,c,f,p,v,b,T)=>{if(i==null)return null;var w=df(n,T);return{angle:i.angle,interval:i.interval,minTickGap:i.minTickGap,orientation:i.orientation,tick:i.tick,tickCount:i.tickCount,tickFormatter:i.tickFormatter,ticks:i.ticks,type:i.type,unit:i.unit,axisType:T,categoricalDomain:p,duplicateDomain:f,isCategorical:w,niceTicks:b,range:v,realScaleType:s,scale:c}}),UAe=(n,i,s,c,f,p,v,b,T)=>{if(!(i==null||c==null)){var w=df(n,T),{type:C,ticks:I,tickCount:D}=i,L=s==="scaleBand"&&typeof c.bandwidth=="function"?c.bandwidth()/2:2,F=C==="category"&&c.bandwidth?c.bandwidth()/L:0;F=T==="angleAxis"&&p!=null&&p.length>=2?Wo(p[0]-p[1])*2*F:F;var W=I||f;if(W){var G=W.map(($,te)=>{var Z=v?v.indexOf($):$;return{index:te,coordinate:c(Z)+F,value:$,offset:F}});return G.filter($=>!el($.coordinate))}return w&&b?b.map(($,te)=>({coordinate:c($)+F,value:$,index:te,offset:F})):c.ticks?c.ticks(D).map($=>({coordinate:c($)+F,value:$,offset:F})):c.domain().map(($,te)=>({coordinate:c($)+F,value:v?v[$]:$,index:te,offset:F}))}},eee=He([Nr,jb,Bb,ey,mj,Fb,gj,_j,Bi],UAe),jAe=(n,i,s,c,f,p,v)=>{if(!(i==null||s==null||c==null||c[0]===c[1])){var b=df(n,v),{tickCount:T}=i,w=0;return w=v==="angleAxis"&&c?.length>=2?Wo(c[0]-c[1])*2*w:w,b&&p?p.map((C,I)=>({coordinate:s(C)+w,value:C,index:I,offset:w})):s.ticks?s.ticks(T).map(C=>({coordinate:s(C)+w,value:C,offset:w})):s.domain().map((C,I)=>({coordinate:s(C)+w,value:f?f[C]:C,index:I,offset:w}))}},tee=He([Nr,jb,ey,Fb,gj,_j,Bi],jAe),nee=He(ns,ey,(n,i)=>{if(!(n==null||i==null))return fI(fI({},n),{},{scale:i})}),VAe=He([ns,Bb,fj,XQ],pj);He((n,i,s)=>lj(n,s),VAe,(n,i)=>{if(!(n==null||i==null))return fI(fI({},n),{},{scale:i})});var BAe=He([Nr,FI,GI],(n,i,s)=>{switch(n){case"horizontal":return i.some(c=>c.reversed)?"right-to-left":"left-to-right";case"vertical":return s.some(c=>c.reversed)?"bottom-to-top":"top-to-bottom";case"centric":case"radial":return"left-to-right";default:return}}),ree=n=>n.options.defaultTooltipEventType,iee=n=>n.options.validateTooltipEventTypes;function aee(n,i,s){if(n==null)return i;var c=n?"axis":"item";return s==null?i:s.includes(c)?c:i}function vj(n,i){var s=ree(n),c=iee(n);return aee(i,s,c)}function FAe(n){return Ft(i=>vj(i,n))}var see=(n,i)=>{var s,c=Number(i);if(!(el(c)||i==null))return c>=0?n==null||(s=n[c])===null||s===void 0?void 0:s.value:void 0},GAe=n=>n.tooltip.settings,rf={active:!1,index:null,dataKey:void 0,coordinate:void 0},HAe={itemInteraction:{click:rf,hover:rf},axisInteraction:{click:rf,hover:rf},keyboardInteraction:rf,syncInteraction:{active:!1,index:null,dataKey:void 0,label:void 0,coordinate:void 0,sourceViewBox:void 0},tooltipItemPayloads:[],settings:{shared:void 0,trigger:"hover",axisId:0,active:!1,defaultIndex:void 0}},oee=so({name:"tooltip",initialState:HAe,reducers:{addTooltipEntrySettings:{reducer(n,i){n.tooltipItemPayloads.push(i.payload)},prepare:Za()},removeTooltipEntrySettings:{reducer(n,i){var s=nd(n).tooltipItemPayloads.indexOf(i.payload);s>-1&&n.tooltipItemPayloads.splice(s,1)},prepare:Za()},setTooltipSettingsState(n,i){n.settings=i.payload},setActiveMouseOverItemIndex(n,i){n.syncInteraction.active=!1,n.keyboardInteraction.active=!1,n.itemInteraction.hover.active=!0,n.itemInteraction.hover.index=i.payload.activeIndex,n.itemInteraction.hover.dataKey=i.payload.activeDataKey,n.itemInteraction.hover.coordinate=i.payload.activeCoordinate},mouseLeaveChart(n){n.itemInteraction.hover.active=!1,n.axisInteraction.hover.active=!1},mouseLeaveItem(n){n.itemInteraction.hover.active=!1},setActiveClickItemIndex(n,i){n.syncInteraction.active=!1,n.itemInteraction.click.active=!0,n.keyboardInteraction.active=!1,n.itemInteraction.click.index=i.payload.activeIndex,n.itemInteraction.click.dataKey=i.payload.activeDataKey,n.itemInteraction.click.coordinate=i.payload.activeCoordinate},setMouseOverAxisIndex(n,i){n.syncInteraction.active=!1,n.axisInteraction.hover.active=!0,n.keyboardInteraction.active=!1,n.axisInteraction.hover.index=i.payload.activeIndex,n.axisInteraction.hover.dataKey=i.payload.activeDataKey,n.axisInteraction.hover.coordinate=i.payload.activeCoordinate},setMouseClickAxisIndex(n,i){n.syncInteraction.active=!1,n.keyboardInteraction.active=!1,n.axisInteraction.click.active=!0,n.axisInteraction.click.index=i.payload.activeIndex,n.axisInteraction.click.dataKey=i.payload.activeDataKey,n.axisInteraction.click.coordinate=i.payload.activeCoordinate},setSyncInteraction(n,i){n.syncInteraction=i.payload},setKeyboardInteraction(n,i){n.keyboardInteraction.active=i.payload.active,n.keyboardInteraction.index=i.payload.activeIndex,n.keyboardInteraction.coordinate=i.payload.activeCoordinate,n.keyboardInteraction.dataKey=i.payload.activeDataKey}}}),{addTooltipEntrySettings:WAe,removeTooltipEntrySettings:zAe,setTooltipSettingsState:KAe,setActiveMouseOverItemIndex:YAe,mouseLeaveItem:DPe,mouseLeaveChart:cee,setActiveClickItemIndex:PPe,setMouseOverAxisIndex:lee,setMouseClickAxisIndex:qAe,setSyncInteraction:f2,setKeyboardInteraction:p2}=oee.actions,XAe=oee.reducer;function NY(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(f){return Object.getOwnPropertyDescriptor(n,f).enumerable})),s.push.apply(s,c)}return s}function yO(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?NY(Object(s),!0).forEach(function(c){JAe(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):NY(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}function JAe(n,i,s){return(i=$Ae(i))in n?Object.defineProperty(n,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[i]=s,n}function $Ae(n){var i=ZAe(n,"string");return typeof i=="symbol"?i:i+""}function ZAe(n,i){if(typeof n!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var c=s.call(n,i);if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}function QAe(n,i,s){return i==="axis"?s==="click"?n.axisInteraction.click:n.axisInteraction.hover:s==="click"?n.itemInteraction.click:n.itemInteraction.hover}function eOe(n){return n.index!=null}var uee=(n,i,s,c)=>{if(i==null)return rf;var f=QAe(n,i,s);if(f==null)return rf;if(f.active)return f;if(n.keyboardInteraction.active)return n.keyboardInteraction;if(n.syncInteraction.active&&n.syncInteraction.index!=null)return n.syncInteraction;var p=n.settings.active===!0;if(eOe(f)){if(p)return yO(yO({},f),{},{active:!0})}else if(c!=null)return{active:!0,coordinate:void 0,dataKey:void 0,index:c};return yO(yO({},rf),{},{coordinate:f.coordinate})},yj=(n,i)=>{var s=n?.index;if(s==null)return null;var c=Number(s);if(!xs(c))return s;var f=0,p=1/0;return i.length>0&&(p=i.length-1),String(Math.max(f,Math.min(c,p)))},dee=(n,i,s,c,f,p,v,b)=>{if(!(p==null||b==null)){var T=v[0],w=T==null?void 0:b(T.positions,p);if(w!=null)return w;var C=f?.[Number(p)];if(C)switch(s){case"horizontal":return{x:C.coordinate,y:(c.top+i)/2};default:return{x:(c.left+n)/2,y:C.coordinate}}}},hee=(n,i,s,c)=>{if(i==="axis")return n.tooltipItemPayloads;if(n.tooltipItemPayloads.length===0)return[];var f;return s==="hover"?f=n.itemInteraction.hover.dataKey:f=n.itemInteraction.click.dataKey,f==null&&c!=null?[n.tooltipItemPayloads[0]]:n.tooltipItemPayloads.filter(p=>{var v;return((v=p.settings)===null||v===void 0?void 0:v.dataKey)===f})},Gb=n=>n.options.tooltipPayloadSearcher,ty=n=>n.tooltip;function xY(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(f){return Object.getOwnPropertyDescriptor(n,f).enumerable})),s.push.apply(s,c)}return s}function DY(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?xY(Object(s),!0).forEach(function(c){tOe(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):xY(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}function tOe(n,i,s){return(i=nOe(i))in n?Object.defineProperty(n,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[i]=s,n}function nOe(n){var i=rOe(n,"string");return typeof i=="symbol"?i:i+""}function rOe(n,i){if(typeof n!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var c=s.call(n,i);if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}function iOe(n,i){return n??i}var fee=(n,i,s,c,f,p,v)=>{if(!(i==null||p==null)){var{chartData:b,computedData:T,dataStartIndex:w,dataEndIndex:C}=s,I=[];return n.reduce((D,L)=>{var F,{dataDefinedOnItem:W,settings:G}=L,$=iOe(W,b),te=Array.isArray($)?Y$($,w,C):$,Z=(F=G?.dataKey)!==null&&F!==void 0?F:c,ce=G?.nameKey,se;if(c&&Array.isArray(te)&&!Array.isArray(te[0])&&v==="axis"?se=o$(te,c,f):se=p(te,i,T,ce),Array.isArray(se))se.forEach(oe=>{var ge=DY(DY({},G),{},{name:oe.name,unit:oe.unit,color:void 0,fill:void 0});D.push(u7({tooltipEntrySettings:ge,dataKey:oe.dataKey,payload:oe.payload,value:ts(oe.payload,oe.dataKey),name:oe.name}))});else{var de;D.push(u7({tooltipEntrySettings:G,dataKey:Z,payload:se,value:ts(se,Z),name:(de=ts(se,ce))!==null&&de!==void 0?de:G?.name}))}return D},I)}},Ej=He([Gi,Nr,bQ,nj,Fi],zQ),aOe=He([n=>n.graphicalItems.cartesianItems,n=>n.graphicalItems.polarItems],(n,i)=>[...n,...i]),sOe=He([Fi,$v],TQ),Hb=He([aOe,Gi,sOe],RQ,{memoizeOptions:{resultEqualityCheck:aN}}),oOe=He([Hb],n=>n.filter(cj)),cOe=He([Hb],OQ,{memoizeOptions:{resultEqualityCheck:aN}}),ny=He([cOe,pf],IQ),lOe=He([oOe,pf,Gi],yQ),Sj=He([ny,Gi,Hb],NQ),pee=He([Gi],dj),uOe=He([Gi],n=>n.allowDataOverflow),mee=He([pee,uOe],JZ),dOe=He([Hb],n=>n.filter(cj)),hOe=He([lOe,dOe,eN],DQ),fOe=He([hOe,pf,Fi,mee],PQ),pOe=He([Hb],AQ),mOe=He([ny,Gi,pOe,hj,Fi],MQ,{memoizeOptions:{resultEqualityCheck:iN}}),gOe=He([UQ,Fi,$v],Qv),_Oe=He([gOe,Fi],BQ),vOe=He([jQ,Fi,$v],Qv),yOe=He([vOe,Fi],FQ),EOe=He([VQ,Fi,$v],Qv),SOe=He([EOe,Fi],GQ),bOe=He([_Oe,SOe,yOe],pI),TOe=He([Gi,pee,mee,fOe,mOe,bOe,Nr,Fi],HQ),gee=He([Gi,Nr,ny,Sj,eN,Fi,TOe],WQ),wOe=He([gee,Gi,Ej],KQ),ROe=He([Gi,gee,wOe,Fi],YQ),_ee=n=>{var i=Fi(n),s=$v(n),c=!1;return Fb(n,i,s,c)},vee=He([Gi,_ee],tN),yee=He([Gi,Ej,ROe,vee],pj),COe=He([Nr,Sj,Gi,Fi],ZQ),AOe=He([Nr,Sj,Gi,Fi],QQ),OOe=(n,i,s,c,f,p,v,b)=>{if(i){var{type:T}=i,w=df(n,b);if(c){var C=s==="scaleBand"&&c.bandwidth?c.bandwidth()/2:2,I=T==="category"&&c.bandwidth?c.bandwidth()/C:0;return I=b==="angleAxis"&&f!=null&&f?.length>=2?Wo(f[0]-f[1])*2*I:I,w&&v?v.map((D,L)=>({coordinate:c(D)+I,value:D,index:L,offset:I})):c.domain().map((D,L)=>({coordinate:c(D)+I,value:p?p[D]:D,index:L,offset:I}))}}},yd=He([Nr,Gi,Ej,yee,_ee,COe,AOe,Fi],OOe),bj=He([ree,iee,GAe],(n,i,s)=>aee(s.shared,n,i)),Eee=n=>n.tooltip.settings.trigger,Tj=n=>n.tooltip.settings.defaultIndex,lN=He([ty,bj,Eee,Tj],uee),Eb=He([lN,ny],yj),See=He([yd,Eb],see),IOe=He([lN],n=>{if(n)return n.dataKey}),bee=He([ty,bj,Eee,Tj],hee),NOe=He([pd,md,Nr,ga,yd,Tj,bee,Gb],dee),xOe=He([lN,NOe],(n,i)=>n!=null&&n.coordinate?n.coordinate:i),DOe=He([lN],n=>n.active),POe=He([bee,Eb,pf,vQ,See,Gb,bj],fee),kOe=He([POe],n=>{if(n!=null){var i=n.map(s=>s.payload).filter(s=>s!=null);return Array.from(new Set(i))}});function PY(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(f){return Object.getOwnPropertyDescriptor(n,f).enumerable})),s.push.apply(s,c)}return s}function kY(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?PY(Object(s),!0).forEach(function(c){LOe(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):PY(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}function LOe(n,i,s){return(i=MOe(i))in n?Object.defineProperty(n,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[i]=s,n}function MOe(n){var i=UOe(n,"string");return typeof i=="symbol"?i:i+""}function UOe(n,i){if(typeof n!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var c=s.call(n,i);if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}var jOe=()=>Ft(Gi),VOe=()=>{var n=jOe(),i=Ft(yd),s=Ft(yee);return XM(kY(kY({},n),{},{scale:s}),i)},BOe=()=>Ft(nj),wj=(n,i)=>i,Tee=(n,i,s)=>s,Rj=(n,i,s,c)=>c,FOe=He(yd,n=>LI(n,i=>i.coordinate)),Cj=He([ty,wj,Tee,Rj],uee),wee=He([Cj,ny],yj),GOe=(n,i,s)=>{if(i!=null){var c=ty(n);return i==="axis"?s==="hover"?c.axisInteraction.hover.dataKey:c.axisInteraction.click.dataKey:s==="hover"?c.itemInteraction.hover.dataKey:c.itemInteraction.click.dataKey}},Ree=He([ty,wj,Tee,Rj],hee),mI=He([pd,md,Nr,ga,yd,Rj,Ree,Gb],dee),HOe=He([Cj,mI],(n,i)=>{var s;return(s=n.coordinate)!==null&&s!==void 0?s:i}),Cee=He(yd,wee,see),WOe=He([Ree,wee,pf,vQ,Cee,Gb,wj],fee),zOe=He([Cj],n=>({isActive:n.active,activeIndex:n.index})),KOe=(n,i,s,c,f,p,v,b)=>{if(!(!n||!i||!c||!f||!p)){var T=YSe(n.chartX,n.chartY,i,s,b);if(T){var w=XSe(T,i),C=USe(w,v,p,c,f),I=qSe(i,p,C,T);return{activeIndex:String(C),activeCoordinate:I}}}};function m2(){return m2=Object.assign?Object.assign.bind():function(n){for(var i=1;i<arguments.length;i++){var s=arguments[i];for(var c in s)({}).hasOwnProperty.call(s,c)&&(n[c]=s[c])}return n},m2.apply(null,arguments)}function LY(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(f){return Object.getOwnPropertyDescriptor(n,f).enumerable})),s.push.apply(s,c)}return s}function EO(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?LY(Object(s),!0).forEach(function(c){YOe(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):LY(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}function YOe(n,i,s){return(i=qOe(i))in n?Object.defineProperty(n,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[i]=s,n}function qOe(n){var i=XOe(n,"string");return typeof i=="symbol"?i:i+""}function XOe(n,i){if(typeof n!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var c=s.call(n,i);if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}function JOe(n){var{coordinate:i,payload:s,index:c,offset:f,tooltipAxisBandSize:p,layout:v,cursor:b,tooltipEventType:T,chartName:w}=n,C=i,I=s,D=c;if(!b||!C||w!=="ScatterChart"&&T!=="axis")return null;var L,F;if(w==="ScatterChart")L=C,F=rTe;else if(w==="BarChart")L=iTe(v,C,f,p),F=VTe;else if(v==="radial"){var{cx:W,cy:G,radius:$,startAngle:te,endAngle:Z}=fZ(C);L={cx:W,cy:G,startAngle:te,endAngle:Z,innerRadius:$,outerRadius:$},F=HTe}else L={points:WTe(v,C,f)},F=oZ;var ce=typeof b=="object"&&"className"in b?b.className:void 0,se=EO(EO(EO(EO({stroke:"#ccc",pointerEvents:"none"},f),L),xI(b)),{},{payload:I,payloadIndex:D,className:Ir("recharts-tooltip-cursor",ce)});return j.isValidElement(b)?j.cloneElement(b,se):j.createElement(F,se)}function $Oe(n){var i=VOe(),s=nZ(),c=IU(),f=BOe();return j.createElement(JOe,m2({},n,{coordinate:n.coordinate,index:n.index,payload:n.payload,offset:s,layout:c,tooltipAxisBandSize:i,chartName:f}))}var Aee=j.createContext(null),ZOe=()=>j.useContext(Aee),QL={exports:{}},MY;function QOe(){return MY||(MY=1,(function(n){var i=Object.prototype.hasOwnProperty,s="~";function c(){}Object.create&&(c.prototype=Object.create(null),new c().__proto__||(s=!1));function f(T,w,C){this.fn=T,this.context=w,this.once=C||!1}function p(T,w,C,I,D){if(typeof C!="function")throw new TypeError("The listener must be a function");var L=new f(C,I||T,D),F=s?s+w:w;return T._events[F]?T._events[F].fn?T._events[F]=[T._events[F],L]:T._events[F].push(L):(T._events[F]=L,T._eventsCount++),T}function v(T,w){--T._eventsCount===0?T._events=new c:delete T._events[w]}function b(){this._events=new c,this._eventsCount=0}b.prototype.eventNames=function(){var w=[],C,I;if(this._eventsCount===0)return w;for(I in C=this._events)i.call(C,I)&&w.push(s?I.slice(1):I);return Object.getOwnPropertySymbols?w.concat(Object.getOwnPropertySymbols(C)):w},b.prototype.listeners=function(w){var C=s?s+w:w,I=this._events[C];if(!I)return[];if(I.fn)return[I.fn];for(var D=0,L=I.length,F=new Array(L);D<L;D++)F[D]=I[D].fn;return F},b.prototype.listenerCount=function(w){var C=s?s+w:w,I=this._events[C];return I?I.fn?1:I.length:0},b.prototype.emit=function(w,C,I,D,L,F){var W=s?s+w:w;if(!this._events[W])return!1;var G=this._events[W],$=arguments.length,te,Z;if(G.fn){switch(G.once&&this.removeListener(w,G.fn,void 0,!0),$){case 1:return G.fn.call(G.context),!0;case 2:return G.fn.call(G.context,C),!0;case 3:return G.fn.call(G.context,C,I),!0;case 4:return G.fn.call(G.context,C,I,D),!0;case 5:return G.fn.call(G.context,C,I,D,L),!0;case 6:return G.fn.call(G.context,C,I,D,L,F),!0}for(Z=1,te=new Array($-1);Z<$;Z++)te[Z-1]=arguments[Z];G.fn.apply(G.context,te)}else{var ce=G.length,se;for(Z=0;Z<ce;Z++)switch(G[Z].once&&this.removeListener(w,G[Z].fn,void 0,!0),$){case 1:G[Z].fn.call(G[Z].context);break;case 2:G[Z].fn.call(G[Z].context,C);break;case 3:G[Z].fn.call(G[Z].context,C,I);break;case 4:G[Z].fn.call(G[Z].context,C,I,D);break;default:if(!te)for(se=1,te=new Array($-1);se<$;se++)te[se-1]=arguments[se];G[Z].fn.apply(G[Z].context,te)}}return!0},b.prototype.on=function(w,C,I){return p(this,w,C,I,!1)},b.prototype.once=function(w,C,I){return p(this,w,C,I,!0)},b.prototype.removeListener=function(w,C,I,D){var L=s?s+w:w;if(!this._events[L])return this;if(!C)return v(this,L),this;var F=this._events[L];if(F.fn)F.fn===C&&(!D||F.once)&&(!I||F.context===I)&&v(this,L);else{for(var W=0,G=[],$=F.length;W<$;W++)(F[W].fn!==C||D&&!F[W].once||I&&F[W].context!==I)&&G.push(F[W]);G.length?this._events[L]=G.length===1?G[0]:G:v(this,L)}return this},b.prototype.removeAllListeners=function(w){var C;return w?(C=s?s+w:w,this._events[C]&&v(this,C)):(this._events=new c,this._eventsCount=0),this},b.prototype.off=b.prototype.removeListener,b.prototype.addListener=b.prototype.on,b.prefixed=s,b.EventEmitter=b,n.exports=b})(QL)),QL.exports}var eIe=QOe();const tIe=fd(eIe);var Sb=new tIe,g2="recharts.syncEvent.tooltip",UY="recharts.syncEvent.brush";function nIe(n,i){if(i){var s=Number.parseInt(i,10);if(!el(s))return n?.[s]}}var rIe={chartName:"",tooltipPayloadSearcher:void 0,eventEmitter:void 0,defaultTooltipEventType:"axis"},Oee=so({name:"options",initialState:rIe,reducers:{createEventEmitter:n=>{n.eventEmitter==null&&(n.eventEmitter=Symbol("rechartsEventEmitter"))}}}),iIe=Oee.reducer,{createEventEmitter:aIe}=Oee.actions;function sIe(n){return n.tooltip.syncInteraction}var oIe={chartData:void 0,computedData:void 0,dataStartIndex:0,dataEndIndex:0},Iee=so({name:"chartData",initialState:oIe,reducers:{setChartData(n,i){if(n.chartData=i.payload,i.payload==null){n.dataStartIndex=0,n.dataEndIndex=0;return}i.payload.length>0&&n.dataEndIndex!==i.payload.length-1&&(n.dataEndIndex=i.payload.length-1)},setComputedData(n,i){n.computedData=i.payload},setDataStartEndIndexes(n,i){var{startIndex:s,endIndex:c}=i.payload;s!=null&&(n.dataStartIndex=s),c!=null&&(n.dataEndIndex=c)}}}),{setChartData:jY,setDataStartEndIndexes:cIe,setComputedData:kPe}=Iee.actions,lIe=Iee.reducer,uIe=["x","y"];function VY(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(f){return Object.getOwnPropertyDescriptor(n,f).enumerable})),s.push.apply(s,c)}return s}function _v(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?VY(Object(s),!0).forEach(function(c){dIe(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):VY(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}function dIe(n,i,s){return(i=hIe(i))in n?Object.defineProperty(n,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[i]=s,n}function hIe(n){var i=fIe(n,"string");return typeof i=="symbol"?i:i+""}function fIe(n,i){if(typeof n!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var c=s.call(n,i);if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}function pIe(n,i){if(n==null)return{};var s,c,f=mIe(n,i);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);for(c=0;c<p.length;c++)s=p[c],i.indexOf(s)===-1&&{}.propertyIsEnumerable.call(n,s)&&(f[s]=n[s])}return f}function mIe(n,i){if(n==null)return{};var s={};for(var c in n)if({}.hasOwnProperty.call(n,c)){if(i.indexOf(c)!==-1)continue;s[c]=n[c]}return s}var Nee=()=>{};function gIe(){var n=Ft(rj),i=Ft(ij),s=La(),c=Ft(dQ),f=Ft(yd),p=IU(),v=zI(),b=Ft(T=>T.rootProps.className);j.useEffect(()=>{if(n==null)return Nee;var T=(w,C,I)=>{if(i!==I&&n===w){if(c==="index"){var D;if(v&&C!==null&&C!==void 0&&(D=C.payload)!==null&&D!==void 0&&D.coordinate&&C.payload.sourceViewBox){var L=C.payload.coordinate,{x:F,y:W}=L,G=pIe(L,uIe),{x:$,y:te,width:Z,height:ce}=C.payload.sourceViewBox,se=_v(_v({},G),{},{x:v.x+(Z?(F-$)/Z:0)*v.width,y:v.y+(ce?(W-te)/ce:0)*v.height});s(_v(_v({},C),{},{payload:_v(_v({},C.payload),{},{coordinate:se})}))}else s(C);return}if(f!=null){var de;if(typeof c=="function"){var oe={activeTooltipIndex:C.payload.index==null?void 0:Number(C.payload.index),isTooltipActive:C.payload.active,activeIndex:C.payload.index==null?void 0:Number(C.payload.index),activeLabel:C.payload.label,activeDataKey:C.payload.dataKey,activeCoordinate:C.payload.coordinate},ge=c(f,oe);de=f[ge]}else c==="value"&&(de=f.find(he=>String(he.value)===C.payload.label));var{coordinate:Ae}=C.payload;if(de==null||C.payload.active===!1||Ae==null||v==null){s(f2({active:!1,coordinate:void 0,dataKey:void 0,index:null,label:void 0,sourceViewBox:void 0}));return}var{x:ke,y:Ee}=Ae,be=Math.min(ke,v.x+v.width),Le=Math.min(Ee,v.y+v.height),et={x:p==="horizontal"?de.coordinate:be,y:p==="horizontal"?Le:de.coordinate},rt=f2({active:C.payload.active,coordinate:et,dataKey:C.payload.dataKey,index:String(de.index),label:C.payload.label,sourceViewBox:C.payload.sourceViewBox});s(rt)}}};return Sb.on(g2,T),()=>{Sb.off(g2,T)}},[b,s,i,n,c,f,p,v])}function _Ie(){var n=Ft(rj),i=Ft(ij),s=La();j.useEffect(()=>{if(n==null)return Nee;var c=(f,p,v)=>{i!==v&&n===f&&s(cIe(p))};return Sb.on(UY,c),()=>{Sb.off(UY,c)}},[s,i,n])}function vIe(){var n=La();j.useEffect(()=>{n(aIe())},[n]),gIe(),_Ie()}function yIe(n,i,s,c,f,p){var v=Ft(L=>GOe(L,n,i)),b=Ft(ij),T=Ft(rj),w=Ft(dQ),C=Ft(sIe),I=C?.active,D=zI();j.useEffect(()=>{if(!I&&T!=null&&b!=null){var L=f2({active:p,coordinate:s,dataKey:v,index:f,label:typeof c=="number"?String(c):c,sourceViewBox:D});Sb.emit(g2,T,L,b)}},[I,s,v,f,c,b,T,w,p,D])}function BY(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(f){return Object.getOwnPropertyDescriptor(n,f).enumerable})),s.push.apply(s,c)}return s}function FY(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?BY(Object(s),!0).forEach(function(c){EIe(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):BY(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}function EIe(n,i,s){return(i=SIe(i))in n?Object.defineProperty(n,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[i]=s,n}function SIe(n){var i=bIe(n,"string");return typeof i=="symbol"?i:i+""}function bIe(n,i){if(typeof n!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var c=s.call(n,i);if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}function TIe(n){return n.dataKey}function wIe(n,i){return j.isValidElement(n)?j.cloneElement(n,i):typeof n=="function"?j.createElement(n,i):j.createElement(Lbe,i)}var GY=[],RIe={allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",axisId:0,contentStyle:{},cursor:!0,filterNull:!0,isAnimationActive:!Yv.isSsr,itemSorter:"name",itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,wrapperStyle:{}};function CIe(n){var i=$o(n,RIe),{active:s,allowEscapeViewBox:c,animationDuration:f,animationEasing:p,content:v,filterNull:b,isAnimationActive:T,offset:w,payloadUniqBy:C,position:I,reverseDirection:D,useTranslate3d:L,wrapperStyle:F,cursor:W,shared:G,trigger:$,defaultIndex:te,portal:Z,axisId:ce}=i,se=La(),de=typeof te=="number"?String(te):te;j.useEffect(()=>{se(KAe({shared:G,trigger:$,axisId:ce,active:s,defaultIndex:de}))},[se,G,$,ce,s,de]);var oe=zI(),ge=sZ(),Ae=FAe(G),{activeIndex:ke,isActive:Ee}=Ft(Ct=>zOe(Ct,Ae,$,de)),be=Ft(Ct=>WOe(Ct,Ae,$,de)),Le=Ft(Ct=>Cee(Ct,Ae,$,de)),et=Ft(Ct=>HOe(Ct,Ae,$,de)),rt=be,he=ZOe(),_e=s??Ee,[ze,tt]=A0e([rt,_e]),ut=Ae==="axis"?Le:void 0;yIe(Ae,$,et,ut,ke,_e);var me=Z??he;if(me==null)return null;var Ve=rt??GY;_e||(Ve=GY),b&&Ve.length&&(Ve=QEe(rt.filter(Ct=>Ct.value!=null&&(Ct.hide!==!0||i.includeHidden)),C,TIe));var it=Ve.length>0,dt=j.createElement(Gbe,{allowEscapeViewBox:c,animationDuration:f,animationEasing:p,isAnimationActive:T,active:_e,coordinate:et,hasPayload:it,offset:w,position:I,reverseDirection:D,useTranslate3d:L,viewBox:oe,wrapperStyle:F,lastBoundingBox:ze,innerRef:tt,hasPortalFromProps:!!Z},wIe(v,FY(FY({},i),{},{payload:Ve,label:ut,active:_e,coordinate:et,accessibilityLayer:ge})));return j.createElement(j.Fragment,null,Lhe.createPortal(dt,me),_e&&j.createElement($Oe,{cursor:W,tooltipEventType:Ae,coordinate:et,payload:rt,index:ke}))}function AIe(n,i,s){return(i=OIe(i))in n?Object.defineProperty(n,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[i]=s,n}function OIe(n){var i=IIe(n,"string");return typeof i=="symbol"?i:i+""}function IIe(n,i){if(typeof n!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var c=s.call(n,i);if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}class NIe{constructor(i){AIe(this,"cache",new Map),this.maxSize=i}get(i){var s=this.cache.get(i);return s!==void 0&&(this.cache.delete(i),this.cache.set(i,s)),s}set(i,s){if(this.cache.has(i))this.cache.delete(i);else if(this.cache.size>=this.maxSize){var c=this.cache.keys().next().value;this.cache.delete(c)}this.cache.set(i,s)}clear(){this.cache.clear()}size(){return this.cache.size}}function HY(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(f){return Object.getOwnPropertyDescriptor(n,f).enumerable})),s.push.apply(s,c)}return s}function xIe(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?HY(Object(s),!0).forEach(function(c){DIe(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):HY(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}function DIe(n,i,s){return(i=PIe(i))in n?Object.defineProperty(n,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[i]=s,n}function PIe(n){var i=kIe(n,"string");return typeof i=="symbol"?i:i+""}function kIe(n,i){if(typeof n!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var c=s.call(n,i);if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}var LIe={cacheSize:2e3,enableCache:!0},xee=xIe({},LIe),WY=new NIe(xee.cacheSize),MIe={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},zY="recharts_measurement_span";function UIe(n,i){var s=i.fontSize||"",c=i.fontFamily||"",f=i.fontWeight||"",p=i.fontStyle||"",v=i.letterSpacing||"",b=i.textTransform||"";return"".concat(n,"|").concat(s,"|").concat(c,"|").concat(f,"|").concat(p,"|").concat(v,"|").concat(b)}var KY=(n,i)=>{try{var s=document.getElementById(zY);s||(s=document.createElement("span"),s.setAttribute("id",zY),s.setAttribute("aria-hidden","true"),document.body.appendChild(s)),Object.assign(s.style,MIe,i),s.textContent="".concat(n);var c=s.getBoundingClientRect();return{width:c.width,height:c.height}}catch{return{width:0,height:0}}},tb=function(i){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(i==null||Yv.isSsr)return{width:0,height:0};if(!xee.enableCache)return KY(i,s);var c=UIe(i,s),f=WY.get(c);if(f)return f;var p=KY(i,s);return WY.set(c,p),p},YY=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,qY=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,jIe=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,VIe=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,Dee={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},BIe=Object.keys(Dee),Cv="NaN";function FIe(n,i){return n*Dee[i]}class Os{static parse(i){var s,[,c,f]=(s=VIe.exec(i))!==null&&s!==void 0?s:[];return new Os(parseFloat(c),f??"")}constructor(i,s){this.num=i,this.unit=s,this.num=i,this.unit=s,el(i)&&(this.unit=""),s!==""&&!jIe.test(s)&&(this.num=NaN,this.unit=""),BIe.includes(s)&&(this.num=FIe(i,s),this.unit="px")}add(i){return this.unit!==i.unit?new Os(NaN,""):new Os(this.num+i.num,this.unit)}subtract(i){return this.unit!==i.unit?new Os(NaN,""):new Os(this.num-i.num,this.unit)}multiply(i){return this.unit!==""&&i.unit!==""&&this.unit!==i.unit?new Os(NaN,""):new Os(this.num*i.num,this.unit||i.unit)}divide(i){return this.unit!==""&&i.unit!==""&&this.unit!==i.unit?new Os(NaN,""):new Os(this.num/i.num,this.unit||i.unit)}toString(){return"".concat(this.num).concat(this.unit)}isNaN(){return el(this.num)}}function Pee(n){if(n.includes(Cv))return Cv;for(var i=n;i.includes("*")||i.includes("/");){var s,[,c,f,p]=(s=YY.exec(i))!==null&&s!==void 0?s:[],v=Os.parse(c??""),b=Os.parse(p??""),T=f==="*"?v.multiply(b):v.divide(b);if(T.isNaN())return Cv;i=i.replace(YY,T.toString())}for(;i.includes("+")||/.-\d+(?:\.\d+)?/.test(i);){var w,[,C,I,D]=(w=qY.exec(i))!==null&&w!==void 0?w:[],L=Os.parse(C??""),F=Os.parse(D??""),W=I==="+"?L.add(F):L.subtract(F);if(W.isNaN())return Cv;i=i.replace(qY,W.toString())}return i}var XY=/\(([^()]*)\)/;function GIe(n){for(var i=n,s;(s=XY.exec(i))!=null;){var[,c]=s;i=i.replace(XY,Pee(c))}return i}function HIe(n){var i=n.replace(/\s+/g,"");return i=GIe(i),i=Pee(i),i}function WIe(n){try{return HIe(n)}catch{return Cv}}function eM(n){var i=WIe(n.slice(5,-1));return i===Cv?"":i}var zIe=["x","y","lineHeight","capHeight","scaleToFit","textAnchor","verticalAnchor","fill"],KIe=["dx","dy","angle","className","breakAll"];function _2(){return _2=Object.assign?Object.assign.bind():function(n){for(var i=1;i<arguments.length;i++){var s=arguments[i];for(var c in s)({}).hasOwnProperty.call(s,c)&&(n[c]=s[c])}return n},_2.apply(null,arguments)}function JY(n,i){if(n==null)return{};var s,c,f=YIe(n,i);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);for(c=0;c<p.length;c++)s=p[c],i.indexOf(s)===-1&&{}.propertyIsEnumerable.call(n,s)&&(f[s]=n[s])}return f}function YIe(n,i){if(n==null)return{};var s={};for(var c in n)if({}.hasOwnProperty.call(n,c)){if(i.indexOf(c)!==-1)continue;s[c]=n[c]}return s}var kee=/[ \f\n\r\t\v\u2028\u2029]+/,Lee=n=>{var{children:i,breakAll:s,style:c}=n;try{var f=[];ta(i)||(s?f=i.toString().split(""):f=i.toString().split(kee));var p=f.map(b=>({word:b,width:tb(b,c).width})),v=s?0:tb("",c).width;return{wordsWithComputedWidth:p,spaceWidth:v}}catch{return null}},qIe=(n,i,s,c,f)=>{var{maxLines:p,children:v,style:b,breakAll:T}=n,w=zt(p),C=v,I=function(){var Ee=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return Ee.reduce((be,Le)=>{var{word:et,width:rt}=Le,he=be[be.length-1];if(he&&(c==null||f||he.width+rt+s<Number(c)))he.words.push(et),he.width+=rt+s;else{var _e={words:[et],width:rt};be.push(_e)}return be},[])},D=I(i),L=ke=>ke.reduce((Ee,be)=>Ee.width>be.width?Ee:be);if(!w||f)return D;var F=D.length>p||L(D).width>Number(c);if(!F)return D;for(var W="",G=ke=>{var Ee=C.slice(0,ke),be=Lee({breakAll:T,style:b,children:Ee+W}).wordsWithComputedWidth,Le=I(be),et=Le.length>p||L(Le).width>Number(c);return[et,Le]},$=0,te=C.length-1,Z=0,ce;$<=te&&Z<=C.length-1;){var se=Math.floor(($+te)/2),de=se-1,[oe,ge]=G(de),[Ae]=G(se);if(!oe&&!Ae&&($=se+1),oe&&Ae&&(te=se-1),!oe&&Ae){ce=ge;break}Z++}return ce||D},$Y=n=>{var i=ta(n)?[]:n.toString().split(kee);return[{words:i}]},XIe=n=>{var{width:i,scaleToFit:s,children:c,style:f,breakAll:p,maxLines:v}=n;if((i||s)&&!Yv.isSsr){var b,T,w=Lee({breakAll:p,children:c,style:f});if(w){var{wordsWithComputedWidth:C,spaceWidth:I}=w;b=C,T=I}else return $Y(c);return qIe({breakAll:p,children:c,maxLines:v,style:f},b,T,i,s)}return $Y(c)},ZY="#808080",Aj=j.forwardRef((n,i)=>{var{x:s=0,y:c=0,lineHeight:f="1em",capHeight:p="0.71em",scaleToFit:v=!1,textAnchor:b="start",verticalAnchor:T="end",fill:w=ZY}=n,C=JY(n,zIe),I=j.useMemo(()=>XIe({breakAll:C.breakAll,children:C.children,maxLines:C.maxLines,scaleToFit:v,style:C.style,width:C.width}),[C.breakAll,C.children,C.maxLines,v,C.style,C.width]),{dx:D,dy:L,angle:F,className:W,breakAll:G}=C,$=JY(C,KIe);if(!Jl(s)||!Jl(c)||I.length===0)return null;var te=s+(zt(D)?D:0),Z=c+(zt(L)?L:0),ce;switch(T){case"start":ce=eM("calc(".concat(p,")"));break;case"middle":ce=eM("calc(".concat((I.length-1)/2," * -").concat(f," + (").concat(p," / 2))"));break;default:ce=eM("calc(".concat(I.length-1," * -").concat(f,")"));break}var se=[];if(v){var de=I[0].width,{width:oe}=C;se.push("scale(".concat(zt(oe)?oe/de:1,")"))}return F&&se.push("rotate(".concat(F,", ").concat(te,", ").concat(Z,")")),se.length&&($.transform=se.join(" ")),j.createElement("text",_2({},qo($),{ref:i,x:te,y:Z,className:Ir("recharts-text",W),textAnchor:b,fill:w.includes("url")?ZY:w}),I.map((ge,Ae)=>{var ke=ge.words.join(G?"":" ");return j.createElement("tspan",{x:te,dy:Ae===0?ce:f,key:"".concat(ke,"-").concat(Ae)},ke)}))});Aj.displayName="Text";var JIe=["labelRef"];function $Ie(n,i){if(n==null)return{};var s,c,f=ZIe(n,i);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);for(c=0;c<p.length;c++)s=p[c],i.indexOf(s)===-1&&{}.propertyIsEnumerable.call(n,s)&&(f[s]=n[s])}return f}function ZIe(n,i){if(n==null)return{};var s={};for(var c in n)if({}.hasOwnProperty.call(n,c)){if(i.indexOf(c)!==-1)continue;s[c]=n[c]}return s}function QY(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(f){return Object.getOwnPropertyDescriptor(n,f).enumerable})),s.push.apply(s,c)}return s}function fi(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?QY(Object(s),!0).forEach(function(c){QIe(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):QY(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}function QIe(n,i,s){return(i=eNe(i))in n?Object.defineProperty(n,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[i]=s,n}function eNe(n){var i=tNe(n,"string");return typeof i=="symbol"?i:i+""}function tNe(n,i){if(typeof n!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var c=s.call(n,i);if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}function Zu(){return Zu=Object.assign?Object.assign.bind():function(n){for(var i=1;i<arguments.length;i++){var s=arguments[i];for(var c in s)({}).hasOwnProperty.call(s,c)&&(n[c]=s[c])}return n},Zu.apply(null,arguments)}var Mee=j.createContext(null),nNe=n=>{var{x:i,y:s,width:c,height:f,children:p}=n,v=j.useMemo(()=>({x:i,y:s,width:c,height:f}),[i,s,c,f]);return j.createElement(Mee.Provider,{value:v},p)},Uee=()=>{var n=j.useContext(Mee),i=zI();return n||i},rNe=j.createContext(null),iNe=()=>{var n=j.useContext(rNe),i=Ft(gQ);return n||i},aNe=n=>{var{value:i,formatter:s}=n,c=ta(n.children)?i:n.children;return typeof s=="function"?s(c):c},Oj=n=>n!=null&&typeof n=="function",sNe=(n,i)=>{var s=Wo(i-n),c=Math.min(Math.abs(i-n),360);return s*c},oNe=(n,i,s,c,f)=>{var{offset:p,className:v}=n,{cx:b,cy:T,innerRadius:w,outerRadius:C,startAngle:I,endAngle:D,clockWise:L}=f,F=(w+C)/2,W=sNe(I,D),G=W>=0?1:-1,$,te;switch(i){case"insideStart":$=I+G*p,te=L;break;case"insideEnd":$=D-G*p,te=!L;break;case"end":$=D+G*p,te=L;break;default:throw new Error("Unsupported position ".concat(i))}te=W<=0?te:!te;var Z=ma(b,T,F,$),ce=ma(b,T,F,$+(te?1:-1)*359),se="M".concat(Z.x,",").concat(Z.y,`
    A`).concat(F,",").concat(F,",0,1,").concat(te?0:1,`,
    `).concat(ce.x,",").concat(ce.y),de=ta(n.id)?ub("recharts-radial-line-"):n.id;return j.createElement("text",Zu({},c,{dominantBaseline:"central",className:Ir("recharts-radial-bar-label",v)}),j.createElement("defs",null,j.createElement("path",{id:de,d:se})),j.createElement("textPath",{xlinkHref:"#".concat(de)},s))},cNe=(n,i,s)=>{var{cx:c,cy:f,innerRadius:p,outerRadius:v,startAngle:b,endAngle:T}=n,w=(b+T)/2;if(s==="outside"){var{x:C,y:I}=ma(c,f,v+i,w);return{x:C,y:I,textAnchor:C>=c?"start":"end",verticalAnchor:"middle"}}if(s==="center")return{x:c,y:f,textAnchor:"middle",verticalAnchor:"middle"};if(s==="centerTop")return{x:c,y:f,textAnchor:"middle",verticalAnchor:"start"};if(s==="centerBottom")return{x:c,y:f,textAnchor:"middle",verticalAnchor:"end"};var D=(p+v)/2,{x:L,y:F}=ma(c,f,D,w);return{x:L,y:F,textAnchor:"middle",verticalAnchor:"middle"}},jee=n=>"cx"in n&&zt(n.cx),lNe=(n,i)=>{var{parentViewBox:s,offset:c,position:f}=n,p;s!=null&&!jee(s)&&(p=s);var{x:v,y:b,width:T,height:w}=i,C=w>=0?1:-1,I=C*c,D=C>0?"end":"start",L=C>0?"start":"end",F=T>=0?1:-1,W=F*c,G=F>0?"end":"start",$=F>0?"start":"end";if(f==="top"){var te={x:v+T/2,y:b-C*c,textAnchor:"middle",verticalAnchor:D};return fi(fi({},te),p?{height:Math.max(b-p.y,0),width:T}:{})}if(f==="bottom"){var Z={x:v+T/2,y:b+w+I,textAnchor:"middle",verticalAnchor:L};return fi(fi({},Z),p?{height:Math.max(p.y+p.height-(b+w),0),width:T}:{})}if(f==="left"){var ce={x:v-W,y:b+w/2,textAnchor:G,verticalAnchor:"middle"};return fi(fi({},ce),p?{width:Math.max(ce.x-p.x,0),height:w}:{})}if(f==="right"){var se={x:v+T+W,y:b+w/2,textAnchor:$,verticalAnchor:"middle"};return fi(fi({},se),p?{width:Math.max(p.x+p.width-se.x,0),height:w}:{})}var de=p?{width:T,height:w}:{};return f==="insideLeft"?fi({x:v+W,y:b+w/2,textAnchor:$,verticalAnchor:"middle"},de):f==="insideRight"?fi({x:v+T-W,y:b+w/2,textAnchor:G,verticalAnchor:"middle"},de):f==="insideTop"?fi({x:v+T/2,y:b+I,textAnchor:"middle",verticalAnchor:L},de):f==="insideBottom"?fi({x:v+T/2,y:b+w-I,textAnchor:"middle",verticalAnchor:D},de):f==="insideTopLeft"?fi({x:v+W,y:b+I,textAnchor:$,verticalAnchor:L},de):f==="insideTopRight"?fi({x:v+T-W,y:b+I,textAnchor:G,verticalAnchor:L},de):f==="insideBottomLeft"?fi({x:v+W,y:b+w-I,textAnchor:$,verticalAnchor:D},de):f==="insideBottomRight"?fi({x:v+T-W,y:b+w-I,textAnchor:G,verticalAnchor:D},de):f&&typeof f=="object"&&(zt(f.x)||cd(f.x))&&(zt(f.y)||cd(f.y))?fi({x:v+cf(f.x,T),y:b+cf(f.y,w),textAnchor:"end",verticalAnchor:"end"},de):fi({x:v+T/2,y:b+w/2,textAnchor:"middle",verticalAnchor:"middle"},de)},uNe={offset:5};function tf(n){var i=$o(n,uNe),{viewBox:s,position:c,value:f,children:p,content:v,className:b="",textBreakAll:T,labelRef:w}=i,C=iNe(),I=Uee(),D=c==="center"?I:C??I,L=s||D;if(!L||ta(f)&&ta(p)&&!j.isValidElement(v)&&typeof v!="function")return null;var F=fi(fi({},i),{},{viewBox:L});if(j.isValidElement(v)){var{labelRef:W}=F,G=$Ie(F,JIe);return j.cloneElement(v,G)}var $;if(typeof v=="function"){if($=j.createElement(v,F),j.isValidElement($))return $}else $=aNe(i);var te=jee(L),Z=qo(i);if(te&&(c==="insideStart"||c==="insideEnd"||c==="end"))return oNe(i,c,$,Z,L);var ce=te?cNe(L,i.offset,i.position):lNe(i,L);return j.createElement(Aj,Zu({ref:w,className:Ir("recharts-label",b)},Z,ce,{breakAll:T}),$)}tf.displayName="Label";var dNe=(n,i,s)=>{if(!n)return null;var c={viewBox:i,labelRef:s};return n===!0?j.createElement(tf,Zu({key:"label-implicit"},c)):Jl(n)?j.createElement(tf,Zu({key:"label-implicit",value:n},c)):j.isValidElement(n)?n.type===tf?j.cloneElement(n,fi({key:"label-implicit"},c)):j.createElement(tf,Zu({key:"label-implicit",content:n},c)):Oj(n)?j.createElement(tf,Zu({key:"label-implicit",content:n},c)):n&&typeof n=="object"?j.createElement(tf,Zu({},n,{key:"label-implicit"},c)):null};function hNe(n){var{label:i,labelRef:s}=n,c=Uee();return dNe(i,c,s)||null}var tM={},nM={},eq;function fNe(){return eq||(eq=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});function i(s){return s[s.length-1]}n.last=i})(nM)),nM}var rM={},tq;function pNe(){return tq||(tq=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});function i(s){return Array.isArray(s)?s:Array.from(s)}n.toArray=i})(rM)),rM}var nq;function mNe(){return nq||(nq=1,(function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const i=fNe(),s=pNe(),c=SU();function f(p){if(c.isArrayLike(p))return i.last(s.toArray(p))}n.last=f})(tM)),tM}var iM,rq;function gNe(){return rq||(rq=1,iM=mNe().last),iM}var _Ne=gNe();const vNe=fd(_Ne);var yNe=["valueAccessor"],ENe=["dataKey","clockWise","id","textBreakAll"];function gI(){return gI=Object.assign?Object.assign.bind():function(n){for(var i=1;i<arguments.length;i++){var s=arguments[i];for(var c in s)({}).hasOwnProperty.call(s,c)&&(n[c]=s[c])}return n},gI.apply(null,arguments)}function iq(n,i){if(n==null)return{};var s,c,f=SNe(n,i);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);for(c=0;c<p.length;c++)s=p[c],i.indexOf(s)===-1&&{}.propertyIsEnumerable.call(n,s)&&(f[s]=n[s])}return f}function SNe(n,i){if(n==null)return{};var s={};for(var c in n)if({}.hasOwnProperty.call(n,c)){if(i.indexOf(c)!==-1)continue;s[c]=n[c]}return s}var bNe=n=>Array.isArray(n.value)?vNe(n.value):n.value,Vee=j.createContext(void 0),TNe=Vee.Provider,Bee=j.createContext(void 0);Bee.Provider;function wNe(){return j.useContext(Vee)}function RNe(){return j.useContext(Bee)}function xO(n){var{valueAccessor:i=bNe}=n,s=iq(n,yNe),{dataKey:c,clockWise:f,id:p,textBreakAll:v}=s,b=iq(s,ENe),T=wNe(),w=RNe(),C=T||w;return!C||!C.length?null:j.createElement(Kv,{className:"recharts-label-list"},C.map((I,D)=>{var L,F=ta(c)?i(I,D):ts(I&&I.payload,c),W=ta(p)?{}:{id:"".concat(p,"-").concat(D)};return j.createElement(tf,gI({key:"label-".concat(D)},qo(I),b,W,{fill:(L=s.fill)!==null&&L!==void 0?L:I.fill,parentViewBox:I.parentViewBox,value:F,textBreakAll:v,viewBox:I.viewBox,index:D}))}))}xO.displayName="LabelList";function CNe(n){var{label:i}=n;return i?i===!0?j.createElement(xO,{key:"labelList-implicit"}):j.isValidElement(i)||Oj(i)?j.createElement(xO,{key:"labelList-implicit",content:i}):typeof i=="object"?j.createElement(xO,gI({key:"labelList-implicit"},i,{type:String(i.type)})):null:null}function v2(){return v2=Object.assign?Object.assign.bind():function(n){for(var i=1;i<arguments.length;i++){var s=arguments[i];for(var c in s)({}).hasOwnProperty.call(s,c)&&(n[c]=s[c])}return n},v2.apply(null,arguments)}var Fee=n=>{var{cx:i,cy:s,r:c,className:f}=n,p=Ir("recharts-dot",f);return i===+i&&s===+s&&c===+c?j.createElement("circle",v2({},Xl(n),EU(n),{className:p,cx:i,cy:s,r:c})):null},ANe={radiusAxis:{},angleAxis:{}},Gee=so({name:"polarAxis",initialState:ANe,reducers:{addRadiusAxis(n,i){n.radiusAxis[i.payload.id]=i.payload},removeRadiusAxis(n,i){delete n.radiusAxis[i.payload.id]},addAngleAxis(n,i){n.angleAxis[i.payload.id]=i.payload},removeAngleAxis(n,i){delete n.angleAxis[i.payload.id]}}}),{addRadiusAxis:LPe,removeRadiusAxis:MPe,addAngleAxis:UPe,removeAngleAxis:jPe}=Gee.actions,ONe=Gee.reducer,Hee=n=>n&&typeof n=="object"&&"clipDot"in n?!!n.clipDot:!0;function INe(n){var{fn:i,args:s}=n,c=La(),f=oo();return j.useLayoutEffect(()=>{if(!f){var p=i(s);return c(WAe(p)),()=>{c(zAe(p))}}},[i,s,c,f]),null}var NNe=()=>{};function xNe(n){var{legendPayload:i}=n,s=La(),c=oo();return j.useLayoutEffect(()=>c?NNe:(s(Obe(i)),()=>{s(Ibe(i))}),[s,c,i]),null}var aM,DNe=()=>{var[n]=j.useState(()=>ub("uid-"));return n},PNe=(aM=ade.useId)!==null&&aM!==void 0?aM:DNe;function kNe(n,i){var s=PNe();return i||(n?"".concat(n,"-").concat(s):s)}var LNe=j.createContext(void 0),MNe=n=>{var{id:i,type:s,children:c}=n,f=kNe("recharts-".concat(s),i);return j.createElement(LNe.Provider,{value:f},c(f))},UNe={cartesianItems:[],polarItems:[]},Wee=so({name:"graphicalItems",initialState:UNe,reducers:{addCartesianGraphicalItem:{reducer(n,i){n.cartesianItems.push(i.payload)},prepare:Za()},replaceCartesianGraphicalItem:{reducer(n,i){var{prev:s,next:c}=i.payload,f=nd(n).cartesianItems.indexOf(s);f>-1&&(n.cartesianItems[f]=c)},prepare:Za()},removeCartesianGraphicalItem:{reducer(n,i){var s=nd(n).cartesianItems.indexOf(i.payload);s>-1&&n.cartesianItems.splice(s,1)},prepare:Za()},addPolarGraphicalItem:{reducer(n,i){n.polarItems.push(i.payload)},prepare:Za()},removePolarGraphicalItem:{reducer(n,i){var s=nd(n).polarItems.indexOf(i.payload);s>-1&&n.polarItems.splice(s,1)},prepare:Za()}}}),{addCartesianGraphicalItem:jNe,replaceCartesianGraphicalItem:VNe,removeCartesianGraphicalItem:BNe,addPolarGraphicalItem:VPe,removePolarGraphicalItem:BPe}=Wee.actions,FNe=Wee.reducer;function GNe(n){var i=La(),s=j.useRef(null);return j.useLayoutEffect(()=>{s.current===null?i(jNe(n)):s.current!==n&&i(VNe({prev:s.current,next:n})),s.current=n},[i,n]),j.useLayoutEffect(()=>()=>{s.current&&(i(BNe(s.current)),s.current=null)},[i]),null}function aq(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(f){return Object.getOwnPropertyDescriptor(n,f).enumerable})),s.push.apply(s,c)}return s}function sq(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?aq(Object(s),!0).forEach(function(c){HNe(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):aq(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}function HNe(n,i,s){return(i=WNe(i))in n?Object.defineProperty(n,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[i]=s,n}function WNe(n){var i=zNe(n,"string");return typeof i=="symbol"?i:i+""}function zNe(n,i){if(typeof n!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var c=s.call(n,i);if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}var KNe={xAxis:{},yAxis:{},zAxis:{}},zee=so({name:"cartesianAxis",initialState:KNe,reducers:{addXAxis:{reducer(n,i){n.xAxis[i.payload.id]=i.payload},prepare:Za()},removeXAxis:{reducer(n,i){delete n.xAxis[i.payload.id]},prepare:Za()},addYAxis:{reducer(n,i){n.yAxis[i.payload.id]=i.payload},prepare:Za()},removeYAxis:{reducer(n,i){delete n.yAxis[i.payload.id]},prepare:Za()},addZAxis:{reducer(n,i){n.zAxis[i.payload.id]=i.payload},prepare:Za()},removeZAxis:{reducer(n,i){delete n.zAxis[i.payload.id]},prepare:Za()},updateYAxisWidth(n,i){var{id:s,width:c}=i.payload,f=n.yAxis[s];if(f){var p=f.widthHistory||[];if(p.length===3&&p[0]===p[2]&&c===p[1]&&c!==f.width&&Math.abs(c-p[0])<=1)return;var v=[...p,c].slice(-3);n.yAxis[s]=sq(sq({},n.yAxis[s]),{},{width:c,widthHistory:v})}}}}),{addXAxis:YNe,removeXAxis:qNe,addYAxis:XNe,removeYAxis:JNe,addZAxis:FPe,removeZAxis:GPe,updateYAxisWidth:$Ne}=zee.actions,ZNe=zee.reducer,QNe=He([ga],n=>{if(n)return{top:n.top,bottom:n.bottom,left:n.left,right:n.right}}),exe=He([QNe,pd,md],(n,i,s)=>{if(!(!n||i==null||s==null))return{x:n.left,y:n.top,width:Math.max(0,i-n.left-n.right),height:Math.max(0,s-n.top-n.bottom)}}),Ij=()=>Ft(exe),txe=()=>Ft(kOe);function oq(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(f){return Object.getOwnPropertyDescriptor(n,f).enumerable})),s.push.apply(s,c)}return s}function cq(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?oq(Object(s),!0).forEach(function(c){nxe(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):oq(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}function nxe(n,i,s){return(i=rxe(i))in n?Object.defineProperty(n,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[i]=s,n}function rxe(n){var i=ixe(n,"string");return typeof i=="symbol"?i:i+""}function ixe(n,i){if(typeof n!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var c=s.call(n,i);if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}var axe=n=>{var{point:i,childIndex:s,mainColor:c,activeDot:f,dataKey:p}=n;if(f===!1||i.x==null||i.y==null)return null;var v=cq(cq({index:s,dataKey:p,cx:i.x,cy:i.y,r:4,fill:c??"none",strokeWidth:2,stroke:"#fff",payload:i.payload,value:i.value},xI(f)),EU(f)),b;return j.isValidElement(f)?b=j.cloneElement(f,v):typeof f=="function"?b=f(v):b=j.createElement(Fee,v),j.createElement(Kv,{className:"recharts-active-dot"},b)};function sxe(n){var{points:i,mainColor:s,activeDot:c,itemDataKey:f}=n,p=Ft(Eb),v=txe();if(i==null||v==null)return null;var b=i.find(T=>v.includes(T.payload));return ta(b)?null:axe({point:b,childIndex:Number(p),mainColor:s,dataKey:f,activeDot:c})}var oxe={},Kee=so({name:"errorBars",initialState:oxe,reducers:{addErrorBar:(n,i)=>{var{itemId:s,errorBar:c}=i.payload;n[s]||(n[s]=[]),n[s].push(c)},replaceErrorBar:(n,i)=>{var{itemId:s,prev:c,next:f}=i.payload;n[s]&&(n[s]=n[s].map(p=>p.dataKey===c.dataKey&&p.direction===c.direction?f:p))},removeErrorBar:(n,i)=>{var{itemId:s,errorBar:c}=i.payload;n[s]&&(n[s]=n[s].filter(f=>f.dataKey!==c.dataKey||f.direction!==c.direction))}}}),{addErrorBar:HPe,replaceErrorBar:WPe,removeErrorBar:zPe}=Kee.actions,cxe=Kee.reducer,lxe=["children"];function uxe(n,i){if(n==null)return{};var s,c,f=dxe(n,i);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);for(c=0;c<p.length;c++)s=p[c],i.indexOf(s)===-1&&{}.propertyIsEnumerable.call(n,s)&&(f[s]=n[s])}return f}function dxe(n,i){if(n==null)return{};var s={};for(var c in n)if({}.hasOwnProperty.call(n,c)){if(i.indexOf(c)!==-1)continue;s[c]=n[c]}return s}var hxe={data:[],xAxisId:"xAxis-0",yAxisId:"yAxis-0",dataPointFormatter:()=>({x:0,y:0,value:0}),errorBarOffset:0},fxe=j.createContext(hxe);function pxe(n){var{children:i}=n,s=uxe(n,lxe);return j.createElement(fxe.Provider,{value:s},i)}function Yee(n,i){var s,c,f=Ft(w=>_d(w,n)),p=Ft(w=>vd(w,i)),v=(s=f?.allowDataOverflow)!==null&&s!==void 0?s:Zs.allowDataOverflow,b=(c=p?.allowDataOverflow)!==null&&c!==void 0?c:Qs.allowDataOverflow,T=v||b;return{needClip:T,needClipX:v,needClipY:b}}function mxe(n){var{xAxisId:i,yAxisId:s,clipPathId:c}=n,f=Ij(),{needClipX:p,needClipY:v,needClip:b}=Yee(i,s);if(!b)return null;var{x:T,y:w,width:C,height:I}=f;return j.createElement("clipPath",{id:"clipPath-".concat(c)},j.createElement("rect",{x:p?T:T-C/2,y:v?w:w-I/2,width:p?C:C*2,height:v?I:I*2}))}var gxe=n=>{var{chartData:i}=n,s=La(),c=oo();return j.useEffect(()=>c?()=>{}:(s(jY(i)),()=>{s(jY(void 0))}),[i,s,c]),null},lq={x:0,y:0,width:0,height:0,padding:{top:0,right:0,bottom:0,left:0}},qee=so({name:"brush",initialState:lq,reducers:{setBrushSettings(n,i){return i.payload==null?lq:i.payload}}}),{setBrushSettings:KPe}=qee.actions,_xe=qee.reducer;function vxe(n,i,s){return(i=yxe(i))in n?Object.defineProperty(n,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[i]=s,n}function yxe(n){var i=Exe(n,"string");return typeof i=="symbol"?i:i+""}function Exe(n,i){if(typeof n!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var c=s.call(n,i);if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}class Nj{static create(i){return new Nj(i)}constructor(i){this.scale=i}get domain(){return this.scale.domain}get range(){return this.scale.range}get rangeMin(){return this.range()[0]}get rangeMax(){return this.range()[1]}get bandwidth(){return this.scale.bandwidth}apply(i){var{bandAware:s,position:c}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(i!==void 0){if(c)switch(c){case"start":return this.scale(i);case"middle":{var f=this.bandwidth?this.bandwidth()/2:0;return this.scale(i)+f}case"end":{var p=this.bandwidth?this.bandwidth():0;return this.scale(i)+p}default:return this.scale(i)}if(s){var v=this.bandwidth?this.bandwidth()/2:0;return this.scale(i)+v}return this.scale(i)}}isInRange(i){var s=this.range(),c=s[0],f=s[s.length-1];return c<=f?i>=c&&i<=f:i>=f&&i<=c}}vxe(Nj,"EPS",1e-4);function Sxe(n){return(n%180+180)%180}var bxe=function(i){var{width:s,height:c}=i,f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,p=Sxe(f),v=p*Math.PI/180,b=Math.atan(c/s),T=v>b&&v<Math.PI-b?c/Math.sin(v):s/Math.cos(v);return Math.abs(T)},Txe={dots:[],areas:[],lines:[]},Xee=so({name:"referenceElements",initialState:Txe,reducers:{addDot:(n,i)=>{n.dots.push(i.payload)},removeDot:(n,i)=>{var s=nd(n).dots.findIndex(c=>c===i.payload);s!==-1&&n.dots.splice(s,1)},addArea:(n,i)=>{n.areas.push(i.payload)},removeArea:(n,i)=>{var s=nd(n).areas.findIndex(c=>c===i.payload);s!==-1&&n.areas.splice(s,1)},addLine:(n,i)=>{n.lines.push(i.payload)},removeLine:(n,i)=>{var s=nd(n).lines.findIndex(c=>c===i.payload);s!==-1&&n.lines.splice(s,1)}}}),{addDot:YPe,removeDot:qPe,addArea:XPe,removeArea:JPe,addLine:$Pe,removeLine:ZPe}=Xee.actions,wxe=Xee.reducer,Rxe=j.createContext(void 0),Cxe=n=>{var{children:i}=n,[s]=j.useState("".concat(ub("recharts"),"-clip")),c=Ij();if(c==null)return null;var{x:f,y:p,width:v,height:b}=c;return j.createElement(Rxe.Provider,{value:s},j.createElement("defs",null,j.createElement("clipPath",{id:s},j.createElement("rect",{x:f,y:p,height:b,width:v}))),i)};function jv(n,i){for(var s in n)if({}.hasOwnProperty.call(n,s)&&(!{}.hasOwnProperty.call(i,s)||n[s]!==i[s]))return!1;for(var c in i)if({}.hasOwnProperty.call(i,c)&&!{}.hasOwnProperty.call(n,c))return!1;return!0}function Jee(n,i,s){if(i<1)return[];if(i===1&&s===void 0)return n;for(var c=[],f=0;f<n.length;f+=i)c.push(n[f]);return c}function Axe(n,i,s){var c={width:n.width+i.width,height:n.height+i.height};return bxe(c,s)}function Oxe(n,i,s){var c=s==="width",{x:f,y:p,width:v,height:b}=n;return i===1?{start:c?f:p,end:c?f+v:p+b}:{start:c?f+v:p+b,end:c?f:p}}function _I(n,i,s,c,f){if(n*i<n*c||n*i>n*f)return!1;var p=s();return n*(i-n*p/2-c)>=0&&n*(i+n*p/2-f)<=0}function Ixe(n,i){return Jee(n,i+1)}function Nxe(n,i,s,c,f){for(var p=(c||[]).slice(),{start:v,end:b}=i,T=0,w=1,C=v,I=function(){var F=c?.[T];if(F===void 0)return{v:Jee(c,w)};var W=T,G,$=()=>(G===void 0&&(G=s(F,W)),G),te=F.coordinate,Z=T===0||_I(n,te,$,C,b);Z||(T=0,C=v,w+=1),Z&&(C=te+n*($()/2+f),T+=w)},D;w<=p.length;)if(D=I(),D)return D.v;return[]}function uq(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(f){return Object.getOwnPropertyDescriptor(n,f).enumerable})),s.push.apply(s,c)}return s}function Pa(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?uq(Object(s),!0).forEach(function(c){xxe(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):uq(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}function xxe(n,i,s){return(i=Dxe(i))in n?Object.defineProperty(n,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[i]=s,n}function Dxe(n){var i=Pxe(n,"string");return typeof i=="symbol"?i:i+""}function Pxe(n,i){if(typeof n!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var c=s.call(n,i);if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}function kxe(n,i,s,c,f){for(var p=(c||[]).slice(),v=p.length,{start:b}=i,{end:T}=i,w=function(D){var L=p[D],F,W=()=>(F===void 0&&(F=s(L,D)),F);if(D===v-1){var G=n*(L.coordinate+n*W()/2-T);p[D]=L=Pa(Pa({},L),{},{tickCoord:G>0?L.coordinate-G*n:L.coordinate})}else p[D]=L=Pa(Pa({},L),{},{tickCoord:L.coordinate});var $=_I(n,L.tickCoord,W,b,T);$&&(T=L.tickCoord-n*(W()/2+f),p[D]=Pa(Pa({},L),{},{isShow:!0}))},C=v-1;C>=0;C--)w(C);return p}function Lxe(n,i,s,c,f,p){var v=(c||[]).slice(),b=v.length,{start:T,end:w}=i;if(p){var C=c[b-1],I=s(C,b-1),D=n*(C.coordinate+n*I/2-w);v[b-1]=C=Pa(Pa({},C),{},{tickCoord:D>0?C.coordinate-D*n:C.coordinate});var L=_I(n,C.tickCoord,()=>I,T,w);L&&(w=C.tickCoord-n*(I/2+f),v[b-1]=Pa(Pa({},C),{},{isShow:!0}))}for(var F=p?b-1:b,W=function(te){var Z=v[te],ce,se=()=>(ce===void 0&&(ce=s(Z,te)),ce);if(te===0){var de=n*(Z.coordinate-n*se()/2-T);v[te]=Z=Pa(Pa({},Z),{},{tickCoord:de<0?Z.coordinate-de*n:Z.coordinate})}else v[te]=Z=Pa(Pa({},Z),{},{tickCoord:Z.coordinate});var oe=_I(n,Z.tickCoord,se,T,w);oe&&(T=Z.tickCoord+n*(se()/2+f),v[te]=Pa(Pa({},Z),{},{isShow:!0}))},G=0;G<F;G++)W(G);return v}function xj(n,i,s){var{tick:c,ticks:f,viewBox:p,minTickGap:v,orientation:b,interval:T,tickFormatter:w,unit:C,angle:I}=n;if(!f||!f.length||!c)return[];if(zt(T)||Yv.isSsr){var D;return(D=Ixe(f,zt(T)?T:0))!==null&&D!==void 0?D:[]}var L=[],F=b==="top"||b==="bottom"?"width":"height",W=C&&F==="width"?tb(C,{fontSize:i,letterSpacing:s}):{width:0,height:0},G=(Z,ce)=>{var se=typeof w=="function"?w(Z.value,ce):Z.value;return F==="width"?Axe(tb(se,{fontSize:i,letterSpacing:s}),W,I):tb(se,{fontSize:i,letterSpacing:s})[F]},$=f.length>=2?Wo(f[1].coordinate-f[0].coordinate):1,te=Oxe(p,$,F);return T==="equidistantPreserveStart"?Nxe($,te,G,f,v):(T==="preserveStart"||T==="preserveStartEnd"?L=Lxe($,te,G,f,v,T==="preserveStartEnd"):L=kxe($,te,G,f,v),L.filter(Z=>Z.isShow))}var Mxe=n=>{var{ticks:i,label:s,labelGapWithTick:c=5,tickSize:f=0,tickMargin:p=0}=n,v=0;if(i){Array.from(i).forEach(C=>{if(C){var I=C.getBoundingClientRect();I.width>v&&(v=I.width)}});var b=s?s.getBoundingClientRect().width:0,T=f+p,w=v+T+b+(s?c:0);return Math.round(w)}return 0},Uxe=["axisLine","width","height","className","hide","ticks"],jxe=["viewBox"],Vxe=["viewBox"];function y2(n,i){if(n==null)return{};var s,c,f=Bxe(n,i);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);for(c=0;c<p.length;c++)s=p[c],i.indexOf(s)===-1&&{}.propertyIsEnumerable.call(n,s)&&(f[s]=n[s])}return f}function Bxe(n,i){if(n==null)return{};var s={};for(var c in n)if({}.hasOwnProperty.call(n,c)){if(i.indexOf(c)!==-1)continue;s[c]=n[c]}return s}function Tm(){return Tm=Object.assign?Object.assign.bind():function(n){for(var i=1;i<arguments.length;i++){var s=arguments[i];for(var c in s)({}).hasOwnProperty.call(s,c)&&(n[c]=s[c])}return n},Tm.apply(null,arguments)}function dq(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(f){return Object.getOwnPropertyDescriptor(n,f).enumerable})),s.push.apply(s,c)}return s}function ji(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?dq(Object(s),!0).forEach(function(c){Fxe(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):dq(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}function Fxe(n,i,s){return(i=Gxe(i))in n?Object.defineProperty(n,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[i]=s,n}function Gxe(n){var i=Hxe(n,"string");return typeof i=="symbol"?i:i+""}function Hxe(n,i){if(typeof n!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var c=s.call(n,i);if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}var Dj={x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd"};function Wxe(n){var{x:i,y:s,width:c,height:f,orientation:p,mirror:v,axisLine:b,otherSvgProps:T}=n;if(!b)return null;var w=ji(ji(ji({},T),Xl(b)),{},{fill:"none"});if(p==="top"||p==="bottom"){var C=+(p==="top"&&!v||p==="bottom"&&v);w=ji(ji({},w),{},{x1:i,y1:s+C*f,x2:i+c,y2:s+C*f})}else{var I=+(p==="left"&&!v||p==="right"&&v);w=ji(ji({},w),{},{x1:i+I*c,y1:s,x2:i+I*c,y2:s+f})}return j.createElement("line",Tm({},w,{className:Ir("recharts-cartesian-axis-line",kI(b,"className"))}))}function zxe(n,i,s,c,f,p,v,b,T){var w,C,I,D,L,F,W=b?-1:1,G=n.tickSize||v,$=zt(n.tickCoord)?n.tickCoord:n.coordinate;switch(p){case"top":w=C=n.coordinate,D=s+ +!b*f,I=D-W*G,F=I-W*T,L=$;break;case"left":I=D=n.coordinate,C=i+ +!b*c,w=C-W*G,L=w-W*T,F=$;break;case"right":I=D=n.coordinate,C=i+ +b*c,w=C+W*G,L=w+W*T,F=$;break;default:w=C=n.coordinate,D=s+ +b*f,I=D+W*G,F=I+W*T,L=$;break}return{line:{x1:w,y1:I,x2:C,y2:D},tick:{x:L,y:F}}}function Kxe(n,i){switch(n){case"left":return i?"start":"end";case"right":return i?"end":"start";default:return"middle"}}function Yxe(n,i){switch(n){case"left":case"right":return"middle";case"top":return i?"start":"end";default:return i?"end":"start"}}function qxe(n){var{option:i,tickProps:s,value:c}=n,f,p=Ir(s.className,"recharts-cartesian-axis-tick-value");if(j.isValidElement(i))f=j.cloneElement(i,ji(ji({},s),{},{className:p}));else if(typeof i=="function")f=i(ji(ji({},s),{},{className:p}));else{var v="recharts-cartesian-axis-tick-value";typeof i!="boolean"&&(v=Ir(v,i?.className)),f=j.createElement(Aj,Tm({},s,{className:v}),c)}return f}function Xxe(n){var{ticks:i=[],tick:s,tickLine:c,stroke:f,tickFormatter:p,unit:v,padding:b,tickTextProps:T,orientation:w,mirror:C,x:I,y:D,width:L,height:F,tickSize:W,tickMargin:G,fontSize:$,letterSpacing:te,getTicksConfig:Z,events:ce}=n,se=xj(ji(ji({},Z),{},{ticks:i}),$,te),de=Kxe(w,C),oe=Yxe(w,C),ge=Xl(Z),Ae=xI(s),ke={};typeof c=="object"&&(ke=c);var Ee=ji(ji({},ge),{},{fill:"none"},ke),be=se.map((Le,et)=>{var{line:rt,tick:he}=zxe(Le,I,D,L,F,w,W,C,G),_e=ji(ji(ji(ji({textAnchor:de,verticalAnchor:oe},ge),{},{stroke:"none",fill:f},Ae),he),{},{index:et,payload:Le,visibleTicksCount:se.length,tickFormatter:p,padding:b},T);return j.createElement(Kv,Tm({className:"recharts-cartesian-axis-tick",key:"tick-".concat(Le.value,"-").concat(Le.coordinate,"-").concat(Le.tickCoord)},PEe(ce,Le,et)),c&&j.createElement("line",Tm({},Ee,rt,{className:Ir("recharts-cartesian-axis-tick-line",kI(c,"className"))})),s&&j.createElement(qxe,{option:s,tickProps:_e,value:"".concat(typeof p=="function"?p(Le.value,et):Le.value).concat(v||"")}))});return be.length>0?j.createElement("g",{className:"recharts-cartesian-axis-ticks"},be):null}var Jxe=j.forwardRef((n,i)=>{var{axisLine:s,width:c,height:f,className:p,hide:v,ticks:b}=n,T=y2(n,Uxe),[w,C]=j.useState(""),[I,D]=j.useState(""),L=j.useRef(null);j.useImperativeHandle(i,()=>({getCalculatedWidth:()=>{var W;return Mxe({ticks:L.current,label:(W=n.labelRef)===null||W===void 0?void 0:W.current,labelGapWithTick:5,tickSize:n.tickSize,tickMargin:n.tickMargin})}}));var F=j.useCallback(W=>{if(W){var G=W.getElementsByClassName("recharts-cartesian-axis-tick-value");L.current=G;var $=G[0];if($){var te=window.getComputedStyle($),Z=te.fontSize,ce=te.letterSpacing;(Z!==w||ce!==I)&&(C(Z),D(ce))}}},[w,I]);return v||c!=null&&c<=0||f!=null&&f<=0?null:j.createElement(Kv,{className:Ir("recharts-cartesian-axis",p),ref:F},j.createElement(Wxe,{x:n.x,y:n.y,width:c,height:f,orientation:n.orientation,mirror:n.mirror,axisLine:s,otherSvgProps:Xl(n)}),j.createElement(Xxe,{ticks:b,tick:n.tick,tickLine:n.tickLine,stroke:n.stroke,tickFormatter:n.tickFormatter,unit:n.unit,padding:n.padding,tickTextProps:n.tickTextProps,orientation:n.orientation,mirror:n.mirror,x:n.x,y:n.y,width:n.width,height:n.height,tickSize:n.tickSize,tickMargin:n.tickMargin,fontSize:w,letterSpacing:I,getTicksConfig:n,events:T}),j.createElement(nNe,{x:n.x,y:n.y,width:n.width,height:n.height},j.createElement(hNe,{label:n.label,labelRef:n.labelRef}),n.children))}),$xe=j.memo(Jxe,(n,i)=>{var{viewBox:s}=n,c=y2(n,jxe),{viewBox:f}=i,p=y2(i,Vxe);return jv(s,f)&&jv(c,p)}),Pj=j.forwardRef((n,i)=>{var s=$o(n,Dj);return j.createElement($xe,Tm({},s,{ref:i}))});Pj.displayName="CartesianAxis";var Zxe=["x1","y1","x2","y2","key"],Qxe=["offset"],e1e=["xAxisId","yAxisId"],t1e=["xAxisId","yAxisId"];function hq(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(f){return Object.getOwnPropertyDescriptor(n,f).enumerable})),s.push.apply(s,c)}return s}function ka(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?hq(Object(s),!0).forEach(function(c){n1e(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):hq(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}function n1e(n,i,s){return(i=r1e(i))in n?Object.defineProperty(n,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[i]=s,n}function r1e(n){var i=i1e(n,"string");return typeof i=="symbol"?i:i+""}function i1e(n,i){if(typeof n!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var c=s.call(n,i);if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}function dm(){return dm=Object.assign?Object.assign.bind():function(n){for(var i=1;i<arguments.length;i++){var s=arguments[i];for(var c in s)({}).hasOwnProperty.call(s,c)&&(n[c]=s[c])}return n},dm.apply(null,arguments)}function vI(n,i){if(n==null)return{};var s,c,f=a1e(n,i);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);for(c=0;c<p.length;c++)s=p[c],i.indexOf(s)===-1&&{}.propertyIsEnumerable.call(n,s)&&(f[s]=n[s])}return f}function a1e(n,i){if(n==null)return{};var s={};for(var c in n)if({}.hasOwnProperty.call(n,c)){if(i.indexOf(c)!==-1)continue;s[c]=n[c]}return s}var s1e=n=>{var{fill:i}=n;if(!i||i==="none")return null;var{fillOpacity:s,x:c,y:f,width:p,height:v,ry:b}=n;return j.createElement("rect",{x:c,y:f,ry:b,width:p,height:v,stroke:"none",fill:i,fillOpacity:s,className:"recharts-cartesian-grid-bg"})};function $ee(n,i){var s;if(j.isValidElement(n))s=j.cloneElement(n,i);else if(typeof n=="function")s=n(i);else{var{x1:c,y1:f,x2:p,y2:v,key:b}=i,T=vI(i,Zxe),w=Xl(T),{offset:C}=w,I=vI(w,Qxe);s=j.createElement("line",dm({},I,{x1:c,y1:f,x2:p,y2:v,fill:"none",key:b}))}return s}function o1e(n){var{x:i,width:s,horizontal:c=!0,horizontalPoints:f}=n;if(!c||!f||!f.length)return null;var{xAxisId:p,yAxisId:v}=n,b=vI(n,e1e),T=f.map((w,C)=>{var I=ka(ka({},b),{},{x1:i,y1:w,x2:i+s,y2:w,key:"line-".concat(C),index:C});return $ee(c,I)});return j.createElement("g",{className:"recharts-cartesian-grid-horizontal"},T)}function c1e(n){var{y:i,height:s,vertical:c=!0,verticalPoints:f}=n;if(!c||!f||!f.length)return null;var{xAxisId:p,yAxisId:v}=n,b=vI(n,t1e),T=f.map((w,C)=>{var I=ka(ka({},b),{},{x1:w,y1:i,x2:w,y2:i+s,key:"line-".concat(C),index:C});return $ee(c,I)});return j.createElement("g",{className:"recharts-cartesian-grid-vertical"},T)}function l1e(n){var{horizontalFill:i,fillOpacity:s,x:c,y:f,width:p,height:v,horizontalPoints:b,horizontal:T=!0}=n;if(!T||!i||!i.length)return null;var w=b.map(I=>Math.round(I+f-f)).sort((I,D)=>I-D);f!==w[0]&&w.unshift(0);var C=w.map((I,D)=>{var L=!w[D+1],F=L?f+v-I:w[D+1]-I;if(F<=0)return null;var W=D%i.length;return j.createElement("rect",{key:"react-".concat(D),y:I,x:c,height:F,width:p,stroke:"none",fill:i[W],fillOpacity:s,className:"recharts-cartesian-grid-bg"})});return j.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},C)}function u1e(n){var{vertical:i=!0,verticalFill:s,fillOpacity:c,x:f,y:p,width:v,height:b,verticalPoints:T}=n;if(!i||!s||!s.length)return null;var w=T.map(I=>Math.round(I+f-f)).sort((I,D)=>I-D);f!==w[0]&&w.unshift(0);var C=w.map((I,D)=>{var L=!w[D+1],F=L?f+v-I:w[D+1]-I;if(F<=0)return null;var W=D%s.length;return j.createElement("rect",{key:"react-".concat(D),x:I,y:p,width:F,height:b,stroke:"none",fill:s[W],fillOpacity:c,className:"recharts-cartesian-grid-bg"})});return j.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},C)}var d1e=(n,i)=>{var{xAxis:s,width:c,height:f,offset:p}=n;return q$(xj(ka(ka(ka({},Dj),s),{},{ticks:X$(s),viewBox:{x:0,y:0,width:c,height:f}})),p.left,p.left+p.width,i)},h1e=(n,i)=>{var{yAxis:s,width:c,height:f,offset:p}=n;return q$(xj(ka(ka(ka({},Dj),s),{},{ticks:X$(s),viewBox:{x:0,y:0,width:c,height:f}})),p.top,p.top+p.height,i)},f1e={horizontal:!0,vertical:!0,horizontalPoints:[],verticalPoints:[],stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[],xAxisId:0,yAxisId:0};function Zee(n){var i=rZ(),s=iZ(),c=nZ(),f=ka(ka({},$o(n,f1e)),{},{x:zt(n.x)?n.x:c.left,y:zt(n.y)?n.y:c.top,width:zt(n.width)?n.width:c.width,height:zt(n.height)?n.height:c.height}),{xAxisId:p,yAxisId:v,x:b,y:T,width:w,height:C,syncWithTicks:I,horizontalValues:D,verticalValues:L}=f,F=oo(),W=Ft(Ae=>IY(Ae,"xAxis",p,F)),G=Ft(Ae=>IY(Ae,"yAxis",v,F));if(!zt(w)||w<=0||!zt(C)||C<=0||!zt(b)||b!==+b||!zt(T)||T!==+T)return null;var $=f.verticalCoordinatesGenerator||d1e,te=f.horizontalCoordinatesGenerator||h1e,{horizontalPoints:Z,verticalPoints:ce}=f;if((!Z||!Z.length)&&typeof te=="function"){var se=D&&D.length,de=te({yAxis:G?ka(ka({},G),{},{ticks:se?D:G.ticks}):void 0,width:i,height:s,offset:c},se?!0:I);QO(Array.isArray(de),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(typeof de,"]")),Array.isArray(de)&&(Z=de)}if((!ce||!ce.length)&&typeof $=="function"){var oe=L&&L.length,ge=$({xAxis:W?ka(ka({},W),{},{ticks:oe?L:W.ticks}):void 0,width:i,height:s,offset:c},oe?!0:I);QO(Array.isArray(ge),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(typeof ge,"]")),Array.isArray(ge)&&(ce=ge)}return j.createElement("g",{className:"recharts-cartesian-grid"},j.createElement(s1e,{fill:f.fill,fillOpacity:f.fillOpacity,x:f.x,y:f.y,width:f.width,height:f.height,ry:f.ry}),j.createElement(l1e,dm({},f,{horizontalPoints:Z})),j.createElement(u1e,dm({},f,{verticalPoints:ce})),j.createElement(o1e,dm({},f,{offset:c,horizontalPoints:Z,xAxis:W,yAxis:G})),j.createElement(c1e,dm({},f,{offset:c,verticalPoints:ce,xAxis:W,yAxis:G})))}Zee.displayName="CartesianGrid";var Qee=(n,i,s,c)=>nee(n,"xAxis",i,c),ete=(n,i,s,c)=>tee(n,"xAxis",i,c),tte=(n,i,s,c)=>nee(n,"yAxis",s,c),nte=(n,i,s,c)=>tee(n,"yAxis",s,c),p1e=He([Nr,Qee,tte,ete,nte],(n,i,s,c,f)=>df(n,"xAxis")?XM(i,c,!1):XM(s,f,!1)),m1e=(n,i,s,c,f)=>f;function g1e(n){return n.type==="line"}var _1e=He([wQ,m1e],(n,i)=>n.filter(g1e).find(s=>s.id===i)),v1e=He([Nr,Qee,tte,ete,nte,_1e,p1e,QU],(n,i,s,c,f,p,v,b)=>{var{chartData:T,dataStartIndex:w,dataEndIndex:C}=b;if(!(p==null||i==null||s==null||c==null||f==null||c.length===0||f.length===0||v==null)){var{dataKey:I,data:D}=p,L;if(D!=null&&D.length>0?L=D:L=T?.slice(w,C+1),L!=null)return F1e({layout:n,xAxis:i,yAxis:s,xAxisTicks:c,yAxisTicks:f,dataKey:I,bandSize:v,displayedData:L})}});function y1e(n){var i=xI(n),s=3,c=2;if(i!=null){var{r:f,strokeWidth:p}=i,v=Number(f),b=Number(p);return(Number.isNaN(v)||v<0)&&(v=s),(Number.isNaN(b)||b<0)&&(b=c),{r:v,strokeWidth:b}}return{r:s,strokeWidth:c}}var E1e=["id"],S1e=["type","layout","connectNulls","needClip"],b1e=["activeDot","animateNewValues","animationBegin","animationDuration","animationEasing","connectNulls","dot","hide","isAnimationActive","label","legendType","xAxisId","yAxisId","id"];function fq(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(f){return Object.getOwnPropertyDescriptor(n,f).enumerable})),s.push.apply(s,c)}return s}function to(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?fq(Object(s),!0).forEach(function(c){T1e(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):fq(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}function T1e(n,i,s){return(i=w1e(i))in n?Object.defineProperty(n,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[i]=s,n}function w1e(n){var i=R1e(n,"string");return typeof i=="symbol"?i:i+""}function R1e(n,i){if(typeof n!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var c=s.call(n,i);if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}function kj(n,i){if(n==null)return{};var s,c,f=C1e(n,i);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);for(c=0;c<p.length;c++)s=p[c],i.indexOf(s)===-1&&{}.propertyIsEnumerable.call(n,s)&&(f[s]=n[s])}return f}function C1e(n,i){if(n==null)return{};var s={};for(var c in n)if({}.hasOwnProperty.call(n,c)){if(i.indexOf(c)!==-1)continue;s[c]=n[c]}return s}function wm(){return wm=Object.assign?Object.assign.bind():function(n){for(var i=1;i<arguments.length;i++){var s=arguments[i];for(var c in s)({}).hasOwnProperty.call(s,c)&&(n[c]=s[c])}return n},wm.apply(null,arguments)}var A1e=n=>{var{dataKey:i,name:s,stroke:c,legendType:f,hide:p}=n;return[{inactive:p,dataKey:i,type:f,color:c,value:J$(s,i),payload:n}]};function O1e(n){var{dataKey:i,data:s,stroke:c,strokeWidth:f,fill:p,name:v,hide:b,unit:T}=n;return{dataDefinedOnItem:s,positions:void 0,settings:{stroke:c,strokeWidth:f,fill:p,dataKey:i,nameKey:void 0,name:J$(v,i),hide:b,type:n.tooltipType,color:n.stroke,unit:T}}}var rte=(n,i)=>"".concat(i,"px ").concat(n-i,"px");function I1e(n,i){for(var s=n.length%2!==0?[...n,0]:n,c=[],f=0;f<i;++f)c=[...c,...s];return c}var N1e=(n,i,s)=>{var c=s.reduce((I,D)=>I+D);if(!c)return rte(i,n);for(var f=Math.floor(n/c),p=n%c,v=i-n,b=[],T=0,w=0;T<s.length;w+=s[T],++T)if(w+s[T]>p){b=[...s.slice(0,T),p-w];break}var C=b.length%2===0?[0,v]:[v];return[...I1e(s,f),...b,...C].map(I=>"".concat(I,"px")).join(", ")};function x1e(n,i){var s;if(j.isValidElement(n))s=j.cloneElement(n,i);else if(typeof n=="function")s=n(i);else{var c=Ir("recharts-line-dot",typeof n!="boolean"?n.className:"");s=j.createElement(Fee,wm({},i,{className:c}))}return s}function D1e(n,i){return n==null?!1:i?!0:n.length===1}function P1e(n){var{clipPathId:i,points:s,props:c}=n,{dot:f,dataKey:p,needClip:v}=c;if(!D1e(s,f))return null;var{id:b}=c,T=kj(c,E1e),w=Hee(f),C=Xl(T),I=Zye(f),D=s.map((F,W)=>{var G=to(to(to({key:"dot-".concat(W),r:3},C),I),{},{index:W,cx:F.x,cy:F.y,dataKey:p,value:F.value,payload:F.payload,points:s});return x1e(f,G)}),L={clipPath:v?"url(#clipPath-".concat(w?"":"dots-").concat(i,")"):void 0};return j.createElement(Kv,wm({className:"recharts-line-dots",key:"dots"},L),D)}function k1e(n){var{showLabels:i,children:s,points:c}=n,f=j.useMemo(()=>c?.map(p=>{var v={x:p.x,y:p.y,width:0,height:0};return to(to({},v),{},{value:p.value,payload:p.payload,viewBox:v,parentViewBox:void 0,fill:void 0})}),[c]);return j.createElement(TNe,{value:i?f:null},s)}function pq(n){var{clipPathId:i,pathRef:s,points:c,strokeDasharray:f,props:p}=n,{type:v,layout:b,connectNulls:T,needClip:w}=p,C=kj(p,S1e),I=to(to({},qo(C)),{},{fill:"none",className:"recharts-line-curve",clipPath:w?"url(#clipPath-".concat(i,")"):void 0,points:c,type:v,layout:b,connectNulls:T,strokeDasharray:f??p.strokeDasharray});return j.createElement(j.Fragment,null,c?.length>1&&j.createElement(oZ,wm({},I,{pathRef:s})),j.createElement(P1e,{points:c,clipPathId:i,props:p}))}function L1e(n){try{return n&&n.getTotalLength&&n.getTotalLength()||0}catch{return 0}}function M1e(n){var{clipPathId:i,props:s,pathRef:c,previousPointsRef:f,longestAnimatedLengthRef:p}=n,{points:v,strokeDasharray:b,isAnimationActive:T,animationBegin:w,animationDuration:C,animationEasing:I,animateNewValues:D,width:L,height:F,onAnimationEnd:W,onAnimationStart:G}=s,$=f.current,te=hZ(s,"recharts-line-"),[Z,ce]=j.useState(!1),se=!Z,de=j.useCallback(()=>{typeof W=="function"&&W(),ce(!1)},[W]),oe=j.useCallback(()=>{typeof G=="function"&&G(),ce(!0)},[G]),ge=L1e(c.current),Ae=p.current;return j.createElement(k1e,{points:v,showLabels:se},s.children,j.createElement(dZ,{animationId:te,begin:w,duration:C,isActive:T,easing:I,onAnimationEnd:de,onAnimationStart:oe,key:te},ke=>{var Ee=Ju(Ae,ge+Ae,ke),be=Math.min(Ee,ge),Le;if(T)if(b){var et="".concat(b).split(/[,\s]+/gim).map(_e=>parseFloat(_e));Le=N1e(be,ge,et)}else Le=rte(ge,be);else Le=b==null?void 0:String(b);if($){var rt=$.length/v.length,he=ke===1?v:v.map((_e,ze)=>{var tt=Math.floor(ze*rt);if($[tt]){var ut=$[tt];return to(to({},_e),{},{x:Ju(ut.x,_e.x,ke),y:Ju(ut.y,_e.y,ke)})}return D?to(to({},_e),{},{x:Ju(L*2,_e.x,ke),y:Ju(F/2,_e.y,ke)}):to(to({},_e),{},{x:_e.x,y:_e.y})});return f.current=he,j.createElement(pq,{props:s,points:he,clipPathId:i,pathRef:c,strokeDasharray:Le})}return ke>0&&ge>0&&(f.current=v,p.current=be),j.createElement(pq,{props:s,points:v,clipPathId:i,pathRef:c,strokeDasharray:Le})}),j.createElement(CNe,{label:s.label}))}function U1e(n){var{clipPathId:i,props:s}=n,c=j.useRef(null),f=j.useRef(0),p=j.useRef(null);return j.createElement(M1e,{props:s,clipPathId:i,previousPointsRef:c,longestAnimatedLengthRef:f,pathRef:p})}var j1e=(n,i)=>({x:n.x,y:n.y,value:n.value,errorVal:ts(n.payload,i)});class V1e extends j.Component{render(){var{hide:i,dot:s,points:c,className:f,xAxisId:p,yAxisId:v,top:b,left:T,width:w,height:C,id:I,needClip:D}=this.props;if(i)return null;var L=Ir("recharts-line",f),F=I,{r:W,strokeWidth:G}=y1e(s),$=Hee(s),te=W*2+G;return j.createElement(j.Fragment,null,j.createElement(Kv,{className:L},D&&j.createElement("defs",null,j.createElement(mxe,{clipPathId:F,xAxisId:p,yAxisId:v}),!$&&j.createElement("clipPath",{id:"clipPath-dots-".concat(F)},j.createElement("rect",{x:T-te/2,y:b-te/2,width:w+te,height:C+te}))),j.createElement(pxe,{xAxisId:p,yAxisId:v,data:c,dataPointFormatter:j1e,errorBarOffset:0},j.createElement(U1e,{props:this.props,clipPathId:F}))),j.createElement(sxe,{activeDot:this.props.activeDot,points:c,mainColor:this.props.stroke,itemDataKey:this.props.dataKey}))}}var ite={activeDot:!0,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",connectNulls:!1,dot:!0,fill:"#fff",hide:!1,isAnimationActive:!Yv.isSsr,label:!1,legendType:"line",stroke:"#3182bd",strokeWidth:1,xAxisId:0,yAxisId:0};function B1e(n){var i=$o(n,ite),{activeDot:s,animateNewValues:c,animationBegin:f,animationDuration:p,animationEasing:v,connectNulls:b,dot:T,hide:w,isAnimationActive:C,label:I,legendType:D,xAxisId:L,yAxisId:F,id:W}=i,G=kj(i,b1e),{needClip:$}=Yee(L,F),te=Ij(),Z=IU(),ce=oo(),se=Ft(ke=>v1e(ke,L,F,ce,W));if(Z!=="horizontal"&&Z!=="vertical"||se==null||te==null)return null;var{height:de,width:oe,x:ge,y:Ae}=te;return j.createElement(V1e,wm({},G,{id:W,connectNulls:b,dot:T,activeDot:s,animateNewValues:c,animationBegin:f,animationDuration:p,animationEasing:v,isAnimationActive:C,hide:w,label:I,legendType:D,xAxisId:L,yAxisId:F,points:se,layout:Z,height:de,width:oe,left:ge,top:Ae,needClip:$}))}function F1e(n){var{layout:i,xAxis:s,yAxis:c,xAxisTicks:f,yAxisTicks:p,dataKey:v,bandSize:b,displayedData:T}=n;return T.map((w,C)=>{var I=ts(w,v);if(i==="horizontal"){var D=o7({axis:s,ticks:f,bandSize:b,entry:w,index:C}),L=ta(I)?null:c.scale(I);return{x:D,y:L,value:I,payload:w}}var F=ta(I)?null:s.scale(I),W=o7({axis:c,ticks:p,bandSize:b,entry:w,index:C});return F==null||W==null?null:{x:F,y:W,value:I,payload:w}}).filter(Boolean)}function G1e(n){var i=$o(n,ite),s=oo();return j.createElement(MNe,{id:i.id,type:"line"},c=>j.createElement(j.Fragment,null,j.createElement(xNe,{legendPayload:A1e(i)}),j.createElement(INe,{fn:O1e,args:i}),j.createElement(GNe,{type:"line",id:c,data:i.data,xAxisId:i.xAxisId,yAxisId:i.yAxisId,zAxisId:0,dataKey:i.dataKey,hide:i.hide,isPanorama:s}),j.createElement(B1e,wm({},i,{id:c}))))}var ate=j.memo(G1e);ate.displayName="Line";var H1e=["dangerouslySetInnerHTML","ticks"],W1e=["id"],z1e=["domain"],K1e=["domain"];function E2(){return E2=Object.assign?Object.assign.bind():function(n){for(var i=1;i<arguments.length;i++){var s=arguments[i];for(var c in s)({}).hasOwnProperty.call(s,c)&&(n[c]=s[c])}return n},E2.apply(null,arguments)}function yI(n,i){if(n==null)return{};var s,c,f=Y1e(n,i);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);for(c=0;c<p.length;c++)s=p[c],i.indexOf(s)===-1&&{}.propertyIsEnumerable.call(n,s)&&(f[s]=n[s])}return f}function Y1e(n,i){if(n==null)return{};var s={};for(var c in n)if({}.hasOwnProperty.call(n,c)){if(i.indexOf(c)!==-1)continue;s[c]=n[c]}return s}function q1e(n){var i=La();return j.useLayoutEffect(()=>(i(YNe(n)),()=>{i(qNe(n))}),[n,i]),null}var X1e=n=>{var{xAxisId:i,className:s}=n,c=Ft(Z$),f=oo(),p="xAxis",v=Ft(G=>ey(G,p,i,f)),b=Ft(G=>eee(G,p,i,f)),T=Ft(G=>AAe(G,i)),w=Ft(G=>PAe(G,i)),C=Ft(G=>EQ(G,i));if(T==null||w==null||C==null)return null;var{dangerouslySetInnerHTML:I,ticks:D}=n,L=yI(n,H1e),{id:F}=C,W=yI(C,W1e);return j.createElement(Pj,E2({},L,W,{scale:v,x:w.x,y:w.y,width:T.width,height:T.height,className:Ir("recharts-".concat(p," ").concat(p),s),viewBox:c,ticks:b}))},J1e={allowDataOverflow:Zs.allowDataOverflow,allowDecimals:Zs.allowDecimals,allowDuplicatedCategory:Zs.allowDuplicatedCategory,height:Zs.height,hide:!1,mirror:Zs.mirror,orientation:Zs.orientation,padding:Zs.padding,reversed:Zs.reversed,scale:Zs.scale,tickCount:Zs.tickCount,type:Zs.type,xAxisId:0},$1e=n=>{var i,s,c,f,p,v=$o(n,J1e);return j.createElement(j.Fragment,null,j.createElement(q1e,{interval:(i=v.interval)!==null&&i!==void 0?i:"preserveEnd",id:v.xAxisId,scale:v.scale,type:v.type,padding:v.padding,allowDataOverflow:v.allowDataOverflow,domain:v.domain,dataKey:v.dataKey,allowDuplicatedCategory:v.allowDuplicatedCategory,allowDecimals:v.allowDecimals,tickCount:v.tickCount,includeHidden:(s=v.includeHidden)!==null&&s!==void 0?s:!1,reversed:v.reversed,ticks:v.ticks,height:v.height,orientation:v.orientation,mirror:v.mirror,hide:v.hide,unit:v.unit,name:v.name,angle:(c=v.angle)!==null&&c!==void 0?c:0,minTickGap:(f=v.minTickGap)!==null&&f!==void 0?f:5,tick:(p=v.tick)!==null&&p!==void 0?p:!0,tickFormatter:v.tickFormatter}),j.createElement(X1e,v))},Z1e=(n,i)=>{var{domain:s}=n,c=yI(n,z1e),{domain:f}=i,p=yI(i,K1e);return jv(c,p)?Array.isArray(s)&&s.length===2&&Array.isArray(f)&&f.length===2?s[0]===f[0]&&s[1]===f[1]:jv({domain:s},{domain:f}):!1},ste=j.memo($1e,Z1e);ste.displayName="XAxis";var Q1e=["dangerouslySetInnerHTML","ticks"],eDe=["id"],tDe=["domain"],nDe=["domain"];function S2(){return S2=Object.assign?Object.assign.bind():function(n){for(var i=1;i<arguments.length;i++){var s=arguments[i];for(var c in s)({}).hasOwnProperty.call(s,c)&&(n[c]=s[c])}return n},S2.apply(null,arguments)}function EI(n,i){if(n==null)return{};var s,c,f=rDe(n,i);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);for(c=0;c<p.length;c++)s=p[c],i.indexOf(s)===-1&&{}.propertyIsEnumerable.call(n,s)&&(f[s]=n[s])}return f}function rDe(n,i){if(n==null)return{};var s={};for(var c in n)if({}.hasOwnProperty.call(n,c)){if(i.indexOf(c)!==-1)continue;s[c]=n[c]}return s}function iDe(n){var i=La();return j.useLayoutEffect(()=>(i(XNe(n)),()=>{i(JNe(n))}),[n,i]),null}var aDe=n=>{var{yAxisId:i,className:s,width:c,label:f}=n,p=j.useRef(null),v=j.useRef(null),b=Ft(Z$),T=oo(),w=La(),C="yAxis",I=Ft(se=>ey(se,C,i,T)),D=Ft(se=>MAe(se,i)),L=Ft(se=>LAe(se,i)),F=Ft(se=>eee(se,C,i,T)),W=Ft(se=>SQ(se,i));if(j.useLayoutEffect(()=>{if(!(c!=="auto"||!D||Oj(f)||j.isValidElement(f)||W==null)){var se=p.current;if(se){var de=se.getCalculatedWidth();Math.round(D.width)!==Math.round(de)&&w($Ne({id:i,width:de}))}}},[F,D,w,f,i,c,W]),D==null||L==null||W==null)return null;var{dangerouslySetInnerHTML:G,ticks:$}=n,te=EI(n,Q1e),{id:Z}=W,ce=EI(W,eDe);return j.createElement(Pj,S2({},te,ce,{ref:p,labelRef:v,scale:I,x:L.x,y:L.y,tickTextProps:c==="auto"?{width:void 0}:{width:c},width:D.width,height:D.height,className:Ir("recharts-".concat(C," ").concat(C),s),viewBox:b,ticks:F}))},sDe={allowDataOverflow:Qs.allowDataOverflow,allowDecimals:Qs.allowDecimals,allowDuplicatedCategory:Qs.allowDuplicatedCategory,hide:!1,mirror:Qs.mirror,orientation:Qs.orientation,padding:Qs.padding,reversed:Qs.reversed,scale:Qs.scale,tickCount:Qs.tickCount,type:Qs.type,width:Qs.width,yAxisId:0},oDe=n=>{var i,s,c,f,p,v=$o(n,sDe);return j.createElement(j.Fragment,null,j.createElement(iDe,{interval:(i=v.interval)!==null&&i!==void 0?i:"preserveEnd",id:v.yAxisId,scale:v.scale,type:v.type,domain:v.domain,allowDataOverflow:v.allowDataOverflow,dataKey:v.dataKey,allowDuplicatedCategory:v.allowDuplicatedCategory,allowDecimals:v.allowDecimals,tickCount:v.tickCount,padding:v.padding,includeHidden:(s=v.includeHidden)!==null&&s!==void 0?s:!1,reversed:v.reversed,ticks:v.ticks,width:v.width,orientation:v.orientation,mirror:v.mirror,hide:v.hide,unit:v.unit,name:v.name,angle:(c=v.angle)!==null&&c!==void 0?c:0,minTickGap:(f=v.minTickGap)!==null&&f!==void 0?f:5,tick:(p=v.tick)!==null&&p!==void 0?p:!0,tickFormatter:v.tickFormatter}),j.createElement(aDe,v))},cDe=(n,i)=>{var{domain:s}=n,c=EI(n,tDe),{domain:f}=i,p=EI(i,nDe);return jv(c,p)?Array.isArray(s)&&s.length===2&&Array.isArray(f)&&f.length===2?s[0]===f[0]&&s[1]===f[1]:jv({domain:s},{domain:f}):!1},ote=j.memo(oDe,cDe);ote.displayName="YAxis";var sM={exports:{}},oM={};/**
 * @license React
 * use-sync-external-store-with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mq;function lDe(){if(mq)return oM;mq=1;var n=Vv();function i(T,w){return T===w&&(T!==0||1/T===1/w)||T!==T&&w!==w}var s=typeof Object.is=="function"?Object.is:i,c=n.useSyncExternalStore,f=n.useRef,p=n.useEffect,v=n.useMemo,b=n.useDebugValue;return oM.useSyncExternalStoreWithSelector=function(T,w,C,I,D){var L=f(null);if(L.current===null){var F={hasValue:!1,value:null};L.current=F}else F=L.current;L=v(function(){function G(se){if(!$){if($=!0,te=se,se=I(se),D!==void 0&&F.hasValue){var de=F.value;if(D(de,se))return Z=de}return Z=se}if(de=Z,s(te,se))return de;var oe=I(se);return D!==void 0&&D(de,oe)?(te=se,de):(te=se,Z=oe)}var $=!1,te,Z,ce=C===void 0?null:C;return[function(){return G(w())},ce===null?void 0:function(){return G(ce())}]},[w,C,I,D]);var W=c(T,L[0],L[1]);return p(function(){F.hasValue=!0,F.value=W},[W]),b(W),W},oM}var gq;function uDe(){return gq||(gq=1,sM.exports=lDe()),sM.exports}uDe();function dDe(n){n()}function hDe(){let n=null,i=null;return{clear(){n=null,i=null},notify(){dDe(()=>{let s=n;for(;s;)s.callback(),s=s.next})},get(){const s=[];let c=n;for(;c;)s.push(c),c=c.next;return s},subscribe(s){let c=!0;const f=i={callback:s,next:null,prev:i};return f.prev?f.prev.next=f:n=f,function(){!c||n===null||(c=!1,f.next?f.next.prev=f.prev:i=f.prev,f.prev?f.prev.next=f.next:n=f.next)}}}}var _q={notify(){},get:()=>[]};function fDe(n,i){let s,c=_q,f=0,p=!1;function v(W){C();const G=c.subscribe(W);let $=!1;return()=>{$||($=!0,G(),I())}}function b(){c.notify()}function T(){F.onStateChange&&F.onStateChange()}function w(){return p}function C(){f++,s||(s=n.subscribe(T),c=hDe())}function I(){f--,s&&f===0&&(s(),s=void 0,c.clear(),c=_q)}function D(){p||(p=!0,C())}function L(){p&&(p=!1,I())}const F={addNestedSub:v,notifyNestedSubs:b,handleChangeWrapper:T,isSubscribed:w,trySubscribe:D,tryUnsubscribe:L,getListeners:()=>c};return F}var pDe=()=>typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",mDe=pDe(),gDe=()=>typeof navigator<"u"&&navigator.product==="ReactNative",_De=gDe(),vDe=()=>mDe||_De?j.useLayoutEffect:j.useEffect,yDe=vDe(),EDe=Symbol.for("react-redux-context"),SDe=typeof globalThis<"u"?globalThis:{};function bDe(){if(!j.createContext)return{};const n=SDe[EDe]??=new Map;let i=n.get(j.createContext);return i||(i=j.createContext(null),n.set(j.createContext,i)),i}var TDe=bDe();function wDe(n){const{children:i,context:s,serverState:c,store:f}=n,p=j.useMemo(()=>{const T=fDe(f);return{store:f,subscription:T,getServerState:c?()=>c:void 0}},[f,c]),v=j.useMemo(()=>f.getState(),[f]);yDe(()=>{const{subscription:T}=p;return T.onStateChange=T.notifyNestedSubs,T.trySubscribe(),v!==f.getState()&&T.notifyNestedSubs(),()=>{T.tryUnsubscribe(),T.onStateChange=void 0}},[p,v]);const b=s||TDe;return j.createElement(b.Provider,{value:p},i)}var RDe=wDe,CDe=(n,i)=>i,Lj=He([CDe,Nr,gQ,Fi,vee,yd,FOe,ga],KOe),Mj=n=>{var i=n.currentTarget.getBoundingClientRect(),s=i.width/n.currentTarget.offsetWidth,c=i.height/n.currentTarget.offsetHeight;return{chartX:Math.round((n.clientX-i.left)/s),chartY:Math.round((n.clientY-i.top)/c)}},cte=Xo("mouseClick"),lte=Db();lte.startListening({actionCreator:cte,effect:(n,i)=>{var s=n.payload,c=Lj(i.getState(),Mj(s));c?.activeIndex!=null&&i.dispatch(qAe({activeIndex:c.activeIndex,activeDataKey:void 0,activeCoordinate:c.activeCoordinate}))}});var b2=Xo("mouseMove"),ute=Db();ute.startListening({actionCreator:b2,effect:(n,i)=>{var s=n.payload,c=i.getState(),f=vj(c,c.tooltip.settings.shared),p=Lj(c,Mj(s));f==="axis"&&(p?.activeIndex!=null?i.dispatch(lee({activeIndex:p.activeIndex,activeDataKey:void 0,activeCoordinate:p.activeCoordinate})):i.dispatch(cee()))}});var vq={accessibilityLayer:!0,barCategoryGap:"10%",barGap:4,barSize:void 0,className:void 0,maxBarSize:void 0,stackOffset:"none",syncId:void 0,syncMethod:"index"},dte=so({name:"rootProps",initialState:vq,reducers:{updateOptions:(n,i)=>{var s;n.accessibilityLayer=i.payload.accessibilityLayer,n.barCategoryGap=i.payload.barCategoryGap,n.barGap=(s=i.payload.barGap)!==null&&s!==void 0?s:vq.barGap,n.barSize=i.payload.barSize,n.maxBarSize=i.payload.maxBarSize,n.stackOffset=i.payload.stackOffset,n.syncId=i.payload.syncId,n.syncMethod=i.payload.syncMethod,n.className=i.payload.className}}}),ADe=dte.reducer,{updateOptions:ODe}=dte.actions,hte=so({name:"polarOptions",initialState:null,reducers:{updatePolarOptions:(n,i)=>i.payload}}),{updatePolarOptions:QPe}=hte.actions,IDe=hte.reducer,fte=Xo("keyDown"),pte=Xo("focus"),Uj=Db();Uj.startListening({actionCreator:fte,effect:(n,i)=>{var s=i.getState(),c=s.rootProps.accessibilityLayer!==!1;if(c){var{keyboardInteraction:f}=s.tooltip,p=n.payload;if(!(p!=="ArrowRight"&&p!=="ArrowLeft"&&p!=="Enter")){var v=Number(yj(f,ny(s))),b=yd(s);if(p==="Enter"){var T=mI(s,"axis","hover",String(f.index));i.dispatch(p2({active:!f.active,activeIndex:f.index,activeDataKey:f.dataKey,activeCoordinate:T}));return}var w=BAe(s),C=w==="left-to-right"?1:-1,I=p==="ArrowRight"?1:-1,D=v+I*C;if(!(b==null||D>=b.length||D<0)){var L=mI(s,"axis","hover",String(D));i.dispatch(p2({active:!0,activeIndex:D.toString(),activeDataKey:void 0,activeCoordinate:L}))}}}}});Uj.startListening({actionCreator:pte,effect:(n,i)=>{var s=i.getState(),c=s.rootProps.accessibilityLayer!==!1;if(c){var{keyboardInteraction:f}=s.tooltip;if(!f.active&&f.index==null){var p="0",v=mI(s,"axis","hover",String(p));i.dispatch(p2({activeDataKey:void 0,active:!0,activeIndex:p,activeCoordinate:v}))}}}});var Bo=Xo("externalEvent"),mte=Db();mte.startListening({actionCreator:Bo,effect:(n,i)=>{if(n.payload.handler!=null){var s=i.getState(),c={activeCoordinate:xOe(s),activeDataKey:IOe(s),activeIndex:Eb(s),activeLabel:See(s),activeTooltipIndex:Eb(s),isTooltipActive:DOe(s)};n.payload.handler(c,n.payload.reactEvent)}}});var NDe=He([ty],n=>n.tooltipItemPayloads),xDe=He([NDe,Gb,(n,i,s)=>i,(n,i,s)=>s],(n,i,s,c)=>{var f=n.find(b=>b.settings.dataKey===c);if(f!=null){var{positions:p}=f;if(p!=null){var v=i(p,s);return v}}}),gte=Xo("touchMove"),_te=Db();_te.startListening({actionCreator:gte,effect:(n,i)=>{var s=n.payload,c=i.getState(),f=vj(c,c.tooltip.settings.shared);if(f==="axis"){var p=Lj(c,Mj({clientX:s.touches[0].clientX,clientY:s.touches[0].clientY,currentTarget:s.currentTarget}));p?.activeIndex!=null&&i.dispatch(lee({activeIndex:p.activeIndex,activeDataKey:void 0,activeCoordinate:p.activeCoordinate}))}else if(f==="item"){var v,b=s.touches[0],T=document.elementFromPoint(b.clientX,b.clientY);if(!T||!T.getAttribute)return;var w=T.getAttribute($Se),C=(v=T.getAttribute(ZSe))!==null&&v!==void 0?v:void 0,I=xDe(i.getState(),w,C);i.dispatch(YAe({activeDataKey:C,activeIndex:w,activeCoordinate:I}))}}});var DDe=b$({brush:_xe,cartesianAxis:ZNe,chartData:lIe,errorBars:cxe,graphicalItems:FNe,layout:TSe,legend:Nbe,options:iIe,polarAxis:ONe,polarOptions:IDe,referenceElements:wxe,rootProps:ADe,tooltip:XAe}),PDe=function(i){return q0e({reducer:DDe,preloadedState:i,middleware:s=>s({serializableCheck:!1}).concat([lte.middleware,ute.middleware,Uj.middleware,mte.middleware,_te.middleware]),enhancers:s=>{var c=s;return typeof s=="function"&&(c=s()),c.concat(k$({type:"raf"}))},devTools:Yv.devToolsEnabled})};function kDe(n){var{preloadedState:i,children:s,reduxStoreName:c}=n,f=oo(),p=j.useRef(null);if(f)return s;p.current==null&&(p.current=PDe(i));var v=bU;return j.createElement(RDe,{context:v,store:p.current},s)}function LDe(n){var{layout:i,margin:s}=n,c=La(),f=oo();return j.useEffect(()=>{f||(c(ESe(i)),c(ySe(s)))},[c,f,i,s]),null}function MDe(n){var i=La();return j.useEffect(()=>{i(ODe(n))},[i,n]),null}var UDe=["children"];function jDe(n,i){if(n==null)return{};var s,c,f=VDe(n,i);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);for(c=0;c<p.length;c++)s=p[c],i.indexOf(s)===-1&&{}.propertyIsEnumerable.call(n,s)&&(f[s]=n[s])}return f}function VDe(n,i){if(n==null)return{};var s={};for(var c in n)if({}.hasOwnProperty.call(n,c)){if(i.indexOf(c)!==-1)continue;s[c]=n[c]}return s}function SI(){return SI=Object.assign?Object.assign.bind():function(n){for(var i=1;i<arguments.length;i++){var s=arguments[i];for(var c in s)({}).hasOwnProperty.call(s,c)&&(n[c]=s[c])}return n},SI.apply(null,arguments)}var BDe={width:"100%",height:"100%",display:"block"},FDe=j.forwardRef((n,i)=>{var s=rZ(),c=iZ(),f=sZ();if(!kv(s)||!kv(c))return null;var{children:p,otherAttributes:v,title:b,desc:T}=n,w,C;return typeof v.tabIndex=="number"?w=v.tabIndex:w=f?0:void 0,typeof v.role=="string"?C=v.role:C=f?"application":void 0,j.createElement(WJ,SI({},v,{title:b,desc:T,role:C,tabIndex:w,width:s,height:c,style:BDe,ref:i}),p)}),GDe=n=>{var{children:i}=n,s=Ft(WI);if(!s)return null;var{width:c,height:f,y:p,x:v}=s;return j.createElement(WJ,{width:c,height:f,x:v,y:p},i)},yq=j.forwardRef((n,i)=>{var{children:s}=n,c=jDe(n,UDe),f=oo();return f?j.createElement(GDe,null,s):j.createElement(FDe,SI({ref:i},c),s)});function HDe(){var n=La(),[i,s]=j.useState(null),c=Ft(JSe);return j.useEffect(()=>{if(i!=null){var f=i.getBoundingClientRect(),p=f.width/i.offsetWidth;xs(p)&&p!==c&&n(bSe(p))}},[i,n,c]),s}function Eq(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(f){return Object.getOwnPropertyDescriptor(n,f).enumerable})),s.push.apply(s,c)}return s}function WDe(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?Eq(Object(s),!0).forEach(function(c){zDe(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):Eq(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}function zDe(n,i,s){return(i=KDe(i))in n?Object.defineProperty(n,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[i]=s,n}function KDe(n){var i=YDe(n,"string");return typeof i=="symbol"?i:i+""}function YDe(n,i){if(typeof n!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var c=s.call(n,i);if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}function Rm(){return Rm=Object.assign?Object.assign.bind():function(n){for(var i=1;i<arguments.length;i++){var s=arguments[i];for(var c in s)({}).hasOwnProperty.call(s,c)&&(n[c]=s[c])}return n},Rm.apply(null,arguments)}var qDe=()=>(vIe(),null);function bI(n){if(typeof n=="number")return n;if(typeof n=="string"){var i=parseFloat(n);if(!Number.isNaN(i))return i}return 0}var XDe=j.forwardRef((n,i)=>{var s,c,f=j.useRef(null),[p,v]=j.useState({containerWidth:bI((s=n.style)===null||s===void 0?void 0:s.width),containerHeight:bI((c=n.style)===null||c===void 0?void 0:c.height)}),b=j.useCallback((w,C)=>{v(I=>{var D=Math.round(w),L=Math.round(C);return I.containerWidth===D&&I.containerHeight===L?I:{containerWidth:D,containerHeight:L}})},[]),T=j.useCallback(w=>{if(typeof i=="function"&&i(w),w!=null){var{width:C,height:I}=w.getBoundingClientRect();b(C,I);var D=F=>{var{width:W,height:G}=F[0].contentRect;b(W,G)},L=new ResizeObserver(D);L.observe(w),f.current=L}},[i,b]);return j.useEffect(()=>()=>{var w=f.current;w?.disconnect()},[b]),j.createElement(j.Fragment,null,j.createElement(KI,{width:p.containerWidth,height:p.containerHeight}),j.createElement("div",Rm({ref:T},n)))}),JDe=j.forwardRef((n,i)=>{var{width:s,height:c}=n,[f,p]=j.useState({containerWidth:bI(s),containerHeight:bI(c)}),v=j.useCallback((T,w)=>{p(C=>{var I=Math.round(T),D=Math.round(w);return C.containerWidth===I&&C.containerHeight===D?C:{containerWidth:I,containerHeight:D}})},[]),b=j.useCallback(T=>{if(typeof i=="function"&&i(T),T!=null){var{width:w,height:C}=T.getBoundingClientRect();v(w,C)}},[i,v]);return j.createElement(j.Fragment,null,j.createElement(KI,{width:f.containerWidth,height:f.containerHeight}),j.createElement("div",Rm({ref:b},n)))}),$De=j.forwardRef((n,i)=>{var{width:s,height:c}=n;return j.createElement(j.Fragment,null,j.createElement(KI,{width:s,height:c}),j.createElement("div",Rm({ref:i},n)))}),ZDe=j.forwardRef((n,i)=>{var{width:s,height:c}=n;return cd(s)||cd(c)?j.createElement(JDe,Rm({},n,{ref:i})):j.createElement($De,Rm({},n,{ref:i}))});function QDe(n){return n===!0?XDe:ZDe}var ePe=j.forwardRef((n,i)=>{var{children:s,className:c,height:f,onClick:p,onContextMenu:v,onDoubleClick:b,onMouseDown:T,onMouseEnter:w,onMouseLeave:C,onMouseMove:I,onMouseUp:D,onTouchEnd:L,onTouchMove:F,onTouchStart:W,style:G,width:$,responsive:te,dispatchTouchEvents:Z=!0}=n,ce=j.useRef(null),se=La(),[de,oe]=j.useState(null),[ge,Ae]=j.useState(null),ke=HDe(),Ee=OU(),be=Ee?.width>0?Ee.width:$,Le=Ee?.height>0?Ee.height:f,et=j.useCallback(qe=>{ke(qe),typeof i=="function"&&i(qe),oe(qe),Ae(qe),qe!=null&&(ce.current=qe)},[ke,i,oe,Ae]),rt=j.useCallback(qe=>{se(cte(qe)),se(Bo({handler:p,reactEvent:qe}))},[se,p]),he=j.useCallback(qe=>{se(b2(qe)),se(Bo({handler:w,reactEvent:qe}))},[se,w]),_e=j.useCallback(qe=>{se(cee()),se(Bo({handler:C,reactEvent:qe}))},[se,C]),ze=j.useCallback(qe=>{se(b2(qe)),se(Bo({handler:I,reactEvent:qe}))},[se,I]),tt=j.useCallback(()=>{se(pte())},[se]),ut=j.useCallback(qe=>{se(fte(qe.key))},[se]),me=j.useCallback(qe=>{se(Bo({handler:v,reactEvent:qe}))},[se,v]),Ve=j.useCallback(qe=>{se(Bo({handler:b,reactEvent:qe}))},[se,b]),it=j.useCallback(qe=>{se(Bo({handler:T,reactEvent:qe}))},[se,T]),dt=j.useCallback(qe=>{se(Bo({handler:D,reactEvent:qe}))},[se,D]),Ct=j.useCallback(qe=>{se(Bo({handler:W,reactEvent:qe}))},[se,W]),rn=j.useCallback(qe=>{Z&&se(gte(qe)),se(Bo({handler:F,reactEvent:qe}))},[se,Z,F]),En=j.useCallback(qe=>{se(Bo({handler:L,reactEvent:qe}))},[se,L]),ai=QDe(te);return j.createElement(Aee.Provider,{value:de},j.createElement(aEe.Provider,{value:ge},j.createElement(ai,{width:be??G?.width,height:Le??G?.height,className:Ir("recharts-wrapper",c),style:WDe({position:"relative",cursor:"default",width:be,height:Le},G),onClick:rt,onContextMenu:me,onDoubleClick:Ve,onFocus:tt,onKeyDown:ut,onMouseDown:it,onMouseEnter:he,onMouseLeave:_e,onMouseMove:ze,onMouseUp:dt,onTouchEnd:En,onTouchMove:rn,onTouchStart:Ct,ref:et},j.createElement(qDe,null),s)))}),tPe=["width","height","responsive","children","className","style","compact","title","desc"];function nPe(n,i){if(n==null)return{};var s,c,f=rPe(n,i);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);for(c=0;c<p.length;c++)s=p[c],i.indexOf(s)===-1&&{}.propertyIsEnumerable.call(n,s)&&(f[s]=n[s])}return f}function rPe(n,i){if(n==null)return{};var s={};for(var c in n)if({}.hasOwnProperty.call(n,c)){if(i.indexOf(c)!==-1)continue;s[c]=n[c]}return s}var iPe=j.forwardRef((n,i)=>{var{width:s,height:c,responsive:f,children:p,className:v,style:b,compact:T,title:w,desc:C}=n,I=nPe(n,tPe),D=Xl(I);return T?j.createElement(j.Fragment,null,j.createElement(KI,{width:s,height:c}),j.createElement(yq,{otherAttributes:D,title:w,desc:C},p)):j.createElement(ePe,{className:v,style:b,width:s,height:c,responsive:f,onClick:n.onClick,onMouseLeave:n.onMouseLeave,onMouseEnter:n.onMouseEnter,onMouseMove:n.onMouseMove,onMouseDown:n.onMouseDown,onMouseUp:n.onMouseUp,onContextMenu:n.onContextMenu,onDoubleClick:n.onDoubleClick,onTouchStart:n.onTouchStart,onTouchMove:n.onTouchMove,onTouchEnd:n.onTouchEnd},j.createElement(yq,{otherAttributes:D,title:w,desc:C,ref:i},j.createElement(Cxe,null,p)))});function T2(){return T2=Object.assign?Object.assign.bind():function(n){for(var i=1;i<arguments.length;i++){var s=arguments[i];for(var c in s)({}).hasOwnProperty.call(s,c)&&(n[c]=s[c])}return n},T2.apply(null,arguments)}var aPe={top:5,right:5,bottom:5,left:5},sPe={accessibilityLayer:!0,layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:aPe,reverseStackOrder:!1,syncMethod:"index",responsive:!1},oPe=j.forwardRef(function(i,s){var c,f=$o(i.categoricalChartProps,sPe),{chartName:p,defaultTooltipEventType:v,validateTooltipEventTypes:b,tooltipPayloadSearcher:T,categoricalChartProps:w}=i,C={chartName:p,defaultTooltipEventType:v,validateTooltipEventTypes:b,tooltipPayloadSearcher:T,eventEmitter:void 0};return j.createElement(kDe,{preloadedState:{options:C},reduxStoreName:(c=w.id)!==null&&c!==void 0?c:p},j.createElement(gxe,{chartData:w.data}),j.createElement(LDe,{layout:f.layout,margin:f.margin}),j.createElement(MDe,{accessibilityLayer:f.accessibilityLayer,barCategoryGap:f.barCategoryGap,maxBarSize:f.maxBarSize,stackOffset:f.stackOffset,barGap:f.barGap,barSize:f.barSize,syncId:f.syncId,syncMethod:f.syncMethod,className:f.className}),j.createElement(iPe,T2({},f,{ref:s})))}),cPe=["axis"],lPe=j.forwardRef((n,i)=>j.createElement(oPe,{chartName:"LineChart",defaultTooltipEventType:"axis",validateTooltipEventTypes:cPe,tooltipPayloadSearcher:nIe,categoricalChartProps:n,ref:i}));function uPe({data:n}){return R.jsx(Rbe,{width:"100%",height:"100%",children:R.jsxs(lPe,{data:n,children:[R.jsx(ste,{dataKey:"name"}),R.jsx(ote,{domain:[6,9],tickCount:5}),R.jsx(CIe,{}),R.jsx(Zee,{strokeDasharray:"3 3",opacity:.2}),R.jsx(ate,{type:"monotone",dataKey:"mood",stroke:"#6366F1",strokeWidth:3,dot:{r:4},activeDot:{r:6},isAnimationActive:!0})]})})}const vte="mindecho_mood_entries_v1",Sq="mindecho_theme";function dPe(){try{const n=localStorage.getItem(vte);return n?JSON.parse(n):[]}catch{return[]}}function hPe(n){try{localStorage.setItem(vte,JSON.stringify(n))}catch{}}function fPe(){j.useEffect(()=>{const Z=localStorage.getItem(Sq);Z==="dark"?document.documentElement.classList.add("dark"):Z==="light"&&document.documentElement.classList.remove("dark"),Z||(document.documentElement.classList.add("dark"),localStorage.setItem(Sq,"dark"))},[]);const[n,i]=j.useState(()=>dPe()),[s,c]=j.useState(8),[f,p]=j.useState(""),[v,b]=j.useState(!1),[T,w]=j.useState(!1),C=j.useMemo(()=>{const Z=[];for(let ce=6;ce>=0;ce--){const se=new Date;se.setDate(se.getDate()-ce);const de=se.toLocaleDateString(void 0,{weekday:"short"});Z.push({name:de,mood:7,iso:se.toISOString().slice(0,10)})}return Z.forEach(ce=>{const se=n.find(de=>de.date===ce.iso);se&&(ce.mood=se.rating)}),Z},[n]);j.useEffect(()=>hPe(n),[n]);const I=Z=>{Z?.preventDefault(),b(!0);const ce=new Date().toISOString().slice(0,10),se={id:`m${Date.now()}`,date:ce,rating:Number(s),note:f.trim(),createdAt:new Date().toISOString()};i(de=>[se,...de.filter(oe=>oe.date!==ce)].slice(0,365)),p(""),setTimeout(()=>b(!1),350)},D=Z=>{window.confirm("Delete this mood entry?")&&i(ce=>ce.filter(se=>se.id!==Z))},L=j.useMemo(()=>{if(!n.length)return 7.8;const Z=n.slice(0,7),ce=Z.reduce((se,de)=>se+de.rating,0)/Z.length;return Math.round(ce*10)/10},[n]),F=`${Math.min(99,Math.round(L/10*95)+20)}%`,W=`${Math.max(4,Math.round(L/10*3+5))}h`,G=n.length?Math.min(30,n.length):0;n.filter(Z=>Z.date===new Date().toISOString().slice(0,10)).length;const $=Z=>Math.max(0,Math.min(10,Number(Z))),te=Z=>c(ce=>$(Number(ce)+Z));return R.jsxs("div",{className:"flex min-h-screen bg-gradient-to-b from-gray-900 via-gray-950 to-black text-gray-100",children:[R.jsx(Ql,{}),R.jsxs("main",{className:"flex-1 p-4 md:p-8",children:[R.jsx(eu,{}),R.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[R.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[R.jsxs("div",{children:[R.jsx("h2",{className:"text-2xl md:text-3xl font-extrabold",children:"Good morning  how are you feeling?"}),R.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Track mood, discover trends, and build consistency."})]}),R.jsxs("div",{className:"flex items-center gap-3",children:[R.jsxs("div",{className:"hidden sm:flex items-center gap-3 bg-white/5 px-3 py-2 rounded-2xl",children:[R.jsx(P2,{className:"w-4 h-4 text-indigo-300"}),R.jsx("div",{className:"text-xs text-gray-300",children:"Dark"})]}),R.jsx("button",{onClick:()=>w(Z=>!Z),className:"px-3 py-2 bg-white/5 rounded-lg text-sm hover:bg-white/10","aria-pressed":T,title:"Toggle compact view",children:T?"Expanded":"Compact"})]})]}),R.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[R.jsxs(Ht.section,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},transition:{duration:.36},className:"lg:col-span-2 bg-gradient-to-br from-purple-700 to-indigo-700 rounded-2xl p-5 shadow-2xl",children:[R.jsxs("div",{className:"flex items-center justify-between mb-4",children:[R.jsxs("div",{children:[R.jsx("h3",{className:"text-lg font-bold text-white",children:"Your Mood Wave"}),R.jsx("p",{className:"text-sm text-indigo-100/80",children:"This week at a glance"})]}),R.jsx("div",{className:"text-sm text-indigo-100/80",children:"Weekly"})]}),R.jsx("div",{className:"w-full rounded-xl overflow-hidden bg-white/5 p-3",style:{minHeight:220,minWidth:280},"aria-hidden":!1,children:R.jsx("div",{className:"h-44 md:h-56 lg:h-64",children:R.jsx(uPe,{data:C.map(Z=>({...Z,mood:Number(Z.mood)}))})})}),R.jsxs("div",{className:"mt-4 grid grid-cols-1 sm:grid-cols-3 gap-3",children:[R.jsxs("div",{className:"bg-white/6 rounded-lg p-3 text-white",children:[R.jsx("div",{className:"text-xs text-indigo-200",children:"Overall Mood"}),R.jsx("div",{className:"text-xl font-bold",children:L})]}),R.jsxs("div",{className:"bg-white/6 rounded-lg p-3 text-white",children:[R.jsx("div",{className:"text-xs text-indigo-200",children:"Energy"}),R.jsx("div",{className:"text-xl font-bold",children:F})]}),R.jsxs("div",{className:"bg-white/6 rounded-lg p-3 text-white",children:[R.jsx("div",{className:"text-xs text-indigo-200",children:"Sleep"}),R.jsx("div",{className:"text-xl font-bold",children:W})]})]})]}),R.jsxs(Ht.aside,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},transition:{duration:.36,delay:.04},className:"rounded-2xl p-4 bg-gradient-to-b from-gray-800 to-gray-900 border border-gray-800 shadow-lg",children:[R.jsxs("div",{className:"flex flex-col items-center text-center mb-4",children:[R.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-green-400 to-blue-500 flex items-center justify-center text-white mb-3 shadow-lg",children:R.jsx(kO,{className:"w-6 h-6"})}),R.jsx("h4",{className:"font-semibold text-white",children:"Quick Calm"}),R.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"3-minute breathing to center yourself"}),R.jsx("button",{onClick:()=>alert("3-minute session (demo)"),className:"mt-3 inline-flex items-center gap-2 bg-gradient-to-r from-green-400 to-blue-500 text-black px-3 py-2 rounded-full text-sm font-medium shadow",children:"Start 3-min"})]}),R.jsx("hr",{className:"border-gray-700 my-3"}),R.jsxs("div",{children:[R.jsxs("label",{htmlFor:"rating",className:"text-sm font-medium text-gray-200 block mb-2",children:["Today's Mood  ",R.jsx("span",{className:"text-xs text-gray-400",children:"0 (low)  10 (high)"})]}),R.jsxs("div",{className:"flex items-center gap-3",children:[R.jsxs("div",{className:"relative flex-shrink-0",children:[R.jsx("div",{className:"w-28 h-28 rounded-full bg-white/6 flex items-center justify-center",children:R.jsx("div",{className:"text-3xl font-bold",children:s})}),R.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:R.jsxs("svg",{width:"110",height:"110",viewBox:"0 0 36 36",className:"transform -rotate-90",children:[R.jsx("path",{d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831",stroke:"rgba(255,255,255,0.06)",strokeWidth:"2",fill:"none"}),R.jsx("path",{d:`M18 2.0845 a 15.9155 15.9155 0 0 1 ${Math.max(.01,s/10*31.831).toFixed(3)} 0`,stroke:"url(#g1)",strokeWidth:"2.4",strokeLinecap:"round",fill:"none"}),R.jsx("defs",{children:R.jsxs("linearGradient",{id:"g1",x1:"0",x2:"1",children:[R.jsx("stop",{offset:"0%",stopColor:"#34d399"}),R.jsx("stop",{offset:"100%",stopColor:"#60a5fa"})]})})]})})]}),R.jsxs("div",{className:"flex-1",children:[R.jsx("input",{id:"rating","aria-label":"Mood rating",type:"range",min:"0",max:"10",step:"1",value:s,onChange:Z=>c($(Number(Z.target.value))),className:"w-full accent-indigo-500"}),R.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[R.jsxs("div",{className:"flex gap-1",children:[R.jsx("button",{onClick:()=>te(-2),className:"px-2 py-1 rounded bg-white/6 text-sm",children:"-2"}),R.jsx("button",{onClick:()=>te(-1),className:"px-2 py-1 rounded bg-white/6 text-sm",children:"-1"}),R.jsx("button",{onClick:()=>te(1),className:"px-2 py-1 rounded bg-white/6 text-sm",children:"+1"}),R.jsx("button",{onClick:()=>te(2),className:"px-2 py-1 rounded bg-white/6 text-sm",children:"+2"})]}),R.jsxs("div",{className:"ml-auto text-xs text-gray-400",children:["Streak: ",R.jsx("strong",{className:"ml-1",children:G})]})]})]})]}),R.jsx("label",{htmlFor:"note",className:"text-sm font-medium text-gray-200 block mt-4 mb-2",children:"Note (optional)"}),R.jsx("textarea",{id:"note",rows:3,value:f,onChange:Z=>p(Z.target.value),placeholder:"What are you noticing? (thoughts, gratitude, sleep, triggers...)",className:"w-full rounded-lg bg-white/5 border border-gray-800 p-2 text-sm text-gray-100 placeholder:text-gray-500"}),R.jsxs("div",{className:"mt-3 flex gap-2",children:[R.jsx("button",{onClick:I,disabled:v,className:"inline-flex items-center gap-2 bg-gradient-to-r from-indigo-600 to-purple-600 px-4 py-2 rounded-lg text-white shadow hover:brightness-105 disabled:opacity-60",children:v?"Saving...":"Save entry"}),R.jsx("button",{onClick:()=>{p(""),c(8)},className:"px-3 py-2 rounded-lg bg-white/6 hover:bg-white/10 text-sm",children:"Clear"})]})]})]})]}),R.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[R.jsxs("div",{className:"lg:col-span-2 bg-white/5 rounded-2xl p-4 border border-gray-800",children:[R.jsxs("div",{className:"flex items-center justify-between mb-3",children:[R.jsx("h4",{className:"text-lg font-semibold",children:"Recent Entries"}),R.jsxs("div",{className:"text-sm text-gray-400",children:[n.length," total"]})]}),n.length===0?R.jsx("div",{className:"text-sm text-gray-400 p-6",children:"No entries yet  record your mood daily to unlock insights."}):R.jsx("div",{className:"space-y-3",children:n.map(Z=>R.jsxs(Ht.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},exit:{opacity:0,y:-6},className:"p-3 bg-white/6 rounded-lg border border-gray-800 flex justify-between items-start",children:[R.jsxs("div",{className:"min-w-0",children:[R.jsx("div",{className:"text-xs text-gray-400",children:new Date(Z.createdAt).toLocaleString()}),R.jsxs("div",{className:"mt-1 font-semibold text-white",children:[Z.rating," / 10"]}),Z.note&&R.jsx("div",{className:"text-sm text-gray-300 mt-1 break-words",children:Z.note})]}),R.jsx("div",{className:"flex flex-col items-end gap-2",children:R.jsx("button",{onClick:()=>D(Z.id),className:"text-sm text-red-400 hover:underline",children:"Delete"})})]},Z.id))})]}),R.jsxs("aside",{className:"rounded-2xl p-4 bg-white/6 border border-gray-800",children:[R.jsx("h4",{className:"text-lg font-semibold mb-3",children:"Wellness Tips"}),R.jsxs("ul",{className:"text-sm text-gray-300 space-y-2",children:[R.jsx("li",{children:"Hydrate earlier in the day  small wins stack."}),R.jsx("li",{children:"Short breathing sessions (23 min) reduce reactivity."}),R.jsx("li",{children:"Note one thing you're grateful for daily."})]}),R.jsx("div",{className:"mt-4",children:R.jsx("button",{onClick:()=>alert("Open tips (demo)"),className:"w-full px-3 py-2 rounded-lg bg-indigo-600 text-black font-medium",children:"Explore Guided Practices"})})]})]}),R.jsx(Yo,{children:R.jsx(Ht.div,{initial:{y:120,opacity:0},animate:{y:0,opacity:1},exit:{y:120,opacity:0},transition:{type:"spring",stiffness:160,damping:20},className:"fixed left-4 right-4 bottom-6 md:left-8 md:right-8 z-50 pointer-events-auto"})})]})]})]})}const yte="mindecho_journal_v1",Ete="mindecho_journal_draft_v1";function pPe(){try{const n=localStorage.getItem(yte);return n?JSON.parse(n):[]}catch{return[]}}function bq(n){try{localStorage.setItem(yte,JSON.stringify(n))}catch{}}function Tq(){try{const n=localStorage.getItem(Ete);return n?JSON.parse(n):{title:"",body:""}}catch{return{title:"",body:""}}}function cM(n){try{localStorage.setItem(Ete,JSON.stringify(n))}catch{}}function mPe(){const{user:n}=ao(),[i,s]=j.useState(()=>pPe()),[c,f]=j.useState(()=>Tq()),[p,v]=j.useState(!1),[b,T]=j.useState(""),[w,C]=j.useState(null),[I,D]=j.useState(!1),[L,F]=j.useState(!0),W=j.useRef(!1);if(j.useEffect(()=>{if(!W.current){W.current=!0;return}bq(i)},[i]),j.useEffect(()=>{cM(c)},[c]),!n)return R.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-900 text-gray-100",children:R.jsx(wb,{})});const G=se=>{if(se?.preventDefault?.(),!c.body?.trim()&&!c.title?.trim())return;v(!0);const de={id:`j${Date.now()}`,userId:n.id,title:c.title?.trim()||new Date().toLocaleString(),body:c.body,createdAt:new Date().toISOString()};s(oe=>[de,...oe].slice(0,2e3)),f({title:"",body:""}),D(!1),v(!1)},$=(se,de)=>{f(oe=>({...oe,[se]:de}))},te=se=>{window.confirm("Delete this entry?")&&(s(de=>de.filter(oe=>oe.id!==se)),w?.id===se&&C(null))},Z=()=>{const se=new Blob([JSON.stringify(i,null,2)],{type:"application/json"}),de=URL.createObjectURL(se),oe=document.createElement("a");oe.href=de,oe.download=`mindecho_journal_${new Date().toISOString().slice(0,10)}.json`,oe.click(),URL.revokeObjectURL(de)},ce=j.useMemo(()=>{const se=b.trim().toLowerCase();let de=i.filter(oe=>se?(oe.title||"").toLowerCase().includes(se)||(oe.body||"").toLowerCase().includes(se):!0);return de=de.sort((oe,ge)=>L?new Date(ge.createdAt)-new Date(oe.createdAt):new Date(oe.createdAt)-new Date(ge.createdAt)),de},[i,b,L]);return R.jsxs("div",{className:"flex min-h-screen bg-gray-900 text-gray-100",children:[R.jsx(Ql,{}),R.jsxs("main",{className:"flex-1 p-4 md:p-8",children:[R.jsx(eu,{}),R.jsxs("div",{className:"max-w-6xl mx-auto",children:[R.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4 mb-6",children:[R.jsxs("div",{children:[R.jsx("h2",{className:"text-2xl font-extrabold",children:"Journal"}),R.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Capture thoughts, gratitude, and reflections. Private to your browser."})]}),R.jsxs("div",{className:"flex items-center gap-3 w-full md:w-auto",children:[R.jsxs("div",{className:"flex items-center bg-gray-800 border border-gray-700 rounded-full px-3 py-2 w-full md:w-auto",children:[R.jsx(RI,{className:"w-4 h-4 text-gray-400 mr-2"}),R.jsx("input",{value:b,onChange:se=>T(se.target.value),placeholder:"Search entries...",className:"bg-transparent outline-none placeholder:text-gray-500 flex-1 text-sm text-gray-200"}),b&&R.jsx("button",{className:"ml-2 p-1 rounded hover:bg-gray-700",onClick:()=>T(""),"aria-label":"Clear search",children:R.jsx(rb,{className:"w-4 h-4 text-gray-400"})})]}),R.jsxs("button",{onClick:()=>{D(se=>!se),C(null)},className:"flex items-center gap-2 bg-gradient-to-r from-purple-600 to-indigo-600 text-white px-4 py-2 rounded-xl shadow-md hover:brightness-105",title:"New entry",children:[R.jsx(gz,{className:"w-4 h-4"}),"New"]}),R.jsxs("div",{className:"hidden sm:flex items-center gap-2 ml-2",children:[R.jsx("button",{onClick:()=>F(se=>!se),className:"px-3 py-2 rounded-lg bg-gray-800 border border-gray-700 text-sm hover:bg-gray-800/90",title:"Toggle sort",children:L?"Newest":"Oldest"}),R.jsxs("button",{onClick:Z,className:"px-3 py-2 rounded-lg bg-gray-800 border border-gray-700 text-sm hover:bg-gray-800/90 flex items-center gap-2",title:"Export entries",children:[R.jsx(_k,{className:"w-4 h-4"})," Export"]})]})]})]}),R.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[R.jsx(Ht.section,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.3},className:`lg:col-span-2 ${I?"":"hidden lg:block"}`,children:R.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-2xl p-6 shadow-md",children:[R.jsxs("div",{className:"flex items-start justify-between gap-4",children:[R.jsxs("div",{children:[R.jsx("h3",{className:"text-lg font-semibold",children:"Write an entry"}),R.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Daily reflections help you notice patterns over time."})]}),R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsx("button",{onClick:()=>{f({title:"",body:""}),cM({title:"",body:""})},className:"px-3 py-2 rounded-lg bg-gray-800 border border-gray-700 text-sm hover:bg-gray-700",children:"Clear"}),R.jsxs("button",{onClick:()=>{bq(i),cM(c)},className:"px-3 py-2 rounded-lg bg-gray-800 border border-gray-700 text-sm hover:bg-gray-700 flex items-center gap-2",title:"Save draft",children:[R.jsx(npe,{className:"w-4 h-4"})," Draft"]})]})]}),R.jsxs("form",{onSubmit:G,className:"mt-4",children:[R.jsx("input",{value:c.title,onChange:se=>$("title",se.target.value),placeholder:"Title (optional)",className:"w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-2 text-gray-100 placeholder:text-gray-500"}),R.jsx("textarea",{value:c.body,onChange:se=>$("body",se.target.value),placeholder:"Write your thoughts, gratitude, or observations...",rows:8,className:"w-full mt-3 bg-gray-900 border border-gray-700 rounded-lg px-4 py-3 text-gray-100 placeholder:text-gray-500 resize-none"}),R.jsxs("div",{className:"flex items-center gap-3 mt-3",children:[R.jsxs("button",{type:"submit",disabled:p,className:"inline-flex items-center gap-2 bg-gradient-to-r from-purple-600 to-indigo-600 text-white px-4 py-2 rounded-xl shadow-md hover:brightness-105",children:[R.jsx($q,{className:"w-4 h-4"}),p?"Saving...":"Add Entry"]}),R.jsx("button",{type:"button",onClick:()=>{D(!1),f(Tq())},className:"px-3 py-2 rounded-lg bg-gray-800 border border-gray-700 text-sm hover:bg-gray-700",children:"Close"}),R.jsx("div",{className:"ml-auto text-sm text-gray-400",children:"Autosaves locally"})]})]})]})}),R.jsxs("aside",{className:"bg-gray-800 border border-gray-700 rounded-2xl p-4 shadow-md",children:[R.jsxs("div",{className:"flex items-center justify-between mb-3",children:[R.jsx("h4",{className:"text-sm font-semibold",children:"Recent Entries"}),R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsx("button",{onClick:()=>{D(!0),C(null)},className:"p-2 rounded-md bg-gradient-to-r from-purple-600 to-indigo-600 text-white",title:"New entry",children:R.jsx(gz,{className:"w-4 h-4"})}),R.jsx("button",{onClick:Z,className:"p-2 rounded-md bg-gray-900 border border-gray-700 text-gray-200",title:"Export JSON",children:R.jsx(_k,{className:"w-4 h-4"})})]})]}),R.jsxs("div",{className:"space-y-2 max-h-[70vh] overflow-auto pr-1",children:[ce.length===0&&R.jsx("div",{className:"text-xs text-gray-400",children:"No entries match your search."}),ce.map(se=>R.jsx(Ht.div,{layout:!0,whileHover:{scale:1.01},className:"bg-gray-900 border border-gray-700 rounded-lg p-3",children:R.jsxs("div",{className:"flex items-start justify-between gap-3",children:[R.jsx("div",{className:"min-w-0",children:R.jsxs("button",{onClick:()=>C(se),className:"text-left w-full",title:"Open entry",children:[R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsx("div",{className:"text-sm font-medium text-gray-100 truncate",children:se.title}),R.jsx("div",{className:"text-xs text-gray-500",children:new Date(se.createdAt).toLocaleString()})]}),R.jsx("div",{className:"mt-2 text-xs text-gray-300 line-clamp-3 whitespace-pre-wrap",children:se.body})]})}),R.jsxs("div",{className:"flex flex-col items-end gap-2",children:[R.jsx("button",{onClick:()=>{f({title:se.title,body:se.body}),D(!0),s(de=>de.filter(oe=>oe.id!==se.id))},className:"p-1 rounded hover:bg-gray-800",title:"Edit",children:R.jsx(_z,{className:"w-4 h-4 text-gray-300"})}),R.jsx("button",{onClick:()=>te(se.id),className:"p-1 rounded hover:bg-gray-800",title:"Delete",children:R.jsx(hM,{className:"w-4 h-4 text-red-400"})})]})]})},se.id))]})]})]})]}),R.jsx(Yo,{children:w&&R.jsxs(Ht.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[R.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:()=>C(null)}),R.jsxs(Ht.div,{initial:{y:12,scale:.98},animate:{y:0,scale:1},exit:{y:12,scale:.98},transition:{duration:.18},className:"relative z-10 max-w-3xl w-full bg-gray-900 border border-gray-700 rounded-2xl p-6 shadow-2xl text-gray-100",children:[R.jsxs("div",{className:"flex items-start justify-between gap-3",children:[R.jsxs("div",{children:[R.jsx("h3",{className:"text-xl font-semibold",children:w.title}),R.jsx("div",{className:"text-xs text-gray-400 mt-1",children:new Date(w.createdAt).toLocaleString()})]}),R.jsx("div",{className:"flex items-center gap-2",children:R.jsx("button",{onClick:()=>C(null),className:"p-2 rounded hover:bg-gray-800",children:R.jsx(rb,{className:"w-4 h-4 text-gray-300"})})})]}),R.jsx("div",{className:"mt-4 text-sm text-gray-200 whitespace-pre-wrap",children:w.body}),R.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[R.jsx("div",{className:"text-xs text-gray-400",children:"Private  saved only in this browser"}),R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsxs("button",{onClick:()=>{const se=new Blob([JSON.stringify(w,null,2)],{type:"application/json"}),de=URL.createObjectURL(se),oe=document.createElement("a");oe.href=de,oe.download=`journal_entry_${w.id}.json`,oe.click(),URL.revokeObjectURL(de)},className:"px-3 py-2 bg-gray-800 border border-gray-700 rounded-md text-sm hover:bg-gray-700 flex items-center gap-2",children:[R.jsx(_k,{className:"w-4 h-4"})," Export"]}),R.jsxs("button",{onClick:()=>{f({title:w.title,body:w.body}),C(null),D(!0),s(se=>se.filter(de=>de.id!==w.id))},className:"px-3 py-2 bg-gradient-to-r from-purple-600 to-indigo-600 rounded-md text-sm text-white flex items-center gap-2",children:[R.jsx(_z,{className:"w-4 h-4"})," Edit"]})]})]})]})]})})]})]})}const Ste="mindecho_following_v1";function gPe(){try{const n=localStorage.getItem(Ste);return n?new Set(JSON.parse(n)):new Set}catch{return new Set}}function wq(n){try{localStorage.setItem(Ste,JSON.stringify([...n]))}catch{}}function _Pe(n){if(!n||typeof n!="object"||!n.id||typeof n.id!="string"||!n.displayName||typeof n.displayName!="string"||n.displayName.trim().length<2)return!1;if(n.verified===!0||n.source&&(n.source==="db"||n.source==="users"||n.source==="original"))return!0;if(!n.joinedAt)return!1;const i=new Date(n.joinedAt);if(Number.isNaN(i.getTime()))return!1;Date.now()-i.getTime();const s=n.avatarUrl||"",f=["placehold.co","placehold.it","gravatar.com/avatar/","placeholder","data:image/"].some(b=>s.includes(b));return!(!s||f||!(n.bio&&n.bio.trim().length>10||Array.isArray(n.tags)&&n.tags.length>0)||["tmp","test","fake","mock","anon"].some(b=>n.id.toLowerCase().startsWith(b)))}function vPe(){const{user:n}=ao(),i=lf(),[s,c]=j.useState([]),[f,p]=j.useState(!0),[v,b]=j.useState(""),[T,w]=j.useState(""),[C,I]=j.useState("relevance"),[D,L]=j.useState(null),[F,W]=j.useState(()=>gPe()),[G,$]=j.useState(1),te=12;j.useEffect(()=>{let ge=!0;return p(!0),b(""),Ov.getProfiles().then(Ae=>{if(!ge)return;const ke=Array.isArray(Ae)?Ae:[],Ee=ke.filter(be=>{const Le=_Pe(be);return Le||console.debug("[Community] filtered fake/stub profile:",be?.id,be?.displayName),Le});Ee.length===0&&ke.length>0&&b("No valid community profiles found. If you expect profiles, enable 'verified' on real accounts or ensure server returns original profiles."),c(Ee)}).catch(Ae=>{console.error("Community load error:",Ae),b("Failed to load community profiles. Try again later."),c([])}).finally(()=>{ge&&p(!1)}),()=>{ge=!1}},[]),j.useEffect(()=>{wq(F)},[F]);const Z=j.useMemo(()=>{const ge=T.trim().toLowerCase();let Ae=s.filter(ke=>ge?ke.displayName.toLowerCase().includes(ge)||(ke.bio||"").toLowerCase().includes(ge)||(ke.tags||[]).some(Ee=>Ee.toLowerCase().includes(ge)):!0);return C==="calm"?Ae=Ae.sort((ke,Ee)=>(Ee.baselineMetrics?.calm||0)-(ke.baselineMetrics?.calm||0)):C==="recent"&&(Ae=Ae.sort((ke,Ee)=>new Date(Ee.joinedAt||0)-new Date(ke.joinedAt||0))),Ae},[s,T,C]),ce=j.useMemo(()=>Z.slice(0,G*te),[Z,G]),se=ge=>{W(Ae=>{const ke=new Set(Ae);return ke.has(ge)?ke.delete(ge):ke.add(ge),wq(ke),ke})},de=ge=>{L(ge)},oe=()=>{w(""),I("relevance"),$(1),b("")};return R.jsxs("div",{className:"flex min-h-screen bg-gradient-to-b from-gray-900 via-gray-800 to-black text-gray-100",children:[R.jsx(Ql,{}),R.jsxs("main",{className:"flex-1 p-4 md:p-8",children:[R.jsx(eu,{}),R.jsxs("div",{className:"max-w-7xl mx-auto",children:[R.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6",children:[R.jsxs("div",{children:[R.jsx("h2",{className:"text-2xl font-extrabold",children:"Community"}),R.jsx("p",{className:"text-sm text-gray-400",children:"Browse public profiles  only verified/original profiles are shown."})]}),R.jsxs("div",{className:"flex items-center gap-3 w-full md:w-auto",children:[R.jsxs("div",{className:"flex items-center bg-gray-800 border border-gray-700 rounded-full px-3 py-2 w-full md:w-96",children:[R.jsx(RI,{className:"w-4 h-4 text-gray-400 mr-2"}),R.jsx("input",{value:T,onChange:ge=>{w(ge.target.value),$(1)},placeholder:"Search names, bio, tags...",className:"bg-transparent outline-none placeholder:text-gray-500 text-sm flex-1","aria-label":"Search community"}),T&&R.jsx("button",{onClick:()=>{w(""),$(1)},className:"p-1 rounded hover:bg-gray-700","aria-label":"Clear search",children:""})]}),R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsx("div",{className:"relative",children:R.jsxs("select",{value:C,onChange:ge=>{I(ge.target.value),$(1)},className:"bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-sm","aria-label":"Sort profiles",children:[R.jsx("option",{value:"relevance",children:"Relevance"}),R.jsx("option",{value:"calm",children:"Calm score"}),R.jsx("option",{value:"recent",children:"Newest"})]})}),R.jsxs("button",{onClick:oe,className:"hidden sm:inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-gray-800 border border-gray-700 text-sm hover:bg-gray-700",children:[R.jsx(eX,{className:"w-4 h-4"})," Clear"]})]})]})]}),f?R.jsx("div",{className:"py-12 flex justify-center",children:R.jsx(wb,{})}):v?R.jsx("div",{className:"bg-red-900/40 p-4 rounded-lg text-sm text-red-200",children:v}):R.jsxs(R.Fragment,{children:[R.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:[ce.map(ge=>R.jsxs(Ht.article,{layout:!0,initial:{opacity:0,y:6},animate:{opacity:1,y:0},exit:{opacity:0,y:6},whileHover:{y:-4,boxShadow:"0 8px 30px rgba(0,0,0,0.6)"},className:"bg-gradient-to-br from-gray-850 to-gray-900 border border-gray-800 rounded-2xl p-4","aria-labelledby":`profile-${ge.id}`,children:[R.jsxs("div",{className:"flex items-start gap-4",children:[R.jsx("img",{src:ge.avatarUrl,alt:ge.displayName,className:"w-14 h-14 rounded-full object-cover ring-1 ring-gray-700"}),R.jsxs("div",{className:"flex-1 min-w-0",children:[R.jsxs("div",{className:"flex items-center justify-between gap-3",children:[R.jsxs("div",{children:[R.jsx("div",{id:`profile-${ge.id}`,className:"font-semibold text-white truncate",children:ge.displayName}),R.jsx("div",{className:"text-xs text-gray-400 mt-0.5 truncate",children:ge.bio})]}),R.jsxs("div",{className:"flex flex-col items-end",children:[R.jsx("div",{className:"text-xs text-gray-400",children:"Calm"}),R.jsx("div",{className:"font-medium text-green-300",children:ge.baselineMetrics?.calm??""})]})]}),R.jsx("div",{className:"mt-3 flex items-center gap-2 flex-wrap",children:(ge.tags||[]).slice(0,4).map(Ae=>R.jsx("span",{className:"text-xs bg-gray-800 px-2 py-1 rounded-full text-gray-300",children:Ae},Ae))})]})]}),R.jsxs("div",{className:"mt-4 flex items-center justify-between gap-3",children:[R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsxs("button",{onClick:()=>de(ge),className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-gray-800 border border-gray-700 text-sm hover:bg-gray-700","aria-label":`View ${ge.displayName}`,children:[R.jsx(Qq,{className:"w-4 h-4"})," View"]}),R.jsxs("button",{onClick:()=>i(`/profile/${ge.id}`),className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-gray-800 border border-gray-700 text-sm hover:bg-gray-700",children:[R.jsx(rX,{className:"w-4 h-4"})," Profile"]})]}),R.jsx("div",{children:R.jsxs("button",{onClick:()=>se(ge.id),className:`inline-flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium ${F.has(ge.id)?"bg-gradient-to-r from-green-500 to-emerald-500 text-black":"bg-purple-600 text-white"}`,"aria-pressed":F.has(ge.id),children:[F.has(ge.id)?R.jsx(wpe,{className:"w-4 h-4"}):R.jsx(Cpe,{className:"w-4 h-4"}),F.has(ge.id)?"Following":"Follow"]})})]})]},ge.id)),ce.length===0&&R.jsx("div",{className:"col-span-full text-center text-gray-400 py-12",children:"No community profiles available. If you believe this is wrong, ensure the backend returns verified/original profiles."})]}),Z.length>ce.length&&R.jsx("div",{className:"mt-8 flex justify-center",children:R.jsx("button",{onClick:()=>$(ge=>ge+1),className:"px-4 py-2 rounded-lg bg-gradient-to-r from-purple-600 to-indigo-600 text-white",children:"Load more"})})]})]}),R.jsx(Yo,{children:D&&R.jsxs(Ht.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[R.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>L(null)}),R.jsxs(Ht.div,{initial:{y:12},animate:{y:0},exit:{y:12},transition:{duration:.18},className:"relative z-10 max-w-2xl w-full bg-gray-900 border border-gray-800 rounded-2xl p-6 shadow-2xl",children:[R.jsxs("div",{className:"flex items-start gap-4",children:[R.jsx("img",{src:D.avatarUrl,alt:D.displayName,className:"w-20 h-20 rounded-full object-cover ring-1 ring-gray-700"}),R.jsxs("div",{className:"flex-1",children:[R.jsxs("div",{className:"flex items-center justify-between gap-4",children:[R.jsxs("div",{children:[R.jsx("h3",{className:"text-xl font-semibold text-white",children:D.displayName}),R.jsx("div",{className:"text-sm text-gray-400",children:D.bio}),R.jsxs("div",{className:"mt-2 text-xs text-gray-400",children:["Joined: ",new Date(D.joinedAt||Date.now()).toLocaleDateString()]})]}),R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsx("button",{onClick:()=>se(D.id),className:`px-3 py-2 rounded-lg text-sm ${F.has(D.id)?"bg-green-400 text-black":"bg-purple-600 text-white"}`,children:F.has(D.id)?"Following":"Follow"}),R.jsx("button",{onClick:()=>i(`/profile/${D.id}`),className:"px-3 py-2 rounded-lg bg-gray-800 border border-gray-700 text-sm",children:"Open Profile"})]})]}),R.jsxs("div",{className:"mt-4",children:[R.jsx("h4",{className:"text-sm text-gray-300 mb-1",children:"About"}),R.jsx("p",{className:"text-sm text-gray-200 whitespace-pre-wrap",children:D.longBio||D.bio}),R.jsx("div",{className:"mt-4 flex flex-wrap gap-2",children:(D.tags||[]).map(ge=>R.jsx("span",{className:"text-xs bg-gray-800 px-2 py-1 rounded-full text-gray-300",children:ge},ge))})]}),R.jsxs("div",{className:"mt-4 text-xs text-gray-400",children:["Baseline metrics: Calm ",D.baselineMetrics?.calm??"","  Anxiety ",D.baselineMetrics?.anxiety??""]})]})]}),R.jsx("div",{className:"mt-6 flex justify-end gap-2",children:R.jsx("button",{onClick:()=>L(null),className:"px-3 py-2 rounded-lg bg-gray-800 border border-gray-700 text-sm",children:"Close"})})]})]})})]})]})}const bte="mindecho_meditation_sessions_v1",Vo={slow:{duration:8,label:"Slow",inSec:4,holdSec:4,outSec:4},normal:{duration:6,label:"Normal",inSec:3,holdSec:3,outSec:3},fast:{duration:4,label:"Fast",inSec:2,holdSec:2,outSec:2}};function yPe(){try{const n=localStorage.getItem(bte);return n?JSON.parse(n):[]}catch{return[]}}function Rq(n){try{localStorage.setItem(bte,JSON.stringify(n))}catch{}}function EPe(){const[n,i]=j.useState("normal"),[s,c]=j.useState(!1),[f,p]=j.useState("Ready"),[v,b]=j.useState(0),[T,w]=j.useState(!1),[C,I]=j.useState(0),D=j.useRef(null),L=j.useRef(null),[F,W]=j.useState(!1),G=j.useRef(null),$="",[te,Z]=j.useState(()=>yPe()),ce=64,se=2*Math.PI*ce;j.useEffect(()=>{let rt=null,he=[];if(s){const ze=Vo[n].duration*1e3/3,tt=()=>{p(`Breathe In (${Vo[n].inSec}s)`);const ut=setTimeout(()=>{p(`Hold (${Vo[n].holdSec}s)`);const me=setTimeout(()=>{p(`Breathe Out (${Vo[n].outSec}s)`),b(Ve=>Ve+1)},ze);he.push(me)},ze);he.push(ut)};tt(),rt=setInterval(tt,Vo[n].duration*1e3)}return()=>{rt&&clearInterval(rt),he.forEach(_e=>clearTimeout(_e))}},[s,n]),j.useEffect(()=>(T?(L.current||(L.current=Date.now()),D.current=setInterval(()=>{const rt=Math.floor((Date.now()-L.current)/1e3);I(rt)},250)):(clearInterval(D.current),D.current=null),()=>clearInterval(D.current)),[T]),j.useEffect(()=>{if(G.current)try{F&&$||(G.current.pause(),G.current.currentTime=0)}catch{}},[F,$]),j.useEffect(()=>{const rt=he=>{he.code==="Space"?(he.preventDefault(),c(_e=>!_e)):he.key&&he.key.toLowerCase()==="s"?(he.preventDefault(),w(_e=>{const ze=!_e;return ze?(L.current=Date.now(),I(0),b(0),c(!0)):c(!1),ze})):he.key&&he.key.toLowerCase()==="r"&&(he.preventDefault(),w(!1),I(0),L.current=null,b(0),c(!1))};return window.addEventListener("keydown",rt),()=>window.removeEventListener("keydown",rt)},[]);const de=j.useCallback(()=>{c(rt=>!rt)},[]);j.useCallback(()=>{w(rt=>{const he=!rt;return he?(L.current=Date.now(),I(0),b(0),c(!0)):c(!1),he})},[]);const oe=j.useCallback(()=>{w(!1),I(0),L.current=null,b(0),c(!1)},[]),ge=j.useCallback(()=>{const rt=C,he=v,_e=rt>0?Math.round(he/rt*60):0,tt=[{id:`s${Date.now()}`,timestamp:new Date().toISOString(),duration:rt,breaths:he,speed:n,breathsPerMin:_e},...te].slice(0,50);Z(tt),Rq(tt),setTimeout(()=>{c(!1)},120),oe()},[C,v,n,te,oe]),Ae=rt=>{const he=te.filter(_e=>_e.id!==rt);Z(he),Rq(he)},ke=rt=>{const he=Math.floor(rt/60).toString().padStart(2,"0"),_e=Math.floor(rt%60).toString().padStart(2,"0");return`${he}:${_e}`},Ee=j.useMemo(()=>{if(!te||te.length===0)return{avgDur:0,avgBPM:0,totalSessions:0,last7:[]};const rt=te.reduce((tt,ut)=>(tt.duration+=ut.duration||0,tt.bpm+=ut.breathsPerMin||0,tt),{duration:0,bpm:0}),he=Math.round(rt.duration/te.length||0),_e=Math.round(rt.bpm/te.length||0),ze=te.slice(0,10).map(tt=>({t:tt.timestamp,duration:tt.duration||0,bpm:tt.breathsPerMin||0}));return{avgDur:he,avgBPM:_e,totalSessions:te.length,last:ze}},[te]),be=j.useMemo(()=>({animate:{strokeDashoffset:["0",-se*.36,"0"],strokeOpacity:[1,.7,1],transform:["rotate(-90deg) scale(1)","rotate(-90deg) scale(1.03)","rotate(-90deg) scale(1)"]},transition:{duration:Vo[n].duration,repeat:1/0,ease:"easeInOut"}}),[n,se]),Le=Ee.last,et=Le.length?Math.max(...Le.map(rt=>rt.duration)):1;return R.jsxs("div",{className:"flex min-h-screen bg-gradient-to-b from-gray-900 via-black to-gray-900 text-gray-100",children:[R.jsx(Ql,{}),R.jsxs("main",{className:"flex-1 p-6 md:p-10",children:[R.jsx(eu,{}),R.jsxs("div",{className:"max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-6",children:[R.jsxs(Ht.section,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.45},className:"lg:col-span-2 relative bg-gradient-to-b from-gray-800/70 to-gray-900/60 backdrop-blur-sm border border-gray-700 rounded-3xl shadow-2xl p-6 overflow-hidden",children:[R.jsxs("div",{"aria-hidden":!0,className:"pointer-events-none absolute inset-0",children:[R.jsx("div",{className:"absolute left-6 top-6 w-40 h-40 rounded-full bg-purple-600/6 blur-3xl"}),R.jsx("div",{className:"absolute right-6 bottom-10 w-56 h-56 rounded-full bg-indigo-600/6 blur-3xl"})]}),R.jsxs("header",{className:"flex items-start justify-between mb-4 gap-4 relative z-10",children:[R.jsxs("div",{children:[R.jsx("h2",{className:"text-2xl md:text-3xl font-extrabold leading-tight text-white",children:"Guided Breathing"}),R.jsxs("p",{className:"text-sm text-gray-300 mt-1",children:["A focused, distraction-free breathing exercise. Tip: press ",R.jsx("span",{className:"font-medium",children:"Space"})," to toggle the breath visual."]})]}),R.jsxs("div",{className:"flex items-center gap-3",children:[R.jsxs("div",{className:"inline-flex items-center gap-2 bg-gray-800/60 px-3 py-2 rounded-xl border border-gray-700",children:[R.jsx(yfe,{className:"w-4 h-4 text-gray-300"}),R.jsx("div",{className:"text-sm font-medium text-white",children:ke(C)})]}),R.jsxs("div",{className:"inline-flex items-center gap-2 bg-gray-800/60 px-3 py-2 rounded-xl border border-gray-700",children:[R.jsx("div",{className:"text-sm text-gray-300",children:"Speed"}),R.jsx("div",{className:"text-sm font-medium text-white",children:Vo[n].label})]})]})]}),R.jsxs("div",{className:"relative z-10 flex flex-col md:flex-row items-center gap-8",children:[R.jsx("div",{className:"flex-1 flex items-center justify-center py-6",children:R.jsxs("div",{className:"relative flex items-center justify-center",children:[R.jsx(Ht.div,{animate:s?{scale:[1,1.35,1],opacity:[.95,.6,.95],filter:["blur(28px)","blur(18px)","blur(28px)"]}:{scale:1,opacity:.85,filter:"blur(28px)"},transition:{duration:Math.max(1.8,Vo[n].duration/1.2),repeat:1/0,ease:"easeInOut"},className:"absolute rounded-full",style:{width:520,height:520,background:"radial-gradient(circle at 30% 30%, rgba(139,92,246,0.18), rgba(99,102,241,0.08) 35%, rgba(79,70,229,0.02) 60%, transparent 70%)",pointerEvents:"none"}}),R.jsxs("svg",{width:"260",height:"260",viewBox:"0 0 220 220",className:"relative",children:[R.jsxs("defs",{children:[R.jsxs("linearGradient",{id:"gB",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[R.jsx("stop",{offset:"0%",stopColor:"#a78bfa",stopOpacity:"1"}),R.jsx("stop",{offset:"50%",stopColor:"#7c3aed",stopOpacity:"1"}),R.jsx("stop",{offset:"100%",stopColor:"#4f46e5",stopOpacity:"1"})]}),R.jsxs("linearGradient",{id:"gGlow",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[R.jsx("stop",{offset:"0%",stopColor:"#a78bfa",stopOpacity:"0.55"}),R.jsx("stop",{offset:"50%",stopColor:"#7c3aed",stopOpacity:"0.45"}),R.jsx("stop",{offset:"100%",stopColor:"#4f46e5",stopOpacity:"0.35"})]})]}),R.jsxs("g",{transform:"translate(110,110)",children:[R.jsx("circle",{cx:"0",cy:"0",r:ce,stroke:"#0b1220",strokeWidth:"12",fill:"none"}),R.jsx(Ht.circle,{r:ce,stroke:"url(#gGlow)",strokeWidth:"16",strokeLinecap:"round",fill:"none",strokeDasharray:se,style:{filter:"blur(6px)",opacity:.95},animate:{strokeDashoffset:[0,-se*.28,0],opacity:s?[.9,.6,.9]:[.85,.85,.85],transform:["rotate(-90deg) scale(1)","rotate(-90deg) scale(1.02)","rotate(-90deg) scale(1)"]},transition:{duration:Vo[n].duration,repeat:1/0,ease:"easeInOut"}}),R.jsx(Ht.circle,{r:ce,stroke:"url(#gB)",strokeWidth:"10",strokeLinecap:"round",fill:"none",strokeDasharray:se,...be,style:{mixBlendMode:"screen"}}),R.jsx("circle",{cx:"0",cy:"0",r:ce-10,stroke:"rgba(255,255,255,0.03)",strokeWidth:"2",fill:"none"})]})]}),R.jsxs(Ht.button,{onClick:()=>{de()},whileTap:{scale:.98},animate:s?{scale:[1,1.04,1],boxShadow:["0 12px 40px rgba(99,102,241,0.18)","0 18px 60px rgba(99,102,241,0.26)","0 12px 40px rgba(99,102,241,0.18)"]}:{scale:1},transition:{duration:1.1,repeat:1/0,ease:"easeInOut"},"aria-pressed":s,"aria-label":s?"Pause breathing":"Start breathing",className:"absolute w-44 h-44 rounded-full bg-gradient-to-br from-purple-500 to-indigo-600 shadow-2xl flex flex-col items-center justify-center text-white border-2 border-white/10",style:{cursor:"pointer"},children:[R.jsx("div",{className:"text-sm opacity-95 mb-1",children:f}),R.jsxs("div",{className:"text-2xl font-semibold",children:[v," breaths"]}),R.jsx("div",{className:"mt-2 text-xs text-white/90",children:"Tap or press space"})]})]})}),R.jsxs("div",{className:"w-full md:w-96",children:[R.jsxs("div",{className:"bg-gray-900/60 border border-gray-700 rounded-2xl p-4 shadow-sm",children:[R.jsxs("div",{className:"flex items-center justify-between mb-3",children:[R.jsxs("div",{children:[R.jsx("h4",{className:"text-lg font-semibold text-white",children:"Controls"}),R.jsx("p",{className:"text-xs text-gray-400",children:"Choose a rhythm and use the session controls below."})]}),R.jsxs("div",{className:"flex items-center gap-2",children:[R.jsx("button",{onClick:()=>W(rt=>!rt),title:F?"Mute ambient sound":"Enable ambient sound",className:"p-2 rounded-md hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-purple-300","aria-pressed":F,children:F?R.jsx(kpe,{className:"w-5 h-5 text-white"}):R.jsx(Mpe,{className:"w-5 h-5 text-gray-400"})}),R.jsx("button",{onClick:()=>{i("normal"),c(!0)},title:"Reset to normal",className:"p-2 rounded-md hover:bg-gray-800",children:R.jsx(Zfe,{className:"w-5 h-5 text-gray-400"})})]})]}),R.jsx("div",{className:"flex gap-2 mb-4",role:"tablist","aria-label":"Select breathing speed",children:Object.keys(Vo).map(rt=>{const he=Vo[rt],_e=rt===n;return R.jsxs("button",{role:"tab","aria-selected":_e,onClick:()=>i(rt),className:`flex-1 px-3 py-2 rounded-lg text-sm font-medium focus:outline-none ${_e?"bg-gradient-to-r from-purple-600 to-indigo-600 text-white shadow-md":"bg-gray-800/40 text-gray-200 hover:bg-gray-800"}`,children:[R.jsx("div",{className:"uppercase text-xs opacity-80",children:he.label}),R.jsxs("div",{className:"mt-1 text-xs text-gray-300",children:[he.inSec,"/",he.holdSec,"/",he.outSec,"s"]})]},rt)})}),R.jsxs("div",{className:"flex items-center gap-3",children:[R.jsxs("button",{onClick:()=>{T?(w(!1),c(!1)):(L.current=Date.now(),I(0),b(0),w(!0),c(!0))},className:"flex-1 inline-flex items-center justify-center gap-2 px-4 py-3 rounded-lg bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-semibold shadow-md hover:brightness-105 focus:outline-none focus:ring-2 focus:ring-purple-300",children:[R.jsx(kO,{className:"w-4 h-4"}),T?"Pause Session":"Start Session"]}),R.jsx("button",{onClick:()=>{de()},title:"Pause/Resume breathing visual",className:"px-3 py-3 rounded-lg bg-gray-800/50 border border-gray-700 text-white hover:bg-gray-800 focus:outline-none",children:s?R.jsx(qfe,{className:"w-5 h-5"}):R.jsx(kO,{className:"w-5 h-5"})})]}),R.jsxs("div",{className:"mt-3 flex items-center justify-between text-xs text-gray-400",children:[R.jsxs("div",{children:["Elapsed: ",R.jsx("span",{className:"font-medium text-gray-200 ml-1",children:ke(C)})]}),R.jsxs("div",{children:["Breaths: ",R.jsx("span",{className:"font-medium text-gray-200 ml-1",children:v})]})]}),R.jsxs("div",{className:"mt-4 flex gap-2",children:[R.jsx("button",{onClick:()=>{T?(w(!1),c(!1),ge()):C>0&&ge()},className:"flex-1 px-3 py-2 rounded-md bg-white/6 text-white hover:bg-white/10",children:"Save Session"}),R.jsx("button",{onClick:()=>{oe()},className:"px-3 py-2 rounded-md bg-gray-800/40 text-gray-200 hover:bg-gray-800",children:"Reset"})]})]}),R.jsxs("div",{className:"mt-4 text-xs text-gray-400",children:["Shortcuts: ",R.jsx("span",{className:"text-white",children:"Space"})," (toggle visual), ",R.jsx("span",{className:"text-white",children:"S"})," (start/stop session), ",R.jsx("span",{className:"text-white",children:"R"})," (reset)."]}),R.jsxs("div",{className:"mt-4 bg-gray-900/50 border border-gray-700 rounded-2xl p-3",children:[R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsxs("div",{children:[R.jsx("div",{className:"text-xs text-gray-400",children:"Activity Score"}),R.jsxs("div",{className:"text-lg font-semibold text-white",children:[Ee.avgBPM||0," bpm  ",Ee.avgDur?ke(Ee.avgDur):"--"]}),R.jsxs("div",{className:"text-xs text-gray-400",children:["Total sessions: ",R.jsx("span",{className:"text-white font-medium ml-1",children:Ee.totalSessions})]})]}),R.jsx("div",{className:"w-28 h-16 flex items-center justify-center",children:R.jsxs("svg",{viewBox:"0 0 36 36",className:"w-20 h-20",children:[R.jsx("path",{d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831",fill:"none",stroke:"#111827",strokeWidth:"3"}),R.jsx("path",{d:`M18 2.0845 a 15.9155 15.9155 0 0 1 0 ${Ee.avgDur/Math.max(Ee.avgDur,20)*31.831}`,fill:"none",stroke:"#7c3aed",strokeWidth:"3",strokeLinecap:"round"})]})})]}),R.jsx("div",{className:"mt-3 text-xs text-gray-400",children:"Recent sessions (duration)"}),R.jsxs("div",{className:"mt-2 flex items-end gap-1 h-20",children:[Le.length===0&&R.jsx("div",{className:"text-xs text-gray-500",children:"No data"}),Le.map((rt,he)=>{const _e=et?Math.max(6,Math.round(rt.duration/et*100)):6;return R.jsx("div",{className:"flex-1 flex items-end",children:R.jsx("div",{title:`${ke(rt.duration)}  ${rt.bpm} bpm`,className:"w-full rounded-sm",style:{height:`${_e}%`,background:"linear-gradient(180deg, rgba(124,58,237,0.95), rgba(79,70,229,0.8))"}})},rt.t)})]})]})]})]}),null]}),R.jsxs("aside",{className:"bg-gray-900/60 backdrop-blur-sm border border-gray-700 rounded-2xl p-5 shadow-lg h-fit relative",children:[R.jsx("div",{className:"flex items-start justify-between mb-4",children:R.jsxs("div",{children:[R.jsx("h3",{className:"text-lg font-semibold text-white",children:"Quick Tips"}),R.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Small practices to anchor your attention."})]})}),R.jsxs("ul",{className:"space-y-3 text-sm text-gray-300 mb-4",children:[R.jsx("li",{children:"Try 510 minutes per session for best results."}),R.jsx("li",{children:"Short daily consistency is more effective than long infrequent sessions."}),R.jsx("li",{children:"When stressed, slow the pace  longer in/hold/out helps calm the nervous system."})]}),R.jsxs("div",{className:"mt-2",children:[R.jsx("h4",{className:"text-sm font-medium text-white mb-2",children:"Session History"}),R.jsx("div",{className:"space-y-2 max-h-64 overflow-auto pr-1",children:R.jsxs(Yo,{children:[te.length===0&&R.jsx(Ht.div,{initial:{opacity:0},animate:{opacity:1},className:"text-xs text-gray-400",children:"No sessions yet  your saved sessions will appear here."}),te.map(rt=>R.jsxs(Ht.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},exit:{opacity:0,height:0},className:"bg-gray-800/40 border border-gray-700 p-2 rounded-lg flex items-center justify-between text-xs",children:[R.jsxs("div",{children:[R.jsx("div",{className:"font-medium text-gray-200",children:new Date(rt.timestamp).toLocaleString()}),R.jsxs("div",{className:"text-gray-400",children:["Dur: ",ke(rt.duration),"  Breaths: ",rt.breaths,"  Speed: ",Vo[rt.speed].label]})]}),R.jsxs("div",{className:"flex flex-col items-end gap-2",children:[R.jsx("button",{onClick:()=>{i(rt.speed),c(!0),setTimeout(()=>c(!1),Math.min(4e3,(rt.duration||30)*1e3))},className:"px-2 py-1 rounded bg-gray-800/60 text-white text-xs",children:"Replay"}),R.jsx("button",{onClick:()=>Ae(rt.id),title:"Delete session",className:"text-red-400 text-xs",children:"Delete"})]})]},rt.id))]})})]})]})]})]})]})}function SPe({result:n}){const{emotion_dist:i,valence:s,arousal:c,recommendation:f,primary:p}=n,v=Math.max(...i||[0]),b=Math.round(v*100),T=f?.title||"Try a grounding exercise",w=f?.desc||f?.description||"Short breathing exercise to reduce arousal.";return R.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow",children:[R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsxs("div",{children:[R.jsxs("h3",{className:"text-lg font-semibold",children:["Inferred mood: ",R.jsx("span",{className:"text-purple-600",children:p})]}),R.jsxs("p",{className:"text-sm text-gray-500",children:["Confidence ",b,"%  Valence: ",s.toFixed(2),"  Arousal: ",c.toFixed(2)]})]}),R.jsx("div",{children:b>60?R.jsx(dM,{className:"text-green-500"}):R.jsx(bpe,{className:"text-yellow-500"})})]}),R.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-4",children:[R.jsxs("div",{className:"p-4 rounded-lg bg-purple-50",children:[R.jsx("div",{className:"text-sm text-gray-500",children:"Primary emotion"}),R.jsx("div",{className:"text-xl font-semibold",children:p})]}),R.jsxs("div",{className:"p-4 rounded-lg bg-gray-50",children:[R.jsx("div",{className:"text-sm text-gray-500",children:"Valence"}),R.jsxs("div",{className:"text-xl font-semibold",children:[(s*100).toFixed(0),"%"]})]}),R.jsxs("div",{className:"p-4 rounded-lg bg-gray-50",children:[R.jsx("div",{className:"text-sm text-gray-500",children:"Arousal"}),R.jsxs("div",{className:"text-xl font-semibold",children:[(c*100).toFixed(0),"%"]})]})]}),R.jsxs("div",{className:"mt-4 p-4 bg-gray-100 rounded-lg",children:[R.jsx("h4",{className:"font-semibold",children:T}),R.jsx("p",{className:"text-sm text-gray-600",children:w}),R.jsxs("div",{className:"mt-3",children:[R.jsx("button",{className:"bg-gradient-to-r from-teal-400 to-blue-500 text-white px-4 py-2 rounded mr-2",children:"Start"}),R.jsx("button",{className:"px-4 py-2 rounded border",children:"Save to history"})]})]})]})}function bPe(){const{user:n}=ao(),[i,s]=j.useState(null),[c,f]=j.useState(null),[p,v]=j.useState(null),[b,T]=j.useState(!1),[w,C]=j.useState(null),[I,D]=j.useState(""),L=async F=>{F.preventDefault(),D(""),C(null),T(!0);try{const W=new FormData;i&&W.append("image",i),c&&W.append("audio",c),p&&W.append("eeg",p),W.append("user_id",n?.id||"guest");const G=await fetch("http://127.0.0.1:8000/infer",{method:"POST",body:W});if(!G.ok){const se=await G.text();throw new Error(se||G.statusText)}const $=await G.json(),te=["Anger","Disgust","Fear","Sad","Neutral","Happy","Surprise"],Z=$.emotion_dist.indexOf(Math.max(...$.emotion_dist)),ce=te[Z]||"Unknown";C({...$,primary:ce})}catch(W){D(W.message||"Inference failed")}finally{T(!1)}};return R.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[R.jsx(Ql,{}),R.jsxs("main",{className:"flex-1 p-8",children:[R.jsx(eu,{}),R.jsxs("div",{className:"max-w-4xl mx-auto",children:[R.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Multimodal Inference"}),R.jsxs("form",{onSubmit:L,className:"bg-white p-6 rounded-2xl shadow space-y-4",children:[R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium",children:"Image (optional)"}),R.jsx("input",{type:"file",accept:"image/*",onChange:F=>s(F.target.files[0])})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium",children:"Audio (optional)"}),R.jsx("input",{type:"file",accept:"audio/*",onChange:F=>f(F.target.files[0])})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium",children:"EEG (optional .json/.npy)"}),R.jsx("input",{type:"file",accept:".json,.npy",onChange:F=>v(F.target.files[0])})]}),R.jsxs("div",{className:"flex items-center gap-3",children:[R.jsx("button",{type:"submit",className:"bg-purple-600 text-white py-2 px-4 rounded",disabled:b,children:b?"Analyzing...":"Run Inference"}),R.jsxs("div",{className:"text-sm text-gray-500",children:["Signed in as ",R.jsx("strong",{children:n?.profile?.displayName||n?.name||"Guest"})]})]}),I&&R.jsx("div",{className:"text-red-500 text-sm",children:I})]}),w&&R.jsx("div",{className:"mt-6",children:R.jsx(SPe,{result:w})})]})]})]})}class TPe extends w2.Component{constructor(i){super(i),this.state={hasError:!1,error:null}}static getDerivedStateFromError(i){return{hasError:!0,error:i}}componentDidCatch(i,s){console.error("App crashed:",i,s)}render(){return this.state.hasError?R.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-6",children:R.jsxs("div",{className:"bg-white shadow-lg rounded-2xl p-8 text-center max-w-lg",children:[R.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-3",children:"Something went wrong"}),R.jsx("p",{className:"text-gray-600 text-sm mb-4",children:"We encountered an unexpected error. Please refresh the page or try again later."}),R.jsx("pre",{className:"bg-gray-100 text-gray-700 text-xs p-3 rounded-md overflow-auto max-h-40",children:String(this.state.error)}),R.jsx("button",{onClick:()=>window.location.reload(),className:"mt-5 bg-purple-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-purple-700",children:"Reload App"})]})}):this.props.children}}function Zh({children:n}){const{user:i,loading:s}=ao();return s?R.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:R.jsx(wb,{})}):i?n:R.jsx(N2,{to:"/login",replace:!0})}function wPe(){const{user:n,loading:i}=ao(),s=Zl();return i?R.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:R.jsx(wb,{})}):n?R.jsx(N2,{to:"/dashboard",state:{from:s},replace:!0}):R.jsx(Aye,{})}function RPe(){return R.jsxs(nhe,{children:[R.jsx($a,{path:"/",element:R.jsx(wPe,{})}),R.jsx($a,{path:"/login",element:R.jsx(Oye,{})}),R.jsx($a,{path:"/signup",element:R.jsx(Nye,{})}),R.jsx($a,{path:"/profile/:id",element:R.jsx(Xye,{})}),R.jsx($a,{path:"/call",element:R.jsx(VJ,{})}),R.jsx($a,{path:"/dashboard",element:R.jsx(Zh,{children:R.jsx(Wye,{})})}),R.jsx($a,{path:"/history",element:R.jsx(Zh,{children:R.jsx(Kye,{})})}),R.jsx($a,{path:"/settings",element:R.jsx(Zh,{children:R.jsx(qye,{})})}),R.jsx($a,{path:"/mood",element:R.jsx(Zh,{children:R.jsx(fPe,{})})}),R.jsx($a,{path:"/journal",element:R.jsx(Zh,{children:R.jsx(mPe,{})})}),R.jsx($a,{path:"/community",element:R.jsx(Zh,{children:R.jsx(vPe,{})})}),R.jsx($a,{path:"/meditation",element:R.jsx(Zh,{children:R.jsx(EPe,{})})}),R.jsx($a,{path:"/infer",element:R.jsx(Zh,{children:R.jsx(bPe,{})})}),R.jsx($a,{path:"*",element:R.jsx(N2,{to:"/",replace:!0})})]})}function CPe(){return R.jsx(jhe,{children:R.jsx(Bhe,{children:R.jsx(TPe,{children:R.jsx(j.Suspense,{fallback:R.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:R.jsx(wb,{})}),children:R.jsx(RPe,{})})})})})}dde.createRoot(document.getElementById("root")).render(R.jsx(w2.StrictMode,{children:R.jsx(Rhe,{children:R.jsx(CPe,{})})}));export{Yo as A,iX as V,rb as X,Khe as _,OPe as a,R as j,Ht as m,j as r};
